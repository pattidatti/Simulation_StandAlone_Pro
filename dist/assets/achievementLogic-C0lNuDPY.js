import{b as p,r as v,s as k,g as b,u as A}from"./index-DLzf93r1.js";async function T(c,l,e,u){if(!c||!l||!e)return;const n=e.unlockedAchievements||{},i=Array.isArray(n)?new Set(n):new Set(Object.keys(n)),a=[],t=p.filter(o=>o.triggerType==="PASSIVE");for(const o of t)i.has(o.id)||E(o,l,e)&&a.push(o.id);a.length>0&&await w(c,e,a,u)}async function $(c,l,e,u,n,i,a){if(!c||!l||!e)return;const t=e.unlockedAchievements||{},o=Array.isArray(t)?new Set(t):new Set(Object.keys(t)),f=[],r=p.filter(s=>s.triggerType==="EVENT"&&s.condition.type===u&&s.condition.target===n);if(r.length===0)return;const h=((e.statistics||{})[n]||0)+i,g=v(k,`simulation_accounts/${c}`),d={};d[`statistics/${n}`]=h;for(const s of r)if(!o.has(s.id)&&h>=Number(s.condition.value)){f.push(s.id),d[`unlockedAchievements/${s.id}`]=Date.now();const y=(e.globalXp||0)+s.xp;d.globalXp=y,a(s.id)}try{await A(g,d),f.length>0&&console.log(`Unlocked via Event: ${f.join(", ")}`)}catch(s){console.error("Failed to commit event updates:",s)}}function E(c,l,e){const{type:u,target:n,value:i,comparison:a}=c.condition,t=Number(i),o=l.resources||{},f=l.stats||{};let r=0;try{switch(u){case"RESOURCE":r=o[n]||0;break;case"STAT":r=f[n]||0;break;case"ROLE":return r=l.role,r===i;case"ACCOUNT_STAT":r=e[n]||0;break;default:return!1}if(typeof r=="number")return a==="EQ"?r===t:r>=t}catch(m){return console.warn(`Achievement Eval Failed for ${c.id}`,m),!1}return!1}async function w(c,l,e,u){const n=v(k,`simulation_accounts/${c}`),i={};let a=l.globalXp||0;for(const t of e){const o=b(t);o&&(i[`unlockedAchievements/${t}`]=Date.now(),a+=o.xp,u(t))}i.globalXp=a,i.globalLevel=Math.floor(Math.sqrt(a/100))+1;try{await A(n,i),console.log(`Unlocked items for ${c}: ${e.join(", ")}`)}catch(t){console.error("Failed to unlock achievements:",t)}}export{$ as checkEventAchievements,T as checkPassiveAchievements};
