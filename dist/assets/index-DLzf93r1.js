const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimulationMarket-Cq384681.js","assets/Badge-DSI_Uam3.js","assets/SimulationVault-o-SrchBY.js","assets/timer-ClOolqBk.js","assets/SimulationSkills-CbJFzChB.js","assets/GameCard-CNCuxGO0.js","assets/SimulationProduction--mYJ7evg.js","assets/RecipeCard-CNGgA5XU.js","assets/SimulationHierarchy-BmUxAwv6.js","assets/PoliticalHub-s3El8DKe.js","assets/ApothecaryWindow-DhrSt_Wa.js"])))=>i.map(i=>d[i]);
var CO=Object.defineProperty;var RO=(t,e,s)=>e in t?CO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Ie=(t,e,s)=>RO(t,typeof e!="symbol"?e+"":e,s);function IO(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(n,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();function ET(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var AT={exports:{}},Km={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OO=Symbol.for("react.transitional.element"),MO=Symbol.for("react.fragment");function jT(t,e,s){var n=null;if(s!==void 0&&(n=""+s),e.key!==void 0&&(n=""+e.key),"key"in e){s={};for(var i in e)i!=="key"&&(s[i]=e[i])}else s=e;return e=s.ref,{$$typeof:OO,type:t,key:n,ref:e!==void 0?e:null,props:s}}Km.Fragment=MO;Km.jsx=jT;Km.jsxs=jT;AT.exports=Km;var o=AT.exports,CT={exports:{}},we={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ub=Symbol.for("react.transitional.element"),DO=Symbol.for("react.portal"),LO=Symbol.for("react.fragment"),PO=Symbol.for("react.strict_mode"),VO=Symbol.for("react.profiler"),FO=Symbol.for("react.consumer"),BO=Symbol.for("react.context"),UO=Symbol.for("react.forward_ref"),$O=Symbol.for("react.suspense"),GO=Symbol.for("react.memo"),RT=Symbol.for("react.lazy"),HO=Symbol.for("react.activity"),N1=Symbol.iterator;function zO(t){return t===null||typeof t!="object"?null:(t=N1&&t[N1]||t["@@iterator"],typeof t=="function"?t:null)}var IT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},OT=Object.assign,MT={};function uc(t,e,s){this.props=t,this.context=e,this.refs=MT,this.updater=s||IT}uc.prototype.isReactComponent={};uc.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};uc.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function DT(){}DT.prototype=uc.prototype;function $b(t,e,s){this.props=t,this.context=e,this.refs=MT,this.updater=s||IT}var Gb=$b.prototype=new DT;Gb.constructor=$b;OT(Gb,uc.prototype);Gb.isPureReactComponent=!0;var S1=Array.isArray;function Rg(){}var gt={H:null,A:null,T:null,S:null},LT=Object.prototype.hasOwnProperty;function Hb(t,e,s){var n=s.ref;return{$$typeof:Ub,type:t,key:e,ref:n!==void 0?n:null,props:s}}function qO(t,e){return Hb(t.type,e,t.props)}function zb(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ub}function KO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var T1=/\/+/g;function u0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?KO(""+t.key):e.toString(36)}function WO(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Rg,Rg):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function Ko(t,e,s,n,i){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(r){case"bigint":case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Ub:case DO:a=!0;break;case RT:return a=t._init,Ko(a(t._payload),e,s,n,i)}}if(a)return i=i(t),a=n===""?"."+u0(t,0):n,S1(i)?(s="",a!=null&&(s=a.replace(T1,"$&/")+"/"),Ko(i,e,s,"",function(u){return u})):i!=null&&(zb(i)&&(i=qO(i,s+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(T1,"$&/")+"/")+a)),e.push(i)),1;a=0;var l=n===""?".":n+":";if(S1(t))for(var c=0;c<t.length;c++)n=t[c],r=l+u0(n,c),a+=Ko(n,e,s,r,i);else if(c=zO(t),typeof c=="function")for(t=c.call(t),c=0;!(n=t.next()).done;)n=n.value,r=l+u0(n,c++),a+=Ko(n,e,s,r,i);else if(r==="object"){if(typeof t.then=="function")return Ko(WO(t),e,s,n,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function mh(t,e,s){if(t==null)return t;var n=[],i=0;return Ko(t,n,"","",function(r){return e.call(s,r,i++)}),n}function YO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var E1=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},XO={map:mh,forEach:function(t,e,s){mh(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return mh(t,function(){e++}),e},toArray:function(t){return mh(t,function(e){return e})||[]},only:function(t){if(!zb(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};we.Activity=HO;we.Children=XO;we.Component=uc;we.Fragment=LO;we.Profiler=VO;we.PureComponent=$b;we.StrictMode=PO;we.Suspense=$O;we.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=gt;we.__COMPILER_RUNTIME={__proto__:null,c:function(t){return gt.H.useMemoCache(t)}};we.cache=function(t){return function(){return t.apply(null,arguments)}};we.cacheSignal=function(){return null};we.cloneElement=function(t,e,s){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var n=OT({},t.props),i=t.key;if(e!=null)for(r in e.key!==void 0&&(i=""+e.key),e)!LT.call(e,r)||r==="key"||r==="__self"||r==="__source"||r==="ref"&&e.ref===void 0||(n[r]=e[r]);var r=arguments.length-2;if(r===1)n.children=s;else if(1<r){for(var a=Array(r),l=0;l<r;l++)a[l]=arguments[l+2];n.children=a}return Hb(t.type,i,n)};we.createContext=function(t){return t={$$typeof:BO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:FO,_context:t},t};we.createElement=function(t,e,s){var n,i={},r=null;if(e!=null)for(n in e.key!==void 0&&(r=""+e.key),e)LT.call(e,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=s;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return Hb(t,r,i)};we.createRef=function(){return{current:null}};we.forwardRef=function(t){return{$$typeof:UO,render:t}};we.isValidElement=zb;we.lazy=function(t){return{$$typeof:RT,_payload:{_status:-1,_result:t},_init:YO}};we.memo=function(t,e){return{$$typeof:GO,type:t,compare:e===void 0?null:e}};we.startTransition=function(t){var e=gt.T,s={};gt.T=s;try{var n=t(),i=gt.S;i!==null&&i(s,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(Rg,E1)}catch(r){E1(r)}finally{e!==null&&s.types!==null&&(e.types=s.types),gt.T=e}};we.unstable_useCacheRefresh=function(){return gt.H.useCacheRefresh()};we.use=function(t){return gt.H.use(t)};we.useActionState=function(t,e,s){return gt.H.useActionState(t,e,s)};we.useCallback=function(t,e){return gt.H.useCallback(t,e)};we.useContext=function(t){return gt.H.useContext(t)};we.useDebugValue=function(){};we.useDeferredValue=function(t,e){return gt.H.useDeferredValue(t,e)};we.useEffect=function(t,e){return gt.H.useEffect(t,e)};we.useEffectEvent=function(t){return gt.H.useEffectEvent(t)};we.useId=function(){return gt.H.useId()};we.useImperativeHandle=function(t,e,s){return gt.H.useImperativeHandle(t,e,s)};we.useInsertionEffect=function(t,e){return gt.H.useInsertionEffect(t,e)};we.useLayoutEffect=function(t,e){return gt.H.useLayoutEffect(t,e)};we.useMemo=function(t,e){return gt.H.useMemo(t,e)};we.useOptimistic=function(t,e){return gt.H.useOptimistic(t,e)};we.useReducer=function(t,e,s){return gt.H.useReducer(t,e,s)};we.useRef=function(t){return gt.H.useRef(t)};we.useState=function(t){return gt.H.useState(t)};we.useSyncExternalStore=function(t,e,s){return gt.H.useSyncExternalStore(t,e,s)};we.useTransition=function(){return gt.H.useTransition()};we.version="19.2.3";CT.exports=we;var S=CT.exports;const Ne=ET(S),QO=IO({__proto__:null,default:Ne},[S]);var PT={exports:{}},Wm={},VT={exports:{}},FT={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(O,L){var M=O.length;O.push(L);e:for(;0<M;){var F=M-1>>>1,U=O[F];if(0<i(U,L))O[F]=L,O[M]=U,M=F;else break e}}function s(O){return O.length===0?null:O[0]}function n(O){if(O.length===0)return null;var L=O[0],M=O.pop();if(M!==L){O[0]=M;e:for(var F=0,U=O.length,C=U>>>1;F<C;){var j=2*(F+1)-1,$=O[j],B=j+1,D=O[B];if(0>i($,M))B<U&&0>i(D,$)?(O[F]=D,O[B]=M,F=B):(O[F]=$,O[j]=M,F=j);else if(B<U&&0>i(D,M))O[F]=D,O[B]=M,F=B;else break e}}return L}function i(O,L){var M=O.sortIndex-L.sortIndex;return M!==0?M:O.id-L.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,f=3,m=!1,b=!1,p=!1,v=!1,x=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;function w(O){for(var L=s(u);L!==null;){if(L.callback===null)n(u);else if(L.startTime<=O)n(u),L.sortIndex=L.expirationTime,e(c,L);else break;L=s(u)}}function k(O){if(p=!1,w(O),!b)if(s(c)!==null)b=!0,N||(N=!0,I());else{var L=s(u);L!==null&&P(k,L.startTime-O)}}var N=!1,_=-1,T=5,E=-1;function A(){return v?!0:!(t.unstable_now()-E<T)}function R(){if(v=!1,N){var O=t.unstable_now();E=O;var L=!0;try{e:{b=!1,p&&(p=!1,g(_),_=-1),m=!0;var M=f;try{t:{for(w(O),h=s(c);h!==null&&!(h.expirationTime>O&&A());){var F=h.callback;if(typeof F=="function"){h.callback=null,f=h.priorityLevel;var U=F(h.expirationTime<=O);if(O=t.unstable_now(),typeof U=="function"){h.callback=U,w(O),L=!0;break t}h===s(c)&&n(c),w(O)}else n(c);h=s(c)}if(h!==null)L=!0;else{var C=s(u);C!==null&&P(k,C.startTime-O),L=!1}}break e}finally{h=null,f=M,m=!1}L=void 0}}finally{L?I():N=!1}}}var I;if(typeof y=="function")I=function(){y(R)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,H=V.port2;V.port1.onmessage=R,I=function(){H.postMessage(null)}}else I=function(){x(R,0)};function P(O,L){_=x(function(){O(t.unstable_now())},L)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(O){switch(f){case 1:case 2:case 3:var L=3;break;default:L=f}var M=f;f=L;try{return O()}finally{f=M}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(O,L){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var M=f;f=O;try{return L()}finally{f=M}},t.unstable_scheduleCallback=function(O,L,M){var F=t.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?F+M:F):M=F,O){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=M+U,O={id:d++,callback:L,priorityLevel:O,startTime:M,expirationTime:U,sortIndex:-1},M>F?(O.sortIndex=M,e(u,O),s(c)===null&&O===s(u)&&(p?(g(_),_=-1):p=!0,P(k,M-F))):(O.sortIndex=U,e(c,O),b||m||(b=!0,N||(N=!0,I()))),O},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(O){var L=f;return function(){var M=f;f=L;try{return O.apply(this,arguments)}finally{f=M}}}})(FT);VT.exports=FT;var JO=VT.exports,BT={exports:{}},As={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZO=S;function UT(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function vr(){}var ws={d:{f:vr,r:function(){throw Error(UT(522))},D:vr,C:vr,L:vr,m:vr,X:vr,S:vr,M:vr},p:0,findDOMNode:null},eM=Symbol.for("react.portal");function tM(t,e,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eM,key:n==null?null:""+n,children:t,containerInfo:e,implementation:s}}var ou=ZO.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Ym(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}As.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ws;As.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(UT(299));return tM(t,e,null,s)};As.flushSync=function(t){var e=ou.T,s=ws.p;try{if(ou.T=null,ws.p=2,t)return t()}finally{ou.T=e,ws.p=s,ws.d.f()}};As.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,ws.d.C(t,e))};As.prefetchDNS=function(t){typeof t=="string"&&ws.d.D(t)};As.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var s=e.as,n=Ym(s,e.crossOrigin),i=typeof e.integrity=="string"?e.integrity:void 0,r=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;s==="style"?ws.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:n,integrity:i,fetchPriority:r}):s==="script"&&ws.d.X(t,{crossOrigin:n,integrity:i,fetchPriority:r,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};As.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var s=Ym(e.as,e.crossOrigin);ws.d.M(t,{crossOrigin:s,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&ws.d.M(t)};As.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var s=e.as,n=Ym(s,e.crossOrigin);ws.d.L(t,s,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};As.preloadModule=function(t,e){if(typeof t=="string")if(e){var s=Ym(e.as,e.crossOrigin);ws.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:s,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else ws.d.m(t)};As.requestFormReset=function(t){ws.d.r(t)};As.unstable_batchedUpdates=function(t,e){return t(e)};As.useFormState=function(t,e,s){return ou.H.useFormState(t,e,s)};As.useFormStatus=function(){return ou.H.useHostTransitionStatus()};As.version="19.2.3";function $T(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($T)}catch(t){console.error(t)}}$T(),BT.exports=As;var qb=BT.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt=JO,GT=S,sM=qb;function X(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function HT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function wd(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function zT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function qT(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function A1(t){if(wd(t)!==t)throw Error(X(188))}function nM(t){var e=t.alternate;if(!e){if(e=wd(t),e===null)throw Error(X(188));return e!==t?null:t}for(var s=t,n=e;;){var i=s.return;if(i===null)break;var r=i.alternate;if(r===null){if(n=i.return,n!==null){s=n;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===s)return A1(i),t;if(r===n)return A1(i),e;r=r.sibling}throw Error(X(188))}if(s.return!==n.return)s=i,n=r;else{for(var a=!1,l=i.child;l;){if(l===s){a=!0,s=i,n=r;break}if(l===n){a=!0,n=i,s=r;break}l=l.sibling}if(!a){for(l=r.child;l;){if(l===s){a=!0,s=r,n=i;break}if(l===n){a=!0,n=r,s=i;break}l=l.sibling}if(!a)throw Error(X(189))}}if(s.alternate!==n)throw Error(X(190))}if(s.tag!==3)throw Error(X(188));return s.stateNode.current===s?t:e}function KT(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=KT(t),e!==null)return e;t=t.sibling}return null}var vt=Object.assign,iM=Symbol.for("react.element"),ph=Symbol.for("react.transitional.element"),Jc=Symbol.for("react.portal"),Qo=Symbol.for("react.fragment"),WT=Symbol.for("react.strict_mode"),Ig=Symbol.for("react.profiler"),YT=Symbol.for("react.consumer"),Oi=Symbol.for("react.context"),Kb=Symbol.for("react.forward_ref"),Og=Symbol.for("react.suspense"),Mg=Symbol.for("react.suspense_list"),Wb=Symbol.for("react.memo"),Nr=Symbol.for("react.lazy"),Dg=Symbol.for("react.activity"),rM=Symbol.for("react.memo_cache_sentinel"),j1=Symbol.iterator;function Bc(t){return t===null||typeof t!="object"?null:(t=j1&&t[j1]||t["@@iterator"],typeof t=="function"?t:null)}var aM=Symbol.for("react.client.reference");function Lg(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===aM?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Qo:return"Fragment";case Ig:return"Profiler";case WT:return"StrictMode";case Og:return"Suspense";case Mg:return"SuspenseList";case Dg:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case Jc:return"Portal";case Oi:return t.displayName||"Context";case YT:return(t._context.displayName||"Context")+".Consumer";case Kb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Wb:return e=t.displayName||null,e!==null?e:Lg(t.type)||"Memo";case Nr:e=t._payload,t=t._init;try{return Lg(t(e))}catch{}}return null}var Zc=Array.isArray,ye=GT.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$e=sM.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,eo={pending:!1,data:null,method:null,action:null},Pg=[],Jo=-1;function gi(t){return{current:t}}function as(t){0>Jo||(t.current=Pg[Jo],Pg[Jo]=null,Jo--)}function ut(t,e){Jo++,Pg[Jo]=t.current,t.current=e}var oi=gi(null),Mu=gi(null),Hr=gi(null),vf=gi(null);function yf(t,e){switch(ut(Hr,e),ut(Mu,t),ut(oi,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?Dw(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=Dw(e),t=pA(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}as(oi),ut(oi,t)}function Ll(){as(oi),as(Mu),as(Hr)}function Vg(t){t.memoizedState!==null&&ut(vf,t);var e=oi.current,s=pA(e,t.type);e!==s&&(ut(Mu,t),ut(oi,s))}function _f(t){Mu.current===t&&(as(oi),as(Mu)),vf.current===t&&(as(vf),zu._currentValue=eo)}var d0,C1;function Ba(t){if(d0===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);d0=e&&e[1]||"",C1=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+d0+t+C1}var h0=!1;function f0(t,e){if(!t||h0)return"";h0=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(e){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(m){var f=m}Reflect.construct(t,[],h)}else{try{h.call()}catch(m){f=m}t.call(h.prototype)}}else{try{throw Error()}catch(m){f=m}(h=t())&&typeof h.catch=="function"&&h.catch(function(){})}}catch(m){if(m&&f&&typeof m.stack=="string")return[m.stack,f.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),a=r[0],l=r[1];if(a&&l){var c=a.split(`
`),u=l.split(`
`);for(i=n=0;n<c.length&&!c[n].includes("DetermineComponentFrameRoot");)n++;for(;i<u.length&&!u[i].includes("DetermineComponentFrameRoot");)i++;if(n===c.length||i===u.length)for(n=c.length-1,i=u.length-1;1<=n&&0<=i&&c[n]!==u[i];)i--;for(;1<=n&&0<=i;n--,i--)if(c[n]!==u[i]){if(n!==1||i!==1)do if(n--,i--,0>i||c[n]!==u[i]){var d=`
`+c[n].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=n&&0<=i);break}}}finally{h0=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?Ba(s):""}function oM(t,e){switch(t.tag){case 26:case 27:case 5:return Ba(t.type);case 16:return Ba("Lazy");case 13:return t.child!==e&&e!==null?Ba("Suspense Fallback"):Ba("Suspense");case 19:return Ba("SuspenseList");case 0:case 15:return f0(t.type,!1);case 11:return f0(t.type.render,!1);case 1:return f0(t.type,!0);case 31:return Ba("Activity");default:return""}}function R1(t){try{var e="",s=null;do e+=oM(t,s),s=t,t=t.return;while(t);return e}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var Fg=Object.prototype.hasOwnProperty,Yb=Jt.unstable_scheduleCallback,m0=Jt.unstable_cancelCallback,lM=Jt.unstable_shouldYield,cM=Jt.unstable_requestPaint,sn=Jt.unstable_now,uM=Jt.unstable_getCurrentPriorityLevel,XT=Jt.unstable_ImmediatePriority,QT=Jt.unstable_UserBlockingPriority,wf=Jt.unstable_NormalPriority,dM=Jt.unstable_LowPriority,JT=Jt.unstable_IdlePriority,hM=Jt.log,fM=Jt.unstable_setDisableYieldValue,kd=null,nn=null;function Dr(t){if(typeof hM=="function"&&fM(t),nn&&typeof nn.setStrictMode=="function")try{nn.setStrictMode(kd,t)}catch{}}var rn=Math.clz32?Math.clz32:gM,mM=Math.log,pM=Math.LN2;function gM(t){return t>>>=0,t===0?32:31-(mM(t)/pM|0)|0}var gh=256,xh=262144,bh=4194304;function Ua(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Xm(t,e,s){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes;t=t.warmLanes;var l=n&134217727;return l!==0?(n=l&~r,n!==0?i=Ua(n):(a&=l,a!==0?i=Ua(a):s||(s=l&~t,s!==0&&(i=Ua(s))))):(l=n&~r,l!==0?i=Ua(l):a!==0?i=Ua(a):s||(s=n&~t,s!==0&&(i=Ua(s)))),i===0?0:e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===32&&(s&4194048)!==0)?e:i}function Nd(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function xM(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ZT(){var t=bh;return bh<<=1,!(bh&62914560)&&(bh=4194304),t}function p0(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function Sd(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function bM(t,e,s,n,i,r){var a=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var l=t.entanglements,c=t.expirationTimes,u=t.hiddenUpdates;for(s=a&~s;0<s;){var d=31-rn(s),h=1<<d;l[d]=0,c[d]=-1;var f=u[d];if(f!==null)for(u[d]=null,d=0;d<f.length;d++){var m=f[d];m!==null&&(m.lane&=-536870913)}s&=~h}n!==0&&eE(t,n,0),r!==0&&i===0&&t.tag!==0&&(t.suspendedLanes|=r&~(a&~e))}function eE(t,e,s){t.pendingLanes|=e,t.suspendedLanes&=~e;var n=31-rn(e);t.entangledLanes|=e,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function tE(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var n=31-rn(s),i=1<<n;i&e|t[n]&e&&(t[n]|=e),s&=~i}}function sE(t,e){var s=e&-e;return s=s&42?1:Xb(s),s&(t.suspendedLanes|e)?0:s}function Xb(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Qb(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function nE(){var t=$e.p;return t!==0?t:(t=window.event,t===void 0?32:TA(t.type))}function I1(t,e){var s=$e.p;try{return $e.p=t,e()}finally{$e.p=s}}var Sa=Math.random().toString(36).slice(2),hs="__reactFiber$"+Sa,$s="__reactProps$"+Sa,dc="__reactContainer$"+Sa,Bg="__reactEvents$"+Sa,vM="__reactListeners$"+Sa,yM="__reactHandles$"+Sa,O1="__reactResources$"+Sa,Td="__reactMarker$"+Sa;function Jb(t){delete t[hs],delete t[$s],delete t[Bg],delete t[vM],delete t[yM]}function Zo(t){var e=t[hs];if(e)return e;for(var s=t.parentNode;s;){if(e=s[dc]||s[hs]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Bw(t);t!==null;){if(s=t[hs])return s;t=Bw(t)}return e}t=s,s=t.parentNode}return null}function hc(t){if(t=t[hs]||t[dc]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function eu(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(X(33))}function yl(t){var e=t[O1];return e||(e=t[O1]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function is(t){t[Td]=!0}var iE=new Set,rE={};function Eo(t,e){Pl(t,e),Pl(t+"Capture",e)}function Pl(t,e){for(rE[t]=e,t=0;t<e.length;t++)iE.add(e[t])}var _M=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),M1={},D1={};function wM(t){return Fg.call(D1,t)?!0:Fg.call(M1,t)?!1:_M.test(t)?D1[t]=!0:(M1[t]=!0,!1)}function zh(t,e,s){if(wM(e))if(s===null)t.removeAttribute(e);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var n=e.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+s)}}function vh(t,e,s){if(s===null)t.removeAttribute(e);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+s)}}function ki(t,e,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(e,s,""+n)}}function mn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function aE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kM(t,e,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){s=""+a,r.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ug(t){if(!t._valueTracker){var e=aE(t)?"checked":"value";t._valueTracker=kM(t,e,""+t[e])}}function oE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),n="";return t&&(n=aE(t)?t.checked?"true":"false":t.value),t=n,t!==s?(e.setValue(t),!0):!1}function kf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var NM=/[\n"\\]/g;function xn(t){return t.replace(NM,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function $g(t,e,s,n,i,r,a,l){t.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?t.type=a:t.removeAttribute("type"),e!=null?a==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+mn(e)):t.value!==""+mn(e)&&(t.value=""+mn(e)):a!=="submit"&&a!=="reset"||t.removeAttribute("value"),e!=null?Gg(t,a,mn(e)):s!=null?Gg(t,a,mn(s)):n!=null&&t.removeAttribute("value"),i==null&&r!=null&&(t.defaultChecked=!!r),i!=null&&(t.checked=i&&typeof i!="function"&&typeof i!="symbol"),l!=null&&typeof l!="function"&&typeof l!="symbol"&&typeof l!="boolean"?t.name=""+mn(l):t.removeAttribute("name")}function lE(t,e,s,n,i,r,a,l){if(r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(t.type=r),e!=null||s!=null){if(!(r!=="submit"&&r!=="reset"||e!=null)){Ug(t);return}s=s!=null?""+mn(s):"",e=e!=null?""+mn(e):s,l||e===t.value||(t.value=e),t.defaultValue=e}n=n??i,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=l?t.checked:!!n,t.defaultChecked=!!n,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(t.name=a),Ug(t)}function Gg(t,e,s){e==="number"&&kf(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function _l(t,e,s,n){if(t=t.options,e){e={};for(var i=0;i<s.length;i++)e["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=e.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&n&&(t[s].defaultSelected=!0)}else{for(s=""+mn(s),e=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function cE(t,e,s){if(e!=null&&(e=""+mn(e),e!==t.value&&(t.value=e),s==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=s!=null?""+mn(s):""}function uE(t,e,s,n){if(e==null){if(n!=null){if(s!=null)throw Error(X(92));if(Zc(n)){if(1<n.length)throw Error(X(93));n=n[0]}s=n}s==null&&(s=""),e=s}s=mn(e),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Ug(t)}function Vl(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var SM=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function L1(t,e,s){var n=e.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":n?t.setProperty(e,s):typeof s!="number"||s===0||SM.has(e)?e==="float"?t.cssFloat=s:t[e]=(""+s).trim():t[e]=s+"px"}function dE(t,e,s){if(e!=null&&typeof e!="object")throw Error(X(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||e!=null&&e.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var i in e)n=e[i],e.hasOwnProperty(i)&&s[i]!==n&&L1(t,i,n)}else for(var r in e)e.hasOwnProperty(r)&&L1(t,r,e[r])}function Zb(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var TM=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),EM=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qh(t){return EM.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function Mi(){}var Hg=null;function ev(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var el=null,wl=null;function P1(t){var e=hc(t);if(e&&(t=e.stateNode)){var s=t[$s]||null;e:switch(t=e.stateNode,e.type){case"input":if($g(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+xn(""+e)+'"][type="radio"]'),e=0;e<s.length;e++){var n=s[e];if(n!==t&&n.form===t.form){var i=n[$s]||null;if(!i)throw Error(X(90));$g(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(e=0;e<s.length;e++)n=s[e],n.form===t.form&&oE(n)}break e;case"textarea":cE(t,s.value,s.defaultValue);break e;case"select":e=s.value,e!=null&&_l(t,!!s.multiple,e,!1)}}}var g0=!1;function hE(t,e,s){if(g0)return t(e,s);g0=!0;try{var n=t(e);return n}finally{if(g0=!1,(el!==null||wl!==null)&&(lp(),el&&(e=el,t=wl,wl=el=null,P1(e),t)))for(e=0;e<t.length;e++)P1(t[e])}}function Du(t,e){var s=t.stateNode;if(s===null)return null;var n=s[$s]||null;if(n===null)return null;s=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(X(231,e,typeof s));return s}var Yi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),zg=!1;if(Yi)try{var Uc={};Object.defineProperty(Uc,"passive",{get:function(){zg=!0}}),window.addEventListener("test",Uc,Uc),window.removeEventListener("test",Uc,Uc)}catch{zg=!1}var Lr=null,tv=null,Kh=null;function fE(){if(Kh)return Kh;var t,e=tv,s=e.length,n,i="value"in Lr?Lr.value:Lr.textContent,r=i.length;for(t=0;t<s&&e[t]===i[t];t++);var a=s-t;for(n=1;n<=a&&e[s-n]===i[r-n];n++);return Kh=i.slice(t,1<n?1-n:void 0)}function Wh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yh(){return!0}function V1(){return!1}function zs(t){function e(s,n,i,r,a){this._reactName=s,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(s=t[l],this[l]=s?s(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?yh:V1,this.isPropagationStopped=V1,this}return vt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=yh)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=yh)},persist:function(){},isPersistent:yh}),e}var Ao={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qm=zs(Ao),Ed=vt({},Ao,{view:0,detail:0}),AM=zs(Ed),x0,b0,$c,Jm=vt({},Ed,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sv,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==$c&&($c&&t.type==="mousemove"?(x0=t.screenX-$c.screenX,b0=t.screenY-$c.screenY):b0=x0=0,$c=t),x0)},movementY:function(t){return"movementY"in t?t.movementY:b0}}),F1=zs(Jm),jM=vt({},Jm,{dataTransfer:0}),CM=zs(jM),RM=vt({},Ed,{relatedTarget:0}),v0=zs(RM),IM=vt({},Ao,{animationName:0,elapsedTime:0,pseudoElement:0}),OM=zs(IM),MM=vt({},Ao,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),DM=zs(MM),LM=vt({},Ao,{data:0}),B1=zs(LM),PM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},VM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function BM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=FM[t])?!!e[t]:!1}function sv(){return BM}var UM=vt({},Ed,{key:function(t){if(t.key){var e=PM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Wh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?VM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sv,charCode:function(t){return t.type==="keypress"?Wh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Wh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),$M=zs(UM),GM=vt({},Jm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),U1=zs(GM),HM=vt({},Ed,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sv}),zM=zs(HM),qM=vt({},Ao,{propertyName:0,elapsedTime:0,pseudoElement:0}),KM=zs(qM),WM=vt({},Jm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),YM=zs(WM),XM=vt({},Ao,{newState:0,oldState:0}),QM=zs(XM),JM=[9,13,27,32],nv=Yi&&"CompositionEvent"in window,lu=null;Yi&&"documentMode"in document&&(lu=document.documentMode);var ZM=Yi&&"TextEvent"in window&&!lu,mE=Yi&&(!nv||lu&&8<lu&&11>=lu),$1=" ",G1=!1;function pE(t,e){switch(t){case"keyup":return JM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function gE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var tl=!1;function e4(t,e){switch(t){case"compositionend":return gE(e);case"keypress":return e.which!==32?null:(G1=!0,$1);case"textInput":return t=e.data,t===$1&&G1?null:t;default:return null}}function t4(t,e){if(tl)return t==="compositionend"||!nv&&pE(t,e)?(t=fE(),Kh=tv=Lr=null,tl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return mE&&e.locale!=="ko"?null:e.data;default:return null}}var s4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function H1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!s4[t.type]:e==="textarea"}function xE(t,e,s,n){el?wl?wl.push(n):wl=[n]:el=n,e=Uf(e,"onChange"),0<e.length&&(s=new Qm("onChange","change",null,s,n),t.push({event:s,listeners:e}))}var cu=null,Lu=null;function n4(t){hA(t,0)}function Zm(t){var e=eu(t);if(oE(e))return t}function z1(t,e){if(t==="change")return e}var bE=!1;if(Yi){var y0;if(Yi){var _0="oninput"in document;if(!_0){var q1=document.createElement("div");q1.setAttribute("oninput","return;"),_0=typeof q1.oninput=="function"}y0=_0}else y0=!1;bE=y0&&(!document.documentMode||9<document.documentMode)}function K1(){cu&&(cu.detachEvent("onpropertychange",vE),Lu=cu=null)}function vE(t){if(t.propertyName==="value"&&Zm(Lu)){var e=[];xE(e,Lu,t,ev(t)),hE(n4,e)}}function i4(t,e,s){t==="focusin"?(K1(),cu=e,Lu=s,cu.attachEvent("onpropertychange",vE)):t==="focusout"&&K1()}function r4(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Zm(Lu)}function a4(t,e){if(t==="click")return Zm(e)}function o4(t,e){if(t==="input"||t==="change")return Zm(e)}function l4(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ln=typeof Object.is=="function"?Object.is:l4;function Pu(t,e){if(ln(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var i=s[n];if(!Fg.call(e,i)||!ln(t[i],e[i]))return!1}return!0}function W1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Y1(t,e){var s=W1(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=e&&n>=e)return{node:s,offset:e-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=W1(s)}}function yE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?yE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function _E(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=kf(t.document);e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=kf(t.document)}return e}function iv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var c4=Yi&&"documentMode"in document&&11>=document.documentMode,sl=null,qg=null,uu=null,Kg=!1;function X1(t,e,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Kg||sl==null||sl!==kf(n)||(n=sl,"selectionStart"in n&&iv(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),uu&&Pu(uu,n)||(uu=n,n=Uf(qg,"onSelect"),0<n.length&&(e=new Qm("onSelect","select",null,e,s),t.push({event:e,listeners:n}),e.target=sl)))}function La(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var nl={animationend:La("Animation","AnimationEnd"),animationiteration:La("Animation","AnimationIteration"),animationstart:La("Animation","AnimationStart"),transitionrun:La("Transition","TransitionRun"),transitionstart:La("Transition","TransitionStart"),transitioncancel:La("Transition","TransitionCancel"),transitionend:La("Transition","TransitionEnd")},w0={},wE={};Yi&&(wE=document.createElement("div").style,"AnimationEvent"in window||(delete nl.animationend.animation,delete nl.animationiteration.animation,delete nl.animationstart.animation),"TransitionEvent"in window||delete nl.transitionend.transition);function jo(t){if(w0[t])return w0[t];if(!nl[t])return t;var e=nl[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in wE)return w0[t]=e[s];return t}var kE=jo("animationend"),NE=jo("animationiteration"),SE=jo("animationstart"),u4=jo("transitionrun"),d4=jo("transitionstart"),h4=jo("transitioncancel"),TE=jo("transitionend"),EE=new Map,Wg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Wg.push("scrollEnd");function Jn(t,e){EE.set(t,e),Eo(e,[t])}var Nf=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},fn=[],il=0,rv=0;function ep(){for(var t=il,e=rv=il=0;e<t;){var s=fn[e];fn[e++]=null;var n=fn[e];fn[e++]=null;var i=fn[e];fn[e++]=null;var r=fn[e];if(fn[e++]=null,n!==null&&i!==null){var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}r!==0&&AE(s,i,r)}}function tp(t,e,s,n){fn[il++]=t,fn[il++]=e,fn[il++]=s,fn[il++]=n,rv|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function av(t,e,s,n){return tp(t,e,s,n),Sf(t)}function Co(t,e){return tp(t,null,null,e),Sf(t)}function AE(t,e,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var i=!1,r=t.return;r!==null;)r.childLanes|=s,n=r.alternate,n!==null&&(n.childLanes|=s),r.tag===22&&(t=r.stateNode,t===null||t._visibility&1||(i=!0)),t=r,r=r.return;return t.tag===3?(r=t.stateNode,i&&e!==null&&(i=31-rn(s),t=r.hiddenUpdates,n=t[i],n===null?t[i]=[e]:n.push(e),e.lane=s|536870912),r):null}function Sf(t){if(50<vu)throw vu=0,px=null,Error(X(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var rl={};function f4(t,e,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xs(t,e,s,n){return new f4(t,e,s,n)}function ov(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Bi(t,e){var s=t.alternate;return s===null?(s=Xs(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function jE(t,e){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Yh(t,e,s,n,i,r){var a=0;if(n=t,typeof t=="function")ov(t)&&(a=1);else if(typeof t=="string")a=bD(t,s,oi.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Dg:return t=Xs(31,s,e,i),t.elementType=Dg,t.lanes=r,t;case Qo:return to(s.children,i,r,e);case WT:a=8,i|=24;break;case Ig:return t=Xs(12,s,e,i|2),t.elementType=Ig,t.lanes=r,t;case Og:return t=Xs(13,s,e,i),t.elementType=Og,t.lanes=r,t;case Mg:return t=Xs(19,s,e,i),t.elementType=Mg,t.lanes=r,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Oi:a=10;break e;case YT:a=9;break e;case Kb:a=11;break e;case Wb:a=14;break e;case Nr:a=16,n=null;break e}a=29,s=Error(X(130,t===null?"null":typeof t,"")),n=null}return e=Xs(a,s,e,i),e.elementType=t,e.type=n,e.lanes=r,e}function to(t,e,s,n){return t=Xs(7,t,n,e),t.lanes=s,t}function k0(t,e,s){return t=Xs(6,t,null,e),t.lanes=s,t}function CE(t){var e=Xs(18,null,null,0);return e.stateNode=t,e}function N0(t,e,s){return e=Xs(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var Q1=new WeakMap;function bn(t,e){if(typeof t=="object"&&t!==null){var s=Q1.get(t);return s!==void 0?s:(e={value:t,source:e,stack:R1(e)},Q1.set(t,e),e)}return{value:t,source:e,stack:R1(e)}}var al=[],ol=0,Tf=null,Vu=0,pn=[],gn=0,oa=null,ii=1,ri="";function Ri(t,e){al[ol++]=Vu,al[ol++]=Tf,Tf=t,Vu=e}function RE(t,e,s){pn[gn++]=ii,pn[gn++]=ri,pn[gn++]=oa,oa=t;var n=ii;t=ri;var i=32-rn(n)-1;n&=~(1<<i),s+=1;var r=32-rn(e)+i;if(30<r){var a=i-i%5;r=(n&(1<<a)-1).toString(32),n>>=a,i-=a,ii=1<<32-rn(e)+i|s<<i|n,ri=r+t}else ii=1<<r|s<<i|n,ri=t}function lv(t){t.return!==null&&(Ri(t,1),RE(t,1,0))}function cv(t){for(;t===Tf;)Tf=al[--ol],al[ol]=null,Vu=al[--ol],al[ol]=null;for(;t===oa;)oa=pn[--gn],pn[gn]=null,ri=pn[--gn],pn[gn]=null,ii=pn[--gn],pn[gn]=null}function IE(t,e){pn[gn++]=ii,pn[gn++]=ri,pn[gn++]=oa,ii=e.id,ri=e.overflow,oa=t}var fs=null,pt=null,Ve=!1,zr=null,vn=!1,Yg=Error(X(519));function la(t){var e=Error(X(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Fu(bn(e,t)),Yg}function J1(t){var e=t.stateNode,s=t.type,n=t.memoizedProps;switch(e[hs]=t,e[$s]=n,s){case"dialog":je("cancel",e),je("close",e);break;case"iframe":case"object":case"embed":je("load",e);break;case"video":case"audio":for(s=0;s<Gu.length;s++)je(Gu[s],e);break;case"source":je("error",e);break;case"img":case"image":case"link":je("error",e),je("load",e);break;case"details":je("toggle",e);break;case"input":je("invalid",e),lE(e,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":je("invalid",e);break;case"textarea":je("invalid",e),uE(e,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||e.textContent===""+s||n.suppressHydrationWarning===!0||mA(e.textContent,s)?(n.popover!=null&&(je("beforetoggle",e),je("toggle",e)),n.onScroll!=null&&je("scroll",e),n.onScrollEnd!=null&&je("scrollend",e),n.onClick!=null&&(e.onclick=Mi),e=!0):e=!1,e||la(t,!0)}function Z1(t){for(fs=t.return;fs;)switch(fs.tag){case 5:case 31:case 13:vn=!1;return;case 27:case 3:vn=!0;return;default:fs=fs.return}}function Uo(t){if(t!==fs)return!1;if(!Ve)return Z1(t),Ve=!0,!1;var e=t.tag,s;if((s=e!==3&&e!==27)&&((s=e===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||yx(t.type,t.memoizedProps)),s=!s),s&&pt&&la(t),Z1(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));pt=Fw(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));pt=Fw(t)}else e===27?(e=pt,Ta(t.type)?(t=Nx,Nx=null,pt=t):pt=e):pt=fs?Nn(t.stateNode.nextSibling):null;return!0}function uo(){pt=fs=null,Ve=!1}function S0(){var t=zr;return t!==null&&(Ds===null?Ds=t:Ds.push.apply(Ds,t),zr=null),t}function Fu(t){zr===null?zr=[t]:zr.push(t)}var Xg=gi(null),Ro=null,Di=null;function Er(t,e,s){ut(Xg,e._currentValue),e._currentValue=s}function Ui(t){t._currentValue=Xg.current,as(Xg)}function Qg(t,e,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===s)break;t=t.return}}function Jg(t,e,s,n){var i=t.child;for(i!==null&&(i.return=t);i!==null;){var r=i.dependencies;if(r!==null){var a=i.child;r=r.firstContext;e:for(;r!==null;){var l=r;r=i;for(var c=0;c<e.length;c++)if(l.context===e[c]){r.lanes|=s,l=r.alternate,l!==null&&(l.lanes|=s),Qg(r.return,s,t),n||(a=null);break e}r=l.next}}else if(i.tag===18){if(a=i.return,a===null)throw Error(X(341));a.lanes|=s,r=a.alternate,r!==null&&(r.lanes|=s),Qg(a,s,t),a=null}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}}function fc(t,e,s,n){t=null;for(var i=e,r=!1;i!==null;){if(!r){if(i.flags&524288)r=!0;else if(i.flags&262144)break}if(i.tag===10){var a=i.alternate;if(a===null)throw Error(X(387));if(a=a.memoizedProps,a!==null){var l=i.type;ln(i.pendingProps.value,a.value)||(t!==null?t.push(l):t=[l])}}else if(i===vf.current){if(a=i.alternate,a===null)throw Error(X(387));a.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(t!==null?t.push(zu):t=[zu])}i=i.return}t!==null&&Jg(e,t,s,n),e.flags|=262144}function Ef(t){for(t=t.firstContext;t!==null;){if(!ln(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function ho(t){Ro=t,Di=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ps(t){return OE(Ro,t)}function _h(t,e){return Ro===null&&ho(t),OE(t,e)}function OE(t,e){var s=e._currentValue;if(e={context:e,memoizedValue:s,next:null},Di===null){if(t===null)throw Error(X(308));Di=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else Di=Di.next=e;return s}var m4=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){e.aborted=!0,t.forEach(function(s){return s()})}},p4=Jt.unstable_scheduleCallback,g4=Jt.unstable_NormalPriority,zt={$$typeof:Oi,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function uv(){return{controller:new m4,data:new Map,refCount:0}}function Ad(t){t.refCount--,t.refCount===0&&p4(g4,function(){t.controller.abort()})}var du=null,Zg=0,Fl=0,kl=null;function x4(t,e){if(du===null){var s=du=[];Zg=0,Fl=Dv(),kl={status:"pending",value:void 0,then:function(n){s.push(n)}}}return Zg++,e.then(ew,ew),e}function ew(){if(--Zg===0&&du!==null){kl!==null&&(kl.status="fulfilled");var t=du;du=null,Fl=0,kl=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function b4(t,e){var s=[],n={status:"pending",value:null,reason:null,then:function(i){s.push(i)}};return t.then(function(){n.status="fulfilled",n.value=e;for(var i=0;i<s.length;i++)(0,s[i])(e)},function(i){for(n.status="rejected",n.reason=i,i=0;i<s.length;i++)(0,s[i])(void 0)}),n}var tw=ye.S;ye.S=function(t,e){K2=sn(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&x4(t,e),tw!==null&&tw(t,e)};var so=gi(null);function dv(){var t=so.current;return t!==null?t:lt.pooledCache}function Xh(t,e){e===null?ut(so,so.current):ut(so,e.pool)}function ME(){var t=dv();return t===null?null:{parent:zt._currentValue,pool:t}}var mc=Error(X(460)),hv=Error(X(474)),sp=Error(X(542)),Af={then:function(){}};function sw(t){return t=t.status,t==="fulfilled"||t==="rejected"}function DE(t,e,s){switch(s=t[s],s===void 0?t.push(e):s!==e&&(e.then(Mi,Mi),e=s),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,iw(t),t;default:if(typeof e.status=="string")e.then(Mi,Mi);else{if(t=lt,t!==null&&100<t.shellSuspendCounter)throw Error(X(482));t=e,t.status="pending",t.then(function(n){if(e.status==="pending"){var i=e;i.status="fulfilled",i.value=n}},function(n){if(e.status==="pending"){var i=e;i.status="rejected",i.reason=n}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,iw(t),t}throw no=e,mc}}function $a(t){try{var e=t._init;return e(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(no=s,mc):s}}var no=null;function nw(){if(no===null)throw Error(X(459));var t=no;return no=null,t}function iw(t){if(t===mc||t===sp)throw Error(X(483))}var Nl=null,Bu=0;function wh(t){var e=Bu;return Bu+=1,Nl===null&&(Nl=[]),DE(Nl,t,e)}function Gc(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function kh(t,e){throw e.$$typeof===iM?Error(X(525)):(t=Object.prototype.toString.call(e),Error(X(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function LE(t){function e(x,g){if(t){var y=x.deletions;y===null?(x.deletions=[g],x.flags|=16):y.push(g)}}function s(x,g){if(!t)return null;for(;g!==null;)e(x,g),g=g.sibling;return null}function n(x){for(var g=new Map;x!==null;)x.key!==null?g.set(x.key,x):g.set(x.index,x),x=x.sibling;return g}function i(x,g){return x=Bi(x,g),x.index=0,x.sibling=null,x}function r(x,g,y){return x.index=y,t?(y=x.alternate,y!==null?(y=y.index,y<g?(x.flags|=67108866,g):y):(x.flags|=67108866,g)):(x.flags|=1048576,g)}function a(x){return t&&x.alternate===null&&(x.flags|=67108866),x}function l(x,g,y,w){return g===null||g.tag!==6?(g=k0(y,x.mode,w),g.return=x,g):(g=i(g,y),g.return=x,g)}function c(x,g,y,w){var k=y.type;return k===Qo?d(x,g,y.props.children,w,y.key):g!==null&&(g.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Nr&&$a(k)===g.type)?(g=i(g,y.props),Gc(g,y),g.return=x,g):(g=Yh(y.type,y.key,y.props,null,x.mode,w),Gc(g,y),g.return=x,g)}function u(x,g,y,w){return g===null||g.tag!==4||g.stateNode.containerInfo!==y.containerInfo||g.stateNode.implementation!==y.implementation?(g=N0(y,x.mode,w),g.return=x,g):(g=i(g,y.children||[]),g.return=x,g)}function d(x,g,y,w,k){return g===null||g.tag!==7?(g=to(y,x.mode,w,k),g.return=x,g):(g=i(g,y),g.return=x,g)}function h(x,g,y){if(typeof g=="string"&&g!==""||typeof g=="number"||typeof g=="bigint")return g=k0(""+g,x.mode,y),g.return=x,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ph:return y=Yh(g.type,g.key,g.props,null,x.mode,y),Gc(y,g),y.return=x,y;case Jc:return g=N0(g,x.mode,y),g.return=x,g;case Nr:return g=$a(g),h(x,g,y)}if(Zc(g)||Bc(g))return g=to(g,x.mode,y,null),g.return=x,g;if(typeof g.then=="function")return h(x,wh(g),y);if(g.$$typeof===Oi)return h(x,_h(x,g),y);kh(x,g)}return null}function f(x,g,y,w){var k=g!==null?g.key:null;if(typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint")return k!==null?null:l(x,g,""+y,w);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ph:return y.key===k?c(x,g,y,w):null;case Jc:return y.key===k?u(x,g,y,w):null;case Nr:return y=$a(y),f(x,g,y,w)}if(Zc(y)||Bc(y))return k!==null?null:d(x,g,y,w,null);if(typeof y.then=="function")return f(x,g,wh(y),w);if(y.$$typeof===Oi)return f(x,g,_h(x,y),w);kh(x,y)}return null}function m(x,g,y,w,k){if(typeof w=="string"&&w!==""||typeof w=="number"||typeof w=="bigint")return x=x.get(y)||null,l(g,x,""+w,k);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ph:return x=x.get(w.key===null?y:w.key)||null,c(g,x,w,k);case Jc:return x=x.get(w.key===null?y:w.key)||null,u(g,x,w,k);case Nr:return w=$a(w),m(x,g,y,w,k)}if(Zc(w)||Bc(w))return x=x.get(y)||null,d(g,x,w,k,null);if(typeof w.then=="function")return m(x,g,y,wh(w),k);if(w.$$typeof===Oi)return m(x,g,y,_h(g,w),k);kh(g,w)}return null}function b(x,g,y,w){for(var k=null,N=null,_=g,T=g=0,E=null;_!==null&&T<y.length;T++){_.index>T?(E=_,_=null):E=_.sibling;var A=f(x,_,y[T],w);if(A===null){_===null&&(_=E);break}t&&_&&A.alternate===null&&e(x,_),g=r(A,g,T),N===null?k=A:N.sibling=A,N=A,_=E}if(T===y.length)return s(x,_),Ve&&Ri(x,T),k;if(_===null){for(;T<y.length;T++)_=h(x,y[T],w),_!==null&&(g=r(_,g,T),N===null?k=_:N.sibling=_,N=_);return Ve&&Ri(x,T),k}for(_=n(_);T<y.length;T++)E=m(_,x,T,y[T],w),E!==null&&(t&&E.alternate!==null&&_.delete(E.key===null?T:E.key),g=r(E,g,T),N===null?k=E:N.sibling=E,N=E);return t&&_.forEach(function(R){return e(x,R)}),Ve&&Ri(x,T),k}function p(x,g,y,w){if(y==null)throw Error(X(151));for(var k=null,N=null,_=g,T=g=0,E=null,A=y.next();_!==null&&!A.done;T++,A=y.next()){_.index>T?(E=_,_=null):E=_.sibling;var R=f(x,_,A.value,w);if(R===null){_===null&&(_=E);break}t&&_&&R.alternate===null&&e(x,_),g=r(R,g,T),N===null?k=R:N.sibling=R,N=R,_=E}if(A.done)return s(x,_),Ve&&Ri(x,T),k;if(_===null){for(;!A.done;T++,A=y.next())A=h(x,A.value,w),A!==null&&(g=r(A,g,T),N===null?k=A:N.sibling=A,N=A);return Ve&&Ri(x,T),k}for(_=n(_);!A.done;T++,A=y.next())A=m(_,x,T,A.value,w),A!==null&&(t&&A.alternate!==null&&_.delete(A.key===null?T:A.key),g=r(A,g,T),N===null?k=A:N.sibling=A,N=A);return t&&_.forEach(function(I){return e(x,I)}),Ve&&Ri(x,T),k}function v(x,g,y,w){if(typeof y=="object"&&y!==null&&y.type===Qo&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case ph:e:{for(var k=y.key;g!==null;){if(g.key===k){if(k=y.type,k===Qo){if(g.tag===7){s(x,g.sibling),w=i(g,y.props.children),w.return=x,x=w;break e}}else if(g.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Nr&&$a(k)===g.type){s(x,g.sibling),w=i(g,y.props),Gc(w,y),w.return=x,x=w;break e}s(x,g);break}else e(x,g);g=g.sibling}y.type===Qo?(w=to(y.props.children,x.mode,w,y.key),w.return=x,x=w):(w=Yh(y.type,y.key,y.props,null,x.mode,w),Gc(w,y),w.return=x,x=w)}return a(x);case Jc:e:{for(k=y.key;g!==null;){if(g.key===k)if(g.tag===4&&g.stateNode.containerInfo===y.containerInfo&&g.stateNode.implementation===y.implementation){s(x,g.sibling),w=i(g,y.children||[]),w.return=x,x=w;break e}else{s(x,g);break}else e(x,g);g=g.sibling}w=N0(y,x.mode,w),w.return=x,x=w}return a(x);case Nr:return y=$a(y),v(x,g,y,w)}if(Zc(y))return b(x,g,y,w);if(Bc(y)){if(k=Bc(y),typeof k!="function")throw Error(X(150));return y=k.call(y),p(x,g,y,w)}if(typeof y.then=="function")return v(x,g,wh(y),w);if(y.$$typeof===Oi)return v(x,g,_h(x,y),w);kh(x,y)}return typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint"?(y=""+y,g!==null&&g.tag===6?(s(x,g.sibling),w=i(g,y),w.return=x,x=w):(s(x,g),w=k0(y,x.mode,w),w.return=x,x=w),a(x)):s(x,g)}return function(x,g,y,w){try{Bu=0;var k=v(x,g,y,w);return Nl=null,k}catch(_){if(_===mc||_===sp)throw _;var N=Xs(29,_,null,x.mode);return N.lanes=w,N.return=x,N}finally{}}}var fo=LE(!0),PE=LE(!1),Sr=!1;function fv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ex(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function qr(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Kr(t,e,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Ue&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,e=Sf(t),AE(t,null,s),e}return tp(t,n,e,s),Sf(t)}function hu(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194048)!==0)){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,tE(t,s)}}function T0(t,e){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var i=null,r=null;if(s=s.firstBaseUpdate,s!==null){do{var a={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};r===null?i=r=a:r=r.next=a,s=s.next}while(s!==null);r===null?i=r=e:r=r.next=e}else i=r=e;s={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}var tx=!1;function fu(){if(tx){var t=kl;if(t!==null)throw t}}function mu(t,e,s,n){tx=!1;var i=t.updateQueue;Sr=!1;var r=i.firstBaseUpdate,a=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,u=c.next;c.next=null,a===null?r=u:a.next=u,a=c;var d=t.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==a&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(r!==null){var h=i.baseState;a=0,d=u=c=null,l=r;do{var f=l.lane&-536870913,m=f!==l.lane;if(m?(Me&f)===f:(n&f)===f){f!==0&&f===Fl&&(tx=!0),d!==null&&(d=d.next={lane:0,tag:l.tag,payload:l.payload,callback:null,next:null});e:{var b=t,p=l;f=e;var v=s;switch(p.tag){case 1:if(b=p.payload,typeof b=="function"){h=b.call(v,h,f);break e}h=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=p.payload,f=typeof b=="function"?b.call(v,h,f):b,f==null)break e;h=vt({},h,f);break e;case 2:Sr=!0}}f=l.callback,f!==null&&(t.flags|=64,m&&(t.flags|=8192),m=i.callbacks,m===null?i.callbacks=[f]:m.push(f))}else m={lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=m,c=h):d=d.next=m,a|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;m=l,l=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(!0);d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=d,r===null&&(i.shared.lanes=0),ua|=a,t.lanes=a,t.memoizedState=h}}function VE(t,e){if(typeof t!="function")throw Error(X(191,t));t.call(e)}function FE(t,e){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)VE(s[t],e)}var Bl=gi(null),jf=gi(0);function rw(t,e){t=Zi,ut(jf,t),ut(Bl,e),Zi=t|e.baseLanes}function sx(){ut(jf,Zi),ut(Bl,Bl.current)}function mv(){Zi=jf.current,as(Bl),as(jf)}var cn=gi(null),kn=null;function Ar(t){var e=t.alternate;ut(Lt,Lt.current&1),ut(cn,t),kn===null&&(e===null||Bl.current!==null||e.memoizedState!==null)&&(kn=t)}function nx(t){ut(Lt,Lt.current),ut(cn,t),kn===null&&(kn=t)}function BE(t){t.tag===22?(ut(Lt,Lt.current),ut(cn,t),kn===null&&(kn=t)):jr()}function jr(){ut(Lt,Lt.current),ut(cn,cn.current)}function Ws(t){as(cn),kn===t&&(kn=null),as(Lt)}var Lt=gi(0);function Cf(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||wx(s)||kx(s)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Xi=0,ke=null,it=null,Gt=null,Rf=!1,Sl=!1,mo=!1,If=0,Uu=0,Tl=null,v4=0;function Ct(){throw Error(X(321))}function pv(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!ln(t[s],e[s]))return!1;return!0}function gv(t,e,s,n,i,r){return Xi=r,ke=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ye.H=t===null||t.memoizedState===null?x2:Ev,mo=!1,r=s(n,i),mo=!1,Sl&&(r=$E(e,s,n,i)),UE(t),r}function UE(t){ye.H=$u;var e=it!==null&&it.next!==null;if(Xi=0,Gt=it=ke=null,Rf=!1,Uu=0,Tl=null,e)throw Error(X(300));t===null||qt||(t=t.dependencies,t!==null&&Ef(t)&&(qt=!0))}function $E(t,e,s,n){ke=t;var i=0;do{if(Sl&&(Tl=null),Uu=0,Sl=!1,25<=i)throw Error(X(301));if(i+=1,Gt=it=null,t.updateQueue!=null){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,r.memoCache!=null&&(r.memoCache.index=0)}ye.H=b2,r=e(s,n)}while(Sl);return r}function y4(){var t=ye.H,e=t.useState()[0];return e=typeof e.then=="function"?jd(e):e,t=t.useState()[0],(it!==null?it.memoizedState:null)!==t&&(ke.flags|=1024),e}function xv(){var t=If!==0;return If=0,t}function bv(t,e,s){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s}function vv(t){if(Rf){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Rf=!1}Xi=0,Gt=it=ke=null,Sl=!1,Uu=If=0,Tl=null}function ys(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?ke.memoizedState=Gt=t:Gt=Gt.next=t,Gt}function Vt(){if(it===null){var t=ke.alternate;t=t!==null?t.memoizedState:null}else t=it.next;var e=Gt===null?ke.memoizedState:Gt.next;if(e!==null)Gt=e,it=t;else{if(t===null)throw ke.alternate===null?Error(X(467)):Error(X(310));it=t,t={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},Gt===null?ke.memoizedState=Gt=t:Gt=Gt.next=t}return Gt}function np(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function jd(t){var e=Uu;return Uu+=1,Tl===null&&(Tl=[]),t=DE(Tl,t,e),e=ke,(Gt===null?e.memoizedState:Gt.next)===null&&(e=e.alternate,ye.H=e===null||e.memoizedState===null?x2:Ev),t}function ip(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return jd(t);if(t.$$typeof===Oi)return ps(t)}throw Error(X(438,String(t)))}function yv(t){var e=null,s=ke.updateQueue;if(s!==null&&(e=s.memoCache),e==null){var n=ke.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(e={data:n.data.map(function(i){return i.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),s===null&&(s=np(),ke.updateQueue=s),s.memoCache=e,s=e.data[e.index],s===void 0)for(s=e.data[e.index]=Array(t),n=0;n<t;n++)s[n]=rM;return e.index++,s}function Qi(t,e){return typeof e=="function"?e(t):e}function Qh(t){var e=Vt();return _v(e,it,t)}function _v(t,e,s){var n=t.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=s;var i=t.baseQueue,r=n.pending;if(r!==null){if(i!==null){var a=i.next;i.next=r.next,r.next=a}e.baseQueue=i=r,n.pending=null}if(r=t.baseState,i===null)t.memoizedState=r;else{e=i.next;var l=a=null,c=null,u=e,d=!1;do{var h=u.lane&-536870913;if(h!==u.lane?(Me&h)===h:(Xi&h)===h){var f=u.revertLane;if(f===0)c!==null&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Fl&&(d=!0);else if((Xi&f)===f){u=u.next,f===Fl&&(d=!0);continue}else h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},c===null?(l=c=h,a=r):c=c.next=h,ke.lanes|=f,ua|=f;h=u.action,mo&&s(r,h),r=u.hasEagerState?u.eagerState:s(r,h)}else f={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},c===null?(l=c=f,a=r):c=c.next=f,ke.lanes|=h,ua|=h;u=u.next}while(u!==null&&u!==e);if(c===null?a=r:c.next=l,!ln(r,t.memoizedState)&&(qt=!0,d&&(s=kl,s!==null)))throw s;t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}return i===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function E0(t){var e=Vt(),s=e.queue;if(s===null)throw Error(X(311));s.lastRenderedReducer=t;var n=s.dispatch,i=s.pending,r=e.memoizedState;if(i!==null){s.pending=null;var a=i=i.next;do r=t(r,a.action),a=a.next;while(a!==i);ln(r,e.memoizedState)||(qt=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),s.lastRenderedState=r}return[r,n]}function GE(t,e,s){var n=ke,i=Vt(),r=Ve;if(r){if(s===void 0)throw Error(X(407));s=s()}else s=e();var a=!ln((it||i).memoizedState,s);if(a&&(i.memoizedState=s,qt=!0),i=i.queue,wv(qE.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||Gt!==null&&Gt.memoizedState.tag&1){if(n.flags|=2048,Ul(9,{destroy:void 0},zE.bind(null,n,i,s,e),null),lt===null)throw Error(X(349));r||Xi&127||HE(n,e,s)}return s}function HE(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=ke.updateQueue,e===null?(e=np(),ke.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function zE(t,e,s,n){e.value=s,e.getSnapshot=n,KE(e)&&WE(t)}function qE(t,e,s){return s(function(){KE(e)&&WE(t)})}function KE(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!ln(t,s)}catch{return!0}}function WE(t){var e=Co(t,2);e!==null&&Fs(e,t,2)}function ix(t){var e=ys();if(typeof t=="function"){var s=t;if(t=s(),mo){Dr(!0);try{s()}finally{Dr(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:t},e}function YE(t,e,s,n){return t.baseState=s,_v(t,it,typeof n=="function"?n:Qi)}function _4(t,e,s,n,i){if(ap(t))throw Error(X(485));if(t=e.action,t!==null){var r={payload:i,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){r.listeners.push(a)}};ye.T!==null?s(!0):r.isTransition=!1,n(r),s=e.pending,s===null?(r.next=e.pending=r,XE(e,r)):(r.next=s.next,e.pending=s.next=r)}}function XE(t,e){var s=e.action,n=e.payload,i=t.state;if(e.isTransition){var r=ye.T,a={};ye.T=a;try{var l=s(i,n),c=ye.S;c!==null&&c(a,l),aw(t,e,l)}catch(u){rx(t,e,u)}finally{r!==null&&a.types!==null&&(r.types=a.types),ye.T=r}}else try{r=s(i,n),aw(t,e,r)}catch(u){rx(t,e,u)}}function aw(t,e,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){ow(t,e,n)},function(n){return rx(t,e,n)}):ow(t,e,s)}function ow(t,e,s){e.status="fulfilled",e.value=s,QE(e),t.state=s,e=t.pending,e!==null&&(s=e.next,s===e?t.pending=null:(s=s.next,e.next=s,XE(t,s)))}function rx(t,e,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do e.status="rejected",e.reason=s,QE(e),e=e.next;while(e!==n)}t.action=null}function QE(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function JE(t,e){return e}function lw(t,e){if(Ve){var s=lt.formState;if(s!==null){e:{var n=ke;if(Ve){if(pt){t:{for(var i=pt,r=vn;i.nodeType!==8;){if(!r){i=null;break t}if(i=Nn(i.nextSibling),i===null){i=null;break t}}r=i.data,i=r==="F!"||r==="F"?i:null}if(i){pt=Nn(i.nextSibling),n=i.data==="F!";break e}}la(n)}n=!1}n&&(e=s[0])}}return s=ys(),s.memoizedState=s.baseState=e,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:JE,lastRenderedState:e},s.queue=n,s=m2.bind(null,ke,n),n.dispatch=s,n=ix(!1),r=Tv.bind(null,ke,!1,n.queue),n=ys(),i={state:e,dispatch:null,action:t,pending:null},n.queue=i,s=_4.bind(null,ke,i,r,s),i.dispatch=s,n.memoizedState=t,[e,s,!1]}function cw(t){var e=Vt();return ZE(e,it,t)}function ZE(t,e,s){if(e=_v(t,e,JE)[0],t=Qh(Qi)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var n=jd(e)}catch(a){throw a===mc?sp:a}else n=e;e=Vt();var i=e.queue,r=i.dispatch;return s!==e.memoizedState&&(ke.flags|=2048,Ul(9,{destroy:void 0},w4.bind(null,i,s),null)),[n,r,t]}function w4(t,e){t.action=e}function uw(t){var e=Vt(),s=it;if(s!==null)return ZE(e,s,t);Vt(),e=e.memoizedState,s=Vt();var n=s.queue.dispatch;return s.memoizedState=t,[e,n,!1]}function Ul(t,e,s,n){return t={tag:t,create:s,deps:n,inst:e,next:null},e=ke.updateQueue,e===null&&(e=np(),ke.updateQueue=e),s=e.lastEffect,s===null?e.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,e.lastEffect=t),t}function e2(){return Vt().memoizedState}function Jh(t,e,s,n){var i=ys();ke.flags|=t,i.memoizedState=Ul(1|e,{destroy:void 0},s,n===void 0?null:n)}function rp(t,e,s,n){var i=Vt();n=n===void 0?null:n;var r=i.memoizedState.inst;it!==null&&n!==null&&pv(n,it.memoizedState.deps)?i.memoizedState=Ul(e,r,s,n):(ke.flags|=t,i.memoizedState=Ul(1|e,r,s,n))}function dw(t,e){Jh(8390656,8,t,e)}function wv(t,e){rp(2048,8,t,e)}function k4(t){ke.flags|=4;var e=ke.updateQueue;if(e===null)e=np(),ke.updateQueue=e,e.events=[t];else{var s=e.events;s===null?e.events=[t]:s.push(t)}}function t2(t){var e=Vt().memoizedState;return k4({ref:e,nextImpl:t}),function(){if(Ue&2)throw Error(X(440));return e.impl.apply(void 0,arguments)}}function s2(t,e){return rp(4,2,t,e)}function n2(t,e){return rp(4,4,t,e)}function i2(t,e){if(typeof e=="function"){t=t();var s=e(t);return function(){typeof s=="function"?s():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function r2(t,e,s){s=s!=null?s.concat([t]):null,rp(4,4,i2.bind(null,e,t),s)}function kv(){}function a2(t,e){var s=Vt();e=e===void 0?null:e;var n=s.memoizedState;return e!==null&&pv(e,n[1])?n[0]:(s.memoizedState=[t,e],t)}function o2(t,e){var s=Vt();e=e===void 0?null:e;var n=s.memoizedState;if(e!==null&&pv(e,n[1]))return n[0];if(n=t(),mo){Dr(!0);try{t()}finally{Dr(!1)}}return s.memoizedState=[n,e],n}function Nv(t,e,s){return s===void 0||Xi&1073741824&&!(Me&261930)?t.memoizedState=e:(t.memoizedState=s,t=Y2(),ke.lanes|=t,ua|=t,s)}function l2(t,e,s,n){return ln(s,e)?s:Bl.current!==null?(t=Nv(t,s,n),ln(t,e)||(qt=!0),t):!(Xi&42)||Xi&1073741824&&!(Me&261930)?(qt=!0,t.memoizedState=s):(t=Y2(),ke.lanes|=t,ua|=t,e)}function c2(t,e,s,n,i){var r=$e.p;$e.p=r!==0&&8>r?r:8;var a=ye.T,l={};ye.T=l,Tv(t,!1,e,s);try{var c=i(),u=ye.S;if(u!==null&&u(l,c),c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=b4(c,n);pu(t,e,d,an(t))}else pu(t,e,n,an(t))}catch(h){pu(t,e,{then:function(){},status:"rejected",reason:h},an())}finally{$e.p=r,a!==null&&l.types!==null&&(a.types=l.types),ye.T=a}}function N4(){}function ax(t,e,s,n){if(t.tag!==5)throw Error(X(476));var i=u2(t).queue;c2(t,i,e,eo,s===null?N4:function(){return d2(t),s(n)})}function u2(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:eo,baseState:eo,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:eo},next:null};var s={};return e.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qi,lastRenderedState:s},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function d2(t){var e=u2(t);e.next===null&&(e=t.alternate.memoizedState),pu(t,e.next.queue,{},an())}function Sv(){return ps(zu)}function h2(){return Vt().memoizedState}function f2(){return Vt().memoizedState}function S4(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var s=an();t=qr(s);var n=Kr(e,t,s);n!==null&&(Fs(n,e,s),hu(n,e,s)),e={cache:uv()},t.payload=e;return}e=e.return}}function T4(t,e,s){var n=an();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ap(t)?p2(e,s):(s=av(t,e,s,n),s!==null&&(Fs(s,t,n),g2(s,e,n)))}function m2(t,e,s){var n=an();pu(t,e,s,n)}function pu(t,e,s,n){var i={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(ap(t))p2(e,i);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,l=r(a,s);if(i.hasEagerState=!0,i.eagerState=l,ln(l,a))return tp(t,e,i,0),lt===null&&ep(),!1}catch{}finally{}if(s=av(t,e,i,n),s!==null)return Fs(s,t,n),g2(s,e,n),!0}return!1}function Tv(t,e,s,n){if(n={lane:2,revertLane:Dv(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ap(t)){if(e)throw Error(X(479))}else e=av(t,s,n,2),e!==null&&Fs(e,t,2)}function ap(t){var e=t.alternate;return t===ke||e!==null&&e===ke}function p2(t,e){Sl=Rf=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function g2(t,e,s){if(s&4194048){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,tE(t,s)}}var $u={readContext:ps,use:ip,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useLayoutEffect:Ct,useInsertionEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useSyncExternalStore:Ct,useId:Ct,useHostTransitionStatus:Ct,useFormState:Ct,useActionState:Ct,useOptimistic:Ct,useMemoCache:Ct,useCacheRefresh:Ct};$u.useEffectEvent=Ct;var x2={readContext:ps,use:ip,useCallback:function(t,e){return ys().memoizedState=[t,e===void 0?null:e],t},useContext:ps,useEffect:dw,useImperativeHandle:function(t,e,s){s=s!=null?s.concat([t]):null,Jh(4194308,4,i2.bind(null,e,t),s)},useLayoutEffect:function(t,e){return Jh(4194308,4,t,e)},useInsertionEffect:function(t,e){Jh(4,2,t,e)},useMemo:function(t,e){var s=ys();e=e===void 0?null:e;var n=t();if(mo){Dr(!0);try{t()}finally{Dr(!1)}}return s.memoizedState=[n,e],n},useReducer:function(t,e,s){var n=ys();if(s!==void 0){var i=s(e);if(mo){Dr(!0);try{s(e)}finally{Dr(!1)}}}else i=e;return n.memoizedState=n.baseState=i,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},n.queue=t,t=t.dispatch=T4.bind(null,ke,t),[n.memoizedState,t]},useRef:function(t){var e=ys();return t={current:t},e.memoizedState=t},useState:function(t){t=ix(t);var e=t.queue,s=m2.bind(null,ke,e);return e.dispatch=s,[t.memoizedState,s]},useDebugValue:kv,useDeferredValue:function(t,e){var s=ys();return Nv(s,t,e)},useTransition:function(){var t=ix(!1);return t=c2.bind(null,ke,t.queue,!0,!1),ys().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,s){var n=ke,i=ys();if(Ve){if(s===void 0)throw Error(X(407));s=s()}else{if(s=e(),lt===null)throw Error(X(349));Me&127||HE(n,e,s)}i.memoizedState=s;var r={value:s,getSnapshot:e};return i.queue=r,dw(qE.bind(null,n,r,t),[t]),n.flags|=2048,Ul(9,{destroy:void 0},zE.bind(null,n,r,s,e),null),s},useId:function(){var t=ys(),e=lt.identifierPrefix;if(Ve){var s=ri,n=ii;s=(n&~(1<<32-rn(n)-1)).toString(32)+s,e="_"+e+"R_"+s,s=If++,0<s&&(e+="H"+s.toString(32)),e+="_"}else s=v4++,e="_"+e+"r_"+s.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:Sv,useFormState:lw,useActionState:lw,useOptimistic:function(t){var e=ys();e.memoizedState=e.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=s,e=Tv.bind(null,ke,!0,s),s.dispatch=e,[t,e]},useMemoCache:yv,useCacheRefresh:function(){return ys().memoizedState=S4.bind(null,ke)},useEffectEvent:function(t){var e=ys(),s={impl:t};return e.memoizedState=s,function(){if(Ue&2)throw Error(X(440));return s.impl.apply(void 0,arguments)}}},Ev={readContext:ps,use:ip,useCallback:a2,useContext:ps,useEffect:wv,useImperativeHandle:r2,useInsertionEffect:s2,useLayoutEffect:n2,useMemo:o2,useReducer:Qh,useRef:e2,useState:function(){return Qh(Qi)},useDebugValue:kv,useDeferredValue:function(t,e){var s=Vt();return l2(s,it.memoizedState,t,e)},useTransition:function(){var t=Qh(Qi)[0],e=Vt().memoizedState;return[typeof t=="boolean"?t:jd(t),e]},useSyncExternalStore:GE,useId:h2,useHostTransitionStatus:Sv,useFormState:cw,useActionState:cw,useOptimistic:function(t,e){var s=Vt();return YE(s,it,t,e)},useMemoCache:yv,useCacheRefresh:f2};Ev.useEffectEvent=t2;var b2={readContext:ps,use:ip,useCallback:a2,useContext:ps,useEffect:wv,useImperativeHandle:r2,useInsertionEffect:s2,useLayoutEffect:n2,useMemo:o2,useReducer:E0,useRef:e2,useState:function(){return E0(Qi)},useDebugValue:kv,useDeferredValue:function(t,e){var s=Vt();return it===null?Nv(s,t,e):l2(s,it.memoizedState,t,e)},useTransition:function(){var t=E0(Qi)[0],e=Vt().memoizedState;return[typeof t=="boolean"?t:jd(t),e]},useSyncExternalStore:GE,useId:h2,useHostTransitionStatus:Sv,useFormState:uw,useActionState:uw,useOptimistic:function(t,e){var s=Vt();return it!==null?YE(s,it,t,e):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:yv,useCacheRefresh:f2};b2.useEffectEvent=t2;function A0(t,e,s,n){e=t.memoizedState,s=s(n,e),s=s==null?e:vt({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var ox={enqueueSetState:function(t,e,s){t=t._reactInternals;var n=an(),i=qr(n);i.payload=e,s!=null&&(i.callback=s),e=Kr(t,i,n),e!==null&&(Fs(e,t,n),hu(e,t,n))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var n=an(),i=qr(n);i.tag=1,i.payload=e,s!=null&&(i.callback=s),e=Kr(t,i,n),e!==null&&(Fs(e,t,n),hu(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=an(),n=qr(s);n.tag=2,e!=null&&(n.callback=e),e=Kr(t,n,s),e!==null&&(Fs(e,t,s),hu(e,t,s))}};function hw(t,e,s,n,i,r,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,r,a):e.prototype&&e.prototype.isPureReactComponent?!Pu(s,n)||!Pu(i,r):!0}function fw(t,e,s,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,n),e.state!==t&&ox.enqueueReplaceState(e,e.state,null)}function po(t,e){var s=e;if("ref"in e){s={};for(var n in e)n!=="ref"&&(s[n]=e[n])}if(t=t.defaultProps){s===e&&(s=vt({},s));for(var i in t)s[i]===void 0&&(s[i]=t[i])}return s}function v2(t){Nf(t)}function y2(t){console.error(t)}function _2(t){Nf(t)}function Of(t,e){try{var s=t.onUncaughtError;s(e.value,{componentStack:e.stack})}catch(n){setTimeout(function(){throw n})}}function mw(t,e,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function lx(t,e,s){return s=qr(s),s.tag=3,s.payload={element:null},s.callback=function(){Of(t,e)},s}function w2(t){return t=qr(t),t.tag=3,t}function k2(t,e,s,n){var i=s.type.getDerivedStateFromError;if(typeof i=="function"){var r=n.value;t.payload=function(){return i(r)},t.callback=function(){mw(e,s,n)}}var a=s.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){mw(e,s,n),typeof i!="function"&&(Wr===null?Wr=new Set([this]):Wr.add(this));var l=n.stack;this.componentDidCatch(n.value,{componentStack:l!==null?l:""})})}function E4(t,e,s,n,i){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(e=s.alternate,e!==null&&fc(e,s,i,!0),s=cn.current,s!==null){switch(s.tag){case 31:case 13:return kn===null?Vf():s.alternate===null&&It===0&&(It=3),s.flags&=-257,s.flags|=65536,s.lanes=i,n===Af?s.flags|=16384:(e=s.updateQueue,e===null?s.updateQueue=new Set([n]):e.add(n),F0(t,n,i)),!1;case 22:return s.flags|=65536,n===Af?s.flags|=16384:(e=s.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=e):(s=e.retryQueue,s===null?e.retryQueue=new Set([n]):s.add(n)),F0(t,n,i)),!1}throw Error(X(435,s.tag))}return F0(t,n,i),Vf(),!1}if(Ve)return e=cn.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=i,n!==Yg&&(t=Error(X(422),{cause:n}),Fu(bn(t,s)))):(n!==Yg&&(e=Error(X(423),{cause:n}),Fu(bn(e,s))),t=t.current.alternate,t.flags|=65536,i&=-i,t.lanes|=i,n=bn(n,s),i=lx(t.stateNode,n,i),T0(t,i),It!==4&&(It=2)),!1;var r=Error(X(520),{cause:n});if(r=bn(r,s),bu===null?bu=[r]:bu.push(r),It!==4&&(It=2),e===null)return!0;n=bn(n,s),s=e;do{switch(s.tag){case 3:return s.flags|=65536,t=i&-i,s.lanes|=t,t=lx(s.stateNode,n,t),T0(s,t),!1;case 1:if(e=s.type,r=s.stateNode,(s.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||r!==null&&typeof r.componentDidCatch=="function"&&(Wr===null||!Wr.has(r))))return s.flags|=65536,i&=-i,s.lanes|=i,i=w2(i),k2(i,t,s,n),T0(s,i),!1}s=s.return}while(s!==null);return!1}var Av=Error(X(461)),qt=!1;function ds(t,e,s,n){e.child=t===null?PE(e,null,s,n):fo(e,t.child,s,n)}function pw(t,e,s,n,i){s=s.render;var r=e.ref;if("ref"in n){var a={};for(var l in n)l!=="ref"&&(a[l]=n[l])}else a=n;return ho(e),n=gv(t,e,s,a,r,i),l=xv(),t!==null&&!qt?(bv(t,e,i),Ji(t,e,i)):(Ve&&l&&lv(e),e.flags|=1,ds(t,e,n,i),e.child)}function gw(t,e,s,n,i){if(t===null){var r=s.type;return typeof r=="function"&&!ov(r)&&r.defaultProps===void 0&&s.compare===null?(e.tag=15,e.type=r,N2(t,e,r,n,i)):(t=Yh(s.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!jv(t,i)){var a=r.memoizedProps;if(s=s.compare,s=s!==null?s:Pu,s(a,n)&&t.ref===e.ref)return Ji(t,e,i)}return e.flags|=1,t=Bi(r,n),t.ref=e.ref,t.return=e,e.child=t}function N2(t,e,s,n,i){if(t!==null){var r=t.memoizedProps;if(Pu(r,n)&&t.ref===e.ref)if(qt=!1,e.pendingProps=n=r,jv(t,i))t.flags&131072&&(qt=!0);else return e.lanes=t.lanes,Ji(t,e,i)}return cx(t,e,s,n,i)}function S2(t,e,s,n){var i=n.children,r=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if(e.flags&128){if(r=r!==null?r.baseLanes|s:s,t!==null){for(n=e.child=t.child,i=0;n!==null;)i=i|n.lanes|n.childLanes,n=n.sibling;n=i&~r}else n=0,e.child=null;return xw(t,e,r,s,n)}if(s&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Xh(e,r!==null?r.cachePool:null),r!==null?rw(e,r):sx(),BE(e);else return n=e.lanes=536870912,xw(t,e,r!==null?r.baseLanes|s:s,s,n)}else r!==null?(Xh(e,r.cachePool),rw(e,r),jr(),e.memoizedState=null):(t!==null&&Xh(e,null),sx(),jr());return ds(t,e,i,s),e.child}function tu(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function xw(t,e,s,n,i){var r=dv();return r=r===null?null:{parent:zt._currentValue,pool:r},e.memoizedState={baseLanes:s,cachePool:r},t!==null&&Xh(e,null),sx(),BE(e),t!==null&&fc(t,e,n,!0),e.childLanes=i,null}function Zh(t,e){return e=Mf({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function bw(t,e,s){return fo(e,t.child,null,s),t=Zh(e,e.pendingProps),t.flags|=2,Ws(e),e.memoizedState=null,t}function A4(t,e,s){var n=e.pendingProps,i=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(Ve){if(n.mode==="hidden")return t=Zh(e,n),e.lanes=536870912,tu(null,t);if(nx(e),(t=pt)?(t=xA(t,vn),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:oa!==null?{id:ii,overflow:ri}:null,retryLane:536870912,hydrationErrors:null},s=CE(t),s.return=e,e.child=s,fs=e,pt=null)):t=null,t===null)throw la(e);return e.lanes=536870912,null}return Zh(e,n)}var r=t.memoizedState;if(r!==null){var a=r.dehydrated;if(nx(e),i)if(e.flags&256)e.flags&=-257,e=bw(t,e,s);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(X(558));else if(qt||fc(t,e,s,!1),i=(s&t.childLanes)!==0,qt||i){if(n=lt,n!==null&&(a=sE(n,s),a!==0&&a!==r.retryLane))throw r.retryLane=a,Co(t,a),Fs(n,t,a),Av;Vf(),e=bw(t,e,s)}else t=r.treeContext,pt=Nn(a.nextSibling),fs=e,Ve=!0,zr=null,vn=!1,t!==null&&IE(e,t),e=Zh(e,n),e.flags|=4096;return e}return t=Bi(t.child,{mode:n.mode,children:n.children}),t.ref=e.ref,e.child=t,t.return=e,t}function ef(t,e){var s=e.ref;if(s===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(X(284));(t===null||t.ref!==s)&&(e.flags|=4194816)}}function cx(t,e,s,n,i){return ho(e),s=gv(t,e,s,n,void 0,i),n=xv(),t!==null&&!qt?(bv(t,e,i),Ji(t,e,i)):(Ve&&n&&lv(e),e.flags|=1,ds(t,e,s,i),e.child)}function vw(t,e,s,n,i,r){return ho(e),e.updateQueue=null,s=$E(e,n,s,i),UE(t),n=xv(),t!==null&&!qt?(bv(t,e,r),Ji(t,e,r)):(Ve&&n&&lv(e),e.flags|=1,ds(t,e,s,r),e.child)}function yw(t,e,s,n,i){if(ho(e),e.stateNode===null){var r=rl,a=s.contextType;typeof a=="object"&&a!==null&&(r=ps(a)),r=new s(n,r),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=ox,e.stateNode=r,r._reactInternals=e,r=e.stateNode,r.props=n,r.state=e.memoizedState,r.refs={},fv(e),a=s.contextType,r.context=typeof a=="object"&&a!==null?ps(a):rl,r.state=e.memoizedState,a=s.getDerivedStateFromProps,typeof a=="function"&&(A0(e,s,a,n),r.state=e.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(a=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),a!==r.state&&ox.enqueueReplaceState(r,r.state,null),mu(e,n,r,i),fu(),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!0}else if(t===null){r=e.stateNode;var l=e.memoizedProps,c=po(s,l);r.props=c;var u=r.context,d=s.contextType;a=rl,typeof d=="object"&&d!==null&&(a=ps(d));var h=s.getDerivedStateFromProps;d=typeof h=="function"||typeof r.getSnapshotBeforeUpdate=="function",l=e.pendingProps!==l,d||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(l||u!==a)&&fw(e,r,n,a),Sr=!1;var f=e.memoizedState;r.state=f,mu(e,n,r,i),fu(),u=e.memoizedState,l||f!==u||Sr?(typeof h=="function"&&(A0(e,s,h,n),u=e.memoizedState),(c=Sr||hw(e,s,c,n,f,u,a))?(d||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=u),r.props=n,r.state=u,r.context=a,n=c):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{r=e.stateNode,ex(t,e),a=e.memoizedProps,d=po(s,a),r.props=d,h=e.pendingProps,f=r.context,u=s.contextType,c=rl,typeof u=="object"&&u!==null&&(c=ps(u)),l=s.getDerivedStateFromProps,(u=typeof l=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==h||f!==c)&&fw(e,r,n,c),Sr=!1,f=e.memoizedState,r.state=f,mu(e,n,r,i),fu();var m=e.memoizedState;a!==h||f!==m||Sr||t!==null&&t.dependencies!==null&&Ef(t.dependencies)?(typeof l=="function"&&(A0(e,s,l,n),m=e.memoizedState),(d=Sr||hw(e,s,d,n,f,m,c)||t!==null&&t.dependencies!==null&&Ef(t.dependencies))?(u||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(n,m,c),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(n,m,c)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),r.props=n,r.state=m,r.context=c,n=d):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return r=n,ef(t,e),n=(e.flags&128)!==0,r||n?(r=e.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:r.render(),e.flags|=1,t!==null&&n?(e.child=fo(e,t.child,null,i),e.child=fo(e,null,s,i)):ds(t,e,s,i),e.memoizedState=r.state,t=e.child):t=Ji(t,e,i),t}function _w(t,e,s,n){return uo(),e.flags|=256,ds(t,e,s,n),e.child}var j0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function C0(t){return{baseLanes:t,cachePool:ME()}}function R0(t,e,s){return t=t!==null?t.childLanes&~s:0,e&&(t|=Js),t}function T2(t,e,s){var n=e.pendingProps,i=!1,r=(e.flags&128)!==0,a;if((a=r)||(a=t!==null&&t.memoizedState===null?!1:(Lt.current&2)!==0),a&&(i=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,t===null){if(Ve){if(i?Ar(e):jr(),(t=pt)?(t=xA(t,vn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:oa!==null?{id:ii,overflow:ri}:null,retryLane:536870912,hydrationErrors:null},s=CE(t),s.return=e,e.child=s,fs=e,pt=null)):t=null,t===null)throw la(e);return kx(t)?e.lanes=32:e.lanes=536870912,null}var l=n.children;return n=n.fallback,i?(jr(),i=e.mode,l=Mf({mode:"hidden",children:l},i),n=to(n,i,s,null),l.return=e,n.return=e,l.sibling=n,e.child=l,n=e.child,n.memoizedState=C0(s),n.childLanes=R0(t,a,s),e.memoizedState=j0,tu(null,n)):(Ar(e),ux(e,l))}var c=t.memoizedState;if(c!==null&&(l=c.dehydrated,l!==null)){if(r)e.flags&256?(Ar(e),e.flags&=-257,e=I0(t,e,s)):e.memoizedState!==null?(jr(),e.child=t.child,e.flags|=128,e=null):(jr(),l=n.fallback,i=e.mode,n=Mf({mode:"visible",children:n.children},i),l=to(l,i,s,null),l.flags|=2,n.return=e,l.return=e,n.sibling=l,e.child=n,fo(e,t.child,null,s),n=e.child,n.memoizedState=C0(s),n.childLanes=R0(t,a,s),e.memoizedState=j0,e=tu(null,n));else if(Ar(e),kx(l)){if(a=l.nextSibling&&l.nextSibling.dataset,a)var u=a.dgst;a=u,n=Error(X(419)),n.stack="",n.digest=a,Fu({value:n,source:null,stack:null}),e=I0(t,e,s)}else if(qt||fc(t,e,s,!1),a=(s&t.childLanes)!==0,qt||a){if(a=lt,a!==null&&(n=sE(a,s),n!==0&&n!==c.retryLane))throw c.retryLane=n,Co(t,n),Fs(a,t,n),Av;wx(l)||Vf(),e=I0(t,e,s)}else wx(l)?(e.flags|=192,e.child=t.child,e=null):(t=c.treeContext,pt=Nn(l.nextSibling),fs=e,Ve=!0,zr=null,vn=!1,t!==null&&IE(e,t),e=ux(e,n.children),e.flags|=4096);return e}return i?(jr(),l=n.fallback,i=e.mode,c=t.child,u=c.sibling,n=Bi(c,{mode:"hidden",children:n.children}),n.subtreeFlags=c.subtreeFlags&65011712,u!==null?l=Bi(u,l):(l=to(l,i,s,null),l.flags|=2),l.return=e,n.return=e,n.sibling=l,e.child=n,tu(null,n),n=e.child,l=t.child.memoizedState,l===null?l=C0(s):(i=l.cachePool,i!==null?(c=zt._currentValue,i=i.parent!==c?{parent:c,pool:c}:i):i=ME(),l={baseLanes:l.baseLanes|s,cachePool:i}),n.memoizedState=l,n.childLanes=R0(t,a,s),e.memoizedState=j0,tu(t.child,n)):(Ar(e),s=t.child,t=s.sibling,s=Bi(s,{mode:"visible",children:n.children}),s.return=e,s.sibling=null,t!==null&&(a=e.deletions,a===null?(e.deletions=[t],e.flags|=16):a.push(t)),e.child=s,e.memoizedState=null,s)}function ux(t,e){return e=Mf({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function Mf(t,e){return t=Xs(22,t,null,e),t.lanes=0,t}function I0(t,e,s){return fo(e,t.child,null,s),t=ux(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ww(t,e,s){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Qg(t.return,e,s)}function O0(t,e,s,n,i,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:i,treeForkCount:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=s,a.tailMode=i,a.treeForkCount=r)}function E2(t,e,s){var n=e.pendingProps,i=n.revealOrder,r=n.tail;n=n.children;var a=Lt.current,l=(a&2)!==0;if(l?(a=a&1|2,e.flags|=128):a&=1,ut(Lt,a),ds(t,e,n,s),n=Ve?Vu:0,!l&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&ww(t,s,e);else if(t.tag===19)ww(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(i){case"forwards":for(s=e.child,i=null;s!==null;)t=s.alternate,t!==null&&Cf(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=e.child,e.child=null):(i=s.sibling,s.sibling=null),O0(e,!1,i,s,r,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Cf(t)===null){e.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}O0(e,!0,s,null,r,n);break;case"together":O0(e,!1,null,null,void 0,n);break;default:e.memoizedState=null}return e.child}function Ji(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),ua|=e.lanes,!(s&e.childLanes))if(t!==null){if(fc(t,e,s,!1),(s&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(X(153));if(e.child!==null){for(t=e.child,s=Bi(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=Bi(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function jv(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&Ef(t)))}function j4(t,e,s){switch(e.tag){case 3:yf(e,e.stateNode.containerInfo),Er(e,zt,t.memoizedState.cache),uo();break;case 27:case 5:Vg(e);break;case 4:yf(e,e.stateNode.containerInfo);break;case 10:Er(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,nx(e),null;break;case 13:var n=e.memoizedState;if(n!==null)return n.dehydrated!==null?(Ar(e),e.flags|=128,null):s&e.child.childLanes?T2(t,e,s):(Ar(e),t=Ji(t,e,s),t!==null?t.sibling:null);Ar(e);break;case 19:var i=(t.flags&128)!==0;if(n=(s&e.childLanes)!==0,n||(fc(t,e,s,!1),n=(s&e.childLanes)!==0),i){if(n)return E2(t,e,s);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ut(Lt,Lt.current),n)break;return null;case 22:return e.lanes=0,S2(t,e,s,e.pendingProps);case 24:Er(e,zt,t.memoizedState.cache)}return Ji(t,e,s)}function A2(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps)qt=!0;else{if(!jv(t,s)&&!(e.flags&128))return qt=!1,j4(t,e,s);qt=!!(t.flags&131072)}else qt=!1,Ve&&e.flags&1048576&&RE(e,Vu,e.index);switch(e.lanes=0,e.tag){case 16:e:{var n=e.pendingProps;if(t=$a(e.elementType),e.type=t,typeof t=="function")ov(t)?(n=po(t,n),e.tag=1,e=yw(null,e,t,n,s)):(e.tag=0,e=cx(null,e,t,n,s));else{if(t!=null){var i=t.$$typeof;if(i===Kb){e.tag=11,e=pw(null,e,t,n,s);break e}else if(i===Wb){e.tag=14,e=gw(null,e,t,n,s);break e}}throw e=Lg(t)||t,Error(X(306,e,""))}}return e;case 0:return cx(t,e,e.type,e.pendingProps,s);case 1:return n=e.type,i=po(n,e.pendingProps),yw(t,e,n,i,s);case 3:e:{if(yf(e,e.stateNode.containerInfo),t===null)throw Error(X(387));n=e.pendingProps;var r=e.memoizedState;i=r.element,ex(t,e),mu(e,n,null,s);var a=e.memoizedState;if(n=a.cache,Er(e,zt,n),n!==r.cache&&Jg(e,[zt],s,!0),fu(),n=a.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){e=_w(t,e,n,s);break e}else if(n!==i){i=bn(Error(X(424)),e),Fu(i),e=_w(t,e,n,s);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(pt=Nn(t.firstChild),fs=e,Ve=!0,zr=null,vn=!0,s=PE(e,null,n,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(uo(),n===i){e=Ji(t,e,s);break e}ds(t,e,n,s)}e=e.child}return e;case 26:return ef(t,e),t===null?(s=$w(e.type,null,e.pendingProps,null))?e.memoizedState=s:Ve||(s=e.type,t=e.pendingProps,n=$f(Hr.current).createElement(s),n[hs]=e,n[$s]=t,gs(n,s,t),is(n),e.stateNode=n):e.memoizedState=$w(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return Vg(e),t===null&&Ve&&(n=e.stateNode=bA(e.type,e.pendingProps,Hr.current),fs=e,vn=!0,i=pt,Ta(e.type)?(Nx=i,pt=Nn(n.firstChild)):pt=i),ds(t,e,e.pendingProps.children,s),ef(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&Ve&&((i=n=pt)&&(n=rD(n,e.type,e.pendingProps,vn),n!==null?(e.stateNode=n,fs=e,pt=Nn(n.firstChild),vn=!1,i=!0):i=!1),i||la(e)),Vg(e),i=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,n=r.children,yx(i,r)?n=null:a!==null&&yx(i,a)&&(e.flags|=32),e.memoizedState!==null&&(i=gv(t,e,y4,null,null,s),zu._currentValue=i),ef(t,e),ds(t,e,n,s),e.child;case 6:return t===null&&Ve&&((t=s=pt)&&(s=aD(s,e.pendingProps,vn),s!==null?(e.stateNode=s,fs=e,pt=null,t=!0):t=!1),t||la(e)),null;case 13:return T2(t,e,s);case 4:return yf(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=fo(e,null,n,s):ds(t,e,n,s),e.child;case 11:return pw(t,e,e.type,e.pendingProps,s);case 7:return ds(t,e,e.pendingProps,s),e.child;case 8:return ds(t,e,e.pendingProps.children,s),e.child;case 12:return ds(t,e,e.pendingProps.children,s),e.child;case 10:return n=e.pendingProps,Er(e,e.type,n.value),ds(t,e,n.children,s),e.child;case 9:return i=e.type._context,n=e.pendingProps.children,ho(e),i=ps(i),n=n(i),e.flags|=1,ds(t,e,n,s),e.child;case 14:return gw(t,e,e.type,e.pendingProps,s);case 15:return N2(t,e,e.type,e.pendingProps,s);case 19:return E2(t,e,s);case 31:return A4(t,e,s);case 22:return S2(t,e,s,e.pendingProps);case 24:return ho(e),n=ps(zt),t===null?(i=dv(),i===null&&(i=lt,r=uv(),i.pooledCache=r,r.refCount++,r!==null&&(i.pooledCacheLanes|=s),i=r),e.memoizedState={parent:n,cache:i},fv(e),Er(e,zt,i)):(t.lanes&s&&(ex(t,e),mu(e,null,null,s),fu()),i=t.memoizedState,r=e.memoizedState,i.parent!==n?(i={parent:n,cache:n},e.memoizedState=i,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=i),Er(e,zt,n)):(n=r.cache,Er(e,zt,n),n!==i.cache&&Jg(e,[zt],s,!0))),ds(t,e,e.pendingProps.children,s),e.child;case 29:throw e.pendingProps}throw Error(X(156,e.tag))}function Ni(t){t.flags|=4}function M0(t,e,s,n,i){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(i&335544128)===i)if(t.stateNode.complete)t.flags|=8192;else if(J2())t.flags|=8192;else throw no=Af,hv}else t.flags&=-16777217}function kw(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!_A(e))if(J2())t.flags|=8192;else throw no=Af,hv}function Nh(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?ZT():536870912,t.lanes|=e,$l|=e)}function Hc(t,e){if(!Ve)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function mt(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(e)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags&65011712,n|=i.flags&65011712,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=s,e}function C4(t,e,s){var n=e.pendingProps;switch(cv(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return mt(e),null;case 1:return mt(e),null;case 3:return s=e.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),Ui(zt),Ll(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Uo(e)?Ni(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,S0())),mt(e),null;case 26:var i=e.type,r=e.memoizedState;return t===null?(Ni(e),r!==null?(mt(e),kw(e,r)):(mt(e),M0(e,i,null,n,s))):r?r!==t.memoizedState?(Ni(e),mt(e),kw(e,r)):(mt(e),e.flags&=-16777217):(t=t.memoizedProps,t!==n&&Ni(e),mt(e),M0(e,i,t,n,s)),null;case 27:if(_f(e),s=Hr.current,i=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==n&&Ni(e);else{if(!n){if(e.stateNode===null)throw Error(X(166));return mt(e),null}t=oi.current,Uo(e)?J1(e):(t=bA(i,n,s),e.stateNode=t,Ni(e))}return mt(e),null;case 5:if(_f(e),i=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==n&&Ni(e);else{if(!n){if(e.stateNode===null)throw Error(X(166));return mt(e),null}if(r=oi.current,Uo(e))J1(e);else{var a=$f(Hr.current);switch(r){case 1:r=a.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:r=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":r=a.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":r=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof n.is=="string"?a.createElement("select",{is:n.is}):a.createElement("select"),n.multiple?r.multiple=!0:n.size&&(r.size=n.size);break;default:r=typeof n.is=="string"?a.createElement(i,{is:n.is}):a.createElement(i)}}r[hs]=e,r[$s]=n;e:for(a=e.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.tag!==27&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}e.stateNode=r;e:switch(gs(r,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&Ni(e)}}return mt(e),M0(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,s),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==n&&Ni(e);else{if(typeof n!="string"&&e.stateNode===null)throw Error(X(166));if(t=Hr.current,Uo(e)){if(t=e.stateNode,s=e.memoizedProps,n=null,i=fs,i!==null)switch(i.tag){case 27:case 5:n=i.memoizedProps}t[hs]=e,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||mA(t.nodeValue,s)),t||la(e,!0)}else t=$f(t).createTextNode(n),t[hs]=e,e.stateNode=t}return mt(e),null;case 31:if(s=e.memoizedState,t===null||t.memoizedState!==null){if(n=Uo(e),s!==null){if(t===null){if(!n)throw Error(X(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(557));t[hs]=e}else uo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;mt(e),t=!1}else s=S0(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return e.flags&256?(Ws(e),e):(Ws(e),null);if(e.flags&128)throw Error(X(558))}return mt(e),null;case 13:if(n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(i=Uo(e),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[hs]=e}else uo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;mt(e),i=!1}else i=S0(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=i),i=!0;if(!i)return e.flags&256?(Ws(e),e):(Ws(e),null)}return Ws(e),e.flags&128?(e.lanes=s,e):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=e.child,i=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(i=n.alternate.memoizedState.cachePool.pool),r=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),r!==i&&(n.flags|=2048)),s!==t&&s&&(e.child.flags|=8192),Nh(e,e.updateQueue),mt(e),null);case 4:return Ll(),t===null&&Lv(e.stateNode.containerInfo),mt(e),null;case 10:return Ui(e.type),mt(e),null;case 19:if(as(Lt),n=e.memoizedState,n===null)return mt(e),null;if(i=(e.flags&128)!==0,r=n.rendering,r===null)if(i)Hc(n,!1);else{if(It!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(r=Cf(t),r!==null){for(e.flags|=128,Hc(n,!1),t=r.updateQueue,e.updateQueue=t,Nh(e,t),e.subtreeFlags=0,t=s,s=e.child;s!==null;)jE(s,t),s=s.sibling;return ut(Lt,Lt.current&1|2),Ve&&Ri(e,n.treeForkCount),e.child}t=t.sibling}n.tail!==null&&sn()>Lf&&(e.flags|=128,i=!0,Hc(n,!1),e.lanes=4194304)}else{if(!i)if(t=Cf(r),t!==null){if(e.flags|=128,i=!0,t=t.updateQueue,e.updateQueue=t,Nh(e,t),Hc(n,!0),n.tail===null&&n.tailMode==="hidden"&&!r.alternate&&!Ve)return mt(e),null}else 2*sn()-n.renderingStartTime>Lf&&s!==536870912&&(e.flags|=128,i=!0,Hc(n,!1),e.lanes=4194304);n.isBackwards?(r.sibling=e.child,e.child=r):(t=n.last,t!==null?t.sibling=r:e.child=r,n.last=r)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=sn(),t.sibling=null,s=Lt.current,ut(Lt,i?s&1|2:s&1),Ve&&Ri(e,n.treeForkCount),t):(mt(e),null);case 22:case 23:return Ws(e),mv(),n=e.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(e.flags|=8192):n&&(e.flags|=8192),n?s&536870912&&!(e.flags&128)&&(mt(e),e.subtreeFlags&6&&(e.flags|=8192)):mt(e),s=e.updateQueue,s!==null&&Nh(e,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),n!==s&&(e.flags|=2048),t!==null&&as(so),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),e.memoizedState.cache!==s&&(e.flags|=2048),Ui(zt),mt(e),null;case 25:return null;case 30:return null}throw Error(X(156,e.tag))}function R4(t,e){switch(cv(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ui(zt),Ll(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return _f(e),null;case 31:if(e.memoizedState!==null){if(Ws(e),e.alternate===null)throw Error(X(340));uo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(Ws(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(X(340));uo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return as(Lt),null;case 4:return Ll(),null;case 10:return Ui(e.type),null;case 22:case 23:return Ws(e),mv(),t!==null&&as(so),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return Ui(zt),null;case 25:return null;default:return null}}function j2(t,e){switch(cv(e),e.tag){case 3:Ui(zt),Ll();break;case 26:case 27:case 5:_f(e);break;case 4:Ll();break;case 31:e.memoizedState!==null&&Ws(e);break;case 13:Ws(e);break;case 19:as(Lt);break;case 10:Ui(e.type);break;case 22:case 23:Ws(e),mv(),t!==null&&as(so);break;case 24:Ui(zt)}}function Cd(t,e){try{var s=e.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var i=n.next;s=i;do{if((s.tag&t)===t){n=void 0;var r=s.create,a=s.inst;n=r(),a.destroy=n}s=s.next}while(s!==i)}}catch(l){Je(e,e.return,l)}}function ca(t,e,s){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var r=i.next;n=r;do{if((n.tag&t)===t){var a=n.inst,l=a.destroy;if(l!==void 0){a.destroy=void 0,i=e;var c=s,u=l;try{u()}catch(d){Je(i,c,d)}}}n=n.next}while(n!==r)}}catch(d){Je(e,e.return,d)}}function C2(t){var e=t.updateQueue;if(e!==null){var s=t.stateNode;try{FE(e,s)}catch(n){Je(t,t.return,n)}}}function R2(t,e,s){s.props=po(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){Je(t,e,n)}}function gu(t,e){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(i){Je(t,e,i)}}function ai(t,e){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(i){Je(t,e,i)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(i){Je(t,e,i)}else s.current=null}function I2(t){var e=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(i){Je(t,t.return,i)}}function D0(t,e,s){try{var n=t.stateNode;Z4(n,t.type,s,e),n[$s]=e}catch(i){Je(t,t.return,i)}}function O2(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Ta(t.type)||t.tag===4}function L0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||O2(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Ta(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function dx(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,e):(e=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,e.appendChild(t),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Mi));else if(n!==4&&(n===27&&Ta(t.type)&&(s=t.stateNode,e=null),t=t.child,t!==null))for(dx(t,e,s),t=t.sibling;t!==null;)dx(t,e,s),t=t.sibling}function Df(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(n!==4&&(n===27&&Ta(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Df(t,e,s),t=t.sibling;t!==null;)Df(t,e,s),t=t.sibling}function M2(t){var e=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,i=e.attributes;i.length;)e.removeAttributeNode(i[0]);gs(e,n,s),e[hs]=t,e[$s]=s}catch(r){Je(t,t.return,r)}}var Ii=!1,Ht=!1,P0=!1,Nw=typeof WeakSet=="function"?WeakSet:Set,ss=null;function I4(t,e){if(t=t.containerInfo,bx=qf,t=_E(t),iv(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var i=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{s.nodeType,r.nodeType}catch{s=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var m;h!==s||i!==0&&h.nodeType!==3||(l=a+i),h!==r||n!==0&&h.nodeType!==3||(c=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===s&&++u===i&&(l=a),f===r&&++d===n&&(c=a),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(vx={focusedElem:t,selectionRange:s},qf=!1,ss=e;ss!==null;)if(e=ss,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ss=t;else for(;ss!==null;){switch(e=ss,r=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)i=t[s],i.ref.impl=i.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&r!==null){t=void 0,s=e,i=r.memoizedProps,r=r.memoizedState,n=s.stateNode;try{var b=po(s.type,i);t=n.getSnapshotBeforeUpdate(b,r),n.__reactInternalSnapshotBeforeUpdate=t}catch(p){Je(s,s.return,p)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,s=t.nodeType,s===9)_x(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":_x(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(X(163))}if(t=e.sibling,t!==null){t.return=e.return,ss=t;break}ss=e.return}}function D2(t,e,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:Ti(t,s),n&4&&Cd(5,s);break;case 1:if(Ti(t,s),n&4)if(t=s.stateNode,e===null)try{t.componentDidMount()}catch(a){Je(s,s.return,a)}else{var i=po(s.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(i,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){Je(s,s.return,a)}}n&64&&C2(s),n&512&&gu(s,s.return);break;case 3:if(Ti(t,s),n&64&&(t=s.updateQueue,t!==null)){if(e=null,s.child!==null)switch(s.child.tag){case 27:case 5:e=s.child.stateNode;break;case 1:e=s.child.stateNode}try{FE(t,e)}catch(a){Je(s,s.return,a)}}break;case 27:e===null&&n&4&&M2(s);case 26:case 5:Ti(t,s),e===null&&n&4&&I2(s),n&512&&gu(s,s.return);break;case 12:Ti(t,s);break;case 31:Ti(t,s),n&4&&V2(t,s);break;case 13:Ti(t,s),n&4&&F2(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=U4.bind(null,s),oD(t,s))));break;case 22:if(n=s.memoizedState!==null||Ii,!n){e=e!==null&&e.memoizedState!==null||Ht,i=Ii;var r=Ht;Ii=n,(Ht=e)&&!r?ji(t,s,(s.subtreeFlags&8772)!==0):Ti(t,s),Ii=i,Ht=r}break;case 30:break;default:Ti(t,s)}}function L2(t){var e=t.alternate;e!==null&&(t.alternate=null,L2(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&Jb(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var yt=null,Ms=!1;function Si(t,e,s){for(s=s.child;s!==null;)P2(t,e,s),s=s.sibling}function P2(t,e,s){if(nn&&typeof nn.onCommitFiberUnmount=="function")try{nn.onCommitFiberUnmount(kd,s)}catch{}switch(s.tag){case 26:Ht||ai(s,e),Si(t,e,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:Ht||ai(s,e);var n=yt,i=Ms;Ta(s.type)&&(yt=s.stateNode,Ms=!1),Si(t,e,s),yu(s.stateNode),yt=n,Ms=i;break;case 5:Ht||ai(s,e);case 6:if(n=yt,i=Ms,yt=null,Si(t,e,s),yt=n,Ms=i,yt!==null)if(Ms)try{(yt.nodeType===9?yt.body:yt.nodeName==="HTML"?yt.ownerDocument.body:yt).removeChild(s.stateNode)}catch(r){Je(s,e,r)}else try{yt.removeChild(s.stateNode)}catch(r){Je(s,e,r)}break;case 18:yt!==null&&(Ms?(t=yt,Pw(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),ql(t)):Pw(yt,s.stateNode));break;case 4:n=yt,i=Ms,yt=s.stateNode.containerInfo,Ms=!0,Si(t,e,s),yt=n,Ms=i;break;case 0:case 11:case 14:case 15:ca(2,s,e),Ht||ca(4,s,e),Si(t,e,s);break;case 1:Ht||(ai(s,e),n=s.stateNode,typeof n.componentWillUnmount=="function"&&R2(s,e,n)),Si(t,e,s);break;case 21:Si(t,e,s);break;case 22:Ht=(n=Ht)||s.memoizedState!==null,Si(t,e,s),Ht=n;break;default:Si(t,e,s)}}function V2(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{ql(t)}catch(s){Je(e,e.return,s)}}}function F2(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{ql(t)}catch(s){Je(e,e.return,s)}}function O4(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new Nw),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new Nw),e;default:throw Error(X(435,t.tag))}}function Sh(t,e){var s=O4(t);e.forEach(function(n){if(!s.has(n)){s.add(n);var i=$4.bind(null,t,n);n.then(i,i)}})}function Rs(t,e){var s=e.deletions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n],r=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 27:if(Ta(l.type)){yt=l.stateNode,Ms=!1;break e}break;case 5:yt=l.stateNode,Ms=!1;break e;case 3:case 4:yt=l.stateNode.containerInfo,Ms=!0;break e}l=l.return}if(yt===null)throw Error(X(160));P2(r,a,i),yt=null,Ms=!1,r=i.alternate,r!==null&&(r.return=null),i.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)B2(e,t),e=e.sibling}var Vn=null;function B2(t,e){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Rs(e,t),Is(t),n&4&&(ca(3,t,t.return),Cd(3,t),ca(5,t,t.return));break;case 1:Rs(e,t),Is(t),n&512&&(Ht||s===null||ai(s,s.return)),n&64&&Ii&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var i=Vn;if(Rs(e,t),Is(t),n&512&&(Ht||s===null||ai(s,s.return)),n&4){var r=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":r=i.getElementsByTagName("title")[0],(!r||r[Td]||r[hs]||r.namespaceURI==="http://www.w3.org/2000/svg"||r.hasAttribute("itemprop"))&&(r=i.createElement(n),i.head.insertBefore(r,i.querySelector("head > title"))),gs(r,n,s),r[hs]=t,is(r),n=r;break e;case"link":var a=Hw("link","href",i).get(n+(s.href||""));if(a){for(var l=0;l<a.length;l++)if(r=a[l],r.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&r.getAttribute("rel")===(s.rel==null?null:s.rel)&&r.getAttribute("title")===(s.title==null?null:s.title)&&r.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){a.splice(l,1);break t}}r=i.createElement(n),gs(r,n,s),i.head.appendChild(r);break;case"meta":if(a=Hw("meta","content",i).get(n+(s.content||""))){for(l=0;l<a.length;l++)if(r=a[l],r.getAttribute("content")===(s.content==null?null:""+s.content)&&r.getAttribute("name")===(s.name==null?null:s.name)&&r.getAttribute("property")===(s.property==null?null:s.property)&&r.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&r.getAttribute("charset")===(s.charSet==null?null:s.charSet)){a.splice(l,1);break t}}r=i.createElement(n),gs(r,n,s),i.head.appendChild(r);break;default:throw Error(X(468,n))}r[hs]=t,is(r),n=r}t.stateNode=n}else zw(i,t.type,t.stateNode);else t.stateNode=Gw(i,n,t.memoizedProps);else r!==n?(r===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):r.count--,n===null?zw(i,t.type,t.stateNode):Gw(i,n,t.memoizedProps)):n===null&&t.stateNode!==null&&D0(t,t.memoizedProps,s.memoizedProps)}break;case 27:Rs(e,t),Is(t),n&512&&(Ht||s===null||ai(s,s.return)),s!==null&&n&4&&D0(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Rs(e,t),Is(t),n&512&&(Ht||s===null||ai(s,s.return)),t.flags&32){i=t.stateNode;try{Vl(i,"")}catch(b){Je(t,t.return,b)}}n&4&&t.stateNode!=null&&(i=t.memoizedProps,D0(t,i,s!==null?s.memoizedProps:i)),n&1024&&(P0=!0);break;case 6:if(Rs(e,t),Is(t),n&4){if(t.stateNode===null)throw Error(X(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(b){Je(t,t.return,b)}}break;case 3:if(nf=null,i=Vn,Vn=Gf(e.containerInfo),Rs(e,t),Vn=i,Is(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{ql(e.containerInfo)}catch(b){Je(t,t.return,b)}P0&&(P0=!1,U2(t));break;case 4:n=Vn,Vn=Gf(t.stateNode.containerInfo),Rs(e,t),Is(t),Vn=n;break;case 12:Rs(e,t),Is(t);break;case 31:Rs(e,t),Is(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Sh(t,n)));break;case 13:Rs(e,t),Is(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(op=sn()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Sh(t,n)));break;case 22:i=t.memoizedState!==null;var c=s!==null&&s.memoizedState!==null,u=Ii,d=Ht;if(Ii=u||i,Ht=d||c,Rs(e,t),Ht=d,Ii=u,Is(t),n&8192)e:for(e=t.stateNode,e._visibility=i?e._visibility&-2:e._visibility|1,i&&(s===null||c||Ii||Ht||Ga(t)),s=null,e=t;;){if(e.tag===5||e.tag===26){if(s===null){c=s=e;try{if(r=c.stateNode,i)a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,f=h!=null&&h.hasOwnProperty("display")?h.display:null;l.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(b){Je(c,c.return,b)}}}else if(e.tag===6){if(s===null){c=e;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(b){Je(c,c.return,b)}}}else if(e.tag===18){if(s===null){c=e;try{var m=c.stateNode;i?Vw(m,!0):Vw(c.stateNode,!1)}catch(b){Je(c,c.return,b)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;s===e&&(s=null),e=e.return}s===e&&(s=null),e.sibling.return=e.return,e=e.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,Sh(t,s))));break;case 19:Rs(e,t),Is(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Sh(t,n)));break;case 30:break;case 21:break;default:Rs(e,t),Is(t)}}function Is(t){var e=t.flags;if(e&2){try{for(var s,n=t.return;n!==null;){if(O2(n)){s=n;break}n=n.return}if(s==null)throw Error(X(160));switch(s.tag){case 27:var i=s.stateNode,r=L0(t);Df(t,r,i);break;case 5:var a=s.stateNode;s.flags&32&&(Vl(a,""),s.flags&=-33);var l=L0(t);Df(t,l,a);break;case 3:case 4:var c=s.stateNode.containerInfo,u=L0(t);dx(t,u,c);break;default:throw Error(X(161))}}catch(d){Je(t,t.return,d)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function U2(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;U2(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function Ti(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)D2(t,e.alternate,e),e=e.sibling}function Ga(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:ca(4,e,e.return),Ga(e);break;case 1:ai(e,e.return);var s=e.stateNode;typeof s.componentWillUnmount=="function"&&R2(e,e.return,s),Ga(e);break;case 27:yu(e.stateNode);case 26:case 5:ai(e,e.return),Ga(e);break;case 22:e.memoizedState===null&&Ga(e);break;case 30:Ga(e);break;default:Ga(e)}t=t.sibling}}function ji(t,e,s){for(s=s&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var n=e.alternate,i=t,r=e,a=r.flags;switch(r.tag){case 0:case 11:case 15:ji(i,r,s),Cd(4,r);break;case 1:if(ji(i,r,s),n=r,i=n.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(u){Je(n,n.return,u)}if(n=r,i=n.updateQueue,i!==null){var l=n.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)VE(c[i],l)}catch(u){Je(n,n.return,u)}}s&&a&64&&C2(r),gu(r,r.return);break;case 27:M2(r);case 26:case 5:ji(i,r,s),s&&n===null&&a&4&&I2(r),gu(r,r.return);break;case 12:ji(i,r,s);break;case 31:ji(i,r,s),s&&a&4&&V2(i,r);break;case 13:ji(i,r,s),s&&a&4&&F2(i,r);break;case 22:r.memoizedState===null&&ji(i,r,s),gu(r,r.return);break;case 30:break;default:ji(i,r,s)}e=e.sibling}}function Cv(t,e){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Ad(s))}function Rv(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Ad(t))}function Mn(t,e,s,n){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)$2(t,e,s,n),e=e.sibling}function $2(t,e,s,n){var i=e.flags;switch(e.tag){case 0:case 11:case 15:Mn(t,e,s,n),i&2048&&Cd(9,e);break;case 1:Mn(t,e,s,n);break;case 3:Mn(t,e,s,n),i&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Ad(t)));break;case 12:if(i&2048){Mn(t,e,s,n),t=e.stateNode;try{var r=e.memoizedProps,a=r.id,l=r.onPostCommit;typeof l=="function"&&l(a,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(c){Je(e,e.return,c)}}else Mn(t,e,s,n);break;case 31:Mn(t,e,s,n);break;case 13:Mn(t,e,s,n);break;case 23:break;case 22:r=e.stateNode,a=e.alternate,e.memoizedState!==null?r._visibility&2?Mn(t,e,s,n):xu(t,e):r._visibility&2?Mn(t,e,s,n):(r._visibility|=2,Wo(t,e,s,n,(e.subtreeFlags&10256)!==0||!1)),i&2048&&Cv(a,e);break;case 24:Mn(t,e,s,n),i&2048&&Rv(e.alternate,e);break;default:Mn(t,e,s,n)}}function Wo(t,e,s,n,i){for(i=i&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var r=t,a=e,l=s,c=n,u=a.flags;switch(a.tag){case 0:case 11:case 15:Wo(r,a,l,c,i),Cd(8,a);break;case 23:break;case 22:var d=a.stateNode;a.memoizedState!==null?d._visibility&2?Wo(r,a,l,c,i):xu(r,a):(d._visibility|=2,Wo(r,a,l,c,i)),i&&u&2048&&Cv(a.alternate,a);break;case 24:Wo(r,a,l,c,i),i&&u&2048&&Rv(a.alternate,a);break;default:Wo(r,a,l,c,i)}e=e.sibling}}function xu(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var s=t,n=e,i=n.flags;switch(n.tag){case 22:xu(s,n),i&2048&&Cv(n.alternate,n);break;case 24:xu(s,n),i&2048&&Rv(n.alternate,n);break;default:xu(s,n)}e=e.sibling}}var su=8192;function $o(t,e,s){if(t.subtreeFlags&su)for(t=t.child;t!==null;)G2(t,e,s),t=t.sibling}function G2(t,e,s){switch(t.tag){case 26:$o(t,e,s),t.flags&su&&t.memoizedState!==null&&vD(s,Vn,t.memoizedState,t.memoizedProps);break;case 5:$o(t,e,s);break;case 3:case 4:var n=Vn;Vn=Gf(t.stateNode.containerInfo),$o(t,e,s),Vn=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=su,su=16777216,$o(t,e,s),su=n):$o(t,e,s));break;default:$o(t,e,s)}}function H2(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function zc(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var s=0;s<e.length;s++){var n=e[s];ss=n,q2(n,t)}H2(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)z2(t),t=t.sibling}function z2(t){switch(t.tag){case 0:case 11:case 15:zc(t),t.flags&2048&&ca(9,t,t.return);break;case 3:zc(t);break;case 12:zc(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,tf(t)):zc(t);break;default:zc(t)}}function tf(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var s=0;s<e.length;s++){var n=e[s];ss=n,q2(n,t)}H2(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:ca(8,e,e.return),tf(e);break;case 22:s=e.stateNode,s._visibility&2&&(s._visibility&=-3,tf(e));break;default:tf(e)}t=t.sibling}}function q2(t,e){for(;ss!==null;){var s=ss;switch(s.tag){case 0:case 11:case 15:ca(8,s,e);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Ad(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,ss=n;else e:for(s=t;ss!==null;){n=ss;var i=n.sibling,r=n.return;if(L2(n),n===s){ss=null;break e}if(i!==null){i.return=r,ss=i;break e}ss=r}}}var M4={getCacheForType:function(t){var e=ps(zt),s=e.data.get(t);return s===void 0&&(s=t(),e.data.set(t,s)),s},cacheSignal:function(){return ps(zt).controller.signal}},D4=typeof WeakMap=="function"?WeakMap:Map,Ue=0,lt=null,Ce=null,Me=0,Xe=0,Ks=null,Pr=!1,pc=!1,Iv=!1,Zi=0,It=0,ua=0,io=0,Ov=0,Js=0,$l=0,bu=null,Ds=null,hx=!1,op=0,K2=0,Lf=1/0,Pf=null,Wr=null,Xt=0,Yr=null,Gl=null,$i=0,fx=0,mx=null,W2=null,vu=0,px=null;function an(){return Ue&2&&Me!==0?Me&-Me:ye.T!==null?Dv():nE()}function Y2(){if(Js===0)if(!(Me&536870912)||Ve){var t=xh;xh<<=1,!(xh&3932160)&&(xh=262144),Js=t}else Js=536870912;return t=cn.current,t!==null&&(t.flags|=32),Js}function Fs(t,e,s){(t===lt&&(Xe===2||Xe===9)||t.cancelPendingCommit!==null)&&(Hl(t,0),Vr(t,Me,Js,!1)),Sd(t,s),(!(Ue&2)||t!==lt)&&(t===lt&&(!(Ue&2)&&(io|=s),It===4&&Vr(t,Me,Js,!1)),xi(t))}function X2(t,e,s){if(Ue&6)throw Error(X(327));var n=!s&&(e&127)===0&&(e&t.expiredLanes)===0||Nd(t,e),i=n?V4(t,e):V0(t,e,!0),r=n;do{if(i===0){pc&&!n&&Vr(t,e,0,!1);break}else{if(s=t.current.alternate,r&&!L4(s)){i=V0(t,e,!1),r=!1;continue}if(i===2){if(r=e,t.errorRecoveryDisabledLanes&r)var a=0;else a=t.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var l=t;i=bu;var c=l.current.memoizedState.isDehydrated;if(c&&(Hl(l,a).flags|=256),a=V0(l,a,!1),a!==2){if(Iv&&!c){l.errorRecoveryDisabledLanes|=r,io|=r,i=4;break e}r=Ds,Ds=i,r!==null&&(Ds===null?Ds=r:Ds.push.apply(Ds,r))}i=a}if(r=!1,i!==2)continue}}if(i===1){Hl(t,0),Vr(t,e,0,!0);break}e:{switch(n=t,r=i,r){case 0:case 1:throw Error(X(345));case 4:if((e&4194048)!==e)break;case 6:Vr(n,e,Js,!Pr);break e;case 2:Ds=null;break;case 3:case 5:break;default:throw Error(X(329))}if((e&62914560)===e&&(i=op+300-sn(),10<i)){if(Vr(n,e,Js,!Pr),Xm(n,0,!0)!==0)break e;$i=e,n.timeoutHandle=gA(Sw.bind(null,n,s,Ds,Pf,hx,e,Js,io,$l,Pr,r,"Throttled",-0,0),i);break e}Sw(n,s,Ds,Pf,hx,e,Js,io,$l,Pr,r,null,-0,0)}}break}while(!0);xi(t)}function Sw(t,e,s,n,i,r,a,l,c,u,d,h,f,m){if(t.timeoutHandle=-1,h=e.subtreeFlags,h&8192||(h&16785408)===16785408){h={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Mi},G2(e,r,h);var b=(r&62914560)===r?op-sn():(r&4194048)===r?K2-sn():0;if(b=yD(h,b),b!==null){$i=r,t.cancelPendingCommit=b(Ew.bind(null,t,e,r,s,n,i,a,l,c,d,h,null,f,m)),Vr(t,r,a,!u);return}}Ew(t,e,r,s,n,i,a,l,c)}function L4(t){for(var e=t;;){var s=e.tag;if((s===0||s===11||s===15)&&e.flags&16384&&(s=e.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var i=s[n],r=i.getSnapshot;i=i.value;try{if(!ln(r(),i))return!1}catch{return!1}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vr(t,e,s,n){e&=~Ov,e&=~io,t.suspendedLanes|=e,t.pingedLanes&=~e,n&&(t.warmLanes|=e),n=t.expirationTimes;for(var i=e;0<i;){var r=31-rn(i),a=1<<r;n[r]=-1,i&=~a}s!==0&&eE(t,s,e)}function lp(){return Ue&6?!0:(Rd(0),!1)}function Mv(){if(Ce!==null){if(Xe===0)var t=Ce.return;else t=Ce,Di=Ro=null,vv(t),Nl=null,Bu=0,t=Ce;for(;t!==null;)j2(t.alternate,t),t=t.return;Ce=null}}function Hl(t,e){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,sD(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),$i=0,Mv(),lt=t,Ce=s=Bi(t.current,null),Me=e,Xe=0,Ks=null,Pr=!1,pc=Nd(t,e),Iv=!1,$l=Js=Ov=io=ua=It=0,Ds=bu=null,hx=!1,e&8&&(e|=e&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=e;0<n;){var i=31-rn(n),r=1<<i;e|=t[i],n&=~r}return Zi=e,ep(),s}function Q2(t,e){ke=null,ye.H=$u,e===mc||e===sp?(e=nw(),Xe=3):e===hv?(e=nw(),Xe=4):Xe=e===Av?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,Ks=e,Ce===null&&(It=1,Of(t,bn(e,t.current)))}function J2(){var t=cn.current;return t===null?!0:(Me&4194048)===Me?kn===null:(Me&62914560)===Me||Me&536870912?t===kn:!1}function Z2(){var t=ye.H;return ye.H=$u,t===null?$u:t}function eA(){var t=ye.A;return ye.A=M4,t}function Vf(){It=4,Pr||(Me&4194048)!==Me&&cn.current!==null||(pc=!0),!(ua&134217727)&&!(io&134217727)||lt===null||Vr(lt,Me,Js,!1)}function V0(t,e,s){var n=Ue;Ue|=2;var i=Z2(),r=eA();(lt!==t||Me!==e)&&(Pf=null,Hl(t,e)),e=!1;var a=It;e:do try{if(Xe!==0&&Ce!==null){var l=Ce,c=Ks;switch(Xe){case 8:Mv(),a=6;break e;case 3:case 2:case 9:case 6:cn.current===null&&(e=!0);var u=Xe;if(Xe=0,Ks=null,ll(t,l,c,u),s&&pc){a=0;break e}break;default:u=Xe,Xe=0,Ks=null,ll(t,l,c,u)}}P4(),a=It;break}catch(d){Q2(t,d)}while(!0);return e&&t.shellSuspendCounter++,Di=Ro=null,Ue=n,ye.H=i,ye.A=r,Ce===null&&(lt=null,Me=0,ep()),a}function P4(){for(;Ce!==null;)tA(Ce)}function V4(t,e){var s=Ue;Ue|=2;var n=Z2(),i=eA();lt!==t||Me!==e?(Pf=null,Lf=sn()+500,Hl(t,e)):pc=Nd(t,e);e:do try{if(Xe!==0&&Ce!==null){e=Ce;var r=Ks;t:switch(Xe){case 1:Xe=0,Ks=null,ll(t,e,r,1);break;case 2:case 9:if(sw(r)){Xe=0,Ks=null,Tw(e);break}e=function(){Xe!==2&&Xe!==9||lt!==t||(Xe=7),xi(t)},r.then(e,e);break e;case 3:Xe=7;break e;case 4:Xe=5;break e;case 7:sw(r)?(Xe=0,Ks=null,Tw(e)):(Xe=0,Ks=null,ll(t,e,r,7));break;case 5:var a=null;switch(Ce.tag){case 26:a=Ce.memoizedState;case 5:case 27:var l=Ce;if(a?_A(a):l.stateNode.complete){Xe=0,Ks=null;var c=l.sibling;if(c!==null)Ce=c;else{var u=l.return;u!==null?(Ce=u,cp(u)):Ce=null}break t}}Xe=0,Ks=null,ll(t,e,r,5);break;case 6:Xe=0,Ks=null,ll(t,e,r,6);break;case 8:Mv(),It=6;break e;default:throw Error(X(462))}}F4();break}catch(d){Q2(t,d)}while(!0);return Di=Ro=null,ye.H=n,ye.A=i,Ue=s,Ce!==null?0:(lt=null,Me=0,ep(),It)}function F4(){for(;Ce!==null&&!lM();)tA(Ce)}function tA(t){var e=A2(t.alternate,t,Zi);t.memoizedProps=t.pendingProps,e===null?cp(t):Ce=e}function Tw(t){var e=t,s=e.alternate;switch(e.tag){case 15:case 0:e=vw(s,e,e.pendingProps,e.type,void 0,Me);break;case 11:e=vw(s,e,e.pendingProps,e.type.render,e.ref,Me);break;case 5:vv(e);default:j2(s,e),e=Ce=jE(e,Zi),e=A2(s,e,Zi)}t.memoizedProps=t.pendingProps,e===null?cp(t):Ce=e}function ll(t,e,s,n){Di=Ro=null,vv(e),Nl=null,Bu=0;var i=e.return;try{if(E4(t,i,e,s,Me)){It=1,Of(t,bn(s,t.current)),Ce=null;return}}catch(r){if(i!==null)throw Ce=i,r;It=1,Of(t,bn(s,t.current)),Ce=null;return}e.flags&32768?(Ve||n===1?t=!0:pc||Me&536870912?t=!1:(Pr=t=!0,(n===2||n===9||n===3||n===6)&&(n=cn.current,n!==null&&n.tag===13&&(n.flags|=16384))),sA(e,t)):cp(e)}function cp(t){var e=t;do{if(e.flags&32768){sA(e,Pr);return}t=e.return;var s=C4(e.alternate,e,Zi);if(s!==null){Ce=s;return}if(e=e.sibling,e!==null){Ce=e;return}Ce=e=t}while(e!==null);It===0&&(It=5)}function sA(t,e){do{var s=R4(t.alternate,t);if(s!==null){s.flags&=32767,Ce=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!e&&(t=t.sibling,t!==null)){Ce=t;return}Ce=t=s}while(t!==null);It=6,Ce=null}function Ew(t,e,s,n,i,r,a,l,c){t.cancelPendingCommit=null;do up();while(Xt!==0);if(Ue&6)throw Error(X(327));if(e!==null){if(e===t.current)throw Error(X(177));if(r=e.lanes|e.childLanes,r|=rv,bM(t,s,r,a,l,c),t===lt&&(Ce=lt=null,Me=0),Gl=e,Yr=t,$i=s,fx=r,mx=i,W2=n,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,G4(wf,function(){return oA(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(e.flags&13878)!==0,e.subtreeFlags&13878||n){n=ye.T,ye.T=null,i=$e.p,$e.p=2,a=Ue,Ue|=4;try{I4(t,e,s)}finally{Ue=a,$e.p=i,ye.T=n}}Xt=1,nA(),iA(),rA()}}function nA(){if(Xt===1){Xt=0;var t=Yr,e=Gl,s=(e.flags&13878)!==0;if(e.subtreeFlags&13878||s){s=ye.T,ye.T=null;var n=$e.p;$e.p=2;var i=Ue;Ue|=4;try{B2(e,t);var r=vx,a=_E(t.containerInfo),l=r.focusedElem,c=r.selectionRange;if(a!==l&&l&&l.ownerDocument&&yE(l.ownerDocument.documentElement,l)){if(c!==null&&iv(l)){var u=c.start,d=c.end;if(d===void 0&&(d=u),"selectionStart"in l)l.selectionStart=u,l.selectionEnd=Math.min(d,l.value.length);else{var h=l.ownerDocument||document,f=h&&h.defaultView||window;if(f.getSelection){var m=f.getSelection(),b=l.textContent.length,p=Math.min(c.start,b),v=c.end===void 0?p:Math.min(c.end,b);!m.extend&&p>v&&(a=v,v=p,p=a);var x=Y1(l,p),g=Y1(l,v);if(x&&g&&(m.rangeCount!==1||m.anchorNode!==x.node||m.anchorOffset!==x.offset||m.focusNode!==g.node||m.focusOffset!==g.offset)){var y=h.createRange();y.setStart(x.node,x.offset),m.removeAllRanges(),p>v?(m.addRange(y),m.extend(g.node,g.offset)):(y.setEnd(g.node,g.offset),m.addRange(y))}}}}for(h=[],m=l;m=m.parentNode;)m.nodeType===1&&h.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<h.length;l++){var w=h[l];w.element.scrollLeft=w.left,w.element.scrollTop=w.top}}qf=!!bx,vx=bx=null}finally{Ue=i,$e.p=n,ye.T=s}}t.current=e,Xt=2}}function iA(){if(Xt===2){Xt=0;var t=Yr,e=Gl,s=(e.flags&8772)!==0;if(e.subtreeFlags&8772||s){s=ye.T,ye.T=null;var n=$e.p;$e.p=2;var i=Ue;Ue|=4;try{D2(t,e.alternate,e)}finally{Ue=i,$e.p=n,ye.T=s}}Xt=3}}function rA(){if(Xt===4||Xt===3){Xt=0,cM();var t=Yr,e=Gl,s=$i,n=W2;e.subtreeFlags&10256||e.flags&10256?Xt=5:(Xt=0,Gl=Yr=null,aA(t,t.pendingLanes));var i=t.pendingLanes;if(i===0&&(Wr=null),Qb(s),e=e.stateNode,nn&&typeof nn.onCommitFiberRoot=="function")try{nn.onCommitFiberRoot(kd,e,void 0,(e.current.flags&128)===128)}catch{}if(n!==null){e=ye.T,i=$e.p,$e.p=2,ye.T=null;try{for(var r=t.onRecoverableError,a=0;a<n.length;a++){var l=n[a];r(l.value,{componentStack:l.stack})}}finally{ye.T=e,$e.p=i}}$i&3&&up(),xi(t),i=t.pendingLanes,s&261930&&i&42?t===px?vu++:(vu=0,px=t):vu=0,Rd(0)}}function aA(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,Ad(e)))}function up(){return nA(),iA(),rA(),oA()}function oA(){if(Xt!==5)return!1;var t=Yr,e=fx;fx=0;var s=Qb($i),n=ye.T,i=$e.p;try{$e.p=32>s?32:s,ye.T=null,s=mx,mx=null;var r=Yr,a=$i;if(Xt=0,Gl=Yr=null,$i=0,Ue&6)throw Error(X(331));var l=Ue;if(Ue|=4,z2(r.current),$2(r,r.current,a,s),Ue=l,Rd(0,!1),nn&&typeof nn.onPostCommitFiberRoot=="function")try{nn.onPostCommitFiberRoot(kd,r)}catch{}return!0}finally{$e.p=i,ye.T=n,aA(t,e)}}function Aw(t,e,s){e=bn(s,e),e=lx(t.stateNode,e,2),t=Kr(t,e,2),t!==null&&(Sd(t,2),xi(t))}function Je(t,e,s){if(t.tag===3)Aw(t,t,s);else for(;e!==null;){if(e.tag===3){Aw(e,t,s);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Wr===null||!Wr.has(n))){t=bn(s,t),s=w2(2),n=Kr(e,s,2),n!==null&&(k2(s,n,e,t),Sd(n,2),xi(n));break}}e=e.return}}function F0(t,e,s){var n=t.pingCache;if(n===null){n=t.pingCache=new D4;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(s)||(Iv=!0,i.add(s),t=B4.bind(null,t,e,s),e.then(t,t))}function B4(t,e,s){var n=t.pingCache;n!==null&&n.delete(e),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,lt===t&&(Me&s)===s&&(It===4||It===3&&(Me&62914560)===Me&&300>sn()-op?!(Ue&2)&&Hl(t,0):Ov|=s,$l===Me&&($l=0)),xi(t)}function lA(t,e){e===0&&(e=ZT()),t=Co(t,e),t!==null&&(Sd(t,e),xi(t))}function U4(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),lA(t,s)}function $4(t,e){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(X(314))}n!==null&&n.delete(e),lA(t,s)}function G4(t,e){return Yb(t,e)}var Ff=null,Yo=null,gx=!1,Bf=!1,B0=!1,Fr=0;function xi(t){t!==Yo&&t.next===null&&(Yo===null?Ff=Yo=t:Yo=Yo.next=t),Bf=!0,gx||(gx=!0,z4())}function Rd(t,e){if(!B0&&Bf){B0=!0;do for(var s=!1,n=Ff;n!==null;){if(t!==0){var i=n.pendingLanes;if(i===0)var r=0;else{var a=n.suspendedLanes,l=n.pingedLanes;r=(1<<31-rn(42|t)+1)-1,r&=i&~(a&~l),r=r&201326741?r&201326741|1:r?r|2:0}r!==0&&(s=!0,jw(n,r))}else r=Me,r=Xm(n,n===lt?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),!(r&3)||Nd(n,r)||(s=!0,jw(n,r));n=n.next}while(s);B0=!1}}function H4(){cA()}function cA(){Bf=gx=!1;var t=0;Fr!==0&&tD()&&(t=Fr);for(var e=sn(),s=null,n=Ff;n!==null;){var i=n.next,r=uA(n,e);r===0?(n.next=null,s===null?Ff=i:s.next=i,i===null&&(Yo=s)):(s=n,(t!==0||r&3)&&(Bf=!0)),n=i}Xt!==0&&Xt!==5||Rd(t),Fr!==0&&(Fr=0)}function uA(t,e){for(var s=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,r=t.pendingLanes&-62914561;0<r;){var a=31-rn(r),l=1<<a,c=i[a];c===-1?(!(l&s)||l&n)&&(i[a]=xM(l,e)):c<=e&&(t.expiredLanes|=l),r&=~l}if(e=lt,s=Me,s=Xm(t,t===e?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===e&&(Xe===2||Xe===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&m0(n),t.callbackNode=null,t.callbackPriority=0;if(!(s&3)||Nd(t,s)){if(e=s&-s,e===t.callbackPriority)return e;switch(n!==null&&m0(n),Qb(s)){case 2:case 8:s=QT;break;case 32:s=wf;break;case 268435456:s=JT;break;default:s=wf}return n=dA.bind(null,t),s=Yb(s,n),t.callbackPriority=e,t.callbackNode=s,e}return n!==null&&n!==null&&m0(n),t.callbackPriority=2,t.callbackNode=null,2}function dA(t,e){if(Xt!==0&&Xt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(up()&&t.callbackNode!==s)return null;var n=Me;return n=Xm(t,t===lt?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(X2(t,n,e),uA(t,sn()),t.callbackNode!=null&&t.callbackNode===s?dA.bind(null,t):null)}function jw(t,e){if(up())return null;X2(t,e,!0)}function z4(){nD(function(){Ue&6?Yb(XT,H4):cA()})}function Dv(){if(Fr===0){var t=Fl;t===0&&(t=gh,gh<<=1,!(gh&261888)&&(gh=256)),Fr=t}return Fr}function Cw(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:qh(""+t)}function Rw(t,e){var s=e.ownerDocument.createElement("input");return s.name=e.name,s.value=e.value,t.id&&s.setAttribute("form",t.id),e.parentNode.insertBefore(s,e),t=new FormData(t),s.parentNode.removeChild(s),t}function q4(t,e,s,n,i){if(e==="submit"&&s&&s.stateNode===i){var r=Cw((i[$s]||null).action),a=n.submitter;a&&(e=(e=a[$s]||null)?Cw(e.formAction):a.getAttribute("formAction"),e!==null&&(r=e,a=null));var l=new Qm("action","action",null,n,i);t.push({event:l,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Fr!==0){var c=a?Rw(i,a):new FormData(i);ax(s,{pending:!0,data:c,method:i.method,action:r},null,c)}}else typeof r=="function"&&(l.preventDefault(),c=a?Rw(i,a):new FormData(i),ax(s,{pending:!0,data:c,method:i.method,action:r},r,c))},currentTarget:i}]})}}for(var U0=0;U0<Wg.length;U0++){var $0=Wg[U0],K4=$0.toLowerCase(),W4=$0[0].toUpperCase()+$0.slice(1);Jn(K4,"on"+W4)}Jn(kE,"onAnimationEnd");Jn(NE,"onAnimationIteration");Jn(SE,"onAnimationStart");Jn("dblclick","onDoubleClick");Jn("focusin","onFocus");Jn("focusout","onBlur");Jn(u4,"onTransitionRun");Jn(d4,"onTransitionStart");Jn(h4,"onTransitionCancel");Jn(TE,"onTransitionEnd");Pl("onMouseEnter",["mouseout","mouseover"]);Pl("onMouseLeave",["mouseout","mouseover"]);Pl("onPointerEnter",["pointerout","pointerover"]);Pl("onPointerLeave",["pointerout","pointerover"]);Eo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Eo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Eo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Eo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Eo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Eo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Y4=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Gu));function hA(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],i=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var a=n.length-1;0<=a;a--){var l=n[a],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;r=l,i.currentTarget=u;try{r(i)}catch(d){Nf(d)}i.currentTarget=null,r=c}else for(a=0;a<n.length;a++){if(l=n[a],c=l.instance,u=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;r=l,i.currentTarget=u;try{r(i)}catch(d){Nf(d)}i.currentTarget=null,r=c}}}}function je(t,e){var s=e[Bg];s===void 0&&(s=e[Bg]=new Set);var n=t+"__bubble";s.has(n)||(fA(e,t,2,!1),s.add(n))}function G0(t,e,s){var n=0;e&&(n|=4),fA(s,t,n,e)}var Th="_reactListening"+Math.random().toString(36).slice(2);function Lv(t){if(!t[Th]){t[Th]=!0,iE.forEach(function(s){s!=="selectionchange"&&(Y4.has(s)||G0(s,!1,t),G0(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Th]||(e[Th]=!0,G0("selectionchange",!1,e))}}function fA(t,e,s,n){switch(TA(e)){case 2:var i=kD;break;case 8:i=ND;break;default:i=Bv}s=i.bind(null,e,s,t),i=void 0,!zg||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,s,{capture:!0,passive:i}):t.addEventListener(e,s,!0):i!==void 0?t.addEventListener(e,s,{passive:i}):t.addEventListener(e,s,!1)}function H0(t,e,s,n,i){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var l=n.stateNode.containerInfo;if(l===i)break;if(a===4)for(a=n.return;a!==null;){var c=a.tag;if((c===3||c===4)&&a.stateNode.containerInfo===i)return;a=a.return}for(;l!==null;){if(a=Zo(l),a===null)return;if(c=a.tag,c===5||c===6||c===26||c===27){n=r=a;continue e}l=l.parentNode}}n=n.return}hE(function(){var u=r,d=ev(s),h=[];e:{var f=EE.get(t);if(f!==void 0){var m=Qm,b=t;switch(t){case"keypress":if(Wh(s)===0)break e;case"keydown":case"keyup":m=$M;break;case"focusin":b="focus",m=v0;break;case"focusout":b="blur",m=v0;break;case"beforeblur":case"afterblur":m=v0;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=F1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=CM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=zM;break;case kE:case NE:case SE:m=OM;break;case TE:m=KM;break;case"scroll":case"scrollend":m=AM;break;case"wheel":m=YM;break;case"copy":case"cut":case"paste":m=DM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=U1;break;case"toggle":case"beforetoggle":m=QM}var p=(e&4)!==0,v=!p&&(t==="scroll"||t==="scrollend"),x=p?f!==null?f+"Capture":null:f;p=[];for(var g=u,y;g!==null;){var w=g;if(y=w.stateNode,w=w.tag,w!==5&&w!==26&&w!==27||y===null||x===null||(w=Du(g,x),w!=null&&p.push(Hu(g,w,y))),v)break;g=g.return}0<p.length&&(f=new m(f,b,null,s,d),h.push({event:f,listeners:p}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&s!==Hg&&(b=s.relatedTarget||s.fromElement)&&(Zo(b)||b[dc]))break e;if((m||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,m?(b=s.relatedTarget||s.toElement,m=u,b=b?Zo(b):null,b!==null&&(v=wd(b),p=b.tag,b!==v||p!==5&&p!==27&&p!==6)&&(b=null)):(m=null,b=u),m!==b)){if(p=F1,w="onMouseLeave",x="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(p=U1,w="onPointerLeave",x="onPointerEnter",g="pointer"),v=m==null?f:eu(m),y=b==null?f:eu(b),f=new p(w,g+"leave",m,s,d),f.target=v,f.relatedTarget=y,w=null,Zo(d)===u&&(p=new p(x,g+"enter",b,s,d),p.target=y,p.relatedTarget=v,w=p),v=w,m&&b)t:{for(p=X4,x=m,g=b,y=0,w=x;w;w=p(w))y++;w=0;for(var k=g;k;k=p(k))w++;for(;0<y-w;)x=p(x),y--;for(;0<w-y;)g=p(g),w--;for(;y--;){if(x===g||g!==null&&x===g.alternate){p=x;break t}x=p(x),g=p(g)}p=null}else p=null;m!==null&&Iw(h,f,m,p,!1),b!==null&&v!==null&&Iw(h,v,b,p,!0)}}e:{if(f=u?eu(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var N=z1;else if(H1(f))if(bE)N=o4;else{N=r4;var _=i4}else m=f.nodeName,!m||m.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?u&&Zb(u.elementType)&&(N=z1):N=a4;if(N&&(N=N(t,u))){xE(h,N,s,d);break e}_&&_(t,f,u),t==="focusout"&&u&&f.type==="number"&&u.memoizedProps.value!=null&&Gg(f,"number",f.value)}switch(_=u?eu(u):window,t){case"focusin":(H1(_)||_.contentEditable==="true")&&(sl=_,qg=u,uu=null);break;case"focusout":uu=qg=sl=null;break;case"mousedown":Kg=!0;break;case"contextmenu":case"mouseup":case"dragend":Kg=!1,X1(h,s,d);break;case"selectionchange":if(c4)break;case"keydown":case"keyup":X1(h,s,d)}var T;if(nv)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else tl?pE(t,s)&&(E="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(E="onCompositionStart");E&&(mE&&s.locale!=="ko"&&(tl||E!=="onCompositionStart"?E==="onCompositionEnd"&&tl&&(T=fE()):(Lr=d,tv="value"in Lr?Lr.value:Lr.textContent,tl=!0)),_=Uf(u,E),0<_.length&&(E=new B1(E,t,null,s,d),h.push({event:E,listeners:_}),T?E.data=T:(T=gE(s),T!==null&&(E.data=T)))),(T=ZM?e4(t,s):t4(t,s))&&(E=Uf(u,"onBeforeInput"),0<E.length&&(_=new B1("onBeforeInput","beforeinput",null,s,d),h.push({event:_,listeners:E}),_.data=T)),q4(h,t,u,s,d)}hA(h,e)})}function Hu(t,e,s){return{instance:t,listener:e,currentTarget:s}}function Uf(t,e){for(var s=e+"Capture",n=[];t!==null;){var i=t,r=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||r===null||(i=Du(t,s),i!=null&&n.unshift(Hu(t,i,r)),i=Du(t,e),i!=null&&n.push(Hu(t,i,r))),t.tag===3)return n;t=t.return}return[]}function X4(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Iw(t,e,s,n,i){for(var r=e._reactName,a=[];s!==null&&s!==n;){var l=s,c=l.alternate,u=l.stateNode;if(l=l.tag,c!==null&&c===n)break;l!==5&&l!==26&&l!==27||u===null||(c=u,i?(u=Du(s,r),u!=null&&a.unshift(Hu(s,u,c))):i||(u=Du(s,r),u!=null&&a.push(Hu(s,u,c)))),s=s.return}a.length!==0&&t.push({event:e,listeners:a})}var Q4=/\r\n?/g,J4=/\u0000|\uFFFD/g;function Ow(t){return(typeof t=="string"?t:""+t).replace(Q4,`
`).replace(J4,"")}function mA(t,e){return e=Ow(e),Ow(t)===e}function st(t,e,s,n,i,r){switch(s){case"children":typeof n=="string"?e==="body"||e==="textarea"&&n===""||Vl(t,n):(typeof n=="number"||typeof n=="bigint")&&e!=="body"&&Vl(t,""+n);break;case"className":vh(t,"class",n);break;case"tabIndex":vh(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":vh(t,s,n);break;case"style":dE(t,n,r);break;case"data":if(e!=="object"){vh(t,"data",n);break}case"src":case"href":if(n===""&&(e!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=qh(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof r=="function"&&(s==="formAction"?(e!=="input"&&st(t,e,"name",i.name,i,null),st(t,e,"formEncType",i.formEncType,i,null),st(t,e,"formMethod",i.formMethod,i,null),st(t,e,"formTarget",i.formTarget,i,null)):(st(t,e,"encType",i.encType,i,null),st(t,e,"method",i.method,i,null),st(t,e,"target",i.target,i,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=qh(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=Mi);break;case"onScroll":n!=null&&je("scroll",t);break;case"onScrollEnd":n!=null&&je("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(X(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(X(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=qh(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":je("beforetoggle",t),je("toggle",t),zh(t,"popover",n);break;case"xlinkActuate":ki(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ki(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ki(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ki(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ki(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ki(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ki(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ki(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ki(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":zh(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=TM.get(s)||s,zh(t,s,n))}}function xx(t,e,s,n,i,r){switch(s){case"style":dE(t,n,r);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(X(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(X(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Vl(t,n):(typeof n=="number"||typeof n=="bigint")&&Vl(t,""+n);break;case"onScroll":n!=null&&je("scroll",t);break;case"onScrollEnd":n!=null&&je("scrollend",t);break;case"onClick":n!=null&&(t.onclick=Mi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!rE.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(i=s.endsWith("Capture"),e=s.slice(2,i?s.length-7:void 0),r=t[$s]||null,r=r!=null?r[s]:null,typeof r=="function"&&t.removeEventListener(e,r,i),typeof n=="function")){typeof r!="function"&&r!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(e,n,i);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):zh(t,s,n)}}}function gs(t,e,s){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":je("error",t),je("load",t);var n=!1,i=!1,r;for(r in s)if(s.hasOwnProperty(r)){var a=s[r];if(a!=null)switch(r){case"src":n=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(X(137,e));default:st(t,e,r,a,s,null)}}i&&st(t,e,"srcSet",s.srcSet,s,null),n&&st(t,e,"src",s.src,s,null);return;case"input":je("invalid",t);var l=r=a=i=null,c=null,u=null;for(n in s)if(s.hasOwnProperty(n)){var d=s[n];if(d!=null)switch(n){case"name":i=d;break;case"type":a=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":r=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(d!=null)throw Error(X(137,e));break;default:st(t,e,n,d,s,null)}}lE(t,r,l,c,u,a,i,!1);return;case"select":je("invalid",t),n=a=r=null;for(i in s)if(s.hasOwnProperty(i)&&(l=s[i],l!=null))switch(i){case"value":r=l;break;case"defaultValue":a=l;break;case"multiple":n=l;default:st(t,e,i,l,s,null)}e=r,s=a,t.multiple=!!n,e!=null?_l(t,!!n,e,!1):s!=null&&_l(t,!!n,s,!0);return;case"textarea":je("invalid",t),r=i=n=null;for(a in s)if(s.hasOwnProperty(a)&&(l=s[a],l!=null))switch(a){case"value":n=l;break;case"defaultValue":i=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(l!=null)throw Error(X(91));break;default:st(t,e,a,l,s,null)}uE(t,n,i,r);return;case"option":for(c in s)if(s.hasOwnProperty(c)&&(n=s[c],n!=null))switch(c){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:st(t,e,c,n,s,null)}return;case"dialog":je("beforetoggle",t),je("toggle",t),je("cancel",t),je("close",t);break;case"iframe":case"object":je("load",t);break;case"video":case"audio":for(n=0;n<Gu.length;n++)je(Gu[n],t);break;case"image":je("error",t),je("load",t);break;case"details":je("toggle",t);break;case"embed":case"source":case"link":je("error",t),je("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in s)if(s.hasOwnProperty(u)&&(n=s[u],n!=null))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(X(137,e));default:st(t,e,u,n,s,null)}return;default:if(Zb(e)){for(d in s)s.hasOwnProperty(d)&&(n=s[d],n!==void 0&&xx(t,e,d,n,s,void 0));return}}for(l in s)s.hasOwnProperty(l)&&(n=s[l],n!=null&&st(t,e,l,n,s,null))}function Z4(t,e,s,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,r=null,a=null,l=null,c=null,u=null,d=null;for(m in s){var h=s[m];if(s.hasOwnProperty(m)&&h!=null)switch(m){case"checked":break;case"value":break;case"defaultValue":c=h;default:n.hasOwnProperty(m)||st(t,e,m,null,n,h)}}for(var f in n){var m=n[f];if(h=s[f],n.hasOwnProperty(f)&&(m!=null||h!=null))switch(f){case"type":r=m;break;case"name":i=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":a=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(m!=null)throw Error(X(137,e));break;default:m!==h&&st(t,e,f,m,n,h)}}$g(t,a,l,c,u,d,r,i);return;case"select":m=a=l=f=null;for(r in s)if(c=s[r],s.hasOwnProperty(r)&&c!=null)switch(r){case"value":break;case"multiple":m=c;default:n.hasOwnProperty(r)||st(t,e,r,null,n,c)}for(i in n)if(r=n[i],c=s[i],n.hasOwnProperty(i)&&(r!=null||c!=null))switch(i){case"value":f=r;break;case"defaultValue":l=r;break;case"multiple":a=r;default:r!==c&&st(t,e,i,r,n,c)}e=l,s=a,n=m,f!=null?_l(t,!!s,f,!1):!!n!=!!s&&(e!=null?_l(t,!!s,e,!0):_l(t,!!s,s?[]:"",!1));return;case"textarea":m=f=null;for(l in s)if(i=s[l],s.hasOwnProperty(l)&&i!=null&&!n.hasOwnProperty(l))switch(l){case"value":break;case"children":break;default:st(t,e,l,null,n,i)}for(a in n)if(i=n[a],r=s[a],n.hasOwnProperty(a)&&(i!=null||r!=null))switch(a){case"value":f=i;break;case"defaultValue":m=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(X(91));break;default:i!==r&&st(t,e,a,i,n,r)}cE(t,f,m);return;case"option":for(var b in s)if(f=s[b],s.hasOwnProperty(b)&&f!=null&&!n.hasOwnProperty(b))switch(b){case"selected":t.selected=!1;break;default:st(t,e,b,null,n,f)}for(c in n)if(f=n[c],m=s[c],n.hasOwnProperty(c)&&f!==m&&(f!=null||m!=null))switch(c){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:st(t,e,c,f,n,m)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var p in s)f=s[p],s.hasOwnProperty(p)&&f!=null&&!n.hasOwnProperty(p)&&st(t,e,p,null,n,f);for(u in n)if(f=n[u],m=s[u],n.hasOwnProperty(u)&&f!==m&&(f!=null||m!=null))switch(u){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(X(137,e));break;default:st(t,e,u,f,n,m)}return;default:if(Zb(e)){for(var v in s)f=s[v],s.hasOwnProperty(v)&&f!==void 0&&!n.hasOwnProperty(v)&&xx(t,e,v,void 0,n,f);for(d in n)f=n[d],m=s[d],!n.hasOwnProperty(d)||f===m||f===void 0&&m===void 0||xx(t,e,d,f,n,m);return}}for(var x in s)f=s[x],s.hasOwnProperty(x)&&f!=null&&!n.hasOwnProperty(x)&&st(t,e,x,null,n,f);for(h in n)f=n[h],m=s[h],!n.hasOwnProperty(h)||f===m||f==null&&m==null||st(t,e,h,f,n,m)}function Mw(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function eD(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var i=s[n],r=i.transferSize,a=i.initiatorType,l=i.duration;if(r&&l&&Mw(a)){for(a=0,l=i.responseEnd,n+=1;n<s.length;n++){var c=s[n],u=c.startTime;if(u>l)break;var d=c.transferSize,h=c.initiatorType;d&&Mw(h)&&(c=c.responseEnd,a+=d*(c<l?1:(l-u)/(c-u)))}if(--n,e+=8*(r+a)/(i.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var bx=null,vx=null;function $f(t){return t.nodeType===9?t:t.ownerDocument}function Dw(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function pA(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function yx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var z0=null;function tD(){var t=window.event;return t&&t.type==="popstate"?t===z0?!1:(z0=t,!0):(z0=null,!1)}var gA=typeof setTimeout=="function"?setTimeout:void 0,sD=typeof clearTimeout=="function"?clearTimeout:void 0,Lw=typeof Promise=="function"?Promise:void 0,nD=typeof queueMicrotask=="function"?queueMicrotask:typeof Lw<"u"?function(t){return Lw.resolve(null).then(t).catch(iD)}:gA;function iD(t){setTimeout(function(){throw t})}function Ta(t){return t==="head"}function Pw(t,e){var s=e,n=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(i),ql(e);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")yu(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,yu(s);for(var r=s.firstChild;r;){var a=r.nextSibling,l=r.nodeName;r[Td]||l==="SCRIPT"||l==="STYLE"||l==="LINK"&&r.rel.toLowerCase()==="stylesheet"||s.removeChild(r),r=a}}else s==="body"&&yu(t.ownerDocument.body);s=i}while(s);ql(e)}function Vw(t,e){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?e?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(e?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function _x(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var s=e;switch(e=e.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":_x(s),Jb(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function rD(t,e,s,n){for(;t.nodeType===1;){var i=s;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[Td])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(r=t.getAttribute("rel"),r==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(r!==i.rel||t.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||t.getAttribute("title")!==(i.title==null?null:i.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(r=t.getAttribute("src"),(r!==(i.src==null?null:i.src)||t.getAttribute("type")!==(i.type==null?null:i.type)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var r=i.name==null?null:""+i.name;if(i.type==="hidden"&&t.getAttribute("name")===r)return t}else return t;if(t=Nn(t.nextSibling),t===null)break}return null}function aD(t,e,s){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Nn(t.nextSibling),t===null))return null;return t}function xA(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=Nn(t.nextSibling),t===null))return null;return t}function wx(t){return t.data==="$?"||t.data==="$~"}function kx(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function oD(t,e){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||s.readyState!=="loading")e();else{var n=function(){e(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function Nn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var Nx=null;function Fw(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(e===0)return Nn(t.nextSibling);e--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||e++}t=t.nextSibling}return null}function Bw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(e===0)return t;e--}else s!=="/$"&&s!=="/&"||e++}t=t.previousSibling}return null}function bA(t,e,s){switch(e=$f(s),t){case"html":if(t=e.documentElement,!t)throw Error(X(452));return t;case"head":if(t=e.head,!t)throw Error(X(453));return t;case"body":if(t=e.body,!t)throw Error(X(454));return t;default:throw Error(X(451))}}function yu(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Jb(t)}var Cn=new Map,Uw=new Set;function Gf(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var dr=$e.d;$e.d={f:lD,r:cD,D:uD,C:dD,L:hD,m:fD,X:pD,S:mD,M:gD};function lD(){var t=dr.f(),e=lp();return t||e}function cD(t){var e=hc(t);e!==null&&e.tag===5&&e.type==="form"?d2(e):dr.r(t)}var gc=typeof document>"u"?null:document;function vA(t,e,s){var n=gc;if(n&&typeof e=="string"&&e){var i=xn(e);i='link[rel="'+t+'"][href="'+i+'"]',typeof s=="string"&&(i+='[crossorigin="'+s+'"]'),Uw.has(i)||(Uw.add(i),t={rel:t,crossOrigin:s,href:e},n.querySelector(i)===null&&(e=n.createElement("link"),gs(e,"link",t),is(e),n.head.appendChild(e)))}}function uD(t){dr.D(t),vA("dns-prefetch",t,null)}function dD(t,e){dr.C(t,e),vA("preconnect",t,e)}function hD(t,e,s){dr.L(t,e,s);var n=gc;if(n&&t&&e){var i='link[rel="preload"][as="'+xn(e)+'"]';e==="image"&&s&&s.imageSrcSet?(i+='[imagesrcset="'+xn(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(i+='[imagesizes="'+xn(s.imageSizes)+'"]')):i+='[href="'+xn(t)+'"]';var r=i;switch(e){case"style":r=zl(t);break;case"script":r=xc(t)}Cn.has(r)||(t=vt({rel:"preload",href:e==="image"&&s&&s.imageSrcSet?void 0:t,as:e},s),Cn.set(r,t),n.querySelector(i)!==null||e==="style"&&n.querySelector(Id(r))||e==="script"&&n.querySelector(Od(r))||(e=n.createElement("link"),gs(e,"link",t),is(e),n.head.appendChild(e)))}}function fD(t,e){dr.m(t,e);var s=gc;if(s&&t){var n=e&&typeof e.as=="string"?e.as:"script",i='link[rel="modulepreload"][as="'+xn(n)+'"][href="'+xn(t)+'"]',r=i;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=xc(t)}if(!Cn.has(r)&&(t=vt({rel:"modulepreload",href:t},e),Cn.set(r,t),s.querySelector(i)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(Od(r)))return}n=s.createElement("link"),gs(n,"link",t),is(n),s.head.appendChild(n)}}}function mD(t,e,s){dr.S(t,e,s);var n=gc;if(n&&t){var i=yl(n).hoistableStyles,r=zl(t);e=e||"default";var a=i.get(r);if(!a){var l={loading:0,preload:null};if(a=n.querySelector(Id(r)))l.loading=5;else{t=vt({rel:"stylesheet",href:t,"data-precedence":e},s),(s=Cn.get(r))&&Pv(t,s);var c=a=n.createElement("link");is(c),gs(c,"link",t),c._p=new Promise(function(u,d){c.onload=u,c.onerror=d}),c.addEventListener("load",function(){l.loading|=1}),c.addEventListener("error",function(){l.loading|=2}),l.loading|=4,sf(a,e,n)}a={type:"stylesheet",instance:a,count:1,state:l},i.set(r,a)}}}function pD(t,e){dr.X(t,e);var s=gc;if(s&&t){var n=yl(s).hoistableScripts,i=xc(t),r=n.get(i);r||(r=s.querySelector(Od(i)),r||(t=vt({src:t,async:!0},e),(e=Cn.get(i))&&Vv(t,e),r=s.createElement("script"),is(r),gs(r,"link",t),s.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(i,r))}}function gD(t,e){dr.M(t,e);var s=gc;if(s&&t){var n=yl(s).hoistableScripts,i=xc(t),r=n.get(i);r||(r=s.querySelector(Od(i)),r||(t=vt({src:t,async:!0,type:"module"},e),(e=Cn.get(i))&&Vv(t,e),r=s.createElement("script"),is(r),gs(r,"link",t),s.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(i,r))}}function $w(t,e,s,n){var i=(i=Hr.current)?Gf(i):null;if(!i)throw Error(X(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(e=zl(s.href),s=yl(i).hoistableStyles,n=s.get(e),n||(n={type:"style",instance:null,count:0,state:null},s.set(e,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=zl(s.href);var r=yl(i).hoistableStyles,a=r.get(t);if(a||(i=i.ownerDocument||i,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},r.set(t,a),(r=i.querySelector(Id(t)))&&!r._p&&(a.instance=r,a.state.loading=5),Cn.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Cn.set(t,s),r||xD(i,t,s,a.state))),e&&n===null)throw Error(X(528,""));return a}if(e&&n!==null)throw Error(X(529,""));return null;case"script":return e=s.async,s=s.src,typeof s=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=xc(s),s=yl(i).hoistableScripts,n=s.get(e),n||(n={type:"script",instance:null,count:0,state:null},s.set(e,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(X(444,t))}}function zl(t){return'href="'+xn(t)+'"'}function Id(t){return'link[rel="stylesheet"]['+t+"]"}function yA(t){return vt({},t,{"data-precedence":t.precedence,precedence:null})}function xD(t,e,s,n){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?n.loading=1:(e=t.createElement("link"),n.preload=e,e.addEventListener("load",function(){return n.loading|=1}),e.addEventListener("error",function(){return n.loading|=2}),gs(e,"link",s),is(e),t.head.appendChild(e))}function xc(t){return'[src="'+xn(t)+'"]'}function Od(t){return"script[async]"+t}function Gw(t,e,s){if(e.count++,e.instance===null)switch(e.type){case"style":var n=t.querySelector('style[data-href~="'+xn(s.href)+'"]');if(n)return e.instance=n,is(n),n;var i=vt({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),is(n),gs(n,"style",i),sf(n,s.precedence,t),e.instance=n;case"stylesheet":i=zl(s.href);var r=t.querySelector(Id(i));if(r)return e.state.loading|=4,e.instance=r,is(r),r;n=yA(s),(i=Cn.get(i))&&Pv(n,i),r=(t.ownerDocument||t).createElement("link"),is(r);var a=r;return a._p=new Promise(function(l,c){a.onload=l,a.onerror=c}),gs(r,"link",n),e.state.loading|=4,sf(r,s.precedence,t),e.instance=r;case"script":return r=xc(s.src),(i=t.querySelector(Od(r)))?(e.instance=i,is(i),i):(n=s,(i=Cn.get(r))&&(n=vt({},s),Vv(n,i)),t=t.ownerDocument||t,i=t.createElement("script"),is(i),gs(i,"link",n),t.head.appendChild(i),e.instance=i);case"void":return null;default:throw Error(X(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(n=e.instance,e.state.loading|=4,sf(n,s.precedence,t));return e.instance}function sf(t,e,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=n.length?n[n.length-1]:null,r=i,a=0;a<n.length;a++){var l=n[a];if(l.dataset.precedence===e)r=l;else if(r!==i)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=s.nodeType===9?s.head:s,e.insertBefore(t,e.firstChild))}function Pv(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function Vv(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var nf=null;function Hw(t,e,s){if(nf===null){var n=new Map,i=nf=new Map;i.set(s,n)}else i=nf,n=i.get(s),n||(n=new Map,i.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),i=0;i<s.length;i++){var r=s[i];if(!(r[Td]||r[hs]||t==="link"&&r.getAttribute("rel")==="stylesheet")&&r.namespaceURI!=="http://www.w3.org/2000/svg"){var a=r.getAttribute(e)||"";a=t+a;var l=n.get(a);l?l.push(r):n.set(a,[r])}}return n}function zw(t,e,s){t=t.ownerDocument||t,t.head.insertBefore(s,e==="title"?t.querySelector("head > title"):null)}function bD(t,e,s){if(s===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function _A(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function vD(t,e,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&!(s.state.loading&4)){if(s.instance===null){var i=zl(n.href),r=e.querySelector(Id(i));if(r){e=r._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=Hf.bind(t),e.then(t,t)),s.state.loading|=4,s.instance=r,is(r);return}r=e.ownerDocument||e,n=yA(n),(i=Cn.get(i))&&Pv(n,i),r=r.createElement("link"),is(r);var a=r;a._p=new Promise(function(l,c){a.onload=l,a.onerror=c}),gs(r,"link",n),s.instance=r}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,e),(e=s.state.preload)&&!(s.state.loading&3)&&(t.count++,s=Hf.bind(t),e.addEventListener("load",s),e.addEventListener("error",s))}}var q0=0;function yD(t,e){return t.stylesheets&&t.count===0&&rf(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&rf(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4+e);0<t.imgBytes&&q0===0&&(q0=62500*eD());var i=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&rf(t,t.stylesheets),t.unsuspend)){var r=t.unsuspend;t.unsuspend=null,r()}},(t.imgBytes>q0?50:800)+e);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(i)}}:null}function Hf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)rf(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var zf=null;function rf(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,zf=new Map,e.forEach(_D,t),zf=null,Hf.call(t))}function _D(t,e){if(!(e.state.loading&4)){var s=zf.get(t);if(s)var n=s.get(null);else{s=new Map,zf.set(t,s);for(var i=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<i.length;r++){var a=i[r];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(s.set(a.dataset.precedence,a),n=a)}n&&s.set(null,n)}i=e.instance,a=i.getAttribute("data-precedence"),r=s.get(a)||n,r===n&&s.set(null,i),s.set(a,i),this.count++,n=Hf.bind(this),i.addEventListener("load",n),i.addEventListener("error",n),r?r.parentNode.insertBefore(i,r.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(i,t.firstChild)),e.state.loading|=4}}var zu={$$typeof:Oi,Provider:null,Consumer:null,_currentValue:eo,_currentValue2:eo,_threadCount:0};function wD(t,e,s,n,i,r,a,l,c){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=p0(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p0(0),this.hiddenUpdates=p0(null),this.identifierPrefix=n,this.onUncaughtError=i,this.onCaughtError=r,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=c,this.incompleteTransitions=new Map}function wA(t,e,s,n,i,r,a,l,c,u,d,h){return t=new wD(t,e,s,a,c,u,d,h,l),e=1,r===!0&&(e|=24),r=Xs(3,null,null,e),t.current=r,r.stateNode=t,e=uv(),e.refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:n,isDehydrated:s,cache:e},fv(r),t}function kA(t){return t?(t=rl,t):rl}function NA(t,e,s,n,i,r){i=kA(i),n.context===null?n.context=i:n.pendingContext=i,n=qr(e),n.payload={element:s},r=r===void 0?null:r,r!==null&&(n.callback=r),s=Kr(t,n,e),s!==null&&(Fs(s,t,e),hu(s,t,e))}function qw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function Fv(t,e){qw(t,e),(t=t.alternate)&&qw(t,e)}function SA(t){if(t.tag===13||t.tag===31){var e=Co(t,67108864);e!==null&&Fs(e,t,67108864),Fv(t,67108864)}}function Kw(t){if(t.tag===13||t.tag===31){var e=an();e=Xb(e);var s=Co(t,e);s!==null&&Fs(s,t,e),Fv(t,e)}}var qf=!0;function kD(t,e,s,n){var i=ye.T;ye.T=null;var r=$e.p;try{$e.p=2,Bv(t,e,s,n)}finally{$e.p=r,ye.T=i}}function ND(t,e,s,n){var i=ye.T;ye.T=null;var r=$e.p;try{$e.p=8,Bv(t,e,s,n)}finally{$e.p=r,ye.T=i}}function Bv(t,e,s,n){if(qf){var i=Sx(n);if(i===null)H0(t,e,n,Kf,s),Ww(t,n);else if(TD(i,t,e,s,n))n.stopPropagation();else if(Ww(t,n),e&4&&-1<SD.indexOf(t)){for(;i!==null;){var r=hc(i);if(r!==null)switch(r.tag){case 3:if(r=r.stateNode,r.current.memoizedState.isDehydrated){var a=Ua(r.pendingLanes);if(a!==0){var l=r;for(l.pendingLanes|=2,l.entangledLanes|=2;a;){var c=1<<31-rn(a);l.entanglements[1]|=c,a&=~c}xi(r),!(Ue&6)&&(Lf=sn()+500,Rd(0))}}break;case 31:case 13:l=Co(r,2),l!==null&&Fs(l,r,2),lp(),Fv(r,2)}if(r=Sx(n),r===null&&H0(t,e,n,Kf,s),r===i)break;i=r}i!==null&&n.stopPropagation()}else H0(t,e,n,null,s)}}function Sx(t){return t=ev(t),Uv(t)}var Kf=null;function Uv(t){if(Kf=null,t=Zo(t),t!==null){var e=wd(t);if(e===null)t=null;else{var s=e.tag;if(s===13){if(t=zT(e),t!==null)return t;t=null}else if(s===31){if(t=qT(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return Kf=t,null}function TA(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(uM()){case XT:return 2;case QT:return 8;case wf:case dM:return 32;case JT:return 268435456;default:return 32}default:return 32}}var Tx=!1,Xr=null,Qr=null,Jr=null,qu=new Map,Ku=new Map,Cr=[],SD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ww(t,e){switch(t){case"focusin":case"focusout":Xr=null;break;case"dragenter":case"dragleave":Qr=null;break;case"mouseover":case"mouseout":Jr=null;break;case"pointerover":case"pointerout":qu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ku.delete(e.pointerId)}}function qc(t,e,s,n,i,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:s,eventSystemFlags:n,nativeEvent:r,targetContainers:[i]},e!==null&&(e=hc(e),e!==null&&SA(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function TD(t,e,s,n,i){switch(e){case"focusin":return Xr=qc(Xr,t,e,s,n,i),!0;case"dragenter":return Qr=qc(Qr,t,e,s,n,i),!0;case"mouseover":return Jr=qc(Jr,t,e,s,n,i),!0;case"pointerover":var r=i.pointerId;return qu.set(r,qc(qu.get(r)||null,t,e,s,n,i)),!0;case"gotpointercapture":return r=i.pointerId,Ku.set(r,qc(Ku.get(r)||null,t,e,s,n,i)),!0}return!1}function EA(t){var e=Zo(t.target);if(e!==null){var s=wd(e);if(s!==null){if(e=s.tag,e===13){if(e=zT(s),e!==null){t.blockedOn=e,I1(t.priority,function(){Kw(s)});return}}else if(e===31){if(e=qT(s),e!==null){t.blockedOn=e,I1(t.priority,function(){Kw(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function af(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=Sx(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Hg=n,s.target.dispatchEvent(n),Hg=null}else return e=hc(s),e!==null&&SA(e),t.blockedOn=s,!1;e.shift()}return!0}function Yw(t,e,s){af(t)&&s.delete(e)}function ED(){Tx=!1,Xr!==null&&af(Xr)&&(Xr=null),Qr!==null&&af(Qr)&&(Qr=null),Jr!==null&&af(Jr)&&(Jr=null),qu.forEach(Yw),Ku.forEach(Yw)}function Eh(t,e){t.blockedOn===e&&(t.blockedOn=null,Tx||(Tx=!0,Jt.unstable_scheduleCallback(Jt.unstable_NormalPriority,ED)))}var Ah=null;function Xw(t){Ah!==t&&(Ah=t,Jt.unstable_scheduleCallback(Jt.unstable_NormalPriority,function(){Ah===t&&(Ah=null);for(var e=0;e<t.length;e+=3){var s=t[e],n=t[e+1],i=t[e+2];if(typeof n!="function"){if(Uv(n||s)===null)continue;break}var r=hc(s);r!==null&&(t.splice(e,3),e-=3,ax(r,{pending:!0,data:i,method:s.method,action:n},n,i))}}))}function ql(t){function e(c){return Eh(c,t)}Xr!==null&&Eh(Xr,t),Qr!==null&&Eh(Qr,t),Jr!==null&&Eh(Jr,t),qu.forEach(e),Ku.forEach(e);for(var s=0;s<Cr.length;s++){var n=Cr[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Cr.length&&(s=Cr[0],s.blockedOn===null);)EA(s),s.blockedOn===null&&Cr.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var i=s[n],r=s[n+1],a=i[$s]||null;if(typeof r=="function")a||Xw(s);else if(a){var l=null;if(r&&r.hasAttribute("formAction")){if(i=r,a=r[$s]||null)l=a.formAction;else if(Uv(i)!==null)continue}else l=a.action;typeof l=="function"?s[n+1]=l:(s.splice(n,3),n-=3),Xw(s)}}}function AA(){function t(r){r.canIntercept&&r.info==="react-transition"&&r.intercept({handler:function(){return new Promise(function(a){return i=a})},focusReset:"manual",scroll:"manual"})}function e(){i!==null&&(i(),i=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var r=navigation.currentEntry;r&&r.url!=null&&navigation.navigate(r.url,{state:r.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,i=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),i!==null&&(i(),i=null)}}}function $v(t){this._internalRoot=t}dp.prototype.render=$v.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(X(409));var s=e.current,n=an();NA(s,n,t,e,null,null)};dp.prototype.unmount=$v.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;NA(t.current,2,null,t,null,null),lp(),e[dc]=null}};function dp(t){this._internalRoot=t}dp.prototype.unstable_scheduleHydration=function(t){if(t){var e=nE();t={blockedOn:null,target:t,priority:e};for(var s=0;s<Cr.length&&e!==0&&e<Cr[s].priority;s++);Cr.splice(s,0,t),s===0&&EA(t)}};var Qw=GT.version;if(Qw!=="19.2.3")throw Error(X(527,Qw,"19.2.3"));$e.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(X(188)):(t=Object.keys(t).join(","),Error(X(268,t)));return t=nM(e),t=t!==null?KT(t):null,t=t===null?null:t.stateNode,t};var AD={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:ye,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jh.isDisabled&&jh.supportsFiber)try{kd=jh.inject(AD),nn=jh}catch{}}Wm.createRoot=function(t,e){if(!HT(t))throw Error(X(299));var s=!1,n="",i=v2,r=y2,a=_2;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onUncaughtError!==void 0&&(i=e.onUncaughtError),e.onCaughtError!==void 0&&(r=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=wA(t,1,!1,null,null,s,n,null,i,r,a,AA),t[dc]=e.current,Lv(t),new $v(e)};Wm.hydrateRoot=function(t,e,s){if(!HT(t))throw Error(X(299));var n=!1,i="",r=v2,a=y2,l=_2,c=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(i=s.identifierPrefix),s.onUncaughtError!==void 0&&(r=s.onUncaughtError),s.onCaughtError!==void 0&&(a=s.onCaughtError),s.onRecoverableError!==void 0&&(l=s.onRecoverableError),s.formState!==void 0&&(c=s.formState)),e=wA(t,1,!0,e,s??null,n,i,c,r,a,l,AA),e.context=kA(null),s=e.current,n=an(),n=Xb(n),i=qr(n),i.callback=null,Kr(s,i,n),s=n,e.current.lanes=s,Sd(e,s),xi(e),t[dc]=e.current,Lv(t),new dp(e)};Wm.version="19.2.3";function jA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(jA)}catch(t){console.error(t)}}jA(),PT.exports=Wm;var jD=PT.exports;const CD=ET(jD);/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wu(){return Wu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Wu.apply(this,arguments)}var Br;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Br||(Br={}));const Jw="popstate";function RD(t){t===void 0&&(t={});function e(n,i){let{pathname:r,search:a,hash:l}=n.location;return Ex("",{pathname:r,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){return typeof i=="string"?i:CA(i)}return OD(e,s,null,t)}function Kt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Gv(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ID(){return Math.random().toString(36).substr(2,8)}function Zw(t,e){return{usr:t.state,key:t.key,idx:e}}function Ex(t,e,s,n){return s===void 0&&(s=null),Wu({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?bc(e):e,{state:s,key:e&&e.key||n||ID()})}function CA(t){let{pathname:e="/",search:s="",hash:n=""}=t;return s&&s!=="?"&&(e+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function bc(t){let e={};if(t){let s=t.indexOf("#");s>=0&&(e.hash=t.substr(s),t=t.substr(0,s));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function OD(t,e,s,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:r=!1}=n,a=i.history,l=Br.Pop,c=null,u=d();u==null&&(u=0,a.replaceState(Wu({},a.state,{idx:u}),""));function d(){return(a.state||{idx:null}).idx}function h(){l=Br.Pop;let v=d(),x=v==null?null:v-u;u=v,c&&c({action:l,location:p.location,delta:x})}function f(v,x){l=Br.Push;let g=Ex(p.location,v,x);u=d()+1;let y=Zw(g,u),w=p.createHref(g);try{a.pushState(y,"",w)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;i.location.assign(w)}r&&c&&c({action:l,location:p.location,delta:1})}function m(v,x){l=Br.Replace;let g=Ex(p.location,v,x);u=d();let y=Zw(g,u),w=p.createHref(g);a.replaceState(y,"",w),r&&c&&c({action:l,location:p.location,delta:0})}function b(v){let x=i.location.origin!=="null"?i.location.origin:i.location.href,g=typeof v=="string"?v:CA(v);return g=g.replace(/ $/,"%20"),Kt(x,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,x)}let p={get action(){return l},get location(){return t(i,a)},listen(v){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(Jw,h),c=v,()=>{i.removeEventListener(Jw,h),c=null}},createHref(v){return e(i,v)},createURL:b,encodeLocation(v){let x=b(v);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:f,replace:m,go(v){return a.go(v)}};return p}var ek;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ek||(ek={}));function MD(t,e,s){return s===void 0&&(s="/"),DD(t,e,s)}function DD(t,e,s,n){let i=typeof e=="string"?bc(e):e,r=OA(i.pathname||"/",s);if(r==null)return null;let a=RA(t);LD(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let u=WD(r);l=zD(a[c],u)}return l}function RA(t,e,s,n){e===void 0&&(e=[]),s===void 0&&(s=[]),n===void 0&&(n="");let i=(r,a,l)=>{let c={relativePath:l===void 0?r.path||"":l,caseSensitive:r.caseSensitive===!0,childrenIndex:a,route:r};c.relativePath.startsWith("/")&&(Kt(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=ro([n,c.relativePath]),d=s.concat(c);r.children&&r.children.length>0&&(Kt(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),RA(r.children,e,d,u)),!(r.path==null&&!r.index)&&e.push({path:u,score:GD(u,r.index),routesMeta:d})};return t.forEach((r,a)=>{var l;if(r.path===""||!((l=r.path)!=null&&l.includes("?")))i(r,a);else for(let c of IA(r.path))i(r,a,c)}),e}function IA(t){let e=t.split("/");if(e.length===0)return[];let[s,...n]=e,i=s.endsWith("?"),r=s.replace(/\?$/,"");if(n.length===0)return i?[r,""]:[r];let a=IA(n.join("/")),l=[];return l.push(...a.map(c=>c===""?r:[r,c].join("/"))),i&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function LD(t){t.sort((e,s)=>e.score!==s.score?s.score-e.score:HD(e.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}const PD=/^:[\w-]+$/,VD=3,FD=2,BD=1,UD=10,$D=-2,tk=t=>t==="*";function GD(t,e){let s=t.split("/"),n=s.length;return s.some(tk)&&(n+=$D),e&&(n+=FD),s.filter(i=>!tk(i)).reduce((i,r)=>i+(PD.test(r)?VD:r===""?BD:UD),n)}function HD(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function zD(t,e,s){let{routesMeta:n}=t,i={},r="/",a=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,d=r==="/"?e:e.slice(r.length)||"/",h=qD({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),f=c.route;if(!h)return null;Object.assign(i,h.params),a.push({params:i,pathname:ro([r,h.pathname]),pathnameBase:ZD(ro([r,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(r=ro([r,h.pathnameBase]))}return a}function qD(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,n]=KD(t.path,t.caseSensitive,t.end),i=e.match(s);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((u,d,h)=>{let{paramName:f,isOptional:m}=d;if(f==="*"){let p=l[h]||"";a=r.slice(0,r.length-p.length).replace(/(.)\/+$/,"$1")}const b=l[h];return m&&!b?u[f]=void 0:u[f]=(b||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:a,pattern:t}}function KD(t,e,s){e===void 0&&(e=!1),s===void 0&&(s=!0),Gv(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function WD(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Gv(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function OA(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,n=t.charAt(s);return n&&n!=="/"?null:t.slice(s)||"/"}const YD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,XD=t=>YD.test(t);function QD(t,e){e===void 0&&(e="/");let{pathname:s,search:n="",hash:i=""}=typeof t=="string"?bc(t):t,r;if(s)if(XD(s))r=s;else{if(s.includes("//")){let a=s;s=s.replace(/\/\/+/g,"/"),Gv(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+s))}s.startsWith("/")?r=sk(s.substring(1),"/"):r=sk(s,e)}else r=e;return{pathname:r,search:e3(n),hash:t3(i)}}function sk(t,e){let s=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function K0(t,e,s,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function JD(t){return t.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function MA(t,e){let s=JD(t);return e?s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase):s.map(n=>n.pathnameBase)}function DA(t,e,s,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=bc(t):(i=Wu({},t),Kt(!i.pathname||!i.pathname.includes("?"),K0("?","pathname","search",i)),Kt(!i.pathname||!i.pathname.includes("#"),K0("#","pathname","hash",i)),Kt(!i.search||!i.search.includes("#"),K0("#","search","hash",i)));let r=t===""||i.pathname==="",a=r?"/":i.pathname,l;if(a==null)l=s;else{let h=e.length-1;if(!n&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}l=h>=0?e[h]:"/"}let c=QD(i,l),u=a&&a!=="/"&&a.endsWith("/"),d=(r||a===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const ro=t=>t.join("/").replace(/\/\/+/g,"/"),ZD=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),e3=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,t3=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function s3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const LA=["post","put","patch","delete"];new Set(LA);const n3=["get",...LA];new Set(n3);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Yu(){return Yu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Yu.apply(this,arguments)}const Hv=S.createContext(null),i3=S.createContext(null),Md=S.createContext(null),hp=S.createContext(null),Ea=S.createContext({outlet:null,matches:[],isDataRoute:!1}),PA=S.createContext(null);function Dd(){return S.useContext(hp)!=null}function fp(){return Dd()||Kt(!1),S.useContext(hp).location}function VA(t){S.useContext(Md).static||S.useLayoutEffect(t)}function vc(){let{isDataRoute:t}=S.useContext(Ea);return t?x3():r3()}function r3(){Dd()||Kt(!1);let t=S.useContext(Hv),{basename:e,future:s,navigator:n}=S.useContext(Md),{matches:i}=S.useContext(Ea),{pathname:r}=fp(),a=JSON.stringify(MA(i,s.v7_relativeSplatPath)),l=S.useRef(!1);return VA(()=>{l.current=!0}),S.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let h=DA(u,JSON.parse(a),r,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:ro([e,h.pathname])),(d.replace?n.replace:n.push)(h,d.state,d)},[e,n,a,r,t])}function FA(){let{matches:t}=S.useContext(Ea),e=t[t.length-1];return e?e.params:{}}function a3(t,e){return o3(t,e)}function o3(t,e,s,n){Dd()||Kt(!1);let{navigator:i}=S.useContext(Md),{matches:r}=S.useContext(Ea),a=r[r.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let u=fp(),d;if(e){var h;let v=typeof e=="string"?bc(e):e;c==="/"||(h=v.pathname)!=null&&h.startsWith(c)||Kt(!1),d=v}else d=u;let f=d.pathname||"/",m=f;if(c!=="/"){let v=c.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(v.length).join("/")}let b=MD(t,{pathname:m}),p=h3(b&&b.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:ro([c,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:ro([c,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),r,s,n);return e&&p?S.createElement(hp.Provider,{value:{location:Yu({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Br.Pop}},p):p}function l3(){let t=g3(),e=s3(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),s?S.createElement("pre",{style:i},s):null,null)}const c3=S.createElement(l3,null);class u3 extends S.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,s){return s.location!==e.location||s.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:s.error,location:s.location,revalidation:e.revalidation||s.revalidation}}componentDidCatch(e,s){console.error("React Router caught the following error during render",e,s)}render(){return this.state.error!==void 0?S.createElement(Ea.Provider,{value:this.props.routeContext},S.createElement(PA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function d3(t){let{routeContext:e,match:s,children:n}=t,i=S.useContext(Hv);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),S.createElement(Ea.Provider,{value:e},n)}function h3(t,e,s,n){var i;if(e===void 0&&(e=[]),s===void 0&&(s=null),n===void 0&&(n=null),t==null){var r;if(!s)return null;if(s.errors)t=s.matches;else if((r=n)!=null&&r.v7_partialHydration&&e.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let a=t,l=(i=s)==null?void 0:i.errors;if(l!=null){let d=a.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);d>=0||Kt(!1),a=a.slice(0,Math.min(a.length,d+1))}let c=!1,u=-1;if(s&&n&&n.v7_partialHydration)for(let d=0;d<a.length;d++){let h=a[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:m}=s,b=h.route.loader&&f[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||b){c=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((d,h,f)=>{let m,b=!1,p=null,v=null;s&&(m=l&&h.route.id?l[h.route.id]:void 0,p=h.route.errorElement||c3,c&&(u<0&&f===0?(b3("route-fallback"),b=!0,v=null):u===f&&(b=!0,v=h.route.hydrateFallbackElement||null)));let x=e.concat(a.slice(0,f+1)),g=()=>{let y;return m?y=p:b?y=v:h.route.Component?y=S.createElement(h.route.Component,null):h.route.element?y=h.route.element:y=d,S.createElement(d3,{match:h,routeContext:{outlet:d,matches:x,isDataRoute:s!=null},children:y})};return s&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?S.createElement(u3,{location:s.location,revalidation:s.revalidation,component:p,error:m,children:g(),routeContext:{outlet:null,matches:x,isDataRoute:!0}}):g()},null)}var BA=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(BA||{}),UA=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(UA||{});function f3(t){let e=S.useContext(Hv);return e||Kt(!1),e}function m3(t){let e=S.useContext(i3);return e||Kt(!1),e}function p3(t){let e=S.useContext(Ea);return e||Kt(!1),e}function $A(t){let e=p3(),s=e.matches[e.matches.length-1];return s.route.id||Kt(!1),s.route.id}function g3(){var t;let e=S.useContext(PA),s=m3(),n=$A();return e!==void 0?e:(t=s.errors)==null?void 0:t[n]}function x3(){let{router:t}=f3(BA.UseNavigateStable),e=$A(UA.UseNavigateStable),s=S.useRef(!1);return VA(()=>{s.current=!0}),S.useCallback(function(i,r){r===void 0&&(r={}),s.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Yu({fromRouteId:e},r)))},[t,e])}const nk={};function b3(t,e,s){nk[t]||(nk[t]=!0)}function v3(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function y3(t){let{to:e,replace:s,state:n,relative:i}=t;Dd()||Kt(!1);let{future:r,static:a}=S.useContext(Md),{matches:l}=S.useContext(Ea),{pathname:c}=fp(),u=vc(),d=DA(e,MA(l,r.v7_relativeSplatPath),c,i==="path"),h=JSON.stringify(d);return S.useEffect(()=>u(JSON.parse(h),{replace:s,state:n,relative:i}),[u,h,i,s,n]),null}function nu(t){Kt(!1)}function _3(t){let{basename:e="/",children:s=null,location:n,navigationType:i=Br.Pop,navigator:r,static:a=!1,future:l}=t;Dd()&&Kt(!1);let c=e.replace(/^\/*/,"/"),u=S.useMemo(()=>({basename:c,navigator:r,static:a,future:Yu({v7_relativeSplatPath:!1},l)}),[c,l,r,a]);typeof n=="string"&&(n=bc(n));let{pathname:d="/",search:h="",hash:f="",state:m=null,key:b="default"}=n,p=S.useMemo(()=>{let v=OA(d,c);return v==null?null:{location:{pathname:v,search:h,hash:f,state:m,key:b},navigationType:i}},[c,d,h,f,m,b,i]);return p==null?null:S.createElement(Md.Provider,{value:u},S.createElement(hp.Provider,{children:s,value:p}))}function w3(t){let{children:e,location:s}=t;return a3(Ax(e),s)}new Promise(()=>{});function Ax(t,e){e===void 0&&(e=[]);let s=[];return S.Children.forEach(t,(n,i)=>{if(!S.isValidElement(n))return;let r=[...e,i];if(n.type===S.Fragment){s.push.apply(s,Ax(n.props.children,r));return}n.type!==nu&&Kt(!1),!n.props.index||!n.props.children||Kt(!1);let a={id:n.props.id||r.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=Ax(n.props.children,r)),s.push(a)}),s}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jx(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,s)=>{let n=t[s];return e.concat(Array.isArray(n)?n.map(i=>[s,i]):[[s,n]])},[]))}function k3(t,e){let s=jx(t);return e&&e.forEach((n,i)=>{s.has(i)||e.getAll(i).forEach(r=>{s.append(i,r)})}),s}const N3="6";try{window.__reactRouterVersion=N3}catch{}const S3="startTransition",ik=QO[S3];function T3(t){let{basename:e,children:s,future:n,window:i}=t,r=S.useRef();r.current==null&&(r.current=RD({window:i,v5Compat:!0}));let a=r.current,[l,c]=S.useState({action:a.action,location:a.location}),{v7_startTransition:u}=n||{},d=S.useCallback(h=>{u&&ik?ik(()=>c(h)):c(h)},[c,u]);return S.useLayoutEffect(()=>a.listen(d),[a,d]),S.useEffect(()=>v3(n),[n]),S.createElement(_3,{basename:e,children:s,location:l.location,navigationType:l.action,navigator:a,future:n})}var rk;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(rk||(rk={}));var ak;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ak||(ak={}));function E3(t){let e=S.useRef(jx(t)),s=S.useRef(!1),n=fp(),i=S.useMemo(()=>k3(n.search,s.current?null:e.current),[n.search]),r=vc(),a=S.useCallback((l,c)=>{const u=jx(typeof l=="function"?l(i):l);s.current=!0,r("?"+u,c)},[r,i]);return[i,a]}const GA=S.createContext({setFullWidth:()=>{},setHideHeader:()=>{}}),HA=()=>S.useContext(GA),A3=({children:t})=>{const[,e]=S.useState(!1),[,s]=S.useState(!1);return o.jsx(GA.Provider,{value:{setFullWidth:e,setHideHeader:s},children:t})},j3=()=>{};var ok={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ee=function(t,e){if(!t)throw yc(e)},yc=function(t){return new Error("Firebase Database ("+zA.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qA=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):(i&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++n)&1023),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},C3=function(t){const e=[];let s=0,n=0;for(;s<t.length;){const i=t[s++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[s++];e[n++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[s++],a=t[s++],l=t[s++],c=((i&7)<<18|(r&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const r=t[s++],a=t[s++];e[n++]=String.fromCharCode((i&15)<<12|(r&63)<<6|a&63)}}return e.join("")},zv={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<t.length;i+=3){const r=t[i],a=i+1<t.length,l=a?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,d=r>>2,h=(r&3)<<4|l>>4;let f=(l&15)<<2|u>>6,m=u&63;c||(m=64,a||(f=64)),n.push(s[d],s[h],s[f],s[m])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(qA(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):C3(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<t.length;){const r=s[t.charAt(i++)],l=i<t.length?s[t.charAt(i)]:0;++i;const u=i<t.length?s[t.charAt(i)]:64;++i;const h=i<t.length?s[t.charAt(i)]:64;if(++i,r==null||l==null||u==null||h==null)throw new R3;const f=r<<2|l>>4;if(n.push(f),u!==64){const m=l<<4&240|u>>2;if(n.push(m),h!==64){const b=u<<6&192|h;n.push(b)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class R3 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const KA=function(t){const e=qA(t);return zv.encodeByteArray(e,!0)},Wf=function(t){return KA(t).replace(/\./g,"")},Yf=function(t){try{return zv.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I3(t){return WA(void 0,t)}function WA(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const s=e;return new Date(s.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const s in e)!e.hasOwnProperty(s)||!O3(s)||(t[s]=WA(t[s],e[s]));return t}function O3(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M3(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D3=()=>M3().__FIREBASE_DEFAULTS__,L3=()=>{if(typeof process>"u"||typeof ok>"u")return;const t=ok.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},P3=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Yf(t[1]);return e&&JSON.parse(e)},qv=()=>{try{return j3()||D3()||L3()||P3()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},YA=t=>{var e,s;return(s=(e=qv())===null||e===void 0?void 0:e.emulatorHosts)===null||s===void 0?void 0:s[t]},V3=t=>{const e=YA(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),n]:[e.substring(0,s),n]},XA=()=>{var t;return(t=qv())===null||t===void 0?void 0:t.config},QA=t=>{var e;return(e=qv())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,n)=>{s?this.reject(s):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function JA(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F3(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Wf(JSON.stringify(s)),Wf(JSON.stringify(a)),""].join(".")}const _u={};function B3(){const t={prod:[],emulator:[]};for(const e of Object.keys(_u))_u[e]?t.emulator.push(e):t.prod.push(e);return t}function U3(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let lk=!1;function ZA(t,e){if(typeof window>"u"||typeof document>"u"||!_c(window.location.host)||_u[t]===e||_u[t]||lk)return;_u[t]=e;function s(f){return`__firebase__banner__${f}`}const n="__firebase__banner",r=B3().prod.length>0;function a(){const f=document.getElementById(n);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{lk=!0,a()},f}function d(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=U3(n),m=s("text"),b=document.getElementById(m)||document.createElement("span"),p=s("learnmore"),v=document.getElementById(p)||document.createElement("a"),x=s("preprendIcon"),g=document.getElementById(x)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const y=f.element;l(y),d(v,p);const w=u();c(g,x),y.append(g,b,v,w),document.body.appendChild(y)}r?(b.innerText="Preview backend disconnected.",g.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(g.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Kv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Es())}function $3(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function G3(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function e5(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function H3(){const t=Es();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function z3(){return zA.NODE_ADMIN===!0}function q3(){try{return typeof indexedDB=="object"}catch{return!1}}function K3(){return new Promise((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W3="FirebaseError";class Aa extends Error{constructor(e,s,n){super(s),this.code=e,this.customData=n,this.name=W3,Object.setPrototypeOf(this,Aa.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ld.prototype.create)}}class Ld{constructor(e,s,n){this.service=e,this.serviceName=s,this.errors=n}create(e,...s){const n=s[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?Y3(r,n):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Aa(i,l,n)}}function Y3(t,e){return t.replace(X3,(s,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const X3=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(t){return JSON.parse(t)}function Qt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5=function(t){let e={},s={},n={},i="";try{const r=t.split(".");e=Xu(Yf(r[0])||""),s=Xu(Yf(r[1])||""),i=r[2],n=s.d||{},delete s.d}catch{}return{header:e,claims:s,data:n,signature:i}},Q3=function(t){const e=t5(t),s=e.claims;return!!s&&typeof s=="object"&&s.hasOwnProperty("iat")},J3=function(t){const e=t5(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function go(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Xf(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Qf(t,e,s){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=e.call(s,t[i],i,t));return n}function xo(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const i of s){if(!n.includes(i))return!1;const r=t[i],a=e[i];if(ck(r)&&ck(a)){if(!xo(r,a))return!1}else if(r!==a)return!1}for(const i of n)if(!s.includes(i))return!1;return!0}function ck(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function iu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,r]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function ru(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z3{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,s){s||(s=0);const n=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)n[h]=e.charCodeAt(s)<<24|e.charCodeAt(s+1)<<16|e.charCodeAt(s+2)<<8|e.charCodeAt(s+3),s+=4;else for(let h=0;h<16;h++)n[h]=e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3],s+=4;for(let h=16;h<80;h++){const f=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4],u,d;for(let h=0;h<80;h++){h<40?h<20?(u=l^r&(a^l),d=1518500249):(u=r^a^l,d=1859775393):h<60?(u=r&a|l&(r|a),d=2400959708):(u=r^a^l,d=3395469782);const f=(i<<5|i>>>27)+u+c+d+n[h]&4294967295;c=l,l=a,a=(r<<30|r>>>2)&4294967295,r=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,s){if(e==null)return;s===void 0&&(s=e.length);const n=s-this.blockSize;let i=0;const r=this.buf_;let a=this.inbuf_;for(;i<s;){if(a===0)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<s;)if(r[a]=e.charCodeAt(i),++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}else for(;i<s;)if(r[a]=e[i],++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}this.inbuf_=a,this.total_+=s}digest(){const e=[];let s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=s&255,s/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[i]>>r&255,++n;return e}}function eL(t,e){const s=new tL(t,e);return s.subscribe.bind(s)}class tL{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,n){let i;if(e===void 0&&s===void 0&&n===void 0)throw new Error("Missing Observer.");sL(e,["next","error","complete"])?i=e:i={next:e,error:s,complete:n},i.next===void 0&&(i.next=W0),i.error===void 0&&(i.error=W0),i.complete===void 0&&(i.complete=W0);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function sL(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function W0(){}function Kl(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nL=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);if(i>=55296&&i<=56319){const r=i-55296;n++,ee(n<t.length,"Surrogate pair missing trail surrogate.");const a=t.charCodeAt(n)-56320;i=65536+(r<<10)+a}i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):i<65536?(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},mp=function(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,s++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(t){return t&&t._delegate?t._delegate:t}class bo{constructor(e,s,n){this.name=e,this.instanceFactory=s,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const n=new Bn;if(this.instancesDeferred.set(s,n),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){var s;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(s=e==null?void 0:e.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(aL(e))try{this.getOrInitializeService({instanceIdentifier:Ha})}catch{}for(const[s,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const r=this.getOrInitializeService({instanceIdentifier:i});n.resolve(r)}catch{}}}}clearInstance(e=Ha){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ha){return this.instances.has(e)}getOptions(e=Ha){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:s});for(const[r,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);n===l&&a.resolve(i)}return i}onInit(e,s){var n;const i=this.normalizeInstanceIdentifier(s),r=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const a=this.instances.get(i);return a&&e(a,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,s){const n=this.onInitCallbacks.get(s);if(n)for(const i of n)try{i(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:rL(e),options:s}),this.instances.set(e,n),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Ha){return this.component?this.component.multipleInstances?e:Ha:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function rL(t){return t===Ha?void 0:t}function aL(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oL{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new iL(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var nt;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(nt||(nt={}));const lL={debug:nt.DEBUG,verbose:nt.VERBOSE,info:nt.INFO,warn:nt.WARN,error:nt.ERROR,silent:nt.SILENT},cL=nt.INFO,uL={[nt.DEBUG]:"log",[nt.VERBOSE]:"log",[nt.INFO]:"info",[nt.WARN]:"warn",[nt.ERROR]:"error"},dL=(t,e,...s)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),i=uL[e];if(i)console[i](`[${n}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Wv{constructor(e){this.name=e,this._logLevel=cL,this._logHandler=dL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in nt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,nt.DEBUG,...e),this._logHandler(this,nt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,nt.VERBOSE,...e),this._logHandler(this,nt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,nt.INFO,...e),this._logHandler(this,nt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,nt.WARN,...e),this._logHandler(this,nt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,nt.ERROR,...e),this._logHandler(this,nt.ERROR,...e)}}const hL=(t,e)=>e.some(s=>t instanceof s);let uk,dk;function fL(){return uk||(uk=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mL(){return dk||(dk=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const s5=new WeakMap,Cx=new WeakMap,n5=new WeakMap,Y0=new WeakMap,Yv=new WeakMap;function pL(t){const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",a)},r=()=>{s(Zr(t.result)),i()},a=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",a)});return e.then(s=>{s instanceof IDBCursor&&s5.set(s,t)}).catch(()=>{}),Yv.set(e,t),e}function gL(t){if(Cx.has(t))return;const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",a),t.removeEventListener("abort",a)},r=()=>{s(),i()},a=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",a),t.addEventListener("abort",a)});Cx.set(t,e)}let Rx={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return Cx.get(t);if(e==="objectStoreNames")return t.objectStoreNames||n5.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Zr(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function xL(t){Rx=t(Rx)}function bL(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const n=t.call(X0(this),e,...s);return n5.set(n,e.sort?e.sort():[e]),Zr(n)}:mL().includes(t)?function(...e){return t.apply(X0(this),e),Zr(s5.get(this))}:function(...e){return Zr(t.apply(X0(this),e))}}function vL(t){return typeof t=="function"?bL(t):(t instanceof IDBTransaction&&gL(t),hL(t,fL())?new Proxy(t,Rx):t)}function Zr(t){if(t instanceof IDBRequest)return pL(t);if(Y0.has(t))return Y0.get(t);const e=vL(t);return e!==t&&(Y0.set(t,e),Yv.set(e,t)),e}const X0=t=>Yv.get(t);function yL(t,e,{blocked:s,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(t,e),l=Zr(a);return n&&a.addEventListener("upgradeneeded",c=>{n(Zr(a.result),c.oldVersion,c.newVersion,Zr(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const _L=["get","getKey","getAll","getAllKeys","count"],wL=["put","add","delete","clear"],Q0=new Map;function hk(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Q0.get(e))return Q0.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,i=wL.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(i||_L.includes(s)))return;const r=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&c.done]))[0]};return Q0.set(e,r),r}xL(t=>({...t,get:(e,s,n)=>hk(e,s)||t.get(e,s,n),has:(e,s)=>!!hk(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(NL(s)){const n=s.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(s=>s).join(" ")}}function NL(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ix="@firebase/app",fk="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const er=new Wv("@firebase/app"),SL="@firebase/app-compat",TL="@firebase/analytics-compat",EL="@firebase/analytics",AL="@firebase/app-check-compat",jL="@firebase/app-check",CL="@firebase/auth",RL="@firebase/auth-compat",IL="@firebase/database",OL="@firebase/data-connect",ML="@firebase/database-compat",DL="@firebase/functions",LL="@firebase/functions-compat",PL="@firebase/installations",VL="@firebase/installations-compat",FL="@firebase/messaging",BL="@firebase/messaging-compat",UL="@firebase/performance",$L="@firebase/performance-compat",GL="@firebase/remote-config",HL="@firebase/remote-config-compat",zL="@firebase/storage",qL="@firebase/storage-compat",KL="@firebase/firestore",WL="@firebase/ai",YL="@firebase/firestore-compat",XL="firebase",QL="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ox="[DEFAULT]",JL={[Ix]:"fire-core",[SL]:"fire-core-compat",[EL]:"fire-analytics",[TL]:"fire-analytics-compat",[jL]:"fire-app-check",[AL]:"fire-app-check-compat",[CL]:"fire-auth",[RL]:"fire-auth-compat",[IL]:"fire-rtdb",[OL]:"fire-data-connect",[ML]:"fire-rtdb-compat",[DL]:"fire-fn",[LL]:"fire-fn-compat",[PL]:"fire-iid",[VL]:"fire-iid-compat",[FL]:"fire-fcm",[BL]:"fire-fcm-compat",[UL]:"fire-perf",[$L]:"fire-perf-compat",[GL]:"fire-rc",[HL]:"fire-rc-compat",[zL]:"fire-gcs",[qL]:"fire-gcs-compat",[KL]:"fire-fst",[YL]:"fire-fst-compat",[WL]:"fire-vertex","fire-js":"fire-js",[XL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf=new Map,ZL=new Map,Mx=new Map;function mk(t,e){try{t.container.addComponent(e)}catch(s){er.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function Wl(t){const e=t.name;if(Mx.has(e))return er.debug(`There were multiple attempts to register component ${e}.`),!1;Mx.set(e,t);for(const s of Jf.values())mk(s,t);for(const s of ZL.values())mk(s,t);return!0}function Xv(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function Qs(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ea=new Ld("app","Firebase",eP);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tP{constructor(e,s,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new bo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ea.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kc=QL;function i5(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const n=Object.assign({name:Ox,automaticDataCollectionEnabled:!0},e),i=n.name;if(typeof i!="string"||!i)throw ea.create("bad-app-name",{appName:String(i)});if(s||(s=XA()),!s)throw ea.create("no-options");const r=Jf.get(i);if(r){if(xo(s,r.options)&&xo(n,r.config))return r;throw ea.create("duplicate-app",{appName:i})}const a=new oL(i);for(const c of Mx.values())a.addComponent(c);const l=new tP(s,n,a);return Jf.set(i,l),l}function r5(t=Ox){const e=Jf.get(t);if(!e&&t===Ox&&XA())return i5();if(!e)throw ea.create("no-app",{appName:t});return e}function ta(t,e,s){var n;let i=(n=JL[t])!==null&&n!==void 0?n:t;s&&(i+=`-${s}`);const r=i.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const l=[`Unable to register library "${i}" with version "${e}":`];r&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),er.warn(l.join(" "));return}Wl(new bo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sP="firebase-heartbeat-database",nP=1,Qu="firebase-heartbeat-store";let J0=null;function a5(){return J0||(J0=yL(sP,nP,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Qu)}catch(s){console.warn(s)}}}}).catch(t=>{throw ea.create("idb-open",{originalErrorMessage:t.message})})),J0}async function iP(t){try{const s=(await a5()).transaction(Qu),n=await s.objectStore(Qu).get(o5(t));return await s.done,n}catch(e){if(e instanceof Aa)er.warn(e.message);else{const s=ea.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});er.warn(s.message)}}}async function pk(t,e){try{const n=(await a5()).transaction(Qu,"readwrite");await n.objectStore(Qu).put(e,o5(t)),await n.done}catch(s){if(s instanceof Aa)er.warn(s.message);else{const n=ea.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});er.warn(n.message)}}}function o5(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rP=1024,aP=30;class oP{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new cP(s),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=gk();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>aP){const a=uP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){er.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=gk(),{heartbeatsToSend:n,unsentEntries:i}=lP(this._heartbeatsCache.heartbeats),r=Wf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(s){return er.warn(s),""}}}function gk(){return new Date().toISOString().substring(0,10)}function lP(t,e=rP){const s=[];let n=t.slice();for(const i of t){const r=s.find(a=>a.agent===i.agent);if(r){if(r.dates.push(i.date),xk(s)>e){r.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),xk(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class cP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return q3()?K3().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await iP(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return pk(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return pk(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function xk(t){return Wf(JSON.stringify({version:2,heartbeats:t})).length}function uP(t){if(t.length===0)return-1;let e=0,s=t[0].date;for(let n=1;n<t.length;n++)t[n].date<s&&(s=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dP(t){Wl(new bo("platform-logger",e=>new kL(e),"PRIVATE")),Wl(new bo("heartbeat",e=>new oP(e),"PRIVATE")),ta(Ix,fk,t),ta(Ix,fk,"esm2017"),ta("fire-js","")}dP("");function Qv(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]]);return s}function ei(t,e,s,n){var i=arguments.length,r=i<3?e:n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,s,n);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(r=(i<3?a(r):i>3?a(e,s,r):a(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r}function Pt(t,e,s,n){function i(r){return r instanceof s?r:new s(function(a){a(r)})}return new(s||(s=Promise))(function(r,a){function l(d){try{u(n.next(d))}catch(h){a(h)}}function c(d){try{u(n.throw(d))}catch(h){a(h)}}function u(d){d.done?r(d.value):i(d.value).then(l,c)}u((n=n.apply(t,e||[])).next())})}function l5(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const hP=l5,c5=new Ld("auth","Firebase",l5());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zf=new Wv("@firebase/auth");function fP(t,...e){Zf.logLevel<=nt.WARN&&Zf.warn(`Auth (${kc}): ${t}`,...e)}function of(t,...e){Zf.logLevel<=nt.ERROR&&Zf.error(`Auth (${kc}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yn(t,...e){throw Jv(t,...e)}function li(t,...e){return Jv(t,...e)}function u5(t,e,s){const n=Object.assign(Object.assign({},hP()),{[e]:s});return new Ld("auth","Firebase",n).create(e,{appName:t.name})}function ci(t){return u5(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Jv(t,...e){if(typeof t!="string"){const s=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(s,...n)}return c5.create(t,...e)}function ge(t,e,...s){if(!t)throw Jv(e,...s)}function Li(t){const e="INTERNAL ASSERTION FAILED: "+t;throw of(e),new Error(e)}function tr(t,e){t||Li(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dx(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function mP(){return bk()==="http:"||bk()==="https:"}function bk(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(mP()||G3()||"connection"in navigator)?navigator.onLine:!0}function gP(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e,s){this.shortDelay=e,this.longDelay=s,tr(s>e,"Short delay should be less than long delay!"),this.isMobile=Kv()||e5()}get(){return pP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zv(t,e){tr(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{static initialize(e,s,n){this.fetchImpl=e,s&&(this.headersImpl=s),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Li("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Li("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Li("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],vP=new Pd(3e4,6e4);function hr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function fr(t,e,s,n,i={}){return h5(t,i,async()=>{let r={},a={};n&&(e==="GET"?a=n:r={body:JSON.stringify(n)});const l=wc(Object.assign({key:t.config.apiKey},a)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:c},r);return $3()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&_c(t.emulatorConfig.host)&&(u.credentials="include"),d5.fetch()(await f5(t,t.config.apiHost,s,l),u)})}async function h5(t,e,s){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},xP),e);try{const i=new _P(t),r=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw Ch(t,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const l=r.ok?a.errorMessage:a.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ch(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw Ch(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw Ch(t,"user-disabled",a);const d=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw u5(t,d,u);Yn(t,d)}}catch(i){if(i instanceof Aa)throw i;Yn(t,"network-request-failed",{message:String(i)})}}async function Vd(t,e,s,n,i={}){const r=await fr(t,e,s,n,i);return"mfaPendingCredential"in r&&Yn(t,"multi-factor-auth-required",{_serverResponse:r}),r}async function f5(t,e,s,n){const i=`${e}${s}?${n}`,r=t,a=r.config.emulator?Zv(t.config,i):`${t.config.apiScheme}://${i}`;return bP.includes(s)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}function yP(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _P{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,n)=>{this.timer=setTimeout(()=>n(li(this.auth,"network-request-failed")),vP.get())})}}function Ch(t,e,s){const n={appName:t.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const i=li(t,e,n);return i.customData._tokenResponse=s,i}function vk(t){return t!==void 0&&t.enterprise!==void 0}class wP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return yP(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function kP(t,e){return fr(t,"GET","/v2/recaptchaConfig",hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NP(t,e){return fr(t,"POST","/v1/accounts:delete",e)}async function em(t,e){return fr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function SP(t,e=!1){const s=Wt(t),n=await s.getIdToken(e),i=ey(n);ge(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,a=r==null?void 0:r.sign_in_provider;return{claims:i,token:n,authTime:wu(Z0(i.auth_time)),issuedAtTime:wu(Z0(i.iat)),expirationTime:wu(Z0(i.exp)),signInProvider:a||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Z0(t){return Number(t)*1e3}function ey(t){const[e,s,n]=t.split(".");if(e===void 0||s===void 0||n===void 0)return of("JWT malformed, contained fewer than 3 sections"),null;try{const i=Yf(s);return i?JSON.parse(i):(of("Failed to decode base64 JWT payload"),null)}catch(i){return of("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function yk(t){const e=ey(t);return ge(e,"internal-error"),ge(typeof e.exp<"u","internal-error"),ge(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ju(t,e,s=!1){if(s)return e;try{return await e}catch(n){throw n instanceof Aa&&TP(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function TP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EP{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var s;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=wu(this.lastLoginAt),this.creationTime=wu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zu(t){var e;const s=t.auth,n=await t.getIdToken(),i=await Ju(t,em(s,{idToken:n}));ge(i==null?void 0:i.users.length,s,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const a=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?m5(r.providerUserInfo):[],l=jP(t.providerData,a),c=t.isAnonymous,u=!(t.email&&r.passwordHash)&&!(l!=null&&l.length),d=c?u:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new Lx(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function AP(t){const e=Wt(t);await Zu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jP(t,e){return[...t.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function m5(t){return t.map(e=>{var{providerId:s}=e,n=Qv(e,["providerId"]);return{providerId:s,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CP(t,e){const s=await h5(t,{},async()=>{const n=wc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,a=await f5(t,i,"/v1/token",`key=${r}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:n};return t.emulatorConfig&&_c(t.emulatorConfig.host)&&(c.credentials="include"),d5.fetch()(a,c)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function RP(t,e){return fr(t,"POST","/v2/accounts:revokeToken",hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class El{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ge(e.idToken,"internal-error"),ge(typeof e.idToken<"u","internal-error"),ge(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):yk(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){ge(e.length!==0,"internal-error");const s=yk(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(ge(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:n,refreshToken:i,expiresIn:r}=await CP(e,s);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,s,n){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,s){const{refreshToken:n,accessToken:i,expirationTime:r}=s,a=new El;return n&&(ge(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),i&&(ge(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),r&&(ge(typeof r=="number","internal-error",{appName:e}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new El,this.toJSON())}_performRefresh(){return Li("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yr(t,e){ge(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class $n{constructor(e){var{uid:s,auth:n,stsTokenManager:i}=e,r=Qv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new EP(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Lx(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const s=await Ju(this,this.stsTokenManager.getToken(this.auth,e));return ge(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return SP(this,e)}reload(){return AP(this)}_assign(e){this!==e&&(ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>Object.assign({},s)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new $n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(e){ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),s&&await Zu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Qs(this.auth.app))return Promise.reject(ci(this.auth));const e=await this.getIdToken();return await Ju(this,NP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){var n,i,r,a,l,c,u,d;const h=(n=s.displayName)!==null&&n!==void 0?n:void 0,f=(i=s.email)!==null&&i!==void 0?i:void 0,m=(r=s.phoneNumber)!==null&&r!==void 0?r:void 0,b=(a=s.photoURL)!==null&&a!==void 0?a:void 0,p=(l=s.tenantId)!==null&&l!==void 0?l:void 0,v=(c=s._redirectEventId)!==null&&c!==void 0?c:void 0,x=(u=s.createdAt)!==null&&u!==void 0?u:void 0,g=(d=s.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:y,emailVerified:w,isAnonymous:k,providerData:N,stsTokenManager:_}=s;ge(y&&_,e,"internal-error");const T=El.fromJSON(this.name,_);ge(typeof y=="string",e,"internal-error"),yr(h,e.name),yr(f,e.name),ge(typeof w=="boolean",e,"internal-error"),ge(typeof k=="boolean",e,"internal-error"),yr(m,e.name),yr(b,e.name),yr(p,e.name),yr(v,e.name),yr(x,e.name),yr(g,e.name);const E=new $n({uid:y,auth:e,email:f,emailVerified:w,displayName:h,isAnonymous:k,photoURL:b,phoneNumber:m,tenantId:p,stsTokenManager:T,createdAt:x,lastLoginAt:g});return N&&Array.isArray(N)&&(E.providerData=N.map(A=>Object.assign({},A))),v&&(E._redirectEventId=v),E}static async _fromIdTokenResponse(e,s,n=!1){const i=new El;i.updateFromServerResponse(s);const r=new $n({uid:s.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Zu(r),r}static async _fromGetAccountInfoResponse(e,s,n){const i=s.users[0];ge(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?m5(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),l=new El;l.updateFromIdToken(n);const c=new $n({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Lx(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k=new Map;function Pi(t){tr(t instanceof Function,"Expected a class definition");let e=_k.get(t);return e?(tr(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,_k.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p5{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}p5.type="NONE";const wk=p5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lf(t,e,s){return`firebase:${t}:${e}:${s}`}class Al{constructor(e,s,n){this.persistence=e,this.auth=s,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=lf(this.userKey,i.apiKey,r),this.fullPersistenceKey=lf("persistence",i.apiKey,r),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await em(this.auth,{idToken:e}).catch(()=>{});return s?$n._fromGetAccountInfoResponse(this.auth,s,e):null}return $n._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,n="authUser"){if(!s.length)return new Al(Pi(wk),e,n);const i=(await Promise.all(s.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let r=i[0]||Pi(wk);const a=lf(n,e.config.apiKey,e.name);let l=null;for(const u of s)try{const d=await u._get(a);if(d){let h;if(typeof d=="string"){const f=await em(e,{idToken:d}).catch(()=>{});if(!f)break;h=await $n._fromGetAccountInfoResponse(e,f,d)}else h=$n._fromJSON(e,d);u!==r&&(l=h),r=u;break}}catch{}const c=i.filter(u=>u._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Al(r,e,n):(r=c[0],l&&await r._set(a,l.toJSON()),await Promise.all(s.map(async u=>{if(u!==r)try{await u._remove(a)}catch{}})),new Al(r,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kk(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(v5(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(g5(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_5(e))return"Blackberry";if(w5(e))return"Webos";if(x5(e))return"Safari";if((e.includes("chrome/")||b5(e))&&!e.includes("edge/"))return"Chrome";if(y5(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(s);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function g5(t=Es()){return/firefox\//i.test(t)}function x5(t=Es()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function b5(t=Es()){return/crios\//i.test(t)}function v5(t=Es()){return/iemobile/i.test(t)}function y5(t=Es()){return/android/i.test(t)}function _5(t=Es()){return/blackberry/i.test(t)}function w5(t=Es()){return/webos/i.test(t)}function ty(t=Es()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function IP(t=Es()){var e;return ty(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function OP(){return H3()&&document.documentMode===10}function k5(t=Es()){return ty(t)||y5(t)||w5(t)||_5(t)||/windows phone/i.test(t)||v5(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N5(t,e=[]){let s;switch(t){case"Browser":s=kk(Es());break;case"Worker":s=`${kk(Es())}-${t}`;break;default:s=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${kc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const n=r=>new Promise((a,l)=>{try{const c=e(r);a(c)}catch(c){l(c)}});n.onAbort=s,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const n of this.queue)await n(e),n.onAbort&&s.push(n.onAbort)}catch(n){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function DP(t,e={}){return fr(t,"GET","/v2/passwordPolicy",hr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP=6;class PP{constructor(e){var s,n,i,r;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=a.minPasswordLength)!==null&&s!==void 0?s:LP,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var s,n,i,r,a,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(s=c.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(n=c.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,s){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(s.meetsMinPasswordLength=e.length>=n),i&&(s.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,s,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VP{constructor(e,s,n,i){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Nk(this),this.idTokenSubscription=new Nk(this),this.beforeStateQueue=new MP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c5,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Pi(s)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await Al.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await em(this,{idToken:e}),n=await $n._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(n)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Qs(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,l=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(i=c.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await Zu(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=gP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Qs(this.app))return Promise.reject(ci(this));const s=e?Wt(e):null;return s&&ge(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Qs(this.app)?Promise.reject(ci(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Qs(this.app)?Promise.reject(ci(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Pi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await DP(this),s=new PP(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ld("auth","Firebase",e())}onAuthStateChanged(e,s,n){return this.registerStateListener(this.authStateSubscription,e,s,n)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,n){return this.registerStateListener(this.idTokenSubscription,e,s,n)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(n.tenantId=this.tenantId),await RP(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,s){const n=await this.getOrInitRedirectPersistenceManager(s);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Pi(e)||this._popupRedirectResolver;ge(s,this,"argument-error"),this.redirectPersistenceManager=await Al.create(this,[Pi(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,n;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(s=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,n,i){if(this._deleted)return()=>{};const r=typeof s=="function"?s:s.next.bind(s);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(ge(l,this,"internal-error"),l.then(()=>{a||r(this.currentUser)}),typeof s=="function"){const c=e.addObserver(s,n,i);return()=>{a=!0,c()}}else{const c=e.addObserver(s);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=N5(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(s["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(s["X-Firebase-AppCheck"]=i),s}async _getAppCheckToken(){var e;if(Qs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return s!=null&&s.error&&fP(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function mr(t){return Wt(t)}class Nk{constructor(e){this.auth=e,this.observer=null,this.addObserver=eL(s=>this.observer=s)}get next(){return ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function FP(t){pp=t}function S5(t){return pp.loadJS(t)}function BP(){return pp.recaptchaEnterpriseScript}function UP(){return pp.gapiScript}function $P(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class GP{constructor(){this.enterprise=new HP}ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}class HP{ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}const zP="recaptcha-enterprise",T5="NO_RECAPTCHA";class qP{constructor(e){this.type=zP,this.auth=mr(e)}async verify(e="verify",s=!1){async function n(r){if(!s){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(a,l)=>{kP(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new wP(c);return r.tenantId==null?r._agentRecaptchaConfig=u:r._tenantRecaptchaConfigs[r.tenantId]=u,a(u.siteKey)}}).catch(c=>{l(c)})})}function i(r,a,l){const c=window.grecaptcha;vk(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(u=>{a(u)}).catch(()=>{a(T5)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new GP().execute("siteKey",{action:"verify"}):new Promise((r,a)=>{n(this.auth).then(l=>{if(!s&&vk(window.grecaptcha))i(l,r,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=BP();c.length!==0&&(c+=l),S5(c).then(()=>{i(l,r,a)}).catch(u=>{a(u)})}}).catch(l=>{a(l)})})}}async function Sk(t,e,s,n=!1,i=!1){const r=new qP(t);let a;if(i)a=T5;else try{a=await r.verify(s)}catch{a=await r.verify(s,!0)}const l=Object.assign({},e);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,u=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return n?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function tm(t,e,s,n,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Sk(t,e,s,s==="getOobCode");return n(t,a)}else return n(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await Sk(t,e,s,s==="getOobCode");return n(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KP(t,e){const s=Xv(t,"auth");if(s.isInitialized()){const i=s.getImmediate(),r=s.getOptions();if(xo(r,e??{}))return i;Yn(i,"already-initialized")}return s.initialize({options:e})}function WP(t,e){const s=(e==null?void 0:e.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Pi);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function YP(t,e,s){const n=mr(t);ge(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,r=E5(e),{host:a,port:l}=XP(e),c=l===null?"":`:${l}`,u={url:`${r}//${a}${c}/`},d=Object.freeze({host:a,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){ge(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),ge(xo(u,n.config.emulator)&&xo(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=u,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,_c(a)?(JA(`${r}//${a}${c}`),ZA("Auth",!0)):QP()}function E5(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function XP(t){const e=E5(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const r=i[1];return{host:r,port:Tk(n.substr(r.length+1))}}else{const[r,a]=n.split(":");return{host:r,port:Tk(a)}}}function Tk(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function QP(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sy{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Li("not implemented")}_getIdTokenResponse(e){return Li("not implemented")}_linkToIdToken(e,s){return Li("not implemented")}_getReauthenticationResolver(e){return Li("not implemented")}}async function JP(t,e){return fr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZP(t,e){return Vd(t,"POST","/v1/accounts:signInWithPassword",hr(t,e))}async function e6(t,e){return fr(t,"POST","/v1/accounts:sendOobCode",hr(t,e))}async function t6(t,e){return e6(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s6(t,e){return Vd(t,"POST","/v1/accounts:signInWithEmailLink",hr(t,e))}async function n6(t,e){return Vd(t,"POST","/v1/accounts:signInWithEmailLink",hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed extends sy{constructor(e,s,n,i=null){super("password",n),this._email=e,this._password=s,this._tenantId=i}static _fromEmailAndPassword(e,s){return new ed(e,s,"password")}static _fromEmailAndCode(e,s,n=null){return new ed(e,s,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return tm(e,s,"signInWithPassword",ZP);case"emailLink":return s6(e,{email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const n={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return tm(e,n,"signUpPassword",JP);case"emailLink":return n6(e,{idToken:s,email:this._email,oobCode:this._password});default:Yn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jl(t,e){return Vd(t,"POST","/v1/accounts:signInWithIdp",hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i6="http://localhost";class vo extends sy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new vo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):Yn("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=s,r=Qv(s,["providerId","signInMethod"]);if(!n||!i)return null;const a=new vo(n,i);return a.idToken=r.idToken||void 0,a.accessToken=r.accessToken||void 0,a.secret=r.secret,a.nonce=r.nonce,a.pendingToken=r.pendingToken||null,a}_getIdTokenResponse(e){const s=this.buildRequest();return jl(e,s)}_linkToIdToken(e,s){const n=this.buildRequest();return n.idToken=s,jl(e,n)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,jl(e,s)}buildRequest(){const e={requestUri:i6,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=wc(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r6(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function a6(t){const e=iu(ru(t)).link,s=e?iu(ru(e)).deep_link_id:null,n=iu(ru(t)).deep_link_id;return(n?iu(ru(n)).link:null)||n||s||e||t}class ny{constructor(e){var s,n,i,r,a,l;const c=iu(ru(e)),u=(s=c.apiKey)!==null&&s!==void 0?s:null,d=(n=c.oobCode)!==null&&n!==void 0?n:null,h=r6((i=c.mode)!==null&&i!==void 0?i:null);ge(u&&d&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=d,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(a=c.lang)!==null&&a!==void 0?a:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const s=a6(e);try{return new ny(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(){this.providerId=Io.PROVIDER_ID}static credential(e,s){return ed._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const n=ny.parseLink(s);return ge(n,"argument-error"),ed._fromEmailAndCode(e,n.code,n.tenantId)}}Io.PROVIDER_ID="password";Io.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Io.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A5{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fd extends A5{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr extends Fd{constructor(){super("facebook.com")}static credential(e){return vo._fromParams({providerId:Rr.PROVIDER_ID,signInMethod:Rr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rr.credentialFromTaggedObject(e)}static credentialFromError(e){return Rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Rr.credential(e.oauthAccessToken)}catch{return null}}}Rr.FACEBOOK_SIGN_IN_METHOD="facebook.com";Rr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir extends Fd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return vo._fromParams({providerId:Ir.PROVIDER_ID,signInMethod:Ir.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return Ir.credentialFromTaggedObject(e)}static credentialFromError(e){return Ir.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:n}=e;if(!s&&!n)return null;try{return Ir.credential(s,n)}catch{return null}}}Ir.GOOGLE_SIGN_IN_METHOD="google.com";Ir.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or extends Fd{constructor(){super("github.com")}static credential(e){return vo._fromParams({providerId:Or.PROVIDER_ID,signInMethod:Or.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Or.credentialFromTaggedObject(e)}static credentialFromError(e){return Or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Or.credential(e.oauthAccessToken)}catch{return null}}}Or.GITHUB_SIGN_IN_METHOD="github.com";Or.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mr extends Fd{constructor(){super("twitter.com")}static credential(e,s){return vo._fromParams({providerId:Mr.PROVIDER_ID,signInMethod:Mr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return Mr.credentialFromTaggedObject(e)}static credentialFromError(e){return Mr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=e;if(!s||!n)return null;try{return Mr.credential(s,n)}catch{return null}}}Mr.TWITTER_SIGN_IN_METHOD="twitter.com";Mr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5(t,e){return Vd(t,"POST","/v1/accounts:signUp",hr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,n,i=!1){const r=await $n._fromIdTokenResponse(e,n,i),a=Ek(n);return new sr({user:r,providerId:a,_tokenResponse:n,operationType:s})}static async _forOperation(e,s,n){await e._updateTokensIfNecessary(n,!0);const i=Ek(n);return new sr({user:e,providerId:i,_tokenResponse:n,operationType:s})}}function Ek(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o6(t){var e;if(Qs(t.app))return Promise.reject(ci(t));const s=mr(t);if(await s._initializationPromise,!((e=s.currentUser)===null||e===void 0)&&e.isAnonymous)return new sr({user:s.currentUser,providerId:null,operationType:"signIn"});const n=await j5(s,{returnSecureToken:!0}),i=await sr._fromIdTokenResponse(s,"signIn",n,!0);return await s._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sm extends Aa{constructor(e,s,n,i){var r;super(s.code,s.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,sm.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:s.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,s,n,i){return new sm(e,s,n,i)}}function C5(t,e,s,n){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?sm._fromErrorAndOperation(t,r,e,n):r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l6(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function R5(t,e,s=!1){const n=await Ju(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return sr._forOperation(t,"link",n)}async function c6(t,e,s){await Zu(e);const n=l6(e.providerData);ge(n.has(s)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function u6(t,e,s=!1){const{auth:n}=t;if(Qs(n.app))return Promise.reject(ci(n));const i="reauthenticate";try{const r=await Ju(t,C5(n,i,e,t),s);ge(r.idToken,n,"internal-error");const a=ey(r.idToken);ge(a,n,"internal-error");const{sub:l}=a;return ge(t.uid===l,n,"user-mismatch"),sr._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Yn(n,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I5(t,e,s=!1){if(Qs(t.app))return Promise.reject(ci(t));const n="signIn",i=await C5(t,n,e),r=await sr._fromIdTokenResponse(t,n,i);return s||await t._updateCurrentUser(r.user),r}async function d6(t,e){return I5(mr(t),e)}async function h6(t,e){const s=Wt(t);return await c6(!1,s,e.providerId),R5(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function O5(t){const e=mr(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function f6(t,e,s){const n=mr(t);await tm(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",t6)}async function m6(t,e,s){if(Qs(t.app))return Promise.reject(ci(t));const n=mr(t),a=await tm(n,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",j5).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&O5(t),c}),l=await sr._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(l.user),l}function p6(t,e,s){return Qs(t.app)?Promise.reject(ci(t)):d6(Wt(t),Io.credential(e,s)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&O5(t),n})}function g6(t,e,s,n){return Wt(t).onIdTokenChanged(e,s,n)}function x6(t,e,s){return Wt(t).beforeAuthStateChanged(e,s)}function b6(t,e,s,n){return Wt(t).onAuthStateChanged(e,s,n)}function v6(t){return Wt(t).signOut()}const nm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(nm,"1"),this.storage.removeItem(nm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y6=1e3,_6=10;class D5 extends M5{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=k5(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const n=this.storage.getItem(s),i=this.localCache[s];n!==i&&e(s,i,n)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const n=e.key;s?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(n);!s&&this.localCache[n]===a||this.notifyListeners(n,a)},r=this.storage.getItem(n);OP()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,_6):i()}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:n}),!0)})},y6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}D5.type="LOCAL";const w6=D5;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5 extends M5{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}L5.type="SESSION";const P5=L5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k6(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(i=>i.isListeningto(e));if(s)return s;const n=new gp(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:n,eventType:i,data:r}=s.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;s.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const l=Array.from(a).map(async u=>u(s.origin,r)),c=await k6(l);s.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:c})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iy(t="",e=10){let s="";for(let n=0;n<e;n++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N6{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,a;return new Promise((l,c)=>{const u=iy("",20);i.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},n);a={messageChannel:i,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(f.data.response);break;default:clearTimeout(d),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:s},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ui(){return window}function S6(t){ui().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V5(){return typeof ui().WorkerGlobalScope<"u"&&typeof ui().importScripts=="function"}async function T6(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function E6(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function A6(){return V5()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F5="firebaseLocalStorageDb",j6=1,im="firebaseLocalStorage",B5="fbase_key";class Bd{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function xp(t,e){return t.transaction([im],e?"readwrite":"readonly").objectStore(im)}function C6(){const t=indexedDB.deleteDatabase(F5);return new Bd(t).toPromise()}function Px(){const t=indexedDB.open(F5,j6);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(im,{keyPath:B5})}catch(i){s(i)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(im)?e(n):(n.close(),await C6(),e(await Px()))})})}async function Ak(t,e,s){const n=xp(t,!0).put({[B5]:e,value:s});return new Bd(n).toPromise()}async function R6(t,e){const s=xp(t,!1).get(e),n=await new Bd(s).toPromise();return n===void 0?null:n.value}function jk(t,e){const s=xp(t,!0).delete(e);return new Bd(s).toPromise()}const I6=800,O6=3;class U5{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Px(),this.db)}async _withRetries(e){let s=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(s++>O6)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return V5()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gp._getInstance(A6()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await T6(),!this.activeServiceWorker)return;this.sender=new N6(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((s=n[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||E6()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Px();return await Ak(e,nm,"1"),await jk(e,nm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(n=>Ak(n,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(n=>R6(n,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>jk(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=xp(i,!1).getAll();return new Bd(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),I6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}U5.type="LOCAL";const M6=U5;new Pd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D6(t,e){return e?Pi(e):(ge(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ry extends sy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return jl(e,this._buildIdpRequest())}_linkToIdToken(e,s){return jl(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return jl(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function L6(t){return I5(t.auth,new ry(t),t.bypassAuthState)}function P6(t){const{auth:e,user:s}=t;return ge(s,e,"internal-error"),u6(s,new ry(t),t.bypassAuthState)}async function V6(t){const{auth:e,user:s}=t;return ge(s,e,"internal-error"),R5(s,new ry(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $5{constructor(e,s,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:n,postBody:i,tenantId:r,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:s,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return L6;case"linkViaPopup":case"linkViaRedirect":return V6;case"reauthViaPopup":case"reauthViaRedirect":return P6;default:Yn(this.auth,"internal-error")}}resolve(e){tr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){tr(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F6=new Pd(2e3,1e4);class cl extends $5{constructor(e,s,n,i,r){super(e,s,i,r),this.provider=n,this.authWindow=null,this.pollId=null,cl.currentPopupAction&&cl.currentPopupAction.cancel(),cl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ge(e,this.auth,"internal-error"),e}async onExecution(){tr(this.filter.length===1,"Popup operations only handle one event");const e=iy();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(li(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(li(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,cl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,n;if(!((n=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(li(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,F6.get())};e()}}cl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B6="pendingRedirect",cf=new Map;class U6 extends $5{constructor(e,s,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,n),this.eventId=null}async execute(){let e=cf.get(this.auth._key());if(!e){try{const n=await $6(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(s){e=()=>Promise.reject(s)}cf.set(this.auth._key(),e)}return this.bypassAuthState||cf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function $6(t,e){const s=z6(e),n=H6(t);if(!await n._isAvailable())return!1;const i=await n._get(s)==="true";return await n._remove(s),i}function G6(t,e){cf.set(t._key(),e)}function H6(t){return Pi(t._redirectPersistence)}function z6(t){return lf(B6,t.config.apiKey,t.name)}async function q6(t,e,s=!1){if(Qs(t.app))return Promise.reject(ci(t));const n=mr(t),i=D6(n,e),a=await new U6(n,i,s).execute();return a&&!s&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K6=10*60*1e3;class W6{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(s=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Y6(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var n;if(e.error&&!G5(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";s.onError(li(this.auth,i))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const n=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=K6&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ck(e))}saveEventToCache(e){this.cachedEventUids.add(Ck(e)),this.lastProcessedEventTime=Date.now()}}function Ck(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function G5({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Y6(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return G5(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X6(t,e={}){return fr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q6=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,J6=/^https?/;async function Z6(t){if(t.config.emulator)return;const{authorizedDomains:e}=await X6(t);for(const s of e)try{if(e8(s))return}catch{}Yn(t,"unauthorized-domain")}function e8(t){const e=Dx(),{protocol:s,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&n===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&a.hostname===n}if(!J6.test(s))return!1;if(Q6.test(t))return n===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t8=new Pd(3e4,6e4);function Rk(){const t=ui().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function s8(t){return new Promise((e,s)=>{var n,i,r;function a(){Rk(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Rk(),s(li(t,"network-request-failed"))},timeout:t8.get()})}if(!((i=(n=ui().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=ui().gapi)===null||r===void 0)&&r.load)a();else{const l=$P("iframefcb");return ui()[l]=()=>{gapi.load?a():s(li(t,"network-request-failed"))},S5(`${UP()}?onload=${l}`).catch(c=>s(c))}}).catch(e=>{throw uf=null,e})}let uf=null;function n8(t){return uf=uf||s8(t),uf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i8=new Pd(5e3,15e3),r8="__/auth/iframe",a8="emulator/auth/iframe",o8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},l8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function c8(t){const e=t.config;ge(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?Zv(e,a8):`https://${t.config.authDomain}/${r8}`,n={apiKey:e.apiKey,appName:t.name,v:kc},i=l8.get(t.config.apiHost);i&&(n.eid=i);const r=t._getFrameworks();return r.length&&(n.fw=r.join(",")),`${s}?${wc(n).slice(1)}`}async function u8(t){const e=await n8(t),s=ui().gapi;return ge(s,t,"internal-error"),e.open({where:document.body,url:c8(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:o8,dontclear:!0},n=>new Promise(async(i,r)=>{await n.restyle({setHideOnLeave:!1});const a=li(t,"network-request-failed"),l=ui().setTimeout(()=>{r(a)},i8.get());function c(){ui().clearTimeout(l),i(n)}n.ping(c).then(c,()=>{r(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},h8=500,f8=600,m8="_blank",p8="http://localhost";class Ik{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function g8(t,e,s,n=h8,i=f8){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const c=Object.assign(Object.assign({},d8),{width:n.toString(),height:i.toString(),top:r,left:a}),u=Es().toLowerCase();s&&(l=b5(u)?m8:s),g5(u)&&(e=e||p8,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[m,b])=>`${f}${m}=${b},`,"");if(IP(u)&&l!=="_self")return x8(e||"",l),new Ik(null);const h=window.open(e||"",l,d);ge(h,t,"popup-blocked");try{h.focus()}catch{}return new Ik(h)}function x8(t,e){const s=document.createElement("a");s.href=t,s.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b8="__/auth/handler",v8="emulator/auth/handler",y8=encodeURIComponent("fac");async function Ok(t,e,s,n,i,r){ge(t.config.authDomain,t,"auth-domain-config-required"),ge(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:n,v:kc,eventId:i};if(e instanceof A5){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",Xf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))a[d]=h}if(e instanceof Fd){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(a.scopes=d.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const d of Object.keys(l))l[d]===void 0&&delete l[d];const c=await t._getAppCheckToken(),u=c?`#${y8}=${encodeURIComponent(c)}`:"";return`${_8(t)}?${wc(l).slice(1)}${u}`}function _8({config:t}){return t.emulator?Zv(t,v8):`https://${t.authDomain}/${b8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg="webStorageSupport";class w8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=P5,this._completeRedirectFn=q6,this._overrideRedirectResult=G6}async _openPopup(e,s,n,i){var r;tr((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const a=await Ok(e,s,n,Dx(),i);return g8(e,a,iy())}async _openRedirect(e,s,n,i){await this._originValidation(e);const r=await Ok(e,s,n,Dx(),i);return S6(r),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:i,promise:r}=this.eventManagers[s];return i?Promise.resolve(i):(tr(r,"If manager is not set, promise should be"),r)}const n=this.initAndGetManager(e);return this.eventManagers[s]={promise:n},n.catch(()=>{delete this.eventManagers[s]}),n}async initAndGetManager(e){const s=await u8(e),n=new W6(e);return s.register("authEvent",i=>(ge(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=s,n}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(eg,{type:eg},i=>{var r;const a=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[eg];a!==void 0&&s(!!a),Yn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=Z6(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return k5()||x5()||ty()}}const k8=w8;var Mk="@firebase/auth",Dk="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S8(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function T8(t){Wl(new bo("auth",(e,{options:s})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=n.options;ge(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:N5(t)},u=new VP(n,i,r,c);return WP(u,s),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,n)=>{e.getProvider("auth-internal").initialize()})),Wl(new bo("auth-internal",e=>{const s=mr(e.getProvider("auth").getImmediate());return(n=>new N8(n))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),ta(Mk,Dk,S8(t)),ta(Mk,Dk,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E8=5*60,A8=QA("authIdTokenMaxAge")||E8;let Lk=null;const j8=t=>async e=>{const s=e&&await e.getIdTokenResult(),n=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(n&&n>A8)return;const i=s==null?void 0:s.token;Lk!==i&&(Lk=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function C8(t=r5()){const e=Xv(t,"auth");if(e.isInitialized())return e.getImmediate();const s=KP(t,{popupRedirectResolver:k8,persistence:[M6,w6,P5]}),n=QA("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(n,location.origin);if(location.origin===r.origin){const a=j8(r.toString());x6(s,a,()=>a(s.currentUser)),g6(s,l=>a(l))}}const i=YA("auth");return i&&YP(s,`http://${i}`),s}function R8(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}FP({loadJS(t){return new Promise((e,s)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=i=>{const r=li("internal-error");r.customData=i,s(r)},n.type="text/javascript",n.charset="UTF-8",R8().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});T8("Browser");var Pk={};const Vk="@firebase/database",Fk="1.0.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let H5="";function I8(t){H5=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O8{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,s){s==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Qt(s))}get(e){const s=this.domStorage_.getItem(this.prefixedName_(e));return s==null?null:Xu(s)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M8{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,s){s==null?delete this.cache_[e]:this.cache_[e]=s}get(e){return Zn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z5=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new O8(e)}}catch{}return new M8},Ya=z5("localStorage"),D8=z5("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cl=new Wv("@firebase/database"),q5=function(){let t=1;return function(){return t++}}(),K5=function(t){const e=nL(t),s=new Z3;s.update(e);const n=s.digest();return zv.encodeByteArray(n)},Ud=function(...t){let e="";for(let s=0;s<t.length;s++){const n=t[s];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=Ud.apply(null,n):typeof n=="object"?e+=Qt(n):e+=n,e+=" "}return e};let ku=null,Bk=!0;const L8=function(t,e){ee(!0,"Can't turn on custom loggers persistently."),Cl.logLevel=nt.VERBOSE,ku=Cl.log.bind(Cl)},rs=function(...t){if(Bk===!0&&(Bk=!1,ku===null&&D8.get("logging_enabled")===!0&&L8()),ku){const e=Ud.apply(null,t);ku(e)}},$d=function(t){return function(...e){rs(t,...e)}},Vx=function(...t){const e="FIREBASE INTERNAL ERROR: "+Ud(...t);Cl.error(e)},nr=function(...t){const e=`FIREBASE FATAL ERROR: ${Ud(...t)}`;throw Cl.error(e),new Error(e)},Ts=function(...t){const e="FIREBASE WARNING: "+Ud(...t);Cl.warn(e)},P8=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bp=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},V8=function(t){if(document.readyState==="complete")t();else{let e=!1;const s=function(){if(!document.body){setTimeout(s,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&s()}),window.attachEvent("onload",s))}},Yl="[MIN_NAME]",yo="[MAX_NAME]",Oo=function(t,e){if(t===e)return 0;if(t===Yl||e===yo)return-1;if(e===Yl||t===yo)return 1;{const s=Uk(t),n=Uk(e);return s!==null?n!==null?s-n===0?t.length-e.length:s-n:-1:n!==null?1:t<e?-1:1}},F8=function(t,e){return t===e?0:t<e?-1:1},Kc=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Qt(e))},ay=function(t){if(typeof t!="object"||t===null)return Qt(t);const e=[];for(const n in t)e.push(n);e.sort();let s="{";for(let n=0;n<e.length;n++)n!==0&&(s+=","),s+=Qt(e[n]),s+=":",s+=ay(t[e[n]]);return s+="}",s},W5=function(t,e){const s=t.length;if(s<=e)return[t];const n=[];for(let i=0;i<s;i+=e)i+e>s?n.push(t.substring(i,s)):n.push(t.substring(i,i+e));return n};function ls(t,e){for(const s in t)t.hasOwnProperty(s)&&e(s,t[s])}const Y5=function(t){ee(!bp(t),"Invalid JSON number");const e=11,s=52,n=(1<<e-1)-1;let i,r,a,l,c;t===0?(r=0,a=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-n)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),n),r=l+n,a=Math.round(t*Math.pow(2,s-l)-Math.pow(2,s))):(r=0,a=Math.round(t/Math.pow(2,1-n-s))));const u=[];for(c=s;c;c-=1)u.push(a%2?1:0),a=Math.floor(a/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(i?1:0),u.reverse();const d=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(d.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},B8=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},U8=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function $8(t,e){let s="Unknown Error";t==="too_big"?s="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?s="Client doesn't have permission to access the desired data.":t==="unavailable"&&(s="The service is unavailable");const n=new Error(t+" at "+e._path.toString()+": "+s);return n.code=t.toUpperCase(),n}const G8=new RegExp("^-?(0*)\\d{1,10}$"),H8=-2147483648,z8=2147483647,Uk=function(t){if(G8.test(t)){const e=Number(t);if(e>=H8&&e<=z8)return e}return null},Nc=function(t){try{t()}catch(e){setTimeout(()=>{const s=e.stack||"";throw Ts("Exception was thrown by user callback.",s),e},Math.floor(0))}},q8=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Nu=function(t,e){const s=setTimeout(t,e);return typeof s=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(s):typeof s=="object"&&s.unref&&s.unref(),s};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K8{constructor(e,s){this.appCheckProvider=s,this.appName=e.name,Qs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=s==null?void 0:s.getImmediate({optional:!0}),this.appCheck||s==null||s.get().then(n=>this.appCheck=n)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((s,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(s,n):s(null)},0)})}addTokenChangeListener(e){var s;(s=this.appCheckProvider)===null||s===void 0||s.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Ts(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W8{constructor(e,s,n){this.appName_=e,this.firebaseOptions_=s,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(s=>s&&s.code==="auth/token-not-initialized"?(rs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(s)):new Promise((s,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(s,n):s(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(s=>s.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(s=>s.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ts(e)}}class df{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}df.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy="5",X5="v",Q5="s",J5="r",Z5="f",ej=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,tj="ls",sj="p",Fx="ac",nj="websocket",ij="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e,s,n,i,r=!1,a="",l=!1,c=!1,u=null){this.secure=s,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ya.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ya.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",s=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${s}`}}function Y8(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function aj(t,e,s){ee(typeof e=="string","typeof type must == string"),ee(typeof s=="object","typeof params must == object");let n;if(e===nj)n=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ij)n=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Y8(t)&&(s.ns=t.namespace);const i=[];return ls(s,(r,a)=>{i.push(r+"="+a)}),n+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X8{constructor(){this.counters_={}}incrementCounter(e,s=1){Zn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=s}get(){return I3(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tg={},sg={};function ly(t){const e=t.toString();return tg[e]||(tg[e]=new X8),tg[e]}function Q8(t,e){const s=t.toString();return sg[s]||(sg[s]=e()),sg[s]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J8{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,s){this.closeAfterResponse=e,this.onClose=s,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,s){for(this.pendingResponses[e]=s;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<n.length;++i)n[i]&&Nc(()=>{this.onMessage_(n[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $k="start",Z8="close",eV="pLPCommand",tV="pRTLPCB",oj="id",lj="pw",cj="ser",sV="cb",nV="seg",iV="ts",rV="d",aV="dframe",uj=1870,dj=30,oV=uj-dj,lV=25e3,cV=3e4;class ul{constructor(e,s,n,i,r,a,l){this.connId=e,this.repoInfo=s,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=$d(e),this.stats_=ly(s),this.urlFn=c=>(this.appCheckToken&&(c[Fx]=this.appCheckToken),aj(s,ij,c))}open(e,s){this.curSegmentNum=0,this.onDisconnect_=s,this.myPacketOrderer=new J8(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(cV)),V8(()=>{if(this.isClosed_)return;this.scriptTagHolder=new cy((...r)=>{const[a,l,c,u,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===$k)this.id=l,this.password=c;else if(a===Z8)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...r)=>{const[a,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const n={};n[$k]="t",n[cj]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[sV]=this.scriptTagHolder.uniqueCallbackIdentifier),n[X5]=oy,this.transportSessionId&&(n[Q5]=this.transportSessionId),this.lastSessionId&&(n[tj]=this.lastSessionId),this.applicationId&&(n[sj]=this.applicationId),this.appCheckToken&&(n[Fx]=this.appCheckToken),typeof location<"u"&&location.hostname&&ej.test(location.hostname)&&(n[J5]=Z5);const i=this.urlFn(n);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ul.forceAllow_=!0}static forceDisallow(){ul.forceDisallow_=!0}static isAvailable(){return ul.forceAllow_?!0:!ul.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!B8()&&!U8()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const s=Qt(e);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const n=KA(s),i=W5(n,oV);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,s){this.myDisconnFrame=document.createElement("iframe");const n={};n[aV]="t",n[oj]=e,n[lj]=s,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const s=Qt(e).length;this.bytesReceived+=s,this.stats_.incrementCounter("bytes_received",s)}}class cy{constructor(e,s,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=q5(),window[eV+this.uniqueCallbackIdentifier]=e,window[tV+this.uniqueCallbackIdentifier]=s,this.myIFrame=cy.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){rs("frame writing exception"),l.stack&&rs(l.stack),rs(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rs("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,s){for(this.myID=e,this.myPW=s,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[oj]=this.myID,e[lj]=this.myPW,e[cj]=this.currentSerial;let s=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+dj+n.length<=uj;){const a=this.pendingSegs.shift();n=n+"&"+nV+i+"="+a.seg+"&"+iV+i+"="+a.ts+"&"+rV+i+"="+a.d,i++}return s=s+n,this.addLongPollTag_(s,this.currentSerial),!0}else return!1}enqueueSegment(e,s,n){this.pendingSegs.push({seg:e,ts:s,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,s){this.outstandingRequests.add(s);const n=()=>{this.outstandingRequests.delete(s),this.newRequest_()},i=setTimeout(n,Math.floor(lV)),r=()=>{clearTimeout(i),n()};this.addTag(e,r)}addTag(e,s){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const i=n.readyState;(!i||i==="loaded"||i==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),s())},n.onerror=()=>{rs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uV=16384,dV=45e3;let rm=null;typeof MozWebSocket<"u"?rm=MozWebSocket:typeof WebSocket<"u"&&(rm=WebSocket);class Un{constructor(e,s,n,i,r,a,l){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=$d(this.connId),this.stats_=ly(s),this.connURL=Un.connectionURL_(s,a,l,i,n),this.nodeAdmin=s.nodeAdmin}static connectionURL_(e,s,n,i,r){const a={};return a[X5]=oy,typeof location<"u"&&location.hostname&&ej.test(location.hostname)&&(a[J5]=Z5),s&&(a[Q5]=s),n&&(a[tj]=n),i&&(a[Fx]=i),r&&(a[sj]=r),aj(e,nj,a)}open(e,s){this.onDisconnect=s,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ya.set("previous_websocket_failure",!0);try{let n;z3(),this.mySock=new rm(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Un.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(s);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&rm!==null&&!Un.forceDisallow_}static previouslyFailed(){return Ya.isInMemoryStorage||Ya.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ya.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const n=Xu(s);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ee(this.frames===null,"We already have a frame buffer"),e.length<=6){const s=Number(e);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const s=e.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{const n=this.extractFrameCount_(s);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const s=Qt(e);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const n=W5(s,uV);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(dV))}sendString_(e){try{this.mySock.send(e)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Un.responsesRequiredToBeHealthy=2;Un.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{static get ALL_TRANSPORTS(){return[ul,Un]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const s=Un&&Un.isAvailable();let n=s&&!Un.previouslyFailed();if(e.webSocketOnly&&(s||Ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Un];else{const i=this.transports_=[];for(const r of td.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);td.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}td.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hV=6e4,fV=5e3,mV=10*1024,pV=100*1024,ng="t",Gk="d",gV="s",Hk="r",xV="e",zk="o",qk="a",Kk="n",Wk="p",bV="h";class vV{constructor(e,s,n,i,r,a,l,c,u,d){this.id=e,this.repoInfo_=s,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=$d("c:"+this.id+":"),this.transportManager_=new td(s),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(s,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Nu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>pV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>mV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return s=>{e===this.conn_?this.onConnectionLost_(s):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return s=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(s):e===this.secondaryConn_?this.onSecondaryMessageReceived_(s):this.log_("message on old connection"))}}sendRequest(e){const s={t:"d",d:e};this.sendData_(s)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(ng in e){const s=e[ng];s===qk?this.upgradeIfSecondaryHealthy_():s===Hk?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):s===zk&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const s=Kc("t",e),n=Kc("d",e);if(s==="c")this.onSecondaryControl_(n);else if(s==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+s)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Wk,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:qk,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Kk,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const s=Kc("t",e),n=Kc("d",e);s==="c"?this.onControl_(n):s==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const s=Kc(ng,e);if(Gk in e){const n=e[Gk];if(s===bV){const i=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(s===Kk){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else s===gV?this.onConnectionShutdown_(n):s===Hk?this.onReset_(n):s===xV?Vx("Server Error: "+n):s===zk?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Vx("Unknown control packet command: "+s)}}onHandshake_(e){const s=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,s),oy!==n&&Ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,n),Nu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(hV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,s){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(s,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Nu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(fV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Wk,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ya.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hj{put(e,s,n,i){}merge(e,s,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,s,n){}onDisconnectMerge(e,s,n){}onDisconnectCancel(e,s){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(e){this.allowedEvents_=e,this.listeners_={},ee(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...s){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,s)}}on(e,s,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:s,context:n});const i=this.getInitialEvent(e);i&&s.apply(n,i)}off(e,s,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===s&&(!n||n===i[r].context)){i.splice(r,1);return}}validateEventType_(e){ee(this.allowedEvents_.find(s=>s===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class am extends fj{static getInstance(){return new am}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Kv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ee(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yk=32,Xk=768;class tt{constructor(e,s){if(s===void 0){this.pieces_=e.split("/");let n=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=s}toString(){let e="";for(let s=this.pieceNum_;s<this.pieces_.length;s++)this.pieces_[s]!==""&&(e+="/"+this.pieces_[s]);return e||"/"}}function Be(){return new tt("")}function Te(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function da(t){return t.pieces_.length-t.pieceNum_}function ot(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new tt(t.pieces_,e)}function uy(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function yV(t){let e="";for(let s=t.pieceNum_;s<t.pieces_.length;s++)t.pieces_[s]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[s])));return e||"/"}function sd(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function mj(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let s=t.pieceNum_;s<t.pieces_.length-1;s++)e.push(t.pieces_[s]);return new tt(e,0)}function Et(t,e){const s=[];for(let n=t.pieceNum_;n<t.pieces_.length;n++)s.push(t.pieces_[n]);if(e instanceof tt)for(let n=e.pieceNum_;n<e.pieces_.length;n++)s.push(e.pieces_[n]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&s.push(n[i])}return new tt(s,0)}function Ee(t){return t.pieceNum_>=t.pieces_.length}function ks(t,e){const s=Te(t),n=Te(e);if(s===null)return e;if(s===n)return ks(ot(t),ot(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function _V(t,e){const s=sd(t,0),n=sd(e,0);for(let i=0;i<s.length&&i<n.length;i++){const r=Oo(s[i],n[i]);if(r!==0)return r}return s.length===n.length?0:s.length<n.length?-1:1}function dy(t,e){if(da(t)!==da(e))return!1;for(let s=t.pieceNum_,n=e.pieceNum_;s<=t.pieces_.length;s++,n++)if(t.pieces_[s]!==e.pieces_[n])return!1;return!0}function yn(t,e){let s=t.pieceNum_,n=e.pieceNum_;if(da(t)>da(e))return!1;for(;s<t.pieces_.length;){if(t.pieces_[s]!==e.pieces_[n])return!1;++s,++n}return!0}class wV{constructor(e,s){this.errorPrefix_=s,this.parts_=sd(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=mp(this.parts_[n]);pj(this)}}function kV(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=mp(e),pj(t)}function NV(t){const e=t.parts_.pop();t.byteLength_-=mp(e),t.parts_.length>0&&(t.byteLength_-=1)}function pj(t){if(t.byteLength_>Xk)throw new Error(t.errorPrefix_+"has a key path longer than "+Xk+" bytes ("+t.byteLength_+").");if(t.parts_.length>Yk)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Yk+") or object contains a cycle "+za(t))}function za(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy extends fj{static getInstance(){return new hy}constructor(){super(["visible"]);let e,s;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(s="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(s="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(s="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(s="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,s&&document.addEventListener(s,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(e){return ee(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc=1e3,SV=60*5*1e3,Qk=30*1e3,TV=1.3,EV=3e4,AV="server_kill",Jk=3;class Gi extends hj{constructor(e,s,n,i,r,a,l,c){if(super(),this.repoInfo_=e,this.applicationId_=s,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Gi.nextPersistentConnectionId_++,this.log_=$d("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Wc,this.maxReconnectDelay_=SV,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");hy.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&am.getInstance().on("online",this.onOnline_,this)}sendRequest(e,s,n){const i=++this.requestNumber_,r={r:i,a:e,b:s};this.log_(Qt(r)),ee(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const s=new Bn,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),s.promise}listen(e,s,n,i){this.initConnection_();const r=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+r),this.listens.has(a)||this.listens.set(a,new Map),ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ee(!this.listens.get(a).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:s,query:e,tag:n};this.listens.get(a).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const s=this.outstandingGets_[e];this.sendRequest("g",s.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(n)})}sendListen_(e){const s=e.query,n=s._path.toString(),i=s._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n},a="q";e.tag&&(r.q=s._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(a,r,l=>{const c=l.d,u=l.s;Gi.warnOnListenWarnings_(c,s),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(n,i),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,s){if(e&&typeof e=="object"&&Zn(e,"w")){const n=go(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const i='".indexOn": "'+s._queryParams.getIndex().toString()+'"',r=s._path.toString();Ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||J3(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Qk)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,s=Q3(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(s,n,i=>{const r=i.s,a=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const s=e.s,n=e.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,n)})}unlisten(e,s){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),ee(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,s)}sendUnlisten_(e,s,n,i){this.log_("Unlisten on "+e+" for "+s);const r={p:e},a="n";i&&(r.q=n,r.t=i),this.sendRequest(a,r)}onDisconnectPut(e,s,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,s,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:s,onComplete:n})}onDisconnectMerge(e,s,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,s,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:s,onComplete:n})}onDisconnectCancel(e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(e,s,n,i){const r={p:s,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,a=>{i&&setTimeout(()=>{i(a.s,a.d)},Math.floor(0))})}put(e,s,n,i){this.putInternal("p",e,s,n,i)}merge(e,s,n,i){this.putInternal("m",e,s,n,i)}putInternal(e,s,n,i,r){this.initConnection_();const a={p:s,d:n};r!==void 0&&(a.h=r),this.outstandingPuts_.push({action:e,request:a,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(e){const s=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(s,n,r=>{this.log_(s+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const s={c:e};this.log_("reportStats",s),this.sendRequest("s",s,n=>{if(n.s!=="ok"){const r=n.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Qt(e));const s=e.r,n=this.requestCBHash_[s];n&&(delete this.requestCBHash_[s],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,s){this.log_("handleServerMessage",e,s),e==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):e==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):e==="c"?this.onListenRevoked_(s.p,s.q):e==="ac"?this.onAuthRevoked_(s.s,s.d):e==="apc"?this.onAppCheckRevoked_(s.s,s.d):e==="sd"?this.onSecurityDebugPacket_(s):Vx("Unrecognized action received from server: "+Qt(e)+`
Are you using the latest client?`)}onReady_(e,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ee(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Wc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Wc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>EV&&(this.reconnectDelay_=Wc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let s=Math.max(0,this.reconnectDelay_-e);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*TV)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Gi.nextConnectionId_++,r=this.lastSessionId;let a=!1,l=null;const c=function(){l?l.close():(a=!0,n())},u=function(h){ee(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?rs("getToken() completed but was canceled"):(rs("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new vV(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,s,n,m=>{Ts(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(AV)},r))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&Ts(h),c())}}}interrupt(e){rs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Xf(this.interruptReasons_)&&(this.reconnectDelay_=Wc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const s=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const s=this.outstandingPuts_[e];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,s){let n;s?n=s.map(r=>ay(r)).join("$"):n="default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,s){const n=new tt(e).toString();let i;if(this.listens.has(n)){const r=this.listens.get(n);i=r.get(s),r.delete(s),r.size===0&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,s){rs("Auth token revoked: "+e+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Jk&&(this.reconnectDelay_=Qk,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,s){rs("App check token revoked: "+e+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Jk&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const s of e.values())this.sendListen_(s);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let s="js";e["sdk."+s+"."+H5.replace(/\./g,"-")]=1,Kv()?e["framework.cordova"]=1:e5()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=am.getInstance().currentlyOnline();return Xf(this.interruptReasons_)&&e}}Gi.nextPersistentConnectionId_=0;Gi.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e,s){this.name=e,this.node=s}static Wrap(e,s){return new Ae(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,s){const n=new Ae(Yl,e),i=new Ae(Yl,s);return this.compare(n,i)!==0}minPost(){return Ae.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Rh;class gj extends vp{static get __EMPTY_NODE(){return Rh}static set __EMPTY_NODE(e){Rh=e}compare(e,s){return Oo(e.name,s.name)}isDefinedOn(e){throw yc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,s){return!1}minPost(){return Ae.MIN}maxPost(){return new Ae(yo,Rh)}makePost(e,s){return ee(typeof e=="string","KeyIndex indexValue must always be a string."),new Ae(e,Rh)}toString(){return".key"}}const Rl=new gj;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ih{constructor(e,s,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=s?n(e.key,s):1,i&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),s;if(this.resultGenerator_?s=this.resultGenerator_(e.key,e.value):s={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return s}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ns{constructor(e,s,n,i,r){this.key=e,this.value=s,this.color=n??ns.RED,this.left=i??Ps.EMPTY_NODE,this.right=r??Ps.EMPTY_NODE}copy(e,s,n,i,r){return new ns(e??this.key,s??this.value,n??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,n){let i=this;const r=n(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,s,n),null):r===0?i=i.copy(null,s,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,s,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ps.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,s){let n,i;if(n=this,s(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,s),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),s(e,n.key)===0){if(n.right.isEmpty())return Ps.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,s))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ns.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ns.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ns.RED=!0;ns.BLACK=!1;class jV{copy(e,s,n,i,r){return this}insert(e,s,n){return new ns(e,s,null)}remove(e,s){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ps{constructor(e,s=Ps.EMPTY_NODE){this.comparator_=e,this.root_=s}insert(e,s){return new Ps(this.comparator_,this.root_.insert(e,s,this.comparator_).copy(null,null,ns.BLACK,null,null))}remove(e){return new Ps(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ns.BLACK,null,null))}get(e){let s,n=this.root_;for(;!n.isEmpty();){if(s=this.comparator_(e,n.key),s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}getPredecessorKey(e){let s,n=this.root_,i=null;for(;!n.isEmpty();)if(s=this.comparator_(e,n.key),s===0){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else s<0?n=n.left:s>0&&(i=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ih(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,s){return new Ih(this.root_,e,this.comparator_,!1,s)}getReverseIteratorFrom(e,s){return new Ih(this.root_,e,this.comparator_,!0,s)}getReverseIterator(e){return new Ih(this.root_,null,this.comparator_,!0,e)}}Ps.EMPTY_NODE=new jV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CV(t,e){return Oo(t.name,e.name)}function fy(t,e){return Oo(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bx;function RV(t){Bx=t}const xj=function(t){return typeof t=="number"?"number:"+Y5(t):"string:"+t},bj=function(t){if(t.isLeafNode()){const e=t.val();ee(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Zn(e,".sv"),"Priority must be a string or number.")}else ee(t===Bx||t.isEmpty(),"priority of unexpected type.");ee(t===Bx||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zk;class ts{static set __childrenNodeConstructor(e){Zk=e}static get __childrenNodeConstructor(){return Zk}constructor(e,s=ts.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=s,this.lazyHash_=null,ee(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),bj(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ts(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ts.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ee(e)?this:Te(e)===".priority"?this.priorityNode_:ts.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,s){return null}updateImmediateChild(e,s){return e===".priority"?this.updatePriority(s):s.isEmpty()&&e!==".priority"?this:ts.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,s).updatePriority(this.priorityNode_)}updateChild(e,s){const n=Te(e);return n===null?s:s.isEmpty()&&n!==".priority"?this:(ee(n!==".priority"||da(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,ts.__childrenNodeConstructor.EMPTY_NODE.updateChild(ot(e),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,s){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+xj(this.priorityNode_.val())+":");const s=typeof this.value_;e+=s+":",s==="number"?e+=Y5(this.value_):e+=this.value_,this.lazyHash_=K5(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ts.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ts.__childrenNodeConstructor?-1:(ee(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const s=typeof e.value_,n=typeof this.value_,i=ts.VALUE_TYPE_ORDER.indexOf(s),r=ts.VALUE_TYPE_ORDER.indexOf(n);return ee(i>=0,"Unknown leaf type: "+s),ee(r>=0,"Unknown leaf type: "+n),i===r?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const s=e;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}ts.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vj,yj;function IV(t){vj=t}function OV(t){yj=t}class MV extends vp{compare(e,s){const n=e.node.getPriority(),i=s.node.getPriority(),r=n.compareTo(i);return r===0?Oo(e.name,s.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,s){return!e.getPriority().equals(s.getPriority())}minPost(){return Ae.MIN}maxPost(){return new Ae(yo,new ts("[PRIORITY-POST]",yj))}makePost(e,s){const n=vj(e);return new Ae(s,new ts("[PRIORITY-POST]",n))}toString(){return".priority"}}const kt=new MV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DV=Math.log(2);class LV{constructor(e){const s=r=>parseInt(Math.log(r)/DV,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=s(e+1),this.current_=this.count-1;const i=n(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const om=function(t,e,s,n){t.sort(e);const i=function(c,u){const d=u-c;let h,f;if(d===0)return null;if(d===1)return h=t[c],f=s?s(h):h,new ns(f,h.node,ns.BLACK,null,null);{const m=parseInt(d/2,10)+c,b=i(c,m),p=i(m+1,u);return h=t[m],f=s?s(h):h,new ns(f,h.node,ns.BLACK,b,p)}},r=function(c){let u=null,d=null,h=t.length;const f=function(b,p){const v=h-b,x=h;h-=b;const g=i(v+1,x),y=t[v],w=s?s(y):y;m(new ns(w,y.node,p,null,g))},m=function(b){u?(u.left=b,u=b):(d=b,u=b)};for(let b=0;b<c.count;++b){const p=c.nextBitIsOne(),v=Math.pow(2,c.count-(b+1));p?f(v,ns.BLACK):(f(v,ns.BLACK),f(v,ns.RED))}return d},a=new LV(t.length),l=r(a);return new Ps(n||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ig;const Go={};class Vi{static get Default(){return ee(Go&&kt,"ChildrenNode.ts has not been loaded"),ig=ig||new Vi({".priority":Go},{".priority":kt}),ig}constructor(e,s){this.indexes_=e,this.indexSet_=s}get(e){const s=go(this.indexes_,e);if(!s)throw new Error("No index defined for "+e);return s instanceof Ps?s:null}hasIndex(e){return Zn(this.indexSet_,e.toString())}addIndex(e,s){ee(e!==Rl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=s.getIterator(Ae.Wrap);let a=r.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=r.getNext();let l;i?l=om(n,e.getCompare()):l=Go;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const d=Object.assign({},this.indexes_);return d[c]=l,new Vi(d,u)}addToIndexes(e,s){const n=Qf(this.indexes_,(i,r)=>{const a=go(this.indexSet_,r);if(ee(a,"Missing index implementation for "+r),i===Go)if(a.isDefinedOn(e.node)){const l=[],c=s.getIterator(Ae.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&l.push(u),u=c.getNext();return l.push(e),om(l,a.getCompare())}else return Go;else{const l=s.get(e.name);let c=i;return l&&(c=c.remove(new Ae(e.name,l))),c.insert(e,e.node)}});return new Vi(n,this.indexSet_)}removeFromIndexes(e,s){const n=Qf(this.indexes_,i=>{if(i===Go)return i;{const r=s.get(e.name);return r?i.remove(new Ae(e.name,r)):i}});return new Vi(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yc;class xe{static get EMPTY_NODE(){return Yc||(Yc=new xe(new Ps(fy),null,Vi.Default))}constructor(e,s,n){this.children_=e,this.priorityNode_=s,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&bj(this.priorityNode_),this.children_.isEmpty()&&ee(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Yc}updatePriority(e){return this.children_.isEmpty()?this:new xe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const s=this.children_.get(e);return s===null?Yc:s}}getChild(e){const s=Te(e);return s===null?this:this.getImmediateChild(s).getChild(ot(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,s){if(ee(s,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(s);{const n=new Ae(e,s);let i,r;s.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,s),r=this.indexMap_.addToIndexes(n,this.children_));const a=i.isEmpty()?Yc:this.priorityNode_;return new xe(i,a,r)}}updateChild(e,s){const n=Te(e);if(n===null)return s;{ee(Te(e)!==".priority"||da(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(ot(e),s);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const s={};let n=0,i=0,r=!0;if(this.forEachChild(kt,(a,l)=>{s[a]=l.val(e),n++,r&&xe.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):r=!1}),!e&&r&&i<2*n){const a=[];for(const l in s)a[l]=s[l];return a}else return e&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+xj(this.getPriority().val())+":"),this.forEachChild(kt,(s,n)=>{const i=n.hash();i!==""&&(e+=":"+s+":"+i)}),this.lazyHash_=e===""?"":K5(e)}return this.lazyHash_}getPredecessorChildName(e,s,n){const i=this.resolveIndex_(n);if(i){const r=i.getPredecessorKey(new Ae(e,s));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const s=this.resolveIndex_(e);if(s){const n=s.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const s=this.getFirstChildName(e);return s?new Ae(s,this.children_.get(s)):null}getLastChildName(e){const s=this.resolveIndex_(e);if(s){const n=s.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const s=this.getLastChildName(e);return s?new Ae(s,this.children_.get(s)):null}forEachChild(e,s){const n=this.resolveIndex_(e);return n?n.inorderTraversal(i=>s(i.name,i.node)):this.children_.inorderTraversal(s)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,s){const n=this.resolveIndex_(s);if(n)return n.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ae.Wrap);let r=i.peek();for(;r!=null&&s.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,s){const n=this.resolveIndex_(s);if(n)return n.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ae.Wrap);let r=i.peek();for(;r!=null&&s.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Gd?-1:0}withIndex(e){if(e===Rl||this.indexMap_.hasIndex(e))return this;{const s=this.indexMap_.addIndex(e,this.children_);return new xe(this.children_,this.priorityNode_,s)}}isIndexed(e){return e===Rl||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const s=e;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){const n=this.getIterator(kt),i=s.getIterator(kt);let r=n.getNext(),a=i.getNext();for(;r&&a;){if(r.name!==a.name||!r.node.equals(a.node))return!1;r=n.getNext(),a=i.getNext()}return r===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Rl?null:this.indexMap_.get(e.toString())}}xe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class PV extends xe{constructor(){super(new Ps(fy),xe.EMPTY_NODE,Vi.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return xe.EMPTY_NODE}isEmpty(){return!1}}const Gd=new PV;Object.defineProperties(Ae,{MIN:{value:new Ae(Yl,xe.EMPTY_NODE)},MAX:{value:new Ae(yo,Gd)}});gj.__EMPTY_NODE=xe.EMPTY_NODE;ts.__childrenNodeConstructor=xe;RV(Gd);OV(Gd);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VV=!0;function Tt(t,e=null){if(t===null)return xe.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ee(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const s=t;return new ts(s,Tt(e))}if(!(t instanceof Array)&&VV){const s=[];let n=!1;if(ls(t,(a,l)=>{if(a.substring(0,1)!=="."){const c=Tt(l);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),s.push(new Ae(a,c)))}}),s.length===0)return xe.EMPTY_NODE;const r=om(s,CV,a=>a.name,fy);if(n){const a=om(s,kt.getCompare());return new xe(r,Tt(e),new Vi({".priority":a},{".priority":kt}))}else return new xe(r,Tt(e),Vi.Default)}else{let s=xe.EMPTY_NODE;return ls(t,(n,i)=>{if(Zn(t,n)&&n.substring(0,1)!=="."){const r=Tt(i);(r.isLeafNode()||!r.isEmpty())&&(s=s.updateImmediateChild(n,r))}}),s.updatePriority(Tt(e))}}IV(Tt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV extends vp{constructor(e){super(),this.indexPath_=e,ee(!Ee(e)&&Te(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,s){const n=this.extractChild(e.node),i=this.extractChild(s.node),r=n.compareTo(i);return r===0?Oo(e.name,s.name):r}makePost(e,s){const n=Tt(e),i=xe.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ae(s,i)}maxPost(){const e=xe.EMPTY_NODE.updateChild(this.indexPath_,Gd);return new Ae(yo,e)}toString(){return sd(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BV extends vp{compare(e,s){const n=e.node.compareTo(s.node);return n===0?Oo(e.name,s.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,s){return!e.equals(s)}minPost(){return Ae.MIN}maxPost(){return Ae.MAX}makePost(e,s){const n=Tt(e);return new Ae(s,n)}toString(){return".value"}}const UV=new BV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _j(t){return{type:"value",snapshotNode:t}}function Xl(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function nd(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function id(t,e,s){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:s}}function $V(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class my{constructor(e){this.index_=e}updateChild(e,s,n,i,r,a){ee(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(s);return l.getChild(i).equals(n.getChild(i))&&l.isEmpty()===n.isEmpty()||(a!=null&&(n.isEmpty()?e.hasChild(s)?a.trackChildChange(nd(s,l)):ee(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(Xl(s,n)):a.trackChildChange(id(s,n,l))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(s,n).withIndex(this.index_)}updateFullNode(e,s,n){return n!=null&&(e.isLeafNode()||e.forEachChild(kt,(i,r)=>{s.hasChild(i)||n.trackChildChange(nd(i,r))}),s.isLeafNode()||s.forEachChild(kt,(i,r)=>{if(e.hasChild(i)){const a=e.getImmediateChild(i);a.equals(r)||n.trackChildChange(id(i,r,a))}else n.trackChildChange(Xl(i,r))})),s.withIndex(this.index_)}updatePriority(e,s){return e.isEmpty()?xe.EMPTY_NODE:e.updatePriority(s)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e){this.indexedFilter_=new my(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rd.getStartPost_(e),this.endPost_=rd.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const s=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return s&&n}updateChild(e,s,n,i,r,a){return this.matches(new Ae(s,n))||(n=xe.EMPTY_NODE),this.indexedFilter_.updateChild(e,s,n,i,r,a)}updateFullNode(e,s,n){s.isLeafNode()&&(s=xe.EMPTY_NODE);let i=s.withIndex(this.index_);i=i.updatePriority(xe.EMPTY_NODE);const r=this;return s.forEachChild(kt,(a,l)=>{r.matches(new Ae(a,l))||(i=i.updateImmediateChild(a,xe.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,s){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const s=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),s)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const s=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),s)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GV{constructor(e){this.withinDirectionalStart=s=>this.reverse_?this.withinEndPost(s):this.withinStartPost(s),this.withinDirectionalEnd=s=>this.reverse_?this.withinStartPost(s):this.withinEndPost(s),this.withinStartPost=s=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),s);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=s=>{const n=this.index_.compare(s,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new rd(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,s,n,i,r,a){return this.rangedFilter_.matches(new Ae(s,n))||(n=xe.EMPTY_NODE),e.getImmediateChild(s).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,s,n,i,r,a):this.fullLimitUpdateChild_(e,s,n,r,a)}updateFullNode(e,s,n){let i;if(s.isLeafNode()||s.isEmpty())i=xe.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<s.numChildren()&&s.isIndexed(this.index_)){i=xe.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=s.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=s.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;r.hasNext()&&a<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),a++;else break;else continue}}else{i=s.withIndex(this.index_),i=i.updatePriority(xe.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let a=0;for(;r.hasNext();){const l=r.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:i=i.updateImmediateChild(l.name,xe.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,s){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,s,n,i,r){let a;if(this.reverse_){const h=this.index_.getCompare();a=(f,m)=>h(m,f)}else a=this.index_.getCompare();const l=e;ee(l.numChildren()===this.limit_,"");const c=new Ae(s,n),u=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(l.hasChild(s)){const h=l.getImmediateChild(s);let f=i.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===s||l.hasChild(f.name));)f=i.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:a(f,c);if(d&&!n.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(id(s,n,h)),l.updateImmediateChild(s,n);{r!=null&&r.trackChildChange(nd(s,h));const p=l.updateImmediateChild(s,xe.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(Xl(f.name,f.node)),p.updateImmediateChild(f.name,f.node)):p}}else return n.isEmpty()?e:d&&a(u,c)>=0?(r!=null&&(r.trackChildChange(nd(u.name,u.node)),r.trackChildChange(Xl(s,n))),l.updateImmediateChild(s,n).updateImmediateChild(u.name,xe.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=kt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ee(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ee(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Yl}hasEnd(){return this.endSet_}getIndexEndValue(){return ee(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ee(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:yo}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ee(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===kt}copy(){const e=new py;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function HV(t){return t.loadsAllData()?new my(t.getIndex()):t.hasLimit()?new GV(t):new rd(t)}function zV(t,e){const s=t.copy();return s.limitSet_=!0,s.limit_=e,s.viewFrom_="r",s}function eN(t){const e={};if(t.isDefault())return e;let s;if(t.index_===kt?s="$priority":t.index_===UV?s="$value":t.index_===Rl?s="$key":(ee(t.index_ instanceof FV,"Unrecognized index type!"),s=t.index_.toString()),e.orderBy=Qt(s),t.startSet_){const n=t.startAfterSet_?"startAfter":"startAt";e[n]=Qt(t.indexStartValue_),t.startNameSet_&&(e[n]+=","+Qt(t.indexStartName_))}if(t.endSet_){const n=t.endBeforeSet_?"endBefore":"endAt";e[n]=Qt(t.indexEndValue_),t.endNameSet_&&(e[n]+=","+Qt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function tN(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let s=t.viewFrom_;s===""&&(t.isViewFromLeft()?s="l":s="r"),e.vf=s}return t.index_!==kt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lm extends hj{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,s){return s!==void 0?"tag$"+s:(ee(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,s,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=s,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=$d("p:rest:"),this.listens_={}}listen(e,s,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const a=lm.getListenId_(e,n),l={};this.listens_[a]=l;const c=eN(e._queryParams);this.restRequest_(r+".json",c,(u,d)=>{let h=d;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(r,h,!1,n),go(this.listens_,a)===l){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",i(f,null)}})}unlisten(e,s){const n=lm.getListenId_(e,s);delete this.listens_[n]}get(e){const s=eN(e._queryParams),n=e._path.toString(),i=new Bn;return this.restRequest_(n+".json",s,(r,a)=>{let l=a;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(n,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,s={},n){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(s.auth=i.accessToken),r&&r.token&&(s.ac=r.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+wc(s);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(n&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Xu(l.responseText)}catch{Ts("Failed to parse JSON response for "+a+": "+l.responseText)}n(null,c)}else l.status!==401&&l.status!==404&&Ts("Got unsuccessful REST response for "+a+" Status: "+l.status),n(l.status);n=null}},l.open("GET",a,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{constructor(){this.rootNode_=xe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,s){this.rootNode_=this.rootNode_.updateChild(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cm(){return{value:null,children:new Map}}function Sc(t,e,s){if(Ee(e))t.value=s,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,s);else{const n=Te(e);t.children.has(n)||t.children.set(n,cm());const i=t.children.get(n);e=ot(e),Sc(i,e,s)}}function Ux(t,e){if(Ee(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const s=t.value;return t.value=null,s.forEachChild(kt,(n,i)=>{Sc(t,new tt(n),i)}),Ux(t,e)}}else if(t.children.size>0){const s=Te(e);return e=ot(e),t.children.has(s)&&Ux(t.children.get(s),e)&&t.children.delete(s),t.children.size===0}else return!0}function $x(t,e,s){t.value!==null?s(e,t.value):KV(t,(n,i)=>{const r=new tt(e.toString()+"/"+n);$x(i,r,s)})}function KV(t,e){t.children.forEach((s,n)=>{e(n,s)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WV{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),s=Object.assign({},e);return this.last_&&ls(this.last_,(n,i)=>{s[n]=s[n]-i}),this.last_=e,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sN=10*1e3,YV=30*1e3,XV=5*60*1e3;class QV{constructor(e,s){this.server_=s,this.statsToReport_={},this.statsListener_=new WV(e);const n=sN+(YV-sN)*Math.random();Nu(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),s={};let n=!1;ls(e,(i,r)=>{r>0&&Zn(this.statsToReport_,i)&&(s[i]=r,n=!0)}),n&&this.server_.reportStats(s),Nu(this.reportStats_.bind(this),Math.floor(Math.random()*2*XV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gn;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Gn||(Gn={}));function gy(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function xy(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function by(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class um{constructor(e,s,n){this.path=e,this.affectedTree=s,this.revert=n,this.type=Gn.ACK_USER_WRITE,this.source=gy()}operationForChild(e){if(Ee(this.path)){if(this.affectedTree.value!=null)return ee(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const s=this.affectedTree.subtree(new tt(e));return new um(Be(),s,this.revert)}}else return ee(Te(this.path)===e,"operationForChild called for unrelated child."),new um(ot(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ad{constructor(e,s){this.source=e,this.path=s,this.type=Gn.LISTEN_COMPLETE}operationForChild(e){return Ee(this.path)?new ad(this.source,Be()):new ad(this.source,ot(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _o{constructor(e,s,n){this.source=e,this.path=s,this.snap=n,this.type=Gn.OVERWRITE}operationForChild(e){return Ee(this.path)?new _o(this.source,Be(),this.snap.getImmediateChild(e)):new _o(this.source,ot(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vy=class Gx{constructor(e,s,n){this.source=e,this.path=s,this.children=n,this.type=Gn.MERGE}operationForChild(e){if(Ee(this.path)){const s=this.children.subtree(new tt(e));return s.isEmpty()?null:s.value?new _o(this.source,Be(),s.value):new Gx(this.source,Be(),s)}else return ee(Te(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Gx(this.source,ot(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(e,s,n){this.node_=e,this.fullyInitialized_=s,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ee(e))return this.isFullyInitialized()&&!this.filtered_;const s=Te(e);return this.isCompleteForChild(s)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ZV(t,e,s,n){const i=[],r=[];return e.forEach(a=>{a.type==="child_changed"&&t.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&r.push($V(a.childName,a.snapshotNode))}),Xc(t,i,"child_removed",e,n,s),Xc(t,i,"child_added",e,n,s),Xc(t,i,"child_moved",r,n,s),Xc(t,i,"child_changed",e,n,s),Xc(t,i,"value",e,n,s),i}function Xc(t,e,s,n,i,r){const a=n.filter(l=>l.type===s);a.sort((l,c)=>tF(t,l,c)),a.forEach(l=>{const c=eF(t,l,r);i.forEach(u=>{u.respondsTo(l.type)&&e.push(u.createEvent(c,t.query_))})})}function eF(t,e,s){return e.type==="value"||e.type==="child_removed"||(e.prevName=s.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function tF(t,e,s){if(e.childName==null||s.childName==null)throw yc("Should only compare child_ events.");const n=new Ae(e.childName,e.snapshotNode),i=new Ae(s.childName,s.snapshotNode);return t.index_.compare(n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(t,e){return{eventCache:t,serverCache:e}}function Su(t,e,s,n){return yp(new ha(e,s,n),t.serverCache)}function wj(t,e,s,n){return yp(t.eventCache,new ha(e,s,n))}function dm(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function wo(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rg;const sF=()=>(rg||(rg=new Ps(F8)),rg);class ct{static fromObject(e){let s=new ct(null);return ls(e,(n,i)=>{s=s.set(new tt(n),i)}),s}constructor(e,s=sF()){this.value=e,this.children=s}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,s){if(this.value!=null&&s(this.value))return{path:Be(),value:this.value};if(Ee(e))return null;{const n=Te(e),i=this.children.get(n);if(i!==null){const r=i.findRootMostMatchingPathAndValue(ot(e),s);return r!=null?{path:Et(new tt(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ee(e))return this;{const s=Te(e),n=this.children.get(s);return n!==null?n.subtree(ot(e)):new ct(null)}}set(e,s){if(Ee(e))return new ct(s,this.children);{const n=Te(e),r=(this.children.get(n)||new ct(null)).set(ot(e),s),a=this.children.insert(n,r);return new ct(this.value,a)}}remove(e){if(Ee(e))return this.children.isEmpty()?new ct(null):new ct(null,this.children);{const s=Te(e),n=this.children.get(s);if(n){const i=n.remove(ot(e));let r;return i.isEmpty()?r=this.children.remove(s):r=this.children.insert(s,i),this.value===null&&r.isEmpty()?new ct(null):new ct(this.value,r)}else return this}}get(e){if(Ee(e))return this.value;{const s=Te(e),n=this.children.get(s);return n?n.get(ot(e)):null}}setTree(e,s){if(Ee(e))return s;{const n=Te(e),r=(this.children.get(n)||new ct(null)).setTree(ot(e),s);let a;return r.isEmpty()?a=this.children.remove(n):a=this.children.insert(n,r),new ct(this.value,a)}}fold(e){return this.fold_(Be(),e)}fold_(e,s){const n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(Et(e,i),s)}),s(e,this.value,n)}findOnPath(e,s){return this.findOnPath_(e,Be(),s)}findOnPath_(e,s,n){const i=this.value?n(s,this.value):!1;if(i)return i;if(Ee(e))return null;{const r=Te(e),a=this.children.get(r);return a?a.findOnPath_(ot(e),Et(s,r),n):null}}foreachOnPath(e,s){return this.foreachOnPath_(e,Be(),s)}foreachOnPath_(e,s,n){if(Ee(e))return this;{this.value&&n(s,this.value);const i=Te(e),r=this.children.get(i);return r?r.foreachOnPath_(ot(e),Et(s,i),n):new ct(null)}}foreach(e){this.foreach_(Be(),e)}foreach_(e,s){this.children.inorderTraversal((n,i)=>{i.foreach_(Et(e,n),s)}),this.value&&s(e,this.value)}foreachChild(e){this.children.inorderTraversal((s,n)=>{n.value&&e(s,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(e){this.writeTree_=e}static empty(){return new qn(new ct(null))}}function Tu(t,e,s){if(Ee(e))return new qn(new ct(s));{const n=t.writeTree_.findRootMostValueAndPath(e);if(n!=null){const i=n.path;let r=n.value;const a=ks(i,e);return r=r.updateChild(a,s),new qn(t.writeTree_.set(i,r))}else{const i=new ct(s),r=t.writeTree_.setTree(e,i);return new qn(r)}}}function Hx(t,e,s){let n=t;return ls(s,(i,r)=>{n=Tu(n,Et(e,i),r)}),n}function nN(t,e){if(Ee(e))return qn.empty();{const s=t.writeTree_.setTree(e,new ct(null));return new qn(s)}}function zx(t,e){return Mo(t,e)!=null}function Mo(t,e){const s=t.writeTree_.findRootMostValueAndPath(e);return s!=null?t.writeTree_.get(s.path).getChild(ks(s.path,e)):null}function iN(t){const e=[],s=t.writeTree_.value;return s!=null?s.isLeafNode()||s.forEachChild(kt,(n,i)=>{e.push(new Ae(n,i))}):t.writeTree_.children.inorderTraversal((n,i)=>{i.value!=null&&e.push(new Ae(n,i.value))}),e}function sa(t,e){if(Ee(e))return t;{const s=Mo(t,e);return s!=null?new qn(new ct(s)):new qn(t.writeTree_.subtree(e))}}function qx(t){return t.writeTree_.isEmpty()}function Ql(t,e){return kj(Be(),t.writeTree_,e)}function kj(t,e,s){if(e.value!=null)return s.updateChild(t,e.value);{let n=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(ee(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):s=kj(Et(t,i),r,s)}),!s.getChild(t).isEmpty()&&n!==null&&(s=s.updateChild(Et(t,".priority"),n)),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(t,e){return Ej(e,t)}function nF(t,e,s,n,i){ee(n>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:s,writeId:n,visible:i}),i&&(t.visibleWrites=Tu(t.visibleWrites,e,s)),t.lastWriteId=n}function iF(t,e,s,n){ee(n>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:s,writeId:n,visible:!0}),t.visibleWrites=Hx(t.visibleWrites,e,s),t.lastWriteId=n}function rF(t,e){for(let s=0;s<t.allWrites.length;s++){const n=t.allWrites[s];if(n.writeId===e)return n}return null}function aF(t,e){const s=t.allWrites.findIndex(l=>l.writeId===e);ee(s>=0,"removeWrite called with nonexistent writeId.");const n=t.allWrites[s];t.allWrites.splice(s,1);let i=n.visible,r=!1,a=t.allWrites.length-1;for(;i&&a>=0;){const l=t.allWrites[a];l.visible&&(a>=s&&oF(l,n.path)?i=!1:yn(n.path,l.path)&&(r=!0)),a--}if(i){if(r)return lF(t),!0;if(n.snap)t.visibleWrites=nN(t.visibleWrites,n.path);else{const l=n.children;ls(l,c=>{t.visibleWrites=nN(t.visibleWrites,Et(n.path,c))})}return!0}else return!1}function oF(t,e){if(t.snap)return yn(t.path,e);for(const s in t.children)if(t.children.hasOwnProperty(s)&&yn(Et(t.path,s),e))return!0;return!1}function lF(t){t.visibleWrites=Nj(t.allWrites,cF,Be()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function cF(t){return t.visible}function Nj(t,e,s){let n=qn.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const a=r.path;let l;if(r.snap)yn(s,a)?(l=ks(s,a),n=Tu(n,l,r.snap)):yn(a,s)&&(l=ks(a,s),n=Tu(n,Be(),r.snap.getChild(l)));else if(r.children){if(yn(s,a))l=ks(s,a),n=Hx(n,l,r.children);else if(yn(a,s))if(l=ks(a,s),Ee(l))n=Hx(n,Be(),r.children);else{const c=go(r.children,Te(l));if(c){const u=c.getChild(ot(l));n=Tu(n,Be(),u)}}}else throw yc("WriteRecord should have .snap or .children")}}return n}function Sj(t,e,s,n,i){if(!n&&!i){const r=Mo(t.visibleWrites,e);if(r!=null)return r;{const a=sa(t.visibleWrites,e);if(qx(a))return s;if(s==null&&!zx(a,Be()))return null;{const l=s||xe.EMPTY_NODE;return Ql(a,l)}}}else{const r=sa(t.visibleWrites,e);if(!i&&qx(r))return s;if(!i&&s==null&&!zx(r,Be()))return null;{const a=function(u){return(u.visible||i)&&(!n||!~n.indexOf(u.writeId))&&(yn(u.path,e)||yn(e,u.path))},l=Nj(t.allWrites,a,e),c=s||xe.EMPTY_NODE;return Ql(l,c)}}}function uF(t,e,s){let n=xe.EMPTY_NODE;const i=Mo(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(kt,(r,a)=>{n=n.updateImmediateChild(r,a)}),n;if(s){const r=sa(t.visibleWrites,e);return s.forEachChild(kt,(a,l)=>{const c=Ql(sa(r,new tt(a)),l);n=n.updateImmediateChild(a,c)}),iN(r).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}else{const r=sa(t.visibleWrites,e);return iN(r).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}}function dF(t,e,s,n,i){ee(n||i,"Either existingEventSnap or existingServerSnap must exist");const r=Et(e,s);if(zx(t.visibleWrites,r))return null;{const a=sa(t.visibleWrites,r);return qx(a)?i.getChild(s):Ql(a,i.getChild(s))}}function hF(t,e,s,n){const i=Et(e,s),r=Mo(t.visibleWrites,i);if(r!=null)return r;if(n.isCompleteForChild(s)){const a=sa(t.visibleWrites,i);return Ql(a,n.getNode().getImmediateChild(s))}else return null}function fF(t,e){return Mo(t.visibleWrites,e)}function mF(t,e,s,n,i,r,a){let l;const c=sa(t.visibleWrites,e),u=Mo(c,Be());if(u!=null)l=u;else if(s!=null)l=Ql(c,s);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const d=[],h=a.getCompare(),f=r?l.getReverseIteratorFrom(n,a):l.getIteratorFrom(n,a);let m=f.getNext();for(;m&&d.length<i;)h(m,n)!==0&&d.push(m),m=f.getNext();return d}else return[]}function pF(){return{visibleWrites:qn.empty(),allWrites:[],lastWriteId:-1}}function hm(t,e,s,n){return Sj(t.writeTree,t.treePath,e,s,n)}function yy(t,e){return uF(t.writeTree,t.treePath,e)}function rN(t,e,s,n){return dF(t.writeTree,t.treePath,e,s,n)}function fm(t,e){return fF(t.writeTree,Et(t.treePath,e))}function gF(t,e,s,n,i,r){return mF(t.writeTree,t.treePath,e,s,n,i,r)}function _y(t,e,s){return hF(t.writeTree,t.treePath,e,s)}function Tj(t,e){return Ej(Et(t.treePath,e),t.writeTree)}function Ej(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(){this.changeMap=new Map}trackChildChange(e){const s=e.type,n=e.childName;ee(s==="child_added"||s==="child_changed"||s==="child_removed","Only child changes supported for tracking"),ee(n!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if(s==="child_added"&&r==="child_removed")this.changeMap.set(n,id(n,e.snapshotNode,i.snapshotNode));else if(s==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(s==="child_removed"&&r==="child_changed")this.changeMap.set(n,nd(n,i.oldSnap));else if(s==="child_changed"&&r==="child_added")this.changeMap.set(n,Xl(n,e.snapshotNode));else if(s==="child_changed"&&r==="child_changed")this.changeMap.set(n,id(n,e.snapshotNode,i.oldSnap));else throw yc("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bF{getCompleteChild(e){return null}getChildAfterChild(e,s,n){return null}}const Aj=new bF;class wy{constructor(e,s,n=null){this.writes_=e,this.viewCache_=s,this.optCompleteServerCache_=n}getCompleteChild(e){const s=this.viewCache_.eventCache;if(s.isCompleteForChild(e))return s.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new ha(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _y(this.writes_,e,n)}}getChildAfterChild(e,s,n){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wo(this.viewCache_),r=gF(this.writes_,i,s,1,n,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vF(t){return{filter:t}}function yF(t,e){ee(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ee(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function _F(t,e,s,n,i){const r=new xF;let a,l;if(s.type===Gn.OVERWRITE){const u=s;u.source.fromUser?a=Kx(t,e,u.path,u.snap,n,i,r):(ee(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered()&&!Ee(u.path),a=mm(t,e,u.path,u.snap,n,i,l,r))}else if(s.type===Gn.MERGE){const u=s;u.source.fromUser?a=kF(t,e,u.path,u.children,n,i,r):(ee(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered(),a=Wx(t,e,u.path,u.children,n,i,l,r))}else if(s.type===Gn.ACK_USER_WRITE){const u=s;u.revert?a=TF(t,e,u.path,n,i,r):a=NF(t,e,u.path,u.affectedTree,n,i,r)}else if(s.type===Gn.LISTEN_COMPLETE)a=SF(t,e,s.path,n,r);else throw yc("Unknown operation type: "+s.type);const c=r.getChanges();return wF(e,a,c),{viewCache:a,changes:c}}function wF(t,e,s){const n=e.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=dm(t);(s.length>0||!t.eventCache.isFullyInitialized()||i&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&s.push(_j(dm(e)))}}function jj(t,e,s,n,i,r){const a=e.eventCache;if(fm(n,s)!=null)return e;{let l,c;if(Ee(s))if(ee(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=wo(e),d=u instanceof xe?u:xe.EMPTY_NODE,h=yy(n,d);l=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const u=hm(n,wo(e));l=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const u=Te(s);if(u===".priority"){ee(da(s)===1,"Can't have a priority with additional path components");const d=a.getNode();c=e.serverCache.getNode();const h=rN(n,s,d,c);h!=null?l=t.filter.updatePriority(d,h):l=a.getNode()}else{const d=ot(s);let h;if(a.isCompleteForChild(u)){c=e.serverCache.getNode();const f=rN(n,s,a.getNode(),c);f!=null?h=a.getNode().getImmediateChild(u).updateChild(d,f):h=a.getNode().getImmediateChild(u)}else h=_y(n,u,e.serverCache);h!=null?l=t.filter.updateChild(a.getNode(),u,h,d,i,r):l=a.getNode()}}return Su(e,l,a.isFullyInitialized()||Ee(s),t.filter.filtersNodes())}}function mm(t,e,s,n,i,r,a,l){const c=e.serverCache;let u;const d=a?t.filter:t.filter.getIndexedFilter();if(Ee(s))u=d.updateFullNode(c.getNode(),n,null);else if(d.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(s,n);u=d.updateFullNode(c.getNode(),m,null)}else{const m=Te(s);if(!c.isCompleteForPath(s)&&da(s)>1)return e;const b=ot(s),v=c.getNode().getImmediateChild(m).updateChild(b,n);m===".priority"?u=d.updatePriority(c.getNode(),v):u=d.updateChild(c.getNode(),m,v,b,Aj,null)}const h=wj(e,u,c.isFullyInitialized()||Ee(s),d.filtersNodes()),f=new wy(i,h,r);return jj(t,h,s,i,f,l)}function Kx(t,e,s,n,i,r,a){const l=e.eventCache;let c,u;const d=new wy(i,e,r);if(Ee(s))u=t.filter.updateFullNode(e.eventCache.getNode(),n,a),c=Su(e,u,!0,t.filter.filtersNodes());else{const h=Te(s);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),n),c=Su(e,u,l.isFullyInitialized(),l.isFiltered());else{const f=ot(s),m=l.getNode().getImmediateChild(h);let b;if(Ee(f))b=n;else{const p=d.getCompleteChild(h);p!=null?uy(f)===".priority"&&p.getChild(mj(f)).isEmpty()?b=p:b=p.updateChild(f,n):b=xe.EMPTY_NODE}if(m.equals(b))c=e;else{const p=t.filter.updateChild(l.getNode(),h,b,f,d,a);c=Su(e,p,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function aN(t,e){return t.eventCache.isCompleteForChild(e)}function kF(t,e,s,n,i,r,a){let l=e;return n.foreach((c,u)=>{const d=Et(s,c);aN(e,Te(d))&&(l=Kx(t,l,d,u,i,r,a))}),n.foreach((c,u)=>{const d=Et(s,c);aN(e,Te(d))||(l=Kx(t,l,d,u,i,r,a))}),l}function oN(t,e,s){return s.foreach((n,i)=>{e=e.updateChild(n,i)}),e}function Wx(t,e,s,n,i,r,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Ee(s)?u=n:u=new ct(null).setTree(s,n);const d=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(d.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),b=oN(t,m,f);c=mm(t,c,new tt(h),b,i,r,a,l)}}),u.children.inorderTraversal((h,f)=>{const m=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!d.hasChild(h)&&!m){const b=e.serverCache.getNode().getImmediateChild(h),p=oN(t,b,f);c=mm(t,c,new tt(h),p,i,r,a,l)}}),c}function NF(t,e,s,n,i,r,a){if(fm(i,s)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(Ee(s)&&c.isFullyInitialized()||c.isCompleteForPath(s))return mm(t,e,s,c.getNode().getChild(s),i,r,l,a);if(Ee(s)){let u=new ct(null);return c.getNode().forEachChild(Rl,(d,h)=>{u=u.set(new tt(d),h)}),Wx(t,e,s,u,i,r,l,a)}else return e}else{let u=new ct(null);return n.foreach((d,h)=>{const f=Et(s,d);c.isCompleteForPath(f)&&(u=u.set(d,c.getNode().getChild(f)))}),Wx(t,e,s,u,i,r,l,a)}}function SF(t,e,s,n,i){const r=e.serverCache,a=wj(e,r.getNode(),r.isFullyInitialized()||Ee(s),r.isFiltered());return jj(t,a,s,n,Aj,i)}function TF(t,e,s,n,i,r){let a;if(fm(n,s)!=null)return e;{const l=new wy(n,e,i),c=e.eventCache.getNode();let u;if(Ee(s)||Te(s)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=hm(n,wo(e));else{const h=e.serverCache.getNode();ee(h instanceof xe,"serverChildren would be complete if leaf node"),d=yy(n,h)}d=d,u=t.filter.updateFullNode(c,d,r)}else{const d=Te(s);let h=_y(n,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?u=t.filter.updateChild(c,d,h,ot(s),l,r):e.eventCache.getNode().hasChild(d)?u=t.filter.updateChild(c,d,xe.EMPTY_NODE,ot(s),l,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=hm(n,wo(e)),a.isLeafNode()&&(u=t.filter.updateFullNode(u,a,r)))}return a=e.serverCache.isFullyInitialized()||fm(n,Be())!=null,Su(e,u,a,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e,s){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new my(n.getIndex()),r=HV(n);this.processor_=vF(r);const a=s.serverCache,l=s.eventCache,c=i.updateFullNode(xe.EMPTY_NODE,a.getNode(),null),u=r.updateFullNode(xe.EMPTY_NODE,l.getNode(),null),d=new ha(c,a.isFullyInitialized(),i.filtersNodes()),h=new ha(u,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=yp(h,d),this.eventGenerator_=new JV(this.query_)}get query(){return this.query_}}function AF(t){return t.viewCache_.serverCache.getNode()}function jF(t){return dm(t.viewCache_)}function CF(t,e){const s=wo(t.viewCache_);return s&&(t.query._queryParams.loadsAllData()||!Ee(e)&&!s.getImmediateChild(Te(e)).isEmpty())?s.getChild(e):null}function lN(t){return t.eventRegistrations_.length===0}function RF(t,e){t.eventRegistrations_.push(e)}function cN(t,e,s){const n=[];if(s){ee(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const a=r.createCancelEvent(s,i);a&&n.push(a)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const a=t.eventRegistrations_[r];if(!a.matches(e))i.push(a);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return n}function uN(t,e,s,n){e.type===Gn.MERGE&&e.source.queryId!==null&&(ee(wo(t.viewCache_),"We should always have a full cache before handling merges"),ee(dm(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=_F(t.processor_,i,e,s,n);return yF(t.processor_,r.viewCache),ee(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Cj(t,r.changes,r.viewCache.eventCache.getNode(),null)}function IF(t,e){const s=t.viewCache_.eventCache,n=[];return s.getNode().isLeafNode()||s.getNode().forEachChild(kt,(r,a)=>{n.push(Xl(r,a))}),s.isFullyInitialized()&&n.push(_j(s.getNode())),Cj(t,n,s.getNode(),e)}function Cj(t,e,s,n){const i=n?[n]:t.eventRegistrations_;return ZV(t.eventGenerator_,e,s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pm;class Rj{constructor(){this.views=new Map}}function OF(t){ee(!pm,"__referenceConstructor has already been defined"),pm=t}function MF(){return ee(pm,"Reference.ts has not been loaded"),pm}function DF(t){return t.views.size===0}function ky(t,e,s,n){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return ee(r!=null,"SyncTree gave us an op for an invalid query."),uN(r,e,s,n)}else{let r=[];for(const a of t.views.values())r=r.concat(uN(a,e,s,n));return r}}function Ij(t,e,s,n,i){const r=e._queryIdentifier,a=t.views.get(r);if(!a){let l=hm(s,i?n:null),c=!1;l?c=!0:n instanceof xe?(l=yy(s,n),c=!1):(l=xe.EMPTY_NODE,c=!1);const u=yp(new ha(l,c,!1),new ha(n,i,!1));return new EF(e,u)}return a}function LF(t,e,s,n,i,r){const a=Ij(t,e,n,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,a),RF(a,s),IF(a,s)}function PF(t,e,s,n){const i=e._queryIdentifier,r=[];let a=[];const l=fa(t);if(i==="default")for(const[c,u]of t.views.entries())a=a.concat(cN(u,s,n)),lN(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||r.push(u.query));else{const c=t.views.get(i);c&&(a=a.concat(cN(c,s,n)),lN(c)&&(t.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!fa(t)&&r.push(new(MF())(e._repo,e._path)),{removed:r,events:a}}function Oj(t){const e=[];for(const s of t.views.values())s.query._queryParams.loadsAllData()||e.push(s);return e}function na(t,e){let s=null;for(const n of t.views.values())s=s||CF(n,e);return s}function Mj(t,e){if(e._queryParams.loadsAllData())return wp(t);{const n=e._queryIdentifier;return t.views.get(n)}}function Dj(t,e){return Mj(t,e)!=null}function fa(t){return wp(t)!=null}function wp(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gm;function VF(t){ee(!gm,"__referenceConstructor has already been defined"),gm=t}function FF(){return ee(gm,"Reference.ts has not been loaded"),gm}let BF=1;class dN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_=pF(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ny(t,e,s,n,i){return nF(t.pendingWriteTree_,e,s,n,i),i?Tc(t,new _o(gy(),e,s)):[]}function UF(t,e,s,n){iF(t.pendingWriteTree_,e,s,n);const i=ct.fromObject(s);return Tc(t,new vy(gy(),e,i))}function Ur(t,e,s=!1){const n=rF(t.pendingWriteTree_,e);if(aF(t.pendingWriteTree_,e)){let r=new ct(null);return n.snap!=null?r=r.set(Be(),!0):ls(n.children,a=>{r=r.set(new tt(a),!0)}),Tc(t,new um(n.path,r,s))}else return[]}function Hd(t,e,s){return Tc(t,new _o(xy(),e,s))}function $F(t,e,s){const n=ct.fromObject(s);return Tc(t,new vy(xy(),e,n))}function GF(t,e){return Tc(t,new ad(xy(),e))}function HF(t,e,s){const n=Sy(t,s);if(n){const i=Ty(n),r=i.path,a=i.queryId,l=ks(r,e),c=new ad(by(a),l);return Ey(t,r,c)}else return[]}function xm(t,e,s,n,i=!1){const r=e._path,a=t.syncPointTree_.get(r);let l=[];if(a&&(e._queryIdentifier==="default"||Dj(a,e))){const c=PF(a,e,s,n);DF(a)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const u=c.removed;if(l=c.events,!i){const d=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(f,m)=>fa(m));if(d&&!h){const f=t.syncPointTree_.subtree(r);if(!f.isEmpty()){const m=KF(f);for(let b=0;b<m.length;++b){const p=m[b],v=p.query,x=Fj(t,p);t.listenProvider_.startListening(Eu(v),od(t,v),x.hashFn,x.onComplete)}}}!h&&u.length>0&&!n&&(d?t.listenProvider_.stopListening(Eu(e),null):u.forEach(f=>{const m=t.queryToTagMap.get(Np(f));t.listenProvider_.stopListening(Eu(f),m)}))}WF(t,u)}return l}function Lj(t,e,s,n){const i=Sy(t,n);if(i!=null){const r=Ty(i),a=r.path,l=r.queryId,c=ks(a,e),u=new _o(by(l),c,s);return Ey(t,a,u)}else return[]}function zF(t,e,s,n){const i=Sy(t,n);if(i){const r=Ty(i),a=r.path,l=r.queryId,c=ks(a,e),u=ct.fromObject(s),d=new vy(by(l),c,u);return Ey(t,a,d)}else return[]}function Yx(t,e,s,n=!1){const i=e._path;let r=null,a=!1;t.syncPointTree_.foreachOnPath(i,(f,m)=>{const b=ks(f,i);r=r||na(m,b),a=a||fa(m)});let l=t.syncPointTree_.get(i);l?(a=a||fa(l),r=r||na(l,Be())):(l=new Rj,t.syncPointTree_=t.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=xe.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((m,b)=>{const p=na(b,Be());p&&(r=r.updateImmediateChild(m,p))}));const u=Dj(l,e);if(!u&&!e._queryParams.loadsAllData()){const f=Np(e);ee(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=YF();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const d=_p(t.pendingWriteTree_,i);let h=LF(l,e,s,d,r,c);if(!u&&!a&&!n){const f=Mj(l,e);h=h.concat(XF(t,e,f))}return h}function kp(t,e,s){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(a,l)=>{const c=ks(a,e),u=na(l,c);if(u)return u});return Sj(i,e,r,s,!0)}function qF(t,e){const s=e._path;let n=null;t.syncPointTree_.foreachOnPath(s,(u,d)=>{const h=ks(u,s);n=n||na(d,h)});let i=t.syncPointTree_.get(s);i?n=n||na(i,Be()):(i=new Rj,t.syncPointTree_=t.syncPointTree_.set(s,i));const r=n!=null,a=r?new ha(n,!0,!1):null,l=_p(t.pendingWriteTree_,e._path),c=Ij(i,e,l,r?a.getNode():xe.EMPTY_NODE,r);return jF(c)}function Tc(t,e){return Pj(e,t.syncPointTree_,null,_p(t.pendingWriteTree_,Be()))}function Pj(t,e,s,n){if(Ee(t.path))return Vj(t,e,s,n);{const i=e.get(Be());s==null&&i!=null&&(s=na(i,Be()));let r=[];const a=Te(t.path),l=t.operationForChild(a),c=e.children.get(a);if(c&&l){const u=s?s.getImmediateChild(a):null,d=Tj(n,a);r=r.concat(Pj(l,c,u,d))}return i&&(r=r.concat(ky(i,t,n,s))),r}}function Vj(t,e,s,n){const i=e.get(Be());s==null&&i!=null&&(s=na(i,Be()));let r=[];return e.children.inorderTraversal((a,l)=>{const c=s?s.getImmediateChild(a):null,u=Tj(n,a),d=t.operationForChild(a);d&&(r=r.concat(Vj(d,l,c,u)))}),i&&(r=r.concat(ky(i,t,n,s))),r}function Fj(t,e){const s=e.query,n=od(t,s);return{hashFn:()=>(AF(e)||xe.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return n?HF(t,s._path,n):GF(t,s._path);{const r=$8(i,s);return xm(t,s,null,r)}}}}function od(t,e){const s=Np(e);return t.queryToTagMap.get(s)}function Np(t){return t._path.toString()+"$"+t._queryIdentifier}function Sy(t,e){return t.tagToQueryMap.get(e)}function Ty(t){const e=t.indexOf("$");return ee(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new tt(t.substr(0,e))}}function Ey(t,e,s){const n=t.syncPointTree_.get(e);ee(n,"Missing sync point for query tag that we're tracking");const i=_p(t.pendingWriteTree_,e);return ky(n,s,i,null)}function KF(t){return t.fold((e,s,n)=>{if(s&&fa(s))return[wp(s)];{let i=[];return s&&(i=Oj(s)),ls(n,(r,a)=>{i=i.concat(a)}),i}})}function Eu(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(FF())(t._repo,t._path):t}function WF(t,e){for(let s=0;s<e.length;++s){const n=e[s];if(!n._queryParams.loadsAllData()){const i=Np(n),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function YF(){return BF++}function XF(t,e,s){const n=e._path,i=od(t,e),r=Fj(t,s),a=t.listenProvider_.startListening(Eu(e),i,r.hashFn,r.onComplete),l=t.syncPointTree_.subtree(n);if(i)ee(!fa(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((u,d,h)=>{if(!Ee(u)&&d&&fa(d))return[wp(d).query];{let f=[];return d&&(f=f.concat(Oj(d).map(m=>m.query))),ls(h,(m,b)=>{f=f.concat(b)}),f}});for(let u=0;u<c.length;++u){const d=c[u];t.listenProvider_.stopListening(Eu(d),od(t,d))}}return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e){this.node_=e}getImmediateChild(e){const s=this.node_.getImmediateChild(e);return new Ay(s)}node(){return this.node_}}class jy{constructor(e,s){this.syncTree_=e,this.path_=s}getImmediateChild(e){const s=Et(this.path_,e);return new jy(this.syncTree_,s)}node(){return kp(this.syncTree_,this.path_)}}const QF=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},hN=function(t,e,s){if(!t||typeof t!="object")return t;if(ee(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return JF(t[".sv"],e,s);if(typeof t[".sv"]=="object")return ZF(t[".sv"],e);ee(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},JF=function(t,e,s){switch(t){case"timestamp":return s.timestamp;default:ee(!1,"Unexpected server value: "+t)}},ZF=function(t,e,s){t.hasOwnProperty("increment")||ee(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const n=t.increment;typeof n!="number"&&ee(!1,"Unexpected increment value: "+n);const i=e.node();if(ee(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const a=i.getValue();return typeof a!="number"?n:a+n},Bj=function(t,e,s,n){return Ry(e,new jy(s,t),n)},Cy=function(t,e,s){return Ry(t,new Ay(e),s)};function Ry(t,e,s){const n=t.getPriority().val(),i=hN(n,e.getImmediateChild(".priority"),s);let r;if(t.isLeafNode()){const a=t,l=hN(a.getValue(),e,s);return l!==a.getValue()||i!==a.getPriority().val()?new ts(l,Tt(i)):t}else{const a=t;return r=a,i!==a.getPriority().val()&&(r=r.updatePriority(new ts(i))),a.forEachChild(kt,(l,c)=>{const u=Ry(c,e.getImmediateChild(l),s);u!==c&&(r=r.updateImmediateChild(l,u))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(e="",s=null,n={children:{},childCount:0}){this.name=e,this.parent=s,this.node=n}}function Sp(t,e){let s=e instanceof tt?e:new tt(e),n=t,i=Te(s);for(;i!==null;){const r=go(n.node.children,i)||{children:{},childCount:0};n=new Iy(i,n,r),s=ot(s),i=Te(s)}return n}function Do(t){return t.node.value}function Oy(t,e){t.node.value=e,Xx(t)}function Uj(t){return t.node.childCount>0}function eB(t){return Do(t)===void 0&&!Uj(t)}function Tp(t,e){ls(t.node.children,(s,n)=>{e(new Iy(s,t,n))})}function $j(t,e,s,n){s&&e(t),Tp(t,i=>{$j(i,e,!0)})}function tB(t,e,s){let n=t.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function zd(t){return new tt(t.parent===null?t.name:zd(t.parent)+"/"+t.name)}function Xx(t){t.parent!==null&&sB(t.parent,t.name,t)}function sB(t,e,s){const n=eB(s),i=Zn(t.node.children,e);n&&i?(delete t.node.children[e],t.node.childCount--,Xx(t)):!n&&!i&&(t.node.children[e]=s.node,t.node.childCount++,Xx(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nB=/[\[\].#$\/\u0000-\u001F\u007F]/,iB=/[\[\].#$\u0000-\u001F\u007F]/,ag=10*1024*1024,My=function(t){return typeof t=="string"&&t.length!==0&&!nB.test(t)},Gj=function(t){return typeof t=="string"&&t.length!==0&&!iB.test(t)},rB=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Gj(t)},Dy=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!bp(t)||t&&typeof t=="object"&&Zn(t,".sv")},bm=function(t,e,s,n){n&&e===void 0||qd(Kl(t,"value"),e,s)},qd=function(t,e,s){const n=s instanceof tt?new wV(s,t):s;if(e===void 0)throw new Error(t+"contains undefined "+za(n));if(typeof e=="function")throw new Error(t+"contains a function "+za(n)+" with contents = "+e.toString());if(bp(e))throw new Error(t+"contains "+e.toString()+" "+za(n));if(typeof e=="string"&&e.length>ag/3&&mp(e)>ag)throw new Error(t+"contains a string greater than "+ag+" utf8 bytes "+za(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(ls(e,(a,l)=>{if(a===".value")i=!0;else if(a!==".priority"&&a!==".sv"&&(r=!0,!My(a)))throw new Error(t+" contains an invalid key ("+a+") "+za(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);kV(n,a),qd(t,l,n),NV(n)}),i&&r)throw new Error(t+' contains ".value" child '+za(n)+" in addition to actual children.")}},aB=function(t,e){let s,n;for(s=0;s<e.length;s++){n=e[s];const r=sd(n);for(let a=0;a<r.length;a++)if(!(r[a]===".priority"&&a===r.length-1)){if(!My(r[a]))throw new Error(t+"contains an invalid key ("+r[a]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(_V);let i=null;for(s=0;s<e.length;s++){if(n=e[s],i!==null&&yn(i,n))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}},Hj=function(t,e,s,n){const i=Kl(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];ls(e,(a,l)=>{const c=new tt(a);if(qd(i,l,Et(s,c)),uy(c)===".priority"&&!Dy(l))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),aB(i,r)},oB=function(t,e,s){if(bp(e))throw new Error(Kl(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Dy(e))throw new Error(Kl(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},zj=function(t,e,s,n){if(!Gj(s))throw new Error(Kl(t,e)+'was an invalid path = "'+s+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},lB=function(t,e,s,n){s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),zj(t,e,s)},$r=function(t,e){if(Te(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},cB=function(t,e){const s=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!My(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!rB(s))throw new Error(Kl(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uB{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ep(t,e){let s=null;for(let n=0;n<e.length;n++){const i=e[n],r=i.getPath();s!==null&&!dy(r,s.path)&&(t.eventLists_.push(s),s=null),s===null&&(s={events:[],path:r}),s.events.push(i)}s&&t.eventLists_.push(s)}function qj(t,e,s){Ep(t,s),Kj(t,n=>dy(n,e))}function un(t,e,s){Ep(t,s),Kj(t,n=>yn(n,e)||yn(e,n))}function Kj(t,e){t.recursionDepth_++;let s=!0;for(let n=0;n<t.eventLists_.length;n++){const i=t.eventLists_[n];if(i){const r=i.path;e(r)?(dB(t.eventLists_[n]),t.eventLists_[n]=null):s=!1}}s&&(t.eventLists_=[]),t.recursionDepth_--}function dB(t){for(let e=0;e<t.events.length;e++){const s=t.events[e];if(s!==null){t.events[e]=null;const n=s.getEventRunner();ku&&rs("event: "+s.toString()),Nc(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hB="repo_interrupt",fB=25;class mB{constructor(e,s,n,i){this.repoInfo_=e,this.forceRestClient_=s,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new uB,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=cm(),this.transactionQueueTree_=new Iy,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function pB(t,e,s){if(t.stats_=ly(t.repoInfo_),t.forceRestClient_||q8())t.server_=new lm(t.repoInfo_,(n,i,r,a)=>{fN(t,n,i,r,a)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>mN(t,!0),0);else{if(typeof s<"u"&&s!==null){if(typeof s!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Qt(s)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}t.persistentConnection_=new Gi(t.repoInfo_,e,(n,i,r,a)=>{fN(t,n,i,r,a)},n=>{mN(t,n)},n=>{gB(t,n)},t.authTokenProvider_,t.appCheckProvider_,s),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(n=>{t.server_.refreshAuthToken(n)}),t.appCheckProvider_.addTokenChangeListener(n=>{t.server_.refreshAppCheckToken(n.token)}),t.statsReporter_=Q8(t.repoInfo_,()=>new QV(t.stats_,t.server_)),t.infoData_=new qV,t.infoSyncTree_=new dN({startListening:(n,i,r,a)=>{let l=[];const c=t.infoData_.getNode(n._path);return c.isEmpty()||(l=Hd(t.infoSyncTree_,n._path,c),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),Ly(t,"connected",!1),t.serverSyncTree_=new dN({startListening:(n,i,r,a)=>(t.server_.listen(n,r,i,(l,c)=>{const u=a(l,c);un(t.eventQueue_,n._path,u)}),[]),stopListening:(n,i)=>{t.server_.unlisten(n,i)}})}function Wj(t){const s=t.infoData_.getNode(new tt(".info/serverTimeOffset")).val()||0;return new Date().getTime()+s}function Kd(t){return QF({timestamp:Wj(t)})}function fN(t,e,s,n,i){t.dataUpdateCount++;const r=new tt(e);s=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,s):s;let a=[];if(i)if(n){const c=Qf(s,u=>Tt(u));a=zF(t.serverSyncTree_,r,c,i)}else{const c=Tt(s);a=Lj(t.serverSyncTree_,r,c,i)}else if(n){const c=Qf(s,u=>Tt(u));a=$F(t.serverSyncTree_,r,c)}else{const c=Tt(s);a=Hd(t.serverSyncTree_,r,c)}let l=r;a.length>0&&(l=Jl(t,r)),un(t.eventQueue_,l,a)}function mN(t,e){Ly(t,"connected",e),e===!1&&yB(t)}function gB(t,e){ls(e,(s,n)=>{Ly(t,s,n)})}function Ly(t,e,s){const n=new tt("/.info/"+e),i=Tt(s);t.infoData_.updateSnapshot(n,i);const r=Hd(t.infoSyncTree_,n,i);un(t.eventQueue_,n,r)}function Ap(t){return t.nextWriteId_++}function xB(t,e,s){const n=qF(t.serverSyncTree_,e);return n!=null?Promise.resolve(n):t.server_.get(e).then(i=>{const r=Tt(i).withIndex(e._queryParams.getIndex());Yx(t.serverSyncTree_,e,s,!0);let a;if(e._queryParams.loadsAllData())a=Hd(t.serverSyncTree_,e._path,r);else{const l=od(t.serverSyncTree_,e);a=Lj(t.serverSyncTree_,e._path,r,l)}return un(t.eventQueue_,e._path,a),xm(t.serverSyncTree_,e,s,null,!0),r},i=>(Ec(t,"get for query "+Qt(e)+" failed: "+i),Promise.reject(new Error(i))))}function bB(t,e,s,n,i){Ec(t,"set",{path:e.toString(),value:s,priority:n});const r=Kd(t),a=Tt(s,n),l=kp(t.serverSyncTree_,e),c=Cy(a,l,r),u=Ap(t),d=Ny(t.serverSyncTree_,e,c,u,!0);Ep(t.eventQueue_,d),t.server_.put(e.toString(),a.val(!0),(f,m)=>{const b=f==="ok";b||Ts("set at "+e+" failed: "+f);const p=Ur(t.serverSyncTree_,u,!b);un(t.eventQueue_,e,p),ma(t,i,f,m)});const h=Vy(t,e);Jl(t,h),un(t.eventQueue_,h,[])}function vB(t,e,s,n){Ec(t,"update",{path:e.toString(),value:s});let i=!0;const r=Kd(t),a={};if(ls(s,(l,c)=>{i=!1,a[l]=Bj(Et(e,l),Tt(c),t.serverSyncTree_,r)}),i)rs("update() called with empty data.  Don't do anything."),ma(t,n,"ok",void 0);else{const l=Ap(t),c=UF(t.serverSyncTree_,e,a,l);Ep(t.eventQueue_,c),t.server_.merge(e.toString(),s,(u,d)=>{const h=u==="ok";h||Ts("update at "+e+" failed: "+u);const f=Ur(t.serverSyncTree_,l,!h),m=f.length>0?Jl(t,e):e;un(t.eventQueue_,m,f),ma(t,n,u,d)}),ls(s,u=>{const d=Vy(t,Et(e,u));Jl(t,d)}),un(t.eventQueue_,e,[])}}function yB(t){Ec(t,"onDisconnectEvents");const e=Kd(t),s=cm();$x(t.onDisconnect_,Be(),(i,r)=>{const a=Bj(i,r,t.serverSyncTree_,e);Sc(s,i,a)});let n=[];$x(s,Be(),(i,r)=>{n=n.concat(Hd(t.serverSyncTree_,i,r));const a=Vy(t,i);Jl(t,a)}),t.onDisconnect_=cm(),un(t.eventQueue_,Be(),n)}function _B(t,e,s){t.server_.onDisconnectCancel(e.toString(),(n,i)=>{n==="ok"&&Ux(t.onDisconnect_,e),ma(t,s,n,i)})}function pN(t,e,s,n){const i=Tt(s);t.server_.onDisconnectPut(e.toString(),i.val(!0),(r,a)=>{r==="ok"&&Sc(t.onDisconnect_,e,i),ma(t,n,r,a)})}function wB(t,e,s,n,i){const r=Tt(s,n);t.server_.onDisconnectPut(e.toString(),r.val(!0),(a,l)=>{a==="ok"&&Sc(t.onDisconnect_,e,r),ma(t,i,a,l)})}function kB(t,e,s,n){if(Xf(s)){rs("onDisconnect().update() called with empty data.  Don't do anything."),ma(t,n,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),s,(i,r)=>{i==="ok"&&ls(s,(a,l)=>{const c=Tt(l);Sc(t.onDisconnect_,Et(e,a),c)}),ma(t,n,i,r)})}function NB(t,e,s){let n;Te(e._path)===".info"?n=Yx(t.infoSyncTree_,e,s):n=Yx(t.serverSyncTree_,e,s),qj(t.eventQueue_,e._path,n)}function gN(t,e,s){let n;Te(e._path)===".info"?n=xm(t.infoSyncTree_,e,s):n=xm(t.serverSyncTree_,e,s),qj(t.eventQueue_,e._path,n)}function SB(t){t.persistentConnection_&&t.persistentConnection_.interrupt(hB)}function Ec(t,...e){let s="";t.persistentConnection_&&(s=t.persistentConnection_.id+":"),rs(s,...e)}function ma(t,e,s,n){e&&Nc(()=>{if(s==="ok")e(null);else{const i=(s||"error").toUpperCase();let r=i;n&&(r+=": "+n);const a=new Error(r);a.code=i,e(a)}})}function TB(t,e,s,n,i,r){Ec(t,"transaction on "+e);const a={path:e,update:s,onComplete:n,status:null,order:q5(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=Py(t,e,void 0);a.currentInputSnapshot=l;const c=a.update(l.val());if(c===void 0)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{qd("transaction failed: Data returned ",c,a.path),a.status=0;const u=Sp(t.transactionQueueTree_,e),d=Do(u)||[];d.push(a),Oy(u,d);let h;typeof c=="object"&&c!==null&&Zn(c,".priority")?(h=go(c,".priority"),ee(Dy(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(kp(t.serverSyncTree_,e)||xe.EMPTY_NODE).getPriority().val();const f=Kd(t),m=Tt(c,h),b=Cy(m,l,f);a.currentOutputSnapshotRaw=m,a.currentOutputSnapshotResolved=b,a.currentWriteId=Ap(t);const p=Ny(t.serverSyncTree_,e,b,a.currentWriteId,a.applyLocally);un(t.eventQueue_,e,p),jp(t,t.transactionQueueTree_)}}function Py(t,e,s){return kp(t.serverSyncTree_,e,s)||xe.EMPTY_NODE}function jp(t,e=t.transactionQueueTree_){if(e||Cp(t,e),Do(e)){const s=Xj(t,e);ee(s.length>0,"Sending zero length transaction queue"),s.every(i=>i.status===0)&&EB(t,zd(e),s)}else Uj(e)&&Tp(e,s=>{jp(t,s)})}function EB(t,e,s){const n=s.map(u=>u.currentWriteId),i=Py(t,e,n);let r=i;const a=i.hash();for(let u=0;u<s.length;u++){const d=s[u];ee(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=ks(e,d.path);r=r.updateChild(h,d.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;t.server_.put(c.toString(),l,u=>{Ec(t,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){const h=[];for(let f=0;f<s.length;f++)s[f].status=2,d=d.concat(Ur(t.serverSyncTree_,s[f].currentWriteId)),s[f].onComplete&&h.push(()=>s[f].onComplete(null,!0,s[f].currentOutputSnapshotResolved)),s[f].unwatcher();Cp(t,Sp(t.transactionQueueTree_,e)),jp(t,t.transactionQueueTree_),un(t.eventQueue_,e,d);for(let f=0;f<h.length;f++)Nc(h[f])}else{if(u==="datastale")for(let h=0;h<s.length;h++)s[h].status===3?s[h].status=4:s[h].status=0;else{Ts("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<s.length;h++)s[h].status=4,s[h].abortReason=u}Jl(t,e)}},a)}function Jl(t,e){const s=Yj(t,e),n=zd(s),i=Xj(t,s);return AB(t,i,n),n}function AB(t,e,s){if(e.length===0)return;const n=[];let i=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],u=ks(s,c.path);let d=!1,h;if(ee(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,i=i.concat(Ur(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=fB)d=!0,h="maxretry",i=i.concat(Ur(t.serverSyncTree_,c.currentWriteId,!0));else{const f=Py(t,c.path,a);c.currentInputSnapshot=f;const m=e[l].update(f.val());if(m!==void 0){qd("transaction failed: Data returned ",m,c.path);let b=Tt(m);typeof m=="object"&&m!=null&&Zn(m,".priority")||(b=b.updatePriority(f.getPriority()));const v=c.currentWriteId,x=Kd(t),g=Cy(b,f,x);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=g,c.currentWriteId=Ap(t),a.splice(a.indexOf(v),1),i=i.concat(Ny(t.serverSyncTree_,c.path,g,c.currentWriteId,c.applyLocally)),i=i.concat(Ur(t.serverSyncTree_,v,!0))}else d=!0,h="nodata",i=i.concat(Ur(t.serverSyncTree_,c.currentWriteId,!0))}un(t.eventQueue_,s,i),i=[],d&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?n.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):n.push(()=>e[l].onComplete(new Error(h),!1,null))))}Cp(t,t.transactionQueueTree_);for(let l=0;l<n.length;l++)Nc(n[l]);jp(t,t.transactionQueueTree_)}function Yj(t,e){let s,n=t.transactionQueueTree_;for(s=Te(e);s!==null&&Do(n)===void 0;)n=Sp(n,s),e=ot(e),s=Te(e);return n}function Xj(t,e){const s=[];return Qj(t,e,s),s.sort((n,i)=>n.order-i.order),s}function Qj(t,e,s){const n=Do(e);if(n)for(let i=0;i<n.length;i++)s.push(n[i]);Tp(e,i=>{Qj(t,i,s)})}function Cp(t,e){const s=Do(e);if(s){let n=0;for(let i=0;i<s.length;i++)s[i].status!==2&&(s[n]=s[i],n++);s.length=n,Oy(e,s.length>0?s:void 0)}Tp(e,n=>{Cp(t,n)})}function Vy(t,e){const s=zd(Yj(t,e)),n=Sp(t.transactionQueueTree_,e);return tB(n,i=>{og(t,i)}),og(t,n),$j(n,i=>{og(t,i)}),s}function og(t,e){const s=Do(e);if(s){const n=[];let i=[],r=-1;for(let a=0;a<s.length;a++)s[a].status===3||(s[a].status===1?(ee(r===a-1,"All SENT items should be at beginning of queue."),r=a,s[a].status=3,s[a].abortReason="set"):(ee(s[a].status===0,"Unexpected transaction status in abort"),s[a].unwatcher(),i=i.concat(Ur(t.serverSyncTree_,s[a].currentWriteId,!0)),s[a].onComplete&&n.push(s[a].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Oy(e,void 0):s.length=r+1,un(t.eventQueue_,zd(e),i);for(let a=0;a<n.length;a++)Nc(n[a])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jB(t){let e="";const s=t.split("/");for(let n=0;n<s.length;n++)if(s[n].length>0){let i=s[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function CB(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const s of t.split("&")){if(s.length===0)continue;const n=s.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ts(`Invalid query segment '${s}' in query '${t}'`)}return e}const xN=function(t,e){const s=RB(t),n=s.namespace;s.domain==="firebase.com"&&nr(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&s.domain!=="localhost"&&nr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||P8();const i=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new rj(s.host,s.secure,n,i,e,"",n!==s.subdomain),path:new tt(s.pathString)}},RB=function(t){let e="",s="",n="",i="",r="",a=!0,l="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(l=t.substring(0,u-1),t=t.substring(u+2));let d=t.indexOf("/");d===-1&&(d=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(d,h)),d<h&&(i=jB(t.substring(d,h)));const f=CB(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(a=l==="https"||l==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if(m.toLowerCase()==="localhost")s="localhost";else if(m.split(".").length<=2)s=m;else{const b=e.indexOf(".");n=e.substring(0,b).toLowerCase(),s=e.substring(b+1),r=n}"ns"in f&&(r=f.ns)}return{host:e,port:c,domain:s,subdomain:n,secure:a,scheme:l,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bN="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",IB=function(){let t=0;const e=[];return function(s){const n=s===t;t=s;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=bN.charAt(s%64),s=Math.floor(s/64);ee(s===0,"Cannot push at time == 0");let a=r.join("");if(n){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)a+=bN.charAt(e[i]);return ee(a.length===20,"nextPushId: Length should be 20."),a}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OB{constructor(e,s,n,i){this.eventType=e,this.eventRegistration=s,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Qt(this.snapshot.exportVal())}}class MB{constructor(e,s,n){this.eventRegistration=e,this.error=s,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jj{constructor(e,s){this.snapshotCallback=e,this.cancelCallback=s}onValue(e,s){this.snapshotCallback.call(null,e,s)}onCancel(e){return ee(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DB{constructor(e,s){this._repo=e,this._path=s}cancel(){const e=new Bn;return _B(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){$r("OnDisconnect.remove",this._path);const e=new Bn;return pN(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){$r("OnDisconnect.set",this._path),bm("OnDisconnect.set",e,this._path,!1);const s=new Bn;return pN(this._repo,this._path,e,s.wrapCallback(()=>{})),s.promise}setWithPriority(e,s){$r("OnDisconnect.setWithPriority",this._path),bm("OnDisconnect.setWithPriority",e,this._path,!1),oB("OnDisconnect.setWithPriority",s);const n=new Bn;return wB(this._repo,this._path,e,s,n.wrapCallback(()=>{})),n.promise}update(e){$r("OnDisconnect.update",this._path),Hj("OnDisconnect.update",e,this._path);const s=new Bn;return kB(this._repo,this._path,e,s.wrapCallback(()=>{})),s.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,s,n,i){this._repo=e,this._path=s,this._queryParams=n,this._orderByCalled=i}get key(){return Ee(this._path)?null:uy(this._path)}get ref(){return new bi(this._repo,this._path)}get _queryIdentifier(){const e=tN(this._queryParams),s=ay(e);return s==="{}"?"default":s}get _queryObject(){return tN(this._queryParams)}isEqual(e){if(e=Wt(e),!(e instanceof Rp))return!1;const s=this._repo===e._repo,n=dy(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return s&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+yV(this._path)}}class bi extends Rp{constructor(e,s){super(e,s,new py,!1)}get parent(){const e=mj(this._path);return e===null?null:new bi(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Zl{constructor(e,s,n){this._node=e,this.ref=s,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const s=new tt(e),n=ld(this.ref,e);return new Zl(this._node.getChild(s),n,kt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,i)=>e(new Zl(i,ld(this.ref,n),kt)))}hasChild(e){const s=new tt(e);return!this._node.getChild(s).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function q(t,e){return t=Wt(t),t._checkNotDeleted("ref"),e!==void 0?ld(t._root,e):t._root}function ld(t,e){return t=Wt(t),Te(t._path)===null?lB("child","path",e):zj("child","path",e),new bi(t._repo,Et(t._path,e))}function vN(t){return t=Wt(t),new DB(t._repo,t._path)}function Fy(t,e){t=Wt(t),$r("push",t._path),bm("push",e,t._path,!0);const s=Wj(t._repo),n=IB(s),i=ld(t,n),r=ld(t,n);let a;return e!=null?a=pa(r,e).then(()=>r):a=Promise.resolve(r),i.then=a.then.bind(a),i.catch=a.then.bind(a,void 0),i}function yN(t){return $r("remove",t._path),pa(t,null)}function pa(t,e){t=Wt(t),$r("set",t._path),bm("set",e,t._path,!1);const s=new Bn;return bB(t._repo,t._path,e,null,s.wrapCallback(()=>{})),s.promise}function ae(t,e){Hj("update",e,t._path);const s=new Bn;return vB(t._repo,t._path,e,s.wrapCallback(()=>{})),s.promise}function ve(t){t=Wt(t);const e=new Jj(()=>{}),s=new Ip(e);return xB(t._repo,t,s).then(n=>new Zl(n,new bi(t._repo,t._path),t._queryParams.getIndex()))}class Ip{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,s){const n=s._queryParams.getIndex();return new OB("value",this,new Zl(e.snapshotNode,new bi(s._repo,s._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,s){return this.callbackContext.hasCancelCallback?new MB(this,e,s):null}matches(e){return e instanceof Ip?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function LB(t,e,s,n,i){let r;if(typeof n=="object"&&(r=void 0,i=n),typeof n=="function"&&(r=n),i&&i.onlyOnce){const c=s,u=(d,h)=>{gN(t._repo,t,l),c(d,h)};u.userCallback=s.userCallback,u.context=s.context,s=u}const a=new Jj(s,r||void 0),l=new Ip(a);return NB(t._repo,t,l),()=>gN(t._repo,t,l)}function Qe(t,e,s,n){return LB(t,"value",e,s,n)}class PB{}class VB extends PB{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Rp(e._repo,e._path,zV(e._queryParams,this._limit),e._orderByCalled)}}function FB(t){if(Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new VB(t)}function BB(t,...e){let s=Wt(t);for(const n of e)s=n._apply(s);return s}OF(bi);VF(bi);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UB="FIREBASE_DATABASE_EMULATOR_HOST",Qx={};let $B=!1;function GB(t,e,s,n){const i=e.lastIndexOf(":"),r=e.substring(0,i),a=_c(r);t.repoInfo_=new rj(e,a,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,s),n&&(t.authTokenProvider_=n)}function HB(t,e,s,n,i){let r=n||t.options.databaseURL;r===void 0&&(t.options.projectId||nr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rs("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let a=xN(r,i),l=a.repoInfo,c;typeof process<"u"&&Pk&&(c=Pk[UB]),c?(r=`http://${c}?ns=${l.namespace}`,a=xN(r,i),l=a.repoInfo):a.repoInfo.secure;const u=new W8(t.name,t.options,e);cB("Invalid Firebase Database URL",a),Ee(a.path)||nr("Database URL must point to the root of a Firebase Database (not including a child path).");const d=qB(l,t,u,new K8(t,s));return new KB(d,t)}function zB(t,e){const s=Qx[e];(!s||s[t.key]!==t)&&nr(`Database ${e}(${t.repoInfo_}) has already been deleted.`),SB(t),delete s[t.key]}function qB(t,e,s,n){let i=Qx[e.name];i||(i={},Qx[e.name]=i);let r=i[t.toURLString()];return r&&nr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new mB(t,$B,s,n),i[t.toURLString()]=r,r}class KB{constructor(e,s){this._repoInternal=e,this.app=s,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(pB(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new bi(this._repo,Be())),this._rootInternal}_delete(){return this._rootInternal!==null&&(zB(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&nr("Cannot call "+e+" on a deleted database.")}}function WB(t=r5(),e){const s=Xv(t,"database").getImmediate({identifier:e});if(!s._instanceStarted){const n=V3("database");n&&YB(s,...n)}return s}function YB(t,e,s,n={}){t=Wt(t),t._checkNotDeleted("useEmulator");const i=`${e}:${s}`,r=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&xo(n,r.repoInfo_.emulatorOptions))return;nr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&nr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new df(df.OWNER);else if(n.mockUserToken){const l=typeof n.mockUserToken=="string"?n.mockUserToken:F3(n.mockUserToken,t.app.options.projectId);a=new df(l)}_c(e)&&(JA(e),ZA("Database",!0)),GB(r,i,n,a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XB(t){I8(kc),Wl(new bo("database",(e,{instanceIdentifier:s})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return HB(n,i,r,s)},"PUBLIC").setMultipleInstances(!0)),ta(Vk,Fk,t),ta(Vk,Fk,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QB={".sv":"timestamp"};function JB(){return QB}function Zj(t){return{".sv":{increment:t}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZB{constructor(e,s){this.committed=e,this.snapshot=s}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function De(t,e,s){var n;if(t=Wt(t),$r("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const i=(n=void 0)!==null&&n!==void 0?n:!0,r=new Bn,a=(c,u,d)=>{let h=null;c?r.reject(c):(h=new Zl(d,new bi(t._repo,t._path),kt),r.resolve(new ZB(u,h)))},l=Qe(t,()=>{});return TB(t._repo,t._path,e,a,l,i),r.promise}Gi.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Gi.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};XB();var e9="firebase",t9="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ta(e9,t9,"app");const s9={apiKey:"AIzaSyBU11CvtAaUkADomFxcMuN6fH9ipx-VtAs",authDomain:"eiriksbok-simuleringfeudal.firebaseapp.com",databaseURL:"https://eiriksbok-simuleringfeudal-default-rtdb.europe-west1.firebasedatabase.app",projectId:"eiriksbok-simuleringfeudal",storageBucket:"eiriksbok-simuleringfeudal.firebasestorage.app",messagingSenderId:"772081963542",appId:"1:772081963542:web:05edb87535f629fd36db37",measurementId:"G-NDR8LNVQNX"},eC=i5(s9,"simulationApp"),K=WB(eC),Ho=C8(eC),tC=S.createContext(void 0),n9=({children:t})=>{const[e,s]=S.useState(null),[n,i]=S.useState(null),[r,a]=S.useState(!0),[l,c]=S.useState(null),[u,d]=S.useState(!0);S.useEffect(()=>{const v=b6(Ho,async x=>{if(x){s(x),d(x.isAnonymous);const g=q(K,`simulation_accounts/${x.uid}`),y=Qe(g,async w=>{if(w.exists())i(w.val()),a(!1);else{const k={uid:x.uid,displayName:x.displayName||`Eventyrer_${x.uid.slice(0,4)}`,globalXp:0,globalLevel:1,totalGoldEarned:0,unlockedAchievements:[],characterHistory:[],lastActive:Date.now()};await pa(g,k),i(k),a(!1)}});return()=>y()}else{d(!0);try{await o6(Ho)}catch(g){console.error("Auth failed:",g),a(!1)}}});return()=>v()},[]);const h=async(v,x)=>{c(null);try{await p6(Ho,v,x)}catch(g){throw c(g.message),g}},f=async v=>{const x=v.trim().toLowerCase();if(!x||x.length<3)return!1;const g=q(K,`simulation_reserved_names/${x}`);return!(await ve(g)).exists()},m=async(v,x,g)=>{c(null);const y=g.trim(),w=y.toLowerCase();try{if(!await f(y))throw new Error("Navnet er allerede tatt.");if(e&&e.isAnonymous){const N=Io.credential(v,x);await h6(e,N);const _={};_[`simulation_accounts/${e.uid}/displayName`]=y,_[`simulation_reserved_names/${w}`]=e.uid,await ae(q(K),_)}else{const N=await m6(Ho,v,x),_={};_[`simulation_reserved_names/${w}`]=N.user.uid;const T={uid:N.user.uid,displayName:y,globalXp:0,globalLevel:1,totalGoldEarned:0,unlockedAchievements:[],characterHistory:[],lastActive:Date.now()};_[`simulation_accounts/${N.user.uid}`]=T,await ae(q(K),_)}}catch(k){throw c(k.message),k}},b=async()=>{await v6(Ho)},p=async v=>{try{await f6(Ho,v)}catch(x){throw c(x.message),x}};return o.jsx(tC.Provider,{value:{user:e,account:n,loading:r,isAnonymous:u,error:l,login:h,register:m,logout:b,resetPassword:p,checkNameAvailability:f},children:t})},Lo=()=>{const t=S.useContext(tC);if(!t)throw new Error("useSimulationAuth must be used within a SimulationAuthProvider");return t},sC="15.1.22",_N=(t,e,s)=>({endTime:e,insertTime:s,type:"exponentialRampToValue",value:t}),wN=(t,e,s)=>({endTime:e,insertTime:s,type:"linearRampToValue",value:t}),Jx=(t,e)=>({startTime:e,type:"setValue",value:t}),nC=(t,e,s)=>({duration:s,startTime:e,type:"setValueCurve",values:t}),iC=(t,e,{startTime:s,target:n,timeConstant:i})=>n+(e-n)*Math.exp((s-t)/i),dl=t=>t.type==="exponentialRampToValue",vm=t=>t.type==="linearRampToValue",Tr=t=>dl(t)||vm(t),By=t=>t.type==="setValue",Ci=t=>t.type==="setValueCurve",ym=(t,e,s,n)=>{const i=t[e];return i===void 0?n:Tr(i)||By(i)?i.value:Ci(i)?i.values[i.values.length-1]:iC(s,ym(t,e-1,i.startTime,n),i)},kN=(t,e,s,n,i)=>s===void 0?[n.insertTime,i]:Tr(s)?[s.endTime,s.value]:By(s)?[s.startTime,s.value]:Ci(s)?[s.startTime+s.duration,s.values[s.values.length-1]]:[s.startTime,ym(t,e-1,s.startTime,i)],Zx=t=>t.type==="cancelAndHold",eb=t=>t.type==="cancelScheduledValues",_r=t=>Zx(t)||eb(t)?t.cancelTime:dl(t)||vm(t)?t.endTime:t.startTime,NN=(t,e,s,{endTime:n,value:i})=>s===i?i:0<s&&0<i||s<0&&i<0?s*(i/s)**((t-e)/(n-e)):0,SN=(t,e,s,{endTime:n,value:i})=>s+(t-e)/(n-e)*(i-s),i9=(t,e)=>{const s=Math.floor(e),n=Math.ceil(e);return s===n?t[s]:(1-(e-s))*t[s]+(1-(n-e))*t[n]},r9=(t,{duration:e,startTime:s,values:n})=>{const i=(t-s)/e*(n.length-1);return i9(n,i)},Oh=t=>t.type==="setTarget";class a9{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const s=_r(e);if(Zx(e)||eb(e)){const n=this._automationEvents.findIndex(r=>eb(e)&&Ci(r)?r.startTime+r.duration>=s:_r(r)>=s),i=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),Zx(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&Tr(i)){if(r!==void 0&&Oh(r))throw new Error("The internal list is malformed.");const a=r===void 0?i.insertTime:Ci(r)?r.startTime+r.duration:_r(r),l=r===void 0?this._defaultValue:Ci(r)?r.values[r.values.length-1]:r.value,c=dl(i)?NN(s,a,l,i):SN(s,a,l,i),u=dl(i)?_N(c,s,this._currenTime):wN(c,s,this._currenTime);this._automationEvents.push(u)}if(r!==void 0&&Oh(r)&&this._automationEvents.push(Jx(this.getValue(s),s)),r!==void 0&&Ci(r)&&r.startTime+r.duration>s){const a=s-r.startTime,l=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(a*l)),u=a/(c-1)*l,d=r.values.slice(0,c);if(u<1)for(let h=1;h<c;h+=1){const f=u*h%1;d[h]=r.values[h-1]*(1-f)+r.values[h]*f}this._automationEvents[this._automationEvents.length-1]=nC(d,r.startTime,a)}}}else{const n=this._automationEvents.findIndex(a=>_r(a)>s),i=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(i!==void 0&&Ci(i)&&_r(i)+i.duration>s)return!1;const r=dl(e)?_N(e.value,e.endTime,this._currenTime):vm(e)?wN(e.value,s,this._currenTime):e;if(n===-1)this._automationEvents.push(r);else{if(Ci(e)&&s+e.duration>_r(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,r)}}return!0}flush(e){const s=this._automationEvents.findIndex(n=>_r(n)>e);if(s>1){const n=this._automationEvents.slice(s-1),i=n[0];Oh(i)&&n.unshift(Jx(ym(this._automationEvents,s-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const s=this._automationEvents.findIndex(a=>_r(a)>e),n=this._automationEvents[s],i=(s===-1?this._automationEvents.length:s)-1,r=this._automationEvents[i];if(r!==void 0&&Oh(r)&&(n===void 0||!Tr(n)||n.insertTime>e))return iC(e,ym(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&By(r)&&(n===void 0||!Tr(n)))return r.value;if(r!==void 0&&Ci(r)&&(n===void 0||!Tr(n)||r.startTime+r.duration>e))return e<r.startTime+r.duration?r9(e,r):r.values[r.values.length-1];if(r!==void 0&&Tr(r)&&(n===void 0||!Tr(n)))return r.value;if(n!==void 0&&dl(n)){const[a,l]=kN(this._automationEvents,i,r,n,this._defaultValue);return NN(e,a,l,n)}if(n!==void 0&&vm(n)){const[a,l]=kN(this._automationEvents,i,r,n,this._defaultValue);return SN(e,a,l,n)}return this._defaultValue}}const o9=t=>({cancelTime:t,type:"cancelAndHold"}),l9=t=>({cancelTime:t,type:"cancelScheduledValues"}),c9=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),u9=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),d9=(t,e,s)=>({startTime:e,target:t,timeConstant:s,type:"setTarget"}),h9=()=>new DOMException("","AbortError"),f9=t=>(e,s,[n,i,r],a)=>{t(e[i],[s,n,r],l=>l[0]===s&&l[1]===n,a)},m9=t=>(e,s,n)=>{const i=[];for(let r=0;r<n.numberOfInputs;r+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:s})},p9=t=>(e,s)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:s})},ec=new WeakSet,rC=new WeakMap,Uy=new WeakMap,aC=new WeakMap,$y=new WeakMap,Op=new WeakMap,oC=new WeakMap,tb=new WeakMap,sb=new WeakMap,nb=new WeakMap,lC={construct(){return lC}},g9=t=>{try{const e=new Proxy(t,lC);new e}catch{return!1}return!0},TN=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,EN=(t,e)=>{const s=[];let n=t.replace(/^[\s]+/,""),i=n.match(TN);for(;i!==null;){const r=i[1].slice(1,-1),a=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());s.push(a),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(TN)}return[s.join(";"),n]},AN=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},jN=t=>{if(!g9(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},x9=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>{let m=0;return(b,p,v={credentials:"omit"})=>{const x=d.get(b);if(x!==void 0&&x.has(p))return Promise.resolve();const g=u.get(b);if(g!==void 0){const k=g.get(p);if(k!==void 0)return k}const y=r(b),w=y.audioWorklet===void 0?i(p).then(([k,N])=>{const[_,T]=EN(k,N),E=`${_};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${T}
})})(window,'_AWGS')`;return s(E)}).then(()=>{const k=f._AWGS.pop();if(k===void 0)throw new SyntaxError;n(y.currentTime,y.sampleRate,()=>k(class{},void 0,(N,_)=>{if(N.trim()==="")throw e();const T=sb.get(y);if(T!==void 0){if(T.has(N))throw e();jN(_),AN(_.parameterDescriptors),T.set(N,_)}else jN(_),AN(_.parameterDescriptors),sb.set(y,new Map([[N,_]]))},y.sampleRate,void 0,void 0))}):Promise.all([i(p),Promise.resolve(t(h,h))]).then(([[k,N],_])=>{const T=m+1;m=T;const[E,A]=EN(k,N),H=`${E};((AudioWorkletProcessor,registerProcessor)=>{${A}
})(${_?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${_?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${_?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${T}',class extends AudioWorkletProcessor{process(){return !1}})`,P=new Blob([H],{type:"application/javascript; charset=utf-8"}),O=URL.createObjectURL(P);return y.audioWorklet.addModule(O,v).then(()=>{if(l(y))return y;const L=a(y);return L.audioWorklet.addModule(O,v).then(()=>L)}).then(L=>{if(c===null)throw new SyntaxError;try{new c(L,`__sac${T}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(O))});return g===void 0?u.set(b,new Map([[p,w]])):g.set(p,w),w.then(()=>{const k=d.get(b);k===void 0?d.set(b,new Set([p])):k.add(p)}).finally(()=>{const k=u.get(b);k!==void 0&&k.delete(p)}),w}},Xn=(t,e)=>{const s=t.get(e);if(s===void 0)throw new Error("A value with the given key could not be found.");return s},Mp=(t,e)=>{const s=Array.from(t).filter(e);if(s.length>1)throw Error("More than one element was found.");if(s.length===0)throw Error("No element was found.");const[n]=s;return t.delete(n),n},cC=(t,e,s,n)=>{const i=Xn(t,e),r=Mp(i,a=>a[0]===s&&a[1]===n);return i.size===0&&t.delete(e),r},Wd=t=>Xn(oC,t),tc=t=>{if(ec.has(t))throw new Error("The AudioNode is already stored.");ec.add(t),Wd(t).forEach(e=>e(!0))},uC=t=>"port"in t,Yd=t=>{if(!ec.has(t))throw new Error("The AudioNode is not stored.");ec.delete(t),Wd(t).forEach(e=>e(!1))},ib=(t,e)=>{!uC(t)&&e.every(s=>s.size===0)&&Yd(t)},b9=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>{const m=new WeakMap;return(b,p,v,x,g)=>{const{activeInputs:y,passiveInputs:w}=r(p),{outputs:k}=r(b),N=l(b),_=T=>{const E=c(p),A=c(b);if(T){const R=cC(w,b,v,x);t(y,b,R,!1),!g&&!h(b)&&s(A,E,v,x),f(p)&&tc(p)}else{const R=n(y,b,v,x);e(w,x,R,!1),!g&&!h(b)&&i(A,E,v,x);const I=a(p);if(I===0)d(p)&&ib(p,y);else{const V=m.get(p);V!==void 0&&clearTimeout(V),m.set(p,setTimeout(()=>{d(p)&&ib(p,y)},I*1e3))}}};return u(k,[p,v,x],T=>T[0]===p&&T[1]===v&&T[2]===x,!0)?(N.add(_),d(b)?t(y,b,[v,x,_],!0):e(w,x,[b,v,_],!0),!0):!1}},v9=t=>(e,s,[n,i,r],a)=>{const l=e.get(n);l===void 0?e.set(n,new Set([[i,s,r]])):t(l,[i,s,r],c=>c[0]===i&&c[1]===s,a)},y9=t=>(e,s)=>{const n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.connect(n).connect(e.destination);const i=()=>{s.removeEventListener("ended",i),s.disconnect(n),n.disconnect()};s.addEventListener("ended",i)},_9=t=>(e,s)=>{t(e).add(s)},w9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},k9=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...w9,...c},h=n(u,d),f=r(u)?e():null;super(l,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(l){this._nativeAnalyserNode.fftSize=l}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(l){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=l,!(l>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,s()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(l){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=l,!(this._nativeAnalyserNode.maxDecibels>l))throw this._nativeAnalyserNode.minDecibels=c,s()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(l){this._nativeAnalyserNode.smoothingTimeConstant=l}getByteFrequencyData(l){this._nativeAnalyserNode.getByteFrequencyData(l)}getByteTimeDomainData(l){this._nativeAnalyserNode.getByteTimeDomainData(l)}getFloatFrequencyData(l){this._nativeAnalyserNode.getFloatFrequencyData(l)}getFloatTimeDomainData(l){this._nativeAnalyserNode.getFloatTimeDomainData(l)}},vs=(t,e)=>t.context===e,N9=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,fftSize:l.fftSize,maxDecibels:l.maxDecibels,minDecibels:l.minDecibels,smoothingTimeConstant:l.smoothingTimeConstant};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},_m=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},vi=()=>new DOMException("","IndexSizeError"),Gy=t=>{t.getChannelData=(e=>s=>{try{return e.call(t,s)}catch(n){throw n.code===12?vi():n}})(t.getChannelData)},S9={numberOfChannels:1},T9=(t,e,s,n,i,r,a,l)=>{let c=null;return class dC{constructor(d){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:m}={...S9,...d};c===null&&(c=new i(1,1,44100));const b=n!==null&&e(r,r)?new n({length:h,numberOfChannels:f,sampleRate:m}):c.createBuffer(f,h,m);if(b.numberOfChannels===0)throw s();return typeof b.copyFromChannel!="function"?(a(b),Gy(b)):e(_m,()=>_m(b))||l(b),t.add(b),b}static[Symbol.hasInstance](d){return d!==null&&typeof d=="object"&&Object.getPrototypeOf(d)===dC.prototype||t.has(d)}}},Ls=-34028234663852886e22,_s=-Ls,Hi=t=>ec.has(t),E9={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},A9=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={...E9,...d},m=i(h,f),b=a(h),p=b?e():null;super(u,!1,m,p),this._audioBufferSourceNodeRenderer=p,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=m,this._onended=null,this._playbackRate=s(this,b,m.playbackRate,_s,Ls)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(u){if(this._nativeAudioBufferSourceNode.buffer=u,u!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(u){this._nativeAudioBufferSourceNode.loop=u}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(u){this._nativeAudioBufferSourceNode.loopEnd=u}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(u){this._nativeAudioBufferSourceNode.loopStart=u}get onended(){return this._onended}set onended(u){const d=typeof u=="function"?l(this,u):null;this._nativeAudioBufferSourceNode.onended=d;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===d?u:h}get playbackRate(){return this._playbackRate}start(u=0,d=0,h){if(this._nativeAudioBufferSourceNode.start(u,d,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[u,d]:[u,d,h]),this.context.state!=="closed"){tc(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),Hi(this)&&Yd(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(u=0){this._nativeAudioBufferSourceNode.stop(u),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=u)}},j9=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null;const c=async(u,d)=>{let h=s(u);const f=vs(h,d);if(!f){const m={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(d,m),a!==null&&h.start(...a),l!==null&&h.stop(l)}return r.set(d,h),f?await t(d,u.playbackRate,h.playbackRate):await n(d,u.playbackRate,h.playbackRate),await i(u,d,h),h};return{set start(u){a=u},set stop(u){l=u},render(u,d){const h=r.get(d);return h!==void 0?Promise.resolve(h):c(u,d)}}},C9=t=>"playbackRate"in t,R9=t=>"frequency"in t&&"gain"in t,I9=t=>"offset"in t,O9=t=>!("frequency"in t)&&"gain"in t,M9=t=>"detune"in t&&"frequency"in t&&!("gain"in t),D9=t=>"pan"in t,Ns=t=>Xn(rC,t),Xd=t=>Xn(aC,t),rb=(t,e)=>{const{activeInputs:s}=Ns(t);s.forEach(i=>i.forEach(([r])=>{e.includes(t)||rb(r,[...e,t])}));const n=C9(t)?[t.playbackRate]:uC(t)?Array.from(t.parameters.values()):R9(t)?[t.Q,t.detune,t.frequency,t.gain]:I9(t)?[t.offset]:O9(t)?[t.gain]:M9(t)?[t.detune,t.frequency]:D9(t)?[t.pan]:[];for(const i of n){const r=Xd(i);r!==void 0&&r.activeInputs.forEach(([a])=>rb(a,e))}Hi(t)&&Yd(t)},hC=t=>{rb(t.destination,[])},L9=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),P9=(t,e,s,n,i,r,a,l,c)=>class extends t{constructor(d={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(d)}catch(b){throw b.code===12&&b.message==="sampleRate is not in range"?s():b}if(h===null)throw n();if(!L9(d.latencyHint))throw new TypeError(`The provided value '${d.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(d.sampleRate!==void 0&&h.sampleRate!==d.sampleRate)throw s();super(h,2);const{latencyHint:f}=d,{sampleRate:m}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/m:f==="interactive"||f===void 0?256/m:f==="playback"?1024/m:Math.max(2,Math.min(128,Math.round(f*m/128)))*128/m,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const b=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",b)};h.addEventListener("statechange",b)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),hC(this)}))}createMediaElementSource(d){return new i(this,{mediaElement:d})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(d){return new a(this,{mediaStream:d})}createMediaStreamTrackSource(d){return new l(this,{mediaStreamTrack:d})}resume(){return this._state==="suspended"?new Promise((d,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?d():this.resume().then(d,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(d=>{throw d===void 0||d.code===15?e():d})}suspend(){return this._nativeAudioContext.suspend().catch(d=>{throw d===void 0?e():d})}},V9=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f=a(h),m=i(h,d,f),b=f?e(l):null;super(u,!1,m,b),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=m}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(u){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(u>this._nativeAudioDestinationNode.maxChannelCount)throw s();this._nativeAudioDestinationNode.channelCount=u}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(u){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=u}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},F9=t=>{const e=new WeakMap,s=async(n,i)=>{const r=i.destination;return e.set(i,r),await t(n,i,r),r};return{render(n,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):s(n,i)}}},B9=(t,e,s,n,i,r,a,l)=>(c,u)=>{const d=u.listener,h=()=>{const k=new Float32Array(1),N=e(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),_=a(u);let T=!1,E=[0,0,-1,0,1,0],A=[0,0,0];const R=()=>{if(T)return;T=!0;const P=n(u,256,9,0);P.onaudioprocess=({inputBuffer:O})=>{const L=[r(O,k,0),r(O,k,1),r(O,k,2),r(O,k,3),r(O,k,4),r(O,k,5)];L.some((F,U)=>F!==E[U])&&(d.setOrientation(...L),E=L);const M=[r(O,k,6),r(O,k,7),r(O,k,8)];M.some((F,U)=>F!==A[U])&&(d.setPosition(...M),A=M)},N.connect(P)},I=P=>O=>{O!==E[P]&&(E[P]=O,d.setOrientation(...E))},V=P=>O=>{O!==A[P]&&(A[P]=O,d.setPosition(...A))},H=(P,O,L)=>{const M=s(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:O});M.connect(N,0,P),M.start(),Object.defineProperty(M.offset,"defaultValue",{get(){return O}});const F=t({context:c},_,M.offset,_s,Ls);return l(F,"value",U=>()=>U.call(F),U=>C=>{try{U.call(F,C)}catch(j){if(j.code!==9)throw j}R(),_&&L(C)}),F.cancelAndHoldAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.cancelAndHoldAtTime),F.cancelScheduledValues=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.cancelScheduledValues),F.exponentialRampToValueAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.exponentialRampToValueAtTime),F.linearRampToValueAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.linearRampToValueAtTime),F.setTargetAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.setTargetAtTime),F.setValueAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.setValueAtTime),F.setValueCurveAtTime=(U=>_?()=>{throw i()}:(...C)=>{const j=U.apply(F,C);return R(),j})(F.setValueCurveAtTime),F};return{forwardX:H(0,0,I(0)),forwardY:H(1,0,I(1)),forwardZ:H(2,-1,I(2)),positionX:H(6,0,V(0)),positionY:H(7,0,V(1)),positionZ:H(8,0,V(2)),upX:H(3,0,I(3)),upY:H(4,1,I(4)),upZ:H(5,0,I(5))}},{forwardX:f,forwardY:m,forwardZ:b,positionX:p,positionY:v,positionZ:x,upX:g,upY:y,upZ:w}=d.forwardX===void 0?h():d;return{get forwardX(){return f},get forwardY(){return m},get forwardZ(){return b},get positionX(){return p},get positionY(){return v},get positionZ(){return x},get upX(){return g},get upY(){return y},get upZ(){return w}}},wm=t=>"context"in t,Qd=t=>wm(t[0]),Po=(t,e,s,n)=>{for(const i of t)if(s(i)){if(n)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},CN=(t,e,[s,n],i)=>{Po(t,[e,s,n],r=>r[0]===e&&r[1]===s,i)},RN=(t,[e,s,n],i)=>{const r=t.get(e);r===void 0?t.set(e,new Set([[s,n]])):Po(r,[s,n],a=>a[0]===s,i)},Ac=t=>"inputs"in t,km=(t,e,s,n)=>{if(Ac(e)){const i=e.inputs[n];return t.connect(i,s,0),[i,s,0]}return t.connect(e,s,n),[e,s,n]},fC=(t,e,s)=>{for(const n of t)if(n[0]===e&&n[1]===s)return t.delete(n),n;return null},U9=(t,e,s)=>Mp(t,n=>n[0]===e&&n[1]===s),mC=(t,e)=>{if(!Wd(t).delete(e))throw new Error("Missing the expected event listener.")},pC=(t,e,s)=>{const n=Xn(t,e),i=Mp(n,r=>r[0]===s);return n.size===0&&t.delete(e),i},Nm=(t,e,s,n)=>{Ac(e)?t.disconnect(e.inputs[n],s,0):t.disconnect(e,s,n)},bt=t=>Xn(Uy,t),cd=t=>Xn($y,t),ko=t=>tb.has(t),hf=t=>!ec.has(t),IN=(t,e)=>new Promise(s=>{if(e!==null)s(!0);else{const n=t.createScriptProcessor(256,1,1),i=t.createGain(),r=t.createBuffer(1,2,44100),a=r.getChannelData(0);a[0]=1,a[1]=1;const l=t.createBufferSource();l.buffer=r,l.loop=!0,l.connect(n).connect(t.destination),l.connect(i),l.disconnect(i),n.onaudioprocess=c=>{const u=c.inputBuffer.getChannelData(0);Array.prototype.some.call(u,d=>d===1)?s(!0):s(!1),l.stop(),n.onaudioprocess=null,l.disconnect(n),n.disconnect(t.destination)},l.start()}}),lg=(t,e)=>{const s=new Map;for(const n of t)for(const i of n){const r=s.get(i);s.set(i,r===void 0?1:r+1)}s.forEach((n,i)=>e(i,n))},Sm=t=>"context"in t,$9=t=>{const e=new Map;t.connect=(s=>(n,i=0,r=0)=>{const a=Sm(n)?s(n,i,r):s(n,i),l=e.get(n);return l===void 0?e.set(n,[{input:r,output:i}]):l.every(c=>c.input!==r||c.output!==i)&&l.push({input:r,output:i}),a})(t.connect.bind(t)),t.disconnect=(s=>(n,i,r)=>{if(s.apply(t),n===void 0)e.clear();else if(typeof n=="number")for(const[a,l]of e){const c=l.filter(u=>u.output!==n);c.length===0?e.delete(a):e.set(a,c)}else if(e.has(n))if(i===void 0)e.delete(n);else{const a=e.get(n);if(a!==void 0){const l=a.filter(c=>c.output!==i&&(c.input!==r||r===void 0));l.length===0?e.delete(n):e.set(n,l)}}for(const[a,l]of e)l.forEach(c=>{Sm(a)?t.connect(a,c.output,c.input):t.connect(a,c.output)})})(t.disconnect)},G9=(t,e,s,n)=>{const{activeInputs:i,passiveInputs:r}=Xd(e),{outputs:a}=Ns(t),l=Wd(t),c=u=>{const d=bt(t),h=cd(e);if(u){const f=pC(r,t,s);CN(i,t,f,!1),!n&&!ko(t)&&d.connect(h,s)}else{const f=U9(i,t,s);RN(r,f,!1),!n&&!ko(t)&&d.disconnect(h,s)}};return Po(a,[e,s],u=>u[0]===e&&u[1]===s,!0)?(l.add(c),Hi(t)?CN(i,t,[s,c],!0):RN(r,[t,s,c],!0),!0):!1},H9=(t,e,s,n)=>{const{activeInputs:i,passiveInputs:r}=Ns(e),a=fC(i[n],t,s);return a===null?[cC(r,t,s,n)[2],!1]:[a[2],!0]},z9=(t,e,s)=>{const{activeInputs:n,passiveInputs:i}=Xd(e),r=fC(n,t,s);return r===null?[pC(i,t,s)[1],!1]:[r[2],!0]},Hy=(t,e,s,n,i)=>{const[r,a]=H9(t,s,n,i);if(r!==null&&(mC(t,r),a&&!e&&!ko(t)&&Nm(bt(t),bt(s),n,i)),Hi(s)){const{activeInputs:l}=Ns(s);ib(s,l)}},zy=(t,e,s,n)=>{const[i,r]=z9(t,s,n);i!==null&&(mC(t,i),r&&!e&&!ko(t)&&bt(t).disconnect(cd(s),n))},q9=(t,e)=>{const s=Ns(t),n=[];for(const i of s.outputs)Qd(i)?Hy(t,e,...i):zy(t,e,...i),n.push(i[0]);return s.outputs.clear(),n},K9=(t,e,s)=>{const n=Ns(t),i=[];for(const r of n.outputs)r[1]===s&&(Qd(r)?Hy(t,e,...r):zy(t,e,...r),i.push(r[0]),n.outputs.delete(r));return i},W9=(t,e,s,n,i)=>{const r=Ns(t);return Array.from(r.outputs).filter(a=>a[0]===s&&(n===void 0||a[1]===n)&&(i===void 0||a[2]===i)).map(a=>(Qd(a)?Hy(t,e,...a):zy(t,e,...a),r.outputs.delete(a),a[0]))},Y9=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,p)=>class extends u{constructor(x,g,y,w){super(y),this._context=x,this._nativeAudioNode=y;const k=d(x);h(k)&&s(IN,()=>IN(k,p))!==!0&&$9(y),Uy.set(this,y),oC.set(this,new Set),x.state!=="closed"&&g&&tc(this),t(this,w,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(x){this._nativeAudioNode.channelCount=x}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(x){this._nativeAudioNode.channelCountMode=x}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(x){this._nativeAudioNode.channelInterpretation=x}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(x,g=0,y=0){if(g<0||g>=this._nativeAudioNode.numberOfOutputs)throw i();const w=d(this._context),k=b(w);if(f(x)||m(x))throw r();if(wm(x)){const T=bt(x);try{const A=km(this._nativeAudioNode,T,g,y),R=hf(this);(k||R)&&this._nativeAudioNode.disconnect(...A),this.context.state!=="closed"&&!R&&hf(x)&&tc(x)}catch(A){throw A.code===12?r():A}if(e(this,x,g,y,k)){const A=c([this],x);lg(A,n(k))}return x}const N=cd(x);if(N.name==="playbackRate"&&N.maxValue===1024)throw a();try{this._nativeAudioNode.connect(N,g),(k||hf(this))&&this._nativeAudioNode.disconnect(N,g)}catch(T){throw T.code===12?r():T}if(G9(this,x,g,k)){const T=c([this],x);lg(T,n(k))}}disconnect(x,g,y){let w;const k=d(this._context),N=b(k);if(x===void 0)w=q9(this,N);else if(typeof x=="number"){if(x<0||x>=this.numberOfOutputs)throw i();w=K9(this,N,x)}else{if(g!==void 0&&(g<0||g>=this.numberOfOutputs)||wm(x)&&y!==void 0&&(y<0||y>=x.numberOfInputs))throw i();if(w=W9(this,N,x,g,y),w.length===0)throw r()}for(const _ of w){const T=c([this],_);lg(T,l)}}},X9=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>(m,b,p,v=null,x=null)=>{const g=p.value,y=new a9(g),w=b?n(y):null,k={get defaultValue(){return g},get maxValue(){return v===null?p.maxValue:v},get minValue(){return x===null?p.minValue:x},get value(){return p.value},set value(N){p.value=N,k.setValueAtTime(N,m.context.currentTime)},cancelAndHoldAtTime(N){if(typeof p.cancelAndHoldAtTime=="function")w===null&&y.flush(m.context.currentTime),y.add(i(N)),p.cancelAndHoldAtTime(N);else{const _=Array.from(y).pop();w===null&&y.flush(m.context.currentTime),y.add(i(N));const T=Array.from(y).pop();p.cancelScheduledValues(N),_!==T&&T!==void 0&&(T.type==="exponentialRampToValue"?p.exponentialRampToValueAtTime(T.value,T.endTime):T.type==="linearRampToValue"?p.linearRampToValueAtTime(T.value,T.endTime):T.type==="setValue"?p.setValueAtTime(T.value,T.startTime):T.type==="setValueCurve"&&p.setValueCurveAtTime(T.values,T.startTime,T.duration))}return k},cancelScheduledValues(N){return w===null&&y.flush(m.context.currentTime),y.add(r(N)),p.cancelScheduledValues(N),k},exponentialRampToValueAtTime(N,_){if(N===0)throw new RangeError;if(!Number.isFinite(_)||_<0)throw new RangeError;const T=m.context.currentTime;return w===null&&y.flush(T),Array.from(y).length===0&&(y.add(u(g,T)),p.setValueAtTime(g,T)),y.add(a(N,_)),p.exponentialRampToValueAtTime(N,_),k},linearRampToValueAtTime(N,_){const T=m.context.currentTime;return w===null&&y.flush(T),Array.from(y).length===0&&(y.add(u(g,T)),p.setValueAtTime(g,T)),y.add(l(N,_)),p.linearRampToValueAtTime(N,_),k},setTargetAtTime(N,_,T){return w===null&&y.flush(m.context.currentTime),y.add(c(N,_,T)),p.setTargetAtTime(N,_,T),k},setValueAtTime(N,_){return w===null&&y.flush(m.context.currentTime),y.add(u(N,_)),p.setValueAtTime(N,_),k},setValueCurveAtTime(N,_,T){const E=N instanceof Float32Array?N:new Float32Array(N);if(h!==null&&h.name==="webkitAudioContext"){const A=_+T,R=m.context.sampleRate,I=Math.ceil(_*R),V=Math.floor(A*R),H=V-I,P=new Float32Array(H);for(let L=0;L<H;L+=1){const M=(E.length-1)/T*((I+L)/R-_),F=Math.floor(M),U=Math.ceil(M);P[L]=F===U?E[F]:(1-(M-F))*E[F]+(1-(U-M))*E[U]}w===null&&y.flush(m.context.currentTime),y.add(d(P,_,T)),p.setValueCurveAtTime(P,_,T);const O=V/R;O<A&&f(k,P[P.length-1],O),f(k,E[E.length-1],A)}else w===null&&y.flush(m.context.currentTime),y.add(d(E,_,T)),p.setValueCurveAtTime(E,_,T);return k}};return s.set(k,p),e.set(k,m),t(k,w),k},Q9=t=>({replay(e){for(const s of t)if(s.type==="exponentialRampToValue"){const{endTime:n,value:i}=s;e.exponentialRampToValueAtTime(i,n)}else if(s.type==="linearRampToValue"){const{endTime:n,value:i}=s;e.linearRampToValueAtTime(i,n)}else if(s.type==="setTarget"){const{startTime:n,target:i,timeConstant:r}=s;e.setTargetAtTime(i,n,r)}else if(s.type==="setValue"){const{startTime:n,value:i}=s;e.setValueAtTime(i,n)}else if(s.type==="setValueCurve"){const{duration:n,startTime:i,values:r}=s;e.setValueCurveAtTime(r,i,n)}else throw new Error("Can't apply an unknown automation.")}});class gC{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,s=null){return this._map.forEach((n,i)=>e.call(s,n,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const J9={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},Z9=(t,e,s,n,i,r,a,l,c,u,d,h,f,m)=>class extends e{constructor(p,v,x){var g;const y=l(p),w=c(y),k=d({...J9,...x});f(k);const N=sb.get(y),_=N==null?void 0:N.get(v),T=w||y.state!=="closed"?y:(g=a(y))!==null&&g!==void 0?g:y,E=i(T,w?null:p.baseLatency,u,v,_,k),A=w?n(v,k,_):null;super(p,!0,E,A);const R=[];E.parameters.forEach((V,H)=>{const P=s(this,w,V);R.push([H,P])}),this._nativeAudioWorkletNode=E,this._onprocessorerror=null,this._parameters=new gC(R),w&&t(y,this);const{activeInputs:I}=r(this);h(E,I)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(p){const v=typeof p=="function"?m(this,p):null;this._nativeAudioWorkletNode.onprocessorerror=v;const x=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=x!==null&&x===v?p:x}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Tm(t,e,s,n,i){if(typeof t.copyFromChannel=="function")e[s].byteLength===0&&(e[s]=new Float32Array(128)),t.copyFromChannel(e[s],n,i);else{const r=t.getChannelData(n);if(e[s].byteLength===0)e[s]=r.slice(i,i+128);else{const a=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[s].set(a)}}}const xC=(t,e,s,n,i)=>{typeof t.copyToChannel=="function"?e[s].byteLength!==0&&t.copyToChannel(e[s],n,i):e[s].byteLength!==0&&t.getChannelData(n).set(e[s],i)},Em=(t,e)=>{const s=[];for(let n=0;n<t;n+=1){const i=[],r=typeof e=="number"?e:e[n];for(let a=0;a<r;a+=1)i.push(new Float32Array(128));s.push(i)}return s},eU=(t,e)=>{const s=Xn(nb,t),n=bt(e);return Xn(s,n)},tU=async(t,e,s,n,i,r,a)=>{const l=e===null?Math.ceil(t.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,u=i.reduce((v,x)=>v+x,0),d=u===0?null:s.createBuffer(u,l,s.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=Ns(t),f=await eU(s,t),m=Em(n.numberOfInputs,n.channelCount),b=Em(n.numberOfOutputs,i),p=Array.from(t.parameters.keys()).reduce((v,x)=>({...v,[x]:new Float32Array(128)}),{});for(let v=0;v<l;v+=128){if(n.numberOfInputs>0&&e!==null)for(let x=0;x<n.numberOfInputs;x+=1)for(let g=0;g<n.channelCount;g+=1)Tm(e,m[x],g,g,v);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:x},g)=>{Tm(e,p,x,c+g,v)});for(let x=0;x<n.numberOfInputs;x+=1)for(let g=0;g<i[x];g+=1)b[x][g].byteLength===0&&(b[x][g]=new Float32Array(128));try{const x=m.map((y,w)=>h.activeInputs[w].size===0?[]:y),g=a(v/s.sampleRate,s.sampleRate,()=>f.process(x,b,p));if(d!==null)for(let y=0,w=0;y<n.numberOfOutputs;y+=1){for(let k=0;k<i[y];k+=1)xC(d,b[y],k,w+k,v);w+=i[y]}if(!g)break}catch(x){t.dispatchEvent(new ErrorEvent("processorerror",{colno:x.colno,filename:x.filename,lineno:x.lineno,message:x.message}));break}}return d},sU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,p)=>(v,x,g)=>{const y=new WeakMap;let w=null;const k=async(N,_)=>{let T=d(N),E=null;const A=vs(T,_),R=Array.isArray(x.outputChannelCount)?x.outputChannelCount:Array.from(x.outputChannelCount);if(h===null){const I=R.reduce((O,L)=>O+L,0),V=i(_,{channelCount:Math.max(1,I),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,I)}),H=[];for(let O=0;O<N.numberOfOutputs;O+=1)H.push(n(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:R[O]}));const P=a(_,{channelCount:x.channelCount,channelCountMode:x.channelCountMode,channelInterpretation:x.channelInterpretation,gain:1});P.connect=e.bind(null,H),P.disconnect=c.bind(null,H),E=[V,H,P]}else A||(T=new h(_,v));if(y.set(_,E===null?T:E[2]),E!==null){if(w===null){if(g===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const L=N.channelCount*N.numberOfInputs,M=g.parameterDescriptors===void 0?0:g.parameterDescriptors.length,F=L+M;w=tU(N,F===0?null:await(async()=>{const C=new f(F,Math.ceil(N.context.length/128)*128,_.sampleRate),j=[],$=[];for(let z=0;z<x.numberOfInputs;z+=1)j.push(a(C,{channelCount:x.channelCount,channelCountMode:x.channelCountMode,channelInterpretation:x.channelInterpretation,gain:1})),$.push(i(C,{channelCount:x.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:x.channelCount}));const B=await Promise.all(Array.from(N.parameters.values()).map(async z=>{const J=r(C,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:z.value});return await m(C,z,J.offset),J})),D=n(C,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,L+M)});for(let z=0;z<x.numberOfInputs;z+=1){j[z].connect($[z]);for(let J=0;J<x.channelCount;J+=1)$[z].connect(D,J,z*x.channelCount+J)}for(const[z,J]of B.entries())J.connect(D,0,L+z),J.start(0);return D.connect(C.destination),await Promise.all(j.map(z=>b(N,C,z))),p(C)})(),_,x,R,g,u)}const I=await w,V=s(_,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[H,P,O]=E;I!==null&&(V.buffer=I,V.start(0)),V.connect(H);for(let L=0,M=0;L<N.numberOfOutputs;L+=1){const F=P[L];for(let U=0;U<R[L];U+=1)H.connect(F,M+U,U);M+=R[L]}return O}if(A)for(const[I,V]of N.parameters.entries())await t(_,V,T.parameters.get(I));else for(const[I,V]of N.parameters.entries())await m(_,V,T.parameters.get(I));return await b(N,_,T),T};return{render(N,_){l(_,N);const T=y.get(_);return T!==void 0?Promise.resolve(T):k(N,_)}}},nU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,p,v,x,g,y)=>class extends b{constructor(k,N){super(k,N),this._nativeContext=k,this._audioWorklet=t===void 0?void 0:{addModule:(_,T)=>t(this,_,T)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(k,N,_){return new s({length:N,numberOfChannels:k,sampleRate:_})}createBufferSource(){return new n(this)}createChannelMerger(k=6){return new r(this,{numberOfInputs:k})}createChannelSplitter(k=6){return new a(this,{numberOfOutputs:k})}createConstantSource(){return new l(this)}createConvolver(){return new c(this)}createDelay(k=1){return new d(this,{maxDelayTime:k})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(k,N){return new m(this,{feedback:N,feedforward:k})}createOscillator(){return new p(this)}createPanner(){return new v(this)}createPeriodicWave(k,N,_={disableNormalization:!1}){return new x(this,{..._,imag:N,real:k})}createStereoPanner(){return new g(this)}createWaveShaper(){return new y(this)}decodeAudioData(k,N,_){return u(this._nativeContext,k).then(T=>(typeof N=="function"&&N(T),T),T=>{throw typeof _=="function"&&_(T),T})}},iU={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},rU=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={...iU,...d},m=i(h,f),b=a(h),p=b?s():null;super(u,!1,m,p),this._Q=e(this,b,m.Q,_s,Ls),this._detune=e(this,b,m.detune,1200*Math.log2(_s),-1200*Math.log2(_s)),this._frequency=e(this,b,m.frequency,u.sampleRate/2,0),this._gain=e(this,b,m.gain,40*Math.log10(_s),Ls),this._nativeBiquadFilterNode=m,l(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(u){this._nativeBiquadFilterNode.type=u}getFrequencyResponse(u,d,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(u,d,h)}catch(f){throw f.code===11?n():f}if(u.length!==d.length||d.length!==h.length)throw n()}},aU=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(c,h)}return r.set(c,u),d?(await t(c,l.Q,u.Q),await t(c,l.detune,u.detune),await t(c,l.frequency,u.frequency),await t(c,l.gain,u.gain)):(await n(c,l.Q,u.Q),await n(c,l.detune,u.detune),await n(c,l.frequency,u.frequency),await n(c,l.gain,u.gain)),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},oU=(t,e)=>(s,n)=>{const i=e.get(s);if(i!==void 0)return i;const r=t.get(s);if(r!==void 0)return r;try{const a=n();return a instanceof Promise?(t.set(s,a),a.catch(()=>!1).then(l=>(t.delete(s),e.set(s,l),l))):(e.set(s,a),a)}catch{return e.set(s,!1),!1}},lU={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},cU=(t,e,s,n,i)=>class extends t{constructor(a,l){const c=n(a),u={...lU,...l},d=s(c,u),h=i(c)?e():null;super(a,!1,d,h)}},uU=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfInputs:l.numberOfInputs};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},dU={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},hU=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d=r({...dU,...c}),h=s(u,d),f=i(u)?e():null;super(l,!1,h,f)}},fU=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfOutputs:l.numberOfOutputs};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},mU=t=>(e,s,n)=>t(s,e,n),pU=t=>(e,s,n=0,i=0)=>{const r=e[n];if(r===void 0)throw t();return Sm(s)?r.connect(s,0,i):r.connect(s,0)},gU=t=>(e,s)=>{const n=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(s),n.start(),()=>{n.stop(),n.disconnect(s)}},xU={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},bU=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...xU,...u},f=n(d,h),m=r(d),b=m?s():null;super(c,!1,f,b),this._constantSourceNodeRenderer=b,this._nativeConstantSourceNode=f,this._offset=e(this,m,f.offset,_s,Ls),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeConstantSourceNode.onended=u;const d=this._nativeConstantSourceNode.onended;this._onended=d!==null&&d===u?c:d}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){tc(this);const u=()=>{this._nativeConstantSourceNode.removeEventListener("ended",u),Hi(this)&&Yd(this)};this._nativeConstantSourceNode.addEventListener("ended",u)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},vU=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null;const c=async(u,d)=>{let h=s(u);const f=vs(h,d);if(!f){const m={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(d,m),a!==null&&h.start(a),l!==null&&h.stop(l)}return r.set(d,h),f?await t(d,u.offset,h.offset):await n(d,u.offset,h.offset),await i(u,d,h),h};return{set start(u){a=u},set stop(u){l=u},render(u,d){const h=r.get(d);return h!==void 0?Promise.resolve(h):c(u,d)}}},yU=t=>e=>(t[0]=e,t[0]),_U={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},wU=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d={..._U,...c},h=s(u,d),m=i(u)?e():null;super(l,!1,h,m),this._isBufferNullified=!1,this._nativeConvolverNode=h,d.buffer!==null&&r(this,d.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(l){if(this._nativeConvolverNode.buffer=l,l===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(l){this._nativeConvolverNode.normalize=l}},kU=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,disableNormalization:!l.normalize};l=t(a,u)}return n.set(a,l),Ac(l)?await s(r,a,l.inputs[0]):await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},NU=(t,e)=>(s,n,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(s,n,i)}catch(r){throw r.name==="SyntaxError"?t():r}},SU=()=>new DOMException("","DataCloneError"),ON=t=>{const{port1:e,port2:s}=new MessageChannel;return new Promise(n=>{const i=()=>{s.onmessage=null,e.close(),s.close(),n()};s.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},TU=(t,e,s,n,i,r,a,l,c,u,d)=>(h,f)=>{const m=a(h)?h:r(h);if(i.has(f)){const b=s();return Promise.reject(b)}try{i.add(f)}catch{}return e(c,()=>c(m))?m.decodeAudioData(f).then(b=>(ON(f).catch(()=>{}),e(l,()=>l(b))||d(b),t.add(b),b)):new Promise((b,p)=>{const v=async()=>{try{await ON(f)}catch{}},x=g=>{p(g),v()};try{m.decodeAudioData(f,g=>{typeof g.copyFromChannel!="function"&&(u(g),Gy(g)),t.add(g),v().then(()=>b(g))},g=>{x(g===null?n():g)})}catch(g){x(g)}})},EU=(t,e,s,n,i,r,a,l)=>(c,u)=>{const d=e.get(c);if(d===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),f=l(h);if(d===u){if(e.delete(c),!f&&a(c)){const m=n(c),{outputs:b}=s(c);for(const p of b)if(Qd(p)){const v=n(p[0]);t(m,v,p[1],p[2])}else{const v=i(p[0]);m.connect(v,p[1])}}}else e.set(c,d-u)},AU={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},jU=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...AU,...u},f=n(d,h),m=r(d),b=m?s(h.maxDelayTime):null;super(c,!1,f,b),this._delayTime=e(this,m,f.delayTime),a(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},CU=(t,e,s,n,i)=>r=>{const a=new WeakMap,l=async(c,u)=>{let d=s(c);const h=vs(d,u);if(!h){const f={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,delayTime:d.delayTime.value,maxDelayTime:r};d=e(u,f)}return a.set(u,d),h?await t(u,c.delayTime,d.delayTime):await n(u,c.delayTime,d.delayTime),await i(c,u,d),d};return{render(c,u){const d=a.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},RU=t=>(e,s,n,i)=>t(e[i],r=>r[0]===s&&r[1]===n),IU=t=>(e,s)=>{t(e).delete(s)},OU=t=>"delayTime"in t,MU=(t,e,s)=>function n(i,r){const a=wm(r)?r:s(t,r);if(OU(a))return[];if(i[0]===a)return[i];if(i.includes(a))return[];const{outputs:l}=e(a);return Array.from(l).map(c=>n([...i,a],c[0])).reduce((c,u)=>c.concat(u),[])},Mh=(t,e,s)=>{const n=e[s];if(n===void 0)throw t();return n},DU=t=>(e,s=void 0,n=void 0,i=0)=>s===void 0?e.forEach(r=>r.disconnect()):typeof s=="number"?Mh(t,e,s).disconnect():Sm(s)?n===void 0?e.forEach(r=>r.disconnect(s)):i===void 0?Mh(t,e,n).disconnect(s,0):Mh(t,e,n).disconnect(s,0,i):n===void 0?e.forEach(r=>r.disconnect(s)):Mh(t,e,n).disconnect(s,0),LU={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},PU=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={...LU,...d},m=n(h,f),b=a(h),p=b?s():null;super(u,!1,m,p),this._attack=e(this,b,m.attack),this._knee=e(this,b,m.knee),this._nativeDynamicsCompressorNode=m,this._ratio=e(this,b,m.ratio),this._release=e(this,b,m.release),this._threshold=e(this,b,m.threshold),l(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(u){const d=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=u,u>2)throw this._nativeDynamicsCompressorNode.channelCount=d,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(u){const d=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=u,u==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=d,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},VU=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(c,h)}return r.set(c,u),d?(await t(c,l.attack,u.attack),await t(c,l.knee,u.knee),await t(c,l.ratio,u.ratio),await t(c,l.release,u.release),await t(c,l.threshold,u.threshold)):(await n(c,l.attack,u.attack),await n(c,l.knee,u.knee),await n(c,l.ratio,u.ratio),await n(c,l.release,u.release),await n(c,l.threshold,u.threshold)),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},FU=()=>new DOMException("","EncodingError"),BU=t=>e=>new Promise((s,n)=>{if(t===null){n(new SyntaxError);return}const i=t.document.head;if(i===null)n(new SyntaxError);else{const r=t.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),l=URL.createObjectURL(a),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(l)};t.onerror=(d,h,f,m,b)=>{if(h===l||h===t.location.href&&f===1&&m===1)return u(),n(b),!1;if(c!==null)return c(d,h,f,m,b)},r.onerror=()=>{u(),n(new SyntaxError)},r.onload=()=>{u(),s()},r.src=l,r.type="module",i.appendChild(r)}}),UU=t=>class{constructor(s){this._nativeEventTarget=s,this._listeners=new WeakMap}addEventListener(s,n,i){if(n!==null){let r=this._listeners.get(n);r===void 0&&(r=t(this,n),typeof n=="function"&&this._listeners.set(n,r)),this._nativeEventTarget.addEventListener(s,r,i)}}dispatchEvent(s){return this._nativeEventTarget.dispatchEvent(s)}removeEventListener(s,n,i){const r=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(s,r===void 0?null:r,i)}},$U=t=>(e,s,n)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*s)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},GU=t=>async e=>{try{const s=await fetch(e);if(s.ok)return[await s.text(),s.url]}catch{}throw t()},HU={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},zU=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...HU,...c},h=n(u,d),f=r(u),m=f?s():null;super(l,!1,h,m),this._gain=e(this,f,h.gain,_s,Ls)}get gain(){return this._gain}},qU=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(c,h)}return r.set(c,u),d?await t(c,l.gain,u.gain):await n(c,l.gain,u.gain),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},KU=(t,e)=>s=>e(t,s),WU=t=>e=>{const s=t(e);if(s.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return s.renderer},YU=t=>e=>{var s;return(s=t.get(e))!==null&&s!==void 0?s:0},XU=t=>e=>{const s=t(e);if(s.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer},QU=t=>e=>t.get(e),os=()=>new DOMException("","InvalidStateError"),JU=t=>e=>{const s=t.get(e);if(s===void 0)throw os();return s},ZU=(t,e)=>s=>{let n=t.get(s);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),t.set(s,n),n},e$=t=>e=>{const s=t.get(e);if(s===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return s},Dp=()=>new DOMException("","InvalidAccessError"),t$=t=>{t.getFrequencyResponse=(e=>(s,n,i)=>{if(s.length!==n.length||n.length!==i.length)throw Dp();return e.call(t,s,n,i)})(t.getFrequencyResponse)},s$={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},n$=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d=i(u),h={...s$,...c},f=e(u,d?null:l.baseLatency,h),m=d?s(h.feedback,h.feedforward):null;super(l,!1,f,m),t$(f),this._nativeIIRFilterNode=f,r(this,1)}getFrequencyResponse(l,c,u){return this._nativeIIRFilterNode.getFrequencyResponse(l,c,u)}},bC=(t,e,s,n,i,r,a,l,c,u,d)=>{const h=u.length;let f=l;for(let m=0;m<h;m+=1){let b=s[0]*u[m];for(let p=1;p<i;p+=1){const v=f-p&c-1;b+=s[p]*r[v],b-=t[p]*a[v]}for(let p=i;p<n;p+=1)b+=s[p]*r[f-p&c-1];for(let p=i;p<e;p+=1)b-=t[p]*a[f-p&c-1];r[f]=u[m],a[f]=b,f=f+1&c-1,d[m]=b}return f},i$=(t,e,s,n)=>{const i=s instanceof Float64Array?s:new Float64Array(s),r=n instanceof Float64Array?n:new Float64Array(n),a=i.length,l=r.length,c=Math.min(a,l);if(i[0]!==1){for(let b=0;b<a;b+=1)r[b]/=i[0];for(let b=1;b<l;b+=1)i[b]/=i[0]}const u=32,d=new Float32Array(u),h=new Float32Array(u),f=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),m=t.numberOfChannels;for(let b=0;b<m;b+=1){const p=t.getChannelData(b),v=f.getChannelData(b);d.fill(0),h.fill(0),bC(i,a,r,l,c,d,h,0,u,p,v)}return f},r$=(t,e,s,n,i)=>(r,a)=>{const l=new WeakMap;let c=null;const u=async(d,h)=>{let f=null,m=e(d);const b=vs(m,h);if(h.createIIRFilter===void 0?f=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):b||(m=h.createIIRFilter(a,r)),l.set(h,f===null?m:f),f!==null){if(c===null){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new s(d.context.destination.channelCount,d.context.length,h.sampleRate);c=(async()=>{await n(d,v,v.destination);const x=await i(v);return i$(x,h,r,a)})()}const p=await c;return f.buffer=p,f.start(0),f}return await n(d,h,m),m};return{render(d,h){const f=l.get(h);return f!==void 0?Promise.resolve(f):u(d,h)}}},a$=(t,e,s,n,i,r)=>a=>(l,c)=>{const u=t.get(l);if(u===void 0){if(!a&&r(l)){const d=n(l),{outputs:h}=s(l);for(const f of h)if(Qd(f)){const m=n(f[0]);e(d,m,f[1],f[2])}else{const m=i(f[0]);d.disconnect(m,f[1])}}t.set(l,c)}else t.set(l,u+c)},o$=(t,e)=>s=>{const n=t.get(s);return e(n)||e(s)},l$=(t,e)=>s=>t.has(s)||e(s),c$=(t,e)=>s=>t.has(s)||e(s),u$=(t,e)=>s=>{const n=t.get(s);return e(n)||e(s)},d$=t=>e=>t!==null&&e instanceof t,h$=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,f$=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,m$=(t,e)=>s=>t(s)||e(s),p$=t=>e=>t!==null&&e instanceof t,g$=t=>t!==null&&t.isSecureContext,x$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r),c=e(l,a);if(n(l))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},b$={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},v$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r);if(n(l))throw new TypeError;const c={...b$,...a},u=e(l,c);super(r,!1,u,null),this._nativeMediaStreamAudioDestinationNode=u}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},y$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r),c=e(l,a);if(n(l))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},_$=(t,e,s)=>class extends t{constructor(i,r){const a=s(i),l=e(a,r);super(i,!0,l,null)}},w$=(t,e,s,n,i,r)=>class extends s{constructor(l,c){super(l),this._nativeContext=l,Op.set(this,l),n(l)&&i.set(l,new Set),this._destination=new t(this,c),this._listener=e(this,l),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(l){const c=typeof l=="function"?r(this,l):null;this._nativeContext.onstatechange=c;const u=this._nativeContext.onstatechange;this._onstatechange=u!==null&&u===c?l:u}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},ud=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const s=t.decodeAudioData(e.buffer,()=>{});return s===void 0?!1:(s.catch(()=>{}),!0)}catch{}return!1},k$=(t,e)=>(s,n,i)=>{const r=new Set;return s.connect=(a=>(l,c=0,u=0)=>{const d=r.size===0;if(e(l))return a.call(s,l,c,u),t(r,[l,c,u],h=>h[0]===l&&h[1]===c&&h[2]===u,!0),d&&n(),l;a.call(s,l,c),t(r,[l,c],h=>h[0]===l&&h[1]===c,!0),d&&n()})(s.connect),s.disconnect=(a=>(l,c,u)=>{const d=r.size>0;if(l===void 0)a.apply(s),r.clear();else if(typeof l=="number"){a.call(s,l);for(const f of r)f[1]===l&&r.delete(f)}else{e(l)?a.call(s,l,c,u):a.call(s,l,c);for(const f of r)f[0]===l&&(c===void 0||f[1]===c)&&(u===void 0||f[2]===u)&&r.delete(f)}const h=r.size===0;d&&h&&i()})(s.disconnect),s},wt=(t,e,s)=>{const n=e[s];n!==void 0&&n!==t[s]&&(t[s]=n)},Zt=(t,e)=>{wt(t,e,"channelCount"),wt(t,e,"channelCountMode"),wt(t,e,"channelInterpretation")},MN=t=>typeof t.getFloatTimeDomainData=="function",N$=t=>{t.getFloatTimeDomainData=e=>{const s=new Uint8Array(e.length);t.getByteTimeDomainData(s);const n=Math.max(s.length,t.fftSize);for(let i=0;i<n;i+=1)e[i]=(s[i]-128)*.0078125;return e}},S$=(t,e)=>(s,n)=>{const i=s.createAnalyser();if(Zt(i,n),!(n.maxDecibels>n.minDecibels))throw e();return wt(i,n,"fftSize"),wt(i,n,"maxDecibels"),wt(i,n,"minDecibels"),wt(i,n,"smoothingTimeConstant"),t(MN,()=>MN(i))||N$(i),i},T$=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,Ot=(t,e,s)=>{const n=e[s];n!==void 0&&n!==t[s].value&&(t[s].value=n)},E$=t=>{t.start=(e=>{let s=!1;return(n=0,i=0,r)=>{if(s)throw os();e.call(t,n,i,r),s=!0}})(t.start)},qy=t=>{t.start=(e=>(s=0,n=0,i)=>{if(typeof i=="number"&&i<0||n<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(t,s,n,i)})(t.start)},Ky=t=>{t.stop=(e=>(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(t,s)})(t.stop)},A$=(t,e,s,n,i,r,a,l,c,u,d)=>(h,f)=>{const m=h.createBufferSource();return Zt(m,f),Ot(m,f,"playbackRate"),wt(m,f,"buffer"),wt(m,f,"loop"),wt(m,f,"loopEnd"),wt(m,f,"loopStart"),e(s,()=>s(h))||E$(m),e(n,()=>n(h))||c(m),e(i,()=>i(h))||u(m,h),e(r,()=>r(h))||qy(m),e(a,()=>a(h))||d(m,h),e(l,()=>l(h))||Ky(m),t(h,m),m},j$=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,C$=(t,e)=>(s,n,i)=>{const r=s.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:n});const a=t(s,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(a,"channelCount",l=>()=>l.call(a),l=>c=>{l.call(a,c);try{r.channelCount=c}catch(u){if(c>r.maxChannelCount)throw u}}),e(a,"channelCountMode",l=>()=>l.call(a),l=>c=>{l.call(a,c),r.channelCountMode=c}),e(a,"channelInterpretation",l=>()=>l.call(a),l=>c=>{l.call(a,c),r.channelInterpretation=c}),Object.defineProperty(a,"maxChannelCount",{get:()=>r.maxChannelCount}),a.connect(r),a},R$=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,I$=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},O$=(t,e,s,n,i)=>(r,a,l,c,u,d)=>{if(l!==null)try{const h=new l(r,c,d),f=new Map;let m=null;if(Object.defineProperties(h,{channelCount:{get:()=>d.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>m,set:b=>{typeof m=="function"&&h.removeEventListener("processorerror",m),m=typeof b=="function"?b:null,typeof m=="function"&&h.addEventListener("processorerror",m)}}}),h.addEventListener=(b=>(...p)=>{if(p[0]==="processorerror"){const v=typeof p[1]=="function"?p[1]:typeof p[1]=="object"&&p[1]!==null&&typeof p[1].handleEvent=="function"?p[1].handleEvent:null;if(v!==null){const x=f.get(p[1]);x!==void 0?p[1]=x:(p[1]=g=>{g.type==="error"?(Object.defineProperties(g,{type:{value:"processorerror"}}),v(g)):v(new ErrorEvent(p[0],{...g}))},f.set(v,p[1]))}}return b.call(h,"error",p[1],p[2]),b.call(h,...p)})(h.addEventListener),h.removeEventListener=(b=>(...p)=>{if(p[0]==="processorerror"){const v=f.get(p[1]);v!==void 0&&(f.delete(p[1]),p[1]=v)}return b.call(h,"error",p[1],p[2]),b.call(h,p[0],p[1],p[2])})(h.removeEventListener),d.numberOfOutputs!==0){const b=s(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(b).connect(r.destination),i(h,()=>b.disconnect(),()=>b.connect(r.destination))}return h}catch(h){throw h.code===11?n():h}if(u===void 0)throw n();return I$(d),e(r,a,u,d)},vC=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),M$=t=>new Promise((e,s)=>{const{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:r})=>{n.close(),i.close(),e(r)},n.onmessageerror=({data:r})=>{n.close(),i.close(),s(r)},i.postMessage(t)}),D$=async(t,e)=>{const s=await M$(e);return new t(s)},L$=(t,e,s,n)=>{let i=nb.get(t);i===void 0&&(i=new WeakMap,nb.set(t,i));const r=D$(s,n);return i.set(e,r),r},P$=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>(m,b,p,v)=>{if(v.numberOfInputs===0&&v.numberOfOutputs===0)throw c();const x=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(x.some(se=>se<1))throw c();if(x.length!==v.numberOfOutputs)throw e();if(v.channelCountMode!=="explicit")throw c();const g=v.channelCount*v.numberOfInputs,y=x.reduce((se,le)=>se+le,0),w=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length;if(g+w>6||y>6)throw c();const k=new MessageChannel,N=[],_=[];for(let se=0;se<v.numberOfInputs;se+=1)N.push(a(m,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),_.push(i(m,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const T=[];if(p.parameterDescriptors!==void 0)for(const{defaultValue:se,maxValue:le,minValue:Pe,name:_e}of p.parameterDescriptors){const Q=r(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.parameterData[_e]!==void 0?v.parameterData[_e]:se===void 0?0:se});Object.defineProperties(Q.offset,{defaultValue:{get:()=>se===void 0?0:se},maxValue:{get:()=>le===void 0?_s:le},minValue:{get:()=>Pe===void 0?Ls:Pe}}),T.push(Q)}const E=n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,g+w)}),A=vC(b,m.sampleRate),R=l(m,A,g+w,Math.max(1,y)),I=i(m,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),V=[];for(let se=0;se<v.numberOfOutputs;se+=1)V.push(n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:x[se]}));for(let se=0;se<v.numberOfInputs;se+=1){N[se].connect(_[se]);for(let le=0;le<v.channelCount;le+=1)_[se].connect(E,le,se*v.channelCount+le)}const H=new gC(p.parameterDescriptors===void 0?[]:p.parameterDescriptors.map(({name:se},le)=>{const Pe=T[le];return Pe.connect(E,0,g+le),Pe.start(0),[se,Pe.offset]}));E.connect(R);let P=v.channelInterpretation,O=null;const L=v.numberOfOutputs===0?[R]:V,M={get bufferSize(){return A},get channelCount(){return v.channelCount},set channelCount(se){throw s()},get channelCountMode(){return v.channelCountMode},set channelCountMode(se){throw s()},get channelInterpretation(){return P},set channelInterpretation(se){for(const le of N)le.channelInterpretation=se;P=se},get context(){return R.context},get inputs(){return N},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return O},set onprocessorerror(se){typeof O=="function"&&M.removeEventListener("processorerror",O),O=typeof se=="function"?se:null,typeof O=="function"&&M.addEventListener("processorerror",O)},get parameters(){return H},get port(){return k.port2},addEventListener(...se){return R.addEventListener(se[0],se[1],se[2])},connect:t.bind(null,L),disconnect:u.bind(null,L),dispatchEvent(...se){return R.dispatchEvent(se[0])},removeEventListener(...se){return R.removeEventListener(se[0],se[1],se[2])}},F=new Map;k.port1.addEventListener=(se=>(...le)=>{if(le[0]==="message"){const Pe=typeof le[1]=="function"?le[1]:typeof le[1]=="object"&&le[1]!==null&&typeof le[1].handleEvent=="function"?le[1].handleEvent:null;if(Pe!==null){const _e=F.get(le[1]);_e!==void 0?le[1]=_e:(le[1]=Q=>{d(m.currentTime,m.sampleRate,()=>Pe(Q))},F.set(Pe,le[1]))}}return se.call(k.port1,le[0],le[1],le[2])})(k.port1.addEventListener),k.port1.removeEventListener=(se=>(...le)=>{if(le[0]==="message"){const Pe=F.get(le[1]);Pe!==void 0&&(F.delete(le[1]),le[1]=Pe)}return se.call(k.port1,le[0],le[1],le[2])})(k.port1.removeEventListener);let U=null;Object.defineProperty(k.port1,"onmessage",{get:()=>U,set:se=>{typeof U=="function"&&k.port1.removeEventListener("message",U),U=typeof se=="function"?se:null,typeof U=="function"&&(k.port1.addEventListener("message",U),k.port1.start())}}),p.prototype.port=k.port1;let C=null;L$(m,M,p,v).then(se=>C=se);const $=Em(v.numberOfInputs,v.channelCount),B=Em(v.numberOfOutputs,x),D=p.parameterDescriptors===void 0?[]:p.parameterDescriptors.reduce((se,{name:le})=>({...se,[le]:new Float32Array(128)}),{});let z=!0;const J=()=>{v.numberOfOutputs>0&&R.disconnect(I);for(let se=0,le=0;se<v.numberOfOutputs;se+=1){const Pe=V[se];for(let _e=0;_e<x[se];_e+=1)I.disconnect(Pe,le+_e,_e);le+=x[se]}},Y=new Map;R.onaudioprocess=({inputBuffer:se,outputBuffer:le})=>{if(C!==null){const Pe=h(M);for(let _e=0;_e<A;_e+=128){for(let Q=0;Q<v.numberOfInputs;Q+=1)for(let ie=0;ie<v.channelCount;ie+=1)Tm(se,$[Q],ie,ie,_e);p.parameterDescriptors!==void 0&&p.parameterDescriptors.forEach(({name:Q},ie)=>{Tm(se,D,Q,g+ie,_e)});for(let Q=0;Q<v.numberOfInputs;Q+=1)for(let ie=0;ie<x[Q];ie+=1)B[Q][ie].byteLength===0&&(B[Q][ie]=new Float32Array(128));try{const Q=$.map((G,oe)=>{if(Pe[oe].size>0)return Y.set(oe,A/128),G;const ce=Y.get(oe);return ce===void 0?[]:(G.every(Se=>Se.every(St=>St===0))&&(ce===1?Y.delete(oe):Y.set(oe,ce-1)),G)});z=d(m.currentTime+_e/m.sampleRate,m.sampleRate,()=>C.process(Q,B,D));for(let G=0,oe=0;G<v.numberOfOutputs;G+=1){for(let W=0;W<x[G];W+=1)xC(le,B[G],W,oe+W,_e);oe+=x[G]}}catch(Q){z=!1,M.dispatchEvent(new ErrorEvent("processorerror",{colno:Q.colno,filename:Q.filename,lineno:Q.lineno,message:Q.message}))}if(!z){for(let Q=0;Q<v.numberOfInputs;Q+=1){N[Q].disconnect(_[Q]);for(let ie=0;ie<v.channelCount;ie+=1)_[_e].disconnect(E,ie,Q*v.channelCount+ie)}if(p.parameterDescriptors!==void 0){const Q=p.parameterDescriptors.length;for(let ie=0;ie<Q;ie+=1){const G=T[ie];G.disconnect(E,0,g+ie),G.stop()}}E.disconnect(R),R.onaudioprocess=null,fe?J():ne();break}}}};let fe=!1;const me=a(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ue=()=>R.connect(me).connect(m.destination),ne=()=>{R.disconnect(me),me.disconnect()},Le=()=>{if(z){ne(),v.numberOfOutputs>0&&R.connect(I);for(let se=0,le=0;se<v.numberOfOutputs;se+=1){const Pe=V[se];for(let _e=0;_e<x[se];_e+=1)I.connect(Pe,le+_e,_e);le+=x[se]}}fe=!0},ft=()=>{z&&(ue(),J()),fe=!1};return ue(),f(M,Le,ft)},yC=(t,e)=>{const s=t.createBiquadFilter();return Zt(s,e),Ot(s,e,"Q"),Ot(s,e,"detune"),Ot(s,e,"frequency"),Ot(s,e,"gain"),wt(s,e,"type"),s},V$=(t,e)=>(s,n)=>{const i=s.createChannelMerger(n.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(s,i),Zt(i,n),i},F$=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:s=>{if(s!==e)throw os()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:s=>{if(s!=="explicit")throw os()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:s=>{if(s!=="discrete")throw os()}})},Jd=(t,e)=>{const s=t.createChannelSplitter(e.numberOfOutputs);return Zt(s,e),F$(s),s},B$=(t,e,s,n,i)=>(r,a)=>{if(r.createConstantSource===void 0)return s(r,a);const l=r.createConstantSource();return Zt(l,a),Ot(l,a,"offset"),e(n,()=>n(r))||qy(l),e(i,()=>i(r))||Ky(l),t(r,l),l},jc=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),U$=(t,e,s,n)=>(i,{offset:r,...a})=>{const l=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=s(i,{...a,gain:r}),d=l.getChannelData(0);d[0]=1,d[1]=1,c.buffer=l,c.loop=!0;const h={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(b){u.channelCount=b},get channelCountMode(){return u.channelCountMode},set channelCountMode(b){u.channelCountMode=b},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(b){u.channelInterpretation=b},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(b){c.onended=b},addEventListener(...b){return c.addEventListener(b[0],b[1],b[2])},dispatchEvent(...b){return c.dispatchEvent(b[0])},removeEventListener(...b){return c.removeEventListener(b[0],b[1],b[2])},start(b=0){c.start.call(c,b)},stop(b=0){c.stop.call(c,b)}},f=()=>c.connect(u),m=()=>c.disconnect(u);return t(i,c),n(jc(h,u),f,m)},$$=(t,e)=>(s,n)=>{const i=s.createConvolver();if(Zt(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),wt(i,n,"buffer"),n.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>a=>{if(a>2)throw t();return r.call(i,a)}),n.channelCountMode==="max"))throw t();return e(i,"channelCountMode",r=>()=>r.call(i),r=>a=>{if(a==="max")throw t();return r.call(i,a)}),i},_C=(t,e)=>{const s=t.createDelay(e.maxDelayTime);return Zt(s,e),Ot(s,e,"delayTime"),s},G$=t=>(e,s)=>{const n=e.createDynamicsCompressor();if(Zt(n,s),s.channelCount>2||s.channelCountMode==="max")throw t();return Ot(n,s,"attack"),Ot(n,s,"knee"),Ot(n,s,"ratio"),Ot(n,s,"release"),Ot(n,s,"threshold"),n},Gs=(t,e)=>{const s=t.createGain();return Zt(s,e),Ot(s,e,"gain"),s},H$=t=>(e,s,n)=>{if(e.createIIRFilter===void 0)return t(e,s,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return Zt(i,n),i};function z$(t,e){const s=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/s,(t[1]*e[0]-t[0]*e[1])/s]}function q$(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function DN(t,e){let s=[0,0];for(let n=t.length-1;n>=0;n-=1)s=q$(s,e),s[0]+=t[n];return s}const K$=(t,e,s,n)=>(i,r,{channelCount:a,channelCountMode:l,channelInterpretation:c,feedback:u,feedforward:d})=>{const h=vC(r,i.sampleRate),f=u instanceof Float64Array?u:new Float64Array(u),m=d instanceof Float64Array?d:new Float64Array(d),b=f.length,p=m.length,v=Math.min(b,p);if(b===0||b>20)throw n();if(f[0]===0)throw e();if(p===0||p>20)throw n();if(m[0]===0)throw e();if(f[0]!==1){for(let T=0;T<p;T+=1)m[T]/=f[0];for(let T=1;T<b;T+=1)f[T]/=f[0]}const x=s(i,h,a,a);x.channelCount=a,x.channelCountMode=l,x.channelInterpretation=c;const g=32,y=[],w=[],k=[];for(let T=0;T<a;T+=1){y.push(0);const E=new Float32Array(g),A=new Float32Array(g);E.fill(0),A.fill(0),w.push(E),k.push(A)}x.onaudioprocess=T=>{const E=T.inputBuffer,A=T.outputBuffer,R=E.numberOfChannels;for(let I=0;I<R;I+=1){const V=E.getChannelData(I),H=A.getChannelData(I);y[I]=bC(f,b,m,p,v,w[I],k[I],y[I],g,V,H)}};const N=i.sampleRate/2;return jc({get bufferSize(){return h},get channelCount(){return x.channelCount},set channelCount(T){x.channelCount=T},get channelCountMode(){return x.channelCountMode},set channelCountMode(T){x.channelCountMode=T},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(T){x.channelInterpretation=T},get context(){return x.context},get inputs(){return[x]},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},addEventListener(...T){return x.addEventListener(T[0],T[1],T[2])},dispatchEvent(...T){return x.dispatchEvent(T[0])},getFrequencyResponse(T,E,A){if(T.length!==E.length||E.length!==A.length)throw t();const R=T.length;for(let I=0;I<R;I+=1){const V=-Math.PI*(T[I]/N),H=[Math.cos(V),Math.sin(V)],P=DN(m,H),O=DN(f,H),L=z$(P,O);E[I]=Math.sqrt(L[0]*L[0]+L[1]*L[1]),A[I]=Math.atan2(L[1],L[0])}},removeEventListener(...T){return x.removeEventListener(T[0],T[1],T[2])}},x)},W$=(t,e)=>t.createMediaElementSource(e.mediaElement),Y$=(t,e)=>{const s=t.createMediaStreamDestination();return Zt(s,e),s.numberOfOutputs===1&&Object.defineProperty(s,"numberOfOutputs",{get:()=>0}),s},X$=(t,{mediaStream:e})=>{const s=e.getAudioTracks();s.sort((r,a)=>r.id<a.id?-1:r.id>a.id?1:0);const n=s.slice(0,1),i=t.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i},Q$=(t,e)=>(s,{mediaStreamTrack:n})=>{if(typeof s.createMediaStreamTrackSource=="function")return s.createMediaStreamTrackSource(n);const i=new MediaStream([n]),r=s.createMediaStreamSource(i);if(n.kind!=="audio")throw t();if(e(s))throw new TypeError;return r},J$=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,Z$=(t,e,s,n,i,r)=>(a,l)=>{const c=a.createOscillator();return Zt(c,l),Ot(c,l,"detune"),Ot(c,l,"frequency"),l.periodicWave!==void 0?c.setPeriodicWave(l.periodicWave):wt(c,l,"type"),e(s,()=>s(a))||qy(c),e(n,()=>n(a))||r(c,a),e(i,()=>i(a))||Ky(c),t(a,c),c},eG=t=>(e,s)=>{const n=e.createPanner();return n.orientationX===void 0?t(e,s):(Zt(n,s),Ot(n,s,"orientationX"),Ot(n,s,"orientationY"),Ot(n,s,"orientationZ"),Ot(n,s,"positionX"),Ot(n,s,"positionY"),Ot(n,s,"positionZ"),wt(n,s,"coneInnerAngle"),wt(n,s,"coneOuterAngle"),wt(n,s,"coneOuterGain"),wt(n,s,"distanceModel"),wt(n,s,"maxDistance"),wt(n,s,"panningModel"),wt(n,s,"refDistance"),wt(n,s,"rolloffFactor"),n)},tG=(t,e,s,n,i,r,a,l,c,u)=>(d,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:m,distanceModel:b,maxDistance:p,orientationX:v,orientationY:x,orientationZ:g,panningModel:y,positionX:w,positionY:k,positionZ:N,refDistance:_,rolloffFactor:T,...E})=>{const A=d.createPanner();if(E.channelCount>2||E.channelCountMode==="max")throw a();Zt(A,E);const R={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},I=s(d,{...R,channelInterpretation:"speakers",numberOfInputs:6}),V=n(d,{...E,gain:1}),H=n(d,{...R,gain:1}),P=n(d,{...R,gain:0}),O=n(d,{...R,gain:0}),L=n(d,{...R,gain:0}),M=n(d,{...R,gain:0}),F=n(d,{...R,gain:0}),U=i(d,256,6,1),C=r(d,{...R,curve:new Float32Array([1,1]),oversample:"none"});let j=[v,x,g],$=[w,k,N];const B=new Float32Array(1);U.onaudioprocess=({inputBuffer:Y})=>{const fe=[c(Y,B,0),c(Y,B,1),c(Y,B,2)];fe.some((ue,ne)=>ue!==j[ne])&&(A.setOrientation(...fe),j=fe);const me=[c(Y,B,3),c(Y,B,4),c(Y,B,5)];me.some((ue,ne)=>ue!==$[ne])&&(A.setPosition(...me),$=me)},Object.defineProperty(P.gain,"defaultValue",{get:()=>0}),Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const D={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(Y){if(Y>2)throw a();V.channelCount=Y,A.channelCount=Y},get channelCountMode(){return A.channelCountMode},set channelCountMode(Y){if(Y==="max")throw a();V.channelCountMode=Y,A.channelCountMode=Y},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(Y){V.channelInterpretation=Y,A.channelInterpretation=Y},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(Y){A.coneInnerAngle=Y},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(Y){A.coneOuterAngle=Y},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(Y){if(Y<0||Y>1)throw e();A.coneOuterGain=Y},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(Y){A.distanceModel=Y},get inputs(){return[V]},get maxDistance(){return A.maxDistance},set maxDistance(Y){if(Y<0)throw new RangeError;A.maxDistance=Y},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return H.gain},get orientationY(){return P.gain},get orientationZ(){return O.gain},get panningModel(){return A.panningModel},set panningModel(Y){A.panningModel=Y},get positionX(){return L.gain},get positionY(){return M.gain},get positionZ(){return F.gain},get refDistance(){return A.refDistance},set refDistance(Y){if(Y<0)throw new RangeError;A.refDistance=Y},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(Y){if(Y<0)throw new RangeError;A.rolloffFactor=Y},addEventListener(...Y){return V.addEventListener(Y[0],Y[1],Y[2])},dispatchEvent(...Y){return V.dispatchEvent(Y[0])},removeEventListener(...Y){return V.removeEventListener(Y[0],Y[1],Y[2])}};h!==D.coneInnerAngle&&(D.coneInnerAngle=h),f!==D.coneOuterAngle&&(D.coneOuterAngle=f),m!==D.coneOuterGain&&(D.coneOuterGain=m),b!==D.distanceModel&&(D.distanceModel=b),p!==D.maxDistance&&(D.maxDistance=p),v!==D.orientationX.value&&(D.orientationX.value=v),x!==D.orientationY.value&&(D.orientationY.value=x),g!==D.orientationZ.value&&(D.orientationZ.value=g),y!==D.panningModel&&(D.panningModel=y),w!==D.positionX.value&&(D.positionX.value=w),k!==D.positionY.value&&(D.positionY.value=k),N!==D.positionZ.value&&(D.positionZ.value=N),_!==D.refDistance&&(D.refDistance=_),T!==D.rolloffFactor&&(D.rolloffFactor=T),(j[0]!==1||j[1]!==0||j[2]!==0)&&A.setOrientation(...j),($[0]!==0||$[1]!==0||$[2]!==0)&&A.setPosition(...$);const z=()=>{V.connect(A),t(V,C,0,0),C.connect(H).connect(I,0,0),C.connect(P).connect(I,0,1),C.connect(O).connect(I,0,2),C.connect(L).connect(I,0,3),C.connect(M).connect(I,0,4),C.connect(F).connect(I,0,5),I.connect(U).connect(d.destination)},J=()=>{V.disconnect(A),l(V,C,0,0),C.disconnect(H),H.disconnect(I),C.disconnect(P),P.disconnect(I),C.disconnect(O),O.disconnect(I),C.disconnect(L),L.disconnect(I),C.disconnect(M),M.disconnect(I),C.disconnect(F),F.disconnect(I),I.disconnect(U),U.disconnect(d.destination)};return u(jc(D,A),z,J)},sG=t=>(e,{disableNormalization:s,imag:n,real:i})=>{const r=n instanceof Float32Array?n:new Float32Array(n),a=i instanceof Float32Array?i:new Float32Array(i),l=e.createPeriodicWave(a,r,{disableNormalization:s});if(Array.from(n).length<2)throw t();return l},Zd=(t,e,s,n)=>t.createScriptProcessor(e,s,n),nG=(t,e)=>(s,n)=>{const i=n.channelCountMode;if(i==="clamped-max")throw e();if(s.createStereoPanner===void 0)return t(s,n);const r=s.createStereoPanner();return Zt(r,n),Ot(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:a=>{if(a!==i)throw e()}}),r},iG=(t,e,s,n,i,r)=>{const l=new Float32Array([1,1]),c=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...u,oversample:"none"},h=(b,p,v,x)=>{const g=new Float32Array(16385),y=new Float32Array(16385);for(let E=0;E<16385;E+=1){const A=E/16384*c;g[E]=Math.cos(A),y[E]=Math.sin(A)}const w=s(b,{...u,gain:0}),k=n(b,{...d,curve:g}),N=n(b,{...d,curve:l}),_=s(b,{...u,gain:0}),T=n(b,{...d,curve:y});return{connectGraph(){p.connect(w),p.connect(N.inputs===void 0?N:N.inputs[0]),p.connect(_),N.connect(v),v.connect(k.inputs===void 0?k:k.inputs[0]),v.connect(T.inputs===void 0?T:T.inputs[0]),k.connect(w.gain),T.connect(_.gain),w.connect(x,0,0),_.connect(x,0,1)},disconnectGraph(){p.disconnect(w),p.disconnect(N.inputs===void 0?N:N.inputs[0]),p.disconnect(_),N.disconnect(v),v.disconnect(k.inputs===void 0?k:k.inputs[0]),v.disconnect(T.inputs===void 0?T:T.inputs[0]),k.disconnect(w.gain),T.disconnect(_.gain),w.disconnect(x,0,0),_.disconnect(x,0,1)}}},f=(b,p,v,x)=>{const g=new Float32Array(16385),y=new Float32Array(16385),w=new Float32Array(16385),k=new Float32Array(16385),N=Math.floor(16385/2);for(let L=0;L<16385;L+=1)if(L>N){const M=(L-N)/(16384-N)*c;g[L]=Math.cos(M),y[L]=Math.sin(M),w[L]=0,k[L]=1}else{const M=L/(16384-N)*c;g[L]=1,y[L]=0,w[L]=Math.cos(M),k[L]=Math.sin(M)}const _=e(b,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),T=s(b,{...u,gain:0}),E=n(b,{...d,curve:g}),A=s(b,{...u,gain:0}),R=n(b,{...d,curve:y}),I=n(b,{...d,curve:l}),V=s(b,{...u,gain:0}),H=n(b,{...d,curve:w}),P=s(b,{...u,gain:0}),O=n(b,{...d,curve:k});return{connectGraph(){p.connect(_),p.connect(I.inputs===void 0?I:I.inputs[0]),_.connect(T,0),_.connect(A,0),_.connect(V,1),_.connect(P,1),I.connect(v),v.connect(E.inputs===void 0?E:E.inputs[0]),v.connect(R.inputs===void 0?R:R.inputs[0]),v.connect(H.inputs===void 0?H:H.inputs[0]),v.connect(O.inputs===void 0?O:O.inputs[0]),E.connect(T.gain),R.connect(A.gain),H.connect(V.gain),O.connect(P.gain),T.connect(x,0,0),V.connect(x,0,0),A.connect(x,0,1),P.connect(x,0,1)},disconnectGraph(){p.disconnect(_),p.disconnect(I.inputs===void 0?I:I.inputs[0]),_.disconnect(T,0),_.disconnect(A,0),_.disconnect(V,1),_.disconnect(P,1),I.disconnect(v),v.disconnect(E.inputs===void 0?E:E.inputs[0]),v.disconnect(R.inputs===void 0?R:R.inputs[0]),v.disconnect(H.inputs===void 0?H:H.inputs[0]),v.disconnect(O.inputs===void 0?O:O.inputs[0]),E.disconnect(T.gain),R.disconnect(A.gain),H.disconnect(V.gain),O.disconnect(P.gain),T.disconnect(x,0,0),V.disconnect(x,0,0),A.disconnect(x,0,1),P.disconnect(x,0,1)}}},m=(b,p,v,x,g)=>{if(p===1)return h(b,v,x,g);if(p===2)return f(b,v,x,g);throw i()};return(b,{channelCount:p,channelCountMode:v,pan:x,...g})=>{if(v==="max")throw i();const y=t(b,{...g,channelCount:1,channelCountMode:v,numberOfInputs:2}),w=s(b,{...g,channelCount:p,channelCountMode:v,gain:1}),k=s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:x});let{connectGraph:N,disconnectGraph:_}=m(b,p,w,k,y);Object.defineProperty(k.gain,"defaultValue",{get:()=>0}),Object.defineProperty(k.gain,"maxValue",{get:()=>1}),Object.defineProperty(k.gain,"minValue",{get:()=>-1});const T={get bufferSize(){},get channelCount(){return w.channelCount},set channelCount(I){w.channelCount!==I&&(E&&_(),{connectGraph:N,disconnectGraph:_}=m(b,I,w,k,y),E&&N()),w.channelCount=I},get channelCountMode(){return w.channelCountMode},set channelCountMode(I){if(I==="clamped-max"||I==="max")throw i();w.channelCountMode=I},get channelInterpretation(){return w.channelInterpretation},set channelInterpretation(I){w.channelInterpretation=I},get context(){return w.context},get inputs(){return[w]},get numberOfInputs(){return w.numberOfInputs},get numberOfOutputs(){return w.numberOfOutputs},get pan(){return k.gain},addEventListener(...I){return w.addEventListener(I[0],I[1],I[2])},dispatchEvent(...I){return w.dispatchEvent(I[0])},removeEventListener(...I){return w.removeEventListener(I[0],I[1],I[2])}};let E=!1;const A=()=>{N(),E=!0},R=()=>{_(),E=!1};return r(jc(T,y),A,R)}},rG=(t,e,s,n,i,r,a)=>(l,c)=>{const u=l.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&l.createGain().gain.automationRate===void 0)return s(l,c);Zt(u,c);const d=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(d!==null&&d.length<2)throw e();wt(u,{curve:d},"curve"),wt(u,c,"oversample");let h=null,f=!1;return a(u,"curve",p=>()=>p.call(u),p=>v=>(p.call(u,v),f&&(n(v)&&h===null?h=t(l,u):!n(v)&&h!==null&&(h(),h=null)),v)),i(u,()=>{f=!0,n(u.curve)&&(h=t(l,u))},()=>{f=!1,h!==null&&(h(),h=null)})},aG=(t,e,s,n,i)=>(r,{curve:a,oversample:l,...c})=>{const u=r.createWaveShaper(),d=r.createWaveShaper();Zt(u,c),Zt(d,c);const h=s(r,{...c,gain:1}),f=s(r,{...c,gain:-1}),m=s(r,{...c,gain:1}),b=s(r,{...c,gain:-1});let p=null,v=!1,x=null;const g={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(k){h.channelCount=k,f.channelCount=k,u.channelCount=k,m.channelCount=k,d.channelCount=k,b.channelCount=k},get channelCountMode(){return u.channelCountMode},set channelCountMode(k){h.channelCountMode=k,f.channelCountMode=k,u.channelCountMode=k,m.channelCountMode=k,d.channelCountMode=k,b.channelCountMode=k},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(k){h.channelInterpretation=k,f.channelInterpretation=k,u.channelInterpretation=k,m.channelInterpretation=k,d.channelInterpretation=k,b.channelInterpretation=k},get context(){return u.context},get curve(){return x},set curve(k){if(k!==null&&k.length<2)throw e();if(k===null)u.curve=k,d.curve=k;else{const N=k.length,_=new Float32Array(N+2-N%2),T=new Float32Array(N+2-N%2);_[0]=k[0],T[0]=-k[N-1];const E=Math.ceil((N+1)/2),A=(N+1)/2-1;for(let R=1;R<E;R+=1){const I=R/E*A,V=Math.floor(I),H=Math.ceil(I);_[R]=V===H?k[V]:(1-(I-V))*k[V]+(1-(H-I))*k[H],T[R]=V===H?-k[N-1-V]:-((1-(I-V))*k[N-1-V])-(1-(H-I))*k[N-1-H]}_[E]=N%2===1?k[E-1]:(k[E-2]+k[E-1])/2,u.curve=_,d.curve=T}x=k,v&&(n(x)&&p===null?p=t(r,h):p!==null&&(p(),p=null))},get inputs(){return[h]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(k){u.oversample=k,d.oversample=k},addEventListener(...k){return h.addEventListener(k[0],k[1],k[2])},dispatchEvent(...k){return h.dispatchEvent(k[0])},removeEventListener(...k){return h.removeEventListener(k[0],k[1],k[2])}};a!==null&&(g.curve=a instanceof Float32Array?a:new Float32Array(a)),l!==g.oversample&&(g.oversample=l);const y=()=>{h.connect(u).connect(m),h.connect(f).connect(d).connect(b).connect(m),v=!0,n(x)&&(p=t(r,h))},w=()=>{h.disconnect(u),u.disconnect(m),h.disconnect(f),f.disconnect(d),d.disconnect(b),b.disconnect(m),v=!1,p!==null&&(p(),p=null)};return i(jc(g,m),y,w)},js=()=>new DOMException("","NotSupportedError"),oG={numberOfChannels:1},lG=(t,e,s,n,i)=>class extends t{constructor(a,l,c){let u;if(typeof a=="number"&&l!==void 0&&c!==void 0)u={length:l,numberOfChannels:a,sampleRate:c};else if(typeof a=="object")u=a;else throw new Error("The given parameters are not valid.");const{length:d,numberOfChannels:h,sampleRate:f}={...oG,...u},m=n(h,d,f);e(ud,()=>ud(m))||m.addEventListener("statechange",(()=>{let b=0;const p=v=>{this._state==="running"&&(b>0?(m.removeEventListener("statechange",p),v.stopImmediatePropagation(),this._waitForThePromiseToSettle(v)):b+=1)};return p})()),super(m,h),this._length=d,this._nativeOfflineAudioContext=m,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(s()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,hC(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},cG={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},uG=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...cG,...u},f=s(d,h),m=r(d),b=m?n():null,p=c.sampleRate/2;super(c,!1,f,b),this._detune=e(this,m,f.detune,153600,-153600),this._frequency=e(this,m,f.frequency,p,-p),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=b,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeOscillatorNode.onended=u;const d=this._nativeOscillatorNode.onended;this._onended=d!==null&&d===u?c:d}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){tc(this);const u=()=>{this._nativeOscillatorNode.removeEventListener("ended",u),Hi(this)&&Yd(this)};this._nativeOscillatorNode.addEventListener("ended",u)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},dG=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null,c=null;const u=async(d,h)=>{let f=s(d);const m=vs(f,h);if(!m){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:a===null?void 0:a,type:f.type};f=e(h,b),l!==null&&f.start(l),c!==null&&f.stop(c)}return r.set(h,f),m?(await t(h,d.detune,f.detune),await t(h,d.frequency,f.frequency)):(await n(h,d.detune,f.detune),await n(h,d.frequency,f.frequency)),await i(d,h,f),f};return{set periodicWave(d){a=d},set start(d){l=d},set stop(d){c=d},render(d,h){const f=r.get(h);return f!==void 0?Promise.resolve(f):u(d,h)}}},hG={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},fG=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...hG,...u},f=s(d,h),m=r(d),b=m?n():null;super(c,!1,f,b),this._nativePannerNode=f,this._orientationX=e(this,m,f.orientationX,_s,Ls),this._orientationY=e(this,m,f.orientationY,_s,Ls),this._orientationZ=e(this,m,f.orientationZ,_s,Ls),this._positionX=e(this,m,f.positionX,_s,Ls),this._positionY=e(this,m,f.positionY,_s,Ls),this._positionZ=e(this,m,f.positionZ,_s,Ls),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},mG=(t,e,s,n,i,r,a,l,c,u)=>()=>{const d=new WeakMap;let h=null;const f=async(m,b)=>{let p=null,v=r(m);const x={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},g={...x,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},y=vs(v,b);if("bufferSize"in v)p=n(b,{...x,gain:1});else if(!y){const w={...g,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=i(b,w)}if(d.set(b,p===null?v:p),p!==null){if(h===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const R=new a(6,m.context.length,b.sampleRate),I=e(R,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});I.connect(R.destination),h=(async()=>{const V=await Promise.all([m.orientationX,m.orientationY,m.orientationZ,m.positionX,m.positionY,m.positionZ].map(async(H,P)=>{const O=s(R,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:P===0?1:0});return await l(R,H,O.offset),O}));for(let H=0;H<6;H+=1)V[H].connect(I,0,H),V[H].start(0);return u(R)})()}const w=await h,k=n(b,{...x,gain:1});await c(m,b,k);const N=[];for(let R=0;R<w.numberOfChannels;R+=1)N.push(w.getChannelData(R));let _=[N[0][0],N[1][0],N[2][0]],T=[N[3][0],N[4][0],N[5][0]],E=n(b,{...x,gain:1}),A=i(b,{...g,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:T[0],positionY:T[1],positionZ:T[2]});k.connect(E).connect(A.inputs[0]),A.connect(p);for(let R=128;R<w.length;R+=128){const I=[N[0][R],N[1][R],N[2][R]],V=[N[3][R],N[4][R],N[5][R]];if(I.some((H,P)=>H!==_[P])||V.some((H,P)=>H!==T[P])){_=I,T=V;const H=R/b.sampleRate;E.gain.setValueAtTime(0,H),E=n(b,{...x,gain:0}),A=i(b,{...g,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:T[0],positionY:T[1],positionZ:T[2]}),E.gain.setValueAtTime(1,H),k.connect(E).connect(A.inputs[0]),A.connect(p)}}return p}return y?(await t(b,m.orientationX,v.orientationX),await t(b,m.orientationY,v.orientationY),await t(b,m.orientationZ,v.orientationZ),await t(b,m.positionX,v.positionX),await t(b,m.positionY,v.positionY),await t(b,m.positionZ,v.positionZ)):(await l(b,m.orientationX,v.orientationX),await l(b,m.orientationY,v.orientationY),await l(b,m.orientationZ,v.orientationZ),await l(b,m.positionX,v.positionX),await l(b,m.positionY,v.positionY),await l(b,m.positionZ,v.positionZ)),Ac(v)?await c(m,b,v.inputs[0]):await c(m,b,v),v};return{render(m,b){const p=d.get(b);return p!==void 0?Promise.resolve(p):f(m,b)}}},pG={disableNormalization:!1},gG=(t,e,s,n)=>class wC{constructor(r,a){const l=e(r),c=n({...pG,...a}),u=t(l,c);return s.add(u),u}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===wC.prototype||s.has(r)}},xG=(t,e)=>(s,n,i)=>(t(n).replay(i),e(n,s,i)),bG=(t,e,s)=>async(n,i,r)=>{const a=t(n);await Promise.all(a.activeInputs.map((l,c)=>Array.from(l).map(async([u,d])=>{const f=await e(u).render(u,i),m=n.context.destination;!s(u)&&(n!==m||!s(n))&&f.connect(r,d,c)})).reduce((l,c)=>[...l,...c],[]))},vG=(t,e,s)=>async(n,i,r)=>{const a=e(n);await Promise.all(Array.from(a.activeInputs).map(async([l,c])=>{const d=await t(l).render(l,i);s(l)||d.connect(r,c)}))},yG=(t,e,s,n)=>i=>t(ud,()=>ud(i))?Promise.resolve(t(n,n)).then(r=>{if(!r){const a=s(i,512,0,1);i.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>i.currentTime,a.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const a=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=l=>{a.disconnect(),r(l.renderedBuffer)},a.connect(i.destination),i.startRendering()}),_G=t=>(e,s)=>{t.set(e,s)},wG=t=>(e,s)=>t.set(e,s),kG=(t,e,s,n,i,r,a,l)=>(c,u)=>s(c).render(c,u).then(()=>Promise.all(Array.from(n(u)).map(d=>s(d).render(d,u)))).then(()=>i(u)).then(d=>(typeof d.copyFromChannel!="function"?(a(d),Gy(d)):e(r,()=>r(d))||l(d),t.add(d),d)),NG={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},SG=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...NG,...c},h=s(u,d),f=r(u),m=f?n():null;super(l,!1,h,m),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},TG=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(c,h)}return r.set(c,u),d?await t(c,l.pan,u.pan):await n(c,l.pan,u.pan),Ac(u)?await i(l,c,u.inputs[0]):await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},EG=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},AG=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const s=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(s);let r=!1,a=!1;try{await n.audioWorklet.addModule(i);const l=new t(n,"a",{numberOfOutputs:0}),c=n.createOscillator();l.port.onmessage=()=>r=!0,l.onprocessorerror=()=>a=!0,c.connect(l),c.start(0),await n.startRendering(),await new Promise(u=>setTimeout(u))}catch{}finally{URL.revokeObjectURL(i)}return r&&!a},jG=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const s=new e(1,1,44100),n=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{s.oncomplete=()=>{n.disconnect(),i(s.currentTime!==0)},s.startRendering()})},CG=()=>new DOMException("","UnknownError"),RG={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},IG=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...RG,...u},f=s(d,h),b=r(d)?n():null;super(c,!0,f,b),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},OG=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,curve:l.curve,oversample:l.oversample};l=t(a,u)}return n.set(a,l),Ac(l)?await s(r,a,l.inputs[0]):await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},MG=()=>typeof window>"u"?null:window,DG=(t,e)=>s=>{s.copyFromChannel=(n,i,r=0)=>{const a=t(r),l=t(i);if(l>=s.numberOfChannels)throw e();const c=s.length,u=s.getChannelData(l),d=n.length;for(let h=a<0?-a:0;h+a<c&&h<d;h+=1)n[h]=u[h+a]},s.copyToChannel=(n,i,r=0)=>{const a=t(r),l=t(i);if(l>=s.numberOfChannels)throw e();const c=s.length,u=s.getChannelData(l),d=n.length;for(let h=a<0?-a:0;h+a<c&&h<d;h+=1)u[h+a]=n[h]}},LG=t=>e=>{e.copyFromChannel=(s=>(n,i,r=0)=>{const a=t(r),l=t(i);if(a<e.length)return s.call(e,n,l,a)})(e.copyFromChannel),e.copyToChannel=(s=>(n,i,r=0)=>{const a=t(r),l=t(i);if(a<e.length)return s.call(e,n,l,a)})(e.copyToChannel)},PG=t=>(e,s)=>{const n=s.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),t(e,"buffer",i=>()=>{const r=i.call(e);return r===n?null:r},i=>r=>i.call(e,r===null?n:r))},VG=(t,e)=>(s,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=s.createBufferSource();e(n,()=>{const l=n.numberOfInputs;for(let c=0;c<l;c+=1)i.connect(n,0,c)},()=>i.disconnect(n))},kC=(t,e,s)=>t.copyFromChannel===void 0?t.getChannelData(s)[0]:(t.copyFromChannel(e,s),e[0]),NC=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},eh=(t,e,s,n)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:a}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:s(r),set:n(a)})},FG=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),BG=t=>({...t,channelCount:t.numberOfOutputs}),UG=t=>{const{imag:e,real:s}=t;return e===void 0?s===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(s,()=>0),real:s}:s===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:s}},SC=(t,e,s)=>{try{t.setValueAtTime(e,s)}catch(n){if(n.code!==9)throw n;SC(t,e,s+1e-7)}},$G=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},GG=t=>{const e=t.createBufferSource(),s=t.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch{return!1}return!0},HG=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Wy=t=>{const e=t.createOscillator();try{e.start(-1)}catch(s){return s instanceof RangeError}return!1},TC=t=>{const e=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch{return!1}},Yy=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(s){return s instanceof RangeError}return!1},zG=t=>{const{port1:e,port2:s}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),s.close()}},qG=t=>{t.start=(e=>(s=0,n=0,i)=>{const r=t.buffer,a=r===null?n:Math.min(r.duration,n);r!==null&&a>r.duration-.5/t.context.sampleRate?e.call(t,s,0,0):e.call(t,s,a,i)})(t.start)},EC=(t,e)=>{const s=e.createGain();t.connect(s);const n=(i=>()=>{i.call(t,s),t.removeEventListener("ended",n)})(t.disconnect);t.addEventListener("ended",n),jc(t,s),t.stop=(i=>{let r=!1;return(a=0)=>{if(r)try{i.call(t,a)}catch{s.gain.setValueAtTime(0,a)}else i.call(t,a),r=!0}})(t.stop)},Cc=(t,e)=>s=>{const n={value:t};return Object.defineProperties(s,{currentTarget:n,target:n}),typeof e=="function"?e.call(t,s):e.handleEvent.call(t,s)},KG=f9(Po),WG=v9(Po),YG=RU(Mp),AC=new WeakMap,XG=YU(AC),ti=oU(new Map,new WeakMap),fi=MG(),jC=S$(ti,vi),Xy=WU(Ns),xs=bG(Ns,Xy,ko),QG=N9(jC,bt,xs),ht=JU(Op),pr=J$(fi),rt=p$(pr),CC=new WeakMap,RC=UU(Cc),th=j$(fi),Qy=d$(th),Jy=h$(fi),IC=f$(fi),dd=R$(fi),Ft=Y9(m9(rC),b9(KG,WG,km,YG,Nm,Ns,XG,Wd,bt,Po,Hi,ko,hf),ti,a$(tb,Nm,Ns,bt,cd,Hi),vi,Dp,js,EU(km,tb,Ns,bt,cd,ht,Hi,rt),MU(CC,Ns,Xn),RC,ht,Qy,Jy,IC,rt,dd),JG=k9(Ft,QG,vi,jC,ht,rt),Zy=new WeakSet,LN=T$(fi),OC=yU(new Uint32Array(1)),e_=DG(OC,vi),t_=LG(OC),MC=T9(Zy,ti,js,LN,pr,EG(LN),e_,t_),Lp=y9(Gs),DC=vG(Xy,Xd,ko),yi=mU(DC),Rc=A$(Lp,ti,$G,GG,HG,Wy,TC,Yy,qG,PG(eh),EC),_i=xG(XU(Xd),DC),ZG=j9(yi,Rc,bt,_i,xs),si=X9(p9(aC),CC,$y,Q9,o9,l9,c9,u9,d9,Jx,nC,th,SC),eH=A9(Ft,ZG,si,os,Rc,ht,rt,Cc),tH=V9(Ft,F9,vi,os,C$(Gs,eh),ht,rt,xs),sH=aU(yi,yC,bt,_i,xs),Vo=wG(AC),nH=rU(Ft,si,sH,Dp,yC,ht,rt,Vo),ja=k$(Po,Jy),iH=VG(os,ja),Ca=V$(th,iH),rH=uU(Ca,bt,xs),aH=cU(Ft,rH,Ca,ht,rt),oH=fU(Jd,bt,xs),lH=hU(Ft,oH,Jd,ht,rt,BG),cH=U$(Lp,Rc,Gs,ja),Ic=B$(Lp,ti,cH,Wy,Yy),uH=vU(yi,Ic,bt,_i,xs),dH=bU(Ft,si,uH,Ic,ht,rt,Cc),LC=$$(js,eh),hH=kU(LC,bt,xs),fH=wU(Ft,hH,LC,ht,rt,Vo),mH=CU(yi,_C,bt,_i,xs),pH=jU(Ft,si,mH,_C,ht,rt,Vo),PC=G$(js),gH=VU(yi,PC,bt,_i,xs),xH=PU(Ft,si,gH,PC,js,ht,rt,Vo),bH=qU(yi,Gs,bt,_i,xs),vH=zU(Ft,si,bH,Gs,ht,rt),yH=K$(Dp,os,Zd,js),Pp=yG(ti,Gs,Zd,jG(Gs,pr)),_H=r$(Rc,bt,pr,xs,Pp),wH=H$(yH),kH=n$(Ft,wH,_H,ht,rt,Vo),NH=B9(si,Ca,Ic,Zd,js,kC,rt,eh),VC=new WeakMap,SH=w$(tH,NH,RC,rt,VC,Cc),FC=Z$(Lp,ti,Wy,TC,Yy,EC),TH=dG(yi,FC,bt,_i,xs),EH=uG(Ft,si,FC,TH,ht,rt,Cc),BC=gU(Rc),AH=aG(BC,os,Gs,NC,ja),Vp=rG(BC,os,AH,NC,ja,th,eh),jH=tG(km,os,Ca,Gs,Zd,Vp,js,Nm,kC,ja),UC=eG(jH),CH=mG(yi,Ca,Ic,Gs,UC,bt,pr,_i,xs,Pp),RH=fG(Ft,si,UC,CH,ht,rt,Vo),IH=sG(vi),OH=gG(IH,ht,new WeakSet,UG),MH=iG(Ca,Jd,Gs,Vp,js,ja),$C=nG(MH,js),DH=TG(yi,$C,bt,_i,xs),LH=SG(Ft,si,$C,DH,ht,rt),PH=OG(Vp,bt,xs),VH=IG(Ft,os,Vp,PH,ht,rt,Vo),GC=g$(fi),s_=$U(fi),HC=new WeakMap,FH=ZU(HC,pr),BH=GC?x9(ti,js,BU(fi),s_,GU(h9),ht,FH,rt,dd,new WeakMap,new WeakMap,AG(dd,pr),fi):void 0,UH=m$(Qy,rt),$H=TU(Zy,ti,SU,FU,new WeakSet,ht,UH,_m,ud,e_,t_),zC=nU(BH,JG,MC,eH,nH,aH,lH,dH,fH,$H,pH,xH,vH,kH,SH,EH,RH,OH,LH,VH),GH=x$(Ft,W$,ht,rt),HH=v$(Ft,Y$,ht,rt),zH=y$(Ft,X$,ht,rt),qH=Q$(os,rt),KH=_$(Ft,qH,ht),WH=P9(zC,os,js,CG,GH,HH,zH,KH,th),n_=e$(VC),YH=_9(n_),qC=pU(vi),XH=IU(n_),KC=DU(vi),WC=new WeakMap,QH=KU(WC,Xn),JH=P$(qC,vi,os,Ca,Jd,Ic,Gs,Zd,js,KC,s_,QH,ja),ZH=O$(os,JH,Gs,js,ja),ez=sU(yi,qC,Rc,Ca,Jd,Ic,Gs,XH,KC,s_,bt,dd,pr,_i,xs,Pp),tz=QU(HC),sz=_G(WC),PN=GC?Z9(YH,Ft,si,ez,ZH,Ns,tz,ht,rt,dd,FG,sz,zG,Cc):void 0,nz=NU(js,pr),iz=kG(Zy,ti,Xy,n_,Pp,_m,e_,t_),rz=lG(zC,ti,os,nz,iz),az=o$(Op,Qy),oz=l$(Uy,Jy),lz=c$($y,IC),cz=u$(Op,rt);function Sn(t){return t===void 0}function Oe(t){return t!==void 0}function uz(t){return typeof t=="function"}function ir(t){return typeof t=="number"}function ao(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function dz(t){return typeof t=="boolean"}function on(t){return Array.isArray(t)}function rr(t){return typeof t=="string"}function Dh(t){return rr(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function pe(t,e){if(!t)throw new Error(e)}function Zs(t,e,s=1/0){if(!(e<=t&&t<=s))throw new RangeError(`Value must be within [${e}, ${s}], got: ${t}`)}function YC(t){!t.isOffline&&t.state!=="running"&&Fp('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let XC=!1,VN=!1;function FN(t){XC=t}function hz(t){Sn(t)&&XC&&!VN&&(VN=!0,Fp("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let QC=console;function fz(...t){QC.log(...t)}function Fp(...t){QC.warn(...t)}function mz(t){return new WH(t)}function pz(t,e,s){return new rz(t,e,s)}const Ys=typeof self=="object"?self:null,gz=Ys&&(Ys.hasOwnProperty("AudioContext")||Ys.hasOwnProperty("webkitAudioContext"));function xz(t,e,s){return pe(Oe(PN),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(Ys==null?void 0:Ys.BaseAudioContext)?Ys==null?void 0:Ys.AudioWorkletNode:PN)(t,e,s)}class bz{constructor(e,s,n,i){this._callback=e,this._type=s,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),s=URL.createObjectURL(e),n=new Worker(s);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var s;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((s=this._worker)===null||s===void 0||s.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function No(t){return lz(t)}function ia(t){return oz(t)}function ff(t){return cz(t)}function Xo(t){return az(t)}function vz(t){return t instanceof MC}function yz(t,e){return t==="value"||No(e)||ia(e)||vz(e)}function oo(t,...e){if(!e.length)return t;const s=e.shift();if(ao(t)&&ao(s))for(const n in s)yz(n,s[n])?t[n]=s[n]:ao(s[n])?(t[n]||Object.assign(t,{[n]:{}}),oo(t[n],s[n])):Object.assign(t,{[n]:s[n]});return oo(t,...e)}function _z(t,e){return t.length===e.length&&t.every((s,n)=>e[n]===s)}function de(t,e,s=[],n){const i={},r=Array.from(e);if(ao(r[0])&&n&&!Reflect.has(r[0],n)&&(Object.keys(r[0]).some(l=>Reflect.has(t,l))||(oo(i,{[n]:r[0]}),s.splice(s.indexOf(n),1),r.shift())),r.length===1&&ao(r[0]))oo(i,r[0]);else for(let a=0;a<s.length;a++)Oe(r[a])&&(i[s[a]]=r[a]);return oo(t,i)}function wz(t){return t.constructor.getDefaults()}function Il(t,e){return Sn(t)?e:t}function en(t,e){return e.forEach(s=>{Reflect.has(t,s)&&delete t[s]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class gr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Ys&&this.toString()===Ys.TONE_DEBUG_CLASS)&&fz(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}gr.version=sC;const i_=1e-6;function sc(t,e){return t>e+i_}function ab(t,e){return sc(t,e)||Fn(t,e)}function Am(t,e){return t+i_<e}function Fn(t,e){return Math.abs(t-e)<i_}function kz(t,e,s){return Math.max(Math.min(t,s),e)}class Tn extends gr{constructor(){super(),this.name="Timeline",this._timeline=[];const e=de(Tn.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(pe(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const s=this._timeline[this.length-1];pe(ab(e.time,s.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const s=this._search(e.time);this._timeline.splice(s+1,0,e)}if(this.length>this.memory){const s=this.length-this.memory;this._timeline.splice(0,s)}return this}remove(e){const s=this._timeline.indexOf(e);return s!==-1&&this._timeline.splice(s,1),this}get(e,s="time"){const n=this._search(e,s);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,s="time"){const n=this._search(e,s);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const s=this._timeline.length;if(s>0&&this._timeline[s-1].time<e)return this._timeline[s-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let s=this._search(e);if(s>=0)if(Fn(this._timeline[s].time,e)){for(let n=s;n>=0&&Fn(this._timeline[n].time,e);n--)s=n;this._timeline=this._timeline.slice(0,s)}else this._timeline=this._timeline.slice(0,s+1);else this._timeline=[]}else this._timeline.length===1&&ab(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const s=this._search(e);return s>=0&&(this._timeline=this._timeline.slice(s+1)),this}previousEvent(e){const s=this._timeline.indexOf(e);return s>0?this._timeline[s-1]:null}_search(e,s="time"){if(this._timeline.length===0)return-1;let n=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][s]<=e)return i-1;for(;n<r;){let a=Math.floor(n+(r-n)/2);const l=this._timeline[a],c=this._timeline[a+1];if(Fn(l[s],e)){for(let u=a;u<this._timeline.length;u++){const d=this._timeline[u];if(Fn(d[s],e))a=u;else break}return a}else{if(Am(l[s],e)&&sc(c[s],e))return a;sc(l[s],e)?r=a:n=a+1}}return-1}_iterate(e,s=0,n=this._timeline.length-1){this._timeline.slice(s,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,s){const n=this._search(e);return n!==-1&&this._iterate(s,0,n),this}forEachAfter(e,s){const n=this._search(e);return this._iterate(s,n+1),this}forEachBetween(e,s,n){let i=this._search(e),r=this._search(s);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===s&&(r-=1),this._iterate(n,i,r)):i===-1&&this._iterate(n,0,r),this}forEachFrom(e,s){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(s,n+1),this}forEachAtTime(e,s){const n=this._search(e);if(n!==-1&&Fn(this._timeline[n].time,e)){let i=n;for(let r=n;r>=0&&Fn(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{s(r)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const JC=[];function Bp(t){JC.push(t)}function Nz(t){JC.forEach(e=>e(t))}const ZC=[];function Up(t){ZC.push(t)}function Sz(t){ZC.forEach(e=>e(t))}class sh extends gr{constructor(){super(...arguments),this.name="Emitter"}on(e,s){return e.split(/\W+/).forEach(i=>{Sn(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(s)}),this}once(e,s){const n=(...i)=>{s(...i),this.off(e,n)};return this.on(e,n),this}off(e,s){return e.split(/\W+/).forEach(i=>{if(Sn(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(Sn(s))this._events[i]=[];else{const r=this._events[i];for(let a=r.length-1;a>=0;a--)r[a]===s&&r.splice(a,1)}}),this}emit(e,...s){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let i=0,r=n.length;i<r;i++)n[i].apply(this,s)}return this}static mixin(e){["on","once","off","emit"].forEach(s=>{const n=Object.getOwnPropertyDescriptor(sh.prototype,s);Object.defineProperty(e.prototype,s,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class eR extends sh{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class nh extends eR{constructor(){var e,s;super(),this.name="Context",this._constants=new Map,this._timeouts=new Tn,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=de(nh.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=mz({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new bz(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((s=arguments[0])===null||s===void 0)&&s.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(Nz(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,s,n){return this._context.createBuffer(e,s,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,s){return this._context.createIIRFilter(e,s)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,s,n){return this._context.createPeriodicWave(e,s,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return pe(Xo(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return pe(Xo(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return pe(Xo(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){pe(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){pe(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){pe(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){pe(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,s){return xz(this.rawContext,e,s)}addAudioWorkletModule(e){return Pt(this,void 0,void 0,function*(){pe(Oe(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Pt(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Xo(this._context)?this._context.resume():Promise.resolve()}close(){return Pt(this,void 0,void 0,function*(){Xo(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&Sz(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const s=this._context.createBuffer(1,128,this._context.sampleRate),n=s.getChannelData(0);for(let r=0;r<n.length;r++)n[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=s,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,s=>{s.callback(),this._timeouts.remove(s)})}setTimeout(e,s){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+s}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(s=>{s.id===e&&this._timeouts.remove(s)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,s){const n=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:n,time:r+s})};return i(),n}}class Tz extends eR{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,s,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,s){return{}}createPanner(){return{}}createPeriodicWave(e,s,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,s){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Pt(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,s){return 0}clearTimeout(e){return this}setInterval(e,s){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function Ge(t,e){on(e)?e.forEach(s=>Ge(t,s)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function r_(t,e){on(e)?e.forEach(s=>r_(t,s)):Object.defineProperty(t,e,{writable:!0})}const et=()=>{};class at extends gr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=et;const e=de(at.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,rr(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:et,onload:et,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Hn().sampleRate}set(e){return e instanceof at?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Pt(this,void 0,void 0,function*(){const s=at.load(e).then(n=>{this.set(n),this.onload(this)});at.downloads.push(s);try{yield s}finally{const n=at.downloads.indexOf(s);at.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const s=on(e)&&e[0].length>0,n=s?e.length:1,i=s?e[0].length:e.length,r=Hn(),a=r.createBuffer(n,i,r.sampleRate),l=!s&&n===1?[e]:e;for(let c=0;c<n;c++)a.copyToChannel(l[c],c);return this._buffer=a,this}toMono(e){if(ir(e))this.fromArray(this.toArray(e));else{let s=new Float32Array(this.length);const n=this.numberOfChannels;for(let i=0;i<n;i++){const r=this.toArray(i);for(let a=0;a<r.length;a++)s[a]+=r[a]}s=s.map(i=>i/n),this.fromArray(s)}return this}toArray(e){if(ir(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const s=[];for(let n=0;n<this.numberOfChannels;n++)s[n]=this.getChannelData(n);return s}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,s=this.duration){pe(this.loaded,"Buffer is not loaded");const n=Math.floor(e*this.sampleRate),i=Math.floor(s*this.sampleRate);pe(n<i,"The start time must be less than the end time");const r=i-n,a=Hn().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let l=0;l<this.numberOfChannels;l++)a.copyToChannel(this.getChannelData(l).subarray(n,i),l);return new at(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new at().fromArray(e)}static fromUrl(e){return Pt(this,void 0,void 0,function*(){return yield new at().load(e)})}static load(e){return Pt(this,void 0,void 0,function*(){const s=at.baseUrl===""||at.baseUrl.endsWith("/")?at.baseUrl:at.baseUrl+"/",n=yield fetch(s+e);if(!n.ok)throw new Error(`could not load url: ${e}`);const i=yield n.arrayBuffer();return yield Hn().decodeAudioData(i)})}static supportsType(e){const s=e.split("."),n=s[s.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return Pt(this,void 0,void 0,function*(){for(yield Promise.resolve();at.downloads.length;)yield at.downloads[0]})}}at.baseUrl="";at.downloads=[];class $p extends nh{constructor(){super({clockSource:"offline",context:ff(arguments[0])?arguments[0]:pz(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:ff(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=ff(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Pt(this,void 0,void 0,function*(){let s=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,s++;const n=Math.floor(this.sampleRate/128);e&&s%n===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Pt(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const s=yield this._context.startRendering();return new at(s)})}close(){return Promise.resolve()}}const tR=new Tz;let Xa=tR;function Hn(){return Xa===tR&&gz&&Ez(new nh),Xa}function Ez(t,e=!1){e&&Xa.dispose(),Xo(t)?Xa=new nh(t):ff(t)?Xa=new $p(t):Xa=t}function Az(){return Xa.resume()}if(Ys&&!Ys.TONE_SILENCE_LOGGING){const e=` * Tone.js v${sC} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function jz(t){return Math.pow(10,t/20)}function Cz(t){return 20*(Math.log(t)/Math.LN10)}function sR(t){return Math.pow(2,t/12)}let Gp=440;function Rz(){return Gp}function Iz(t){Gp=t}function Qa(t){return Math.round(nR(t))}function nR(t){return 69+12*Math.log2(t/Gp)}function iR(t){return Gp*Math.pow(2,(t-69)/12)}class a_ extends gr{constructor(e,s,n){super(),this.defaultUnits="s",this._val=s,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,s)=>{const n=parseInt(e,10),i=s==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const s=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(s)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,s,n)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof a_&&this.fromType(this._val),Sn(this._val))return this._noArg();if(rr(this._val)&&Sn(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(ao(this._val)){let e=0;for(const s in this._val)if(Oe(this._val[s])){const n=this._val[s],i=new this.constructor(this.context,s).valueOf()*n;e+=i}return e}if(Oe(this._units)){const e=this._expressions[this._units],s=this._val.toString().trim().match(e.regexp);return s?e.method.apply(this,s.slice(1)):e.method.call(this,this._val)}else return rr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class zn extends a_{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const s=new zn(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(s))},regexp:/^@(.+)/}})}quantize(e,s=1){const n=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),l=Math.round(i/n)*n-i;return i+l*s}toNotation(){const e=this.toSeconds(),s=["1m"];for(let r=1;r<9;r++){const a=Math.pow(2,r);s.push(a+"n."),s.push(a+"n"),s.push(a+"t")}s.push("0");let n=s[0],i=new zn(this.context,s[0]).toSeconds();return s.forEach(r=>{const a=new zn(this.context,r).toSeconds();Math.abs(a-e)<Math.abs(i-e)&&(n=r,i=a)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let s=this.valueOf()/e;s=parseFloat(s.toFixed(4));const n=Math.floor(s/this._getTimeSignature());let i=s%1*4;s=Math.floor(s)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,s,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return Qa(this.toFrequency())}_now(){return this.context.now()}}class tn extends zn{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Rz()}static set A4(e){Iz(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:tn.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,s){const i=Oz[e.toLowerCase()]+(parseInt(s,10)+1)*12;return this.defaultUnits==="midi"?i:tn.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,s,n){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(e){return new tn(this.context,this.valueOf()*sR(e))}harmonize(e){return e.map(s=>this.transpose(s))}toMidi(){return Qa(this.valueOf())}toNote(){const e=this.toFrequency(),s=Math.log2(e/tn.A4);let n=Math.round(12*s)+57;const i=Math.floor(n/12);return i<0&&(n+=-12*i),Mz[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),s=this.valueOf()/e;return Math.floor(s*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return iR(e)}static ftom(e){return Qa(e)}}const Oz={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Mz=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Au extends zn{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Bs extends gr{constructor(){super();const e=de(Bs.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Hn()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return hz(e),new zn(this.context,e).toSeconds()}toFrequency(e){return new tn(this.context,e).toFrequency()}toTicks(e){return new Au(this.context,e).toTicks()}_getPartialProperties(e){const s=this.get();return Object.keys(s).forEach(n=>{Sn(e[n])&&delete s[n]}),s}get(){const e=wz(this);return Object.keys(e).forEach(s=>{if(Reflect.has(this,s)){const n=this[s];Oe(n)&&Oe(n.value)&&Oe(n.setValueAtTime)?e[s]=n.value:n instanceof Bs?e[s]=n._getPartialProperties(e[s]):on(n)||ir(n)||rr(n)||dz(n)?e[s]=n:delete e[s]}}),e}set(e){return Object.keys(e).forEach(s=>{Reflect.has(this,s)&&Oe(this[s])&&(this[s]&&Oe(this[s].value)&&Oe(this[s].setValueAtTime)?this[s].value!==e[s]&&(this[s].value=e[s]):this[s]instanceof Bs?this[s].set(e[s]):this[s]=e[s])}),this}}class o_ extends Tn{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const s=this.get(e);return s!==null?s.state:this._initial}setStateAtTime(e,s,n){return Zs(s,0),this.add(Object.assign({},n,{state:e,time:s})),this}getLastState(e,s){const n=this._search(s);for(let i=n;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,s){const n=this._search(s);if(n!==-1)for(let i=n;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class Re extends Bs{constructor(){const e=de(Re.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,pe(Oe(e.param)&&(No(e.param)||e.param instanceof Re),"param must be an AudioParam");!No(e.param);)e.param=e.param._param;this._swappable=Oe(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new Tn(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Oe(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Bs.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Oe(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Oe(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,s){return this.units===s}_assertRange(e){return Oe(this.maxValue)&&Oe(this.minValue)&&Zs(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?jz(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Cz(e):e}setValueAtTime(e,s){const n=this.toSeconds(s),i=this._fromType(e);return pe(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(e){const s=Math.max(this.toSeconds(e),0),n=this._events.getAfter(s),i=this._events.get(s);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const a=this._events.getBefore(i.time);let l;a===null?l=this._initialValue:l=a.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,l,i.value,i.constant,s))}else if(n===null)r=i.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let a=i.value;if(i.type==="setTargetAtTime"){const l=this._events.getBefore(i.time);l===null?a=this._initialValue:a=l.value}n.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,a,n.time,n.value,s):r=this._exponentialInterpolate(i.time,a,n.time,n.value,s)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let s=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(s)===0&&(s=this._toType(this._minOutput)),this.setValueAtTime(s,e),this}linearRampToValueAtTime(e,s){const n=this._fromType(e),i=this.toSeconds(s);return pe(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(e,s){let n=this._fromType(e);n=Fn(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(s);return pe(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(s)),this}linearRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(s)),this}targetRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,s),this}exponentialApproachValueAtTime(e,s,n){s=this.toSeconds(s),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,s,i),this.cancelAndHoldAtTime(s+n*.9),this.linearRampToValueAtTime(e,s+n),this}setTargetAtTime(e,s,n){const i=this._fromType(e);pe(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(s);return this._assertRange(i),pe(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(e,s,n,i=1){n=this.toSeconds(n),s=this.toSeconds(s);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),s);const a=n/(e.length-1);for(let l=1;l<e.length;l++){const c=this._fromType(e[l])*i;this.linearRampToValueAtTime(this._toType(c),s+l*a)}return this}cancelScheduledValues(e){const s=this.toSeconds(e);return pe(isFinite(s),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(s),this._param.cancelScheduledValues(s),this.log(this.units,"cancelScheduledValues",s),this}cancelAndHoldAtTime(e){const s=this.toSeconds(e),n=this._fromType(this.getValueAtTime(s));pe(isFinite(s),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",s,"value="+n);const i=this._events.get(s),r=this._events.getAfter(s);return i&&Fn(i.time,s)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(s),this._events.cancel(s+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),s):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),s)),this._events.add({time:s,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,s),this}rampTo(e,s=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,s,n):this.linearRampTo(e,s,n),this}apply(e){const s=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(s),s);const n=this._events.get(s);if(n&&n.type==="setTargetAtTime"){const i=this._events.getAfter(n.time),r=i?i.time:s+2,a=(r-s)/10;for(let l=s;l<r;l+=a)e.linearRampToValueAtTime(this.getValueAtTime(l),l)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){pe(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const s=this.input;return s.disconnect(this._param),this.apply(e),this._param=e,s.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,s,n,i,r){return n+(s-n)*Math.exp(-(r-e)/i)}_linearInterpolate(e,s,n,i,r){return s+(i-s)*((r-e)/(n-e))}_exponentialInterpolate(e,s,n,i,r){return s*Math.pow(i/s,(r-e)/(n-e))}}class he extends Bs{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Oe(this.input)?No(this.input)||this.input instanceof Re?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Oe(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Oe(e)&&(e instanceof he||ia(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();pe(e.length>0,"ToneAudioNode does not have any internal nodes");const s=e[0];return{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelInterpretation:e}))}connect(e,s=0,n=0){return ar(this,e,s,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Fp("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,s=0,n=0){return rR(this,e,s,n),this}chain(...e){return hd(this,...e),this}fan(...e){return e.forEach(s=>this.connect(s)),this}dispose(){return super.dispose(),Oe(this.input)&&(this.input instanceof he?this.input.dispose():ia(this.input)&&this.input.disconnect()),Oe(this.output)&&(this.output instanceof he?this.output.dispose():ia(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function hd(...t){const e=t.shift();t.reduce((s,n)=>(s instanceof he?s.connect(n):ia(s)&&ar(s,n),n),e)}function ar(t,e,s=0,n=0){for(pe(Oe(t),"Cannot connect from undefined node"),pe(Oe(e),"Cannot connect to undefined node"),(e instanceof he||ia(e))&&pe(e.numberOfInputs>0,"Cannot connect to node with no inputs"),pe(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof he||e instanceof Re;)Oe(e.input)&&(e=e.input);for(;t instanceof he;)Oe(t.output)&&(t=t.output);No(e)?t.connect(e,s):t.connect(e,s,n)}function rR(t,e,s=0,n=0){if(Oe(e))for(;e instanceof he;)e=e.input;for(;!ia(t);)Oe(t.output)&&(t=t.output);No(e)?t.disconnect(e,s):ia(e)?t.disconnect(e,s,n):t.disconnect()}class We extends he{constructor(){const e=de(We.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Re({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Ge(this,"gain")}static getDefaults(){return Object.assign(he.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class nc extends he{constructor(e){super(e),this.onended=et,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new We({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(s){const n=this.toSeconds(s);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(he.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:et})}_startGain(e,s=1){pe(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(s,e+n):this._gainNode.gain.exponentialApproachValueAtTime(s,e,n)):this._gainNode.gain.setValueAtTime(s,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){pe(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const s=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+s,this._stopTime=Math.max(this._stopTime,this.now()),s>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,s,e):this._gainNode.gain.targetRampTo(0,s,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?s*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==et&&(this.onended(this),this.onended=et,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),pe(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=et,this}}class l_ extends nc{constructor(){const e=de(l_.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),ar(this._source,this._gainNode),this.offset=new Re({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(nc.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._source.start(s),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class qe extends he{constructor(){const e=de(qe.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new l_({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(he.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,s=0,n=0){return Hp(this,e,s,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,s){return this._param.setValueAtTime(e,s),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,s){return this._param.linearRampToValueAtTime(e,s),this}exponentialRampToValueAtTime(e,s){return this._param.exponentialRampToValueAtTime(e,s),this}exponentialRampTo(e,s,n){return this._param.exponentialRampTo(e,s,n),this}linearRampTo(e,s,n){return this._param.linearRampTo(e,s,n),this}targetRampTo(e,s,n){return this._param.targetRampTo(e,s,n),this}exponentialApproachValueAtTime(e,s,n){return this._param.exponentialApproachValueAtTime(e,s,n),this}setTargetAtTime(e,s,n){return this._param.setTargetAtTime(e,s,n),this}setValueCurveAtTime(e,s,n,i){return this._param.setValueCurveAtTime(e,s,n,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,s,n){return this._param.rampTo(e,s,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Hp(t,e,s,n){(e instanceof Re||No(e)||e instanceof qe&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof qe&&(e.overridden=!0)),ar(t,e,s,n)}class c_ extends Re{constructor(){const e=de(c_.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new Tn(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Re.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,s,n){s=this.toSeconds(s),this.setRampPoint(s);const i=this._fromType(e),r=this._events.get(s),a=Math.round(Math.max(1/n,1));for(let l=0;l<=a;l++){const c=n*l+s,u=this._exponentialApproach(r.time,r.value,i,n,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}setValueAtTime(e,s){const n=this.toSeconds(s);super.setValueAtTime(e,s);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,s){const n=this.toSeconds(s);super.linearRampToValueAtTime(e,s);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,s){s=this.toSeconds(s);const n=this._fromType(e),i=this._events.get(s),r=Math.round(Math.max((s-i.time)*10,1)),a=(s-i.time)/r;for(let l=0;l<=r;l++){const c=a*l+i.time,u=this._exponentialInterpolate(i.time,i.value,s,n,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}_getTicksUntilEvent(e,s){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Sn(e.ticks)){const a=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(a,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(s));const r=this._events.get(s);return r&&r.time===s&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(s-this.sampleTime))),.5*(s-e.time)*(n+i)+e.ticks}getTicksAtTime(e){const s=this.toSeconds(e),n=this._events.get(s);return Math.max(this._getTicksUntilEvent(n,s),0)}getDurationOfTicks(e,s){const n=this.toSeconds(s),i=this.getTicksAtTime(s);return this.getTimeOfTick(i+e)-n}getTimeOfTick(e){const s=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(s&&s.ticks===e)return s.time;if(s&&n&&n.type==="linearRampToValueAtTime"&&s.value!==n.value){const i=this._fromType(this.getValueAtTime(s.time)),a=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-s.time),l=Math.sqrt(Math.pow(i,2)-2*a*(s.ticks-e)),c=(-i+l)/a,u=(-i-l)/a;return(c>0?c:u)+s.time}else return s?s.value===0?1/0:s.time+(e-s.ticks)/s.value:e/this._initialValue}ticksToTime(e,s){return this.getDurationOfTicks(e,s)}timeToTicks(e,s){const n=this.toSeconds(s),i=this.toSeconds(e),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const s=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(s,0)}}class u_ extends qe{constructor(){const e=de(u_.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new c_({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(qe.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,s){return this._param.ticksToTime(e,s)}timeToTicks(e,s){return this._param.timeToTicks(e,s)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,s){return this._param.getDurationOfTicks(e,s)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class d_ extends Bs{constructor(){const e=de(d_.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new o_,this._tickOffset=new Tn,this._ticksAtTime=new Tn,this._secondsAtTime=new Tn,this.frequency=new u_({context:this.context,units:e.units,value:e.frequency}),Ge(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Bs.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,s){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),Oe(s)&&this.setTicksAtTime(s,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="stopped"){const n=this._state.get(s);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this.setTicksAtTime(0,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}pause(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&(this._state.setStateAtTime("paused",s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const s=this.toSeconds(e),n=this._state.getLastState("stopped",s),i=this._ticksAtTime.get(s),r={state:"paused",time:s};this._state.add(r);let a=i||n,l=i?i.ticks:0,c=null;return this._state.forEachBetween(a.time,s+this.sampleTime,u=>{let d=a.time;const h=this._tickOffset.get(u.time);h&&h.time>=a.time&&(l=h.ticks,d=h.time),a.state==="started"&&u.state!=="started"&&(l+=this.frequency.getTicksAtTime(u.time)-this.frequency.getTicksAtTime(d),u.time!==r.time&&(c={state:u.state,time:u.time,ticks:l})),a=u}),this._state.remove(r),c&&this._ticksAtTime.add(c),l}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const s=this.now(),n=this.frequency.timeToTicks(e,s);this.setTicksAtTime(n,s)}getSecondsAtTime(e){e=this.toSeconds(e);const s=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const i=this._secondsAtTime.get(e);let r=i||s,a=i?i.seconds:0,l=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let u=r.time;const d=this._tickOffset.get(c.time);d&&d.time>=r.time&&(a=d.seconds,u=d.time),r.state==="started"&&c.state!=="started"&&(a+=c.time-u,c.time!==n.time&&(l={state:c.state,time:c.time,seconds:a})),r=c}),this._state.remove(n),l&&this._secondsAtTime.add(l),a}setTicksAtTime(e,s){return s=this.toSeconds(s),this._tickOffset.cancel(s),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,s),ticks:e,time:s}),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,s=this.now()){const n=this._tickOffset.get(s),i=this._state.get(s),r=Math.max(n.time,i.time),a=this.frequency.getTicksAtTime(r)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,s,n){let i=this._state.get(e);this._state.forEachBetween(e,s,a=>{i&&i.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),a.time-this.sampleTime,n),i=a});let r=null;if(i&&i.state==="started"){const a=Math.max(i.time,e),l=this.frequency.getTicksAtTime(a),c=this.frequency.getTicksAtTime(i.time),u=l-c;let d=Math.ceil(u)-u;d=Fn(d,1)?0:d;let h=this.frequency.getTimeOfTick(l+d);for(;h<s;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(f){r=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}let aR=class oR extends Bs{constructor(){const e=de(oR.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=et,this._lastUpdate=0,this._state=new o_("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new d_({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ge(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Bs.getDefaults(),{callback:et,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,s){YC(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,s),n<this._lastUpdate&&this.emit("start",n,s)),this}stop(e){const s=this.toSeconds(e);return this.log("stop",s),this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._tickSource.stop(s),s<this._lastUpdate&&this.emit("stop",s),this}pause(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&(this._state.setStateAtTime("paused",s),this._tickSource.pause(s),s<this._lastUpdate&&this.emit("pause",s)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,s){return this._tickSource.setTicksAtTime(e,s),this}getTimeOfTick(e,s=this.now()){return this._tickSource.getTimeOfTick(e,s)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,s){const n=this.toSeconds(s),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+e,n)}_loop(){const e=this._lastUpdate,s=this.now();this._lastUpdate=s,this.log("loop",e,s),e!==s&&(this._state.forEachBetween(e,s,n=>{switch(n.state){case"started":const i=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,i);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,s,(n,i)=>{this.callback(n,i)}))}getStateAtTime(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}};sh.mixin(aR);class zi extends he{constructor(){const e=de(zi.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new We({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Ge(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(he.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class h_ extends he{constructor(){const e=de(h_.getDefaults(),arguments);super(e),this.name="Destination",this.input=new zi({context:this.context}),this.output=new We({context:this.context}),this.volume=this.input.volume,hd(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(he.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),hd(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Bp(t=>{t.destination=new h_({context:t})});Up(t=>{t.destination.dispose()});class Dz extends he{constructor(){super(...arguments),this.name="Listener",this.positionX=new Re({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Re({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Re({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Re({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Re({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Re({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Re({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Re({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Re({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(he.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Bp(t=>{t.listener=new Dz({context:t})});Up(t=>{t.listener.dispose()});class f_ extends gr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=de(f_.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(s=>{this._loadingCount++;const n=e.urls[s];this.add(s,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:et,onload:et,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return pe(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,s])=>s.loaded)}add(e,s,n=et,i=et){return rr(s)?(this.baseUrl&&s.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new at(this.baseUrl+s,n,i))):this._buffers.set(e.toString(),new at(s,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class jm extends tn{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return Qa(super._frequencyToUnits(e))}_ticksToUnits(e){return Qa(super._ticksToUnits(e))}_beatsToUnits(e){return Qa(super._beatsToUnits(e))}_secondsToUnits(e){return Qa(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return iR(this.toMidi())}transpose(e){return new jm(this.context,this.toMidi()+e)}}class hl extends Au{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Lz extends Bs{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Tn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,s){return this._events.add({callback:e,time:this.toSeconds(s)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,s=>{e-s.time<=this.expiration&&s.callback(),this._events.remove(s)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Bp(t=>{t.draw=new Lz({context:t})});Up(t=>{t.draw.dispose()});class Pz extends gr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){pe(Oe(e.time),"Events must have a time property"),pe(Oe(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let s=new Vz(e.time,e.time+e.duration,e);for(this._root===null?this._root=s:this._root.insert(s),this._length++;s!==null;)s.updateHeight(),s.updateMax(),this._rebalance(s),s=s.parent;return this}remove(e){if(this._root!==null){const s=[];this._root.search(e.time,s);for(const n of s)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,s=>this.remove(s)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,s){e.parent!==null?(e.isLeftChild()?e.parent.left=s:e.parent.right=s,this._rebalance(e.parent)):this._setRoot(s)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const s=e.getBalance();let n,i=null;if(s>0)if(e.left.right===null)n=e.left,n.right=e.right,i=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,i=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,i=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,i=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const s=e.parent,n=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),s!==null?n?s.left=i:s.right=i:this._setRoot(i)}_rotateRight(e){const s=e.parent,n=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),s!==null?n?s.left=i:s.right=i:this._setRoot(i)}_rebalance(e){const s=e.getBalance();s>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):s<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const s=[];if(this._root.search(e,s),s.length>0){let n=s[0];for(let i=1;i<s.length;i++)s[i].low>n.low&&(n=s[i]);return n.event}}return null}forEach(e){if(this._root!==null){const s=[];this._root.traverse(n=>s.push(n)),s.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,s){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(i=>{i.event&&s(i.event)})}return this}forEachFrom(e,s){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(i=>{i.event&&s(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Vz{constructor(e,s,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=s,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,s){e>this.max||(this.left!==null&&this.left.search(e,s),this.low<=e&&this.high>e&&s.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,s))}searchAfter(e,s){this.low>=e&&(s.push(this),this.left!==null&&this.left.searchAfter(e,s)),this.right!==null&&this.right.searchAfter(e,s)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Fz extends gr{constructor(e){super(),this.name="TimelineValue",this._timeline=new Tn({memory:10}),this._initialValue=e}set(e,s){return this._timeline.add({value:e,time:s}),this}get(e){const s=this._timeline.get(e);return s?s.value:this._initialValue}}class mi extends he{constructor(){super(de(mi.getDefaults(),arguments,["context"]))}connect(e,s=0,n=0){return Hp(this,e,s,n),this}}class Oc extends mi{constructor(){const e=de(Oc.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,on(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):uz(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(qe.getDefaults(),{length:1024})}setMap(e,s=1024){const n=new Float32Array(s);for(let i=0,r=s;i<r;i++){const a=i/(r-1)*2-1;n[i]=e(a,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const s=["none","2x","4x"].some(n=>n.includes(e));pe(s,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class zp extends mi{constructor(){const e=de(zp.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new Oc({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(mi.getDefaults(),{value:1})}_expFunc(e){return s=>Math.pow(Math.abs(s),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class ga{constructor(e,s){this.id=ga._eventId++,this._remainderTime=0;const n=Object.assign(ga.getDefaults(),s);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:et,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const s=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*s),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}ga._eventId=0;class m_ extends ga{constructor(e,s){super(e,s),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(m_.getDefaults(),s);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ga.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Am(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new hl(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Am(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new hl(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const s=this.transport.getTicksAtTime(e);sc(s,this.time)&&(this._nextTick=this.floatTime+Math.ceil((s-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class qp extends Bs{constructor(){const e=de(qp.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Fz(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Tn,this._repeatedEvents=new Pz,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new aR({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),Ge(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Bs.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,s){if(this._loop.get(e)&&s>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),s=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&s%this._ppq!==0&&s%(this._swingTicks*2)!==0){const n=s%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(n*Math.PI)*this._swingAmount;e+=new hl(this.context,this._swingTicks*2/3).toSeconds()*i}FN(!0),this._timeline.forEachAtTime(s,n=>n.invoke(e)),FN(!1)}schedule(e,s){const n=new ga(this,{callback:e,time:new Au(this.context,s).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,s,n,i=1/0){const r=new m_(this,{callback:e,duration:new zn(this.context,i).toTicks(),interval:new zn(this.context,s).toTicks(),time:new Au(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,s){const n=new ga(this,{callback:e,once:!0,time:new Au(this.context,s).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const s=this._scheduledEvents[e.toString()];s.timeline.remove(s.event),s.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,s){return this._scheduledEvents[e.id.toString()]={event:e,timeline:s},s.add(e),e.id}cancel(e=0){const s=this.toTicks(e);return this._timeline.forEachFrom(s,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(s,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,s)=>{s=new hl(this.context,s).toSeconds(),this.emit("start",e,s)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,s){this.context.resume();let n;return Oe(s)&&(n=this.toTicks(s)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){on(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new zn(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new zn(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new hl(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),s=this._clock.getTicksAtTime(e);return new hl(this.context,s).toBarsBeatsSixteenths()}set position(e){const s=this.toTicks(e);this.ticks=s}get seconds(){return this._clock.seconds}set seconds(e){const s=this.now(),n=this._clock.frequency.timeToTicks(e,s);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const s=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(s),i=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,s),r=s+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",s),this._clock.setTicksAtTime(e,s)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const s=this.now(),n=this.getTicksAtTime(s),i=e-n%e;return this._clock.nextTickTime(i,s)}}syncSignal(e,s){const n=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(n)/this.PPQ),a=[];if(e.units==="time"){const c=.015625/r,u=new We(c),d=new zp(-1),h=new We(c);i.chain(u,d,h),i=h,r=1/r,a=[u,d,h]}s||(e.getValueAtTime(n)!==0?s=e.getValueAtTime(n)/r:s=0);const l=new We(s);return i.connect(l),l.connect(e._param),a.push(l),this._syncedSignals.push({initial:e.value,nodes:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let s=this._syncedSignals.length-1;s>=0;s--){const n=this._syncedSignals[s];n.signal===e&&(n.nodes.forEach(i=>i.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(s,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),r_(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}sh.mixin(qp);Bp(t=>{t.transport=new qp({context:t})});Up(t=>{t.transport.dispose()});class es extends he{constructor(e){super(e),this.input=void 0,this._state=new o_("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=et,this._syncedStop=et,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new zi({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Ge(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(he.getDefaults(),{mute:!1,onstop:et,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,s,n){let i=Sn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")pe(sc(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,s,n);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Il(s,0)),r.duration=n?this.toSeconds(n):void 0);const a=this.context.transport.schedule(l=>{this._start(l,s,n)},i);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else YC(this.context),this._start(i,s,n);return this}stop(e){let s=Sn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),this._state.getValueAtTime(s)==="started"||Oe(this._state.getNextState("started",s))){if(this.log("stop",s),!this._synced)this._stop(s);else{const n=this.context.transport.schedule(this._stop.bind(this),s);this._scheduled.push(n)}this._state.cancel(s),this._state.setStateAtTime("stopped",s)}return this}restart(e,s,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,s,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,s)=>{if(sc(s,0)){const n=this._state.get(s);if(n&&n.state==="started"&&n.time!==s){const i=s-this.toSeconds(n.time);let r;n.duration&&(r=this.toSeconds(n.duration)-i),this._start(e,this.toSeconds(n.offset)+i,r)}}},this._syncedStop=e=>{const s=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(s)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=et,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ih extends nc{constructor(){const e=de(ih.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,ar(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Re({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new at(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(nc.getDefaults(),{url:new at,loop:!1,loopEnd:0,loopStart:0,onload:et,onerror:et,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,s,n,i=1){pe(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?s=Il(s,this.loopStart):s=Il(s,0);let a=Math.max(this.toSeconds(s),0);if(this.loop){const l=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),u=l-c;ab(a,l)&&(a=(a-c)%u+c),Fn(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Am(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,a)),Oe(n)){let l=this.toSeconds(n);l=Math.max(l,0),this.stop(r+l)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class xa extends es{constructor(){const e=de(xa.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(es.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(pe(e in BN,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const s=this.now();this._stop(s),this._start(s)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const s=BN[this._type];this._source=new ih({url:s,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(s.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const zo=44100*5,cg=2,Ei={brown:null,pink:null,white:null},BN={get brown(){if(!Ei.brown){const t=[];for(let e=0;e<cg;e++){const s=new Float32Array(zo);t[e]=s;let n=0;for(let i=0;i<zo;i++){const r=Math.random()*2-1;s[i]=(n+.02*r)/1.02,n=s[i],s[i]*=3.5}}Ei.brown=new at().fromArray(t)}return Ei.brown},get pink(){if(!Ei.pink){const t=[];for(let e=0;e<cg;e++){const s=new Float32Array(zo);t[e]=s;let n,i,r,a,l,c,u;n=i=r=a=l=c=u=0;for(let d=0;d<zo;d++){const h=Math.random()*2-1;n=.99886*n+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,a=.8665*a+h*.3104856,l=.55*l+h*.5329522,c=-.7616*c-h*.016898,s[d]=n+i+r+a+l+c+u+h*.5362,s[d]*=.11,u=h*.115926}}Ei.pink=new at().fromArray(t)}return Ei.pink},get white(){if(!Ei.white){const t=[];for(let e=0;e<cg;e++){const s=new Float32Array(zo);t[e]=s;for(let n=0;n<zo;n++)s[n]=Math.random()*2-1}Ei.white=new at().fromArray(t)}return Ei.white}};function Fo(t,e){return Pt(this,void 0,void 0,function*(){const s=e/t.context.sampleRate,n=new $p(1,s,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/s,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class p_ extends nc{constructor(){const e=de(p_.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],ar(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Re({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Re({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Ge(this,["frequency","detune"])}static getDefaults(){return Object.assign(nc.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._oscillator.start(s),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Mt extends es{constructor(){const e=de(Mt.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new qe({context:this.context,units:"frequency",value:e.frequency}),Ge(this,"frequency"),this.detune=new qe({context:this.context,units:"cents",value:e.detune}),Ge(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const s=this.toSeconds(e),n=new p_({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(s)}_stop(e){const s=this.toSeconds(e);this._oscillator&&this._oscillator.stop(s)}_restart(e){const s=this.toSeconds(e);return this.log("restart",s),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(s),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Mt._periodicWaveCache.find(s=>s.phase===this._phase&&_z(s.partials,this._partials));{const e=Mt._periodicWaveCache.find(s=>s.type===this._type&&s.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const s=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&s)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(Oe(n)){const{partials:i,wave:r}=n;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),a=this.context.createPeriodicWave(i,r);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Mt._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Mt._periodicWaveCache.length>100&&Mt._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Zs(e,0);let s=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(s=n[1]),this._type!=="custom")e===0?this.type=s:this.type=s+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,a)=>i[a]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,s){let i=2048;const r=new Float32Array(i),a=new Float32Array(i);let l=1;if(e==="custom"){if(l=this._partials.length+1,this._partialCount=this._partials.length,i=l,this._partials.length===0)return[r,a]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(l=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],l=Math.max(l,2),i=l):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const u=2/(c*Math.PI);let d;switch(e){case"sine":d=c<=l?1:0,this._partials[c-1]=d;break;case"square":d=c&1?2*u:0,this._partials[c-1]=d;break;case"sawtooth":d=u*(c&1?1:-1),this._partials[c-1]=d;break;case"triangle":c&1?d=2*(u*u)*(c-1>>1&1?-1:1):d=0,this._partials[c-1]=d;break;case"custom":d=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}d!==0?(r[c]=-d*Math.sin(s*c),a[c]=d*Math.cos(s*c)):(r[c]=0,a[c]=0)}return[r,a]}_inverseFFT(e,s,n){let i=0;const r=e.length;for(let a=0;a<r;a++)i+=e[a]*Math.cos(a*n)+s[a]*Math.sin(a*n);return i}getInitialValue(){const[e,s]=this._getRealImaginary(this._type,0);let n=0;const i=Math.PI*2,r=32;for(let a=0;a<r;a++)n=Math.max(this._inverseFFT(e,s,a/r*i),n);return kz(-this._inverseFFT(e,s,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Mt._periodicWaveCache=[];class lR extends mi{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Oc({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class or extends qe{constructor(){const e=de(or.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new We({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(qe.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Kp extends es{constructor(){const e=de(Kp.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new lR({context:this.context}),this._modulationNode=new We({context:this.context}),this._carrier=new Mt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Mt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new or({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),Ge(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Mt.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Wp extends es{constructor(){const e=de(Wp.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new We({context:this.context,gain:0}),this._carrier=new Mt({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new qe({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Mt({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new or({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new or({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),Ge(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Mt.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class rh extends es{constructor(){const e=de(rh.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new We({context:this.context,gain:0}),this._thresh=new Oc({context:this.context,mapping:s=>s<=0?-1:1}),this.width=new qe({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Mt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),Ge(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Yp extends es{constructor(){const e=de(Yp.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new qe({context:this.context,units:"frequency",value:e.frequency}),this.detune=new qe({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,Ge(this,["frequency","detune"])}static getDefaults(){return Object.assign(Mt.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(s=>s.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(s=>s.stop(e))}_restart(e){this._forEach(s=>s.restart(e))}_forEach(e){for(let s=0;s<this._oscillators.length;s++)e(this._oscillators[s],s)}get type(){return this._type}set type(e){this._type=e,this._forEach(s=>s.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const s=-e/2,n=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=s+n*r)}}get count(){return this._oscillators.length}set count(e){if(Zs(e,1),this._oscillators.length!==e){this._forEach(s=>s.dispose()),this._oscillators=[];for(let s=0;s<e;s++){const n=new Mt({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+s/e*360,partialCount:this._partialCount,onstop:s===0?()=>this.onstop(this):et});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[s]=n}this.spread=this._spread,this.state==="started"&&this._forEach(s=>s.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((s,n)=>s.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(s=>s.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(s=>s.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(s=>s.partialCount=e),this._type=this._oscillators[0].type}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Xp extends es{constructor(){const e=de(Xp.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new or({context:this.context,value:2}),this._pulse=new rh({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Mt({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),Ge(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const UN={am:Kp,fat:Yp,fm:Wp,oscillator:Mt,pulse:rh,pwm:Xp};class ba extends es{constructor(){const e=de(ba.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new qe({context:this.context,units:"frequency",value:e.frequency}),this.detune=new qe({context:this.context,units:"cents",value:e.detune}),Ge(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Mt.getDefaults(),Wp.getDefaults(),Kp.getDefaults(),Yp.getDefaults(),rh.getDefaults(),Xp.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(s=>this._sourceType===s)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const s=UN[e],n=this.now();if(this._oscillator){const i=this._oscillator;i.stop(n),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new s({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let s="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(s=this._oscillator.type),e==="fm"?this.type="fm"+s:e==="am"?this.type="am"+s:e==="fat"?this.type="fat"+s:e==="oscillator"?this.type=s:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,s){return e instanceof UN[s]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&ir(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&ir(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&rr(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return Pt(this,arguments,void 0,function*(e=1024){return Fo(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class g_ extends qe{constructor(){super(de(g_.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new We({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,hd(this._constantSource,this._sum)}static getDefaults(){return Object.assign(qe.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}let cR=class uR extends mi{constructor(){const e=de(uR.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new or({context:this.context,value:e.max-e.min}),this._add=this.output=new g_({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(mi.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}};class x_ extends mi{constructor(){super(de(x_.getDefaults(),arguments)),this.name="Zero",this._gain=new We({context:this.context}),this.output=this._gain,this.input=void 0,ar(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),rR(this.context.getConstant(0),this._gain),this}}class Ol extends he{constructor(){const e=de(Ol.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Re.prototype._fromType,this._toType=Re.prototype._toType,this._is=Re.prototype._is,this._clampValue=Re.prototype._clampValue,this._oscillator=new Mt(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new We({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new qe({context:this.context,units:"audioRange",value:0}),this._zeros=new x_({context:this.context}),this._a2g=new lR({context:this.context}),this._scaler=this.output=new cR({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ge(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Mt.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const s=this.min,n=this.max;this._units=e,this.min=s,this.max=n}get state(){return this._oscillator.state}connect(e,s,n){return(e instanceof Re||e instanceof qe)&&(this.convert=e.convert,this.units=e.units),Hp(this,e,s,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function dR(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(r){Zs(r,t,e),s.set(this,r)}})}}function xr(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(r){Zs(this.toSeconds(r),t,e),s.set(this,r)}})}}class Qp extends es{constructor(){const e=de(Qp.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new at({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(es.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:et,onerror:et,playbackRate:1,reverse:!1})}load(e){return Pt(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=et){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,s,n){return super.start(e,s,n),this}_start(e,s,n){this._loop?s=Il(s,this._loopStart):s=Il(s,0);const i=this.toSeconds(s),r=n;n=Il(n,Math.max(this._buffer.duration-i,0));let a=this.toSeconds(n);a=a/this._playbackRate,e=this.toSeconds(e);const l=new ih({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(l),this._loop&&Sn(r)?l.start(e,i):l.start(e,i,a-this.toSeconds(this.fadeOut))}_stop(e){const s=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(s))}restart(e,s,n){return super.restart(e,s,n),this}_restart(e,s,n){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,s,n)}seek(e,s){const n=this.toSeconds(s);if(this._state.getValueAtTime(n)==="started"){const i=this.toSeconds(e);this._stop(n),this._start(n,i)}return this}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Zs(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Zs(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(s=>{s.loop=e}),e)){const s=this._state.getNextState("stopped",this.now());s&&this._state.cancel(s.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const s=this.now(),n=this._state.getNextState("stopped",s);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,s)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}ei([xr(0)],Qp.prototype,"fadeIn",void 0);ei([xr(0)],Qp.prototype,"fadeOut",void 0);class Bz extends mi{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Oc({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Hs extends he{constructor(){const e=de(Hs.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new qe({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(he.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,s){if(rr(e))return e;{let n;for(n in Lh)if(Lh[n][s]===e)return n;return e}}_setCurve(e,s,n){if(rr(n)&&Reflect.has(Lh,n)){const i=Lh[n];ao(i)?e!=="_decayCurve"&&(this[e]=i[s]):this[e]=i}else if(on(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,s=1){this.log("triggerAttack",e,s),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0){const l=1/i;i=(1-a)/l}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(s,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(s,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(s,i,e);else{this._sig.cancelAndHoldAtTime(e);let l=this._attackCurve;for(let c=1;c<l.length;c++)if(l[c-1]<=a&&a<=l[c]){l=this._attackCurve.slice(c),l[0]=a;break}this._sig.setValueCurveAtTime(l,e,i,s)}if(r&&this.sustain<1){const l=s*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(l,r+c):this._sig.exponentialApproachValueAtTime(l,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const s=this.getValueAtTime(e);if(s>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(pe(on(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,s))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,s,n=1){return s=this.toSeconds(s),this.triggerAttack(s,n),this.triggerRelease(s+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,s=0,n=0){return Hp(this,e,s,n),this}asArray(){return Pt(this,arguments,void 0,function*(e=1024){const s=e/this.context.sampleRate,n=new $p(1,s,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),a=r*.1,l=r+a,c=new this.constructor(Object.assign(this.get(),{attack:s*this.toSeconds(this.attack)/l,decay:s*this.toSeconds(this.decay)/l,release:s*this.toSeconds(this.release)/l,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(s*(i+a)/l,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}ei([xr(0)],Hs.prototype,"attack",void 0);ei([xr(0)],Hs.prototype,"decay",void 0);ei([dR(0,1)],Hs.prototype,"sustain",void 0);ei([xr(0)],Hs.prototype,"release",void 0);const Lh=(()=>{let e,s;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[],r=6.4;for(e=0;e<127;e++){s=e/127;const f=Math.sin(s*(Math.PI*2)*r-Math.PI/2)+1;i[e]=f/10+s*.83}i[127]=1;const a=[],l=5;for(e=0;e<128;e++)a[e]=Math.ceil(e/127*l)/l;const c=[];for(e=0;e<128;e++)s=e/127,c[e]=.5*(1-Math.cos(Math.PI*s));const u=[];for(e=0;e<128;e++){s=e/127;const f=Math.pow(s,3)*4+.2,m=Math.cos(f*Math.PI*2*s);u[e]=Math.abs(m*(1-s))}function d(f){const m=new Array(f.length);for(let b=0;b<f.length;b++)m[b]=1-f[b];return m}function h(f){return f.slice(0).reverse()}return{bounce:{In:d(u),Out:u},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:d(i)},sine:{In:c,Out:d(c)},step:{In:a,Out:d(a)}}})();class pi extends he{constructor(){const e=de(pi.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=s=>this._original_triggerRelease(s),this._volume=this.output=new zi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,Ge(this,"volume")}static getDefaults(){return Object.assign(he.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,s){const n=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[s],a=this.context.transport.schedule(l=>{i[s]=l,n.apply(this,i)},r);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,s,n,i){const r=this.toSeconds(n),a=this.toSeconds(s);return this.triggerAttack(e,r,i),this.triggerRelease(r+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Qn extends pi{constructor(){const e=de(Qn.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(pi.getDefaults(),{detune:0,onsilence:et,portamento:0})}triggerAttack(e,s,n=1){this.log("triggerAttack",e,s,n);const i=this.toSeconds(s);return this._triggerEnvelopeAttack(i,n),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const s=this.toSeconds(e);return this._triggerEnvelopeRelease(s),this}setNote(e,s){const n=this.toSeconds(s),i=e instanceof tn?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,n)}else this.frequency.setValueAtTime(i,n);return this}}ei([xr(0)],Qn.prototype,"portamento",void 0);class ah extends Hs{constructor(){super(de(ah.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new We({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class lr extends Qn{constructor(){const e=de(lr.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new ba(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new ah(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),Ge(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{envelope:Object.assign(en(Hs.getDefaults(),Object.keys(he.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(en(ba.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,s){if(this.envelope.triggerAttack(e,s),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Cm extends Qn{constructor(){const e=de(Cm.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new lr({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new lr({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new qe({context:this.context,units:"frequency"}),this.detune=new qe({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new or({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new We({context:this.context,gain:0}),Ge(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{harmonicity:3,oscillator:Object.assign(en(ba.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(en(Hs.getDefaults(),Object.keys(he.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(en(ba.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(en(Hs.getDefaults(),Object.keys(he.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,s){this._carrier._triggerEnvelopeAttack(e,s),this._modulator._triggerEnvelopeAttack(e,s)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Rm extends he{constructor(){const e=de(Rm.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Re({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Re({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Re({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Re({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(he.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){pe(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const s=new Float32Array(e);for(let a=0;a<e;a++){const c=Math.pow(a/e,2)*19980+20;s[a]=c}const n=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(s,n,i),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class ni extends he{constructor(){const e=de(ni.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new We({context:this.context}),this.output=new We({context:this.context}),this._filters=[],this._filters=[],this.Q=new qe({context:this.context,units:"positive",value:e.Q}),this.frequency=new qe({context:this.context,units:"frequency",value:e.frequency}),this.detune=new qe({context:this.context,units:"cents",value:e.detune}),this.gain=new qe({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Ge(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(he.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){pe(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(n=>n.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const s=ir(e)?e:parseInt(e,10),n=[-12,-24,-48,-96];let i=n.indexOf(s);pe(i!==-1,`rolloff can only be ${n.join(", ")}`),i+=1,this._rolloff=s,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const a=new Rm({context:this.context});a.type=this._type,this.frequency.connect(a.frequency),this.detune.connect(a.detune),this.Q.connect(a.Q),this.gain.connect(a.gain),this._filters[r]=a}this._internalChannels=this._filters,hd(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const s=new Rm({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{s.getFrequencyResponse(e).forEach((r,a)=>n[a]*=r)}),s.dispose(),n}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),r_(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Im extends Hs{constructor(){const e=de(Im.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="FrequencyEnvelope",this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new zp({context:this.context,value:e.exponent}),this._scale=this.output=new cR({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Hs.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const s=this.toFrequency(e);Zs(s,0),this._baseFrequency=s,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class b_ extends Qn{constructor(){const e=de(b_.getDefaults(),arguments);super(e),this.name="MonoSynth",this.oscillator=new ba(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new ni(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new Im(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new ah(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),Ge(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Qn.getDefaults(),{envelope:Object.assign(en(Hs.getDefaults(),Object.keys(he.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(en(ni.getDefaults(),Object.keys(he.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(en(Im.getDefaults(),Object.keys(he.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(en(ba.getDefaults(),Object.keys(es.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,s=1){if(this.envelope.triggerAttack(e,s),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class v_ extends Cm{constructor(){const e=de(v_.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new or({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(Cm.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}class Jp extends lr{constructor(){const e=de(Jp.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,Ge(this,["oscillator","envelope"])}static getDefaults(){return oo(Qn.getDefaults(),lr.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,s){const n=this.toSeconds(s),i=this.toFrequency(e instanceof tn?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}ei([dR(0)],Jp.prototype,"octaves",void 0);ei([xr(0)],Jp.prototype,"pitchDecay",void 0);class Om extends pi{constructor(){const e=de(Om.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new xa(Object.assign({context:this.context},e.noise)),this.envelope=new ah(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(pi.getDefaults(),{envelope:Object.assign(en(Hs.getDefaults(),Object.keys(he.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(en(xa.getDefaults(),Object.keys(es.getDefaults())),{type:"white"})})}triggerAttack(e,s=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,s),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,s,n=1){return s=this.toSeconds(s),e=this.toSeconds(e),this.triggerAttack(s,n),this.triggerRelease(s+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const hR=new Set;function y_(t){hR.add(t)}function fR(t,e){const s=`registerProcessor("${t}", ${e})`;hR.add(s)}const Uz=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;y_(Uz);const $z=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;y_($z);const Gz=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;y_(Gz);const Hz="feedback-comb-filter",zz=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;fR(Hz,zz);class Mm extends pi{constructor(){const e=de(Mm.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),pe(!ir(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const s=e.voice.getDefaults();this.options=Object.assign(s,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(pi.getDefaults(),{maxPolyphony:32,options:{},voice:lr})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const s=this._activeVoices.findIndex(n=>n.voice===e);this._activeVoices.splice(s,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return pe(e instanceof Qn,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else Fp("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),s=this._voices.indexOf(e);this._voices.splice(s,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,s,n){e.forEach(i=>{const r=new jm(this.context,i).toMidi(),a=this._getNextAvailableVoice();a&&(a.triggerAttack(i,s,n),this._activeVoices.push({midi:r,voice:a,released:!1}),this.log("triggerAttack",i,s))})}_triggerRelease(e,s){e.forEach(n=>{const i=new jm(this.context,n).toMidi(),r=this._activeVoices.find(({midi:a,released:l})=>a===i&&!l);r&&(r.voice.triggerRelease(s),r.released=!0,this.log("triggerRelease",n,s))})}_scheduleEvent(e,s,n,i){pe(!this.disposed,"Synth was already disposed"),n<=this.now()?e==="attack"?this._triggerAttack(s,n,i):this._triggerRelease(s,n):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,s,n,i)},n-this.now())}triggerAttack(e,s,n){Array.isArray(e)||(e=[e]);const i=this.toSeconds(s);return this._scheduleEvent("attack",e,i,n),this}triggerRelease(e,s){Array.isArray(e)||(e=[e]);const n=this.toSeconds(s);return this._scheduleEvent("release",e,n),this}triggerAttackRelease(e,s,n,i){const r=this.toSeconds(n);if(this.triggerAttack(e,r,i),on(s)){pe(on(e),"If the duration is an array, the notes must also be an array"),e=e;for(let a=0;a<e.length;a++){const l=s[Math.min(a,s.length-1)],c=this.toSeconds(l);pe(c>0,"The duration must be greater than 0"),this.triggerRelease(e[a],r+c)}}else{const a=this.toSeconds(s);pe(a>0,"The duration must be greater than 0"),this.triggerRelease(e,r+a)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const s=en(e,["onsilence","context"]);return this.options=oo(this.options,s),this._voices.forEach(n=>n.set(s)),this._dummyVoice.set(s),this}get(){return this._dummyVoice.get()}releaseAll(e){const s=this.toSeconds(e);return this._activeVoices.forEach(({voice:n})=>{n.triggerRelease(s)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Zp extends pi{constructor(){const e=de(Zp.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const s={};Object.keys(e.urls).forEach(n=>{const i=parseInt(n,10);if(pe(Dh(n)||ir(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),Dh(n)){const r=new tn(this.context,n).toMidi();s[r]=e.urls[n]}else ir(i)&&isFinite(i)&&(s[i]=e.urls[i])}),this._buffers=new f_({urls:s,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(pi.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:et,onerror:et,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,s,n=1){return this.log("triggerAttack",e,s,n),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=nR(new tn(this.context,i).toFrequency()),a=Math.round(r),l=r-a,c=this._findClosest(a),u=a-c,d=this._buffers.get(u),h=sR(c+l),f=new ih({url:d,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(s,0,d.duration/h,n),on(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const m=this._activeSources.get(a),b=m.indexOf(f);b!==-1&&m.splice(b,1)}}}),this}triggerRelease(e,s){return this.log("triggerRelease",e,s),Array.isArray(e)||(e=[e]),e.forEach(n=>{const i=new tn(this.context,n).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);s=this.toSeconds(s),r.forEach(a=>{a.stop(s)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const s=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(s)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,s,n,i=1){const r=this.toSeconds(n);return this.triggerAttack(e,r,i),on(s)?(pe(on(e),"notes must be an array when duration is array"),e.forEach((a,l)=>{const c=s[Math.min(l,s.length-1)];this.triggerRelease(a,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(s)),this}add(e,s,n){if(pe(Dh(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Dh(e)){const i=new tn(this.context,e).toMidi();this._buffers.add(i,s,n)}else this._buffers.add(e,s,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(s=>s.dispose())}),this._activeSources.clear(),this}}ei([xr(0)],Zp.prototype,"attack",void 0);ei([xr(0)],Zp.prototype,"release",void 0);class __ extends he{constructor(){const e=de(__.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Bz({context:this.context}),this.a=new We({context:this.context,gain:0}),this.b=new We({context:this.context,gain:0}),this.output=new We({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new qe({context:this.context,units:"normalRange",value:e.fade}),Ge(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",ar(this._split,this.a.gain,0),ar(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(he.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Dm extends he{constructor(e){super(e),this.name="Effect",this._dryWet=new __({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new We({context:this.context}),this.effectReturn=new We({context:this.context}),this.input=new We({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],Ge(this,"wet")}static getDefaults(){return Object.assign(he.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class $N extends Dm{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Ol({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,Ge(this,["frequency","depth"])}static getDefaults(){return Object.assign(Dm.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class w_ extends $N{constructor(){const e=de(w_.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(e),this.name="AutoFilter",this.filter=new ni(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign($N.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class k_ extends he{constructor(){const e=de(k_.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Re({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Ge(this,"pan")}static getDefaults(){return Object.assign(he.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const qz="bit-crusher",Kz=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;fR(qz,Kz);class N_ extends he{constructor(){const e=de(N_.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(he.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class S_ extends Dm{constructor(){const e=de(S_.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const s=this.toSeconds(e.decay);Zs(s,.001),this._decay=s;const n=this.toSeconds(e.preDelay);Zs(n,0),this._preDelay=n,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Dm.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Zs(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Zs(e,0),this._preDelay=e,this.generate()}generate(){return Pt(this,void 0,void 0,function*(){const e=this.ready,s=new $p(2,this._decay+this._preDelay,this.context.sampleRate),n=new xa({context:s}),i=new xa({context:s}),r=new N_({context:s});n.connect(r,0,0),i.connect(r,0,1);const a=new We({context:s}).toDestination();r.connect(a),n.start(0),i.start(0),a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(1,this._preDelay),a.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const l=s.render();return this.ready=l.then(et),yield e,this._convolver.buffer=(yield l).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Ut extends he{constructor(){const e=de(Ut.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new We({context:this.context}),Ut._allSolos.has(this.context)||Ut._allSolos.set(this.context,new Set),Ut._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(he.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Ut._allSolos.get(this.context).forEach(s=>s._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Ut._soloed.has(this.context)||Ut._soloed.set(this.context,new Set),Ut._soloed.get(this.context).add(this)}_removeSolo(){Ut._soloed.has(this.context)&&Ut._soloed.get(this.context).delete(this)}_isSoloed(){return Ut._soloed.has(this.context)&&Ut._soloed.get(this.context).has(this)}_noSolos(){return!Ut._soloed.has(this.context)||Ut._soloed.has(this.context)&&Ut._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Ut._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Ut._allSolos=new Map;Ut._soloed=new Map;class T_ extends he{constructor(){const e=de(T_.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new k_({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new zi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Ge(this,["pan","volume"])}static getDefaults(){return Object.assign(he.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class fl extends he{constructor(){const e=de(fl.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new Ut({solo:e.solo,context:this.context}),this._panVol=this.output=new T_({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ge(this,["pan","volume"])}static getDefaults(){return Object.assign(he.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return fl.buses.has(e)||fl.buses.set(e,new We({context:this.context})),fl.buses.get(e)}send(e,s=0){const n=this._getBus(e),i=new We({context:this.context,units:"decibels",gain:s});return this.connect(i),i.connect(n),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}fl.buses=new Map;class E_ extends he{constructor(){const e=de(E_.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Re({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Re({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Re({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Re({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Re({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),Ge(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(he.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class A_ extends he{constructor(){const e=de(A_.getDefaults(),arguments,["threshold"]);super(e),this.name="Limiter",this._compressor=this.input=this.output=new E_({context:this.context,ratio:20,attack:.003,release:.01,threshold:e.threshold}),this.threshold=this._compressor.threshold,Ge(this,"threshold")}static getDefaults(){return Object.assign(he.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}Hn().transport;const GN=Hn().destination;Hn().destination;Hn().listener;Hn().draw;const ug=Hn(),mR=[{id:"Ashes of the Keep.mp3",title:"Festningens Aske",mood:"Dark"},{id:"Banner at the Old Stone Keep.mp3",title:"Gamle Steiner",mood:"Epic"},{id:"Banner at the Old Stone Keep (1).mp3",title:"Steinhallens Hymne",mood:"Epic"},{id:"Burning Banners Over Stone.mp3",title:"Brennende Bannere",mood:"Dark"},{id:"Candlelit Keep.mp3",title:"Lys i Hallen",mood:"Calm"},{id:"Candlelit Keep (1).mp3",title:"Nattens Vakt",mood:"Calm"},{id:"Crown of Quiet Rooms.mp3",title:"Stillhetens Krone",mood:"Mysterious"},{id:"Crown of Quiet Rooms (1).mp3",title:"Kongens Tvil",mood:"Mysterious"}],Ka=class Ka{constructor(){Ie(this,"clickSynth",null);Ie(this,"hoverSynth",null);Ie(this,"successSynth",null);Ie(this,"errorSynth",null);Ie(this,"crunchSynth",null);Ie(this,"jumpSynth",null);Ie(this,"reverb",null);Ie(this,"windNodes",null);Ie(this,"seaNodes",null);Ie(this,"limiter",null);Ie(this,"masterGain",null);Ie(this,"isInitialized",!1)}static getInstance(){return Ka.instance||(Ka.instance=new Ka),Ka.instance}async init(){if(this.isInitialized)return;this.limiter=new A_(-2).toDestination(),this.masterGain=new We(1).connect(this.limiter),this.reverb=new S_({decay:2.5,preDelay:.1,wet:.3}).connect(this.masterGain),await this.reverb.generate();const e=new ni(2e3,"lowpass").connect(this.masterGain);this.clickSynth=new lr({oscillator:{type:"sine"},envelope:{attack:.005,decay:.05,sustain:0,release:.1}}).connect(e),this.hoverSynth=new Om({noise:{type:"pink"},envelope:{attack:.005,decay:.02,sustain:0}});const s=new ni(6e3,"highpass").connect(this.masterGain);this.hoverSynth.connect(s),this.hoverSynth.volume.value=-12,this.successSynth=new Mm(v_,{harmonicity:3,modulationIndex:3.5,oscillator:{type:"square"},envelope:{attack:.1,decay:2,sustain:.1,release:2},modulation:{type:"sine"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}}).connect(this.masterGain),this.successSynth.volume.value=-6,this.errorSynth=new b_({oscillator:{type:"sawtooth"},filter:{Q:5,type:"lowpass",rolloff:-24},envelope:{attack:.01,decay:.2,sustain:.4,release:2},filterEnvelope:{attack:.01,decay:.2,sustain:.8,release:2,baseFrequency:200,octaves:4,exponent:2}}).connect(this.masterGain);const n=new ni(800,"lowpass").connect(this.masterGain);this.crunchSynth=new Om({noise:{type:"brown"},envelope:{attack:.02,decay:.15,sustain:0}}).connect(n),this.crunchSynth.volume.value=-2,this.jumpSynth=new lr({oscillator:{type:"triangle"},envelope:{attack:.05,decay:.2,sustain:.1,release:1}}).connect(this.reverb),this.initAmbience(),this.isInitialized=!0,console.log(" Procedural Sound Engine Initialized (v2 - Reverb Active)")}initAmbience(){if(!this.masterGain)return;const e=new xa("pink").start(),s=new w_({frequency:.1,baseFrequency:200,octaves:2.6,depth:1,type:"sine"}).start(),n=new zi(-20).connect(this.masterGain);e.connect(s),s.connect(n),this.windNodes={noise:e,filter:s,lfo:new Ol(.1,100,400).start(),vol:n},e.disconnect(),s.disconnect();const i=new ni(400,"bandpass"),r=new Ol(.1,200,600).start();r.connect(i.frequency);const a=new zi(-999).connect(this.masterGain);e.connect(i).connect(a),this.windNodes={noise:e,filter:i,lfo:r,vol:a};const l=new xa("brown").start(),c=new ni(500,"lowpass"),u=new Ol(.05,300,900).start();u.connect(c.frequency);const d=new zi(-999).connect(this.masterGain);l.connect(c).connect(d),this.seaNodes={noise:l,filter:c,lfo:u,vol:d}}playHumanized(e,s,n){if(!this.isInitialized)return;const i=.9+Math.random()*.2;if("detune"in e&&e.detune instanceof qe){const r=Math.random()*10-5;e.detune.value=r}e instanceof Mm||s?e.triggerAttackRelease(s,n,void 0,i):e.triggerAttackRelease(n,void 0,i)}playClick(){this.isInitialized&&this.playHumanized(this.clickSynth,"G5","32n")}playHover(){this.isInitialized&&this.playHumanized(this.hoverSynth,void 0,"64n")}playSuccess(){if(!this.isInitialized)return;const e=["C4","E4","G4","B4","D5"];this.playHumanized(this.successSynth,e,"1m")}playError(){this.isInitialized&&this.playHumanized(this.errorSynth,"A1","8n")}playCrunch(){this.isInitialized&&this.playHumanized(this.crunchSynth,void 0,"16n")}playJump(){this.isInitialized&&(this.jumpSynth.triggerAttack("C2"),this.jumpSynth.frequency.rampTo("G2",.1),this.jumpSynth.triggerRelease("+0.2"))}playHeartbeat(){this.isInitialized&&this.playHumanized(this.clickSynth,"A0","8n")}playCoin(){this.isInitialized&&this.playHumanized(this.successSynth,["B5","E6"],"32n")}playConfirm(){this.isInitialized&&this.playHumanized(this.successSynth,["C4","G4"],"16n")}setAmbience(e){if(!this.isInitialized||!this.windNodes||!this.seaNodes)return;const s=2;e==="wind"?(this.windNodes.vol.volume.rampTo(-20,s),this.seaNodes.vol.volume.rampTo(-999,s)):e==="sea"?(this.windNodes.vol.volume.rampTo(-999,s),this.seaNodes.vol.volume.rampTo(-20,s)):(this.windNodes.vol.volume.rampTo(-999,s),this.seaNodes.vol.volume.rampTo(-999,s))}setVolume(e){this.masterGain&&this.masterGain.gain.rampTo(e,.1)}};Ie(Ka,"instance");let ob=Ka;const Os=ob.getInstance(),Wa=class Wa{constructor(){Ie(this,"sfxVolume",.5);Ie(this,"musicVolume",.3);Ie(this,"currentMusic",null);Ie(this,"currentMusicKey",null);Ie(this,"playlist",[]);Ie(this,"playlistIndex",0);Ie(this,"isPlaylistActive",!1);Ie(this,"ignoredTracks",new Set);Ie(this,"isMuffledState",!1);Ie(this,"activeFades",new Map);Ie(this,"audioContextResumed",!1);const e=localStorage.getItem("sim_sfx_volume"),s=localStorage.getItem("sim_music_volume"),n=localStorage.getItem("sim_music_muffled"),i=localStorage.getItem("sim_music_ignored");if(e&&(this.sfxVolume=parseFloat(e)),s&&(this.musicVolume=parseFloat(s)),n&&(this.isMuffledState=n==="true"),i)try{this.ignoredTracks=new Set(JSON.parse(i))}catch(r){console.error("Failed to parse ignored tracks",r)}this.playlist=mR.map(r=>r.id),this.shufflePlaylist(),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden?(GN.mute=!0,this.currentMusic&&(this.currentMusic.muted=!0)):(GN.mute=!1,this.currentMusic&&(this.currentMusic.muted=!1))})}shufflePlaylist(){this.playlist=this.playlist.sort(()=>Math.random()-.5)}static getInstance(){return Wa.instance||(Wa.instance=new Wa),Wa.instance}async resume(){if(!(this.audioContextResumed&&ug.state==="running"))try{await Az(),await Os.init(),Os.setVolume(this.sfxVolume),this.audioContextResumed=!0,console.log(" Audio Engine Resumed")}catch(e){console.warn("Audio Resume Failed (Autoplay blocked?)",e)}}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("sim_sfx_volume",this.sfxVolume.toString()),this.audioContextResumed&&Os.setVolume(this.sfxVolume)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("sim_music_volume",this.musicVolume.toString()),this.currentMusic&&(this.currentMusic.volume=this.musicVolume)}setMuffled(e){this.isMuffledState=e,localStorage.setItem("sim_music_muffled",e.toString())}playSfx(e){ug.state!=="running"&&ug.resume().catch(()=>{}),this.audioContextResumed||this.resume().catch(n=>console.warn("Auto-resume failed",n));const s=e.toLowerCase();s.includes("click")?Os.playClick():s.includes("hover")||s.includes("toggle")?Os.playHover():s.includes("success")||s.includes("level")?Os.playSuccess():s.includes("error")||s.includes("fail")?Os.playError():s.includes("coin")||s.includes("cash")||s.includes("money")?Os.playCoin():s.includes("confirm")?Os.playConfirm():s.includes("eat")||s.includes("consume")?Os.playCrunch():s.includes("jump")?Os.playJump():s.includes("heartbeat")?Os.playHeartbeat():Os.playClick()}startPlaylist(){this.isPlaylistActive&&this.currentMusic||(this.isPlaylistActive=!0,this.currentMusic||this.playNextInPlaylist())}playNextInPlaylist(){if(!this.isPlaylistActive)return;let e=0;for(;e<this.playlist.length;){this.playlistIndex=(this.playlistIndex+1)%this.playlist.length;const s=this.playlist[this.playlistIndex];if(!this.ignoredTracks.has(s)){this.playMusic(s,2e3,!1);return}e++}this.playMusic(this.playlist[0],2e3,!1)}playPreviousInPlaylist(){if(!this.isPlaylistActive)return;let e=0;for(;e<this.playlist.length;){this.playlistIndex=(this.playlistIndex-1+this.playlist.length)%this.playlist.length;const s=this.playlist[this.playlistIndex];if(!this.ignoredTracks.has(s)){this.playMusic(s,2e3,!1);return}e++}this.playMusic(this.playlist[0],2e3,!1)}playMusic(e,s=1e3,n=!0){n&&(this.isPlaylistActive=!1);const a=`/Simulation_StandAlone_Pro//sounds/music/${e.includes(".")?e:`${e}.mp3`}`.replace("//","/"),l=new Audio(a);l.loop=!this.isPlaylistActive,l.volume=0,this.currentMusic&&this.fadeOut(this.currentMusic,s),this.currentMusic=l,this.currentMusicKey=e,l.play().then(()=>{this.fadeIn(l,this.musicVolume,s)}).catch(c=>{console.warn(`Failed to play music: ${e}`,c),this.isPlaylistActive&&setTimeout(()=>this.playNextInPlaylist(),2e3)}),this.isPlaylistActive&&(l.onended=()=>this.playNextInPlaylist())}stopMusic(e=1e3){this.isPlaylistActive=!1,this.currentMusic&&(this.fadeOut(this.currentMusic,e),this.currentMusic=null,this.currentMusicKey=null)}fadeOut(e,s){this.activeFades.has(e)&&(clearInterval(this.activeFades.get(e)),this.activeFades.delete(e));const n=e.volume,i=20,r=setInterval(()=>{e.volume>.01?e.volume=Math.max(0,e.volume-n/i):(e.pause(),clearInterval(r),this.activeFades.delete(e))},s/i);this.activeFades.set(e,r)}fadeIn(e,s,n){this.activeFades.has(e)&&(clearInterval(this.activeFades.get(e)),this.activeFades.delete(e));const i=20,r=setInterval(()=>{e.volume<s?e.volume=Math.min(s,e.volume+s/i):(clearInterval(r),this.activeFades.delete(e))},n/i);this.activeFades.set(e,r)}getSfxVolume(){return this.sfxVolume}getMusicVolume(){return this.musicVolume}isMuffled(){return this.isMuffledState}getCurrentTrackId(){return this.currentMusicKey}toggleIgnoreTrack(e){this.ignoredTracks.has(e)?this.ignoredTracks.delete(e):this.ignoredTracks.add(e),localStorage.setItem("sim_music_ignored",JSON.stringify(Array.from(this.ignoredTracks)))}isIgnored(e){return this.ignoredTracks.has(e)}};Ie(Wa,"instance");let lb=Wa;const Ye=lb.getInstance(),So=Object.freeze(Object.defineProperty({__proto__:null,audioManager:Ye},Symbol.toStringTag,{value:"Module"})),pR=S.createContext(void 0),Wz=({children:t})=>{const[e,s]=S.useState(Ye.getSfxVolume()),[n,i]=S.useState(Ye.getMusicVolume()),[r,a]=S.useState(Ye.isMuffled()),[l,c]=S.useState(Ye.getCurrentTrackId()),[u,d]=S.useState(0);S.useEffect(()=>{const _=setInterval(()=>{const T=Ye.getCurrentTrackId();T!==l&&c(T)},1e3);return()=>clearInterval(_)},[l]);const h=S.useCallback(_=>{Ye.setSfxVolume(_),s(_)},[]),f=S.useCallback(_=>{Ye.setMusicVolume(_),i(_)},[]),m=S.useCallback(_=>{Ye.setMuffled(_),a(_)},[]),b=S.useCallback(_=>{Ye.playSfx(_)},[]),p=S.useCallback(_=>{Ye.playMusic(_),c(_)},[]),v=S.useCallback(()=>{Ye.stopMusic(),c(null)},[]),x=S.useCallback(()=>{Ye.startPlaylist(),c(Ye.getCurrentTrackId())},[]),g=S.useCallback(()=>{Ye.playNextInPlaylist(),c(Ye.getCurrentTrackId())},[]),y=S.useCallback(()=>{Ye.playPreviousInPlaylist(),c(Ye.getCurrentTrackId())},[]),w=S.useCallback(_=>{Ye.toggleIgnoreTrack(_),d(T=>T+1)},[]),k=S.useCallback(_=>Ye.isIgnored(_),[u]),N=S.useCallback(()=>{Ye.resume()},[]);return o.jsx(pR.Provider,{value:{playSfx:b,playMusic:p,startPlaylist:x,stopMusic:v,playNext:g,playPrevious:y,toggleIgnoreTrack:w,isIgnored:k,currentTrackId:l,playlist:mR,sfxVolume:e,setSfxVolume:h,musicVolume:n,setMusicVolume:f,isMuffled:r,setMuffled:m,resume:N},children:t})},j_=()=>{const t=S.useContext(pR);if(!t)throw new Error("useAudio must be used within a SimulationAudioProvider");return t},gR=S.createContext(void 0),Yz=({children:t})=>{const{pin:e,tab:s}=FA(),n=F=>{if(!F)return"MAP";const U=F.toUpperCase();return U==="ACTIVITY"||U==="LOG"?"ACTIVITY":U},i=F=>F.toLowerCase(),[r,a]=S.useState(()=>n(s)),[l,c]=S.useState("global"),[u,d]=S.useState(null),[h,f]=S.useState(!1),[m,b]=S.useState(!1),[p,v]=S.useState(null),[x,g]=S.useState(null),[y,w]=S.useState(null),[k,N]=S.useState(null),[_,T]=S.useState(null),[E,A]=S.useState([]),[R,I]=S.useState(null),[V,H]=S.useState("overview"),P=F=>{A(U=>[...U,F])},O=()=>{I(null)};Ne.useEffect(()=>{if(E.length>0&&!R){const F=E[0];I(F),A(U=>U.slice(1))}},[E,R]);const L=F=>{a(F);const U=i(F),C=`/Simulation_StandAlone_Pro/play/${e}/${U}`;window.history.replaceState({...window.history.state,idx:window.history.length},"",C)},M=F=>{f(F),F?L("MARKET"):r==="MARKET"&&L("MAP")};return o.jsx(gR.Provider,{value:{activeTab:r,setActiveTab:L,viewMode:l,setViewMode:c,viewingRegionId:u,setViewingRegionId:d,isMarketOpen:h,setMarketOpen:M,isMusicWindowOpen:m,setMusicWindowOpen:b,activeMinigame:p,setActiveMinigame:v,activeMinigameMethod:x,setActiveMinigameMethod:g,activeMinigameAction:y,setActiveMinigameAction:w,actionLoading:k,setActionLoading:N,productionContext:_,setProductionContext:T,showAchievement:P,dismissAchievement:O,currentAchievement:R,profileTab:V,setProfileTab:H},children:t})},va=()=>{const t=S.useContext(gR);if(!t)throw new Error("useSimulation must be used within a SimulationProvider");return t},Xz="modulepreload",Qz=function(t){return"/Simulation_StandAlone_Pro/"+t},HN={},xt=function(e,s,n){let i=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(s.map(c=>{if(c=Qz(c),c in HN)return;HN[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Xz,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},re={MARKET:{SELL_RATIO:.8,PRICE_IMPACT_BUY:.005,PRICE_IMPACT_SELL:.005,MIN_PRICE_MULTIPLIER:.2,MAX_PRICE_MULTIPLIER:5,VISCOSITY:100},CONTRIBUTION_VALUES:{gold:1,wood:.5,stone:1,iron_ore:1,iron_ingot:5,plank:2,grain:.1,flour:.5,bread:1,meat:1,honey:1,cloth:1,wool:.5,flax:.2,linen_canvas:3,tar:2,fish_raw:.5,silk:5,spice:10,default:.1},CAREERS:{SOLDIER:{COST:200,LEVEL_REQ:3},MERCHANT:{COST:500,LEVEL_REQ:3}},TAX:{PEASANT_RATE_DEFAULT:.15,PEASANT_RATE_CUT:.07,ROYAL_RATE:.2,LOYALTY_PENALTY_PEASANT:10,LOYALTY_PENALTY_BARON:5},GATHERING:{NO_TOOL_PENALTY:.75},YIELD:{WORK_GRAIN:10,CHOP_WOOD:6,MINE_ORE:5,QUARRY_STONE:8,FORAGE_BREAD:1,PLOW_BONUS:4,SUMMER_WOOD_BONUS:2},DURABILITY:{MAX:100,LOSS_WORK:5,LOSS_COMBAT_WEAPON:10,LOSS_COMBAT_ARMOR:15,REPAIR_AMOUNT:30},MINIGAME:{BASE_MULTIPLIER:.5,PERFORMANCE_WEIGHT:1,CRAFTING_WEIGHT:1.5,THRESHOLD_GREAT:.8},RELIGION:{PRAY_MIN:1,PRAY_MAX:5,XP_PRAY:2},COMBAT:{RAID_LOOT_FACTOR:.4,DEFEND_GOLD_BASE:20,XP_WIN:20,XP_LOSS:0},LUCKY_DROP:{CHANCE:.05,MULTIPLIER:2},PASSIVE_INCOME:{COW:2,ACCOUNTING_BOOKS:5,CARAVAN:10},SKILLS:{GATHERING_BONUS:.1,REFINING_BONUS:.1,CRAFTING_XP:25,REFINING_XP:10},COUP:{BASE_BRIBE_COST:500,HONEYMOON_DURATION:6e5,VACANCY_DURATION:3e5,RESTORE_ORDER_COST:600,LEGITIMACY_SHIELD_MULT:2,KING_VOTE_WEIGHT:15,PEASANT_VOTE_WEIGHT:1},CARAVAN:{LEVELS:[{level:1,name:"Hndkjre",capacity:5,speed:1,cost:0,durability:100},{level:2,name:"Enkel vogn",capacity:15,speed:1.2,cost:300,durability:150},{level:3,name:"Overbygd kjerre",capacity:40,speed:1.5,cost:800,durability:200},{level:4,name:"Jernkledd konvoi",capacity:100,speed:1.8,cost:2e3,durability:300},{level:5,name:"Storkjpmannens vogn",capacity:250,speed:2.2,cost:5e3,durability:500}],UPGRADES:{SILK_CHESTS:{id:"silk_chests",name:"Silkeforede kister",cost:150,benefit:"Beskytter luksusvarer"},HEAVY_AXLES:{id:"heavy_axles",name:"Forsterkede akslinger",cost:250,benefit:"+10% fart med full last"},GUARD_POST:{id:"guard_post",name:"Vaktpost",cost:400,benefit:"Reduserer bandittfare"}}}},oh={WORK:{xp:5},CHOP:{xp:5},FORAGE:{xp:2}},Lm=[0,100,300,700,1500,3e3,6e3],En={Spring:{label:"Vr",yieldMod:1,staminaMod:1,color:"#4ade80"},Summer:{label:"Sommer",yieldMod:1.2,staminaMod:1,color:"#fbbf24"},Autumn:{label:"Hst",yieldMod:1.5,staminaMod:1,color:"#f97316"},Winter:{label:"Vinter",yieldMod:.2,staminaMod:1.5,color:"#38bdf8"}},Fi={Clear:{label:"Klart Vr",desc:"Ideelle forhold for alt arbeid.",mod:1,icon:"",speedMod:1,staminaMod:1},Rain:{label:"Regn",desc:"Glatte forhold. Minispill gr litt fortere.",mod:.9,icon:"",speedMod:1.2,staminaMod:1},Storm:{label:"Storm",desc:"Farlig vr. Hy stamina-kostnad og lavt utbytte!",mod:.5,icon:"",speedMod:1.5,staminaMod:2},Fog:{label:"Tke",desc:"Drlig sikt. Vanskeligere  treffe blinker.",mod:.8,icon:"",speedMod:.8,staminaMod:1}},Mc={WORK:{bread:1,stamina:10},CHOP:{bread:1,stamina:15},FORAGE:{stamina:40},MINE:{bread:1,stamina:25},RAID:{bread:3,stamina:40},TAX:{stamina:20},TAX_PEASANTS:{stamina:25},TAX_ROYAL:{stamina:30},MILL:{grain:10},SMELT:{iron_ore:5,wood:2},SAWMILL:{wood:5},BAKERY:{flour:5},REFINE:{},CRAFT:{},QUARRY:{bread:1,stamina:20},REPAIR:{stamina:15},HUNT:{stamina:30},GATHER_WOOL:{stamina:15},GATHER_HONEY:{stamina:20},PRAY:{stamina:15},FEAST:{bread:30,gold:100,stamina:10},CONTRIBUTE:{stamina:10},CONSTRUCT:{stamina:20},SLEEP:{stamina:0},EAT:{bread:1,stamina:0},PLANT:{grain:5,stamina:25},HARVEST:{stamina:15},BAKE:{},WEAVE:{},MIX:{},DEFEND:{stamina:30},EXPLORE:{stamina:25},PATROL:{stamina:10},MAINTAIN_CROP:{stamina:5},MOUNT_HORSE:{stamina:5},BUY_HORSE_COSMETIC:{stamina:0},SELECT_HORSE_COSMETIC:{stamina:0},LOAD_CARAVAN:{stamina:5},UNLOAD_CARAVAN:{stamina:5},UPGRADE_CARAVAN:{stamina:0},TRAVEL_START:{stamina:20,bread:1}},cb={great_forge:{material:"iron_ingot",goldCost:20,staminaCost:15,slots:["MAIN_HAND","OFF_HAND","HEAD","BODY","FEET","AXE","PICKAXE","SCYTHE","HAMMER","BOW","TRAP","CHISEL"]},weavery:{material:"cloth",goldCost:10,staminaCost:10,slots:["BODY","FEET","HEAD"]},sawmill:{material:"plank",goldCost:5,staminaCost:10,slots:["OFF_HAND","MAIN_HAND"]}},ic={GOLD:"",GRAIN:"",WOOD:"",IRON_ORE:"",STONE:"",PLANK:"",IRON_INGOT:"",BREAD:"",SWORDS:"",ARMOR:"",CLOTH:"",WOOL:"",MEAT:"",HONEY:"",GLASS:"",FLOUR:"",EGG:"",OMELETTE:"",MANPOWER:"",FAVOR:"",FLAX:"",LINEN_CANVAS:"",TAR:"",FISH_RAW:"",SILK:"",SPICE:""},ze={gold:{label:"Gull",icon:""},grain:{label:"Korn",icon:"",isCommodity:!0},flour:{label:"Mel",icon:"",isCommodity:!0},bread:{label:"Brd",icon:""},wood:{label:"Ved",icon:"",isCommodity:!0},plank:{label:"Planker",icon:"",isCommodity:!0},iron_ore:{label:"Jernmalm",icon:"",isCommodity:!0},iron_ingot:{label:"Jernbarre",icon:"",isCommodity:!0},stone:{label:"Stein",icon:"",isCommodity:!0},siege_sword:{label:"Beleiringsvpen",icon:""},siege_armor:{label:"Beleiringsrustning",icon:""},favor:{label:"Gunst",icon:""},honey:{label:"Honning",icon:"",isCommodity:!0},meat:{label:"Kjtt",icon:"",isCommodity:!0},wool:{label:"Ull",icon:"",isCommodity:!0},cloth:{label:"Stoff",icon:"",isCommodity:!0},glass:{label:"Glass",icon:"",isCommodity:!0},egg:{label:"Egg",icon:"",isCommodity:!0},omelette:{label:"Omelett",icon:""},minor_stamina_potion:{label:"Liten Stamina-brygg",icon:""},herbal_balm:{label:"Urtebalsam",icon:""},focus_brew:{label:"Fokus-brygg",icon:""},strength_tincture:{label:"Styrke-tinktur",icon:""},masters_draught:{label:"Mester-drikk",icon:""},elixir_of_life:{label:"Livseliksir",icon:""},flax:{label:"Lin",icon:"",isCommodity:!0},linen_canvas:{label:"Seilduk",icon:"",isCommodity:!0},tar:{label:"Tjre",icon:"",isCommodity:!0},fish_raw:{label:"R fisk",icon:"",isCommodity:!0},fish_cooked:{label:"Stekt fisk",icon:""},silk:{label:"Silke",icon:"",isCommodity:!0},spice:{label:"Krydder",icon:"",isCommodity:!0},cannonball:{label:"Kanonkuler",icon:"",isCommodity:!0}},ms={KING:{gold:1e3,grain:500,flour:200,bread:50,wood:200,plank:50,iron_ore:0,iron_ingot:20,stone:100,siege_sword:50,siege_armor:20,favor:0,wool:50,cloth:20,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:20,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},BARON:{gold:300,grain:100,flour:50,bread:20,wood:50,plank:20,iron_ore:0,iron_ingot:10,stone:20,siege_sword:10,siege_armor:10,favor:0,wool:20,cloth:5,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:10,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},PEASANT:{gold:20,grain:30,flour:5,bread:10,wood:0,plank:0,iron_ore:0,iron_ingot:0,stone:0,siege_sword:0,siege_armor:0,favor:0,wool:10,cloth:0,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:0,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},SOLDIER:{gold:50,grain:10,flour:10,bread:10,wood:0,plank:0,iron_ore:0,iron_ingot:0,stone:0,siege_sword:5,siege_armor:2,favor:0,wool:0,cloth:0,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:10,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},MERCHANT:{gold:500,grain:50,flour:50,bread:20,wood:50,plank:20,iron_ore:0,iron_ingot:5,stone:50,siege_sword:5,siege_armor:2,favor:0,wool:20,cloth:10,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:5,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0}},C_={PEASANT:[{id:"iron_plow",name:"Jernplog",description:"ker kornhst med +5.",cost:{gold:50,wood:10},benefit:"YIELD_GRAIN"},{id:"fence",name:"Solid Gjerde",description:"Beskytter mot smtyveri.",cost:{wood:50},benefit:"DEFENSE_REGION"},{id:"cow",name:"Melkeku",description:"Gir passivt 2 gull per minutt (simulert via actions).",cost:{gold:80},benefit:"PASSIVE_GOLD"},{id:"roof",name:"Tett Tak",description:"Bedre hvile. Mer utholdenhet.",cost:{wood:20,gold:10},benefit:"STAMINA_REGEN"}],BARON:[{id:"stone_keep",name:"Steintrn",description:"Gjr raiding av deg mye vanskeligere.",cost:{gold:200,wood:100},benefit:"FORTRESS"},{id:"armory",name:"Vpenkammer",description:"Dobbelt s effektiv rekruttering.",cost:{gold:150},benefit:"DRAFT_BONUS"},{id:"stables",name:"Staller",description:"Raskere raids.",cost:{gold:100,wood:50},benefit:"RAID_SPEED"}],KING:[{id:"cathedral",name:"Katedral",description:"ker din legitimitet og skattevilje.",cost:{gold:500,stone:200},benefit:"ROYAL_AUTHORITY"},{id:"royal_guard",name:"Kongelig Garde",description:"Uovervinnelig defensiv styrke.",cost:{gold:400,iron:100},benefit:"ELITE_DEFENSE"}],SOLDIER:[{id:"knight_armor",name:"Ridderrustning",description:"Du tar mindre skade og ser tffere ut.",cost:{gold:100,swords:5},benefit:"ARMOR"},{id:"warhorse",name:"Stridshest",description:"Gjr deg til en Ridder. 2x XP fra kamp.",cost:{gold:200,grain:100},benefit:"KNIGHT"}],MERCHANT:[{id:"trade_license",name:"Handelsbrev",description:"Bedre salgspriser p markedet.",cost:{gold:150},benefit:"MARKET_BONUS"},{id:"accounting_books",name:"Regnskapsbker",description:"Gir passivt 5 gull per minutt.",cost:{gold:200,wood:20},benefit:"PASSIVE_GOLD_HIGH"},{id:"caravan",name:"Karavane",description:"Tjen penger p handel med utlandet.",cost:{gold:300,wood:50},benefit:"CARAVAN"}]},Rn={PEASANT:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:0,xp:0,maxXp:100},STEWARDSHIP:{level:0,xp:0,maxXp:100},COMBAT:{level:0,xp:0,maxXp:100},TRADING:{level:0,xp:0,maxXp:100},THEOLOGY:{level:0,xp:0,maxXp:100}},BARON:{FARMING:{level:3,xp:0,maxXp:300},WOODCUTTING:{level:3,xp:0,maxXp:300},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:5,xp:0,maxXp:1e3},COMBAT:{level:3,xp:0,maxXp:300},TRADING:{level:3,xp:0,maxXp:300},THEOLOGY:{level:1,xp:0,maxXp:100}},KING:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:10,xp:0,maxXp:5e3},COMBAT:{level:5,xp:0,maxXp:1500},TRADING:{level:5,xp:0,maxXp:1500},THEOLOGY:{level:5,xp:0,maxXp:1500}},SOLDIER:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:0,xp:0,maxXp:100},COMBAT:{level:5,xp:0,maxXp:1500},TRADING:{level:0,xp:0,maxXp:100},THEOLOGY:{level:0,xp:0,maxXp:100}},MERCHANT:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:2,xp:0,maxXp:200},STEWARDSHIP:{level:1,xp:0,maxXp:100},COMBAT:{level:0,xp:0,maxXp:100},TRADING:{level:5,xp:0,maxXp:1500},THEOLOGY:{level:0,xp:0,maxXp:100}}},Jz={FARMING:{label:"Jordbruk",description:"Dyrking av mark, hsting av avlinger og husdyrhold.",color:"#10b981",bonuses:{2:"10% raskere hsting.",5:"Avlinger gir 20% mer utbytte.",10:"Mesterbonde: Lser opp avanserte avlinger."}},WOODCUTTING:{label:"Vedhogging",description:"Kunsten  felle trr og bearbeide tmmer.",color:"#8b5cf6",bonuses:{3:"15% raskere tmmerhogst.",7:"Sjanse for  finne sjelden kvae.",12:"Skovens vokter: kt utbytte fra alle trr."}},MINING:{label:"Gruvedrift",description:"Uthenting av malm og edle metaller fra fjellet.",color:"#f59e0b",bonuses:{4:"Bedre verktyeffektivitet i gruver.",8:"Lser opp utvinning av edelstener.",15:"Fjellkonge: Maksimalt utbytte fra dype rer."}},CRAFTING:{label:"Hndverk",description:"Smiing, snekring og tilvirking av avansert utstyr.",color:"#3b82f6",bonuses:{2:"Mindre materialsvinn ved refining.",5:"Bedre sjanse for hyere kvalitet.",10:"Stormester: Kan smie legendarisk utstyr."}},STEWARDSHIP:{label:"Godsforvaltning",description:"Administrasjon av land, folk og ressurser.",color:"#ec4899",bonuses:{5:"Redusert skattetrykk fra overordnede.",10:"kt passiv inntekt fra oppgraderinger.",20:"Rikets forvalter: Maksimal konomisk innsikt."}},COMBAT:{label:"Kamp",description:"Ferdighet i sverd, bue og forsvar av riket.",color:"#ef4444",bonuses:{3:"kt angrepskraft (+10%).",6:"Bedre forsvarsevne i beleiringer.",12:"Krigsherre: Fryktinngytende p slagmarken."}},TRADING:{label:"Handel",description:"Kjp, salg og markedsspekulering.",color:"#facc15",bonuses:{2:"Lavere gebyrer p markedet.",5:"Bedre priser ved handel med NPCs.",10:"Handelsfyrste: Kontroll over handelsruter."}},THEOLOGY:{label:"Teologi",description:"Tro, bnn og forstelse av det guddommelige.",color:"#6366f1",bonuses:{5:"Bnner gir mer stamina.",10:"Guddommelig beskyttelse mot ulykker.",15:"Helgen: Utstrler en aura av ro og verdighet."}}},ub={PEASANT:{},BARON:{MAIN_HAND:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:5,stats:{attack:10}},BODY:{id:"fine_clothes",name:"Fie Klr",icon:"",type:"BODY",durability:50,maxDurability:50,level:5,stats:{defense:2,speedBonus:1.1}}},KING:{MAIN_HAND:{id:"royal_scepter",name:"Kongens Septer",icon:"",type:"MAIN_HAND",durability:200,maxDurability:200,level:10,stats:{luckBonus:.2}},HEAD:{id:"crown",name:"Krone",icon:"",type:"HEAD",durability:100,maxDurability:100,level:10,stats:{luckBonus:.1}}},SOLDIER:{MAIN_HAND:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:3,stats:{attack:8}},OFF_HAND:{id:"wooden_shield",name:"Treskjold",icon:"",type:"OFF_HAND",durability:50,maxDurability:50,level:2,stats:{defense:5}},BODY:{id:"leather_armor",name:"Lrrustning",icon:"",type:"BODY",durability:80,maxDurability:80,level:2,stats:{defense:5}}},MERCHANT:{MAIN_HAND:{id:"walking_stick",name:"Vandrestav",icon:"",type:"MAIN_HAND",durability:50,maxDurability:50,level:2,stats:{speedBonus:1.05}},TRINKET:{id:"abacus",name:"Kuleramme",icon:"",type:"TRINKET",durability:100,maxDurability:100,level:3,stats:{yieldBonus:2}}}},Ke={tools:{id:"tools",name:"Verkty",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:1,description:"Grunnleggende verkty."},weapon:{id:"weapon",name:"Enkelt Sverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:1,description:"Et enkelt sverd."},armor:{id:"armor",name:"Enkel Rustning",icon:"",type:"BODY",durability:100,maxDurability:100,level:1,description:"Beskyttende rustning."},stone_axe:{id:"stone_axe",name:"Steinks",icon:"",type:"AXE",durability:30,maxDurability:30,level:1,description:"Primitiv ks hugget fra mrke fjell. Sagnet sier at de frste fedrene brukte slike til  bane vei gjennom de tette skogene fr sivilisasjonens inntog. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["CHOP"],nextTierId:"iron_axe"},stone_pickaxe:{id:"stone_pickaxe",name:"Steinhakke",icon:"",type:"PICKAXE",durability:30,maxDurability:30,level:1,description:"En enkel hakke i flint og tre. Brukt i generasjoner av de som sker fjellets hemmeligheter. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["MINE"],nextTierId:"iron_pickaxe"},rusty_axe:{id:"rusty_axe",name:"Rusten ks",icon:"",type:"AXE",durability:50,maxDurability:50,level:1,description:"Et glemt relikvie fra en svunnen tid, n bare en skygge av sin fordums prakt. Slv og uplitelig.",stats:{yieldBonus:0},relevantActions:["CHOP"],nextTierId:"stone_axe"},iron_axe:{id:"iron_axe",name:"Jernks",icon:"",type:"AXE",durability:100,maxDurability:100,level:3,description:"Smid i landsbyens esse under fullmnen. Jernet synger nr det treffer treverket. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["CHOP"],nextTierId:"steel_axe"},iron_pickaxe:{id:"iron_pickaxe",name:"Jernhakke",icon:"",type:"PICKAXE",durability:100,maxDurability:100,level:3,description:"Tung og balansert. Laget for  trenge dypt inn i rikets rike rer. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["MINE"],nextTierId:"steel_pickaxe"},stone_chisel:{id:"stone_chisel",name:"Steinmeisel",icon:"",type:"CHISEL",durability:30,maxDurability:30,level:1,description:"En enkel meisel av herdet stein. Perfekt for  forme steinblokker. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["QUARRY"],nextTierId:"iron_chisel"},iron_chisel:{id:"iron_chisel",name:"Jernmeisel",icon:"",type:"CHISEL",durability:80,maxDurability:80,level:3,description:"Smid i landsbyens esse. Gjr steinhugging til en lek. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["QUARRY"],nextTierId:"steel_chisel"},royal_scepter:{id:"royal_scepter",name:"Kongens Septer",icon:"",type:"MAIN_HAND",durability:200,maxDurability:200,level:10,description:"Et symbol p guddommelig rett og folkets vilje. Det glitrer med en makt som kan bye selve skjebnen. +20% Flaks.",stats:{luckBonus:.2}},steel_axe:{id:"steel_axe",name:"Stlks",icon:"",type:"AXE",durability:200,maxDurability:200,level:8,description:"Mesterlig stl. +8 Utbytte, 20% raskere arbeid.",stats:{yieldBonus:8,speedBonus:1.2},relevantActions:["CHOP"]},steel_hja:{id:"steel_hja",name:"Stlhj",icon:"",type:"SCYTHE",durability:120,maxDurability:120,level:4,description:"Sylskarp hj. +5 Utbytte, 10% raskere hsting.",stats:{yieldBonus:5,speedBonus:1.1},relevantActions:["WORK","HST"]},stone_sickle:{id:"stone_sickle",name:"Steinsigd",icon:"",type:"SCYTHE",durability:40,maxDurability:40,level:1,description:"Enkel sigd for jordbruk. +1 Utbytte ved kornhsting.",stats:{yieldBonus:1},relevantActions:["WORK"]},blacksmith_hammer:{id:"blacksmith_hammer",name:"Smedhammer",icon:"",type:"HAMMER",durability:200,maxDurability:200,level:5,description:"Mesterverkty. 20% raskere smiing.",stats:{speedBonus:1.2},relevantActions:["CRAFT","REFINE","SMELT"]},shears:{id:"shears",name:"Saks",icon:"",type:"MAIN_HAND",durability:50,maxDurability:50,level:1,description:"Brukt til  klippe sauer. Helt ndvendig for ull-produksjon.",stats:{yieldBonus:2},relevantActions:["GATHER_WOOL"]},iron_sword:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:5,description:"Standard sverd. +10 Angrepskraft.",stats:{attack:10},relevantActions:["DEFEND","PATROL","EXPLORE","HUNT"],nextTierId:"steel_sword"},steel_sword:{id:"steel_sword",name:"Stlsverd",icon:"",type:"MAIN_HAND",durability:250,maxDurability:250,level:10,description:"Ddelig stl. +25 Angrep, 10% raskere hugg.",stats:{attack:25,speedBonus:1.1},relevantActions:["DEFEND","PATROL","EXPLORE","HUNT"]},tunic:{id:"tunic",name:"Slitt Tunika",icon:"",type:"BODY",durability:20,maxDurability:20,level:1,description:"Gammel og hullete. Minimal beskyttelse.",stats:{defense:1},relevantActions:["DEFEND","PATROL"],nextTierId:"leather_armor"},leather_armor:{id:"leather_armor",name:"Lrrustning",icon:"",type:"BODY",durability:80,maxDurability:80,level:3,description:"Herdet skinn. +5 Forsvar.",stats:{defense:5},relevantActions:["DEFEND","PATROL"],nextTierId:"iron_armor"},whetstone:{id:"whetstone",name:"Bryne",icon:"",type:"OFF_HAND",durability:100,maxDurability:100,level:1,description:"Bruk bryne for  holde verkty skarpe. Gir +1 i utbytte p de fleste sanke-oppgaver.",stats:{yieldBonus:1},relevantActions:["CHOP","MINE","QUARRY","WORK","GATHER_WOOL"]},hunting_bow:{id:"hunting_bow",name:"Jaktbue",icon:"",type:"BOW",durability:80,maxDurability:80,level:1,description:"En stdig bue av barlind. +2 Utbytte.",stats:{yieldBonus:2},relevantActions:["HUNT"],nextTierId:"longbow"},longbow:{id:"longbow",name:"Langbue",icon:"",type:"BOW",durability:150,maxDurability:150,level:5,description:"En mektig langbue som krever styrke  spenne. +5 Utbytte, 10% raskere.",stats:{yieldBonus:5,speedBonus:1.1},relevantActions:["HUNT"]},hunting_trap:{id:"hunting_trap",name:"Jaktfelle",icon:"",type:"TRAP",durability:30,maxDurability:30,level:1,description:"En enkel snarefangst-felle. +1 Utbytte ved smviltjakt.",stats:{yieldBonus:1},relevantActions:["HUNT","FORAGE"]},omelette:{id:"omelette",name:"Omelett",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:'En nringsrik frokost. Gir buff: "Lett til beins" (20% mindre stamina kostnad i 15 min).',stats:{},relevantActions:["CONSUME"]},bread:{id:"bread",name:"Brd",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"Ferskt brd fra bakeriet. Gjenoppretter +20 Stamina.",stats:{},relevantActions:["CONSUME"]},minor_stamina_potion:{id:"minor_stamina_potion",name:"Liten Stamina-brygg",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"Gjenoppretter 30 Stamina umiddelbart.",stats:{},relevantActions:["CONSUME"]},herbal_balm:{id:"herbal_balm",name:"Urtebalsam",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"ker sankehastighet med 15% i 10 minutter.",stats:{},relevantActions:["CONSUME"]},focus_brew:{id:"focus_brew",name:"Fokus-brygg",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:2,description:"Reduserer stamina-kostnad med 20% i 15 minutter.",stats:{},relevantActions:["CONSUME"]},strength_tincture:{id:"strength_tincture",name:"Styrke-tinktur",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:2,description:"ker angrepskraft med 10 i 10 minutter.",stats:{},relevantActions:["CONSUME"]},masters_draught:{id:"masters_draught",name:"Mester-drikk",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:3,description:"Mesterens hemmelighet. Gir +50% utbytte i 20 minutter.",stats:{},relevantActions:["CONSUME"]},elixir_of_life:{id:"elixir_of_life",name:"Livseliksir",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:3,description:"En legendarisk eliksir. Gjenoppretter 100 Stamina og 50 HP.",stats:{},relevantActions:["CONSUME"]}},R_={grain:{label:"Kornker",seed:"grain",yieldResource:"grain",duration:3*60*1e3,minYield:12,maxYield:20,xp:20},flax:{label:"Lin-ker",seed:"flax",yieldResource:"flax",duration:5*60*1e3,minYield:8,maxYield:15,xp:35}},Us={farm_house:{id:"farm_house",name:"Grdshuset",icon:"",locationId:"peasant_farm",description:"Ditt personlige hjem. Oppgraderinger gir bedre hvile og mer matlagingsplass.",levels:{1:{requirements:{},unlocks:["SLEEP","EAT"],bonus:"Base hvile"},2:{requirements:{wood:65,gold:130},unlocks:["FARM_UPGRADE"],bonus:"+20% Stamina fra peisen"},3:{requirements:{plank:26,stone:65,gold:390},unlocks:["FARM_UPGRADE_MASTER"],bonus:"+30% Stamina fra senga"},4:{requirements:{plank:65,stone:130,gold:780},unlocks:["FARM_UPGRADE_ELITE"],bonus:"+50% Stamina fra hvile"},5:{requirements:{plank:130,stone:260,gold:1300,iron_ingot:26},unlocks:["FARM_UPGRADE_GODLY"],bonus:"Restaurerer all Stamina ved hvile"}}},sawmill:{id:"sawmill",name:"Sagbruk",icon:"",locationId:"village",description:"Gjr det mulig  foredle Ved til Tmmer.",levels:{1:{requirements:{},unlocks:["REFINE_PLANK_BASIC","hunting_bow"],bonus:"Base produksjon"},2:{requirements:{wood:130,stone:65,gold:130},unlocks:["REFINE_PLANK_FAST"],bonus:"+10% Woodcutting XP"},3:{requirements:{plank:65,stone:195,gold:390},unlocks:["REFINE_PLANK_MASTER","longbow"],bonus:"Lser opp Tier 3 verkty og Langbue"}}},windmill:{id:"windmill",name:"Vindmlle",icon:"",locationId:"village",description:"Gjr det mulig  foredle Korn til Mel mer effektivt.",levels:{1:{requirements:{},unlocks:["REFINE_FLOUR_BASIC"],bonus:"Base produksjon"},2:{requirements:{plank:39,stone:65,gold:195},unlocks:["REFINE_FLOUR_FAST"],bonus:"+10% Farming XP"},3:{requirements:{plank:130,stone:260,gold:650},unlocks:["REFINE_FLOUR_AUTO"],bonus:"Sjanse for dobbel avling"}}},smeltery:{id:"smeltery",name:"Smeltehytte",icon:"",locationId:"village",description:"Gjr det mulig  smelte Jernmalm til Jernbarrer.",levels:{1:{requirements:{},unlocks:["REFINE_IRON_BASIC"],bonus:"Base produksjon"},2:{requirements:{stone:195,wood:130,gold:260},unlocks:["REFINE_IRON_FAST"],bonus:"+10% Mining XP"},3:{requirements:{stone:390,plank:65,gold:780},unlocks:["REFINE_STEEL","glass"],bonus:"Lser opp Stl og Glass"}}},great_forge:{id:"great_forge",name:"Storsmie",icon:"",locationId:"village",description:"Gjr det mulig  lage avanserte verkty og vpen.",levels:{1:{requirements:{},unlocks:["stone_axe","stone_pickaxe","stone_sickle","whetstone","hunting_trap"],bonus:"Base produksjon"},2:{requirements:{iron_ingot:26,plank:39,gold:390},unlocks:["iron_axe","iron_pickaxe","iron_sword","leather_armor","shears","siege_swords","siege_armor"],bonus:"+10% Crafting XP"},3:{requirements:{iron_ingot:130,plank:130,gold:1300},unlocks:["steel_axe","steel_sword","blacksmith_hammer","repair_advanced"],bonus:"Lser opp Mester-utstyr"}}},bakery:{id:"bakery",name:"Bakeri",icon:"",locationId:"village",description:"Gjr det mulig  bake Brd fra Mel.",levels:{1:{requirements:{},unlocks:["CRAFT_BREAD","CRAFT_omelette"],bonus:"Base produksjon"},2:{requirements:{stone:65,plank:26,gold:130},unlocks:["CRAFT_PIE"],bonus:"Bedre stamina fra mat"},3:{requirements:{stone:195,plank:65,gold:520},unlocks:["CRAFT_FEAST"],bonus:"Lser opp Gildemltid"}}},tavern:{id:"tavern",name:"Vertshuset",icon:"",locationId:"village",description:"Et sted for hvile og rykter. ker stamina-regenerering.",levels:{1:{requirements:{},unlocks:["ENTER_TAVERN","REST_BASIC","BUY_MEAL","OPEN_DICE_GAME","OPEN_RESOURCE_GAME","CHAT_LOCAL"],bonus:"Standard hvile"},2:{requirements:{wood:130,stone:65,gold:325},unlocks:["REST_COMFY"],bonus:"Dobbel stamina-regen"},3:{requirements:{plank:65,stone:195,gold:975},unlocks:["REST_ROYAL"],bonus:"Gjenoppretter all stamina raskt"}}},weavery:{id:"weavery",name:"Veveri",icon:"",locationId:"village",description:"Foredler Ull til Stoff for videre salg eller klr.",levels:{1:{requirements:{},unlocks:["REFINE_CLOTH_BASIC"],bonus:"Base produksjon"},2:{requirements:{plank:52,stone:39,gold:195},unlocks:["REFINE_CLOTH_FAST"],bonus:"+10% Trading XP"},3:{requirements:{plank:130,stone:130,gold:520},unlocks:["REFINE_CLOTH_MASTER"],bonus:"Lser opp Silke-produksjon"}}},well:{id:"well",name:"Bybrnn",icon:"",locationId:"village",description:"Gir tilgang til ferskvann for baking og hygiene.",levels:{1:{requirements:{},unlocks:["GATHER_WATER"],bonus:"Basiskilde"},2:{requirements:{stone:65,gold:65},unlocks:["GATHER_WATER_FAST"],bonus:"Bedre vanntilgang"},3:{requirements:{stone:195,gold:260},unlocks:["GATHER_WATER_MASTER"],bonus:"Hellig kilde: +5 Stamina ved drikking"}}},apothecary:{id:"apothecary",name:"Apoteker",icon:"",locationId:"village",description:"Fremstiller medisin og salver.",levels:{1:{requirements:{},unlocks:["REFINE_minor_stamina_potion","REFINE_herbal_balm"],bonus:"Basis urter"},2:{requirements:{wood:130,stone:65,gold:325},unlocks:["REFINE_focus_brew","REFINE_strength_tincture"],bonus:"Gift og Tinkturer"},3:{requirements:{plank:130,glass:65,gold:1300},unlocks:["REFINE_masters_draught","REFINE_elixir_of_life"],bonus:"Mesterverk & Eliksirer"}}},watchtower:{id:"watchtower",name:"Vaktrn",icon:"",locationId:"village",description:"Bedre oversikt og forsvar av landsbyen.",levels:{1:{requirements:{},unlocks:["PATROL"],bonus:"+5 Forsvar"},2:{requirements:{stone:130,plank:65,gold:260},unlocks:["SCOUT"],bonus:"+15 Forsvar"},3:{requirements:{stone:390,plank:130,gold:1040},unlocks:["VOLLEY"],bonus:"Bueskytter-sttte i kamp"}}},stables:{id:"stables",name:"Stall",icon:"",locationId:"village",description:"Muliggjr raskere reise og kavaleri.",levels:{1:{requirements:{},unlocks:["MOUNT_HORSE"],bonus:"Transport"},2:{requirements:{plank:65,wood:65,gold:195},unlocks:["BREED_WARHORSE"],bonus:"Stridshester"},3:{requirements:{plank:195,iron_ingot:26,gold:520},unlocks:["KNIGHT_TRAINING"],bonus:"Riddere"}}},manor_ost:{id:"manor_ost",name:"Slott st",icon:"",locationId:"castle",description:"Setet til den stlige herre. Krever enorme ressurser  bygge.",levels:{1:{requirements:{stone:500,plank:300,iron_ingot:50,gold:1e3},unlocks:["BARON_STATUS"],bonus:"Krav p regionen"}}},manor_vest:{id:"manor_vest",name:"Slott Vest",icon:"",locationId:"castle",description:"Setet til den vestlige herre. Krever enorme ressurser  bygge.",levels:{1:{requirements:{stone:500,plank:300,iron_ingot:50,gold:1e3},unlocks:["BARON_STATUS"],bonus:"Krav p regionen"}}},throne_room:{id:"throne_room",name:"Slottet",icon:"",locationId:"castle",description:"Kongens stol. Den frste Baronen som fullfrer denne blir Konge.",levels:{1:{requirements:{stone:2e3,plank:1e3,iron_ingot:200,gold:5e3},unlocks:["KING_STATUS"],bonus:"Krav p riket"}}},wharf:{id:"wharf",name:"Havnekaia",icon:"",locationId:"dock_hub",description:"Sentrum for maritim handel. Oppgraderinger lser opp flere maritime ressurser og bedre bter.",levels:{1:{requirements:{},unlocks:["OPEN_SHIPYARD","START_SAILING"],bonus:"Grunnleggende sjfart"},2:{requirements:{plank:100,tar:50,gold:5e3},unlocks:["OPEN_WHARF_UPGRADE_MASTER"],bonus:"+20% Fiske-utbytte"},3:{requirements:{plank:250,linen_canvas:100,iron_ingot:100,gold:15e3},unlocks:["OPEN_OCEAN_SAILING"],bonus:"Lser opp Havseilas"}}}},ya={plank:{label:"Planker",icon:"",input:{wood:5},outputResource:"plank",outputAmount:1,buildingId:"sawmill",stamina:10,xp:5,skill:"WOODCUTTING"},flour:{label:"Fint Mel",icon:"",input:{grain:20},outputResource:"flour",outputAmount:10,buildingId:"windmill",stamina:15,xp:8,skill:"FARMING",duration:12e4},iron_ingot:{label:"Jernbarre",icon:"",input:{iron_ore:5,wood:2},outputResource:"iron_ingot",outputAmount:1,buildingId:"smeltery",stamina:20,xp:12,skill:"CRAFTING"},bread:{label:"Bondebrd",icon:"",input:{flour:2},outputResource:"bread",outputAmount:5,buildingId:"bakery",stamina:5,xp:3,skill:"CRAFTING"},pie:{label:"Kjttpai",icon:"",input:{flour:4,meat:2},outputResource:"bread",outputAmount:15,buildingId:"bakery",stamina:15,xp:10,skill:"CRAFTING"},mead:{label:"Mjd",icon:"",input:{honey:5},outputResource:"stamina",outputAmount:20,buildingId:"tavern",stamina:5,xp:5,skill:"CRAFTING"},cloth:{label:"Lin-stoff",icon:"",input:{wool:5},outputResource:"cloth",outputAmount:1,buildingId:"weavery",stamina:15,xp:10,skill:"CRAFTING"},glass:{label:"Glass",icon:"",input:{stone:10,wood:5},outputResource:"glass",outputAmount:1,buildingId:"smeltery",requiredLevel:3,stamina:25,xp:15,skill:"CRAFTING"},minor_stamina_potion:{label:"Liten Stamina-brygg",icon:"",input:{honey:2,glass:1},outputResource:"minor_stamina_potion",outputAmount:1,buildingId:"apothecary",requiredLevel:1,stamina:20,xp:15,skill:"CRAFTING",duration:3e4},herbal_balm:{label:"Urtebalsam",icon:"",input:{wood:5,honey:3},outputResource:"herbal_balm",outputAmount:1,buildingId:"apothecary",requiredLevel:1,stamina:20,xp:15,skill:"CRAFTING",duration:45e3},focus_brew:{label:"Fokus-brygg",icon:"",input:{honey:5,glass:1,grain:10},outputResource:"focus_brew",outputAmount:1,buildingId:"apothecary",requiredLevel:2,stamina:30,xp:30,skill:"CRAFTING",duration:6e4},strength_tincture:{label:"Styrke-tinktur",icon:"",input:{iron_ore:5,honey:5,glass:1},outputResource:"strength_tincture",outputAmount:1,buildingId:"apothecary",requiredLevel:2,stamina:40,xp:40,skill:"CRAFTING",duration:9e4},masters_draught:{label:"Mester-drikk",icon:"",input:{gold:100,honey:10,glass:2},outputResource:"masters_draught",outputAmount:1,buildingId:"apothecary",requiredLevel:3,stamina:60,xp:100,skill:"CRAFTING",duration:18e4},elixir_of_life:{label:"Livseliksir",icon:"",input:{gold:250,honey:20,glass:5},outputResource:"elixir_of_life",outputAmount:1,buildingId:"apothecary",requiredLevel:3,stamina:100,xp:250,skill:"CRAFTING",duration:3e5},linen_canvas:{label:"Seilduk",icon:"",input:{flax:5},outputResource:"linen_canvas",outputAmount:1,buildingId:"weavery",stamina:15,xp:20,skill:"CRAFTING"},tar:{label:"Tjre",icon:"",input:{wood:5},outputResource:"tar",outputAmount:1,buildingId:"smeltery",stamina:20,xp:10,skill:"CRAFTING"},fish_cooked:{label:"Stekt Fisk",icon:"",input:{fish_raw:1},outputResource:"fish_cooked",outputAmount:1,buildingId:"bakery",stamina:10,xp:5,skill:"CRAFTING"}},An={stone_axe:{label:"Steinks",icon:"",input:{stone:13,wood:7,gold:7},outputItemId:"stone_axe",buildingId:"great_forge",level:1,stamina:15,xp:10,description:"Et enkelt redskap for tmmerhogst.",skill:"CRAFTING"},stone_pickaxe:{label:"Steinhakke",icon:"",input:{stone:13,wood:7,gold:7},outputItemId:"stone_pickaxe",buildingId:"great_forge",level:1,stamina:15,xp:10,description:"En primitiv hakke for gruvearbeid.",skill:"CRAFTING"},stone_sickle:{label:"Steinsigd",icon:"",input:{stone:7,wood:7,gold:13},outputItemId:"stone_sickle",buildingId:"great_forge",level:1,stamina:10,xp:5,description:"Enkel sigd for kornhsting.",skill:"CRAFTING"},whetstone:{label:"Bryne",icon:"",input:{stone:20,gold:26},outputItemId:"whetstone",buildingId:"great_forge",level:1,stamina:10,xp:5,description:"Brukt for  slipe verkty og ke utbyttet.",skill:"CRAFTING"},stone_chisel:{label:"Steinmeisel",icon:"",input:{stone:13,gold:13},outputItemId:"stone_chisel",buildingId:"great_forge",level:1,stamina:10,xp:8,description:"Ndvendig for  hugge stein i steinhuggeriet.",skill:"CRAFTING"},iron_chisel:{label:"Jernmeisel",icon:"",input:{iron_ingot:7,gold:104},outputItemId:"iron_chisel",buildingId:"great_forge",level:2,stamina:20,xp:15,description:"Effektiv mesiel for steinhugging.",skill:"CRAFTING"},iron_axe:{label:"Jernks",icon:"",input:{iron_ingot:7,plank:3,gold:65},outputItemId:"iron_axe",buildingId:"great_forge",level:2,stamina:25,xp:20,description:"Et solid verkty av jern.",skill:"CRAFTING"},iron_pickaxe:{label:"Jernhakke",icon:"",input:{iron_ingot:7,plank:3,gold:65},outputItemId:"iron_pickaxe",buildingId:"great_forge",level:2,stamina:25,xp:20,description:"Effektiv hakke for dypere graving.",skill:"CRAFTING"},iron_sword:{label:"Jernsverd",icon:"",input:{iron_ingot:13,plank:3,gold:130},outputItemId:"iron_sword",buildingId:"great_forge",level:2,stamina:40,xp:35,description:"Et skarpt sverd for krigere.",skill:"CRAFTING"},leather_armor:{label:"Lrrustning",icon:"",input:{cloth:13,gold:195},outputItemId:"leather_armor",buildingId:"great_forge",level:2,stamina:30,xp:25,description:"God beskyttelse for en reisende.",skill:"CRAFTING"},shears:{label:"Saks",icon:"",input:{iron_ingot:7,gold:130},outputItemId:"shears",buildingId:"great_forge",level:2,stamina:20,xp:15,description:"Ndvendig for  klippe sauer og f ull.",skill:"CRAFTING"},siege_swords:{label:"Beleiringsvpen (x10)",icon:"",input:{iron_ingot:7,plank:7,gold:65},outputItemId:"siege_sword",outputAmount:10,buildingId:"great_forge",level:2,stamina:40,xp:30,description:"En kasse med vpen til garnisonen.",skill:"CRAFTING"},siege_armor:{label:"Beleiringsrustning (x10)",icon:"",input:{iron_ingot:7,cloth:7,gold:65},outputItemId:"siege_armor",outputAmount:10,buildingId:"great_forge",level:2,stamina:40,xp:30,description:"En kasse med rustninger til garnisonen.",skill:"CRAFTING"},steel_axe:{label:"Stlks",icon:"",input:{iron_ingot:26,plank:13,gold:325},outputItemId:"steel_axe",buildingId:"great_forge",level:3,stamina:50,xp:50,description:"Mesterlig utformet ks av herdet stl.",skill:"CRAFTING"},steel_sword:{label:"Stlsverd",icon:"",input:{iron_ingot:39,plank:7,gold:650},outputItemId:"steel_sword",buildingId:"great_forge",level:3,stamina:80,xp:100,description:"Det ultimate vpenet for en herre.",skill:"CRAFTING"},blacksmith_hammer:{label:"Smedhammer",icon:"",input:{iron_ingot:20,plank:7,gold:260},outputItemId:"blacksmith_hammer",buildingId:"great_forge",level:3,stamina:40,xp:50,description:"Mesterverkty for en ekte smed.",skill:"CRAFTING"},omelette:{label:"Omelett",icon:"",input:{egg:3},outputItemId:"omelette",buildingId:"bakery",level:1,stamina:10,xp:8,description:"En mettende frokost. Gir energi-buff.",skill:"CRAFTING"},hunting_trap:{label:"Jaktfelle",icon:"",input:{wood:13,iron_ingot:3,gold:39},outputItemId:"hunting_trap",buildingId:"great_forge",level:1,stamina:20,xp:15,description:"En enkel snare for smvilt.",skill:"CRAFTING"},hunting_bow:{label:"Jaktbue",icon:"",input:{plank:7,cloth:7,gold:65},outputItemId:"hunting_bow",buildingId:"sawmill",level:1,stamina:25,xp:20,description:"En stdig bue for jakt.",skill:"CRAFTING"},longbow:{label:"Langbue",icon:"",input:{plank:20,cloth:13,iron_ingot:1,gold:325},outputItemId:"longbow",buildingId:"sawmill",level:3,stamina:40,xp:45,description:"En kraftig bue med lang rekkevidde.",skill:"CRAFTING"},cannonball:{label:"Kanonkuler (x5)",icon:"",input:{stone:5,iron_ingot:1,gold:10},outputItemId:"cannonball",outputAmount:5,buildingId:"great_forge",level:2,stamina:30,xp:25,description:"Tunge kuler for skipsartilleri.",skill:"CRAFTING"}},fd={KING:{label:"Konge",description:"Styrer riket, krever skatt og dmmer i store saker."},BARON:{label:"Baron",description:"Styrer en region, krever inn skatt fra bnder, og beskytter mot krig."},PEASANT:{label:"Bonde",description:"Produserer mat og ressurser. Betaler skatt."},SOLDIER:{label:"Soldat",description:"Beskytter riket og deltar i raids."},MERCHANT:{label:"Kjpmann",description:"Tjener penger p handel og markedsspekulasjon."}},_t={grain:{price:.5,stock:800,basePrice:.5,baseStock:800,demand:1},flour:{price:1.75,stock:300,basePrice:1.75,baseStock:300,demand:1},bread:{price:1.2,stock:300,basePrice:1.2,baseStock:300,demand:1},wood:{price:1.25,stock:800,basePrice:1.25,baseStock:800,demand:1},plank:{price:11.25,stock:300,basePrice:11.25,baseStock:300,demand:1},iron_ore:{price:2.5,stock:800,basePrice:2.5,baseStock:800,demand:1},iron_ingot:{price:25,stock:300,basePrice:25,baseStock:300,demand:1},stone:{price:1.25,stock:800,basePrice:1.25,baseStock:800,demand:1},wool:{price:.5,stock:800,basePrice:.5,baseStock:800,demand:1},cloth:{price:10,stock:300,basePrice:10,baseStock:300,demand:1},honey:{price:1,stock:300,basePrice:1,baseStock:300,demand:1},meat:{price:1.5,stock:300,basePrice:1.5,baseStock:300,demand:1},siege_sword:{price:40,stock:100,basePrice:40,baseStock:100,demand:1},siege_armor:{price:40,stock:100,basePrice:40,baseStock:100,demand:1},flax:{price:10,stock:0,basePrice:1,baseStock:800,demand:1},linen_canvas:{price:125,stock:0,basePrice:12.5,baseStock:300,demand:1},tar:{price:162.5,stock:0,basePrice:16.25,baseStock:300,demand:1},fish_raw:{price:20,stock:0,basePrice:2,baseStock:800,demand:1},silk:{price:500,stock:0,basePrice:50,baseStock:50,demand:1},spice:{price:750,stock:0,basePrice:75,baseStock:50,demand:1}},Zz=[{type:"RAID",title:"Vikinger p horisonten!",description:"Et vikingskip er sett nr kysten. Forsvar jordene fr de stjeler kornet!",locationId:"fields"},{type:"RAID",title:"Bandittleir funnet",description:"Banditter har sltt seg ned i skogen. De stjeler ved hver time!",locationId:"forest"},{type:"QUEST",title:"Den Hellige Gral?",description:"Rykter sier en eremitt ved klosteret har funnet noe verdifullt.",locationId:"village"},{type:"QUEST",title:"Markedsdag i nabolaget",description:"En sjelden mulighet for god handel p grensen.",locationId:"marketplace"}],e7=[{id:"tax_cut",label:"Skattekutt",description:"Alle skatter halveres i 10 minutter. Lojaliteten stiger."},{id:"peace",label:"Fredsavtale",description:"Ingen raids tillatt de neste 10 minuttene."},{id:"salt_tax",label:"Saltskatt",description:"ker kornprisene, men reduserer lojalitet."},{id:"conscription",label:"Verneplikt",description:"Soldater koster mindre  verve, men bnder jobber 20% tregere."}],db={skins:[{id:"brown",label:"Rust",color:"#8B4513",price:0},{id:"white",label:"Pearl",color:"#E2E8F0",price:1e3},{id:"black",label:"Void",color:"#1A202C",price:2500},{id:"golden",label:"Gold",color:"#F6E05E",price:5e3},{id:"chestnut",label:"Red",color:"#7C2D12",price:750},{id:"grey",label:"Mist",color:"#94A3B8",price:1200}]},e0={standard:{id:"standard",name:"Snekke",description:"En enkel, men plitelig bt for kystfiske og korte turer.",baseSpeed:5,baseHp:100,cargoSlots:2,maxCannons:0,cost:{plank:50,tar:20}},sloop:{id:"sloop",name:"Slupp",description:"En rask seilbt som balanserer fart og lastekapasitet. Perfekt for handel.",baseSpeed:10,baseHp:250,cargoSlots:4,maxCannons:2,cost:{plank:200,iron_ingot:50,linen_canvas:40,tar:50}},cog:{id:"cog",name:"Kogg",description:"Et tungt handelsskip med bredt skrog. Tler mye juling.",baseSpeed:6,baseHp:600,cargoSlots:8,maxCannons:4,cost:{plank:500,iron_ingot:100,linen_canvas:80,tar:100}},galleon:{id:"galleon",name:"Gallion",description:"Havets ubestridte hersker. En flytende festning.",baseSpeed:8,baseHp:1500,cargoSlots:12,maxCannons:12,cost:{plank:1e3,iron_ingot:300,linen_canvas:150,gold:5e3,silk:50}}},I_={sails:{id:"sails",name:"Seilduk",description:"Forbedret seilduk fanger vinden bedre og ker farten.",levels:[{level:1,cost:{linen_canvas:10},effect:"+10% Fart"},{level:2,cost:{linen_canvas:25,silk:5},effect:"+20% Fart"},{level:3,cost:{linen_canvas:50,silk:20},effect:"+35% Fart"}]},hull:{id:"hull",name:"Skrogforsterkning",description:"Ekstra lag med eik og jernbeslag gir bten mer helse.",levels:[{level:1,cost:{plank:20,tar:5},effect:"+50 HP"},{level:2,cost:{plank:50,iron_ingot:10},effect:"+150 HP"},{level:3,cost:{plank:100,iron_ingot:30},effect:"+350 HP"}]},cannons:{id:"cannons",name:"Kanonbatteri",description:"Bedre kanoner ker skaden og rekkevidden.",levels:[{level:1,cost:{iron_ingot:20,plank:10},effect:"+20 Skade"},{level:2,cost:{iron_ingot:50,plank:25},effect:"+50 Skade"},{level:3,cost:{iron_ingot:100,gold:500},effect:"+100 Skade"}]},nets:{id:"nets",name:"Fiskenot",description:"Strre og sterkere garn ker fangsten per kast.",levels:[{level:1,cost:{linen_canvas:15},effect:"+20% Fangst"},{level:2,cost:{linen_canvas:40},effect:"+50% Fangst"},{level:3,cost:{linen_canvas:80,silk:5},effect:"+100% Fangst"}]}},ju={colors:[{id:"classic_brown",name:"Valntt",hex:"#4b2c20",cost:{}},{id:"royal_red",name:"Kongelig Rd",hex:"#7f1d1d",cost:{gold:100}},{id:"deep_blue",name:"Havdyp Bl",hex:"#1e3a8a",cost:{gold:250}},{id:"midnight_black",name:"Svartedauden",hex:"#0f172a",cost:{gold:500}},{id:"gold_leaf",name:"Bladgull",hex:"#fbbf24",cost:{gold:2e3}}],flags:[{id:"none",name:"Ingen",cost:{}},{id:"pirate",name:"Sjrver",cost:{gold:150}},{id:"merchant",name:"Handelslaug",cost:{gold:300}},{id:"royal",name:"Kongens Vakt",cost:{gold:1e3}}]},zN=Object.freeze(Object.defineProperty({__proto__:null,ACTION_COSTS:Mc,ACTION_ICONS:ic,BOAT_MODELS:e0,BOAT_UPGRADES:I_,COSMETIC_UNLOCKS:ju,CRAFTING_RECIPES:An,CROP_DATA:R_,GAME_BALANCE:re,HORSE_COSMETICS:db,INITIAL_EQUIPMENT:ub,INITIAL_MARKET:_t,INITIAL_RESOURCES:ms,INITIAL_SKILLS:Rn,ITEM_TEMPLATES:Ke,LAW_TEMPLATES:e7,LEVEL_XP:Lm,REFINERY_RECIPES:ya,REPAIR_CONFIG:cb,RESOURCE_DETAILS:ze,REWARDS:oh,ROLE_DEFINITIONS:fd,SEASONS:En,SKILL_DETAILS:Jz,UPGRADES_LIST:C_,VILLAGE_BUILDINGS:Us,WEATHER:Fi,WORLD_EVENT_TEMPLATES:Zz},Symbol.toStringTag,{value:"Module"})),t7=t=>{const e=Object.keys(t),s=[...e].sort(()=>Math.random()-.5),n={...t};if(e.length===0)return n;const r=s.shift();r&&(n[r]={...n[r],role:"KING",resources:JSON.parse(JSON.stringify(ms.KING)),regionId:"capital",status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:100,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:50,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Kongens Verkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Kongens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Kongens Rustning",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}});const l=Math.min(2,s.length);for(let m=0;m<l;m++){const b=s.shift();if(b){const p=m===0?"region_ost":"region_vest";n[b]={...n[b],role:"BARON",resources:JSON.parse(JSON.stringify(ms.BARON)),regionId:p,status:{hp:100,stamina:100,morale:100,legitimacy:80,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:40,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Baronens Verkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Baronens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Baronens Rustning",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}}}}let c=0;const u=()=>{const m=c%2===0?"region_ost":"region_vest";return c++,m},d=s.length;let h=0,f=0;d>=4?(h=Math.max(1,Math.floor(d/6)),f=Math.max(1,Math.floor(d/5))):d>0&&d<4&&(h=0,f=0);for(let m=0;m<h;m++){const b=s.shift();b&&(n[b]={...n[b],role:"MERCHANT",resources:JSON.parse(JSON.stringify(ms.MERCHANT)),regionId:u(),status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:30,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:30,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Hndverkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Kort sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Kjpmannskappe",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}})}for(let m=0;m<f;m++){const b=s.shift();b&&(n[b]={...n[b],role:"SOLDIER",resources:JSON.parse(JSON.stringify(ms.SOLDIER)),regionId:u(),status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:20,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Feltverkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Soldatens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Brynjekofte",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}})}for(;s.length>0;){const m=s.shift();m&&(n[m]={...n[m],role:"PEASANT",resources:JSON.parse(JSON.stringify(ms.PEASANT)),regionId:u(),status:{hp:100,stamina:100,morale:80,legitimacy:100,authority:10,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:10,contribution:0},equipment:{}})}return n},s7=(t,e)=>{const s={...t},n=[];return Object.values(s).forEach(i=>{if(i.role==="PEASANT"){const a=Math.ceil((i.resources.grain||0)*.15),l=Math.ceil((i.resources.gold||0)*(15/100));if(a>0||l>0){const c=Object.values(s).find(u=>u.role==="BARON"&&(u.regionId===i.regionId||i.regionId==="test_region"&&u.regionId==="test_region"));c&&(i.resources.grain=Math.max(0,i.resources.grain-a),i.resources.gold=Math.max(0,i.resources.gold-l),s[c.id].resources.grain+=a,s[c.id].resources.gold+=l,n.push(`${i.name} betalte ${a} korn og ${l} gull i skatt til ${c.name}`))}}}),Object.values(s).forEach(i=>{if(i.role==="BARON"){const r=Math.ceil((i.resources.grain||0)*(e/100)),a=Math.ceil((i.resources.gold||0)*(e/100));if(r>0||a>0){const l=Object.values(s).find(c=>c.role==="KING");l&&(i.resources.grain=Math.max(0,i.resources.grain-r),i.resources.gold=Math.max(0,i.resources.gold-a),s[l.id].resources.grain+=r,s[l.id].resources.gold+=a,n.push(`${i.name} betalte ${r} korn og ${a} gull i skatt til Kongen`))}}}),Object.values(s).forEach(i=>{if(i.role==="MERCHANT"||i.role==="SOLDIER"){const r=i.role==="MERCHANT"?e/50:e/100,a=Math.ceil((i.resources.gold||0)*r);if(a>0){const l=Object.values(s).find(c=>c.role==="KING");l&&(i.resources.gold=Math.max(0,i.resources.gold-a),s[l.id].resources.gold+=a,n.push(`${i.name} (${i.role}) betalte ${a} gull i skatt til Kongen`))}}}),{updatedPlayers:s,results:n}},n7=(t,e)=>{if(!t||Object.keys(t).length===0)return null;const s=re.CONTRIBUTION_VALUES,n=Object.entries(t).map(([a,l])=>{let c=0;return Object.entries(l.resources||{}).forEach(([u,d])=>{c+=d*(s[u]||.1)}),{pid:a,score:c,name:l.name}});n.sort((a,l)=>l.score-a.score);const i=n[0];if(!i)return null;const r=e==="throne_room"?"KING":"BARON";return{winningPlayerId:i.pid,role:r}},i7=(t,e)=>({pin:t,name:e,status:"PLAYING",settings:"feudal_europe",hostName:"Host",isPublic:!0,market:JSON.parse(JSON.stringify(_t)),world:{year:1100,season:"Spring",weather:"Clear",gameTick:0,lastTickAt:Date.now(),taxRateDetails:{kingTax:20},settlement:{buildings:Object.entries(Us).reduce((s,[n])=>({...s,[n]:{id:n,level:0,progress:{},target:200,contributions:{}}}),{})}},markets:{capital:{..._t},region_vest:{..._t},region_ost:{..._t}},players:{},public_profiles:{},messages:[],regions:{region_vest:{id:"region_vest",name:"Baroniet Vest",taxRate:10,defenseLevel:50,rulerName:"Ingen"},region_ost:{id:"region_ost",name:"Baroniet st",taxRate:10,defenseLevel:50,rulerName:"Ingen"}},diplomacy:{},worldEvents:{}}),Pm=async(t,e)=>{var i,r;if(!t||!e)return;const s=q(K,`simulation_server_metadata/${t}`);if(e.isPublic===!1){await pa(s,null);return}const n={pin:t,lastUpdated:Date.now()};e.name&&(n.name=e.name),e.status&&(n.status=e.status),e.players&&(n.playerCount=Object.keys(e.players).length),e.playerCount!==void 0&&(n.playerCount=e.playerCount),(i=e.world)!=null&&i.year&&(n.worldYear=e.world.year),(r=e.world)!=null&&r.season&&(n.season=e.world.season),e.hostName&&(n.hostName=e.hostName),e.isPublic!==void 0&&(n.isPublic=e.isPublic),await ae(s,n)},hb=30,r7=21,a7=120,xR=480,o7=["Spring","Summer","Autumn","Winter"],l7=t=>t%hb,_a=t=>l7(t)<r7?"DAY":"NIGHT",c7=(t,e=0)=>{let s=t;if(e>0){const l=(Date.now()-e)/6e4;s+=Math.min(1,Math.max(0,l))}const i=s%hb/hb*24,r=(6+Math.floor(i))%24,a=Math.floor(i%1*60);return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},u7=t=>{const e=Math.floor(t%xR/a7);return o7[e]||"Spring"},d7=(t,e=1)=>e+Math.floor(t/xR),ra=t=>!t||!t.id?null:Ke[t.id]?t.id:Object.keys(Ke).sort((n,i)=>i.length-n.length).find(n=>t.id.startsWith(n+"_"))||null,bR=(t,e)=>{if(!e)return;const n=(Array.isArray(e)?e:Object.values(e)).filter(i=>{if(!i)return!1;const r=ra(i),a=r?Ke[r]:null,l=i.relevantActions||(a==null?void 0:a.relevantActions);return l==null?void 0:l.includes(t)}).filter(i=>!!i);if(n.length!==0)return n.sort((i,r)=>{var f,m;const a=ra(i),l=ra(r),c=i.stats||(a?(f=Ke[a])==null?void 0:f.stats:{}),u=r.stats||(l?(m=Ke[l])==null?void 0:m.stats:{}),d=(c==null?void 0:c.yieldBonus)||0;return((u==null?void 0:u.yieldBonus)||0)-d})[0]},dt=async(t,e)=>{const s=q(K,`simulation_rooms/${t}/messages`),n={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:e,timestamp:Date.now(),type:"SYSTEM"};try{const i=q(K,`simulation_archives/${t}/full_log`);Fy(i,n)}catch(i){console.error("Critical: Archive log failed:",i)}await De(s,i=>{let r=[];return Array.isArray(i)?r=i:i&&typeof i=="object"&&(r=Object.values(i)),r.push(n),r.length>50&&(r=r.sort((a,l)=>a.timestamp-l.timestamp).slice(r.length-50)),r})},wi=(t,e,s,n={})=>{var b,p;let i=0,r=!1;t.equipment&&Object.keys(t.equipment).forEach(x=>{var k,N;const g=t.equipment[x];if(!g)return;let y=g.relevantActions;if(!y&&g.id){const _=ra(g);_&&(y=(k=Ke[_])==null?void 0:k.relevantActions)}if(!n.actionType||(y==null?void 0:y.includes(n.actionType))){const _=g.stats||(ra(g)?(N=Ke[ra(g)])==null?void 0:N.stats:void 0);_!=null&&_.yieldBonus&&(i+=_.yieldBonus),(x==="AXE"||x==="PICKAXE"||x==="SCYTHE"||x==="MAIN_HAND"||x==="OFF_HAND"||x==="BOW"||x==="TRAP"||x==="CHISEL")&&(r=!0)}});let a=e+i;const l=((b=t.skills)==null?void 0:b[s])||{level:0},c=n.isRefining?re.SKILLS.REFINING_BONUS:re.SKILLS.GATHERING_BONUS,u=1+l.level*c;a*=u;const d=n.actionType==="FORAGE"||n.actionType==="GATHER_HONEY";if(!n.isRefining&&!r&&!d){if(n.requiresTool)return 0;const v=(p=re.GATHERING)==null?void 0:p.NO_TOOL_PENALTY;a*=1-v}let h=1;n.regionId&&(n.actionType==="MINE"&&(n.regionId==="region_vest"?h=1.2:n.regionId==="region_ost"&&(h=.8)),n.actionType==="CHOP"&&(n.regionId==="region_vest"?h=.8:n.regionId==="region_ost"&&(h=1.2)));let f=1;if(t.activeBuffs&&t.activeBuffs.length>0){const v=Date.now(),x=t.activeBuffs.find(g=>g.type==="YIELD_BONUS"&&g.expiresAt>v);x&&(f+=x.value)}const m=(n.season||1)*(n.weather||1)*(n.law||1)*(n.upgrades||1)*h*f;if(a=Math.floor(a*m),n.performance!==void 0){const v=re.MINIGAME.BASE_MULTIPLIER+n.performance*re.MINIGAME.PERFORMANCE_WEIGHT;a=Math.ceil(a*v)}return Math.max(0,a)},Pn=(t,e,s,n,i=0)=>{const r=En[e],a=Fi[s],l=(r==null?void 0:r.staminaMod)||1,c=(a==null?void 0:a.staminaMod)||1,d=_a(i)==="NIGHT"?1.2:1;let f=t*l*c*d;if(n&&n.length>0){const m=Date.now(),b=n.find(p=>p.type==="STAMINA_SAVE"&&p.expiresAt>m);b&&(f*=1-b.value)}return Math.ceil(f)},Kn=(t,e,s,n=1)=>{if(!t||!e||!s)return;const i=s.replace(/\./g,"_"),r=q(K,`simulation_rooms/${t}/stats/${e}`);ae(r,{[i]:Zj(n)}).catch(a=>console.error("Failed to log systemic stat:",a))},h7=async(t,e,s)=>{const{resource:n,type:i,amount:r}=s,a=Math.max(1,Math.floor(r||1)),l=q(K,`simulation_rooms/${t}/players/${e}`),c=await ve(l);if(!c.exists())return{success:!1,error:"Player not found"};const u=c.val(),d=u.regionId||"capital";if((i==="BUY"||i==="MARKET_BUY")&&s.target==="CARAVAN"){const p=u.caravan||{level:1,inventory:{}},v=re.CARAVAN.LEVELS.find(g=>g.level===p.level)||re.CARAVAN.LEVELS[0],x=Object.values(p.inventory||{}).reduce((g,y)=>g+(y||0),0);if(x+a>v.capacity)return{success:!1,error:`Ikke nok plass i karavanen! (${x}/${v.capacity})`}}const h=q(K,`simulation_rooms/${t}/markets/${d}/${n}`);let f={success:!1,amount:0};if(await De(h,p=>{if(!p){const v=_t[n];if(!v)return;p=JSON.parse(JSON.stringify(v))}if(i==="BUY"||i==="MARKET_BUY"){if(p.stock<a)return;f.price=p.price,f.cost=p.price*a,f.amount=a,p.stock-=a;const v=re.MARKET.PRICE_IMPACT_BUY;p.price=p.price*Math.pow(1+v,a),f.success=!0}else if(i==="SELL"||i==="MARKET_SELL"){f.price=p.price;const v=p.price*re.MARKET.SELL_RATIO;f.revenue=v*a,f.amount=a,p.stock+=a;const x=re.MARKET.PRICE_IMPACT_SELL;p.price=p.price*Math.pow(1-x,a),f.success=!0}return p}),!f.success)return{success:!1,error:"Handel feilet (Vare mangler, utsolgt eller for lite p lager)"};let m=!1,b="";return await De(l,p=>{var g,y;if(!p)return;p.resources||(p.resources={});const v=s.target||"BACKPACK",x=s.source||"BACKPACK";if(i==="BUY"||i==="MARKET_BUY"){const w=f.cost||0;if((p.resources.gold||0)<w)return;p.resources.gold=(p.resources.gold||0)-w,v==="CARAVAN"?(p.caravan||(p.caravan={level:1,inventory:{},durability:100,upgrades:[]}),p.caravan.inventory||(p.caravan.inventory={}),p.caravan.inventory[n]=(p.caravan.inventory[n]||0)+a):p.resources[n]=(p.resources[n]||0)+a;const k=ze[n];b=`Kjpte ${a} ${k?k.label:n} for ${w.toFixed(1)}g`,m=!0}else if(i==="SELL"||i==="MARKET_SELL"){const w=f.revenue||0;if(x==="CARAVAN"){if((((y=(g=p==null?void 0:p.caravan)==null?void 0:g.inventory)==null?void 0:y[n])||0)<a)return;p.caravan.inventory[n]-=a}else{if((p.resources[n]||0)<a)return;p.resources[n]-=a}p.resources.gold=(p.resources.gold||0)+w;const k=ze[n];b=`Solgte ${a} ${k?k.label:n} for ${w.toFixed(1)}g`,m=!0}return p}),m?(dt(t,`[${new Date().toLocaleTimeString()}] ${u.name}: ${b}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:b,utbytte:i==="BUY"||i==="MARKET_BUY"?[{resource:n,amount:a}]:[{resource:"gold",amount:f.revenue}],xp:[],durability:[]}}):{success:!1,error:"Transaksjon avbrutt (Mangler ressurser eller gull)"}},f7=async(t,e,s)=>{var x;const{buildingId:n,resource:i,amount:r}=s,a=q(K,`simulation_rooms/${t}/world/settlement/buildings/${n}`),l=q(K,`simulation_rooms/${t}/players/${e}`),c=await ve(l);if(!c.exists())return{success:!1,error:"Player missing"};const u=c.val();if((((x=u.resources)==null?void 0:x[i])||0)<r)return{success:!1,error:"Not enough resources"};let d=!1,h=0,f="",m=!1,b=0,p="Ukjent feil i transaksjon";if(await De(a,g=>{var M,F,U,C;g||(g={id:n,level:0,progress:{},contributions:{}});const y=Us[n];if(!y){p=`Systemfeil: BuildingDef mangler for ID: ${n}`;return}f=(y==null?void 0:y.name)||n;const w=Number(g.level??0),k=g.progress&&Object.keys(g.progress).length>0,N=g.contributions&&Object.keys(g.contributions).length>0,_=!((M=y.levels)!=null&&M[w+1]);let T=!1;_&&(k||N)&&(console.log(`[Auto-Repair] Building ${n} is stuck at Level ${w}. Resetting to 0 to enable completion.`),g.level=0,T=!0);const E=Number(g.level??0),A=E+1,R=(F=y==null?void 0:y.levels)==null?void 0:F[A];if(!R)return p=`Bygget er ferdig (Level ${E}). Ingen flere oppgraderinger tilgjengelig.`,T?g:void 0;const I=((U=R.requirements)==null?void 0:U[i])||0,V=((C=g.progress)==null?void 0:C[i])||0,H=I-V;let P=!0;if(Object.entries(R.requirements).forEach(([j,$])=>{(g.progress[j]||0)<$&&(P=!1)}),H<=0&&!P)return p=`Fullt lager for ${i}. (Krav: ${I}, Har: ${V}, Niv: ${E}->${A})`,T?g:void 0;h=Math.min(r,H),g.progress||(g.progress={}),g.progress[i]=V+h,g.contributions||(g.contributions={}),g.contributions[e]||(g.contributions[e]={name:u.name,resources:{}});const O=g.contributions[e].resources;O[i]=(O[i]||0)+h;let L=!0;if(Object.entries(R.requirements).forEach(([j,$])=>{(g.progress[j]||0)<$&&(L=!1)}),L){g.level=A,g.progress={};const j=R.unlocks||[];if(j.includes("BARON_STATUS")||j.includes("KING_STATUS")){const $=n7(g.contributions,n);$&&(g.pendingWinnerId=$.winningPlayerId,g.pendingRole=$.role)}g.contributions={},m=!0,b=A}return d=!0,Kn(t,"contributions",i,h),g}),!d)return{success:!1,error:`${p}`};if(m){const y=(await ve(a)).val();if(y.pendingWinnerId){const w=y.pendingWinnerId,k=y.pendingRole,N=q(K,`simulation_rooms/${t}/players/${w}`),T=(await ve(N)).val(),E=q(K,`simulation_rooms/${t}`),A={};if(A[`players/${w}/role`]=k,A[`public_profiles/${w}/role`]=k,k==="BARON"){const I=n==="manor_ost"?"region_ost":"region_vest";A[`players/${w}/regionId`]=I,A[`public_profiles/${w}/regionId`]=I,A[`regions/${I}/rulerId`]=w,A[`regions/${I}/rulerName`]=T.name}else if(k==="KING"){A[`players/${w}/regionId`]="capital",A[`public_profiles/${w}/regionId`]="capital",A["regions/capital/rulerId"]=w,A["regions/capital/rulerName"]=T.name;const I=await ve(q(K,`simulation_rooms/${t}/regions`));let V=null;if(I.exists()){const P=I.val();Object.entries(P).forEach(([O,L])=>{L.rulerId===w&&O!=="capital"&&(V=O,A[`regions/${O}/rulerId`]=null,A[`regions/${O}/rulerName`]="VAKANT")})}const H=await ve(q(K,`simulation_rooms/${t}/players`));if(H.exists()){const P=H.val();Object.entries(P).forEach(([O,L])=>{L.role==="KING"&&O!==w&&(A[`players/${O}/role`]="PEASANT",A[`public_profiles/${O}/role`]="PEASANT",L.status&&(A[`players/${O}/status/legitimacy`]=0))})}await ae(E,A),V&&await p7(t,V)}else await ae(E,A);await ae(E,A);const R=` ${T.name} har fullfrt ${f} og er n utnevnt til ${k==="BARON"?"Baron":"Konge"}!`;dt(t,R),await ae(a,{pendingWinnerId:null,pendingRole:null})}}let v=`Bidro med ${h} ${i} til ${f}`;return m&&(v+=`  ${f} ndde niv ${b}!`),await De(l,g=>{var y;if(g)return((y=g.resources)==null?void 0:y[i])>=h&&(g.resources[i]-=h),g}),dt(t,`[${new Date().toLocaleTimeString()}] ${u.name}: ${v}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:v,utbytte:[{resource:i,amount:-h}],xp:[],durability:[]}}},m7=async(t,e,s)=>{const n=q(K,`simulation_rooms/${t}/players/${e}`),i=await ve(n);if(!i.exists())return{success:!1,error:"Spiller finnes ikke"};const r=i.val(),a=s.type||"TAX",l=r.role==="KING"||a==="TAX_ROYAL",c=s.taxRate!==void 0?s.taxRate:10,u=c/100,d=q(K,`simulation_rooms/${t}/players`),h=await ve(d);if(!h.exists())return{success:!1,error:"Ingen spillere i rommet"};const f=h.val();let m=0,b=0,p=0;const v=(r.regionId||"").trim().toLowerCase(),x=Object.entries(f).map(async([I,V])=>{if(I===e)return;const H=(V.regionId||"").trim().toLowerCase();if(!(l?V.role==="BARON":V.role==="PEASANT"&&(H===v||H.includes(v)||v.includes(H))))return;const O=q(K,`simulation_rooms/${t}/players/${I}`);let L={goldFloat:0,grainFloat:0};await De(O,M=>{var $,B,D;if(!M)return;M.resources||(M.resources={gold:0,grain:0});const F=Number(M.resources.gold??M.gold??M.wealth??(($=M.stats)==null?void 0:$.gold)??((D=(B=M.inventory)==null?void 0:B.find(z=>z.id==="gold"))==null?void 0:D.amount)??0),U=Number(M.resources.grain??0),C=F*u,j=U*u;if(C>0){const z=Math.floor(C);M.resources.gold!==void 0?M.resources.gold-=z:M.gold!==void 0&&(M.gold-=z),L.goldFloat=C}if(j>0){const z=Math.floor(j);M.resources.grain-=z,L.grainFloat=j}return M}),(L.goldFloat>0||L.grainFloat>0)&&(p++,m+=L.goldFloat,b+=L.grainFloat)});await Promise.all(x);const g=Math.floor(m),y=Math.floor(b);await De(n,I=>{if(!I)return;I.resources||(I.resources={gold:0,grain:0}),I.resources.gold=(I.resources.gold||0)+g,I.resources.grain=(I.resources.grain||0)+y;const V=Math.max(0,5+Math.floor((c-10)/2));return I.status.legitimacy=Math.max(0,(I.status.legitimacy||100)-V),I});const w=Date.now(),k=q(K,`simulation_rooms/${t}/world`),_=(await ve(k)).val()||{year:1,season:"Spring"},T=_.year||1,E=_.season||"Spring",A={year:T,season:E,amountGold:g,amountGrain:y,rate:c,timestamp:w};if(l){const I={};I.lastRoyalTaxCollection={year:T,season:E},_.taxRateDetails?I["taxRateDetails/kingTax"]=c:I.taxRateDetails={kingTax:c},await ae(k,I);const V=q(K,`simulation_rooms/${t}/world/royalTaxHistory`),H=await ve(V),P=H.exists()?H.val():[];P.push(A),P.length>10&&P.shift(),await pa(V,P)}else{const I=q(K,`simulation_rooms/${t}/regions/${r.regionId}`),V={};V.taxRate=c,V.lastTaxCollection={year:T,season:E},await ae(I,V);const H=q(K,`simulation_rooms/${t}/regions/${r.regionId}/taxHistory`),P=await ve(H),O=P.exists()?P.val():[];O.push(A),O.length>10&&O.shift(),await pa(H,O)}const R=l?`Kongelig Skatt (${c}%): ${g}g og ${y} korn fra ${p} baroner.`:`Skatteinnkreving (${c}%): ${g}g og ${y} korn fra ${p} bnder.`;return dt(t,`[${new Date().toLocaleTimeString()}] ${r.name}: ${R}`),{success:!0,data:{success:!0,timestamp:w,message:R,utbytte:[{resource:"gold",amount:g},{resource:"grain",amount:y}],xp:[],durability:[]}}},Sse=async(t,e,s)=>{const n=q(K,`simulation_rooms/${t}/players/${e}`),i=await ve(n);if(!i.exists())return{success:!1,error:"Fant ikke spilleren."};const r=i.val();if(r.role!=="PEASANT")return{success:!1,error:"Du har alt en karriere."};if(s!=="SOLDIER"&&s!=="MERCHANT")return{success:!1,error:"Ugyldig karrierevalg."};const a=re.CAREERS[s];if(r.stats.level<a.LEVEL_REQ)return{success:!1,error:`Du m vre level ${a.LEVEL_REQ} for  bli ${s==="SOLDIER"?"Soldat":"Kjpmann"}.`};if((r.resources.gold||0)<a.COST)return{success:!1,error:`Du mangler ${a.COST-(r.resources.gold||0)} gull.`};let l=!1;return await De(n,c=>{if(c&&!(c.resources.gold<a.COST))return c.resources.gold-=a.COST,c.role=s,l=!0,c}),l?(dt(t,`[KARRIERE] ${r.name} er n en ${s}!`),{success:!0,message:`Gratulerer! Du er n en ${s==="SOLDIER"?"Soldat":"Kjpmann"}.`}):{success:!1,error:"Transaksjon feilet."}},p7=async(t,e)=>{const s=q(K,`simulation_rooms/${t}/regions/${e}`);await De(s,n=>{if(n)return n.activeElection||(n.coup||(n.coup={}),n.coup.bribeProgress=80),n}),dt(t,` MAKT-VAKUUM: Baroniet i ${e==="region_ost"?"st":"Vest"} str uten leder! Det er kaos i gatene.`)},g7=async(t,e)=>{const s=q(K,`simulation_rooms/${t}/regions/${e}`);let n=!1,i=null,r="";if(await De(s,u=>{var d;if(u&&!u.activeElection&&!((((d=u.coup)==null?void 0:d.bribeProgress)||0)<100))return i=u.rulerId,r=u.rulerName,u.rulerId=null,u.rulerName="VAKANT",n=!0,u}),!n)return;if(Kn(t,"coups","start",1),i){const u=q(K,`simulation_rooms/${t}/players/${i}`);await De(u,d=>{if(d)return d.role="PEASANT",d.status&&(d.status.legitimacy=0),d}),await ae(q(K,`simulation_rooms/${t}/public_profiles/${i}`),{role:"PEASANT"})}const l=(await ve(s)).val(),c=await vR(t,e,l);i?dt(t,` REVOLUSJON i ${l.name}! ${r} er styrtet. ${c} skyggelfter ble automatisk talt opp!`):dt(t,` PENT VALG! Kaoset i ${l.name} har tvunget frem et nyvalg. ${c} forhndsstemmer talt opp.`)},x7=async(t,e)=>{if(!e||e==="capital")return;const s=q(K,`simulation_rooms/${t}/regions/${e}`),i=(await ve(s)).val();if(!i)return;await vR(t,e,i)>-1?dt(t,` SUKSESSJON: Baroniet ${i.name} er ledig etter eierens kroning. Et nytt valg er i gang!`):dt(t,` SUKSESSJON: Baroniet ${i.name} er ledig og kan n kreves.`)};async function vR(t,e,s){var f,m;const n={},i=((f=s.coup)==null?void 0:f.contributions)||{},r=((m=s.coup)==null?void 0:m.preVotes)||{};if(Object.entries(i).sort((b,p)=>p[1].amount-b[1].amount).slice(0,3).forEach(([b,p])=>{n[b]={id:b,name:p.name,votes:0,weightedVotes:0,contribution:p.amount}}),Object.keys(n).length===0)return await ae(q(K,`simulation_rooms/${t}/regions/${e}`),{rulerId:null,rulerName:"VAKANT",activeElection:null,"coup/bribeProgress":0,"coup/preVotes":null}),-1;const a=Date.now(),l={startedAt:a,expiresAt:a+re.COUP.VACANCY_DURATION,candidates:n,votes:{}};let c=0;const u=q(K,`simulation_rooms/${t}/players`),h=(await ve(u)).val()||{};return Object.entries(r).forEach(([b,p])=>{if(n[p]){const v=h[b];if(v){let x=re.COUP.PEASANT_VOTE_WEIGHT;v.role==="KING"&&(x=re.COUP.KING_VOTE_WEIGHT),l.votes[b]={candidateId:p,weight:x},n[p].votes+=1,n[p].weightedVotes+=x,c++}}}),await ae(q(K,`simulation_rooms/${t}/regions/${e}`),{rulerId:null,rulerName:"VAKANT",activeElection:l,"coup/bribeProgress":0,"coup/preVotes":null}),c}const Tse=async(t,e,s)=>{var w,k;const{regionId:n,amount:i}=s,r=q(K,`simulation_rooms/${t}/regions/${n}`),a=q(K,`simulation_rooms/${t}/players/${e}`),l=await ve(a);if(!l.exists())return{success:!1,error:"Fant ikke spilleren."};const c=l.val();if((((w=c.resources)==null?void 0:w.gold)||0)<i)return{success:!1,error:"Du har ikke nok gull."};const d=(await ve(r)).val();if(!d)return{success:!1,error:"Region finnes ikke."};let h=null;if(n==="region_ost"?h="manor_ost":n==="region_vest"?h="manor_vest":n==="capital"&&(h="throne_room"),!d.rulerId&&h){const N=q(K,`simulation_rooms/${t}/world/settlement/buildings/${h}`),_=await ve(N);if((_.exists()&&_.val().level||0)<1)return{success:!1,error:"Slottet i denne regionen er ikke ferdigbygget. Du m bygge det for  kreve tittelen!"}}const f=((k=d.coup)==null?void 0:k.lastRulerChange)||0,m=Date.now();if(m-f<re.COUP.HONEYMOON_DURATION&&c.role!=="KING")return{success:!1,error:`Regionen er for stabil. Prv igjen om ${Math.ceil((re.COUP.HONEYMOON_DURATION-(m-f))/6e4)} minutter.`};if(d.activeElection)return{success:!1,error:"Et valg pgr allerede."};let b=0,p=!1;if(await De(r,N=>{N||(N={id:n,name:n==="capital"?"Kongeriket":n==="region_vest"?"Baroniet Vest":"Baroniet st",rulerName:"Ingen",coup:{lastRulerChange:0,bribeProgress:0,contributions:{}}}),N.coup||(N.coup={lastRulerChange:0,bribeProgress:0,contributions:{}}),N.garrison||(N.garrison={swords:0,armor:0,morale:100}),N.fortification||(N.fortification={hp:1e3,maxHp:1e3,level:1});const _=N.coup.bribeProgress||0,T=i/re.COUP.BASE_BRIBE_COST*10;return e===d.rulerId?N.coup.bribeProgress=Math.max(0,_-T):(N.coup.bribeProgress=Math.min(100,_+T),N.coup.challengerId=e,N.coup.challengerName=c.name),N.coup.contributions||(N.coup.contributions={}),N.coup.contributions[e]||(N.coup.contributions[e]={name:c.name,amount:0}),N.coup.contributions[e].amount+=i,b=N.coup.bribeProgress,p=!0,N}),!p)return{success:!1,error:"Transaksjon feilet (Region oppdatert)."};await De(a,N=>{if(N)return N.resources.gold=(N.resources.gold||0)-i,N});const v=q(K,`simulation_rooms/${t}/players`),x=await ve(v);let g={};x.exists()&&(g=x.val());let y=d.rulerId;if(!y&&Object.keys(g).length>0){if(n==="capital"){const N=Object.values(g).find(_=>_.role==="KING");N&&(y=N.id)}else{const N=Object.values(g).find(_=>_.role==="BARON"&&_.regionId===n);N&&(y=N.id)}y&&await ae(r,{rulerId:y})}if(y){const N=q(K,`simulation_rooms/${t}/players/${y}`),_=Math.floor(i/100);await De(N,T=>{if(T)return T.status&&(T.status.legitimacy=Math.max(0,(T.status.legitimacy||0)-_)),T})}if(Object.keys(g).length>0){const N=Object.keys(g).filter(_=>g[_].regionId===n&&_!==e&&(g[_].role==="PEASANT"||g[_].role==="SOLDIER"));if(N.length>0){const _=Math.floor(i/N.length);_>0&&await Promise.all(N.map(T=>{const E=q(K,`simulation_rooms/${t}/players/${T}/resources`);return ae(E,{gold:Zj(_)})})),dt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g i ${d.name}. ${N.length} innbyggere fikk ${_}g hver! (Kaos: ${b.toFixed(0)}%)`)}else dt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g til saken i ${d.name}. Ingen trengende funnet. (Kaos: ${b.toFixed(0)}%)`)}else dt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g. (Kaos: ${b.toFixed(0)}%)`);return b>=100?(await g7(t,n),{success:!0,message:`Revolusjon utlst! Kaos: ${b.toFixed(1)}%`}):{success:!0,message:`Besteikkelse gjennomfrt. Kaos: ${b.toFixed(1)}%`}},Ese=async(t,e,s,n)=>{const i=q(K,`simulation_rooms/${t}/regions/${s}`);let r=!1;return await De(i,a=>{if(a)return a.coup||(a.coup={bribeProgress:0,contributions:{},preVotes:{}}),a.coup.preVotes||(a.coup.preVotes={}),a.coup.preVotes[e]=n,r=!0,a}),r?{success:!0,message:"Skyggelfte avgitt!"}:{success:!1,error:"Kunne ikke avgi lfte."}},Ase=async(t,e,s)=>{const n=q(K,`simulation_rooms/${t}/regions/${s}`),i=q(K,`simulation_rooms/${t}/players/${e}`),r=re.COUP.RESTORE_ORDER_COST,a=await ve(i);if(!a.exists())return{success:!1,error:"Spiller mangler"};const l=a.val();if(l.resources.gold<r)return{success:!1,error:`Trenger ${r}g for  gjenopprette ro.`};let c=!1;return await De(n,u=>{if(!(!u||u.rulerId!==e)&&u.coup)return u.coup.bribeProgress=Math.max(0,(u.coup.bribeProgress||0)-25),c=!0,u}),c?(await De(i,u=>{if(u)return u.resources.gold-=r,u.status.legitimacy=Math.min(100,(u.status.legitimacy||0)+10),u}),dt(t,` ${l.name} har gjenopprettet ro i ${s} ved  dele ut midler til vaktene.`),{success:!0,message:"Ro gjenopprettet (-25% opprr)"}):{success:!1,error:"Kunne ikke gjenopprette ro."}},jse=async(t,e,s)=>{const{regionId:n,candidateId:i}=s,r=q(K,`simulation_rooms/${t}/regions/${n}`),a=q(K,`simulation_rooms/${t}/players/${e}`),l=await ve(a);if(!l.exists())return{success:!1};const c=l.val();let u=re.COUP.PEASANT_VOTE_WEIGHT;c.role==="KING"&&(u=re.COUP.KING_VOTE_WEIGHT);let d=!1;return await De(r,h=>{if(!h||!h.activeElection||Date.now()>h.activeElection.expiresAt)return;h.activeElection.votes||(h.activeElection.votes={});const f=h.activeElection.votes[e];if(f){const b=h.activeElection.candidates[f.candidateId];b&&(b.votes=Math.max(0,(b.votes||0)-1),b.weightedVotes=Math.max(0,(b.weightedVotes||0)-f.weight))}h.activeElection.votes[e]={candidateId:i,weight:u};const m=h.activeElection.candidates[i];return m&&(m.votes=(m.votes||0)+1,m.weightedVotes=(m.weightedVotes||0)+u),d=!0,h}),{success:d}},b7=async(t,e,s)=>{const{newRate:n}=s,i=q(K,`simulation_rooms/${t}/players/${e}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Spiller mangler"};const a=r.val(),l=a.regionId||"capital",c=q(K,`simulation_rooms/${t}/regions/${l}`),u=Math.max(0,Math.min(20,n));await ae(c,{taxRate:u});const d=`Skatteniv i ${l} satt til ${u}%.`;return dt(t,`[${new Date().toLocaleTimeString()}] ${a.name}: ${d}`),{success:!0,data:{message:d}}},Cse=async(t,e)=>{const s=q(K,`simulation_rooms/${t}/regions/${e}`),i=(await ve(s)).val(),r=(i==null?void 0:i.name)||e;let a=null;if(await De(s,l=>{if(!l||!l.activeElection||Date.now()<l.activeElection.expiresAt)return;const c=Object.values(l.activeElection.candidates);if(c.length===0)return l.rulerId=null,l.rulerName="Ingen Hersker",l.activeElection=null,l;const u=c.sort((d,h)=>h.weightedVotes-d.weightedVotes)[0];return a={winnerId:u.id,winnerName:u.name},l.rulerId=u.id,l.rulerName=u.name,l.activeElection=null,l.coup||(l.coup={lastRulerChange:Date.now(),bribeProgress:0,contributions:{}}),l.coup.lastRulerChange=Date.now(),l.coup.bribeProgress=0,l.coup.contributions={},l}),a){Kn(t,"coups","success",1);const l=a.winnerId,c=q(K,`simulation_rooms/${t}/players/${l}`),d=(await ve(c)).val(),h=q(K,`simulation_rooms/${t}`),f=e==="capital",m=f?"KING":"BARON",b=f?"Konge":"Baron",p={};return p[`players/${l}/role`]=m,p[`players/${l}/regionId`]=e,p[`public_profiles/${l}/role`]=m,p[`public_profiles/${l}/regionId`]=e,await ae(h,p),dt(t,` KRONING: ${d.name} har vunnet valget og er n ${b} av ${r}!`),{success:!0}}return{success:!1}},v7=async(t,e,s)=>{const n=q(K,`simulation_rooms/${t}/players/${e}`);let i=!1;return await De(n,r=>{if(r)return r.resources||(r.resources={}),r.resources.gold=(r.resources.gold||0)+s,i=!0,r}),i&&dt(t,` ADMIN: Gitt ${s}g til en spiller.`),{success:i}},y7=async(t,e,s,n)=>{const i=q(K,`simulation_rooms/${t}/players/${e}`),r=Ke[s];if(!r)return{success:!1,error:"Invalid Item ID"};let a=!1;return await De(i,l=>{if(l){l.inventory||(l.inventory=[]);for(let c=0;c<n;c++){const u=JSON.parse(JSON.stringify(r));u.instanceId=`${s}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,l.inventory.push(u)}return a=!0,l}}),a&&dt(t,` ADMIN: Gitt ${n}x ${r.name} til en spiller.`),{success:a}},_7=async(t,e,s,n)=>{const i=q(K,`simulation_rooms/${t}/players/${e}`);let r=!1;return await De(i,a=>{if(a)return a.resources||(a.resources={}),a.resources[s]=(a.resources[s]||0)+n,a.resources[s]<0&&(a.resources[s]=0),r=!0,a}),r&&dt(t,` ADMIN: Gitt ${n}x ${s} til en spiller.`),{success:r}},w7=async(t,e,s,n)=>{var d;const i=q(K,`simulation_rooms/${t}/players/${e}`),r=q(K,`simulation_rooms/${t}/channels/${n}/messages`),a=await ve(i);if(!a.exists())return{success:!1,error:"Spiller mangler"};const l=a.val();let c=0;if(l.role!=="KING"&&(n==="global"?c=2:n!==l.regionId&&n!=="diplomacy"&&n.includes(e)&&n.length>20&&(c=5)),(((d=l.resources)==null?void 0:d.gold)||0)<c)return{success:!1,error:`Trenger ${c}g for  sende denne meldingen.`};let u=!1;if(c>0?await De(i,h=>{if(h&&!((h.resources.gold||0)<c))return h.resources.gold-=c,u=!0,h}):u=!0,!u)return{success:!1,error:"Har ikke rd."};try{const h=Fy(r);return await ae(h,{id:h.key,senderId:e,senderName:l.name,senderRole:l.role,content:s.trim(),timestamp:JB(),isPremiere:c>0}),{success:!0}}catch(h){return console.error("Chat Send Error:",h),{success:!1,error:`Kunne ikke sende melding: ${h.message||"Ukjent feil"}`}}},k7=async(t,e,s)=>{const{targetRegionId:n}=s,i=q(K,`simulation_rooms/${t}/players/${e}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Spiller finnes ikke"};const a=r.val();if(a.regionId===n)return{success:!1,error:"Du er allerede i denne regionen."};const l=Mc.TRAVEL_START;return(a.status.stamina||0)<(l==null?void 0:l.stamina)?{success:!1,error:"For sliten for reise."}:(a.resources.bread||0)<(l==null?void 0:l.bread)?{success:!1,error:"Trenger mer niste (brd) for reisen."}:(await De(i,c=>{if(c)return c.status.stamina-=l==null?void 0:l.stamina,c.resources.bread-=l==null?void 0:l.bread,c}),dt(t,`[VEIEN] ${a.name} har lagt ut p reise mot ${n}...`),{success:!0,data:{success:!0,message:"Reisen har begynt!",utbytte:[],xp:[],durability:[]}})},N7=async(t,e,s)=>{const{targetRegionId:n,finalDurability:i}=s,r=q(K,`simulation_rooms/${t}/players/${e}`),a=await ve(r);if(!a.exists())return{success:!1,error:"Spiller finnes ikke"};const l=a.val();let c=0;await De(r,d=>{if(d)return d.regionId=n,typeof i=="number"&&(d.caravan||(d.caravan={level:1,inventory:{},durability:100,upgrades:[]}),d.caravan.durability=Math.max(0,i),c=d.caravan.durability),d}),await ae(q(K,`simulation_rooms/${t}/public_profiles/${e}`),{regionId:n});const u=n==="capital"?"Hovedstaden":n==="region_vest"?"Vestfjella":"stlandet";return dt(t,`[VEIEN] ${l.name} har ankommet ${u}. (Slitasje: ${Math.round(c)})`),{success:!0,data:{success:!0,message:`Ankommet ${u}!`,utbytte:[],xp:[{skill:"TRADING",amount:25}],durability:[]}}},wa=t=>{if(!t.basePrice||!t.baseStock)return t.price;const e=Math.max(1,t.stock),s=t.baseStock/e;let n=Math.pow(s,1.25);return n=Math.min(10,Math.max(.2,n)),t.basePrice*n},qN=(t,e,s)=>{let n=0;const i={...t},r=s?-1:1;for(let a=0;a<e;a++){const l=wa(i);if(n+=s?l:l*re.MARKET.SELL_RATIO,i.stock+=r,i.stock<0)break}return n},S7=t=>{var f;const{actor:e,room:s,action:n,localResult:i}=t,{resource:r}=n,a=e.regionId||"capital";let l=((f=s.markets)==null?void 0:f[a])||s.market;const c=["iron","swords","armor"];let u=!1;if(c.forEach(m=>{l[m]&&(delete l[m],u=!0)}),Object.keys(_t).forEach(m=>{l[m]||(l[m]=JSON.parse(JSON.stringify(_t[m])),u=!0)}),u&&s.markets&&(s.markets[a]=l),!l)return i.success=!1,i.message="Markedet er ikke tilgjengelig.",!1;if(!l[r])return i.success=!1,i.message="Markedet tilbyr ikke denne varen her.",!1;const d=l[r];if(!d)return i.success=!1,i.message="Varen finnes ikke p dette markedet.",!1;const h=wa(d);return d.stock<=0?(i.success=!1,i.message="Varen er utsolgt.",!1):(e.resources.gold||0)<h?(i.success=!1,i.message=`Du har ikke nok gull. Trenger ${h.toFixed(2)}g`,!1):(e.resources.gold=(e.resources.gold||0)-h,e.resources[r]=(e.resources[r]||0)+1,d.stock-=1,d.price=wa(d),i.message=`Kjpte 1 ${r} for ${h.toFixed(2)}g`,i.utbytte.push({resource:r,amount:1}),!0)},T7=t=>{var f;const{actor:e,room:s,action:n,localResult:i}=t,{resource:r}=n,a=e.regionId||"capital";let l=((f=s.markets)==null?void 0:f[a])||s.market;if(!l){s.markets||(s.markets={});const m=JSON.parse(JSON.stringify(_t)),p={region_vest:{discount:["iron_ore","stone","swords"],premium:["grain","bread","cloth"]},region_ost:{discount:["grain","bread","wool","meat"],premium:["iron_ore","tools","wood"]},capital:{discount:["luxury_goods","glass"],premium:["raw_materials","wood","stone"]}}[a]||{discount:[],premium:[]};Object.keys(m).forEach(v=>{p.discount.includes(v)&&(m[v].price*=.6,m[v].stock*=1.5),p.premium.includes(v)&&(m[v].price*=1.4,m[v].stock*=.7),m[v].price*=.9+Math.random()*.2}),l=m,s.markets[a]=l}if(!l)return i.success=!1,i.message="Markedet er ikke tilgjengelig.",!1;if(!l[r]||!l[r])return i.success=!1,i.message="Markedet tar ikke imot denne varen her.",!1;const c=e.resources[r]||0;if(typeof c!="number"||c<1)return i.success=!1,i.message=`Du har ingen ${r}  selge.`,!1;const u=l[r];if(!u)return i.success=!1,i.message="Markedet tar ikke imot denne varen.",!1;const h=wa(u)*re.MARKET.SELL_RATIO;return e.resources[r]-=1,e.resources.gold=(e.resources.gold||0)+h,u.stock+=1,u.price=wa(u),i.message=`Solgte 1 ${r} for ${h.toFixed(2)}g`,!0},E7=t=>{var b,p;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,{resource:a,targetRegionId:l,action:c}=n,u=e.regionId||"capital",d=((b=s.markets)==null?void 0:b[u])||s.market,h=(p=s.markets)==null?void 0:p[l];if(!d||!h||!d[a]||!h[a])return i.success=!1,i.message="Ugyldig handelsrute eller vare.",!1;const f=d[a],m=h[a];if(!f||!m)return i.success=!1,i.message="Varen handles ikke p disse markedene.",!1;if(c==="IMPORT"){const x=qN(m,5,!0);if((e.resources.gold||0)<x)return i.success=!1,i.message=`Ikke nok gull. Trenger ${x.toFixed(2)}g for 5stk.`,!1;for(let g=0;g<5;g++)m.stock-=1,m.price=wa(m);e.resources.gold-=x,e.resources[a]=(e.resources[a]||0)+5,i.message=`Bulk-Import: 5 ${a} fra ${l} for ${x.toFixed(2)}g`}else{if((e.resources[a]||0)<5)return i.success=!1,i.message=`Mangler 5 ${a} for eksport.`,!1;const x=qN(m,5,!1);for(let g=0;g<5;g++)m.stock+=1,m.price=wa(m);e.resources[a]-=5,e.resources.gold+=x,i.message=`Bulk-Eksport: 5 ${a} til ${l} for ${x.toFixed(2)}g`}return r("TRADING",25),!0},A7=t=>{t&&Object.keys(t).forEach(e=>{const s=t[e];if(!(!s||!s.baseStock)&&s.stock>s.baseStock*.1){const n=s.stock*.003;s.stock=Math.max(0,s.stock-n),s.price=wa(s)}})},yR=(t,e,s,n)=>{S.useEffect(()=>{if(!t||e==="LOBBY")return;const i=setInterval(async()=>{const r=Date.now(),a=(s==null?void 0:s.lastTickAt)||0;if(!(r-a<1e3))if(r-a>=6e4){const l=q(K,`simulation_rooms/${t}/world`);try{let c=null;await De(l,u=>{if(!u)return;const d=u.lastTickAt||0;if(Date.now()-d>=6e4){const h=(u.gameTick||0)+1;if(u.gameTick=h,u.lastTickAt=Date.now(),u.season=u7(h),u.year=d7(h,1100),h%10===0){const f=q(K,`simulation_rooms/${t}/markets`);ve(f).then(m=>{if(m.exists()){const b=m.val();Object.keys(b).forEach(p=>{A7(b[p])}),ae(f,b)}})}return c={...u},u}else return}),c&&Pm(t,{world:c,pin:t,playerCount:n})}catch{}}else s!=null&&s.lastTickAt||ae(q(K,`simulation_rooms/${t}/world`),{lastTickAt:Date.now()})},5e3);return()=>clearInterval(i)},[t,e,s==null?void 0:s.lastTickAt,s==null?void 0:s.gameTick,n]),S.useEffect(()=>{if(!t||n===void 0)return;const i=setTimeout(()=>{Pm(t,{playerCount:n})},2e3);return()=>clearTimeout(i)},[t,n])},j7=t=>{const[e,s]=S.useState(null);S.useEffect(()=>{if(!t){s(null);return}const i=`simulation_rooms/${t}`,r=Qe(q(K,`${i}/status`),m=>{s(b=>{const p=m.val()||"LOBBY";return b?{...b,status:p}:{pin:t,status:p,markets:{},market:_t,players:{},messages:[],regions:{},worldEvents:{}}})}),a=Qe(q(K,`${i}/world`),m=>{s(b=>{const p=m.val();return b?{...b,world:p}:{pin:t,world:p,markets:{},market:_t,players:{},messages:[],regions:{},worldEvents:{}}})}),l=Qe(q(K,`${i}/markets`),m=>{s(b=>{const p=m.val()||{};return b?{...b,markets:p}:{pin:t,markets:p,market:_t,players:{},messages:[],regions:{},worldEvents:{}}})}),c=Qe(q(K,`${i}/messages`),m=>{s(b=>{const p=m.val()||[];return b?{...b,messages:p}:{pin:t,messages:p,markets:{},market:_t,players:{},regions:{},worldEvents:{}}})}),u=Qe(q(K,`${i}/players`),m=>{s(b=>{const p=m.val()||{};return b?{...b,players:p}:{pin:t,players:p,markets:{},market:_t,messages:[],regions:{},worldEvents:{}}})}),d=Qe(q(K,`${i}/worldEvents`),m=>{s(b=>{const p=m.val()||{};return b?{...b,worldEvents:p}:{pin:t,worldEvents:p,markets:{},market:_t,players:{},messages:[],regions:{}}})}),h=Qe(q(K,`${i}/activeVote`),m=>{s(b=>{const p=m.val();return b?{...b,activeVote:p}:{pin:t,activeVote:p,markets:{},market:_t,players:{},messages:[],regions:{},worldEvents:{}}})}),f=Qe(q(K,`${i}/regions`),m=>{s(b=>{const p=m.val()||{};return b?{...b,regions:p}:{pin:t,regions:p,markets:{},market:_t,players:{},messages:[],worldEvents:{}}})});return ve(q(K,i)).then(m=>{if(m.exists()){const b=m.val();s(p=>({...p,pin:b.pin,status:b.status,settings:b.settings,hostName:b.hostName,isPublic:b.isPublic??!0,world:b.world,markets:b.markets||{},market:b.market||_t,players:(p==null?void 0:p.players)||b.players||{},messages:(p==null?void 0:p.messages)||b.messages||[],regions:b.regions||{},diplomacy:b.diplomacy||{},worldEvents:b.worldEvents||{}}))}}),()=>{r(),a(),l(),c(),u(),d(),h(),f()}},[t]);const n=S.useMemo(()=>{if(!(e!=null&&e.players))return 0;const i=Date.now();return Object.values(e.players).filter(r=>r.online&&i-(r.lastActive||0)<6e4).length},[e==null?void 0:e.players]);return{roomData:e,setRoomData:s,onlineCount:n}},O_=S.createContext({});function M_(t){const e=S.useRef(null);return e.current===null&&(e.current=t()),e.current}const D_=typeof window<"u",_R=D_?S.useLayoutEffect:S.useEffect,t0=S.createContext(null);function L_(t,e){t.indexOf(e)===-1&&t.push(e)}function P_(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}const cr=(t,e,s)=>s>e?e:s<t?t:s;let V_=()=>{};const ur={},wR=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function kR(t){return typeof t=="object"&&t!==null}const NR=t=>/^0[^.\s]+$/u.test(t);function F_(t){let e;return()=>(e===void 0&&(e=t()),e)}const jn=t=>t,C7=(t,e)=>s=>e(t(s)),lh=(...t)=>t.reduce(C7),md=(t,e,s)=>{const n=e-t;return n===0?1:(s-t)/n};class B_{constructor(){this.subscriptions=[]}add(e){return L_(this.subscriptions,e),()=>P_(this.subscriptions,e)}notify(e,s,n){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,s,n);else for(let r=0;r<i;r++){const a=this.subscriptions[r];a&&a(e,s,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const di=t=>t*1e3,_n=t=>t/1e3;function SR(t,e){return e?t*(1e3/e):0}const TR=(t,e,s)=>(((1-3*s+3*e)*t+(3*s-6*e))*t+3*e)*t,R7=1e-7,I7=12;function O7(t,e,s,n,i){let r,a,l=0;do a=e+(s-e)/2,r=TR(a,n,i)-t,r>0?s=a:e=a;while(Math.abs(r)>R7&&++l<I7);return a}function ch(t,e,s,n){if(t===e&&s===n)return jn;const i=r=>O7(r,0,1,t,s);return r=>r===0||r===1?r:TR(i(r),e,n)}const ER=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,AR=t=>e=>1-t(1-e),jR=ch(.33,1.53,.69,.99),U_=AR(jR),CR=ER(U_),RR=t=>(t*=2)<1?.5*U_(t):.5*(2-Math.pow(2,-10*(t-1))),$_=t=>1-Math.sin(Math.acos(t)),IR=AR($_),OR=ER($_),M7=ch(.42,0,1,1),D7=ch(0,0,.58,1),MR=ch(.42,0,.58,1),L7=t=>Array.isArray(t)&&typeof t[0]!="number",DR=t=>Array.isArray(t)&&typeof t[0]=="number",P7={linear:jn,easeIn:M7,easeInOut:MR,easeOut:D7,circIn:$_,circInOut:OR,circOut:IR,backIn:U_,backInOut:CR,backOut:jR,anticipate:RR},V7=t=>typeof t=="string",KN=t=>{if(DR(t)){V_(t.length===4);const[e,s,n,i]=t;return ch(e,s,n,i)}else if(V7(t))return P7[t];return t},Ph=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function F7(t,e){let s=new Set,n=new Set,i=!1,r=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(d){a.has(d)&&(u.schedule(d),t()),d(l)}const u={schedule:(d,h=!1,f=!1)=>{const b=f&&i?s:n;return h&&a.add(d),b.has(d)||b.add(d),d},cancel:d=>{n.delete(d),a.delete(d)},process:d=>{if(l=d,i){r=!0;return}i=!0,[s,n]=[n,s],s.forEach(c),s.clear(),i=!1,r&&(r=!1,u.process(d))}};return u}const B7=40;function LR(t,e){let s=!1,n=!0;const i={delta:0,timestamp:0,isProcessing:!1},r=()=>s=!0,a=Ph.reduce((y,w)=>(y[w]=F7(r),y),{}),{setup:l,read:c,resolveKeyframes:u,preUpdate:d,update:h,preRender:f,render:m,postRender:b}=a,p=()=>{const y=ur.useManualTiming?i.timestamp:performance.now();s=!1,ur.useManualTiming||(i.delta=n?1e3/60:Math.max(Math.min(y-i.timestamp,B7),1)),i.timestamp=y,i.isProcessing=!0,l.process(i),c.process(i),u.process(i),d.process(i),h.process(i),f.process(i),m.process(i),b.process(i),i.isProcessing=!1,s&&e&&(n=!1,t(p))},v=()=>{s=!0,n=!0,i.isProcessing||t(p)};return{schedule:Ph.reduce((y,w)=>{const k=a[w];return y[w]=(N,_=!1,T=!1)=>(s||v(),k.schedule(N,_,T)),y},{}),cancel:y=>{for(let w=0;w<Ph.length;w++)a[Ph[w]].cancel(y)},state:i,steps:a}}const{schedule:Nt,cancel:ka,state:us,steps:dg}=LR(typeof requestAnimationFrame<"u"?requestAnimationFrame:jn,!0);let mf;function U7(){mf=void 0}const Vs={now:()=>(mf===void 0&&Vs.set(us.isProcessing||ur.useManualTiming?us.timestamp:performance.now()),mf),set:t=>{mf=t,queueMicrotask(U7)}},PR=t=>e=>typeof e=="string"&&e.startsWith(t),VR=PR("--"),$7=PR("var(--"),G_=t=>$7(t)?G7.test(t.split("/*")[0].trim()):!1,G7=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Dc={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},pd={...Dc,transform:t=>cr(0,1,t)},Vh={...Dc,default:1},Cu=t=>Math.round(t*1e5)/1e5,H_=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function H7(t){return t==null}const z7=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,z_=(t,e)=>s=>!!(typeof s=="string"&&z7.test(s)&&s.startsWith(t)||e&&!H7(s)&&Object.prototype.hasOwnProperty.call(s,e)),FR=(t,e,s)=>n=>{if(typeof n!="string")return n;const[i,r,a,l]=n.match(H_);return{[t]:parseFloat(i),[e]:parseFloat(r),[s]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},q7=t=>cr(0,255,t),hg={...Dc,transform:t=>Math.round(q7(t))},Ja={test:z_("rgb","red"),parse:FR("red","green","blue"),transform:({red:t,green:e,blue:s,alpha:n=1})=>"rgba("+hg.transform(t)+", "+hg.transform(e)+", "+hg.transform(s)+", "+Cu(pd.transform(n))+")"};function K7(t){let e="",s="",n="",i="";return t.length>5?(e=t.substring(1,3),s=t.substring(3,5),n=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),s=t.substring(2,3),n=t.substring(3,4),i=t.substring(4,5),e+=e,s+=s,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(s,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}}const fb={test:z_("#"),parse:K7,transform:Ja.transform},uh=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),kr=uh("deg"),hi=uh("%"),be=uh("px"),W7=uh("vh"),Y7=uh("vw"),WN={...hi,parse:t=>hi.parse(t)/100,transform:t=>hi.transform(t*100)},ml={test:z_("hsl","hue"),parse:FR("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:s,alpha:n=1})=>"hsla("+Math.round(t)+", "+hi.transform(Cu(e))+", "+hi.transform(Cu(s))+", "+Cu(pd.transform(n))+")"},$t={test:t=>Ja.test(t)||fb.test(t)||ml.test(t),parse:t=>Ja.test(t)?Ja.parse(t):ml.test(t)?ml.parse(t):fb.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?Ja.transform(t):ml.transform(t),getAnimatableNone:t=>{const e=$t.parse(t);return e.alpha=0,$t.transform(e)}},X7=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Q7(t){var e,s;return isNaN(t)&&typeof t=="string"&&(((e=t.match(H_))==null?void 0:e.length)||0)+(((s=t.match(X7))==null?void 0:s.length)||0)>0}const BR="number",UR="color",J7="var",Z7="var(",YN="${}",eq=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function gd(t){const e=t.toString(),s=[],n={color:[],number:[],var:[]},i=[];let r=0;const l=e.replace(eq,c=>($t.test(c)?(n.color.push(r),i.push(UR),s.push($t.parse(c))):c.startsWith(Z7)?(n.var.push(r),i.push(J7),s.push(c)):(n.number.push(r),i.push(BR),s.push(parseFloat(c))),++r,YN)).split(YN);return{values:s,split:l,indexes:n,types:i}}function $R(t){return gd(t).values}function GR(t){const{split:e,types:s}=gd(t),n=e.length;return i=>{let r="";for(let a=0;a<n;a++)if(r+=e[a],i[a]!==void 0){const l=s[a];l===BR?r+=Cu(i[a]):l===UR?r+=$t.transform(i[a]):r+=i[a]}return r}}const tq=t=>typeof t=="number"?0:$t.test(t)?$t.getAnimatableNone(t):t;function sq(t){const e=$R(t);return GR(t)(e.map(tq))}const Na={test:Q7,parse:$R,createTransformer:GR,getAnimatableNone:sq};function fg(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}function nq({hue:t,saturation:e,lightness:s,alpha:n}){t/=360,e/=100,s/=100;let i=0,r=0,a=0;if(!e)i=r=a=s;else{const l=s<.5?s*(1+e):s+e-s*e,c=2*s-l;i=fg(c,l,t+1/3),r=fg(c,l,t),a=fg(c,l,t-1/3)}return{red:Math.round(i*255),green:Math.round(r*255),blue:Math.round(a*255),alpha:n}}function Vm(t,e){return s=>s>0?e:t}const At=(t,e,s)=>t+(e-t)*s,mg=(t,e,s)=>{const n=t*t,i=s*(e*e-n)+n;return i<0?0:Math.sqrt(i)},iq=[fb,Ja,ml],rq=t=>iq.find(e=>e.test(t));function XN(t){const e=rq(t);if(!e)return!1;let s=e.parse(t);return e===ml&&(s=nq(s)),s}const QN=(t,e)=>{const s=XN(t),n=XN(e);if(!s||!n)return Vm(t,e);const i={...s};return r=>(i.red=mg(s.red,n.red,r),i.green=mg(s.green,n.green,r),i.blue=mg(s.blue,n.blue,r),i.alpha=At(s.alpha,n.alpha,r),Ja.transform(i))},mb=new Set(["none","hidden"]);function aq(t,e){return mb.has(t)?s=>s<=0?t:e:s=>s>=1?e:t}function oq(t,e){return s=>At(t,e,s)}function q_(t){return typeof t=="number"?oq:typeof t=="string"?G_(t)?Vm:$t.test(t)?QN:uq:Array.isArray(t)?HR:typeof t=="object"?$t.test(t)?QN:lq:Vm}function HR(t,e){const s=[...t],n=s.length,i=t.map((r,a)=>q_(r)(r,e[a]));return r=>{for(let a=0;a<n;a++)s[a]=i[a](r);return s}}function lq(t,e){const s={...t,...e},n={};for(const i in s)t[i]!==void 0&&e[i]!==void 0&&(n[i]=q_(t[i])(t[i],e[i]));return i=>{for(const r in n)s[r]=n[r](i);return s}}function cq(t,e){const s=[],n={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const r=e.types[i],a=t.indexes[r][n[r]],l=t.values[a]??0;s[i]=l,n[r]++}return s}const uq=(t,e)=>{const s=Na.createTransformer(e),n=gd(t),i=gd(e);return n.indexes.var.length===i.indexes.var.length&&n.indexes.color.length===i.indexes.color.length&&n.indexes.number.length>=i.indexes.number.length?mb.has(t)&&!i.values.length||mb.has(e)&&!n.values.length?aq(t,e):lh(HR(cq(n,i),i.values),s):Vm(t,e)};function zR(t,e,s){return typeof t=="number"&&typeof e=="number"&&typeof s=="number"?At(t,e,s):q_(t)(t,e)}const dq=t=>{const e=({timestamp:s})=>t(s);return{start:(s=!0)=>Nt.update(e,s),stop:()=>ka(e),now:()=>us.isProcessing?us.timestamp:Vs.now()}},qR=(t,e,s=10)=>{let n="";const i=Math.max(Math.round(e/s),2);for(let r=0;r<i;r++)n+=Math.round(t(r/(i-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Fm=2e4;function K_(t){let e=0;const s=50;let n=t.next(e);for(;!n.done&&e<Fm;)e+=s,n=t.next(e);return e>=Fm?1/0:e}function hq(t,e=100,s){const n=s({...t,keyframes:[0,e]}),i=Math.min(K_(n),Fm);return{type:"keyframes",ease:r=>n.next(i*r).value/e,duration:_n(i)}}const fq=5;function KR(t,e,s){const n=Math.max(e-fq,0);return SR(s-t(n),e-n)}const Rt={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},pg=.001;function mq({duration:t=Rt.duration,bounce:e=Rt.bounce,velocity:s=Rt.velocity,mass:n=Rt.mass}){let i,r,a=1-e;a=cr(Rt.minDamping,Rt.maxDamping,a),t=cr(Rt.minDuration,Rt.maxDuration,_n(t)),a<1?(i=u=>{const d=u*a,h=d*t,f=d-s,m=pb(u,a),b=Math.exp(-h);return pg-f/m*b},r=u=>{const h=u*a*t,f=h*s+s,m=Math.pow(a,2)*Math.pow(u,2)*t,b=Math.exp(-h),p=pb(Math.pow(u,2),a);return(-i(u)+pg>0?-1:1)*((f-m)*b)/p}):(i=u=>{const d=Math.exp(-u*t),h=(u-s)*t+1;return-pg+d*h},r=u=>{const d=Math.exp(-u*t),h=(s-u)*(t*t);return d*h});const l=5/t,c=gq(i,r,l);if(t=di(t),isNaN(c))return{stiffness:Rt.stiffness,damping:Rt.damping,duration:t};{const u=Math.pow(c,2)*n;return{stiffness:u,damping:a*2*Math.sqrt(n*u),duration:t}}}const pq=12;function gq(t,e,s){let n=s;for(let i=1;i<pq;i++)n=n-t(n)/e(n);return n}function pb(t,e){return t*Math.sqrt(1-e*e)}const xq=["duration","bounce"],bq=["stiffness","damping","mass"];function JN(t,e){return e.some(s=>t[s]!==void 0)}function vq(t){let e={velocity:Rt.velocity,stiffness:Rt.stiffness,damping:Rt.damping,mass:Rt.mass,isResolvedFromDuration:!1,...t};if(!JN(t,bq)&&JN(t,xq))if(t.visualDuration){const s=t.visualDuration,n=2*Math.PI/(s*1.2),i=n*n,r=2*cr(.05,1,1-(t.bounce||0))*Math.sqrt(i);e={...e,mass:Rt.mass,stiffness:i,damping:r}}else{const s=mq(t);e={...e,...s,mass:Rt.mass},e.isResolvedFromDuration=!0}return e}function Bm(t=Rt.visualDuration,e=Rt.bounce){const s=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:n,restDelta:i}=s;const r=s.keyframes[0],a=s.keyframes[s.keyframes.length-1],l={done:!1,value:r},{stiffness:c,damping:u,mass:d,duration:h,velocity:f,isResolvedFromDuration:m}=vq({...s,velocity:-_n(s.velocity||0)}),b=f||0,p=u/(2*Math.sqrt(c*d)),v=a-r,x=_n(Math.sqrt(c/d)),g=Math.abs(v)<5;n||(n=g?Rt.restSpeed.granular:Rt.restSpeed.default),i||(i=g?Rt.restDelta.granular:Rt.restDelta.default);let y;if(p<1){const k=pb(x,p);y=N=>{const _=Math.exp(-p*x*N);return a-_*((b+p*x*v)/k*Math.sin(k*N)+v*Math.cos(k*N))}}else if(p===1)y=k=>a-Math.exp(-x*k)*(v+(b+x*v)*k);else{const k=x*Math.sqrt(p*p-1);y=N=>{const _=Math.exp(-p*x*N),T=Math.min(k*N,300);return a-_*((b+p*x*v)*Math.sinh(T)+k*v*Math.cosh(T))/k}}const w={calculatedDuration:m&&h||null,next:k=>{const N=y(k);if(m)l.done=k>=h;else{let _=k===0?b:0;p<1&&(_=k===0?di(b):KR(y,k,N));const T=Math.abs(_)<=n,E=Math.abs(a-N)<=i;l.done=T&&E}return l.value=l.done?a:N,l},toString:()=>{const k=Math.min(K_(w),Fm),N=qR(_=>w.next(k*_).value,k,30);return k+"ms "+N},toTransition:()=>{}};return w}Bm.applyToOptions=t=>{const e=hq(t,100,Bm);return t.ease=e.ease,t.duration=di(e.duration),t.type="keyframes",t};function gb({keyframes:t,velocity:e=0,power:s=.8,timeConstant:n=325,bounceDamping:i=10,bounceStiffness:r=500,modifyTarget:a,min:l,max:c,restDelta:u=.5,restSpeed:d}){const h=t[0],f={done:!1,value:h},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,b=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let p=s*e;const v=h+p,x=a===void 0?v:a(v);x!==v&&(p=x-h);const g=T=>-p*Math.exp(-T/n),y=T=>x+g(T),w=T=>{const E=g(T),A=y(T);f.done=Math.abs(E)<=u,f.value=f.done?x:A};let k,N;const _=T=>{m(f.value)&&(k=T,N=Bm({keyframes:[f.value,b(f.value)],velocity:KR(y,T,f.value),damping:i,stiffness:r,restDelta:u,restSpeed:d}))};return _(0),{calculatedDuration:null,next:T=>{let E=!1;return!N&&k===void 0&&(E=!0,w(T),_(T)),k!==void 0&&T>=k?N.next(T-k):(!E&&w(T),f)}}}function yq(t,e,s){const n=[],i=s||ur.mix||zR,r=t.length-1;for(let a=0;a<r;a++){let l=i(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||jn:e;l=lh(c,l)}n.push(l)}return n}function _q(t,e,{clamp:s=!0,ease:n,mixer:i}={}){const r=t.length;if(V_(r===e.length),r===1)return()=>e[0];if(r===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[r-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=yq(e,n,i),c=l.length,u=d=>{if(a&&d<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const f=md(t[h],t[h+1],d);return l[h](f)};return s?d=>u(cr(t[0],t[r-1],d)):u}function wq(t,e){const s=t[t.length-1];for(let n=1;n<=e;n++){const i=md(0,e,n);t.push(At(s,1,i))}}function kq(t){const e=[0];return wq(e,t.length-1),e}function Nq(t,e){return t.map(s=>s*e)}function Sq(t,e){return t.map(()=>e||MR).splice(0,t.length-1)}function Ru({duration:t=300,keyframes:e,times:s,ease:n="easeInOut"}){const i=L7(n)?n.map(KN):KN(n),r={done:!1,value:e[0]},a=Nq(s&&s.length===e.length?s:kq(e),t),l=_q(a,e,{ease:Array.isArray(i)?i:Sq(e,i)});return{calculatedDuration:t,next:c=>(r.value=l(c),r.done=c>=t,r)}}const Tq=t=>t!==null;function W_(t,{repeat:e,repeatType:s="loop"},n,i=1){const r=t.filter(Tq),l=i<0||e&&s!=="loop"&&e%2===1?0:r.length-1;return!l||n===void 0?r[l]:n}const Eq={decay:gb,inertia:gb,tween:Ru,keyframes:Ru,spring:Bm};function WR(t){typeof t.type=="string"&&(t.type=Eq[t.type])}class Y_{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,s){return this.finished.then(e,s)}}const Aq=t=>t/100;class X_ extends Y_{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,i;const{motionValue:s}=this.options;s&&s.updatedAt!==Vs.now()&&this.tick(Vs.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(i=(n=this.options).onStop)==null||i.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;WR(e);const{type:s=Ru,repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=e;let{keyframes:l}=e;const c=s||Ru;c!==Ru&&typeof l[0]!="number"&&(this.mixKeyframes=lh(Aq,zR(l[0],l[1])),l=[0,100]);const u=c({...e,keyframes:l});r==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=K_(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=u}updateTime(e){const s=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(e,s=!1){const{generator:n,totalDuration:i,mixKeyframes:r,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:u=0,keyframes:d,repeat:h,repeatType:f,repeatDelay:m,type:b,onUpdate:p,finalKeyframe:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),s?this.currentTime=e:this.updateTime(e);const x=this.currentTime-u*(this.playbackSpeed>=0?1:-1),g=this.playbackSpeed>=0?x<0:x>i;this.currentTime=Math.max(x,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let y=this.currentTime,w=n;if(h){const T=Math.min(this.currentTime,i)/l;let E=Math.floor(T),A=T%1;!A&&T>=1&&(A=1),A===1&&E--,E=Math.min(E,h+1),!!(E%2)&&(f==="reverse"?(A=1-A,m&&(A-=m/l)):f==="mirror"&&(w=a)),y=cr(0,1,A)*l}const k=g?{done:!1,value:d[0]}:w.next(y);r&&(k.value=r(k.value));let{done:N}=k;!g&&c!==null&&(N=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const _=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&N);return _&&b!==gb&&(k.value=W_(d,this.options,v,this.speed)),p&&p(k.value),_&&this.finish(),k}then(e,s){return this.finished.then(e,s)}get duration(){return _n(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+_n(e)}get time(){return _n(this.currentTime)}set time(e){var s;e=di(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Vs.now());const s=this.playbackSpeed!==e;this.playbackSpeed=e,s&&(this.time=_n(this.currentTime))}play(){var i,r;if(this.isStopped)return;const{driver:e=dq,startTime:s}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),(r=(i=this.options).onPlay)==null||r.call(i);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=s??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Vs.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(e=this.options).onComplete)==null||s.call(e)}cancel(){var e,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(e=this.options).onCancel)==null||s.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),e.observe(this)}}function jq(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Za=t=>t*180/Math.PI,xb=t=>{const e=Za(Math.atan2(t[1],t[0]));return bb(e)},Cq={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:xb,rotateZ:xb,skewX:t=>Za(Math.atan(t[1])),skewY:t=>Za(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},bb=t=>(t=t%360,t<0&&(t+=360),t),ZN=xb,eS=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),tS=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),Rq={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:eS,scaleY:tS,scale:t=>(eS(t)+tS(t))/2,rotateX:t=>bb(Za(Math.atan2(t[6],t[5]))),rotateY:t=>bb(Za(Math.atan2(-t[2],t[0]))),rotateZ:ZN,rotate:ZN,skewX:t=>Za(Math.atan(t[4])),skewY:t=>Za(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function vb(t){return t.includes("scale")?1:0}function yb(t,e){if(!t||t==="none")return vb(e);const s=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,i;if(s)n=Rq,i=s;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=Cq,i=l}if(!i)return vb(e);const r=n[e],a=i[1].split(",").map(Oq);return typeof r=="function"?r(a):a[r]}const Iq=(t,e)=>{const{transform:s="none"}=getComputedStyle(t);return yb(s,e)};function Oq(t){return parseFloat(t.trim())}const Lc=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Pc=new Set(Lc),sS=t=>t===Dc||t===be,Mq=new Set(["x","y","z"]),Dq=Lc.filter(t=>!Mq.has(t));function Lq(t){const e=[];return Dq.forEach(s=>{const n=t.getValue(s);n!==void 0&&(e.push([s,n.get()]),n.set(s.startsWith("scale")?1:0))}),e}const lo={width:({x:t},{paddingLeft:e="0",paddingRight:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),height:({y:t},{paddingTop:e="0",paddingBottom:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>yb(e,"x"),y:(t,{transform:e})=>yb(e,"y")};lo.translateX=lo.x;lo.translateY=lo.y;const co=new Set;let _b=!1,wb=!1,kb=!1;function YR(){if(wb){const t=Array.from(co).filter(n=>n.needsMeasurement),e=new Set(t.map(n=>n.element)),s=new Map;e.forEach(n=>{const i=Lq(n);i.length&&(s.set(n,i),n.render())}),t.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const i=s.get(n);i&&i.forEach(([r,a])=>{var l;(l=n.getValue(r))==null||l.set(a)})}),t.forEach(n=>n.measureEndState()),t.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}wb=!1,_b=!1,co.forEach(t=>t.complete(kb)),co.clear()}function XR(){co.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(wb=!0)})}function Pq(){kb=!0,XR(),YR(),kb=!1}class Q_{constructor(e,s,n,i,r,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=s,this.name=n,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(co.add(this),_b||(_b=!0,Nt.read(XR),Nt.resolveKeyframes(YR))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:s,element:n,motionValue:i}=this;if(e[0]===null){const r=i==null?void 0:i.get(),a=e[e.length-1];if(r!==void 0)e[0]=r;else if(n&&s){const l=n.readValue(s,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),i&&r===void 0&&i.set(e[0])}jq(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),co.delete(this)}cancel(){this.state==="scheduled"&&(co.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Vq=t=>t.startsWith("--");function Fq(t,e,s){Vq(e)?t.style.setProperty(e,s):t.style[e]=s}const Bq=F_(()=>window.ScrollTimeline!==void 0),Uq={};function $q(t,e){const s=F_(t);return()=>Uq[e]??s()}const QR=$q(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),au=([t,e,s,n])=>`cubic-bezier(${t}, ${e}, ${s}, ${n})`,nS={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:au([0,.65,.55,1]),circOut:au([.55,0,1,.45]),backIn:au([.31,.01,.66,-.59]),backOut:au([.33,1.53,.69,.99])};function JR(t,e){if(t)return typeof t=="function"?QR()?qR(t,e):"ease-out":DR(t)?au(t):Array.isArray(t)?t.map(s=>JR(s,e)||nS.easeOut):nS[t]}function Gq(t,e,s,{delay:n=0,duration:i=300,repeat:r=0,repeatType:a="loop",ease:l="easeOut",times:c}={},u=void 0){const d={[e]:s};c&&(d.offset=c);const h=JR(l,i);Array.isArray(h)&&(d.easing=h);const f={delay:n,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:a==="reverse"?"alternate":"normal"};return u&&(f.pseudoElement=u),t.animate(d,f)}function ZR(t){return typeof t=="function"&&"applyToOptions"in t}function Hq({type:t,...e}){return ZR(t)&&QR()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class zq extends Y_{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:s,name:n,keyframes:i,pseudoElement:r,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!r,this.allowFlatten=a,this.options=e,V_(typeof e.type!="string");const u=Hq(e);this.animation=Gq(s,n,i,u,r),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const d=W_(i,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(d):Fq(s,n,d),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,s;(s=(e=this.animation).finish)==null||s.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,s;this.isPseudoElement||(s=(e=this.animation).commitStyles)==null||s.call(e)}get duration(){var s,n;const e=((n=(s=this.animation.effect)==null?void 0:s.getComputedTiming)==null?void 0:n.call(s).duration)||0;return _n(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+_n(e)}get time(){return _n(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=di(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:s}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&Bq()?(this.animation.timeline=e,jn):s(this)}}const eI={anticipate:RR,backInOut:CR,circInOut:OR};function qq(t){return t in eI}function Kq(t){typeof t.ease=="string"&&qq(t.ease)&&(t.ease=eI[t.ease])}const iS=10;class Wq extends zq{constructor(e){Kq(e),WR(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:s,onUpdate:n,onComplete:i,element:r,...a}=this.options;if(!s)return;if(e!==void 0){s.set(e);return}const l=new X_({...a,autoplay:!1}),c=di(this.finishedTime??this.time);s.setWithVelocity(l.sample(c-iS).value,l.sample(c).value,iS),l.stop()}}const rS=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(Na.test(t)||t==="0")&&!t.startsWith("url("));function Yq(t){const e=t[0];if(t.length===1)return!0;for(let s=0;s<t.length;s++)if(t[s]!==e)return!0}function Xq(t,e,s,n){const i=t[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const r=t[t.length-1],a=rS(i,e),l=rS(r,e);return!a||!l?!1:Yq(t)||(s==="spring"||ZR(s))&&n}function Nb(t){t.duration=0,t.type="keyframes"}const Qq=new Set(["opacity","clipPath","filter","transform"]),Jq=F_(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Zq(t){var d;const{motionValue:e,name:s,repeatDelay:n,repeatType:i,damping:r,type:a}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:u}=e.owner.getProps();return Jq()&&s&&Qq.has(s)&&(s!=="transform"||!u)&&!c&&!n&&i!=="mirror"&&r!==0&&a!=="inertia"}const eK=40;class tK extends Y_{constructor({autoplay:e=!0,delay:s=0,type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",keyframes:l,name:c,motionValue:u,element:d,...h}){var b;super(),this.stop=()=>{var p,v;this._animation&&(this._animation.stop(),(p=this.stopTimeline)==null||p.call(this)),(v=this.keyframeResolver)==null||v.cancel()},this.createdAt=Vs.now();const f={autoplay:e,delay:s,type:n,repeat:i,repeatDelay:r,repeatType:a,name:c,motionValue:u,element:d,...h},m=(d==null?void 0:d.KeyframeResolver)||Q_;this.keyframeResolver=new m(l,(p,v,x)=>this.onKeyframesResolved(p,v,f,!x),c,u,d),(b=this.keyframeResolver)==null||b.scheduleResolve()}onKeyframesResolved(e,s,n,i){this.keyframeResolver=void 0;const{name:r,type:a,velocity:l,delay:c,isHandoff:u,onUpdate:d}=n;this.resolvedAt=Vs.now(),Xq(e,r,a,l)||((ur.instantAnimations||!c)&&(d==null||d(W_(e,n,s))),e[0]=e[e.length-1],Nb(n),n.repeat=0);const f={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>eK?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...n,keyframes:e},m=!u&&Zq(f)?new Wq({...f,element:f.motionValue.owner.current}):new X_(f);m.finished.then(()=>this.notifyFinished()).catch(jn),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,s){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),Pq()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const sK=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function nK(t){const e=sK.exec(t);if(!e)return[,];const[,s,n,i]=e;return[`--${s??n}`,i]}function tI(t,e,s=1){const[n,i]=nK(t);if(!n)return;const r=window.getComputedStyle(e).getPropertyValue(n);if(r){const a=r.trim();return wR(a)?parseFloat(a):a}return G_(i)?tI(i,e,s+1):i}function J_(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const sI=new Set(["width","height","top","left","right","bottom",...Lc]),iK={test:t=>t==="auto",parse:t=>t},nI=t=>e=>e.test(t),iI=[Dc,be,hi,kr,Y7,W7,iK],aS=t=>iI.find(nI(t));function rK(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||NR(t):!0}const aK=new Set(["brightness","contrast","saturate","opacity"]);function oK(t){const[e,s]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[n]=s.match(H_)||[];if(!n)return t;const i=s.replace(n,"");let r=aK.has(e)?1:0;return n!==s&&(r*=100),e+"("+r+i+")"}const lK=/\b([a-z-]*)\(.*?\)/gu,Sb={...Na,getAnimatableNone:t=>{const e=t.match(lK);return e?e.map(oK).join(" "):t}},oS={...Dc,transform:Math.round},cK={rotate:kr,rotateX:kr,rotateY:kr,rotateZ:kr,scale:Vh,scaleX:Vh,scaleY:Vh,scaleZ:Vh,skew:kr,skewX:kr,skewY:kr,distance:be,translateX:be,translateY:be,translateZ:be,x:be,y:be,z:be,perspective:be,transformPerspective:be,opacity:pd,originX:WN,originY:WN,originZ:be},Z_={borderWidth:be,borderTopWidth:be,borderRightWidth:be,borderBottomWidth:be,borderLeftWidth:be,borderRadius:be,radius:be,borderTopLeftRadius:be,borderTopRightRadius:be,borderBottomRightRadius:be,borderBottomLeftRadius:be,width:be,maxWidth:be,height:be,maxHeight:be,top:be,right:be,bottom:be,left:be,padding:be,paddingTop:be,paddingRight:be,paddingBottom:be,paddingLeft:be,margin:be,marginTop:be,marginRight:be,marginBottom:be,marginLeft:be,backgroundPositionX:be,backgroundPositionY:be,...cK,zIndex:oS,fillOpacity:pd,strokeOpacity:pd,numOctaves:oS},uK={...Z_,color:$t,backgroundColor:$t,outlineColor:$t,fill:$t,stroke:$t,borderColor:$t,borderTopColor:$t,borderRightColor:$t,borderBottomColor:$t,borderLeftColor:$t,filter:Sb,WebkitFilter:Sb},rI=t=>uK[t];function aI(t,e){let s=rI(t);return s!==Sb&&(s=Na),s.getAnimatableNone?s.getAnimatableNone(e):void 0}const dK=new Set(["auto","none","0"]);function hK(t,e,s){let n=0,i;for(;n<t.length&&!i;){const r=t[n];typeof r=="string"&&!dK.has(r)&&gd(r).values.length&&(i=t[n]),n++}if(i&&s)for(const r of e)t[r]=aI(s,i)}class fK extends Q_{constructor(e,s,n,i,r){super(e,s,n,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:s,name:n}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let u=e[c];if(typeof u=="string"&&(u=u.trim(),G_(u))){const d=tI(u,s.current);d!==void 0&&(e[c]=d),c===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!sI.has(n)||e.length!==2)return;const[i,r]=e,a=aS(i),l=aS(r);if(a!==l)if(sS(a)&&sS(l))for(let c=0;c<e.length;c++){const u=e[c];typeof u=="string"&&(e[c]=parseFloat(u))}else lo[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:s}=this,n=[];for(let i=0;i<e.length;i++)(e[i]===null||rK(e[i]))&&n.push(i);n.length&&hK(e,n,s)}measureInitialState(){const{element:e,unresolvedKeyframes:s,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=lo[n](e.measureViewportBox(),window.getComputedStyle(e.current)),s[0]=this.measuredOrigin;const i=s[s.length-1];i!==void 0&&e.getValue(n,i).jump(i,!1)}measureEndState(){var l;const{element:e,name:s,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const i=e.getValue(s);i&&i.jump(this.measuredOrigin,!1);const r=n.length-1,a=n[r];n[r]=lo[s](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,u])=>{e.getValue(c).set(u)}),this.resolveNoneKeyframes()}}function mK(t,e,s){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let n=document;const i=(s==null?void 0:s[t])??n.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const oI=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function lI(t){return kR(t)&&"offsetHeight"in t}const lS=30,pK=t=>!isNaN(parseFloat(t));class gK{constructor(e,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var r;const i=Vs.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((r=this.events.change)==null||r.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=s.owner}setCurrent(e){this.current=e,this.updatedAt=Vs.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=pK(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,s){this.events[e]||(this.events[e]=new B_);const n=this.events[e].add(s);return e==="change"?()=>{n(),Nt.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,s){this.passiveEffect=e,this.stopPassiveEffect=s}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,s,n){this.set(s),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,s=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Vs.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>lS)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,lS);return SR(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(e){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=e(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,s;(e=this.dependents)==null||e.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function rc(t,e){return new gK(t,e)}const{schedule:e1}=LR(queueMicrotask,!1),Ln={x:!1,y:!1};function cI(){return Ln.x||Ln.y}function xK(t){return t==="x"||t==="y"?Ln[t]?null:(Ln[t]=!0,()=>{Ln[t]=!1}):Ln.x||Ln.y?null:(Ln.x=Ln.y=!0,()=>{Ln.x=Ln.y=!1})}function uI(t,e){const s=mK(t),n=new AbortController,i={passive:!0,...e,signal:n.signal};return[s,i,()=>n.abort()]}function cS(t){return!(t.pointerType==="touch"||cI())}function bK(t,e,s={}){const[n,i,r]=uI(t,s),a=l=>{if(!cS(l))return;const{target:c}=l,u=e(c,l);if(typeof u!="function"||!c)return;const d=h=>{cS(h)&&(u(h),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,i)};return n.forEach(l=>{l.addEventListener("pointerenter",a,i)}),r}const dI=(t,e)=>e?t===e?!0:dI(t,e.parentElement):!1,t1=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,vK=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function yK(t){return vK.has(t.tagName)||t.tabIndex!==-1}const pf=new WeakSet;function uS(t){return e=>{e.key==="Enter"&&t(e)}}function gg(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const _K=(t,e)=>{const s=t.currentTarget;if(!s)return;const n=uS(()=>{if(pf.has(s))return;gg(s,"down");const i=uS(()=>{gg(s,"up")}),r=()=>gg(s,"cancel");s.addEventListener("keyup",i,e),s.addEventListener("blur",r,e)});s.addEventListener("keydown",n,e),s.addEventListener("blur",()=>s.removeEventListener("keydown",n),e)};function dS(t){return t1(t)&&!cI()}function wK(t,e,s={}){const[n,i,r]=uI(t,s),a=l=>{const c=l.currentTarget;if(!dS(l))return;pf.add(c);const u=e(c,l),d=(m,b)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",f),pf.has(c)&&pf.delete(c),dS(m)&&typeof u=="function"&&u(m,{success:b})},h=m=>{d(m,c===window||c===document||s.useGlobalTarget||dI(c,m.target))},f=m=>{d(m,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",f,i)};return n.forEach(l=>{(s.useGlobalTarget?window:l).addEventListener("pointerdown",a,i),lI(l)&&(l.addEventListener("focus",u=>_K(u,i)),!yK(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),r}function hI(t){return kR(t)&&"ownerSVGElement"in t}function kK(t){return hI(t)&&t.tagName==="svg"}const bs=t=>!!(t&&t.getVelocity),NK=[...iI,$t,Na],SK=t=>NK.find(nI(t)),s1=S.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function hS(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function TK(...t){return e=>{let s=!1;const n=t.map(i=>{const r=hS(i,e);return!s&&typeof r=="function"&&(s=!0),r});if(s)return()=>{for(let i=0;i<n.length;i++){const r=n[i];typeof r=="function"?r():hS(t[i],null)}}}}function EK(...t){return S.useCallback(TK(...t),t)}class AK extends S.Component{getSnapshotBeforeUpdate(e){const s=this.props.childRef.current;if(s&&e.isPresent&&!this.props.isPresent){const n=s.offsetParent,i=lI(n)&&n.offsetWidth||0,r=this.props.sizeRef.current;r.height=s.offsetHeight||0,r.width=s.offsetWidth||0,r.top=s.offsetTop,r.left=s.offsetLeft,r.right=i-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function jK({children:t,isPresent:e,anchorX:s,root:n}){const i=S.useId(),r=S.useRef(null),a=S.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=S.useContext(s1),c=EK(r,t==null?void 0:t.ref);return S.useInsertionEffect(()=>{const{width:u,height:d,top:h,left:f,right:m}=a.current;if(e||!r.current||!u||!d)return;const b=s==="left"?`left: ${f}`:`right: ${m}`;r.current.dataset.motionPopId=i;const p=document.createElement("style");l&&(p.nonce=l);const v=n??document.head;return v.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${b}px !important;
            top: ${h}px !important;
          }
        `),()=>{v.contains(p)&&v.removeChild(p)}},[e]),o.jsx(AK,{isPresent:e,childRef:r,sizeRef:a,children:S.cloneElement(t,{ref:c})})}const CK=({children:t,initial:e,isPresent:s,onExitComplete:n,custom:i,presenceAffectsLayout:r,mode:a,anchorX:l,root:c})=>{const u=M_(RK),d=S.useId();let h=!0,f=S.useMemo(()=>(h=!1,{id:d,initial:e,isPresent:s,custom:i,onExitComplete:m=>{u.set(m,!0);for(const b of u.values())if(!b)return;n&&n()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[s,u,n]);return r&&h&&(f={...f}),S.useMemo(()=>{u.forEach((m,b)=>u.set(b,!1))},[s]),S.useEffect(()=>{!s&&!u.size&&n&&n()},[s]),a==="popLayout"&&(t=o.jsx(jK,{isPresent:s,anchorX:l,root:c,children:t})),o.jsx(t0.Provider,{value:f,children:t})};function RK(){return new Map}function fI(t=!0){const e=S.useContext(t0);if(e===null)return[!0,null];const{isPresent:s,onExitComplete:n,register:i}=e,r=S.useId();S.useEffect(()=>{if(t)return i(r)},[t]);const a=S.useCallback(()=>t&&n&&n(r),[r,n,t]);return!s&&n?[!1,a]:[!0]}const Fh=t=>t.key||"";function fS(t){const e=[];return S.Children.forEach(t,s=>{S.isValidElement(s)&&e.push(s)}),e}const Dt=({children:t,custom:e,initial:s=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:r="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[u,d]=fI(a),h=S.useMemo(()=>fS(t),[t]),f=a&&!u?[]:h.map(Fh),m=S.useRef(!0),b=S.useRef(h),p=M_(()=>new Map),[v,x]=S.useState(h),[g,y]=S.useState(h);_R(()=>{m.current=!1,b.current=h;for(let N=0;N<g.length;N++){const _=Fh(g[N]);f.includes(_)?p.delete(_):p.get(_)!==!0&&p.set(_,!1)}},[g,f.length,f.join("-")]);const w=[];if(h!==v){let N=[...h];for(let _=0;_<g.length;_++){const T=g[_],E=Fh(T);f.includes(E)||(N.splice(_,0,T),w.push(T))}return r==="wait"&&w.length&&(N=w),y(fS(N)),x(h),null}const{forceRender:k}=S.useContext(O_);return o.jsx(o.Fragment,{children:g.map(N=>{const _=Fh(N),T=a&&!u?!1:h===g||f.includes(_),E=()=>{if(p.has(_))p.set(_,!0);else return;let A=!0;p.forEach(R=>{R||(A=!1)}),A&&(k==null||k(),y(b.current),a&&(d==null||d()),n&&n())};return o.jsx(CK,{isPresent:T,initial:!m.current||s?void 0:!1,custom:e,presenceAffectsLayout:i,mode:r,root:c,onExitComplete:T?void 0:E,anchorX:l,children:N},_)})})},mI=S.createContext({strict:!1}),mS={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ac={};for(const t in mS)ac[t]={isEnabled:e=>mS[t].some(s=>!!e[s])};function IK(t){for(const e in t)ac[e]={...ac[e],...t[e]}}const OK=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Um(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||OK.has(t)}let pI=t=>!Um(t);function MK(t){typeof t=="function"&&(pI=e=>e.startsWith("on")?!Um(e):t(e))}try{MK(require("@emotion/is-prop-valid").default)}catch{}function DK(t,e,s){const n={};for(const i in t)i==="values"&&typeof t.values=="object"||(pI(i)||s===!0&&Um(i)||!e&&!Um(i)||t.draggable&&i.startsWith("onDrag"))&&(n[i]=t[i]);return n}const s0=S.createContext({});function n0(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function xd(t){return typeof t=="string"||Array.isArray(t)}const n1=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],i1=["initial",...n1];function i0(t){return n0(t.animate)||i1.some(e=>xd(t[e]))}function gI(t){return!!(i0(t)||t.variants)}function LK(t,e){if(i0(t)){const{initial:s,animate:n}=t;return{initial:s===!1||xd(s)?s:void 0,animate:xd(n)?n:void 0}}return t.inherit!==!1?e:{}}function PK(t){const{initial:e,animate:s}=LK(t,S.useContext(s0));return S.useMemo(()=>({initial:e,animate:s}),[pS(e),pS(s)])}function pS(t){return Array.isArray(t)?t.join(" "):t}function gS(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Qc={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(be.test(t))t=parseFloat(t);else return t;const s=gS(t,e.target.x),n=gS(t,e.target.y);return`${s}% ${n}%`}},VK={correct:(t,{treeScale:e,projectionDelta:s})=>{const n=t,i=Na.parse(t);if(i.length>5)return n;const r=Na.createTransformer(t),a=typeof i[0]!="number"?1:0,l=s.x.scale*e.x,c=s.y.scale*e.y;i[0+a]/=l,i[1+a]/=c;const u=At(l,c,.5);return typeof i[2+a]=="number"&&(i[2+a]/=u),typeof i[3+a]=="number"&&(i[3+a]/=u),r(i)}},Tb={borderRadius:{...Qc,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Qc,borderTopRightRadius:Qc,borderBottomLeftRadius:Qc,borderBottomRightRadius:Qc,boxShadow:VK};function xI(t,{layout:e,layoutId:s}){return Pc.has(t)||t.startsWith("origin")||(e||s!==void 0)&&(!!Tb[t]||t==="opacity")}const FK={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},BK=Lc.length;function UK(t,e,s){let n="",i=!0;for(let r=0;r<BK;r++){const a=Lc[r],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||s){const u=oI(l,Z_[a]);if(!c){i=!1;const d=FK[a]||a;n+=`${d}(${u}) `}s&&(e[a]=u)}}return n=n.trim(),s?n=s(e,i?"":n):i&&(n="none"),n}function r1(t,e,s){const{style:n,vars:i,transformOrigin:r}=t;let a=!1,l=!1;for(const c in e){const u=e[c];if(Pc.has(c)){a=!0;continue}else if(VR(c)){i[c]=u;continue}else{const d=oI(u,Z_[c]);c.startsWith("origin")?(l=!0,r[c]=d):n[c]=d}}if(e.transform||(a||s?n.transform=UK(e,t.transform,s):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:u="50%",originZ:d=0}=r;n.transformOrigin=`${c} ${u} ${d}`}}const a1=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function bI(t,e,s){for(const n in e)!bs(e[n])&&!xI(n,s)&&(t[n]=e[n])}function $K({transformTemplate:t},e){return S.useMemo(()=>{const s=a1();return r1(s,e,t),Object.assign({},s.vars,s.style)},[e])}function GK(t,e){const s=t.style||{},n={};return bI(n,s,t),Object.assign(n,$K(t,e)),n}function HK(t,e){const s={},n=GK(t,e);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=n,s}const zK={offset:"stroke-dashoffset",array:"stroke-dasharray"},qK={offset:"strokeDashoffset",array:"strokeDasharray"};function KK(t,e,s=1,n=0,i=!0){t.pathLength=1;const r=i?zK:qK;t[r.offset]=be.transform(-n);const a=be.transform(e),l=be.transform(s);t[r.array]=`${a} ${l}`}function vI(t,{attrX:e,attrY:s,attrScale:n,pathLength:i,pathSpacing:r=1,pathOffset:a=0,...l},c,u,d){if(r1(t,l,u),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f}=t;h.transform&&(f.transform=h.transform,delete h.transform),(f.transform||h.transformOrigin)&&(f.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),f.transform&&(f.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),s!==void 0&&(h.y=s),n!==void 0&&(h.scale=n),i!==void 0&&KK(h,i,r,a,!1)}const yI=()=>({...a1(),attrs:{}}),_I=t=>typeof t=="string"&&t.toLowerCase()==="svg";function WK(t,e,s,n){const i=S.useMemo(()=>{const r=yI();return vI(r,e,_I(n),t.transformTemplate,t.style),{...r.attrs,style:{...r.style}}},[e]);if(t.style){const r={};bI(r,t.style,t),i.style={...r,...i.style}}return i}const YK=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function o1(t){return typeof t!="string"||t.includes("-")?!1:!!(YK.indexOf(t)>-1||/[A-Z]/u.test(t))}function XK(t,e,s,{latestValues:n},i,r=!1){const l=(o1(t)?WK:HK)(e,n,i,t),c=DK(e,typeof t=="string",r),u=t!==S.Fragment?{...c,...l,ref:s}:{},{children:d}=e,h=S.useMemo(()=>bs(d)?d.get():d,[d]);return S.createElement(t,{...u,children:h})}function xS(t){const e=[{},{}];return t==null||t.values.forEach((s,n)=>{e[0][n]=s.get(),e[1][n]=s.getVelocity()}),e}function l1(t,e,s,n){if(typeof e=="function"){const[i,r]=xS(n);e=e(s!==void 0?s:t.custom,i,r)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[i,r]=xS(n);e=e(s!==void 0?s:t.custom,i,r)}return e}function gf(t){return bs(t)?t.get():t}function QK({scrapeMotionValuesFromProps:t,createRenderState:e},s,n,i){return{latestValues:JK(s,n,i,t),renderState:e()}}function JK(t,e,s,n){const i={},r=n(t,{});for(const f in r)i[f]=gf(r[f]);let{initial:a,animate:l}=t;const c=i0(t),u=gI(t);e&&u&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let d=s?s.initial===!1:!1;d=d||a===!1;const h=d?l:a;if(h&&typeof h!="boolean"&&!n0(h)){const f=Array.isArray(h)?h:[h];for(let m=0;m<f.length;m++){const b=l1(t,f[m]);if(b){const{transitionEnd:p,transition:v,...x}=b;for(const g in x){let y=x[g];if(Array.isArray(y)){const w=d?y.length-1:0;y=y[w]}y!==null&&(i[g]=y)}for(const g in p)i[g]=p[g]}}}return i}const wI=t=>(e,s)=>{const n=S.useContext(s0),i=S.useContext(t0),r=()=>QK(t,e,n,i);return s?r():M_(r)};function c1(t,e,s){var r;const{style:n}=t,i={};for(const a in n)(bs(n[a])||e.style&&bs(e.style[a])||xI(a,t)||((r=s==null?void 0:s.getValue(a))==null?void 0:r.liveStyle)!==void 0)&&(i[a]=n[a]);return i}const ZK=wI({scrapeMotionValuesFromProps:c1,createRenderState:a1});function kI(t,e,s){const n=c1(t,e,s);for(const i in t)if(bs(t[i])||bs(e[i])){const r=Lc.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;n[r]=t[i]}return n}const eW=wI({scrapeMotionValuesFromProps:kI,createRenderState:yI}),tW=Symbol.for("motionComponentSymbol");function pl(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function sW(t,e,s){return S.useCallback(n=>{n&&t.onMount&&t.onMount(n),e&&(n?e.mount(n):e.unmount()),s&&(typeof s=="function"?s(n):pl(s)&&(s.current=n))},[e])}const u1=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),nW="framerAppearId",NI="data-"+u1(nW),SI=S.createContext({});function iW(t,e,s,n,i){var p,v;const{visualElement:r}=S.useContext(s0),a=S.useContext(mI),l=S.useContext(t0),c=S.useContext(s1).reducedMotion,u=S.useRef(null);n=n||a.renderer,!u.current&&n&&(u.current=n(t,{visualState:e,parent:r,props:s,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const d=u.current,h=S.useContext(SI);d&&!d.projection&&i&&(d.type==="html"||d.type==="svg")&&rW(u.current,s,i,h);const f=S.useRef(!1);S.useInsertionEffect(()=>{d&&f.current&&d.update(s,l)});const m=s[NI],b=S.useRef(!!m&&!((p=window.MotionHandoffIsComplete)!=null&&p.call(window,m))&&((v=window.MotionHasOptimisedAnimation)==null?void 0:v.call(window,m)));return _R(()=>{d&&(f.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),b.current&&d.animationState&&d.animationState.animateChanges())}),S.useEffect(()=>{d&&(!b.current&&d.animationState&&d.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var x;(x=window.MotionHandoffMarkAsComplete)==null||x.call(window,m)}),b.current=!1),d.enteringChildren=void 0)}),d}function rW(t,e,s,n){const{layoutId:i,layout:r,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new s(t.latestValues,e["data-framer-portal-id"]?void 0:TI(t.parent)),t.projection.setOptions({layoutId:i,layout:r,alwaysMeasureLayout:!!a||l&&pl(l),visualElement:t,animationType:typeof r=="string"?r:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:c,layoutRoot:u})}function TI(t){if(t)return t.options.allowProjection!==!1?t.projection:TI(t.parent)}function xg(t,{forwardMotionProps:e=!1}={},s,n){s&&IK(s);const i=o1(t)?eW:ZK;function r(l,c){let u;const d={...S.useContext(s1),...l,layoutId:aW(l)},{isStatic:h}=d,f=PK(l),m=i(l,h);if(!h&&D_){oW();const b=lW(d);u=b.MeasureLayout,f.visualElement=iW(t,m,d,n,b.ProjectionNode)}return o.jsxs(s0.Provider,{value:f,children:[u&&f.visualElement?o.jsx(u,{visualElement:f.visualElement,...d}):null,XK(t,l,sW(m,f.visualElement,c),m,h,e)]})}r.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=S.forwardRef(r);return a[tW]=t,a}function aW({layoutId:t}){const e=S.useContext(O_).id;return e&&t!==void 0?e+"-"+t:t}function oW(t,e){S.useContext(mI).strict}function lW(t){const{drag:e,layout:s}=ac;if(!e&&!s)return{};const n={...e,...s};return{MeasureLayout:e!=null&&e.isEnabled(t)||s!=null&&s.isEnabled(t)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function cW(t,e){if(typeof Proxy>"u")return xg;const s=new Map,n=(r,a)=>xg(r,a,t,e),i=(r,a)=>n(r,a);return new Proxy(i,{get:(r,a)=>a==="create"?n:(s.has(a)||s.set(a,xg(a,void 0,t,e)),s.get(a))})}function EI({top:t,left:e,right:s,bottom:n}){return{x:{min:e,max:s},y:{min:t,max:n}}}function uW({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function dW(t,e){if(!e)return t;const s=e({x:t.left,y:t.top}),n=e({x:t.right,y:t.bottom});return{top:s.y,left:s.x,bottom:n.y,right:n.x}}function bg(t){return t===void 0||t===1}function Eb({scale:t,scaleX:e,scaleY:s}){return!bg(t)||!bg(e)||!bg(s)}function qa(t){return Eb(t)||AI(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function AI(t){return bS(t.x)||bS(t.y)}function bS(t){return t&&t!=="0%"}function $m(t,e,s){const n=t-s,i=e*n;return s+i}function vS(t,e,s,n,i){return i!==void 0&&(t=$m(t,i,n)),$m(t,s,n)+e}function Ab(t,e=0,s=1,n,i){t.min=vS(t.min,e,s,n,i),t.max=vS(t.max,e,s,n,i)}function jI(t,{x:e,y:s}){Ab(t.x,e.translate,e.scale,e.originPoint),Ab(t.y,s.translate,s.scale,s.originPoint)}const yS=.999999999999,_S=1.0000000000001;function hW(t,e,s,n=!1){const i=s.length;if(!i)return;e.x=e.y=1;let r,a;for(let l=0;l<i;l++){r=s[l],a=r.projectionDelta;const{visualElement:c}=r.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&r.options.layoutScroll&&r.scroll&&r!==r.root&&xl(t,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,jI(t,a)),n&&qa(r.latestValues)&&xl(t,r.latestValues))}e.x<_S&&e.x>yS&&(e.x=1),e.y<_S&&e.y>yS&&(e.y=1)}function gl(t,e){t.min=t.min+e,t.max=t.max+e}function wS(t,e,s,n,i=.5){const r=At(t.min,t.max,i);Ab(t,e,s,r,n)}function xl(t,e){wS(t.x,e.x,e.scaleX,e.scale,e.originX),wS(t.y,e.y,e.scaleY,e.scale,e.originY)}function CI(t,e){return EI(dW(t.getBoundingClientRect(),e))}function fW(t,e,s){const n=CI(t,s),{scroll:i}=e;return i&&(gl(n.x,i.offset.x),gl(n.y,i.offset.y)),n}const kS=()=>({translate:0,scale:1,origin:0,originPoint:0}),bl=()=>({x:kS(),y:kS()}),NS=()=>({min:0,max:0}),Yt=()=>({x:NS(),y:NS()}),jb={current:null},RI={current:!1};function mW(){if(RI.current=!0,!!D_)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>jb.current=t.matches;t.addEventListener("change",e),e()}else jb.current=!1}const pW=new WeakMap;function gW(t,e,s){for(const n in e){const i=e[n],r=s[n];if(bs(i))t.addValue(n,i);else if(bs(r))t.addValue(n,rc(i,{owner:t}));else if(r!==i)if(t.hasValue(n)){const a=t.getValue(n);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=t.getStaticValue(n);t.addValue(n,rc(a!==void 0?a:i,{owner:t}))}}for(const n in s)e[n]===void 0&&t.removeValue(n);return e}const SS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class xW{scrapeMotionValuesFromProps(e,s,n){return{}}constructor({parent:e,props:s,presenceContext:n,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=Q_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Vs.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,Nt.render(this.render,!1,!0))};const{latestValues:c,renderState:u}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=u,this.parent=e,this.props=s,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!r,this.isControllingVariants=i0(s),this.isVariantNode=gI(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(s,{},this);for(const f in h){const m=h[f];c[f]!==void 0&&bs(m)&&m.set(c[f])}}mount(e){var s;this.current=e,pW.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),RI.current||mW(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:jb.current,(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),ka(this.notifyUpdate),ka(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const n=this.features[s];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,s){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Pc.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=s.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Nt.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,s)),this.valueSubscriptions.set(e,()=>{i(),r&&r(),s.owner&&s.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ac){const s=ac[e];if(!s)continue;const{isEnabled:n,Feature:i}=s;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const r=this.features[e];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Yt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,s){this.latestValues[e]=s}update(e,s){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let n=0;n<SS.length;n++){const i=SS[n];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const r="on"+i,a=e[r];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=gW(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(e),()=>s.variantChildren.delete(e)}addValue(e,s){const n=this.values.get(e);s!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,s),this.values.set(e,s),this.latestValues[e]=s.get())}removeValue(e){this.values.delete(e);const s=this.valueSubscriptions.get(e);s&&(s(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,s){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&s!==void 0&&(n=rc(s===null?void 0:s,{owner:this}),this.addValue(e,n)),n}readValue(e,s){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(wR(n)||NR(n))?n=parseFloat(n):!SK(n)&&Na.test(s)&&(n=aI(e,s)),this.setBaseTarget(e,bs(n)?n.get():n)),bs(n)?n.get():n}setBaseTarget(e,s){this.baseTarget[e]=s}getBaseTarget(e){var r;const{initial:s}=this.props;let n;if(typeof s=="string"||typeof s=="object"){const a=l1(this.props,s,(r=this.presenceContext)==null?void 0:r.custom);a&&(n=a[e])}if(s&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!bs(i)?i:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,s){return this.events[e]||(this.events[e]=new B_),this.events[e].add(s)}notify(e,...s){this.events[e]&&this.events[e].notify(...s)}scheduleRenderMicrotask(){e1.render(this.render)}}class II extends xW{constructor(){super(...arguments),this.KeyframeResolver=fK}sortInstanceNodePosition(e,s){return e.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(e,s){return e.style?e.style[s]:void 0}removeValueFromRenderState(e,{vars:s,style:n}){delete s[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;bs(e)&&(this.childSubscription=e.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function OI(t,{style:e,vars:s},n,i){const r=t.style;let a;for(a in e)r[a]=e[a];i==null||i.applyProjectionStyles(r,n);for(a in s)r.setProperty(a,s[a])}function bW(t){return window.getComputedStyle(t)}class vW extends II{constructor(){super(...arguments),this.type="html",this.renderInstance=OI}readValueFromInstance(e,s){var n;if(Pc.has(s))return(n=this.projection)!=null&&n.isProjecting?vb(s):Iq(e,s);{const i=bW(e),r=(VR(s)?i.getPropertyValue(s):i[s])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:s}){return CI(e,s)}build(e,s,n){r1(e,s,n.transformTemplate)}scrapeMotionValuesFromProps(e,s,n){return c1(e,s,n)}}const MI=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function yW(t,e,s,n){OI(t,e,void 0,n);for(const i in e.attrs)t.setAttribute(MI.has(i)?i:u1(i),e.attrs[i])}class _W extends II{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Yt}getBaseTargetFromProps(e,s){return e[s]}readValueFromInstance(e,s){if(Pc.has(s)){const n=rI(s);return n&&n.default||0}return s=MI.has(s)?s:u1(s),e.getAttribute(s)}scrapeMotionValuesFromProps(e,s,n){return kI(e,s,n)}build(e,s,n){vI(e,s,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,s,n,i){yW(e,s,n,i)}mount(e){this.isSVGTag=_I(e.tagName),super.mount(e)}}const wW=(t,e)=>o1(t)?new _W(e):new vW(e,{allowProjection:t!==S.Fragment});function Ml(t,e,s){const n=t.getProps();return l1(n,e,s!==void 0?s:n.custom,t)}const Cb=t=>Array.isArray(t);function kW(t,e,s){t.hasValue(e)?t.getValue(e).set(s):t.addValue(e,rc(s))}function NW(t){return Cb(t)?t[t.length-1]||0:t}function SW(t,e){const s=Ml(t,e);let{transitionEnd:n={},transition:i={},...r}=s||{};r={...r,...n};for(const a in r){const l=NW(r[a]);kW(t,a,l)}}function TW(t){return!!(bs(t)&&t.add)}function Rb(t,e){const s=t.getValue("willChange");if(TW(s))return s.add(e);if(!s&&ur.WillChange){const n=new ur.WillChange("auto");t.addValue("willChange",n),n.add(e)}}function DI(t){return t.props[NI]}const EW=t=>t!==null;function AW(t,{repeat:e,repeatType:s="loop"},n){const i=t.filter(EW),r=e&&s!=="loop"&&e%2===1?0:i.length-1;return i[r]}const jW={type:"spring",stiffness:500,damping:25,restSpeed:10},CW=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),RW={type:"keyframes",duration:.8},IW={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},OW=(t,{keyframes:e})=>e.length>2?RW:Pc.has(t)?t.startsWith("scale")?CW(e[1]):jW:IW;function MW({when:t,delay:e,delayChildren:s,staggerChildren:n,staggerDirection:i,repeat:r,repeatType:a,repeatDelay:l,from:c,elapsed:u,...d}){return!!Object.keys(d).length}const d1=(t,e,s,n={},i,r)=>a=>{const l=J_(n,t)||{},c=l.delay||n.delay||0;let{elapsed:u=0}=n;u=u-di(c);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-u,onUpdate:f=>{e.set(f),l.onUpdate&&l.onUpdate(f)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:r?void 0:i};MW(l)||Object.assign(d,OW(t,d)),d.duration&&(d.duration=di(d.duration)),d.repeatDelay&&(d.repeatDelay=di(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(Nb(d),d.delay===0&&(h=!0)),(ur.instantAnimations||ur.skipAnimations)&&(h=!0,Nb(d),d.delay=0),d.allowFlatten=!l.type&&!l.ease,h&&!r&&e.get()!==void 0){const f=AW(d.keyframes,l);if(f!==void 0){Nt.update(()=>{d.onUpdate(f),d.onComplete()});return}}return l.isSync?new X_(d):new tK(d)};function DW({protectedKeys:t,needsAnimating:e},s){const n=t.hasOwnProperty(s)&&e[s]!==!0;return e[s]=!1,n}function LI(t,e,{delay:s=0,transitionOverride:n,type:i}={}){let{transition:r=t.getDefaultTransition(),transitionEnd:a,...l}=e;n&&(r=n);const c=[],u=i&&t.animationState&&t.animationState.getState()[i];for(const d in l){const h=t.getValue(d,t.latestValues[d]??null),f=l[d];if(f===void 0||u&&DW(u,d))continue;const m={delay:s,...J_(r||{},d)},b=h.get();if(b!==void 0&&!h.isAnimating&&!Array.isArray(f)&&f===b&&!m.velocity)continue;let p=!1;if(window.MotionHandoffAnimation){const x=DI(t);if(x){const g=window.MotionHandoffAnimation(x,d,Nt);g!==null&&(m.startTime=g,p=!0)}}Rb(t,d),h.start(d1(d,h,f,t.shouldReduceMotion&&sI.has(d)?{type:!1}:m,t,p));const v=h.animation;v&&c.push(v)}return a&&Promise.all(c).then(()=>{Nt.update(()=>{a&&SW(t,a)})}),c}function PI(t,e,s,n=0,i=1){const r=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),a=t.size,l=(a-1)*n;return typeof s=="function"?s(r,a):i===1?r*n:l-r*n}function Ib(t,e,s={}){var c;const n=Ml(t,e,s.type==="exit"?(c=t.presenceContext)==null?void 0:c.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=n||{};s.transitionOverride&&(i=s.transitionOverride);const r=n?()=>Promise.all(LI(t,n,s)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:f}=i;return LW(t,e,u,d,h,f,s)}:()=>Promise.resolve(),{when:l}=i;if(l){const[u,d]=l==="beforeChildren"?[r,a]:[a,r];return u().then(()=>d())}else return Promise.all([r(),a(s.delay)])}function LW(t,e,s=0,n=0,i=0,r=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Ib(c,e,{...a,delay:s+(typeof n=="function"?0:n)+PI(t.variantChildren,c,n,i,r)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function PW(t,e,s={}){t.notify("AnimationStart",e);let n;if(Array.isArray(e)){const i=e.map(r=>Ib(t,r,s));n=Promise.all(i)}else if(typeof e=="string")n=Ib(t,e,s);else{const i=typeof e=="function"?Ml(t,e,s.custom):e;n=Promise.all(LI(t,i,s))}return n.then(()=>{t.notify("AnimationComplete",e)})}function VI(t,e){if(!Array.isArray(e))return!1;const s=e.length;if(s!==t.length)return!1;for(let n=0;n<s;n++)if(e[n]!==t[n])return!1;return!0}const VW=i1.length;function FI(t){if(!t)return;if(!t.isControllingVariants){const s=t.parent?FI(t.parent)||{}:{};return t.props.initial!==void 0&&(s.initial=t.props.initial),s}const e={};for(let s=0;s<VW;s++){const n=i1[s],i=t.props[n];(xd(i)||i===!1)&&(e[n]=i)}return e}const FW=[...n1].reverse(),BW=n1.length;function UW(t){return e=>Promise.all(e.map(({animation:s,options:n})=>PW(t,s,n)))}function $W(t){let e=UW(t),s=TS(),n=!0;const i=c=>(u,d)=>{var f;const h=Ml(t,d,c==="exit"?(f=t.presenceContext)==null?void 0:f.custom:void 0);if(h){const{transition:m,transitionEnd:b,...p}=h;u={...u,...p,...b}}return u};function r(c){e=c(t)}function a(c){const{props:u}=t,d=FI(t.parent)||{},h=[],f=new Set;let m={},b=1/0;for(let v=0;v<BW;v++){const x=FW[v],g=s[x],y=u[x]!==void 0?u[x]:d[x],w=xd(y),k=x===c?g.isActive:null;k===!1&&(b=v);let N=y===d[x]&&y!==u[x]&&w;if(N&&n&&t.manuallyAnimateOnMount&&(N=!1),g.protectedKeys={...m},!g.isActive&&k===null||!y&&!g.prevProp||n0(y)||typeof y=="boolean")continue;const _=GW(g.prevProp,y);let T=_||x===c&&g.isActive&&!N&&w||v>b&&w,E=!1;const A=Array.isArray(y)?y:[y];let R=A.reduce(i(x),{});k===!1&&(R={});const{prevResolvedValues:I={}}=g,V={...I,...R},H=L=>{T=!0,f.has(L)&&(E=!0,f.delete(L)),g.needsAnimating[L]=!0;const M=t.getValue(L);M&&(M.liveStyle=!1)};for(const L in V){const M=R[L],F=I[L];if(m.hasOwnProperty(L))continue;let U=!1;Cb(M)&&Cb(F)?U=!VI(M,F):U=M!==F,U?M!=null?H(L):f.add(L):M!==void 0&&f.has(L)?H(L):g.protectedKeys[L]=!0}g.prevProp=y,g.prevResolvedValues=R,g.isActive&&(m={...m,...R}),n&&t.blockInitialAnimation&&(T=!1);const P=N&&_;T&&(!P||E)&&h.push(...A.map(L=>{const M={type:x};if(typeof L=="string"&&n&&!P&&t.manuallyAnimateOnMount&&t.parent){const{parent:F}=t,U=Ml(F,L);if(F.enteringChildren&&U){const{delayChildren:C}=U.transition||{};M.delay=PI(F.enteringChildren,t,C)}}return{animation:L,options:M}}))}if(f.size){const v={};if(typeof u.initial!="boolean"){const x=Ml(t,Array.isArray(u.initial)?u.initial[0]:u.initial);x&&x.transition&&(v.transition=x.transition)}f.forEach(x=>{const g=t.getBaseTarget(x),y=t.getValue(x);y&&(y.liveStyle=!0),v[x]=g??null}),h.push({animation:v})}let p=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(p=!1),n=!1,p?e(h):Promise.resolve()}function l(c,u){var h;if(s[c].isActive===u)return Promise.resolve();(h=t.variantChildren)==null||h.forEach(f=>{var m;return(m=f.animationState)==null?void 0:m.setActive(c,u)}),s[c].isActive=u;const d=a(c);for(const f in s)s[f].protectedKeys={};return d}return{animateChanges:a,setActive:l,setAnimateFunction:r,getState:()=>s,reset:()=>{s=TS()}}}function GW(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!VI(e,t):!1}function Pa(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function TS(){return{animate:Pa(!0),whileInView:Pa(),whileHover:Pa(),whileTap:Pa(),whileDrag:Pa(),whileFocus:Pa(),exit:Pa()}}class Ra{constructor(e){this.isMounted=!1,this.node=e}update(){}}class HW extends Ra{constructor(e){super(e),e.animationState||(e.animationState=$W(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();n0(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:s}=this.node.prevProps||{};e!==s&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let zW=0;class qW extends Ra{constructor(){super(...arguments),this.id=zW++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:s}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);s&&!e&&i.then(()=>{s(this.id)})}mount(){const{register:e,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const KW={animation:{Feature:HW},exit:{Feature:qW}};function bd(t,e,s,n={passive:!0}){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s)}function dh(t){return{point:{x:t.pageX,y:t.pageY}}}const WW=t=>e=>t1(e)&&t(e,dh(e));function Iu(t,e,s,n){return bd(t,e,WW(s),n)}const BI=1e-4,YW=1-BI,XW=1+BI,UI=.01,QW=0-UI,JW=0+UI;function Ss(t){return t.max-t.min}function ZW(t,e,s){return Math.abs(t-e)<=s}function ES(t,e,s,n=.5){t.origin=n,t.originPoint=At(e.min,e.max,t.origin),t.scale=Ss(s)/Ss(e),t.translate=At(s.min,s.max,t.origin)-t.originPoint,(t.scale>=YW&&t.scale<=XW||isNaN(t.scale))&&(t.scale=1),(t.translate>=QW&&t.translate<=JW||isNaN(t.translate))&&(t.translate=0)}function Ou(t,e,s,n){ES(t.x,e.x,s.x,n?n.originX:void 0),ES(t.y,e.y,s.y,n?n.originY:void 0)}function AS(t,e,s){t.min=s.min+e.min,t.max=t.min+Ss(e)}function eY(t,e,s){AS(t.x,e.x,s.x),AS(t.y,e.y,s.y)}function jS(t,e,s){t.min=e.min-s.min,t.max=t.min+Ss(e)}function Gm(t,e,s){jS(t.x,e.x,s.x),jS(t.y,e.y,s.y)}function hn(t){return[t("x"),t("y")]}const $I=({current:t})=>t?t.ownerDocument.defaultView:null,CS=(t,e)=>Math.abs(t-e);function tY(t,e){const s=CS(t.x,e.x),n=CS(t.y,e.y);return Math.sqrt(s**2+n**2)}class GI{constructor(e,s,{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=yg(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,b=tY(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!b)return;const{point:p}=f,{timestamp:v}=us;this.history.push({...p,timestamp:v});const{onStart:x,onMove:g}=this.handlers;m||(x&&x(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),g&&g(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=vg(m,this.transformPagePoint),Nt.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:b,onSessionEnd:p,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=yg(f.type==="pointercancel"?this.lastMoveEventInfo:vg(m,this.transformPagePoint),this.history);this.startEvent&&b&&b(f,x),p&&p(f,x)},!t1(e))return;this.dragSnapToOrigin=r,this.handlers=s,this.transformPagePoint=n,this.distanceThreshold=a,this.contextWindow=i||window;const l=dh(e),c=vg(l,this.transformPagePoint),{point:u}=c,{timestamp:d}=us;this.history=[{...u,timestamp:d}];const{onSessionStart:h}=s;h&&h(e,yg(c,this.history)),this.removeListeners=lh(Iu(this.contextWindow,"pointermove",this.handlePointerMove),Iu(this.contextWindow,"pointerup",this.handlePointerUp),Iu(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ka(this.updatePoint)}}function vg(t,e){return e?{point:e(t.point)}:t}function RS(t,e){return{x:t.x-e.x,y:t.y-e.y}}function yg({point:t},e){return{point:t,delta:RS(t,HI(e)),offset:RS(t,sY(e)),velocity:nY(e,.1)}}function sY(t){return t[0]}function HI(t){return t[t.length-1]}function nY(t,e){if(t.length<2)return{x:0,y:0};let s=t.length-1,n=null;const i=HI(t);for(;s>=0&&(n=t[s],!(i.timestamp-n.timestamp>di(e)));)s--;if(!n)return{x:0,y:0};const r=_n(i.timestamp-n.timestamp);if(r===0)return{x:0,y:0};const a={x:(i.x-n.x)/r,y:(i.y-n.y)/r};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function iY(t,{min:e,max:s},n){return e!==void 0&&t<e?t=n?At(e,t,n.min):Math.max(t,e):s!==void 0&&t>s&&(t=n?At(s,t,n.max):Math.min(t,s)),t}function IS(t,e,s){return{min:e!==void 0?t.min+e:void 0,max:s!==void 0?t.max+s-(t.max-t.min):void 0}}function rY(t,{top:e,left:s,bottom:n,right:i}){return{x:IS(t.x,s,i),y:IS(t.y,e,n)}}function OS(t,e){let s=e.min-t.min,n=e.max-t.max;return e.max-e.min<t.max-t.min&&([s,n]=[n,s]),{min:s,max:n}}function aY(t,e){return{x:OS(t.x,e.x),y:OS(t.y,e.y)}}function oY(t,e){let s=.5;const n=Ss(t),i=Ss(e);return i>n?s=md(e.min,e.max-n,t.min):n>i&&(s=md(t.min,t.max-i,e.min)),cr(0,1,s)}function lY(t,e){const s={};return e.min!==void 0&&(s.min=e.min-t.min),e.max!==void 0&&(s.max=e.max-t.min),s}const Ob=.35;function cY(t=Ob){return t===!1?t=0:t===!0&&(t=Ob),{x:MS(t,"left","right"),y:MS(t,"top","bottom")}}function MS(t,e,s){return{min:DS(t,e),max:DS(t,s)}}function DS(t,e){return typeof t=="number"?t:t[e]||0}const uY=new WeakMap;class dY{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Yt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:s=!1,distanceThreshold:n}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(dh(h).point)},a=(h,f)=>{const{drag:m,dragPropagation:b,onDragStart:p}=this.getProps();if(m&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=xK(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=f,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),hn(x=>{let g=this.getAxisMotionValue(x).get()||0;if(hi.test(g)){const{projection:y}=this.visualElement;if(y&&y.layout){const w=y.layout.layoutBox[x];w&&(g=Ss(w)*(parseFloat(g)/100))}}this.originPoint[x]=g}),p&&Nt.postRender(()=>p(h,f)),Rb(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},l=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f;const{dragPropagation:m,dragDirectionLock:b,onDirectionLock:p,onDrag:v}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:x}=f;if(b&&this.currentDirection===null){this.currentDirection=hY(x),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",f.point,x),this.updateAxis("y",f.point,x),this.visualElement.render(),v&&v(h,f)},c=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f,this.stop(h,f),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>hn(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)==null?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new GI(e,{onSessionStart:r,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:n,contextWindow:$I(this.visualElement)})}stop(e,s){const n=e||this.latestPointerEvent,i=s||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!n)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&Nt.postRender(()=>l(n,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:s}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(e,s,n){const{drag:i}=this.getProps();if(!n||!Bh(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=iY(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){var r;const{dragConstraints:e,dragElastic:s}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(r=this.visualElement.projection)==null?void 0:r.layout,i=this.constraints;e&&pl(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=rY(n.layoutBox,e):this.constraints=!1,this.elastic=cY(s),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&hn(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=lY(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:s}=this.getProps();if(!e||!pl(e))return!1;const n=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=fW(n,i.root,this.visualElement.getTransformPagePoint());let a=aY(i.layout.layoutBox,r);if(s){const l=s(uW(a));this.hasMutatedConstraints=!!l,l&&(a=EI(l))}return a}startAnimation(e){const{drag:s,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},u=hn(d=>{if(!Bh(d,s,this.currentDirection))return;let h=c&&c[d]||{};a&&(h={min:0,max:0});const f=i?200:1e6,m=i?40:1e7,b={type:"inertia",velocity:n?e[d]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...r,...h};return this.startAxisValueAnimation(d,b)});return Promise.all(u).then(l)}startAxisValueAnimation(e,s){const n=this.getAxisMotionValue(e);return Rb(this.visualElement,e),n.start(d1(e,n,0,s,this.visualElement,!1))}stopAnimation(){hn(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){hn(e=>{var s;return(s=this.getAxisMotionValue(e).animation)==null?void 0:s.pause()})}getAnimationState(e){var s;return(s=this.getAxisMotionValue(e).animation)==null?void 0:s.state}getAxisMotionValue(e){const s=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),i=n[s];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){hn(s=>{const{drag:n}=this.getProps();if(!Bh(s,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(s);if(i&&i.layout){const{min:a,max:l}=i.layout.layoutBox[s];r.set(e[s]-At(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:s}=this.getProps(),{projection:n}=this.visualElement;if(!pl(s)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};hn(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();i[a]=oY({min:c,max:c},this.constraints[a])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),hn(a=>{if(!Bh(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:u}=this.constraints[a];l.set(At(c,u,i[a]))})}addListeners(){if(!this.visualElement.current)return;uY.set(this.visualElement,this);const e=this.visualElement.current,s=Iu(e,"pointerdown",c=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();pl(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,r=i.addEventListener("measure",n);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Nt.read(n);const a=bd(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:u})=>{this.isDragging&&u&&(hn(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=c[d].translate,h.set(h.get()+c[d].translate))}),this.visualElement.render())});return()=>{a(),s(),r(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=Ob,dragMomentum:l=!0}=e;return{...e,drag:s,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:l}}}function Bh(t,e,s){return(e===!0||e===t)&&(s===null||s===t)}function hY(t,e=10){let s=null;return Math.abs(t.y)>e?s="y":Math.abs(t.x)>e&&(s="x"),s}class fY extends Ra{constructor(e){super(e),this.removeGroupControls=jn,this.removeListeners=jn,this.controls=new dY(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||jn}unmount(){this.removeGroupControls(),this.removeListeners()}}const LS=t=>(e,s)=>{t&&Nt.postRender(()=>t(e,s))};class mY extends Ra{constructor(){super(...arguments),this.removePointerDownListener=jn}onPointerDown(e){this.session=new GI(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:$I(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:s,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:LS(e),onStart:LS(s),onMove:n,onEnd:(r,a)=>{delete this.session,i&&Nt.postRender(()=>i(r,a))}}}mount(){this.removePointerDownListener=Iu(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const xf={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let _g=!1;class pY extends S.Component{componentDidMount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;r&&(s.group&&s.group.add(r),n&&n.register&&i&&n.register(r),_g&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),xf.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:s,visualElement:n,drag:i,isPresent:r}=this.props,{projection:a}=n;return a&&(a.isPresent=r,_g=!0,i||e.layoutDependency!==s||s===void 0||e.isPresent!==r?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||Nt.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),e1.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n}=this.props,{projection:i}=e;_g=!0,i&&(i.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function zI(t){const[e,s]=fI(),n=S.useContext(O_);return o.jsx(pY,{...t,layoutGroup:n,switchLayoutGroup:S.useContext(SI),isPresent:e,safeToRemove:s})}function gY(t,e,s){const n=bs(t)?t:rc(t);return n.start(d1("",n,e,s)),n.animation}const xY=(t,e)=>t.depth-e.depth;class bY{constructor(){this.children=[],this.isDirty=!1}add(e){L_(this.children,e),this.isDirty=!0}remove(e){P_(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(xY),this.isDirty=!1,this.children.forEach(e)}}function vY(t,e){const s=Vs.now(),n=({timestamp:i})=>{const r=i-s;r>=e&&(ka(n),t(r-e))};return Nt.setup(n,!0),()=>ka(n)}const qI=["TopLeft","TopRight","BottomLeft","BottomRight"],yY=qI.length,PS=t=>typeof t=="string"?parseFloat(t):t,VS=t=>typeof t=="number"||be.test(t);function _Y(t,e,s,n,i,r){i?(t.opacity=At(0,s.opacity??1,wY(n)),t.opacityExit=At(e.opacity??1,0,kY(n))):r&&(t.opacity=At(e.opacity??1,s.opacity??1,n));for(let a=0;a<yY;a++){const l=`border${qI[a]}Radius`;let c=FS(e,l),u=FS(s,l);if(c===void 0&&u===void 0)continue;c||(c=0),u||(u=0),c===0||u===0||VS(c)===VS(u)?(t[l]=Math.max(At(PS(c),PS(u),n),0),(hi.test(u)||hi.test(c))&&(t[l]+="%")):t[l]=u}(e.rotate||s.rotate)&&(t.rotate=At(e.rotate||0,s.rotate||0,n))}function FS(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const wY=KI(0,.5,IR),kY=KI(.5,.95,jn);function KI(t,e,s){return n=>n<t?0:n>e?1:s(md(t,e,n))}function BS(t,e){t.min=e.min,t.max=e.max}function Dn(t,e){BS(t.x,e.x),BS(t.y,e.y)}function US(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function $S(t,e,s,n,i){return t-=e,t=$m(t,1/s,n),i!==void 0&&(t=$m(t,1/i,n)),t}function NY(t,e=0,s=1,n=.5,i,r=t,a=t){if(hi.test(e)&&(e=parseFloat(e),e=At(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=At(r.min,r.max,n);t===r&&(l-=e),t.min=$S(t.min,e,s,l,i),t.max=$S(t.max,e,s,l,i)}function GS(t,e,[s,n,i],r,a){NY(t,e[s],e[n],e[i],e.scale,r,a)}const SY=["x","scaleX","originX"],TY=["y","scaleY","originY"];function HS(t,e,s,n){GS(t.x,e,SY,s?s.x:void 0,n?n.x:void 0),GS(t.y,e,TY,s?s.y:void 0,n?n.y:void 0)}function zS(t){return t.translate===0&&t.scale===1}function WI(t){return zS(t.x)&&zS(t.y)}function qS(t,e){return t.min===e.min&&t.max===e.max}function EY(t,e){return qS(t.x,e.x)&&qS(t.y,e.y)}function KS(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function YI(t,e){return KS(t.x,e.x)&&KS(t.y,e.y)}function WS(t){return Ss(t.x)/Ss(t.y)}function YS(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class AY{constructor(){this.members=[]}add(e){L_(this.members,e),e.scheduleRender()}remove(e){if(P_(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(e){const s=this.members.findIndex(i=>e===i);if(s===0)return!1;let n;for(let i=s;i>=0;i--){const r=this.members[i];if(r.isPresent!==!1){n=r;break}}return n?(this.promote(n),!0):!1}promote(e,s){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,s&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:s,resumingFrom:n}=e;s.onExitComplete&&s.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function jY(t,e,s){let n="";const i=t.x.translate/e.x,r=t.y.translate/e.y,a=(s==null?void 0:s.z)||0;if((i||r||a)&&(n=`translate3d(${i}px, ${r}px, ${a}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),s){const{transformPerspective:u,rotate:d,rotateX:h,rotateY:f,skewX:m,skewY:b}=s;u&&(n=`perspective(${u}px) ${n}`),d&&(n+=`rotate(${d}deg) `),h&&(n+=`rotateX(${h}deg) `),f&&(n+=`rotateY(${f}deg) `),m&&(n+=`skewX(${m}deg) `),b&&(n+=`skewY(${b}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const wg=["","X","Y","Z"],CY=1e3;let RY=0;function kg(t,e,s,n){const{latestValues:i}=e;i[t]&&(s[t]=i[t],e.setStaticValue(t,0),n&&(n[t]=0))}function XI(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const s=DI(e);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:i,layoutId:r}=t.options;window.MotionCancelOptimisedAnimation(s,"transform",Nt,!(i||r))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&XI(n)}function QI({attachResizeListener:t,defaultParent:e,measureScroll:s,checkIsScrollRoot:n,resetTransform:i}){return class{constructor(a={},l=e==null?void 0:e()){this.id=RY++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(MY),this.nodes.forEach(VY),this.nodes.forEach(FY),this.nodes.forEach(DY)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new bY)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new B_),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=hI(a)&&!kK(a),this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let d,h=0;const f=()=>this.root.updateBlockedByResize=!1;Nt.read(()=>{h=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,d&&d(),d=vY(f,250),xf.hasAnimatedSinceResize&&(xf.hasAnimatedSinceResize=!1,this.nodes.forEach(JS)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:f,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||u.getDefaultTransition()||HY,{onLayoutAnimationStart:p,onLayoutAnimationComplete:v}=u.getProps(),x=!this.targetLayout||!YI(this.targetLayout,m),g=!h&&f;if(this.options.layoutRoot||this.resumeFrom||g||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const y={...J_(b,"layout"),onPlay:p,onComplete:v};(u.shouldReduceMotion||this.options.layoutRoot)&&(y.delay=0,y.type=!1),this.startAnimation(y),this.setAnimationOrigin(d,g)}else h||JS(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),ka(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(BY),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&XI(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(XS);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(QS);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(PY),this.nodes.forEach(IY),this.nodes.forEach(OY)):this.nodes.forEach(QS),this.clearAllSnapshots();const l=Vs.now();us.delta=cr(0,1e3/60,l-us.timestamp),us.timestamp=l,us.isProcessing=!0,dg.update.process(us),dg.preRender.process(us),dg.render.process(us),us.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,e1.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(LY),this.sharedNodes.forEach(UY)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Nt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Nt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ss(this.snapshot.measuredBox.x)&&!Ss(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Yt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!WI(this.projectionDelta),c=this.getTransformTemplate(),u=c?c(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;a&&this.instance&&(l||qa(this.latestValues)||d)&&(i(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),zY(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:a}=this.options;if(!a)return Yt();const l=a.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(qY))){const{scroll:d}=this.root;d&&(gl(l.x,d.offset.x),gl(l.y,d.offset.y))}return l}removeElementScroll(a){var c;const l=Yt();if(Dn(l,a),(c=this.scroll)!=null&&c.wasRoot)return l;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:h,options:f}=d;d!==this.root&&h&&f.layoutScroll&&(h.wasRoot&&Dn(l,a),gl(l.x,h.offset.x),gl(l.y,h.offset.y))}return l}applyTransform(a,l=!1){const c=Yt();Dn(c,a);for(let u=0;u<this.path.length;u++){const d=this.path[u];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&xl(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),qa(d.latestValues)&&xl(c,d.latestValues)}return qa(this.latestValues)&&xl(c,this.latestValues),c}removeTransform(a){const l=Yt();Dn(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];if(!u.instance||!qa(u.latestValues))continue;Eb(u.latestValues)&&u.updateSnapshot();const d=Yt(),h=u.measurePageBox();Dn(d,h),HS(l,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return qa(this.latestValues)&&HS(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==us.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var m;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!this.layout||!(d||h))return;this.resolvedRelativeTargetAt=us.timestamp;const f=this.getClosestProjectingParent();f&&this.linkedParentVersion!==f.layoutVersion&&!f.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(f&&f.layout?this.createRelativeTarget(f,this.layout.layoutBox,f.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Yt(),this.targetWithTransforms=Yt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),eY(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Dn(this.target,this.layout.layoutBox),jI(this.target,this.targetDelta)):Dn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?this.createRelativeTarget(f,this.target,f.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||Eb(this.parent.latestValues)||AI(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yt(),this.relativeTargetOrigin=Yt(),Gm(this.relativeTargetOrigin,l,c),Dn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var b;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||(b=this.parent)!=null&&b.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===us.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Dn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;hW(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Yt());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(US(this.prevProjectionDelta.x,this.projectionDelta.x),US(this.prevProjectionDelta.y,this.projectionDelta.y)),Ou(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!YS(this.projectionDelta.x,this.prevProjectionDelta.x)||!YS(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),a){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=bl(),this.projectionDelta=bl(),this.projectionDeltaWithTransform=bl()}setAnimationOrigin(a,l=!1){const c=this.snapshot,u=c?c.latestValues:{},d={...this.latestValues},h=bl();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const f=Yt(),m=c?c.source:void 0,b=this.layout?this.layout.source:void 0,p=m!==b,v=this.getStack(),x=!v||v.members.length<=1,g=!!(p&&!x&&this.options.crossfade===!0&&!this.path.some(GY));this.animationProgress=0;let y;this.mixTargetDelta=w=>{const k=w/1e3;ZS(h.x,a.x,k),ZS(h.y,a.y,k),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Gm(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),$Y(this.relativeTarget,this.relativeTargetOrigin,f,k),y&&EY(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=Yt()),Dn(y,this.relativeTarget)),p&&(this.animationValues=d,_Y(d,u,this.latestValues,k,g,x)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=k},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var l,c,u;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(u=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||u.stop(),this.pendingAnimation&&(ka(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Nt.update(()=>{xf.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=rc(0)),this.currentAnimation=gY(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),a.onUpdate&&a.onUpdate(d)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(CY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:u,latestValues:d}=a;if(!(!l||!c||!u)){if(this!==a&&this.layout&&u&&JI(this.options.animationType,this.layout.layoutBox,u.layoutBox)){c=this.target||Yt();const h=Ss(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const f=Ss(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+f}Dn(l,c),xl(l,d),Ou(this.projectionDeltaWithTransform,this.layoutCorrected,l,d)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new AY),this.sharedNodes.get(a).add(l);const u=l.options.initialPromotionConfig;l.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var l;const{layoutId:a}=this.options;return a?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:a}=this.options;return a?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const u=this.getStack();u&&u.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const u={};c.z&&kg("z",a,u,this.animationValues);for(let d=0;d<wg.length;d++)kg(`rotate${wg[d]}`,a,u,this.animationValues),kg(`skew${wg[d]}`,a,u,this.animationValues);a.render();for(const d in u)a.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=gf(l==null?void 0:l.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=gf(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!qa(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let h=jY(this.projectionDeltaWithTransform,this.treeScale,d);c&&(h=c(d,h)),a.transform=h;const{x:f,y:m}=this.projectionDelta;a.transformOrigin=`${f.origin*100}% ${m.origin*100}% 0`,u.animationValues?a.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:a.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const b in Tb){if(d[b]===void 0)continue;const{correct:p,applyTo:v,isCSSVariable:x}=Tb[b],g=h==="none"?d[b]:p(d[b],u);if(v){const y=v.length;for(let w=0;w<y;w++)a[v[w]]=g}else x?this.options.visualElement.renderState.vars[b]=g:a[b]=g}this.options.layoutId&&(a.pointerEvents=u===this?gf(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(XS),this.root.sharedNodes.clear()}}}function IY(t){t.updateLayout()}function OY(t){var s;const e=((s=t.resumeFrom)==null?void 0:s.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,a=e.source!==t.layout.source;r==="size"?hn(h=>{const f=a?e.measuredBox[h]:e.layoutBox[h],m=Ss(f);f.min=n[h].min,f.max=f.min+m}):JI(r,e.layoutBox,n)&&hn(h=>{const f=a?e.measuredBox[h]:e.layoutBox[h],m=Ss(n[h]);f.max=f.min+m,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[h].max=t.relativeTarget[h].min+m)});const l=bl();Ou(l,n,e.layoutBox);const c=bl();a?Ou(c,t.applyTransform(i,!0),e.measuredBox):Ou(c,n,e.layoutBox);const u=!WI(l);let d=!1;if(!t.resumeFrom){const h=t.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:m}=h;if(f&&m){const b=Yt();Gm(b,e.layoutBox,f.layoutBox);const p=Yt();Gm(p,n,m.layoutBox),YI(b,p)||(d=!0),h.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=b,t.relativeParent=h)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:c,layoutDelta:l,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function MY(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function DY(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function LY(t){t.clearSnapshot()}function XS(t){t.clearMeasurements()}function QS(t){t.isLayoutDirty=!1}function PY(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function JS(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function VY(t){t.resolveTargetDelta()}function FY(t){t.calcProjection()}function BY(t){t.resetSkewAndRotation()}function UY(t){t.removeLeadSnapshot()}function ZS(t,e,s){t.translate=At(e.translate,0,s),t.scale=At(e.scale,1,s),t.origin=e.origin,t.originPoint=e.originPoint}function eT(t,e,s,n){t.min=At(e.min,s.min,n),t.max=At(e.max,s.max,n)}function $Y(t,e,s,n){eT(t.x,e.x,s.x,n),eT(t.y,e.y,s.y,n)}function GY(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const HY={duration:.45,ease:[.4,0,.1,1]},tT=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),sT=tT("applewebkit/")&&!tT("chrome/")?Math.round:jn;function nT(t){t.min=sT(t.min),t.max=sT(t.max)}function zY(t){nT(t.x),nT(t.y)}function JI(t,e,s){return t==="position"||t==="preserve-aspect"&&!ZW(WS(e),WS(s),.2)}function qY(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const KY=QI({attachResizeListener:(t,e)=>bd(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Ng={current:void 0},ZI=QI({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Ng.current){const t=new KY({});t.mount(window),t.setOptions({layoutScroll:!0}),Ng.current=t}return Ng.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),WY={pan:{Feature:mY},drag:{Feature:fY,ProjectionNode:ZI,MeasureLayout:zI}};function iT(t,e,s){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover",s==="Start");const i="onHover"+s,r=n[i];r&&Nt.postRender(()=>r(e,dh(e)))}class YY extends Ra{mount(){const{current:e}=this.node;e&&(this.unmount=bK(e,(s,n)=>(iT(this.node,n,"Start"),i=>iT(this.node,i,"End"))))}unmount(){}}class XY extends Ra{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=lh(bd(this.node.current,"focus",()=>this.onFocus()),bd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function rT(t,e,s){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap",s==="Start");const i="onTap"+(s==="End"?"":s),r=n[i];r&&Nt.postRender(()=>r(e,dh(e)))}class QY extends Ra{mount(){const{current:e}=this.node;e&&(this.unmount=wK(e,(s,n)=>(rT(this.node,n,"Start"),(i,{success:r})=>rT(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Mb=new WeakMap,Sg=new WeakMap,JY=t=>{const e=Mb.get(t.target);e&&e(t)},ZY=t=>{t.forEach(JY)};function eX({root:t,...e}){const s=t||document;Sg.has(s)||Sg.set(s,{});const n=Sg.get(s),i=JSON.stringify(e);return n[i]||(n[i]=new IntersectionObserver(ZY,{root:t,...e})),n[i]}function tX(t,e,s){const n=eX(e);return Mb.set(t,s),n.observe(t),()=>{Mb.delete(t),n.unobserve(t)}}const sX={some:0,all:1};class nX extends Ra{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:s,margin:n,amount:i="some",once:r}=e,a={root:s?s.current:void 0,rootMargin:n,threshold:typeof i=="number"?i:sX[i]},l=c=>{const{isIntersecting:u}=c;if(this.isInView===u||(this.isInView=u,r&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),f=u?d:h;f&&f(c)};return tX(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:s}=this.node;["amount","margin","root"].some(iX(e,s))&&this.startObserver()}unmount(){}}function iX({viewport:t={}},{viewport:e={}}={}){return s=>t[s]!==e[s]}const rX={inView:{Feature:nX},tap:{Feature:QY},focus:{Feature:XY},hover:{Feature:YY}},aX={layout:{ProjectionNode:ZI,MeasureLayout:zI}},oX={...KW,...rX,...WY,...aX},Z=cW(oX,wW);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lX=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),cX=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,n)=>n?n.toUpperCase():s.toLowerCase()),aT=t=>{const e=cX(t);return e.charAt(0).toUpperCase()+e.slice(1)},eO=(...t)=>t.filter((e,s,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===s).join(" ").trim(),uX=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var dX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hX=S.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:i="",children:r,iconNode:a,...l},c)=>S.createElement("svg",{ref:c,...dX,width:e,height:e,stroke:t,strokeWidth:n?Number(s)*24/Number(e):s,className:eO("lucide",i),...!r&&!uX(l)&&{"aria-hidden":"true"},...l},[...a.map(([u,d])=>S.createElement(u,d)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=(t,e)=>{const s=S.forwardRef(({className:n,...i},r)=>S.createElement(hX,{ref:r,iconNode:e,className:eO(`lucide-${lX(aT(t))}`,`lucide-${t}`,n),...i}));return s.displayName=aT(t),s};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fX=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],oT=te("activity",fX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mX=[["path",{d:"M12 6v16",key:"nqf5sj"}],["path",{d:"m19 13 2-1a9 9 0 0 1-18 0l2 1",key:"y7qv08"}],["path",{d:"M9 11h6",key:"1fldmi"}],["circle",{cx:"12",cy:"4",r:"2",key:"muu5ef"}]],r0=te("anchor",mX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pX=[["path",{d:"M11 9a1 1 0 0 0 1-1V5.061a1 1 0 0 1 1.811-.75l6.836 6.836a1.207 1.207 0 0 1 0 1.707l-6.836 6.835a1 1 0 0 1-1.811-.75V16a1 1 0 0 0-1-1H5a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1z",key:"1232du"}]],gX=te("arrow-big-right",pX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xX=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],aa=te("arrow-right",xX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bX=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],vX=te("arrow-up",bX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yX=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],lT=te("award",yX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _X=[["path",{d:"m14 12-8.381 8.38a1 1 0 0 1-3.001-3L11 9",key:"5z9253"}],["path",{d:"M15 15.5a.5.5 0 0 0 .5.5A6.5 6.5 0 0 0 22 9.5a.5.5 0 0 0-.5-.5h-1.672a2 2 0 0 1-1.414-.586l-5.062-5.062a1.205 1.205 0 0 0-1.704 0L9.352 5.648a1.205 1.205 0 0 0 0 1.704l5.062 5.062A2 2 0 0 1 15 13.828z",key:"19zklq"}]],wX=te("axe",_X);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kX=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],cT=te("bed",kX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NX=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],tO=te("box",NX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SX=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],TX=te("brain",SX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EX=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],sO=te("calendar",EX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AX=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Vc=te("check",AX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jX=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],CX=te("chevron-down",jX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RX=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],h1=te("chevron-right",RX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Db=te("circle-alert",IX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],MX=te("circle-arrow-up",OX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],LX=te("circle-check",DX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],VX=te("circle",PX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FX=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Lb=te("clock",FX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BX=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],UX=te("coffee",BX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $X=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],hh=te("coins",$X);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GX=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],qi=te("crown",GX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],zX=te("disc",HX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qX=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],KX=te("eye-off",qX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WX=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],YX=te("eye",WX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XX=[["path",{d:"M12.67 19a2 2 0 0 0 1.416-.588l6.154-6.172a6 6 0 0 0-8.49-8.49L5.586 9.914A2 2 0 0 0 5 11.328V18a1 1 0 0 0 1 1z",key:"18jl4k"}],["path",{d:"M16 8 2 22",key:"vp34q"}],["path",{d:"M17.5 15H9",key:"1oz8nu"}]],QX=te("feather",XX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JX=[["path",{d:"M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z",key:"15baut"}],["path",{d:"M18 12v.5",key:"18hhni"}],["path",{d:"M16 17.93a9.77 9.77 0 0 1 0-11.86",key:"16dt7o"}],["path",{d:"M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33",key:"l9di03"}],["path",{d:"M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4",key:"1kjonw"}],["path",{d:"m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98",key:"1zlm23"}]],ZX=te("fish",JX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],tQ=te("flame",eQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]],nQ=te("footprints",sQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]],rQ=te("gavel",iQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=[["path",{d:"M10.5 3 8 9l4 13 4-13-2.5-6",key:"b3dvk1"}],["path",{d:"M17 3a2 2 0 0 1 1.6.8l3 4a2 2 0 0 1 .013 2.382l-7.99 10.986a2 2 0 0 1-3.247 0l-7.99-10.986A2 2 0 0 1 2.4 7.8l2.998-3.997A2 2 0 0 1 7 3z",key:"7w4byz"}],["path",{d:"M2 9h20",key:"16fsjt"}]],oQ=te("gem",aQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=[["path",{d:"M9 10h.01",key:"qbtxuw"}],["path",{d:"M15 10h.01",key:"1qmjsl"}],["path",{d:"M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z",key:"uwwb07"}]],cQ=te("ghost",lQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],nO=te("gift",uQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dQ=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],hQ=te("globe",dQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fQ=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9",key:"1hayfq"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"15ts47"}]],To=te("hammer",fQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mQ=[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]],f1=te("handshake",mQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pQ=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],gQ=te("heart",pQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xQ=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],m1=te("history",xQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bQ=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],iO=te("info",bQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vQ=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],rO=te("layout-grid",vQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yQ=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],_Q=te("leaf",yQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wQ=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],uT=te("loader-circle",wQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kQ=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Bo=te("lock",kQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NQ=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],SQ=te("log-out",NQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TQ=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],EQ=te("mail",TQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AQ=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],p1=te("map-pin",AQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jQ=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],g1=te("map",jQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CQ=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],RQ=te("menu",CQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IQ=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],vd=te("message-square",IQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OQ=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],MQ=te("music",OQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DQ=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],aO=te("navigation",DQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LQ=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],oO=te("package",LQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PQ=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],VQ=te("palette",PQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FQ=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Pb=te("pause",FQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BQ=[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3L11 9.999",key:"1lw9ds"}],["path",{d:"M15.973 4.027A13 13 0 0 0 5.902 2.373c-1.398.342-1.092 2.158.277 2.601a19.9 19.9 0 0 1 5.822 3.024",key:"ffj4ej"}],["path",{d:"M16.001 11.999a19.9 19.9 0 0 1 3.024 5.824c.444 1.369 2.26 1.676 2.603.278A13 13 0 0 0 20 8.069",key:"8tj4zw"}],["path",{d:"M18.352 3.352a1.205 1.205 0 0 0-1.704 0l-5.296 5.296a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l5.296-5.296a1.205 1.205 0 0 0 0-1.704z",key:"hh6h97"}]],UQ=te("pickaxe",BQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Q=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],yd=te("play",$Q);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GQ=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],x1=te("scale",GQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HQ=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],zQ=te("scroll-text",HQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qQ=[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],lO=te("scroll",qQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KQ=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],WQ=te("search",KQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YQ=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],cO=te("send",YQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XQ=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],QQ=te("server",XQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JQ=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ZQ=te("settings",JQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eJ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],b1=te("shield-alert",eJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tJ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Vb=te("shield-check",tJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sJ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],a0=te("shield",sJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nJ=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],iJ=te("skip-back",nJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rJ=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],aJ=te("skip-forward",rJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oJ=[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]],uO=te("skull",oJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lJ=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],cJ=te("snowflake",lJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uJ=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Ki=te("sparkles",uJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dJ=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],hJ=te("star",dJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fJ=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],dO=te("sun",fJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mJ=[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]],Hm=te("sword",mJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pJ=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],zm=te("trending-up",pJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gJ=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],oc=te("triangle-alert",gJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xJ=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],lc=te("trophy",xJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bJ=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],vJ=te("truck",bJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yJ=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],wn=te("user",yJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _J=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],o0=te("users",_J);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wJ=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],hO=te("utensils",wJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],NJ=te("volume-2",kJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SJ=[["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}],["path",{d:"M5 7c0-1.1.9-2 2-2h10a2 2 0 0 1 2 2v12H5V7Z",key:"1ezoue"}],["path",{d:"M22 19H2",key:"nuriw5"}]],TJ=te("vote",SJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EJ=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],AJ=te("wallet",EJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jJ=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],CJ=te("wand-sparkles",jJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],fO=te("wind",RJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IJ=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],In=te("x",IJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OJ=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],cc=te("zap",OJ),MJ=({onAuth:t,adminPassword:e})=>{const[s,n]=S.useState(""),[i,r]=S.useState(!1),a=l=>{l&&l.preventDefault(),s===e?(t(),sessionStorage.setItem("admin_session","active"),r(!1)):(r(!0),n(""),navigator.vibrate&&navigator.vibrate(50))};return o.jsxs("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-[100] overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,rgba(99,102,241,0.08)_0%,transparent_70%)]"}),o.jsx(Z.div,{animate:{scale:[1,1.1,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"easeInOut"},className:"absolute top-[-20%] left-[-10%] w-[60%] h-[60%] bg-indigo-600/10 blur-[150px] rounded-full"})]}),o.jsxs(Z.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},className:"w-full max-w-md p-8 relative",children:[o.jsxs("div",{className:"text-center mb-10",children:[o.jsx(Z.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:12,stiffness:200,delay:.2},className:"w-20 h-20 bg-indigo-500/10 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-indigo-500/20 backdrop-blur-xl",children:o.jsx(Bo,{className:"w-10 h-10 text-indigo-400"})}),o.jsx("h2",{className:"text-3xl font-black text-white tracking-tight mb-2",children:"Begrenset tilgang"}),o.jsx("p",{className:"text-slate-400 font-medium",children:"Vennligst oppgi passord for  fortsette"})]}),o.jsxs("form",{onSubmit:a,className:"space-y-4",children:[o.jsxs("div",{className:"relative group",children:[o.jsx(Z.div,{animate:i?{x:[-10,10,-10,10,0]}:{},transition:{duration:.4},children:o.jsx("input",{autoFocus:!0,type:"password",value:s,onChange:l=>{n(l.target.value),i&&r(!1)},placeholder:"Passord...",className:`w-full bg-slate-900/50 border-2 ${i?"border-red-500/50 focus:border-red-500":"border-slate-800 focus:border-indigo-500"} rounded-2xl px-6 py-4 text-white text-lg font-medium outline-none transition-all duration-300 backdrop-blur-md placeholder:text-slate-600`})}),o.jsx(Dt,{children:i&&o.jsx(Z.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-red-400 text-sm font-bold mt-2 ml-2",children:"Ugyldig passord. Prv igjen."})})]}),o.jsx("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl transition-all duration-300 shadow-lg shadow-indigo-600/20 active:scale-[0.98]",children:"Ls opp panel"})]}),o.jsx("div",{className:"mt-12 text-center",children:o.jsx("button",{onClick:()=>{xt(()=>Promise.resolve().then(()=>So),void 0).then(l=>l.audioManager.playSfx("click")),window.location.href="/"},className:"text-slate-500 hover:text-slate-300 text-sm font-bold transition-colors",children:"Tilbake til forsiden"})})]})]})},DJ=({allRooms:t,isLoading:e,onCreateRoom:s,onDeleteRoom:n,onManageRoom:i,onCleanupMetadata:r,archivingStatus:a})=>o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 p-12 overflow-y-auto custom-scrollbar font-sans z-20",children:[a&&o.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-950/80 backdrop-blur-xl flex items-center justify-center p-6 text-center animate-in fade-in duration-300",children:o.jsxs("div",{className:"max-w-md bg-slate-900 border-2 border-indigo-500/30 rounded-[3rem] p-12 space-y-8 shadow-2xl scale-in-center",children:[o.jsx("div",{className:"w-20 h-20 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h2",{className:"text-3xl font-black italic text-white uppercase tracking-tighter",children:"Sikker Arkivering"}),o.jsx("p",{className:"text-indigo-400 font-bold uppercase tracking-widest text-xs animate-pulse",children:a})]}),o.jsx("p",{className:"text-slate-500 text-sm",children:"Ikke lukk vinduet mens vi sikrer karakterens ettermle..."})]})}),o.jsxs("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:[o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full"}),o.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-600/10 blur-[120px] rounded-full"})]}),o.jsxs("div",{className:"max-w-5xl mx-auto relative z-10",children:[o.jsxs("div",{className:"flex justify-between items-center mb-12",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-5xl font-black text-white px-2 tracking-tighter",children:"Simuleringshallen"}),o.jsx("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-[10px] mt-2 px-2",children:"Sentralt kontrollpanel for administratoren"})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:r,disabled:e,className:"bg-slate-800 hover:bg-rose-500/20 text-slate-400 hover:text-rose-400 border border-slate-700 hover:border-rose-500/50 px-6 py-5 rounded-2xl font-black text-xs uppercase tracking-widest transition-all",children:" Vask Serverlisten"}),o.jsx("button",{onClick:s,disabled:e,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-10 py-5 rounded-2xl font-black text-lg shadow-2xl shadow-indigo-600/30 transition-all hover:scale-105 active:scale-95",children:"+ Opprett Nytt Rike"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(l=>{var c,u;return o.jsxs("div",{className:"bg-slate-900/50 backdrop-blur-xl border border-white/5 p-8 rounded-[2.5rem] group hover:border-indigo-500/50 transition-all shadow-xl flex flex-col justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsx("h2",{className:"text-2xl font-black text-white group-hover:text-indigo-400 transition-colors truncate pr-4",title:l.name||`Rike #${l.pin}`,children:l.name||`Rike #${l.pin}`}),o.jsx("span",{className:`px-2 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest ${l.status==="PLAYING"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"} shrink-0`,children:typeof l.status=="string"?l.status:"KORRUPT"})]}),o.jsxs("div",{className:"text-[10px] font-mono text-slate-600 mb-6 uppercase tracking-widest",children:["PIN: ",o.jsx("span",{className:"text-slate-400 font-bold",children:l.pin})]}),o.jsxs("div",{className:"space-y-4 mb-8",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm font-bold text-slate-500",children:[o.jsx("span",{children:"Innbyggere:"}),o.jsxs("span",{className:"text-white",children:[Object.keys(l.players||{}).length," sjeler"]})]}),o.jsxs("div",{className:"flex items-center justify-between text-sm font-bold text-slate-500",children:[o.jsx("span",{children:"rstid:"}),o.jsx("span",{className:"text-indigo-300",children:_t[(c=l.world)==null?void 0:c.season]||((u=l.world)==null?void 0:u.season)||"Ukjent"})]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>i(l.pin),className:"flex-1 bg-white/5 hover:bg-white/10 text-white py-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all border border-white/5",children:"Administrer "}),o.jsx("button",{onClick:()=>n(l.pin),className:"bg-rose-500/10 hover:bg-rose-500/20 text-rose-500 w-16 rounded-2xl flex items-center justify-center border border-rose-500/20 transition-all hover:scale-105 active:scale-95",title:"Slett rom",children:""})]})]},l.pin)})})]})]}),LJ=Ne.memo(({pin:t,roomData:e,isLoading:s,onBack:n,onStartGame:i,onTogglePublic:r,onRepairData:a,onResetGame:l,onNextSeason:c,onChangeWeather:u,onTaxationBase:d,onRegenStamina:h,onResetUnrest:f,onKickAll:m,onSpawnEvent:b,onStartTing:p,onSpawnCharacter:v,initializeSettlement:x,onExportLog:g})=>{var N,_,T,E,A;const[y,w]=S.useState({name:"",role:"PEASANT",level:1}),k=()=>{if(!y.name){alert("Vennligst oppgi et navn.");return}v(y),w({name:"",role:"PEASANT",level:1})};return o.jsxs("aside",{className:"w-80 border-r border-white/10 bg-slate-900/50 backdrop-blur-xl flex flex-col z-20 shadow-2xl overflow-y-auto no-scrollbar",children:[o.jsxs("div",{className:"p-8 border-b border-white/5 bg-black/20",children:[o.jsx("button",{onClick:()=>{xt(()=>Promise.resolve().then(()=>So),void 0).then(R=>R.audioManager.playSfx("click")),n()},className:"text-indigo-400 font-black text-[10px] uppercase tracking-widest mb-4 hover:text-white transition-colors flex items-center gap-2",children:" Tilbake til oversikt"}),o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h1",{className:"text-4xl font-mono font-black text-white",children:t}),o.jsx("span",{className:"text-[10px] font-black uppercase text-indigo-500 tracking-widest bg-indigo-500/10 px-3 py-1 rounded-full",children:"Admin"})]}),o.jsxs("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-6",children:[typeof e.status=="string"?e.status:"FEIL: DATA KORRUPT"," MODUS"]}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsx("button",{onClick:i,disabled:e.status==="PLAYING"||s,className:`w-full py-4 rounded-xl font-black uppercase tracking-widest text-sm transition-all shadow-lg ${e.status==="PLAYING"?"bg-emerald-600/20 text-emerald-400 cursor-default":"bg-emerald-600 hover:bg-emerald-500 text-white shadow-emerald-600/20"}`,children:e.status==="PLAYING"?" SPILL AKTIVT":" START SPILL"}),o.jsxs("button",{onClick:r,disabled:s,className:`w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all border flex items-center justify-center gap-2 ${e.isPublic?"bg-indigo-600/10 text-indigo-400 border-indigo-500/20 hover:bg-indigo-600 hover:text-white":"bg-slate-800 text-slate-500 border-white/5 hover:border-indigo-500/20"}`,children:[e.isPublic?o.jsx(hQ,{size:14}):o.jsx(Bo,{size:14}),e.isPublic?"OFFENTLIG SERVER":"PRIVAT (KUN PIN)"]}),o.jsx("button",{onClick:a,disabled:s,className:"w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] bg-amber-600/10 text-amber-500 hover:bg-amber-600 hover:text-white transition-all border border-amber-500/20",children:" REPARER DATA"}),o.jsx("button",{onClick:l,disabled:s,className:"w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] bg-rose-600/10 text-rose-500 hover:bg-rose-600 hover:text-white transition-all border border-rose-500/20",children:" NULLSTILL ALT"})]})]}),o.jsxs("div",{className:"p-8 space-y-8 flex-1 overflow-y-auto custom-scrollbar",children:[o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Verdensstyring"}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5 group",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-400 italic",children:["rstid: ",((_=En[(N=e.world)==null?void 0:N.season])==null?void 0:_.label)||"Ukjent"]}),o.jsx("span",{className:"text-2xl group-hover:rotate-12 transition-transform",children:{Spring:"",Summer:"",Autumn:"",Winter:""}[((T=e.world)==null?void 0:T.season)||"Spring"]})]}),o.jsx("button",{onClick:c,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-black uppercase text-[10px] transition-all",children:"Neste rstid"})]}),o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5 group",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-400 italic",children:["Vr: ",((E=e.world)==null?void 0:E.weather)||"Klart"]}),o.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:""})]}),o.jsx("button",{onClick:u,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-black uppercase text-[10px] transition-all",children:"Endre Vr"})]})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Massehandlinger"}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsx("button",{onClick:d,className:"w-full bg-amber-600/10 hover:bg-amber-600 text-amber-500 hover:text-white border border-amber-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2",children:" Skattlegg Riket"}),o.jsx("button",{onClick:h,className:"w-full bg-blue-600/10 hover:bg-blue-600 text-blue-500 hover:text-white border border-blue-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center",children:" Gjenopprett Stamina"}),o.jsx("button",{onClick:f,className:"w-full bg-indigo-600/10 hover:bg-indigo-600 text-indigo-500 hover:text-white border border-indigo-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center",children:" Nullstill Politisk Uro"}),o.jsx("button",{onClick:m,className:"w-full bg-rose-600/10 hover:bg-rose-600 text-rose-500 hover:text-white border border-rose-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center mt-2",children:" Kast ut alle"})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Dataanalyse"}),o.jsx("div",{className:"grid grid-cols-1 gap-3",children:o.jsx("button",{onClick:g,disabled:s,className:"w-full bg-indigo-500 hover:bg-indigo-400 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-indigo-600/20 transition-all active:scale-95 flex items-center justify-center gap-2",children:" EKSPORTER FULL LOGG"})})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4 text-center",children:"Intervensjoner"}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:b,className:"bg-rose-600/80 hover:bg-rose-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-rose-600/20 transition-all active:scale-95",children:" Event"}),o.jsx("button",{onClick:p,disabled:!!e.activeVote,className:"bg-amber-600/80 hover:bg-amber-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-amber-600/20 disabled:opacity-20 text-center transition-all active:scale-95",children:" Tinget"})]}),o.jsxs("section",{className:"bg-white/5 border border-white/5 rounded-[2.5rem] p-6 space-y-4 shadow-inner",children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-[0.2em] mb-2 px-2",children:"Legg til Karakter"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("input",{type:"text",placeholder:"Navn...",value:y.name,onChange:R=>w({...y,name:R.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-xs font-bold text-white placeholder:text-slate-600 focus:border-indigo-500/50 focus:ring-0 transition-all"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("select",{value:y.role,onChange:R=>w({...y,role:R.target.value}),className:"bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black uppercase text-slate-400 focus:ring-0",children:Object.keys(fd).map(R=>o.jsx("option",{value:R,children:R},R))}),o.jsxs("div",{className:"flex items-center gap-2 bg-black/40 border border-white/5 rounded-xl px-3 py-2",children:[o.jsx("span",{className:"text-[8px] font-black text-slate-600",children:"LVL"}),o.jsx("input",{type:"number",value:y.level,onChange:R=>w({...y,level:parseInt(R.target.value)}),className:"w-full bg-transparent border-none p-0 text-xs font-black text-white focus:ring-0 font-mono"})]})]}),o.jsx("button",{onClick:k,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl font-black uppercase text-[10px] shadow-lg shadow-indigo-600/20 transition-all active:scale-95",children:" SKAP KARAKTER"})]})]})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Landsby-fokus"}),(A=e.world)!=null&&A.settlement?o.jsx("div",{className:"text-xs text-slate-500 italic",children:"Landsbyen er initialisert."}):o.jsx("button",{onClick:x,className:"w-full bg-amber-500 text-black py-4 rounded-2xl font-black uppercase text-[10px] animate-pulse",children:"Initialiser Landsby"})]})]})]})}),PJ=Ne.memo(({players:t,onKick:e,onLevelChange:s,onRoleChange:n,onRegionChange:i,onControl:r,onGiveGold:a,onGiveResource:l,onGiveItem:c})=>{const[u,d]=S.useState({}),[h,f]=S.useState({}),[m,b]=S.useState({});return o.jsxs("section",{children:[o.jsx("h2",{className:"text-3xl font-black text-white px-2 mb-8 tracking-tighter",children:"Innbyggere i Riket"}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[Object.values(t||{}).map(p=>{var v,x,g,y,w,k,N;return o.jsxs("div",{className:"relative bg-slate-900/80 border border-white/5 p-6 rounded-[2rem] hover:border-indigo-500/30 transition-all group",children:[o.jsx("button",{onClick:_=>{_.stopPropagation(),e(p.id,p.name)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-rose-500/10 text-rose-500 opacity-0 group-hover:opacity-100 transition-all hover:bg-rose-500 hover:text-white flex items-center justify-center font-bold text-xs",title:"Kast ut spiller",children:""}),o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-indigo-600/20 rounded-xl flex items-center justify-center text-2xl shrink-0 group-hover:scale-110 transition-transform overflow-hidden",children:p.avatar?o.jsx("img",{src:p.avatar,alt:p.role,className:"w-full h-full object-cover"}):{KING:"",BARON:"",PEASANT:"",SOLDIER:"",MERCHANT:""}[p.role]||""}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("h3",{className:"text-lg font-black text-white truncate leading-tight",children:p.name}),o.jsxs("div",{className:"flex items-center gap-1 bg-white/5 px-2 py-0.5 rounded-lg border border-white/5",children:[o.jsx("span",{className:"text-[8px] font-black text-slate-500 uppercase",children:"LVL"}),o.jsx("input",{type:"number",value:((v=p.stats)==null?void 0:v.level)||1,onChange:_=>s(p.id,parseInt(_.target.value)),className:"w-8 bg-transparent border-none p-0 text-[10px] font-black text-indigo-400 focus:ring-0 text-center font-mono"})]})]}),o.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[o.jsx("select",{value:p.role,onChange:_=>n(p.id,_.target.value),className:"bg-indigo-500/10 text-indigo-400 text-[10px] font-black uppercase tracking-widest border-none p-0 focus:ring-0 cursor-pointer hover:text-white transition-colors w-full text-left",children:Object.entries(fd).map(([_,T])=>o.jsx("option",{value:_,className:"bg-slate-900",children:T.label},_))}),o.jsxs("select",{value:p.regionId||"region_ost",onChange:_=>i(p.id,_.target.value),className:"bg-white/5 text-slate-500 text-[9px] font-bold uppercase tracking-wider border-none p-0 focus:ring-0 cursor-pointer hover:text-slate-300 transition-colors w-full text-left",children:[o.jsx("option",{value:"capital",className:"bg-slate-900",children:"Hovedstaden"}),o.jsx("option",{value:"region_ost",className:"bg-slate-900",children:"Baroniet st"}),o.jsx("option",{value:"region_vest",className:"bg-slate-900",children:"Baroniet Vest"})]})]})]})]}),p.id.startsWith("bot_")&&((x=p.status)==null?void 0:x.thought)&&o.jsxs("div",{className:"mb-4 p-3 bg-indigo-500/10 rounded-xl border border-indigo-500/20",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:"Mental Tilstand"}),o.jsx("div",{className:"flex-1 h-[1px] bg-indigo-500/20"})]}),o.jsxs("p",{className:"text-[10px] text-white/90 font-bold leading-relaxed mb-2",children:['"',p.status.thought,'"']}),o.jsxs("div",{className:"flex justify-between items-center text-[8px] font-black uppercase tracking-tighter text-indigo-400/60",children:[o.jsxs("span",{children:["Handling: ",p.status.lastAction]}),o.jsxs("span",{children:["Tid: ",p.status.lastTick?new Date(p.status.lastTick).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N"]})]})]}),o.jsxs("div",{className:"space-y-3 mb-6",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-[8px] font-black uppercase text-slate-500 mb-1",children:[o.jsx("span",{children:"Stamina"}),o.jsxs("span",{className:"text-white",children:[p.status.stamina,"%"]})]}),o.jsx("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${p.status.stamina}%`}})})]}),o.jsxs("div",{className:"flex justify-between items-center text-xs font-bold",children:[o.jsx("span",{className:"text-slate-500",children:"Gull:"}),o.jsxs("span",{className:"text-amber-500 font-black",children:[p.resources.gold,""]})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-1 mb-6",children:[(g=p.upgrades)==null?void 0:g.map(_=>o.jsx("span",{className:"text-[7px] font-black bg-indigo-500/10 text-indigo-400 px-1.5 py-0.5 rounded border border-indigo-500/20 uppercase tracking-tighter",children:_},_)),(!p.upgrades||p.upgrades.length===0)&&o.jsx("span",{className:"text-[7px] font-bold text-slate-700 uppercase italic",children:"Ingen oppgraderinger"})]}),o.jsxs("button",{onClick:()=>r(p.id),className:"w-full py-4 rounded-2xl bg-indigo-600/10 hover:bg-indigo-600 text-indigo-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-all border border-indigo-500/20 flex items-center justify-center gap-2 group/btn",children:[o.jsx("span",{className:"group-hover/btn:scale-125 transition-transform",children:""}),"Styr spiller"]}),o.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-col gap-2",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"number",placeholder:"Gull...",value:u[p.id]||"",onChange:_=>d({...u,[p.id]:parseInt(_.target.value)||0}),className:"flex-1 bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black text-white focus:border-indigo-500/50 transition-all font-mono"}),o.jsx("button",{onClick:()=>{const _=u[p.id]||0;_>0&&(a(p.id,_),d({...u,[p.id]:0}))},className:"bg-emerald-600/20 hover:bg-emerald-600 text-emerald-400 hover:text-white border border-emerald-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI GULL"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("select",{value:((y=m[p.id])==null?void 0:y.resourceId)||"",onChange:_=>{var T;return b({...m,[p.id]:{resourceId:_.target.value,amount:((T=m[p.id])==null?void 0:T.amount)||10}})},className:"flex-[2] bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-bold text-amber-300 focus:border-amber-500/50 transition-all cursor-pointer",children:[o.jsx("option",{value:"",children:"Velg ressurs..."}),o.jsx("optgroup",{label:"BASISVARER",className:"bg-slate-900 text-slate-500",children:["gold","grain","wood","stone","iron_ore","honey","meat","wool","egg"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=ze[_])==null?void 0:T.icon," ",(E=ze[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"FOREDLET",className:"bg-slate-900 text-slate-500",children:["flour","bread","plank","iron_ingot","cloth","glass","omelette"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=ze[_])==null?void 0:T.icon," ",(E=ze[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"MARITIMT",className:"bg-slate-900 text-slate-500",children:["flax","linen_canvas","tar","fish_raw","fish_cooked","silk","spice","cannonball"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=ze[_])==null?void 0:T.icon," ",(E=ze[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"KRIG",className:"bg-slate-900 text-slate-500",children:["siege_sword","siege_armor"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=ze[_])==null?void 0:T.icon," ",(E=ze[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"APOTEKER",className:"bg-slate-900 text-slate-500",children:["minor_stamina_potion","herbal_balm","focus_brew","strength_tincture","masters_draught","elixir_of_life"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=ze[_])==null?void 0:T.icon," ",(E=ze[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"ANNET",className:"bg-slate-900 text-slate-500",children:o.jsx("option",{value:"favor",className:"text-white",children:" Gunst"})})]}),o.jsx("input",{type:"number",placeholder:"#",value:((w=m[p.id])==null?void 0:w.amount)||10,onChange:_=>{var T;return b({...m,[p.id]:{resourceId:((T=m[p.id])==null?void 0:T.resourceId)||"",amount:parseInt(_.target.value)||1}})},className:"w-12 bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-black text-white focus:border-amber-500/50 transition-all font-mono text-center"}),o.jsx("button",{onClick:()=>{const _=m[p.id];_&&_.resourceId&&_.amount>0&&(l(p.id,_.resourceId,_.amount),b({...m,[p.id]:{resourceId:"",amount:10}}))},className:"bg-amber-600/20 hover:bg-amber-600 text-amber-400 hover:text-white border border-amber-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("select",{value:((k=h[p.id])==null?void 0:k.itemId)||"",onChange:_=>{var T;return f({...h,[p.id]:{itemId:_.target.value,amount:((T=h[p.id])==null?void 0:T.amount)||1}})},className:"flex-[2] bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-bold text-slate-300 focus:border-indigo-500/50 transition-all cursor-pointer",children:[o.jsx("option",{value:"",children:"Velg..."}),Object.values(Ke).map(_=>o.jsxs("option",{value:_.id,children:[_.icon," ",_.name]},_.id))]}),o.jsx("input",{type:"number",placeholder:"#",value:((N=h[p.id])==null?void 0:N.amount)||1,onChange:_=>{var T;return f({...h,[p.id]:{itemId:((T=h[p.id])==null?void 0:T.itemId)||"",amount:parseInt(_.target.value)||1}})},className:"w-12 bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-black text-white focus:border-indigo-500/50 transition-all font-mono text-center"}),o.jsx("button",{onClick:()=>{const _=h[p.id];_&&_.itemId&&_.amount>0&&(c(p.id,_.itemId,_.amount),f({...h,[p.id]:{itemId:"",amount:1}}))},className:"bg-indigo-600/20 hover:bg-indigo-600 text-indigo-400 hover:text-white border border-indigo-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI"})]})]})]},p.id)}),Object.keys(t||{}).length===0&&o.jsxs("div",{className:"col-span-full py-20 text-center border-2 border-dashed border-white/5 rounded-[3rem]",children:[o.jsx("span",{className:"text-6xl block mb-4 opacity-20",children:""}),o.jsx("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-xs",children:"Venter p at understter skal ankomme..."})]})]})]})}),VJ=Ne.memo(({roomData:t})=>{const e=s=>s?Array.isArray(s)?s:Object.values(s).sort((n,i)=>n.timestamp-i.timestamp):[];return o.jsxs("aside",{className:"w-80 border-l border-white/10 bg-slate-900/50 backdrop-blur-xl flex flex-col z-20 shadow-2xl overflow-hidden",children:[o.jsxs("div",{className:"p-8 border-b border-white/5 bg-black/20 shrink-0",children:[o.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-amber-500 mb-6 flex items-center justify-between",children:["Rikets Formue",o.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(245,158,11,0.5)]"})]}),o.jsxs("div",{className:"space-y-4",children:[Object.values(t.players||{}).sort((s,n)=>(n.resources.gold||0)-(s.resources.gold||0)).slice(0,5).map((s,n)=>o.jsxs("div",{className:"flex justify-between items-center group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("span",{className:"text-xs font-black text-slate-600 font-mono",children:["#",n+1]}),o.jsx("span",{className:"text-sm font-bold text-white group-hover:translate-x-1 transition-transform",children:s.name})]}),o.jsxs("span",{className:"text-sm font-black text-amber-400",children:[s.resources.gold,""]})]},s.id)),Object.keys(t.players||{}).length===0&&o.jsx("p",{className:"text-[10px] text-slate-600 font-bold italic text-center py-4",children:"Ingen data tilgjengelig..."})]})]}),o.jsxs("div",{className:"p-8 border-b border-white/5 shrink-0",children:[o.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-indigo-400 mb-6",children:"Markedsanalyse"}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Object.entries(t.market||{}).slice(0,4).map(([s,n])=>{const i=ze[s]||{label:s};return o.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[o.jsx("div",{className:"text-[8px] font-black uppercase text-slate-500 mb-1",children:i.label}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs font-black text-white",children:n.stock}),o.jsxs("span",{className:"text-[10px] font-mono text-emerald-400",children:[n.price.toFixed(1),"g"]})]})]},s)}),Object.entries(t.market||{}).slice(0,4).length===0&&o.jsx("div",{className:"col-span-2 text-[10px] text-slate-600 font-bold italic text-center py-4",children:"Ingen markedsdata..."})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[o.jsx("div",{className:"p-8 pb-4 shrink-0",children:o.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-rose-500 flex items-center gap-2",children:[o.jsx("span",{className:"w-2 h-2 bg-rose-600 rounded-full animate-pulse shadow-[0_0_10px_rgba(225,29,72,0.5)]"}),"Global Logg"]})}),o.jsxs("div",{className:"flex-1 overflow-y-auto px-6 space-y-3 pb-8 custom-scrollbar",children:[o.jsx(Dt,{initial:!1,children:e(t.messages).slice().reverse().map((s,n)=>{const i=typeof s=="object"&&s.id||n;return o.jsx(Z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"bg-indigo-950/20 border-l-2 border-indigo-500/50 p-4 rounded-r-2xl",children:o.jsx("p",{className:"text-[10px] font-medium leading-relaxed text-slate-400 antialiased italic font-serif opacity-80",children:typeof s=="object"?s.text||JSON.stringify(s):s})},i)})}),e(t.messages).length===0&&o.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-20 py-20",children:[o.jsx("span",{className:"text-4xl mb-4",children:""}),o.jsx("p",{className:"text-[8px] font-black uppercase tracking-[0.2em]",children:"Arkivet er tomt"})]})]})]})]})});class FJ{constructor(e){Ie(this,"genome");this.genome=e}decide(e,s){var c;const n=[],i=e.status.stamina,r=(1-i/100)*this.genome.weights.hungerThreshold*5;e.resources.bread>0&&i<80&&n.push({action:{type:"EAT"},score:r,reason:"Sulten"}),i<50&&n.push({action:{type:"SLEEP"},score:(1-i/100)*this.genome.weights.restFocus*3,reason:"Trtt"}),n.push({action:{type:"CHOP"},score:this.genome.weights.gatherWood*this.getNeedMultiplier(e,"wood"),reason:"Trengte ved"}),n.push({action:{type:"QUARRY"},score:this.genome.weights.gatherStone*this.getNeedMultiplier(e,"stone"),reason:"Trengte stein"}),n.push({action:{type:"MINE"},score:this.genome.weights.gatherIron*this.getNeedMultiplier(e,"iron_ore"),reason:"Trengte jernmalm"}),n.push({action:{type:"WORK"},score:this.genome.weights.gatherGrain*this.getNeedMultiplier(e,"grain"),reason:"Trengte korn"});const a=((c=s.markets)==null?void 0:c[e.regionId])||s.market;a&&Object.entries(e.resources).forEach(([u,d])=>{if(u==="gold")return;const h=a[u];if(h&&d>10){const f=h.price;n.push({action:{type:"SELL",itemId:u,amount:Math.floor(d/2)},score:this.genome.weights.marketAggression*(f/20)*(d/50),reason:`Selger ${u} for gull`})}}),e.resources.gold>200&&n.push({action:{type:"CONTRIBUTE_TO_UPGRADE",buildingId:"great_hall"},score:this.genome.weights.promotionFocus*(e.resources.gold/1e3),reason:"Vil bli mektigere"});const l=n.filter(u=>{const d=typeof u.action=="string"?u.action:u.action.type,h=Mc[d];if(!h)return!0;if(i<(h.stamina||0))return!1;for(const[f,m]of Object.entries(h))if(f!=="stamina"&&(e.resources[f]||0)<m)return!1;return!0});return l.length===0?{action:"IDLE",score:0,reason:"Ingenting  gjre"}:(l.sort((u,d)=>d.score-u.score),l[0])}getNeedMultiplier(e,s){const n=e.resources[s]||0;return n<5?2:n<20?1.2:n>100?.5:1}}const BJ=(t=0)=>({id:`genome_${Date.now()}_${Math.floor(Math.random()*1e3)}`,generation:t,weights:{gatherWood:Math.random()*2,gatherStone:Math.random()*2,gatherIron:Math.random()*2,gatherGrain:Math.random()*2,marketAggression:Math.random()*2,savingsFocus:Math.random()*2,upgradeFocus:Math.random()*2,hungerThreshold:.2+Math.random()*.6,restFocus:Math.random()*2,promotionFocus:Math.random()*2,contributionFocus:Math.random()*2}}),UJ=(t,e=.1)=>{const s={...t.weights};return Object.keys(s).forEach(n=>{if(Math.random()<.2){const i=(Math.random()*2-1)*e;s[n]=Math.max(0,Math.min(2,s[n]+i))}}),{...t,id:`genome_${Date.now()}_${Math.floor(Math.random()*1e3)}`,weights:s,generation:t.generation+1,parents:[t.id],fitness:void 0}},dT="eiriksbok_ai_top_genomes";class Fb{static calculateFitness(e,s){const n=(e.resources.gold||0)+Object.values(e.resources).reduce((l,c)=>l+(typeof c=="number"?c:0),0)*.5,r={PEASANT:1,SOLDIER:5,MERCHANT:10,BARON:50,KING:200}[e.role]||1,a=Math.max(1,(Date.now()-s)/6e4);return(n+r*100)/a}static saveTopGenomes(e){const s=[...e].filter(n=>n.fitness!==void 0).sort((n,i)=>(i.fitness||0)-(n.fitness||0)).slice(0,3);localStorage.setItem(dT,JSON.stringify(s))}static getTopGenomes(){const e=localStorage.getItem(dT);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}static getNextGenerationGenome(){const e=this.getTopGenomes();if(e.length===0)return BJ(0);const s=e[Math.floor(Math.random()*e.length)];return UJ(s)}}const mO={CHOP:["AXE","OFF_HAND"],MINE:["PICKAXE","OFF_HAND"],QUARRY:["CHISEL","OFF_HAND"],WORK:["SCYTHE","OFF_HAND"],RAID:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],DEFEND:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],PATROL:["MAIN_HAND","OFF_HAND","BODY"],EXPLORE:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],CRAFT:["MAIN_HAND","AXE","PICKAXE","SCYTHE","HAMMER"],HUNT:["MAIN_HAND","BOW","TRAP"],FORAGE:["MAIN_HAND","TRAP"],GATHER_WOOL:["MAIN_HAND","OFF_HAND"],SAWMILL:["MAIN_HAND","OFF_HAND"],PLANT:["MAIN_HAND","OFF_HAND"],HARVEST:["SCYTHE","OFF_HAND","MAIN_HAND"]},Bb=(t,e)=>{const s=mO[e];return!s||!t.equipment?[]:s.map(n=>{var i;return(i=t.equipment)==null?void 0:i[n]}).filter(n=>{var i,r;if(!n)return!1;if((i=n.relevantActions)!=null&&i.includes(e))return!0;if(!n.relevantActions){const a=n.id.split("_").slice(0,2).join("_"),l=Ke[n.id]||Ke[a]||Object.values(Ke).find(c=>n.id.startsWith(c.id));return(r=l==null?void 0:l.relevantActions)!=null&&r.includes(e)?!0:!l||!l.relevantActions}return!1})},Fc=(t,e)=>{const s=mO[e];return!s||!t.equipment?[]:s.filter(n=>{var r,a,l;const i=(r=t.equipment)==null?void 0:r[n];if(!i)return!1;if((a=i.relevantActions)!=null&&a.includes(e))return!0;if(!i.relevantActions){const c=i.id.split("_").slice(0,2).join("_"),u=Ke[i.id]||Ke[c]||Object.values(Ke).find(d=>i.id.startsWith(d.id));return(l=u==null?void 0:u.relevantActions)!=null&&l.includes(e)?!0:!u||!u.relevantActions}return!1})},pO=(t,e,s="Spring",n="Clear",i=0)=>{var d;let r=typeof e=="string"?e:e.type,a=typeof e=="object"?{...e}:{};r.startsWith("REFINE_")&&!ya[r]?(a.recipeId=r.replace("REFINE_","").toLowerCase(),r="REFINE"):r.startsWith("CRAFT_")&&!An[r]?(a.subType=r.replace("CRAFT_","").toLowerCase(),r="CRAFT"):An[r]&&(a.subType=r,r="CRAFT");const l=Bb(t,r);for(const h of l)if(h.durability<=0)return{success:!1,reason:`delagt: ${h.name}`};if(r==="GATHER_WOOL"&&l.length===0)return{success:!1,reason:"Du mangler Saks"};let c={};const u=Mc[r];if(u&&(c={...u}),r==="REFINE"||r==="CRAFT"){let h;r==="REFINE"&&(h=ya[a.recipeId]),r==="CRAFT"&&(h=An[a.subType]),h&&(h.stamina!==void 0&&(c.stamina=h.stamina),h.input&&Object.entries(h.input).forEach(([f,m])=>{c[f]=(c[f]||0)+m}))}if(Object.keys(c).length>0){const h=En[s],f=Fi[n],m=(h==null?void 0:h.staminaMod)||1,b=(f==null?void 0:f.staminaMod)||1,p=_a(i)==="NIGHT",v=p?1.2:1,x=c.stamina||0;if(r==="SLEEP"&&!p)return{success:!1,reason:"Du kan bare sove nr det er natt"};if(r==="PLANT"&&s==="Winter")return{success:!1,reason:"Bakken er frossen - du kan ikke s om vinteren"};if(a.locationId==="farm_well"||a.locationId==="well_water"||r==="GATHER_WATER"){const k=a.locationId||(r==="GATHER_WATER"?"well_water":null);if(k){const N=(d=t.activeProcesses)==null?void 0:d.find(_=>_.type==="WELL"&&_.locationId===k);if(N&&N.readyAt>Date.now())return{success:!1,reason:"Brnnen fyller seg med vann..."}}}const y=Math.ceil(x*m*b*v);if((t.status.stamina||0)<y)return{success:!1,reason:`Du mangler ${Math.ceil(y-(t.status.stamina||0))} energi`};const w={bread:"brd",gold:"gull",wood:"tre",flour:"mel",grain:"korn",iron_ingot:"jernbarrer",plank:"planker",stone:"stein",meat:"kjtt",honey:"honning",wool:"ull",iron_ore:"jernmalm",cloth:"stoff",stamina:"energi"};for(const[k,N]of Object.entries(c)){if(k==="stamina")continue;const _=t.resources[k]||0;if(_<N){const T=w[k]||k;return{success:!1,reason:`Du mangler ${N-_} ${T}`}}}}return{success:!0}},gO=(t,e="Spring",s="Clear",n=0)=>{let i=typeof t=="string"?t:t.type,r=typeof t=="object"?{...t}:{};i.startsWith("REFINE_")&&!ya[i]?(r.recipeId=i.replace("REFINE_","").toLowerCase(),i="REFINE"):i.startsWith("CRAFT_")&&!An[i]?(r.subType=i.replace("CRAFT_","").toLowerCase(),i="CRAFT"):An[i]&&(r.subType=i,i="CRAFT");let a={};const l=Mc[i];if(l&&(a={...l}),i==="REFINE"||i==="CRAFT"){let d;i==="REFINE"&&(d=ya[r.recipeId]),i==="CRAFT"&&(d=An[r.subType]),d&&(d.stamina!==void 0&&(a.stamina=d.stamina),d.input&&Object.entries(d.input).forEach(([h,f])=>{a[h]=(a[h]||0)+f}))}if(Object.keys(a).length===0)return null;const c=[];if(a.stamina){const d=En[e],h=Fi[s],m=_a(n)==="NIGHT"?1.2:1,b=((d==null?void 0:d.staminaMod)||1)*((h==null?void 0:h.staminaMod)||1)*m,p=Math.ceil(a.stamina*b);let v="-";a.stamina<0&&(v="+"),c.push(`${v}${Math.abs(p)}`)}const u={bread:"",gold:"",wood:"",flour:"",grain:"",iron_ingot:"",plank:"",stone:"",meat:"",honey:"",wool:"",iron_ore:"",cloth:""};for(const[d,h]of Object.entries(a)){if(d==="stamina")continue;const f=h,m=u[d]||d;c.push(`-${f}${m}`)}return c.join(" ")},$J=(t,e,s)=>{t.activeProcesses||(t.activeProcesses=[]),t.activeProcesses.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,type:"COOLDOWN",locationId:e,itemId:"cooldown",notified:!1,startedAt:Date.now(),readyAt:Date.now()+s,duration:s})},GJ=t=>{const{actor:e,action:s,localResult:n}=t,i=s.processId;if(!e.activeProcesses)return n.success=!1,n.message="Ingen aktive prosesser.",!1;const r=e.activeProcesses.find(l=>l.id===i);if(!r)return n.success=!1,n.message="Fant ikke avlingen (kanskje den allerede er ferdig?).",!1;if(r.type!=="CROP")return n.success=!1,n.message="Kan bare vedlikeholde avlinger.",!1;if(r.maintainCount===void 0&&(r.maintainCount=0),r.yieldBonus===void 0&&(r.yieldBonus=0),r.maintainCount>=3)return n.success=!1,n.message="Denne keren er allerede perfekt vedlikeholdt.",!1;r.maintainCount+=1,r.yieldBonus+=.05;const a=s.subType==="WEED"?"Lukte ugress":"Skremte vekk krka";return n.message=`${a}! (+5% Utbytte).`,!0},HJ=t=>{var h;const{actor:e,action:s,localResult:n,timestamp:i}=t,r=s.cropId||"grain",a=R_[r];if(!a)return n.success=!1,n.message=`Ukjent grde: ${r}`,!1;if((((h=t.room.world)==null?void 0:h.season)||"Spring")==="Winter")return n.success=!1,n.message="Du kan ikke s om vinteren - bakken er frossen.",!1;e.activeProcesses||(e.activeProcesses=[]);const c=s.locationId||"grain_fields",u=e.activeProcesses.find(f=>f.type==="CROP"&&f.locationId===c);if(u){const f=Date.now();if(u.readyAt<=f){const m=e.activeProcesses.indexOf(u);m>-1&&e.activeProcesses.splice(m,1)}else return n.success=!1,n.message="Det vokser allerede noe her.",!1}const d={id:Math.random().toString(36).substr(2,9),type:"CROP",itemId:r,locationId:c,startedAt:Date.now(),duration:a.duration,readyAt:Date.now()+a.duration,notified:!1};return e.activeProcesses.push(d),n.message=`Sdde ${a.label}. Klar om ${Math.ceil(a.duration/6e4)} min.`,!0},zJ=t=>{var y,w,k;const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r,room:a}=t,l=Date.now(),c=s.locationId||"grain_fields",u=(y=e.activeProcesses)==null?void 0:y.findIndex(N=>N.locationId===c&&N.readyAt<=l);if(u===void 0||u===-1)return n.success=!1,n.message="Ingenting er klart til innhsting her.",!1;const d=e.activeProcesses[u];let h="",f=0,m="",b=0,p="FARMING";const v=R_[d.itemId],x=ya[d.itemId];if(v){m=v.label,h=v.yieldResource;const N=s.performance||.5,_=v.minYield+(v.maxYield-v.minYield)*N,T=((w=a.world)==null?void 0:w.season)||"Spring",E=En[T],A=1+(d.yieldBonus||0);f=Math.ceil(_*((E==null?void 0:E.yieldMod)||1)*A),b=Math.ceil(v.xp*(1+N))}else if(x){m=x.label,h=x.outputResource;const N=((k=x.output)==null?void 0:k.amount)||x.outputAmount||1,_=s.performance||.5;f=wi(e,N,"CRAFTING",{performance:_,isRefining:!0}),b=x.xp||10,p=x.skill||"CRAFTING"}else return n.success=!1,n.message="Ugyldig prosess-data.",!1;return e.activeProcesses.filter(N=>N.locationId===c&&N.readyAt<=l).forEach(N=>{const _=e.activeProcesses.indexOf(N);_>-1&&e.activeProcesses.splice(_,1)}),Fc(e,"WORK").forEach(N=>{r(N,re.DURABILITY.LOSS_WORK)}),e.resources[h]||(e.resources[h]=0),e.resources[h]+=f,n.utbytte.push({resource:h,amount:f}),n.message=`Hstet ${f} ${m}`,i(p,b),!0},qJ=t=>{var v,x,g,y,w,k,N;const{actor:e,room:s,action:n,localResult:i,trackXp:r,damageTool:a}=t,l=((v=s.world)==null?void 0:v.activeLaws)||[];Fc(e,"WORK").forEach(_=>{a(_,re.DURABILITY.LOSS_WORK)});let c=1;l.includes("conscription")&&(c=.8);const u=re.YIELD.WORK_GRAIN+((x=e.upgrades)!=null&&x.includes("iron_plow")?5:0),d=((g=s.world)==null?void 0:g.season)||"Spring",h=((y=s.world)==null?void 0:y.weather)||"Clear",f=En[d],m=Fi[h],b=n.performance||.5,p=wi(e,u,"FARMING",{season:(f==null?void 0:f.yieldMod)||1,weather:(m==null?void 0:m.yieldMod)||1,law:c,performance:b,actionType:"WORK",regionId:e.regionId});if(e.resources.grain=(e.resources.grain||0)+p,i.utbytte.push({resource:"grain",amount:p}),i.message=`Hstet ${p} korn`,r("FARMING",Math.ceil(oh.WORK.xp*(1+b))),Math.random()<re.LUCKY_DROP.CHANCE+(((N=(k=(w=e.equipment)==null?void 0:w.HEAD)==null?void 0:k.stats)==null?void 0:N.luckBonus)||0)){const _=Math.ceil(p*.5),T=p+_;e.resources.grain+=_,i.utbytte.push({resource:"grain",amount:_,bonus:!0}),i.message=`Innhstet ${T} korn! (inkl. ${_} flaks)`}return!0},KJ=t=>{var h,f,m,b;const{actor:e,room:s,action:n,localResult:i,trackXp:r,damageTool:a}=t,l=((h=s.world)==null?void 0:h.season)||"Spring";Fc(e,"CHOP").forEach(p=>{a(p,re.DURABILITY.LOSS_WORK)});let c=re.YIELD.CHOP_WOOD;l==="Summer"&&(c+=re.YIELD.SUMMER_WOOD_BONUS);const u=n.performance||.5,d=wi(e,c,"WOODCUTTING",{performance:u,actionType:"CHOP",regionId:e.regionId});if(e.resources.wood=(e.resources.wood||0)+d,i.utbytte.push({resource:"wood",amount:d}),i.message=`Felte ${d} ved`,r("WOODCUTTING",Math.ceil(oh.CHOP.xp*(1+u))),Math.random()<re.LUCKY_DROP.CHANCE+(((b=(m=(f=e.equipment)==null?void 0:f.HEAD)==null?void 0:m.stats)==null?void 0:b.luckBonus)||0)){const p=Math.ceil(d*.5),v=d+p;e.resources.wood+=p,i.utbytte.push({resource:"wood",amount:p,bonus:!0}),i.message=`Felte ${v} ved! (inkl. ${p} flaks)`}return!0},hT=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t,a=typeof s=="string"?s:s.type;Fc(e,a).forEach(f=>{r(f,re.DURABILITY.LOSS_WORK)});const l="MINING",c=a==="MINE"?re.YIELD.MINE_ORE:re.YIELD.QUARRY_STONE,u=a==="MINE"?"iron_ore":"stone",d=s.performance||.5,h=wi(e,c,l,{performance:d,actionType:a,regionId:e.regionId});return e.resources[u]=(e.resources[u]||0)+h,n.utbytte.push({resource:u,amount:h}),n.message=a==="MINE"?`Utvant ${h} jernmalm`:`Hogde ${h} stein`,i(l,Math.ceil(oh.WORK.xp*(1+d))),!0},WJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t;Fc(e,"FORAGE").forEach(u=>{r(u,1)});const a=re.YIELD.FORAGE_BREAD,l=s.performance||.5,c=wi(e,a,"FARMING",{performance:l,actionType:"FORAGE"});return e.resources||(e.resources={}),e.resources.bread=(e.resources.bread||0)+c,n.utbytte.push({resource:"bread",amount:c}),n.message=`Sanket ${c} ndproviant (brd/br)`,i("FARMING",Math.ceil(oh.FORAGE.xp*(1+l))),!0},YJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t;Fc(e,"HUNT").forEach(u=>{r(u,2)});const a=8,l=s.performance||.5,c=wi(e,a,"COMBAT",{performance:l,actionType:"HUNT"});return e.resources.meat=(e.resources.meat||0)+c,n.utbytte.push({resource:"meat",amount:c}),n.message=`Felte bytte og fikk ${c} kjtt`,i("COMBAT",Math.ceil(15*(1+l))),!0},XJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=6,a=s.performance||.5,l=wi(e,r,"FARMING",{performance:a,actionType:"GATHER_WOOL",requiresTool:!0});return l===0?(n.message="Du trenger en Saks for  klippe sauene!",!1):(e.resources.wool=(e.resources.wool||0)+l,n.utbytte.push({resource:"wool",amount:l}),n.message=`Klippet sauer og fikk ${l} ull`,i("FARMING",Math.ceil(10*(1+a))),!0)},QJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.locationId||"beehives";e.activeProcesses||(e.activeProcesses=[]);const a=e.activeProcesses.find(d=>d.type==="HIVE"&&d.locationId===r);if(a){if(a.readyAt>Date.now())return n.success=!1,n.message="Biene trenger hvile fr de kan lage mer honning.",!1;e.activeProcesses=e.activeProcesses.filter(d=>d.id!==a.id)}const l=4,c=s.performance||.5,u=wi(e,l,"FARMING",{performance:c,actionType:"GATHER_HONEY"});return e.resources.honey=(e.resources.honey||0)+u,n.utbytte.push({resource:"honey",amount:u}),n.message=`Hentet ${u} honning fra bikubene`,i("FARMING",Math.ceil(12*(1+c))),e.activeProcesses.push({id:"hive_"+Date.now(),type:"HIVE",itemId:"honey",locationId:r,startedAt:Date.now(),duration:3e5,readyAt:Date.now()+3e5,notified:!1}),!0},JJ=t=>{const{actor:e,localResult:s}=t,n=5;if((e.resources.grain||0)<n)return s.success=!1,s.message=`Mangler korn. Trenger ${n} korn for  mate hnene.`,!1;if(e.activeProcesses||(e.activeProcesses=[]),e.activeProcesses.find(l=>l.type==="COOP"&&l.locationId==="chicken_coop"&&l.readyAt>Date.now()))return s.success=!1,s.message="Hnene har allerede mat.",!1;e.resources.grain-=n,s.utbytte.push({resource:"grain",amount:-n});const r=24e4,a={id:Math.random().toString(36).substr(2,9),type:"COOP",itemId:"egg",locationId:"chicken_coop",startedAt:Date.now(),duration:r,readyAt:Date.now()+r,notified:!1};return e.activeProcesses.push(a),s.message="Matet hnene. Egg klare om 4 minutter.",!0},ZJ=t=>{var l;const{actor:e,localResult:s,trackXp:n}=t,i=Date.now(),r=(l=e.activeProcesses)==null?void 0:l.findIndex(c=>c.type==="COOP"&&c.locationId==="chicken_coop"&&c.readyAt<=i);if(r===void 0||r===-1)return s.success=!1,s.message="Ingen egg  hente enn.",!1;e.activeProcesses.splice(r,1);const a=Math.floor(Math.random()*3)+3;return e.resources.egg||(e.resources.egg=0),e.resources.egg+=a,s.utbytte.push({resource:"egg",amount:a}),s.message=`Samlet ${a} egg.`,n("FARMING",15),!0},eZ=t=>{var c,u,d,h,f,m,b,p,v;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,a=n.subType,l=An[a];if(l){if((((h=(d=(u=(c=s.world)==null?void 0:c.settlement)==null?void 0:u.buildings)==null?void 0:d[l.buildingId])==null?void 0:h.level)||1)<l.level)return i.success=!1,i.message=`Mangler bygningsniv ${l.level} for  lage dette.`,!1;let g=!0;if(Object.entries(l.input).forEach(([y,w])=>{e.resources[y]<w&&(g=!1)}),g){Object.entries(l.input).forEach(([k,N])=>{e.resources[k]-=N});const y=l.outputItemId;if(ze[y]||y==="omelette"){const k=l.outputAmount||1;e.resources[y]=(e.resources[y]||0)+k,i.utbytte.push({resource:y,amount:k});const N=(f=ze[y])==null?void 0:f.label,_=(m=Ke[y])==null?void 0:m.name;i.message=`Laget ${k}x ${N||_||y}!`,r("CRAFTING",25*l.level),Kn(s.pin,"crafted",y,k)}else{const k=Ke[y];if(k){const N={...k,id:`${k.id}_${Date.now()}_${Math.floor(Math.random()*1e3)}`};e.inventory||(e.inventory=[]),e.inventory.push(N),i.utbytte.push({resource:y,amount:1}),i.message=`Smidde ${N.name}!`,r("CRAFTING",25*l.level),Kn(s.pin,"crafted",y,1)}}if(l.stamina){const k=((b=s.world)==null?void 0:b.season)||"Spring",N=((p=s.world)==null?void 0:p.weather)||"Clear",_=Pn(l.stamina,k,N,e.activeBuffs,((v=s.world)==null?void 0:v.gameTick)||0);(e.status.stamina||0)<_?(i.success=!1,i.message=`For lite stamina! Krever ${_}`):e.status.stamina-=_}}else return i.success=!1,i.message="Mangler ressurser for  smi.",!1}return!0},qo=t=>{var c,u,d,h,f,m,b,p,v;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,a=n.recipeId,l=ya[a];if(l){const x=((h=(d=(u=(c=s.world)==null?void 0:c.settlement)==null?void 0:u.buildings)==null?void 0:d[l.buildingId])==null?void 0:h.level)||1;if(l.requiredLevel&&x<l.requiredLevel)return i.success=!1,i.message=`Utvidelse kreves: ${l.buildingId} m vre Niv ${l.requiredLevel}.`,!1;let g=!0;Object.entries(l.input).forEach(([_,T])=>{e.resources[_]<T&&(g=!1)});const y=((f=s.world)==null?void 0:f.season)||"Spring",w=((m=s.world)==null?void 0:m.weather)||"Clear",k=l.stamina||0,N=Pn(k,y,w,e.activeBuffs,((b=s.world)==null?void 0:b.gameTick)||0);if((e.status.stamina||0)<N)return g=!1,i.message=`For lite stamina! Krever ${N}`,i.success=!1,!1;if(g){let _=n.performance||0;const E=Math.max(0,x-(l.requiredLevel||1))*.25,A=_*.5,R=1-Math.min(.9,E+A),I=l.duration?Math.max(l.duration*.1,l.duration*R):0;if(l.duration){e.activeProcesses||(e.activeProcesses=[]);const F=n.locationId||l.buildingId;if(e.activeProcesses.find(j=>j.locationId===F))return i.success=!1,i.message="Det pgr allerede en prosess her.",!1;Object.entries(l.input).forEach(([j,$])=>{e.resources[j]-=$}),e.status.stamina-=N;const C={id:Math.random().toString(36).substr(2,9),type:a==="flour"?"MILL":"CRAFT",itemId:a,locationId:F,startedAt:Date.now(),duration:I,readyAt:Date.now()+I,notified:!1};return e.activeProcesses.push(C),i.message=`Startet ${l.label.toLowerCase()}. Ferdig om ${Math.ceil(I/6e4)} minutter (-${N}).`,!0}Object.entries(l.input).forEach(([F,U])=>{e.resources[F]-=U}),e.status.stamina-=N,_=n.performance!==void 0?n.performance:.5;const V=((p=l.output)==null?void 0:p.amount)||l.outputAmount||1,P=1+Math.max(0,x-(l.requiredLevel||1))*.2,O=wi(e,V,"CRAFTING",{performance:_,isRefining:!0,upgrades:P}),L=e.resources[l.outputResource]||0;e.resources[l.outputResource]=L+O;const M=((v=ze[l.outputResource])==null?void 0:v.label)||l.outputResource;i.utbytte.push({resource:l.outputResource,amount:O}),i.message=`Produserte ${O} ${M}`,r("CRAFTING",re.SKILLS.REFINING_XP),Kn(s.pin,"crafted",l.outputResource,O)}else return i.success=!1,i.message="Mangler ressurser til raffinering.",!1}return!0},tZ=t=>{var p,v;const{actor:e,action:s,localResult:n}=t,{targetSlot:i,itemUid:r,buildingId:a}=s;if(!a||!cb[a])return n.success=!1,n.message="Ugyldig reparasjonsstasjon.",!1;const l=cb[a];let c,u="gjenstanden";if(i?c=e.equipment[i]:r&&(c=(p=e.inventory)==null?void 0:p.find(x=>x.id===r)),!c)return n.success=!1,n.message="Fant ikke gjenstanden som skulle repareres.",!1;if(u=c.name,!l.slots.includes(c.type))return n.success=!1,n.message=`Denne stasjonen kan ikke reparere ${u}.`,!1;if(c.durability>=c.maxDurability)return n.success=!1,n.message=`${u} er allerede i perfekt stand.`,!1;const d=l.goldCost,h=1,f=l.material,m=(e.resources.gold||0)>=d,b=(e.resources[f]||0)>=h;if(m&&b){e.resources.gold-=d,e.resources[f]-=h;const x=re.DURABILITY.REPAIR_AMOUNT,g=c.durability;c.durability=Math.min(c.maxDurability,c.durability+x);const y=c.durability-g;n.durability.push({slot:i||c.type,item:c.name,amount:y}),n.message=`Reparerte ${c.name} (+${y} holdbarhet).`}else{n.success=!1;const x=((v=ze[f])==null?void 0:v.label)||f;return n.message=`Mangler ${m?"":`${d} gull`}${!m&&!b?" og ":""}${b?"":`${h} ${x}`}.`,!1}return!0},sZ=t=>{const{actor:e,action:s,localResult:n}=t,{itemId:i,slot:r}=s;e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]);const a=e.inventory.findIndex(l=>l.id===i);if(a!==-1){const l=e.inventory[a],c=e.equipment[r];e.inventory.splice(a,1),e.equipment[r]=l,c&&e.inventory.push(c),n.message=`Utstyrte ${l.name}`}return!0},nZ=t=>{const{actor:e,action:s,localResult:n}=t,{slot:i}=s,r=e.equipment[i];return r&&(e.equipment[i]=null,e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]),e.inventory.push(r),n.message=`Tok av ${r.name}`),!0},iZ=t=>{const{actor:e,action:s,localResult:n}=t,{itemId:i}=s;e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]);const r=e.inventory.findIndex(a=>a.id===i);if(r!==-1){const a=e.inventory[r];return e.inventory.splice(r,1),n.message=`Slettet ${a.name}`,!0}return n.message="Fant ikke gjenstanden som skulle slettes.",!1},rZ=t=>{const{actor:e,room:s,action:n,localResult:i}=t;if(e.role!=="BARON")return i.success=!1,i.message="Kun Baroner kan kreve inn lokal skatt.",!1;const r=e.regionId,a=s.regions[r];if(!a)return!1;const l=s.world.season,c=s.world.year;if(a.taxHistory||(a.taxHistory=[]),a.lastTaxCollection&&a.lastTaxCollection.year===c&&a.lastTaxCollection.season===l)return i.success=!1,i.message=`Du har allerede krevd inn skatt for ${l} ${c}.`,!1;const u=n.taxRate!==void 0?n.taxRate:a.taxRate||10,d=u/100;let h=0,f=0,m=0,b=0,p=0;const v=(e.regionId||"").trim().toLowerCase();Object.values(s.players).forEach(y=>{var N,_,T;if(!y||y.id===e.id)return;const w=(y.regionId||"").trim().toLowerCase();if(y.role==="PEASANT"&&(w===v||w.includes(v)||v.includes(w))){y.resources||(y.resources={gold:0,grain:0});const E=Number(y.resources.gold??y.gold??y.wealth??((N=y.stats)==null?void 0:N.gold)??((T=(_=y.inventory)==null?void 0:_.find(V=>V.id==="gold"))==null?void 0:T.amount)??0),A=Number(y.resources.grain??0),R=E*d,I=A*d;if(R>0){const V=Math.floor(R);y.resources.gold!==void 0?y.resources.gold-=V:y.gold!==void 0&&(y.gold-=V),b+=R}if(I>0){const V=Math.floor(I);y.resources.grain-=V,p+=I}(R>0||I>0)&&m++}}),h=Math.floor(b),f=Math.floor(p),e.resources||(e.resources={gold:0,grain:0}),e.resources.gold=(e.resources.gold||0)+h,e.resources.grain=(e.resources.grain||0)+f,a.taxRate=u,a.lastTaxCollection={year:c,season:l};const x={year:c,season:l,amountGold:h,amountGrain:f,rate:u,timestamp:Date.now()};a.taxHistory.push(x),a.taxHistory.length>10&&a.taxHistory.shift();const g=Math.max(0,5+Math.floor((u-10)/2));return e.status.legitimacy=Math.max(0,(e.status.legitimacy||100)-g),h>0||f>0?(i.utbytte.push({resource:"gold",amount:h}),i.utbytte.push({resource:"grain",amount:f}),i.message=`Skatteinnkreving (${u}%): ${h}g og ${f} korn fra ${m} bnder. (-${g} Legitimet)`):i.message=`Ingen skatt  hente (sats: ${u}%). (-${g} Legitimet)`,!0},aZ=t=>{const{actor:e,localResult:s}=t;if(e.role!=="BARON"&&e.role!=="KING")return s.success=!1,!1;const n=5,i=10;if((e.resources.gold||0)>=n&&(e.resources.grain||0)>=i)e.resources.gold-=n,e.resources.grain-=i,e.resources.manpower=(e.resources.manpower||0)+10,s.utbytte.push({resource:"manpower",amount:10}),s.message="Mobiliserte tropper (+10 Manpower).";else return s.success=!1,s.message="Mangler ressurser for  mobilisere.",!1;return!0},oZ=t=>{const{actor:e,room:s,localResult:n}=t;if(e.role!=="KING")return!1;n.message="UTSTEDTE KONGELIG DEKRET: Ekstraskatt!";let i=0;return Object.values(s.players).forEach(r=>{r.role==="BARON"&&r.resources.gold>=20&&(r.resources.gold-=20,i+=20)}),e.resources.gold=(e.resources.gold||0)+i,n.utbytte.push({resource:"gold",amount:i}),!0},Tg=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{buildingId:r,resource:a,amount:l}=n,c=Us[r];if(!c)return i.success=!1,i.message=`Fant ikke bygning med ID: ${r}`,!1;const u=r==="farm_house";let d;if(u)e.buildings||(e.buildings={}),e.buildings[r]||(e.buildings[r]={level:1,progress:{}}),d=e.buildings[r];else{if(s.world||(s.world={season:"Spring",weather:"Clear",year:1066,gameTick:0,lastTickAt:Date.now(),taxRateDetails:{kingTax:.1},settlement:{buildings:{}}}),s.world.settlement||(s.world.settlement={buildings:{}}),s.world.settlement.buildings||(s.world.settlement.buildings={}),!s.world.settlement.buildings[r]){const N=["manor_ost","manor_vest","throne_room"].includes(r)?0:1;s.world.settlement.buildings[r]={id:r,level:N,progress:{},contributions:{}}}d=s.world.settlement.buildings[r]}if(d.progress||(d.progress={}),e.resources||(e.resources=JSON.parse(JSON.stringify(ms.PEASANT))),!d.level&&d.level!==0){const k=["manor_ost","manor_vest","throne_room"].includes(r);d.level=k?0:1}const h=d.level+1,f=c.levels[h];if(!f)return i.success=!1,i.message="Maksimalt niv ndd.",!1;const b=(f.requirements||{})[a]||0,p=d.progress[a]||0,v=b-p;let x=!0;if(Object.entries(f.requirements).forEach(([k,N])=>{(d.progress[k]||0)<N&&(x=!1)}),v<=0&&!x)return i.success=!1,i.message="Ressurskravet er allerede oppfylt.",!1;const g=e.resources[a]||0,y=Math.min(l,v,g);if(y<=0)return i.success=!1,i.message=`Kan ikke bidra 0 (Har: ${g}, Trenger: ${v}, Bud: ${l})`,!1;if(e.resources[a]=g-y,d.progress[a]=p+y,!u){d.contributions||(d.contributions={}),d.contributions[e.id]||(d.contributions[e.id]={name:e.name,resources:{}});const k=d.contributions[e.id].resources;k[a]=(k[a]||0)+y}i.message=`Bidro med ${y} ${a} til ${c.name}.`,i.utbytte.push({resource:a,amount:-y});let w=!0;if(Object.entries(f.requirements).forEach(([k,N])=>{(d.progress[k]||0)<N&&(w=!1)}),w){if(d.level=h,d.progress={},u||(d.contributions={}),["watchtower","manor_ost","manor_vest"].includes(c.id)){let k="capital";if(c.id==="manor_ost"&&(k="region_ost"),c.id==="manor_vest"&&(k="region_vest"),s.regions&&s.regions[k]){const N=s.regions[k].fortification||{hp:1e3,maxHp:1e3,level:1};N.maxHp+=500,N.hp+=500,N.level=Math.max(N.level,h),s.regions[k].fortification=N,i.message+="  Murene forsterket! (+500 HP)"}}i.message+=`  NYTT NIV: ${c.name} ndde Niv ${h}!`}return!0},lZ=t=>{var c;const{actor:e,room:s,action:n,localResult:i}=t,r=typeof n=="string"?n:n.type,a=n.buildingId||r.replace("UPGRADE_BUILDING_",""),l=Us[a];if(l){s.world.settlement||(s.world.settlement={buildings:{}});const d=(((c=s.world.settlement.buildings[a])==null?void 0:c.level)||1)+1,h=l.levels[d];if(h){let f=!0;if(Object.entries(h.requirements||{}).forEach(([m,b])=>{(e.resources[m]||0)<b&&(f=!1)}),f){if(Object.entries(h.requirements||{}).forEach(([m,b])=>{e.resources[m]-=b}),s.world.settlement.buildings[a]||(s.world.settlement.buildings[a]={id:a,level:1,progress:{},contributions:{}}),s.world.settlement.buildings[a].level=d,["watchtower","manor_ost","manor_vest"].includes(a)){let m="capital";if(a==="manor_ost"&&(m="region_ost"),a==="manor_vest"&&(m="region_vest"),s.regions&&s.regions[m]){const b=s.regions[m].fortification||{hp:1e3,maxHp:1e3,level:1};b.maxHp+=500,b.hp+=500,b.level=Math.max(b.level,d),s.regions[m].fortification=b}}i.message=`Oppgraderte ${l.name} til Niv ${d}!`}else return i.success=!1,i.message="Mangler ressurser for oppgradering.",!1}}return!0},cZ=t=>{var l;const{actor:e,action:s,localResult:n}=t,i=s.upgradeId,r=e.role,a=C_[r];if(a){const c=a.find(u=>u.id===i);if(c&&!((l=e.upgrades)!=null&&l.includes(i))){let u=!0;if(Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]<h&&(u=!1)}),u)Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]-=h}),e.upgrades||(e.upgrades=[]),e.upgrades.push(i),n.message=`Oppgradering fullfrt: ${c.name}`;else return n.success=!1,n.message="Har ikke rd til oppgradering.",!1}}return!0},uZ=t=>{var c,u;const{actor:e,action:s,localResult:n}=t,i=s.targetRole;if(!i)return n.success=!1,n.message="Ingen rolle spesifisert.",!1;if(e.role===i)return n.success=!1,n.message=`Du er allerede ${i}.`,!1;if(["SOLDIER","MERCHANT","BARON","KING"].includes(i)&&i!=="BARON"&&i!=="KING"){const d=(c=e.roleStats)==null?void 0:c.PEASANT,h=(d==null?void 0:d.level)||(e.role==="PEASANT"?e.stats.level:1),f=re.CAREERS[i];if(f&&h<f.LEVEL_REQ)return n.success=!1,n.message=`Du m vre Bonde Niv ${f.LEVEL_REQ} for  bli ${i}. (N: ${h})`,!1}const a=((u=re.CAREERS[i])==null?void 0:u.COST)||0;if((e.resources.gold||0)<a)return n.success=!1,n.message=`Det koster ${a}g  bli ${i}. (Har: ${e.resources.gold}g)`,!1;e.roleStats||(e.roleStats={}),e.roleStats[e.role]={level:e.stats.level,xp:e.stats.xp,skills:JSON.parse(JSON.stringify(e.skills))},a>0&&(e.resources.gold-=a,n.utbytte.push({resource:"gold",amount:-a}));const l=e.roleStats[i];return l?(e.stats.level=l.level,e.stats.xp=l.xp,e.skills=l.skills):(e.stats.level=1,e.stats.xp=0,e.skills=JSON.parse(JSON.stringify(Rn[i]||Rn.PEASANT))),e.role=i,n.message=`Gratulerer! Du er n ${i}.`,!0},dZ=t=>{const{actor:e,action:s,localResult:n}=t,{stage:i,resources:r}=s;if(e.boat||(e.boat={stage:0,model:"standard",componentLevels:{sails:0,hull:0,cannons:0,nets:0},hullType:"standard",stamina:100,durability:100,upgrades:[],hp:100,maxHp:100,cannons:0,cannonballs:50,isDamaged:!1}),i===-1){if(!e.boat.isDamaged)return n.success=!1,n.message="Bten trenger ikke reparasjon.",!1;let l=!0;return Object.entries(r).forEach(([c,u])=>{(e.resources[c]||0)<u&&(l=!1)}),l?(Object.entries(r).forEach(([c,u])=>{e.resources[c]-=u,n.utbytte.push({resource:c,amount:-u})}),e.boat.isDamaged=!1,e.boat.hp=25,n.message="Ndreparasjon fullfrt. Skroget er tett!",!0):(n.success=!1,n.message="Du har ikke nok materialer til  reparere skroget.",!1)}if(i===-2){if(e.boat.hp>=e.boat.maxHp)return n.success=!1,n.message="Bten er allerede i topp stand.",!1;let l=!0;return Object.entries(r).forEach(([c,u])=>{(e.resources[c]||0)<u&&(l=!1)}),l?(Object.entries(r).forEach(([c,u])=>{e.resources[c]-=u,n.utbytte.push({resource:c,amount:-u})}),e.boat.hp=e.boat.maxHp,n.message="Vedlikehold utfrt. Skroget er som nytt!",!0):(n.success=!1,n.message="Mangler materialer til vedlikehold.",!1)}if(e.boat.stage>=i)return n.success=!1,n.message="Du har allerede fullfrt dette trinnet.",!1;if(i!==e.boat.stage+1)return n.success=!1,n.message="Du m fullfre forrige trinn frst.",!1;let a=!0;return Object.entries(r).forEach(([l,c])=>{(e.resources[l]||0)<c&&(a=!1)}),a?(Object.entries(r).forEach(([l,c])=>{e.resources[l]-=c,n.utbytte.push({resource:l,amount:-c})}),e.boat.stage=i,n.message=`Btbygging: Fullfrte steg ${i}!`,e.stats.xp+=100,e.skills.CRAFTING&&(e.skills.CRAFTING.xp+=50),!0):(n.success=!1,n.message="Mangler ressurser for  bygge bten.",!1)},hZ=t=>{const{actor:e,action:s,localResult:n}=t,{componentId:i}=s;if(!e.boat)return n.success=!1,n.message="Du har ingen bt  oppgradere.",!1;e.boat.componentLevels||(e.boat.componentLevels={sails:0,hull:0,cannons:0,nets:0});const r=e.boat.componentLevels[i]||0,a=I_[i];if(!a)return n.success=!1,n.message="Ukjent oppgradering.",!1;const l=r,c=a.levels[l];if(!c)return n.success=!1,n.message="Maksimalt niv ndd for denne komponenten.",!1;let u=!0;return Object.entries(c.cost).forEach(([d,h])=>{(e.resources[d]||0)<h&&(u=!1)}),u?(Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]-=h,n.utbytte.push({resource:d,amount:-h})}),e.boat.componentLevels[i]=r+1,i==="hull"&&(e.boat.maxHp+=50),i==="cannons"&&(e.boat.cannons+=1),n.message=`Oppgraderte ${a.name} til Niv ${c.level}!`,!0):(n.success=!1,n.message="Mangler ressurser for oppgradering.",!1)},fZ=t=>{const{actor:e,action:s,localResult:n}=t,{modelId:i}=s;if(!e.boat)return n.success=!1,n.message="Du m bygge en bt frst.",!1;const r=e0[i];if(!r)return n.success=!1,n.message="Ukjent btmodell.",!1;if(e.boat.model===i)return n.success=!1,n.message="Du har allerede denne modellen.",!1;let a=!0;return Object.entries(r.cost).forEach(([l,c])=>{(e.resources[l]||0)<c&&(a=!1)}),a?e.boat.stage<4?(n.success=!1,n.message="Du m fullfre grunnkonstruksjonen (Steg 4) fr du kan bytte modell.",!1):(Object.entries(r.cost).forEach(([l,c])=>{e.resources[l]-=c,n.utbytte.push({resource:l,amount:-c})}),e.boat.model=i,e.boat.maxHp=r.baseHp,e.boat.hp=r.baseHp,n.message=`Kjpte ny bt: ${r.name}!`,!0):(n.success=!1,n.message=`Har ikke rd til ${r.name}.`,!1)},mZ=t=>{var h;const{actor:e,action:s,localResult:n}=t,{cosmeticType:i,id:r}=s;if(!e.boat)return!1;if(e.boat.customization||(e.boat.customization={color:"#4b2c20",flagId:"none",figurehead:"none",unlocked:[]}),(Array.isArray(e.boat.customization.unlocked)?e.boat.customization.unlocked:e.boat.customization.unlocked=[]).includes(r)){const f={...e.boat.customization};return i==="color"&&(f.color=((h=ju.colors.find(m=>m.id===r))==null?void 0:h.hex)||"#4b2c20"),i==="flag"&&(f.flagId=r),e.boat={...e.boat,customization:f},n.message="Endret utseende.",!0}let l=null;if(i==="color"&&(l=ju.colors.find(f=>f.id===r)),i==="flag"&&(l=ju.flags.find(f=>f.id===r)),!l)return n.success=!1,n.message="Ukjent gjenstand.",!1;const c=l.cost||{};let u=!0;if(Object.entries(c).forEach(([f,m])=>{(e.resources[f]||0)<m&&(u=!1)}),!u)return n.success=!1,n.message="For dyrt.",!1;Object.entries(c).forEach(([f,m])=>{e.resources[f]-=m,n.utbytte.push({resource:f,amount:-m})}),e.boat.customization.unlocked.push(r);const d={...e.boat.customization};return i==="color"&&(d.color=l.hex),i==="flag"&&(d.flagId=r),e.boat={...e.boat,customization:d},n.message=`Kjpte ${l.name}!`,!0},pZ=.15,fT=15,gZ=t=>{var d,h,f;const{actor:e,room:s,localResult:n,action:i}=t,r=((d=i.payload)==null?void 0:d.targetRegionId)||e.regionId,a=r==="capital"&&e.role==="BARON";if(!r||!a&&(r==="capital"||r==="unassigned"))return n.success=!1,n.message=r==="capital"&&e.role!=="BARON"?"Bare baroner kan g til beleiring av hovedstaden.":"Du m angi en gyldig region for  starte beleiring.",!1;if(!s.regions)return console.error("CRITICAL: room.regions is undefined in handleStartSiege",s),n.success=!1,n.message="Systemfeil: Kunne ikke hente regiondata.",!1;const l=s.regions[r];if(!l)return n.success=!1,n.message="Regionen eksisterer ikke.",!1;if(l.activeSiege)return n.success=!1,n.message="Beleiring pgr allerede!",!1;if(l.rulerName===e.name)return n.success=!1,n.message="Du kan ikke beleire ditt eget slott!",!1;const c=((h=e.resources)==null?void 0:h.siege_sword)||0;if(c<500)return n.success=!1,n.message=`Du trenger minst 500 beleiringssverd i forsyninger for  starte en beleiring! (Eier: ${c})`,!1;const u=((f=l.fortification)==null?void 0:f.hp)||1e3;return l.activeSiege={phase:"BREACH",startedAt:Date.now(),lastTick:Date.now(),attackers:{[e.id]:{lane:1,hp:100,name:e.name}},defenders:{},gateHp:u,maxGateHp:u},n.message=`Beleiringen av ${l.name} har startet!`,!0},xZ=t=>{var m,b,p;const{actor:e,room:s,localResult:n,action:i}=t,r=((m=i.payload)==null?void 0:m.targetRegionId)||e.regionId;if(!r||!((b=s.regions[r])!=null&&b.activeSiege))return n.success=!1,n.message="Ingen aktiv beleiring her.",!1;const a=s.regions[r].activeSiege,l=a.attackers||{},c=a.defenders||{};if(l[e.id]||c[e.id])return n.message="Du deltar allerede.",!1;const u=e.regionId===r,d=["BARON","KING"].includes(e.role);if(!u&&!d)return n.success=!1,n.message="Bare innbyggere eller adelen kan delta i krigfring i dette omrdet.",!1;const h=((p=i.payload)==null?void 0:p.side)==="DEFENDER",f={damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0};return h?(a.defenders||(a.defenders={}),a.defenders[e.id]={lane:1,hp:100,name:e.name,stats:f},n.message="Du forsvarer murene!"):(a.attackers||(a.attackers={}),a.attackers[e.id]={lane:1,hp:100,name:e.name,stats:f},n.message="Du har sluttet deg til beleiringen!"),!0},bZ=t=>{var d,h,f,m,b,p,v,x,g,y,w,k,N,_,T,E,A,R,I,V,H,P,O,L;const{actor:e,room:s,action:n,localResult:i}=t,r=((d=n.payload)==null?void 0:d.targetRegionId)||e.regionId;if(!r||!((h=s.regions[r])!=null&&h.activeSiege))return i.success=!1,i.message="Ingen aktiv beleiring funnet i dette omrdet.",!1;const a=s.regions[r].activeSiege,l=a.attackers||{},c=a.defenders||{},u=l[e.id]||c[e.id];if(!u)return i.message="Du m vre deltaker i beleiringen (angriper eller forsvarer) for  delta i kapplpet.",!1;if(a.phase==="BREACH"){if(n.subType==="ATTACK_GATE"){const F=(((f=e.resources)==null?void 0:f.siege_sword)||0)>0,U=F?25:2;return F&&(e.resources.siege_sword-=1),a.gateHp=Math.max(0,(a.gateHp||1e3)-U),u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=U,i.message=F?` Du hugger ls p porten! (-${U} HP). Du har ${e.resources.siege_sword} beleiringssverd igjen.`:` Du slr p porten med nevene... det gjr nesten ingen skade. (-${U} HP)`,F&&i.utbytte.push({resource:"siege_sword",amount:-1}),a.gateHp<=0&&(a.phase="COURTYARD",a.gateHp=0,i.message="PORTEN ER KNUST! Storm borggrden!"),!0}if(n.subType==="SHIELD_WALL")return!0}if(a.phase==="COURTYARD"){const M=a;if(!M.bossHp){const j=(((b=(m=s.regions[r])==null?void 0:m.garrison)==null?void 0:b.armor)||0)*20,$=1e4;M.bossHp=$+j,M.maxBossHp=$+j,M.bossTargetLane=1,M.nextBossAttack=Date.now()+5e3}if(n.subType==="MOVE_LANE"){const C=(p=n.payload)==null?void 0:p.lane;C>=0&&C<=2&&(u.lane=C,i.message=`Forflyttet til bane ${C===0?"Venstre":C===1?"Midten":"Hyre"}.`)}if(n.subType==="ATTACK_BOSS"){const C=((v=e.resources)==null?void 0:v.siege_sword)||0,j=((g=(x=s.regions[r])==null?void 0:x.garrison)==null?void 0:g.swords)||0,$=!!c[e.id];let B=2,D=!1;return C>0?(B=25,e.resources.siege_sword-=1,i.utbytte.push({resource:"siege_sword",amount:-1})):$&&j>0&&(B=25,s.regions[r].garrison&&(s.regions[r].garrison.swords-=1,D=!0)),M.bossHp-=B,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=B,i.message=D?` Du bruker et sverd fra salens garnison og angriper bossen! (-${B} HP)`:B>2?` Du angriper bossen med ditt eget sverd! (-${B} HP). Du har ${e.resources.siege_sword} igjen.`:` Du slr p bossen med nevene... (-${B} HP)`,!0}const F=((w=(y=s.regions[r])==null?void 0:y.fortification)==null?void 0:w.level)||1,U=pZ+F*.05;if(Date.now()>M.nextBossAttack){const C=M.bossTargetLane,j=u.lane===C,$=Math.random()<U;if(j||$){const B=((N=(k=s.regions[r])==null?void 0:k.garrison)==null?void 0:N.swords)||0,D=Math.floor(B/10),z=fT+D,J=(j?20:0)+($?z:0),Y=!!c[e.id],fe=((_=e.resources)==null?void 0:_.siege_armor)||0,me=((E=(T=s.regions[r])==null?void 0:T.garrison)==null?void 0:E.armor)||0;let ue=0,ne=!1;fe>0?(ue=Math.min(fe,J),e.resources.siege_armor-=ue,i.utbytte.push({resource:"siege_armor",amount:-ue})):Y&&me>0&&(ue=Math.min(me,J),s.regions[r].garrison&&(s.regions[r].garrison.armor-=ue,ne=!0));const Le=J-ue;u.hp-=Le,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageTaken+=J,j&&(i.message+=ne?"  Slottets garnison-rustning beskyttet deg fra bossens slag!":ue>=20?"  Rustningen din tok sttet fra bossen!":"  AU! Bossen traff deg!"),$&&(i.message+=ne?"  Portens pilarer og garnison-rustning stoppet pilene!":ue>=fT?"  Rustningen din stoppet pilene!":`  Piler fra murene traff deg! (-${Le} HP)`),Le>0&&ue>0&&(i.message+=` (Rustningen absorberte ${ue} skade)`)}M.bossTargetLane=Math.floor(Math.random()*3),M.nextBossAttack=Date.now()+5e3}if(M.bossHp<=0){a.phase="THRONE_ROOM";const C=s.regions[r].rulerId,j=s.players[C||""],$=j&&Date.now()-(j.lastActive||0)<6e4,B={};$&&C&&j&&(B[C]={id:C,name:j.name,armor:100,progress:20,joinedAt:Date.now()}),a.throne={mode:$?"PVP":"PVE",occupation:0,plundered:!1,bossHp:$?(((A=j==null?void 0:j.status)==null?void 0:A.hp)||100)*5:5e3,maxBossHp:$?(((R=j==null?void 0:j.status)==null?void 0:R.hp)||100)*5:5e3,defendingPlayerId:C,occupiers:B},i.message="GARNISONSSJEFEN ER BESEIRET! Drene til Tronsalen sls opp!"}return!0}if(a.phase==="THRONE_ROOM"||a.phase==="THRONE"){let M=a.throne;(!M||!M.occupiers)&&(M=M||{},M.occupiers=M.occupiers||{},M.lastTick=Date.now(),a.throne=M);const F=Date.now();if(F-(M.lastTick||0)>1e3){const U=Math.floor((F-(M.lastTick||0))/1e3);M.lastTick=F;const C=Object.values(M.occupiers||{}),j=((V=(I=s.regions[r])==null?void 0:I.garrison)==null?void 0:V.armor)||0,$=Math.min(.8,j/100*.1);C.forEach(B=>{var ue;const z=B.id===s.regions[r].rulerId?1*(1-$):1;B.armor=Math.max(0,B.armor-z*U);const J=l[B.id]||c[B.id],me=1*(1+(((ue=J==null?void 0:J.stats)==null?void 0:ue.damageDealt)||0)/200)*U;if(B.progress=Math.min(100,B.progress+me),J&&(J.stats=J.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},J.stats.ticksOnThrone+=U),B.armor<=0)delete M.occupiers[B.id],i.message=`${B.name} falt fra tronen! (0 Beleiringsrustning)`;else if(B.progress>=100){delete s.regions[r].activeSiege;const ne=s.regions[r];B.id===ne.rulerId?i.message=` ${B.name} har knust opprret og gjenopprettet kontroll over ${ne.name}!`:(i.message=` ${B.name} har vunnet kappelpet og TATT TRONEN med makt!`,i.siegeWinnerId=B.id,i.targetRegionId=r)}})}if(n.subType==="CLAIM_THRONE"){M.occupiers||(M.occupiers={});const U=10,C=e.resources.siege_armor||0;return C<U?(i.message=`Mangler Beleiringsrustning! Du har ${C}, men trenger ${U}.`,!1):(e.resources.siege_armor=0,M.occupiers[e.id]={id:e.id,name:e.name,armor:C,progress:0,joinedAt:Date.now()},i.message=`${e.name} kastet seg inn i kampen om tronen med ${C} rustning!`,!0)}if(n.subType==="DONATE_ARMOR"){const U=(H=n.payload)==null?void 0:H.targetId,C=M.occupiers[U];if(!C)return i.message="Ugyldig ml.",!1;const j=e.resources.siege_armor||0;return j<1?(i.message="Du har ingen beleiringsrustning  gi!",!1):(e.resources.siege_armor=j-1,C.armor+=1,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.armorDonated+=1,i.message=`Donerte rustning til ${C.name}`,!0)}if(n.subType==="SUNDER_ARMOR"){const U=(P=n.payload)==null?void 0:P.targetId,C=M.occupiers[U];if(!C)return i.success=!1,i.message="Ingen p tronen  angripe!",!1;C.armor=Math.max(0,C.armor-1),u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=1;const j=U===s.regions[r].rulerId,$=((L=(O=s.regions[r])==null?void 0:O.garrison)==null?void 0:L.armor)||0;return j&&$>0?i.message=` Du angriper ${C.name}! Angrepet er mindre effektivt pga. slottets garnison-skjold.`:i.message=` Angrep ${C.name} p tronen!`,!0}return n.subType==="TICK",!0}return!1},vZ=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{resource:r,amount:a}=n,l=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(r!=="siege_sword"&&r!=="siege_armor")return i.success=!1,i.message="Ugyldig ressurs for garnisonen.",!1;if((e.resources[r]||0)<a)return i.success=!1,i.message=`Du har ikke nok ${r}.`,!1;s.regions[l].garrison||(s.regions[l].garrison={swords:0,armor:0,morale:100});const u=r==="siege_sword"?"swords":"armor";return e.resources[r]-=a,s.regions[l].garrison||(s.regions[l].garrison={swords:0,armor:0,morale:100}),s.regions[l].garrison[u]=(s.regions[l].garrison[u]||0)+a,i.utbytte.push({resource:r,amount:-a}),i.message=`Forsterket garnisonen med ${a} ${r==="siege_sword"?"vpen":"rustninger"}.`,!0},yZ=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{amount:r}=n,a=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(!s.regions)return!1;const l=s.regions[a];l.fortification||(l.fortification={hp:1e3,maxHp:1e3,level:1});const c=l.fortification;if(c.hp>=c.maxHp)return i.success=!1,i.message="Murene er allerede i perfekt stand.",!1;const u=10*r,d=10*r;if((e.resources.stone||0)<u||(e.resources.wood||0)<d)return i.success=!1,i.message="Mangler stein eller ved til reparasjon.",!1;e.resources.stone=(e.resources.stone||0)-u,e.resources.wood=(e.resources.wood||0)-d;const h=50*r;return c.hp=Math.min(c.maxHp,c.hp+h),i.utbytte.push({resource:"stone",amount:-u}),i.utbytte.push({resource:"wood",amount:-d}),i.message=`Reparerte murene (+${h} HP).`,l.activeSiege&&l.activeSiege.gateHp!==void 0&&(l.activeSiege.gateHp+=h),!0},_Z=t=>{const{actor:e,room:s,localResult:n}=t,i=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(!s.regions)return!1;const r=s.regions[i];r.fortification||(r.fortification={hp:1e3,maxHp:1e3,level:1});const a=r.fortification,l=a.level||1,c=l+1,u=5e3*l,d=100*l,h=100*l;return(e.resources.gold||0)<u||(e.resources.stone||0)<d||(e.resources.wood||0)<h?(n.success=!1,n.message=`Mangler ressurser til oppgradering. Krever ${u}G, ${d} stein og ${h} ved.`,!1):(e.resources.gold-=u,e.resources.stone-=d,e.resources.wood-=h,a.level=c,a.maxHp+=500,a.hp=a.maxHp,n.utbytte.push({resource:"gold",amount:-u}),n.utbytte.push({resource:"stone",amount:-d}),n.utbytte.push({resource:"wood",amount:-h}),n.message=` Oppgradert festningsverk til niv ${c}! Murens styrke er n ${a.maxHp} HP.`,!0)},wZ=t=>{var l,c,u,d,h,f;const{actor:e,room:s,localResult:n,trackXp:i,damageTool:r}=t;if(e.role!=="BARON")return n.success=!1,!1;const a=Object.values(s.players).find(m=>m.role==="BARON"&&m.id!==e.id);if(a){if((((l=s.world)==null?void 0:l.activeLaws)||[]).includes("peace"))return n.success=!1,n.message="Fredsavtale blokkerer raid!",!1;const b=e.resources.manpower||0;let p=a.resources.manpower||0,v=Math.random()*.5+.75;if((c=a.upgrades)!=null&&c.includes("stone_keep")&&(p+=30),(u=a.upgrades)!=null&&u.includes("fence")&&(p+=10),(d=e.upgrades)!=null&&d.includes("stables")&&(v+=.1),e.activeBuffs&&e.activeBuffs.length>0){const x=Date.now(),g=e.activeBuffs.find(y=>y.type==="STRENGTH_BONUS"&&y.expiresAt>x);g&&(v+=g.value/100)}if((h=e.equipment)!=null&&h.MAIN_HAND&&r("MAIN_HAND",re.DURABILITY.LOSS_COMBAT_WEAPON),(f=e.equipment)!=null&&f.BODY&&r("BODY",re.DURABILITY.LOSS_COMBAT_ARMOR),b*v>p){const x=Math.floor((a.resources.gold||0)*re.COMBAT.RAID_LOOT_FACTOR),g=Math.floor((a.resources.grain||0)*re.COMBAT.RAID_LOOT_FACTOR);a.resources.gold=Math.max(0,(a.resources.gold||0)-x),a.resources.grain=Math.max(0,(a.resources.grain||0)-g),e.resources.gold=(e.resources.gold||0)+x,e.resources.grain=(e.resources.grain||0)+g,e.resources.manpower=Math.max(0,e.resources.manpower-5),a.resources.manpower=Math.max(0,a.resources.manpower-8),n.utbytte.push({resource:"gold",amount:x}),n.utbytte.push({resource:"grain",amount:g}),n.message=`Plyndret ${a.name} for ${x}g og ${g} korn!`,i("COMBAT",50)}else return e.resources.manpower=Math.max(0,e.resources.manpower-10),n.success=!1,n.message=`Angrepet p ${a.name} ble sltt tilbake.`,i("COMBAT",10),!1}else return n.success=!1,n.message="Fant ingen annen baron  raide.",!1;return!0},kZ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.performance||.5,a=Math.ceil(15*r);return e.resources.gold=(e.resources.gold||0)+a,i("COMBAT",10),n.utbytte.push({resource:"gold",amount:a}),n.message="Utfrte patrulje.",!0},NZ=t=>{const{actor:e,localResult:s}=t;if(!e.boat)return s.success=!1,s.message="Du trenger en bt for  laste ammunisjon!",!1;const n=e.resources.cannonball||0;return n<=0?(s.success=!1,s.message="Du har ingen kanonkuler i ryggsekken!",!1):(e.boat.cannonballs=(e.boat.cannonballs||0)+n,e.resources.cannonball=0,s.message=`Lastet ${n} kanonkuler ombord. Btlager: ${e.boat.cannonballs} stk.`,!0)},SZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r}=s;e.caravan||(e.caravan={level:1,inventory:{},durability:100,upgrades:[]});const a=re.CARAVAN.LEVELS.find(u=>u.level===e.caravan.level);return a?(e.resources[i]||0)<r?(n.success=!1,n.message=`Du har ikke nok ${i}.`,!1):(Object.values(e.caravan.inventory).reduce((u,d)=>(u||0)+(d||0),0)||0)+r>a.capacity?(n.success=!1,n.message="Karavanen er full!",!1):(e.resources[i]-=r,e.caravan.inventory[i]=(e.caravan.inventory[i]||0)+r,n.message=`Lastet ${r} ${i} p karavanen.`,n.utbytte.push({resource:i,amount:-r}),!0):!1},TZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r}=s;return!e.caravan||!e.caravan.inventory[i]||e.caravan.inventory[i]<r?(n.success=!1,n.message="Mangelfull last i karavanen.",!1):(e.caravan.inventory[i]-=r,e.resources[i]=(e.resources[i]||0)+r,n.message=`Losset ${r} ${i} fra karavanen.`,n.utbytte.push({resource:i,amount:r}),!0)},EZ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,{upgradeType:r,upgradeId:a}=s;if(e.caravan||(e.caravan={level:1,inventory:{},durability:100,upgrades:[]}),r==="LEVEL"){const l=(e.caravan.level||1)+1,c=re.CARAVAN.LEVELS.find(u=>u.level===l);return c?(e.resources.gold||0)<c.cost?(n.success=!1,n.message=`Du mangler ${c.cost-(e.resources.gold||0)} gull for oppgraderingen.`,!1):(e.resources.gold-=c.cost,e.caravan.level=l,e.caravan.durability=c.durability,n.message=`Karavanen oppgradert til: ${c.name}!`,i("TRADING",100),!0):(n.success=!1,n.message="Karavanen er allerede p maks niv.",!1)}if(r==="MODULE"&&a){const l=re.CARAVAN.UPGRADES[a.toUpperCase()];return l?e.caravan.upgrades.includes(l.id)?(n.success=!1,n.message="Du har allerede denne oppgraderingen.",!1):(e.resources.gold||0)<l.cost?(n.success=!1,n.message="Ikke nok gull.",!1):(e.resources.gold-=l.cost,e.caravan.upgrades.push(l.id),n.message=`Kjpte modulen: ${l.name}!`,i("TRADING",50),!0):!1}return!1},AZ=t=>{const{actor:e,localResult:s}=t;if(!e.caravan)return!1;const n=re.CARAVAN.LEVELS.find(u=>u.level===e.caravan.level),i=n?n.durability:100,r=e.caravan.durability||0;if(r>=i)return s.success=!1,s.message="Karavanen er allerede i topp stand.",!1;const c=(i-r)*2;return(e.resources.gold||0)<c?(s.success=!1,s.message=`Du mangler ${c-(e.resources.gold||0)} gull. Reparasjon koster ${c}g.`,!1):(e.resources.gold-=c,e.caravan.durability=i,s.message=`Karavanen reparert for ${c}g.`,!0)},mT=t=>{var a;const{actor:e,action:s,localResult:n}=t,{finalDurability:i,targetRegionId:r}=s;return console.log("[CaravanHandler] Travel Result:",{finalDurability:i,targetRegionId:r,currentDurability:(a=e.caravan)==null?void 0:a.durability}),e.caravan?(e.caravan.durability=Math.max(0,i),e.caravan.durability<=0?(n.success=!1,n.message="Karavanen brt sammen under reisen! Du m reparere den fr du kan reise igjen.",!0):(e.regionId=r,n.message=`Ankom destinasjonen! Durability: ${Math.round(i)}%`,!0)):!1},v1={chassis_oak:{id:"chassis_oak",category:"CHASSIS",name:"Rustikk Eik",cost:0},chassis_iron:{id:"chassis_iron",category:"CHASSIS",name:"Forsterket Jern",cost:1500,reqLevel:3},chassis_gold:{id:"chassis_gold",category:"CHASSIS",name:"Gyllen Kongevogn",cost:5e3,reqLevel:5},wheels_wood:{id:"wheels_wood",category:"WHEELS",name:"Trehjul",cost:0},wheels_iron:{id:"wheels_iron",category:"WHEELS",name:"Jernbesltte",cost:150},wheels_spiked:{id:"wheels_spiked",category:"WHEELS",name:"Pigghjul",cost:500},cover_canvas:{id:"cover_canvas",category:"COVER",name:"Slitt Lerret",cost:0},cover_leather:{id:"cover_leather",category:"COVER",name:"Lr",cost:200},cover_silk:{id:"cover_silk",category:"COVER",name:"Silke med Gullkant",cost:1e3},cover_stars:{id:"cover_stars",category:"COVER",name:"Stjernehimmel",cost:2500},lantern_oil:{id:"lantern_oil",category:"LANTERNS",name:"Oljelampe",cost:0},lantern_crystal:{id:"lantern_crystal",category:"LANTERNS",name:"Bl Krystall",cost:800},lantern_fireflies:{id:"lantern_fireflies",category:"LANTERNS",name:"Ildfluer i bur",cost:300},flag_none:{id:"flag_none",category:"FLAG",name:"Ingen",cost:0},flag_region:{id:"flag_region",category:"FLAG",name:"Regionens Flagg",cost:100},flag_pirate:{id:"flag_pirate",category:"FLAG",name:"Piratflagg",cost:500},skin_ox:{id:"skin_ox",category:"SKIN",name:"Standard Okse",cost:0},skin_horse_linked:{id:"skin_horse_linked",category:"SKIN",name:"Min Hest",cost:0},skin_horse_white:{id:"skin_horse_white",category:"SKIN",name:"Hvit Hest",cost:1e3},skin_horse_mech:{id:"skin_horse_mech",category:"SKIN",name:"Mekanisk Hest",cost:5e3},companion_none:{id:"companion_none",category:"COMPANION",name:"Ingen",cost:0},companion_dog:{id:"companion_dog",category:"COMPANION",name:"Vakthund",cost:400},companion_cat:{id:"companion_cat",category:"COMPANION",name:"Katt p taket",cost:200},trail_dust:{id:"trail_dust",category:"TRAIL",name:"Stvsky",cost:0},trail_gold:{id:"trail_gold",category:"TRAIL",name:"Gullglitter",cost:2e3},trail_dark:{id:"trail_dark",category:"TRAIL",name:"Mrk Tke",cost:1500},decor_none:{id:"decor_none",category:"DECOR",name:"Ingen",cost:0},decor_shields:{id:"decor_shields",category:"DECOR",name:"Skjoldrekke",cost:600},decor_flowers:{id:"decor_flowers",category:"DECOR",name:"Blomsterkasser",cost:100}},jZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i}=s;if(!e.caravan)return!1;e.caravan.customization||(e.caravan.customization={chassis:"chassis_oak",wheels:"wheels_wood",cover:"cover_canvas",lanterns:"lantern_oil",flag:"flag_none",skin:"skin_ox",companion:"companion_none",trail:"trail_dust",decor:"decor_none",unlocked:["chassis_oak","wheels_wood","cover_canvas","lantern_oil","flag_none","skin_ox","skin_horse_linked","companion_none","trail_dust","decor_none"]});const r=v1[i];return r?e.caravan.customization.unlocked.includes(i)?(n.success=!1,n.message="Du eier allerede denne.",!1):(e.resources.gold||0)<r.cost?(n.success=!1,n.message=`Du mangler ${r.cost-(e.resources.gold||0)} gull.`,!1):r.reqLevel&&(e.caravan.level||1)<r.reqLevel?(n.success=!1,n.message=`Krever Karavan Niv ${r.reqLevel}.`,!1):(e.resources.gold-=r.cost,e.caravan.customization.unlocked.push(i),n.message=`Kjpte ${r.name}!`,!0):(n.success=!1,n.message="Ugyldig vare.",!1)},CZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i}=s,r=v1[i];if(!r||!e.caravan)return!1;if(e.caravan.customization||(e.caravan.customization={chassis:"chassis_oak",wheels:"wheels_wood",cover:"cover_canvas",lanterns:"lantern_oil",flag:"flag_none",skin:"skin_ox",companion:"companion_none",trail:"trail_dust",decor:"decor_none",unlocked:["chassis_oak","wheels_wood","cover_canvas","lantern_oil","flag_none","skin_ox","skin_horse_linked","companion_none","trail_dust","decor_none"]}),!e.caravan.customization.unlocked.includes(i))return n.success=!1,n.message="Du eier ikke denne gjenstanden.",!1;if(i==="skin_horse_linked"&&!(e.horseCustomization&&e.horseCustomization.skinId))return n.success=!1,n.message="Du trenger en hest i stallen for  bruke denne.",!1;switch(r.category){case"CHASSIS":e.caravan.customization.chassis=i;break;case"WHEELS":e.caravan.customization.wheels=i;break;case"COVER":e.caravan.customization.cover=i;break;case"LANTERNS":e.caravan.customization.lanterns=i;break;case"FLAG":e.caravan.customization.flag=i;break;case"SKIN":e.caravan.customization.skin=i;break;case"COMPANION":e.caravan.customization.companion=i;break;case"TRAIL":e.caravan.customization.trail=i;break;case"DECOR":e.caravan.customization.decor=i;break}return typeof e.caravan.inventory>"u"&&(e.caravan.inventory={}),typeof e.caravan.upgrades>"u"&&(e.caravan.upgrades=[]),n.message=`Utstyrte ${r.name}.`,!0},RZ=t=>{var d,h,f;const{actor:e,room:s,localResult:n}=t;if(!(_a(((d=s.world)==null?void 0:d.gameTick)||0)==="NIGHT"))return n.success=!1,n.message=" Du kan bare sove nr det er natt.",!1;const a=100-(e.status.stamina||0);e.status.stamina=100,e.status.hp=Math.min(100,(e.status.hp||100)+20),e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(m=>m.type!=="STAMINA_SAVE"||m.label!=="Godt utvilt");const l=((f=(h=e.buildings)==null?void 0:h.farm_house)==null?void 0:f.level)||1;let c=.5,u=3e5;return l>=3&&(c=.6),l>=4&&(c=.7,u=6e5),e.activeBuffs.push({id:"well_rested_"+Date.now(),type:"STAMINA_SAVE",value:c,label:"Godt utvilt",description:`${Math.round(c*100)}% mindre stamina-forbruk etter en god natts svn (Grd Niv ${l}).`,expiresAt:Date.now()+u}),n.message="Du sov tungt gjennom natten. Vknet opp uthvilt og full av energi!",n.utbytte.push({resource:"stamina",amount:a}),!0},Va=t=>{var d;const{actor:e,action:s,localResult:n}=t,i=typeof s=="string"?s:s.type,r=s.locationId;let a=30,l=0,c="Hvilte.";if(i==="EAT"&&(a=40,c="Satt ved varmen og spiste."),i==="FEAST"&&(a=100,l=20,c="Holdt gjestebud!"),i==="GATHER_WATER"||r==="farm_well"||r==="well_water"){e.activeProcesses||(e.activeProcesses=[]);const h=r||(i==="GATHER_WATER"?"well_water":null);if(h){const f=e.activeProcesses.find(m=>m.type==="WELL"&&m.locationId===h);if(f){if(f.readyAt>Date.now())return n.success=!1,n.message="Brnnen er tom. Den fyller seg med vann...",!1;e.activeProcesses=e.activeProcesses.filter(m=>m.id!==f.id)}a=5,c="Drakk friskt vann fra brnnen.",e.activeProcesses.push({id:"well_"+Date.now(),type:"WELL",itemId:"water",locationId:h,startedAt:Date.now(),duration:3e5,readyAt:Date.now()+3e5,notified:!1})}}if(r==="village_square"&&(a=10,c="Hvilte p torget.",$J(e,"REST_SQUARE",6*60*1e3)),(r==="village"||r==="tavern_bar")&&["REST_BASIC","REST_COMFY","REST_ROYAL"].includes(i)){t.room.metadata||(t.room.metadata={});const h=t.room.metadata,f=Date.now(),m=h.lastTavernRest||f,b=(f-m)/3e5;let p=h.tavernDemand||1;b>0&&(p=Math.max(1,p-b*.05));let v=150,x=30,g=0,y=null,w="Hvilte i salen";i==="REST_BASIC"?(v=150,x=30,w="Hvilte i salen"):i==="REST_COMFY"?(v=500,x=80,g=10,w="Hvilte i komfortabelt rom",y={id:"rest_comfy_"+f,type:"STAMINA_SAVE",value:.2,label:"Utvilt",description:"20% redusert stamina-forbruk i 10 min.",expiresAt:f+6e5}):i==="REST_ROYAL"&&(v=1500,x=100,g=50,w="Hvilte i Kongesuite",y={id:"rest_royal_"+f,type:"STAMINA_SAVE",value:.5,label:"Luksusliv",description:"50% redusert stamina, +1 HP/sek regenerering i 20 min.",expiresAt:f+12e5,passiveEffect:"HP_REGEN"});const k=Math.ceil(v*p);return(e.resources.gold||0)<k?(n.success=!1,n.message=`Vertshuset krever ${k}g (Ettersprsel: ${Math.round(p*100)}%). Du har ikke rd.`,!1):(e.resources.gold-=k,n.utbytte.push({resource:"gold",amount:-k}),a=x,l=g,c=`${w} (-${k}g). Fler deg bedre!`,y&&(e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(N=>N.type!=="STAMINA_SAVE"),e.activeBuffs.push(y),c+=` (Buff: ${y.label})`),h.tavernDemand=p+.1,h.lastTavernRest=f,!0)}return(d=e.upgrades)!=null&&d.includes("roof")&&(a+=20),r==="royal_chambers"&&(a=100,l=100,c="Hvilte ut i de kongelige kamrene. Fler deg som en konge igjen!",e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(h=>h.label!=="Kongelig Velvre"),e.activeBuffs.push({id:"royal_wellness_"+Date.now(),type:"STAMINA_SAVE",value:.6,label:"Kongelig Velvre",description:"Fyrstelig velvre reduserer stamina-forbruk med 60%.",expiresAt:Date.now()+6e5})),e.status.stamina=Math.min(100,(e.status.stamina||0)+a),l>0&&(e.status.hp=Math.min(100,(e.status.hp||100)+l)),n.utbytte.push({resource:"stamina",amount:a}),n.message=c,!0},IZ=t=>{const{actor:e,localResult:s,trackXp:n}=t,i=Math.floor(Math.random()*5)+1;return e.resources.favor=(e.resources.favor||0)+i,s.utbytte.push({resource:"favor",amount:i}),n("THEOLOGY",10),s.message=`Ba til gudene. (+${i} velvilje)`,!0},OZ=t=>{const{localResult:e}=t,s=["Baronen ser nervs ut i dag.","Hrte du ulvene i natt?","Prisen p korn gr opp.","Kongens soldater er p vei."];return e.message=`Sladder: "${s[Math.floor(Math.random()*s.length)]}"`,!0},pT=t=>{const{actor:e,action:s,localResult:n}=t,{amount:i,isWin:r,playerRoll:a,houseRoll:l}=s;return r?(e.resources.gold=(e.resources.gold||0)+i,n.utbytte.push({resource:"gold",amount:i}),n.message=`Vant ${i}g p terninger! (${a} mot ${l})`):(e.resources.gold=Math.max(0,(e.resources.gold||0)-i),n.message=`Tapte ${i}g p terninger. (${a} mot ${l})`),!0},MZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r,multiplier:a,isWin:l}=s,c=i,u=e.resources[c]||0;if(u<r)return n.success=!1,n.message=`Du har ikke nok ${i}!`,!1;if(e.resources[c]=Math.max(0,u-r),l){const d=r*a;e.resources[c]+=d;const h=d-r;n.utbytte.push({resource:c,amount:h}),n.message=`Soga-hjulet vider seg til din fordel! Vant ${d} ${i}.`,a>=2.5&&(e.status.morale=Math.min(100,(e.status.morale||50)+5))}else n.message=`Skjebnen var hard. Du mistet ${r} ${i} til soga-hjulet.`,n.utbytte.push({resource:c,amount:-r});return!0},DZ=t=>{var c;const{actor:e,room:s,localResult:n}=t,i=e.regionId||"capital",r=((c=s.markets)==null?void 0:c[i])||s.market;let a=5;r&&r.bread&&(a=r.bread.price);const l=Math.ceil(a*1.2);if((e.resources.gold||0)>=l){e.resources.gold-=l;const u=10;e.status.stamina=Math.min(100,(e.status.stamina||0)+u),n.utbytte.push({resource:"stamina",amount:u}),n.utbytte.push({resource:"gold",amount:-l}),n.message=`Kjpte et mltid i baren for ${l}g. (+10 Stamina)`}else return n.success=!1,n.message=`Har ikke rd til mat (koster ${l}g).`,!1;return!0},LZ=t=>{const{actor:e,room:s,localResult:n}=t;return n.message=`${e.name} har valgt  trekke seg tilbake fra dette livet.`,delete s.players[e.id],!0},PZ=t=>{const{actor:e,action:s,localResult:n,room:i}=t,r=s.itemId,l=!!s.isResource,c=Array.isArray(e.inventory)?e.inventory:Object.values(e.inventory||{});if(l){if(!e.resources[r]||e.resources[r]<1)return n.success=!1,n.message="Du har ikke mer igjen.",!1;e.resources[r]--,n.utbytte.push({resource:r,amount:-1})}else{const d=c.findIndex(h=>h.id===r);if(d===-1)return n.success=!1,n.message="Fant ikke gjenstanden.",!1;e.inventory=c.filter((h,f)=>f!==d)}e.activeBuffs||(e.activeBuffs=[]);const u=Date.now();switch(r){case"bread":e.status.stamina=Math.min(100,(e.status.stamina||0)+20),n.message="Spiste Brd. (+20 Stamina)",n.utbytte.push({resource:"stamina",amount:20});break;case"omelette":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STAMINA_SAVE"),e.activeBuffs.push({id:"buff_omelette_"+u,type:"STAMINA_SAVE",value:.2,label:"Lett til beins",description:"Reduserer stamina-kostnad med 20%.",expiresAt:u+9e5,sourceItem:"omelette"}),n.message="Spiste Omelett. (20% stamina-spare buff)";break;case"minor_stamina_potion":e.status.stamina=Math.min(100,(e.status.stamina||0)+30),n.message="Drakk Liten Stamina-brygg. (+30 Stamina)",n.utbytte.push({resource:"stamina",amount:30});break;case"herbal_balm":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="SPEED_BONUS"),e.activeBuffs.push({id:"buff_balm_"+u,type:"SPEED_BONUS",value:.15,label:"Lett p foten",description:"ker sankehastighet med 15%.",expiresAt:u+6e5,sourceItem:"herbal_balm"}),n.message="Brukte Urtebalsam. (+15% Arbeidshastighet)";break;case"focus_brew":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STAMINA_SAVE"),e.activeBuffs.push({id:"buff_focus_"+u,type:"STAMINA_SAVE",value:.2,label:"Skjerpet Fokus",description:"Reduserer stamina-kostnad med 20% i 15 min.",expiresAt:u+9e5,sourceItem:"focus_brew"}),n.message="Drakk Fokus-brygg. (Bedre fokus!)";break;case"strength_tincture":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STRENGTH_BONUS"),e.activeBuffs.push({id:"buff_strength_"+u,type:"STRENGTH_BONUS",value:10,label:"Kjempestyrke",description:"ker angrepskraft med 10.",expiresAt:u+6e5,sourceItem:"strength_tincture"}),n.message="Drakk Styrke-tinktur. (+10 Angrep)";break;case"masters_draught":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="YIELD_BONUS"),e.activeBuffs.push({id:"buff_master_"+u,type:"YIELD_BONUS",value:.5,label:"Mesterhnd",description:"ker utbytte fra alle sankeoppgaver med 50%.",expiresAt:u+12e5,sourceItem:"masters_draught"}),n.message="Drakk Mester-drikk. (Fler deg som en mester!)";break;case"elixir_of_life":e.status.stamina=100,e.status.hp=Math.min(100,(e.status.hp||100)+50),n.message="Drakk Livseliksir. Full Stamina og +50 HP!",n.utbytte.push({resource:"stamina",amount:100});break;default:return n.success=!1,n.message=`Kan ikke bruke ${r}.`,!1}return Kn(i.pin,"consumed",r,1),!0},VZ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.performance||.5,a=s.method||"ride_easy",l=s.level||1;let c=1,u="lav";a==="ride_medium"?(c=1.6,u="middels"):a==="ride_hard"&&(c=2.5,u="hy");const d=1+(l-1)*.5,h=Math.ceil(10*c*d);if(r===.5&&!s.isComplete){if((e.resources.grain||0)<h)return n.message=`Du har ikke nok korn! Trenger ${h} korn.`,!1;e.resources.grain=(e.resources.grain||0)-h}const f=c*(1+(l-1)*.2);e.status.stamina=Math.min(100,(e.status.stamina||0)+5);const m=Math.ceil(20*(1+r)*f);if(i("STEWARDSHIP",m),r>=.8){e.minigameProgress||(e.minigameProgress={});const b=e.minigameProgress[a]||1;l===b&&b<5?(e.minigameProgress[a]=b+1,n.message=`Glimrende ridning! Du har lst opp niv ${b+1} for ${a==="ride_easy"?"Engelskogen":a==="ride_medium"?"Fjellpasset":"Ulvestien"}! (Brukt ${h} korn)`):n.message=`Du red en tur i ${u} vanskelighetsgrad (Lvl ${l}). Fler deg forfrisket! (Brukt ${h} korn)`}else n.message=`Du red en tur i ${u} vanskelighetsgrad (Lvl ${l}). (Ytelse: ${Math.round(r*100)}%, Brukt ${h} korn)`;return!0},FZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i,cosmeticType:r,price:a}=s;return e.horseCustomization||(e.horseCustomization={skinId:"brown",maneColor:"#1e1b4b",unlockedSkins:["brown"],unlockedManeColors:["#1e1b4b"],unlockedHats:[]}),(e.resources.gold||0)<a?(n.message=`Du har ikke nok gull! Trenger ${a}g.`,!1):(e.resources.gold=(e.resources.gold||0)-a,r==="skin"?(e.horseCustomization.unlockedSkins||(e.horseCustomization.unlockedSkins=["brown"]),e.horseCustomization.unlockedSkins.includes(i)||e.horseCustomization.unlockedSkins.push(i)):r==="mane"?(e.horseCustomization.unlockedManeColors||(e.horseCustomization.unlockedManeColors=["#1e1b4b"]),e.horseCustomization.unlockedManeColors.includes(i)||e.horseCustomization.unlockedManeColors.push(i)):r==="hat"&&(e.horseCustomization.unlockedHats||(e.horseCustomization.unlockedHats=[]),e.horseCustomization.unlockedHats.includes(i)||e.horseCustomization.unlockedHats.push(i)),n.message=`Du kjpte en ny ting til hesten din for ${a}g!`,!0)},BZ=t=>{const{actor:e,action:s}=t,{cosmeticId:n,cosmeticType:i}=s;return e.horseCustomization||(e.horseCustomization={skinId:"brown",maneColor:"#1e1b4b",unlockedSkins:["brown"],unlockedManeColors:["#1e1b4b"],unlockedHats:[]}),i==="skin"?e.horseCustomization.skinId=n:i==="mane"?e.horseCustomization.maneColor=n:i==="hat"&&(e.horseCustomization.hatId=n),!0},xO={WORK:qJ,CHOP:KJ,MINE:hT,QUARRY:hT,FORAGE:WJ,HUNT:YJ,GATHER_WOOL:XJ,GATHER_HONEY:QJ,PLANT:HJ,HARVEST:zJ,MAINTAIN_CROP:GJ,CRAFT:eZ,REFINE:qo,BAKE:qo,MILL:qo,SMELT:qo,WEAVE:qo,MIX:qo,REPAIR:tZ,EQUIP_ITEM:sZ,UNEQUIP_ITEM:nZ,DISCARD_ITEM:iZ,TAX:rZ,DRAFT:aZ,DECREE:oZ,CONSTRUCT:Tg,CONTRIBUTE_TO_UPGRADE:Tg,CONTRIBUTE_TO_PRIVATE_UPGRADE:Tg,UPGRADE_BUILDING:lZ,UPGRADE:cZ,JOIN_ROLE:uZ,CONTRIBUTE_TO_BOAT:dZ,UPGRADE_BOAT_COMPONENT:hZ,BUY_BOAT_MODEL:fZ,BUY_BOAT_COSMETIC:mZ,START_SIEGE:gZ,JOIN_SIEGE:xZ,SIEGE_ACTION:bZ,REINFORCE_GARRISON:vZ,REPAIR_WALLS:yZ,UPGRADE_FORTIFICATION:_Z,RAID:wZ,PATROL:kZ,REFILL_AMMO:NZ,SLEEP:RZ,REST:Va,REST_BASIC:Va,REST_COMFY:Va,REST_ROYAL:Va,EAT:Va,FEAST:Va,PRAY:IZ,CHAT_LOCAL:OZ,GAMBLE_RESULT:pT,PLAY_DICE:pT,PLAY_RESOURCE_GAME:MZ,BUY_MEAL:DZ,RETIRE:LZ,CONSUME:PZ,FEED_CHICKENS:JJ,COLLECT_EGGS:ZJ,GATHER_WATER:Va,TRADE_ROUTE:E7,MOUNT_HORSE:VZ,BUY_HORSE_COSMETIC:FZ,SELECT_HORSE_COSMETIC:BZ,BUY:S7,SELL:T7,LOAD_CARAVAN:SZ,UNLOAD_CARAVAN:TZ,UPGRADE_CARAVAN:EZ,REPAIR_CARAVAN:AZ,TRAVEL_COMPLETE:mT,TRAVEL_FAILED:mT,BUY_CARAVAN_COSMETIC:jZ,EQUIP_CARAVAN_COSMETIC:CZ},Eg=[{level:0,label:"Gammelt Trestativ",slots:2,cost:{wood:50}},{level:1,label:"Forsterket Jernstativ",slots:4,cost:{wood:100,ore:50}},{level:2,label:"Forgylt Kongestativ",slots:6,cost:{wood:200,ore:100,gold:500}}],UZ=async(t,e,s)=>{const n=q(K,`simulation_rooms/${t}/players/${e}`),{type:i,slotId:r,itemId:a,instanceId:l,trophyId:c,price:u}=s;let d=!1,h="";return await De(n,f=>{if(!f)return;f.weaponRack||(f.weaponRack={level:0,slots:[],unlockedTrophies:[]});const m=f.weaponRack;m.slots||(m.slots=[]),m.unlockedTrophies||(m.unlockedTrophies=[]);const p=(Eg.find(v=>v.level===m.level)||Eg[0]).slots;if(i==="RACK_UPGRADE"){const v=Eg.find(y=>y.level===m.level+1);if(!v)return;const x=v.cost;if(!Object.entries(x).every(([y,w])=>(f.resources[y]||0)>=w))return;Object.entries(x).forEach(([y,w])=>{const k=y;f.resources[k]=(f.resources[k]||0)-w}),m.level+=1,h=`Oppgraderte vpenstativet til ${v.label}!`,d=!0}if(i==="RACK_MOUNT_ITEM"){if(m.slots.length>=p)return;const v=(f.inventory||[]).findIndex(g=>g.id===a||g.id===l);if(v===-1)return;const x=f.inventory[v];f.inventory.splice(v,1),m.slots.push({id:`slot_${Date.now()}`,type:"ITEM",itemId:x.id,instanceId:x.id}),h=`Hengte opp ${x.name}`,d=!0}if(i==="RACK_MOUNT_TROPHY"){if(m.slots.length>=p||!m.unlockedTrophies.includes(c)||m.slots.some(v=>v.itemId===c))return;m.slots.push({id:`slot_${Date.now()}`,type:"TROPHY",itemId:c}),h="Plasserte trof p utstilling.",d=!0}if(i==="RACK_UNMOUNT"){const v=m.slots.findIndex(g=>g.id===r);if(v===-1)return;const x=m.slots[v];if(x.type==="ITEM"){const g=Ke[x.itemId];if(g){const y=JSON.parse(JSON.stringify(g));f.inventory||(f.inventory=[]),f.inventory.push(y)}}m.slots.splice(v,1),h="Tok ned gjenstand.",d=!0}if(i==="RACK_BUY_TROPHY"){if(f.resources.gold<u||m.unlockedTrophies.includes(c))return;f.resources.gold-=u,m.unlockedTrophies.push(c),h="Kjpte nytt trof!",d=!0}if(i==="RACK_POLISH"){const v=Date.now(),x=m.lastPolishedAt||0;if(v-x<6e4*60){h="Du m vente fr du kan pusse utstyret igjen.";return}m.lastPolishedAt=v,f.status.morale||(f.status.morale=50),f.status.morale=Math.min(100,f.status.morale+10),h="Pusset samlingen. Moralen ker!",d=!0}return f}),d&&h&&dt(t,h),{success:d}},bO=(t,e,s,n)=>{var u,d;t.roleStats||(t.roleStats={});const i=t.role;t.roleStats[i]||(t.roleStats[i]={level:((u=t.stats)==null?void 0:u.level)||1,xp:((d=t.stats)==null?void 0:d.xp)||0,skills:JSON.parse(JSON.stringify(t.skills||Rn[i]||Rn.PEASANT))});const r=t.roleStats[i],a=r.skills[e];a&&(a.xp+=s||0,a.xp>=a.maxXp&&(a.level+=1,a.xp-=a.maxXp,a.maxXp=Math.floor(a.maxXp*1.5),n.push(` ${t.name} ble bedre i ${e}! (Niv ${a.level})`))),r.xp=(r.xp||0)+(s||0);const c=(h=>{const f=Lm.findIndex(m=>h<m);return f===-1?Lm.length:f})(r.xp);c>r.level&&(r.level=c,n.push(` ${t.name} har steget i rang som ${i} til Niv ${c}!`)),t.stats.xp=r.xp,t.stats.level=r.level,t.skills=r.skills};async function vO(t,e,s){var i,r,a;if(!t||!s)return;await new Promise(l=>setTimeout(l,Math.random()*200));const n=q(K,`simulation_accounts/${t}`);try{const l=await ve(n);if(!l.exists())return;const c=l.val(),u=c.characterHistory||[],d={name:s.name,role:s.role,level:((i=s.stats)==null?void 0:i.level)||1,xp:((r=s.stats)==null?void 0:r.xp)||0,roomPin:e,timestamp:Date.now()},h=[...u,d],f=((a=s.stats)==null?void 0:a.xp)||0,m=(c.globalXp||0)+f,b=Math.floor(Math.sqrt(m/100))+1,p={};p.characterHistory=h,p.globalXp=m,p.globalLevel=b,p.lastActive=Date.now(),p[`activeSessions/${e}`]=null,await ae(n,p),console.log(`Character life recorded for ${s.name} (${t})`)}catch(l){console.error("Failed to record character life:",l)}}const $Z=Object.freeze(Object.defineProperty({__proto__:null,addXp:bO,recordCharacterLife:vO},Symbol.toStringTag,{value:"Module"}));async function GZ(t,e,s){const n=typeof s=="string"?s:s.type,i=q(K,`simulation_rooms/${t}/players/${e}`),r=q(K,`simulation_rooms/${t}/regions`),a=q(K,`simulation_rooms/${t}/world`);try{const[l,c,u]=await Promise.all([ve(i),ve(r),ve(a)]);if(!l.exists())return{success:!1,error:"Spiller finnes ikke"};const d=l.val();d.resources||(d.resources=ms[d.role]||ms.PEASANT);const h=c.val()||{},f=u.val()||{},m={success:!0,timestamp:Date.now(),message:"",utbytte:[],xp:[],durability:[]},b={world:f,regions:h,players:{[e]:d},markets:{},messages:[]},p={actor:d,room:b,pin:t,action:s,timestamp:new Date().toLocaleTimeString(),localResult:m,trackXp:(k,N)=>{},damageTool:()=>!0},v=xO[n];if(!v)return{success:!1,error:"Ukjent handling"};if(!v(p)||!m.success)return{success:!1,data:m};const g={};g[`players/${e}`]=d;const y=m.siegeWinnerId,w=m.targetRegionId;if(y&&w){const k=h[w],N=k.rulerId,_=w==="capital";if(N&&N!==y){const E=await ve(q(K,`simulation_rooms/${t}/players/${N}`));if(E.exists()){const A=E.val();A.role="PEASANT",A.status&&(A.status.legitimacy=0),g[`players/${N}`]=A,g[`public_profiles/${N}/role`]="PEASANT",Kn(t,"roleChanges","PEASANT (Demoted)",1)}}const T=await ve(q(K,`simulation_rooms/${t}/players/${y}`));if(T.exists()){const E=T.val(),A=E.regionId,R=_?"KING":"BARON";E.role=R,E.regionId=w,E.status&&(E.status.legitimacy=100),g[`players/${y}`]=E,g[`public_profiles/${y}/role`]=R,g[`public_profiles/${y}/regionId`]=w,k.rulerId=y,k.rulerName=E.name,_&&A&&A!=="capital"&&A!=="unassigned"&&x7(t,A)}}return g.regions=h,await ae(q(K,`simulation_rooms/${t}`),g),{success:!0,data:m}}catch(l){return console.error("Siege Transaction Failed",l),{success:!1,error:l.message||"Beleiring feilet"}}}const HZ=["MARKET_BUY","MARKET_SELL","RAID","TAX","TAX_PEASANTS","TAX_ROYAL","TRADE","TRADE_ROUTE","CONTRIBUTE_TO_UPGRADE","BUY","SELL","CONTRIBUTE","CONSTRUCT","UPGRADE_BUILDING","START_SIEGE","JOIN_SIEGE","SIEGE_ACTION","REINFORCE_GARRISON","REPAIR_WALLS","SET_TAX","UPGRADE_FORTIFICATION","TRAVEL_START","TRAVEL_COMPLETE"],yO=async(t,e,s)=>{const n=typeof s=="string"?s:s.type;return HZ.includes(n)?await qZ(t,e,s):n&&n.startsWith("RACK_")?await UZ(t,e,s):zZ(t,e,s)};async function zZ(t,e,s){const n=q(K,`simulation_rooms/${t}/players/${e}`),i=q(K,`simulation_rooms/${t}/world`);let r=null;try{const a=await ve(i),l=a.exists()?a.val():{season:"Spring",weather:"Clear",activeLaws:[]};if(await De(n,c=>{var w,k,N;if(!c)return c;c.resources||(c.resources=JSON.parse(JSON.stringify(ms[c.role]||ms.PEASANT))),c.skills||(c.skills=JSON.parse(JSON.stringify(Rn[c.role]||Rn.PEASANT))),c.status||(c.status={stamina:100,hp:100,authority:0,gold:c.resources.gold||0,level:1,xp:0}),c.equipment||(c.equipment={HEAD:null,BODY:null,MAIN_HAND:null,OFF_HAND:null,FEET:null,TRINKET:null,AXE:null,PICKAXE:null,SCYTHE:null,HAMMER:null}),c.stats||(c.stats={level:1,xp:0}),c.activeBuffs||(c.activeBuffs=[]);const u={success:!0,timestamp:Date.now(),message:"",utbytte:[],xp:[],durability:[]},d=(_,T)=>{var O,L,M,F,U,C;let E=T;const A=((O=l.settlement)==null?void 0:O.buildings)||{},I={WOODCUTTING:"sawmill",FARMING:"windmill",MINING:"smeltery",CRAFTING:"great_forge",TRADING:"weavery"}[_];I&&(((L=A[I])==null?void 0:L.level)||1)>=2&&(E=Math.ceil(E*1.1));const V=((F=(M=c.skills)==null?void 0:M[_])==null?void 0:F.level)||0,H=[];bO(c,_,E,H),H.length>0&&(u.message+=" "+H.join(" "));const P=((C=(U=c.skills)==null?void 0:U[_])==null?void 0:C.level)||0;u.xp.push({skill:_,amount:E,levelUp:P>V})},h=c.stats.level||1,f=(_,T)=>{var A;const E=(A=c.equipment)==null?void 0:A[_];return E&&(E.durability=Math.max(0,E.durability-T),u.durability.push({slot:_,item:E.name||"Gjenstand",amount:T,broken:E.durability<=0}),E.durability<=0)?(u.message=` ${E.name} ble delagt!`,u.success=!1,!1):!0},m=Date.now(),b=m-(c.lastActive||m),p=Math.min(60,isNaN(b)?0:b/6e4);if(p>.1){let _=0;(w=c.upgrades)!=null&&w.includes("cow")&&(_+=p*re.PASSIVE_INCOME.COW),(k=c.upgrades)!=null&&k.includes("accounting_books")&&(_+=p*re.PASSIVE_INCOME.ACCOUNTING_BOOKS),(N=c.upgrades)!=null&&N.includes("caravan")&&(_+=p*re.PASSIVE_INCOME.CARAVAN),_>0&&(c.resources.gold=(c.resources.gold||0)+Math.floor(_));const T=p*2;c.status.stamina=Math.min(100,(c.status.stamina||0)+T)}const v=c.role,x=typeof s=="string"?s:s.type,g=Mc[x];if(g){const _=Pn(g.stamina||0,l.season,l.weather,c.activeBuffs,l.gameTick||0);for(const[T,E]of Object.entries(g)){if(T==="stamina")continue;const A=T;if((c.resources[A]||0)<E)return u.success=!1,u.message=` Mangler ${E} ${T}!`,r=u,c}if((c.status.stamina||0)<_)return u.success=!1,u.message=` For sliten! (${_} kreves)`,r=u,c;for(const[T,E]of Object.entries(g)){if(T==="stamina")continue;const A=T;c.resources[A]=(c.resources[A]||0)-E,Kn(t,"consumed",T,E)}c.status.stamina-=_}const y=xO[x];if(y){const _={actor:c,room:{world:l,players:{[e]:c},messages:[]},pin:t,action:s,timestamp:new Date().toLocaleTimeString(),localResult:u,trackXp:d,damageTool:f};if(y(_)===!1)return r=u,c}else u.success=!1,u.message=`Ukjent handling: ${x}`;return u.message||(u.message="Handling utfrt."),u.success&&Math.random()<.005&&(c.resources.gold=(c.resources.gold||0)+150,u.utbytte.push({id:"ancient_relic",name:"Gammel Relikvie",type:"ITEM",icon:"",amount:1,jackpot:!0}),u.message+="  ET JORDFUNN! Du fant en eldgammel relikvie!"),c.lastActive=Date.now(),r=u,x==="RETIRE"&&u.success&&(r.characterSnapshot=JSON.parse(JSON.stringify(c))),c.stats.level>h&&(r.newLevel=c.stats.level),c.role!==v&&Kn(t,"roleChanges",c.role,1),c}),r&&r.success){if(r.message&&await dt(t,`[${new Date().toLocaleTimeString()}] ${r.message}`),r.utbytte&&r.utbytte.length>0&&r.utbytte.forEach(c=>{const u=c.type==="ITEM"?"crafted":"produced";Kn(t,u,c.id||c.resource,c.amount||1)}),r.characterSnapshot){const c=r.characterSnapshot.uid||e;await vO(c,t,r.characterSnapshot)}if(r.newLevel)try{await ae(q(K,`simulation_rooms/${t}/public_profiles/${e}`),{"stats/level":r.newLevel,lastActive:Date.now()})}catch(c){console.error("Failed to sync level",c)}}return{success:!!(r!=null&&r.success),data:r||void 0}}catch(a){return console.error("Action error:",a),{success:!1,error:a.message||"Handling feilet"}}}async function qZ(t,e,s){const n=typeof s=="string"?s:s.type;try{return n==="BUY"||n==="SELL"||n==="TRADE_ROUTE"||n==="MARKET_BUY"||n==="MARKET_SELL"?await h7(t,e,s):n==="CONTRIBUTE"||n==="CONTRIBUTE_TO_UPGRADE"||n==="CONSTRUCT"||n==="UPGRADE_BUILDING"?await f7(t,e,s):n==="TAX"||n==="TAX_PEASANTS"||n==="TAX_ROYAL"?await m7(t,e,s):n==="START_SIEGE"||n==="JOIN_SIEGE"||n==="SIEGE_ACTION"||n==="UPGRADE_FORTIFICATION"||n==="REINFORCE_GARRISON"||n==="REPAIR_WALLS"?await GZ(t,e,s):n==="SET_TAX"?await b7(t,e,s):n==="TRAVEL_START"?await k7(t,e,s):n==="TRAVEL_COMPLETE"?await N7(t,e,s):{success:!1,error:"Global handling not available."}}catch(i){return console.error("Global Action ERROR:",i),{success:!1,error:i.message||"Global handling feilet"}}}class KZ{constructor(e,s){Ie(this,"player");Ie(this,"genome");Ie(this,"brain");Ie(this,"startTime");Ie(this,"history",[]);Ie(this,"status","RUNNING");Ie(this,"lastActionAt",0);Ie(this,"stuckThreshold",6e4);this.player=e,this.genome=s,this.brain=new FJ(s),this.startTime=Date.now()}async tick(e,s){if(this.status!=="RUNNING")return;const n=this.brain.decide(this.player,e);if(this.history.push(n),this.history.length>20&&this.history.shift(),n.action==="IDLE"){Date.now()-this.lastActionAt>this.stuckThreshold&&(this.status="STUCK",this.dumpLog("Bottleneck detected: Stuck for > 60s"));return}this.lastActionAt=Date.now(),(await yO(s,this.player.id,n.action)).success,this.player.role==="KING"&&(this.status="SUCCESS")}getFitness(){return Fb.calculateFitness(this.player,this.startTime)}dumpLog(e){const s={reason:e,genome:this.genome,history:this.history,playerState:this.player,timestamp:Date.now()};console.error("AI Training Lab - Game Balance Issue:",s),window.lastAILog=s}}const WZ=({roomData:t,pin:e})=>{var k;const[s,n]=S.useState([]),[i,r]=S.useState(0),[a,l]=S.useState(!1),[c,u]=S.useState([]),[d,h]=S.useState({}),[f,m]=S.useState({}),[b,p]=S.useState(null),v=S.useRef(t);S.useEffect(()=>{v.current=t},[t]);const x=S.useRef(null),g=async()=>{const N={};for(let _=1;_<=5;_++){const T=`bot_${Date.now()}_${_}`,E={id:T,name:`BOT Alpha ${_}`,role:"PEASANT",regionId:Math.random()>.5?"region_ost":"region_vest",resources:{...ms.PEASANT},status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:10,contribution:0},skills:{...Rn.PEASANT},lastActive:Date.now(),online:!0};N[`simulation_rooms/${e}/players/${T}`]=E,N[`simulation_rooms/${e}/public_profiles/${T}`]={id:T,stats:{level:1},status:E.status,online:!0,lastActive:Date.now()}}try{await ae(q(K),N)}catch(_){console.error("Failed to spawn bots",_)}},y=()=>{t.players&&l(!0)},w=()=>{l(!1),x.current&&cancelIdleCallback(x.current)};return S.useEffect(()=>{if(a){const N=async()=>{const _=v.current,T=Object.values(_.players||{}).filter(E=>E.name.includes("BOT"));await Promise.all(T.map(async E=>{let A=s.find(R=>R.player.id===E.id);if(A)A.player=E;else{const R=Fb.getNextGenerationGenome();A=new KZ(E,R),n(I=>[...I,A]),r(R.generation)}if(await A.tick(_,e),A.history.length>0){const R=A.history[A.history.length-1];let I=R.action.type||"IDLE";I==="SELL"&&R.action.itemId?I=`SELL (${R.action.itemId})`:I==="BUY"&&R.action.itemId&&(I=`BUY (${R.action.itemId})`),h(V=>({...V,[I]:(V[I]||0)+1})),m(V=>({...V,[A.player.id]:{name:A.player.name,action:I,reason:R.reason,score:R.score.toFixed(2),fitness:A.getFitness().toFixed(1),resources:{...A.player.resources},stamina:A.player.status.stamina}}))}if((A.status==="STUCK"||A.status==="DEAD")&&p(window.lastAILog),A.status==="SUCCESS"||A.status==="DEAD"||A.status==="STUCK"){const R=A.getFitness();A.genome.fitness=R,Fb.saveTopGenomes([A.genome]),u(I=>[...I.slice(-19),R])}})),x.current=window.setTimeout(()=>N(),1e3)};N()}return()=>{x.current&&clearTimeout(x.current)}},[a,e]),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[o.jsx(TX,{className:"text-indigo-400"})," AI Training Lab"]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Genetisk Algoritme-optimalisering av spillbalanse"})]}),o.jsx("div",{className:"flex gap-3",children:a?o.jsxs("button",{onClick:w,className:"bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg flex items-center gap-2 font-bold transition-all",children:[o.jsx(Pb,{size:18})," Stopp Trening"]}):o.jsxs("button",{onClick:y,className:"bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg flex items-center gap-2 font-bold transition-all",children:[o.jsx(yd,{size:18})," Start Trening"]})})]}),a&&Object.values(t.players||{}).filter(N=>N.name.includes("BOT")||N.id.startsWith("bot_")).length===0&&o.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 p-6 rounded-2xl flex items-center justify-between animate-in slide-in-from-top-2",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"bg-amber-500/20 p-3 rounded-full text-amber-500",children:o.jsx(o0,{size:24})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-amber-500 font-black uppercase text-sm",children:"Ingen bot-subjekter funnet"}),o.jsx("p",{className:"text-amber-200/60 text-xs",children:"AI-en trenger kropper  kontrollere (navn med 'BOT' eller ID 'bot_')."})]})]}),o.jsx("button",{onClick:g,className:"bg-amber-500 hover:bg-amber-400 text-black px-6 py-3 rounded-xl font-black uppercase text-xs tracking-widest transition-all shadow-lg hover:scale-105",children:" Spawn Alpha Squad (5 stk)"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(oT,{size:14})," Generasjon"]}),o.jsx("div",{className:"text-4xl font-black",children:i})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10 flex flex-col justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(zm,{size:14})," Fitness Trend"]}),o.jsx("div",{className:"text-4xl font-black mb-4",children:c.length>0?(c.reduce((N,_)=>N+_,0)/c.length).toFixed(1):"0.0"})]}),o.jsxs("div",{className:"h-12 flex items-end gap-1 px-1",children:[c.map((N,_)=>{const T=Math.max(...c,1),E=N/T*100;return o.jsx("div",{className:"flex-1 bg-indigo-500/50 rounded-t-sm transition-all duration-500 hover:bg-indigo-400",style:{height:`${E}%`},title:`Fitness: ${N.toFixed(1)}`},_)}),c.length===0&&o.jsx("div",{className:"w-full h-[1px] bg-white/10"})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10 text-amber-500",children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(oc,{size:14})," Bottlenecks"]}),o.jsx("div",{className:"text-4xl font-black text-amber-500",children:s.filter(N=>N.status==="STUCK").length})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsx("h3",{className:"text-sm font-bold uppercase tracking-widest text-slate-400 mb-4",children:"Decision Heatmap"}),o.jsxs("div",{className:"flex flex-wrap gap-4",children:[Object.entries(d).sort((N,_)=>_[1]-N[1]).map(([N,_])=>o.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 flex flex-col items-center min-w-[80px]",children:[o.jsx("span",{className:"text-xs text-slate-500 uppercase",children:N}),o.jsx("span",{className:"text-lg font-bold",children:_})]},N)),Object.keys(d).length===0&&o.jsx("p",{className:"text-slate-600 italic",children:"Ingen data enn..."})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-slate-400 mb-4 flex items-center gap-2",children:[o.jsx(oT,{size:16,className:"text-indigo-400"})," Live Neural Feed"]}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-left border-collapse",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"text-xs uppercase text-slate-500 border-b border-white/10",children:[o.jsx("th",{className:"p-3",children:"Subject"}),o.jsx("th",{className:"p-3",children:"Last Decision"}),o.jsx("th",{className:"p-3",children:"Reasoning"}),o.jsx("th",{className:"p-3",children:"Score"}),o.jsx("th",{className:"p-3",children:"Fitness"}),o.jsx("th",{className:"p-3",children:"Gold"}),o.jsx("th",{className:"p-3",children:"Stamina"})]})}),o.jsxs("tbody",{className:"text-sm",children:[Object.entries(f).map(([N,_])=>o.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors font-mono",children:[o.jsx("td",{className:"p-3 font-bold text-indigo-300",children:_.name}),o.jsx("td",{className:"p-3",children:o.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded text-xs font-bold border border-indigo-500/30",children:_.action})}),o.jsxs("td",{className:"p-3 text-slate-400 italic text-xs",children:['"',_.reason,'"']}),o.jsx("td",{className:"p-3 text-slate-300",children:_.score}),o.jsx("td",{className:"p-3 font-bold text-white",children:_.fitness}),o.jsx("td",{className:"p-3 text-amber-400",children:_.resources.gold}),o.jsx("td",{className:"p-3",children:o.jsx("div",{className:"w-16 h-1 bg-slate-700 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${_.stamina}%`}})})})]},N)),Object.keys(f).length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-600 italic",children:"Venter p telemetri..."})})]})]})})]}),b&&o.jsxs("div",{className:"bg-red-950/30 border border-red-500/30 p-6 rounded-2xl",children:[o.jsxs("h3",{className:"text-red-400 font-bold flex items-center gap-2 mb-4",children:[o.jsx(oc,{size:18})," Game Balance Issue Detected"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"bg-black/40 p-4 rounded-lg",children:[o.jsx("p",{className:"text-slate-400 text-xs uppercase mb-2",children:"Grunn"}),o.jsx("p",{className:"font-mono",children:b.reason})]}),o.jsxs("div",{className:"bg-black/40 p-4 rounded-lg",children:[o.jsx("p",{className:"text-slate-400 text-xs uppercase mb-2",children:"Siste Handling"}),o.jsx("p",{className:"font-mono",children:((k=b.history[b.history.length-1])==null?void 0:k.action.type)||"None"})]})]}),o.jsx("pre",{className:"mt-4 p-4 bg-black/40 rounded-lg overflow-x-auto text-[10px] text-slate-300 custom-scrollbar",children:JSON.stringify(b,null,2)})]})]})},YZ=Ne.memo(({pin:t,roomData:e,view:s,setView:n,isLoading:i,onBack:r,worldActions:a,playerActions:l,SimulationEconomyBlueprint:c})=>{var u,d,h,f;return o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 flex overflow-hidden font-sans selection:bg-indigo-500/30 z-20",children:[o.jsxs("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:[o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full animate-pulse"}),o.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-600/10 blur-[120px] rounded-full"})]}),o.jsx(LJ,{pin:t,roomData:e,isLoading:i,onBack:r,...a,...l}),o.jsxs("main",{className:"flex-1 relative flex flex-col bg-slate-900/10 overflow-hidden no-scrollbar",children:[o.jsxs("header",{className:"h-16 border-b border-white/5 bg-slate-950/30 backdrop-blur-md flex items-center justify-between px-8 shrink-0 z-10",children:[o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsxs("nav",{className:"flex items-center bg-white/5 p-1 rounded-xl border border-white/10",children:[o.jsx("button",{onClick:()=>n("MANAGE"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="MANAGE"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"Overvking"}),o.jsx("button",{onClick:()=>n("ECONOMY"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="ECONOMY"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"Blueprint"}),o.jsx("button",{onClick:()=>n("AI_LAB"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="AI_LAB"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"AI Training Lab"})]}),o.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-2"}),o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Innbyggere:"}),o.jsx("span",{className:"text-sm font-bold text-white",children:Object.keys(e.players||{}).length})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"r i Riket:"}),o.jsx("span",{className:"text-sm font-bold text-white",children:((u=e.world)==null?void 0:u.year)||1100})]})]})]}),i&&o.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400 animate-pulse",children:"Prosesserer Endringer..."})]}),o.jsx("div",{className:"flex-1 p-8 overflow-y-auto custom-scrollbar no-scrollbar",children:s==="ECONOMY"?c?o.jsx(c,{}):o.jsx("div",{className:"p-20 text-center animate-pulse text-slate-500 font-black uppercase tracking-widest",children:"Laster Blueprint..."}):s==="AI_LAB"?o.jsx(WZ,{roomData:e,pin:t}):o.jsxs("div",{className:"space-y-12 pb-20",children:[o.jsx(PJ,{players:e.players,onKick:l.kickPlayer,onLevelChange:l.handlePlayerLevelChange,onRoleChange:l.handleRoleChange,onRegionChange:l.handleRegionChange,onControl:l.controlPlayer,onGiveGold:l.onGiveGold,onGiveResource:l.onGiveResource,onGiveItem:l.onGiveItem}),((d=e.world)==null?void 0:d.settlement)&&o.jsxs("section",{className:"bg-indigo-900/10 border border-indigo-500/10 p-10 rounded-[3rem] relative overflow-hidden group",children:[o.jsxs("div",{className:"relative z-10",children:[o.jsxs("h2",{className:"text-3xl font-black text-white mb-8 tracking-tighter flex items-center justify-between",children:["Landsbyutvikling",o.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-indigo-400 bg-indigo-500/10 px-4 py-2 rounded-full",children:"Status Rapport"})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:Object.values(((f=(h=e.world)==null?void 0:h.settlement)==null?void 0:f.buildings)||{}).map(m=>{const b=Us[m.id],p=m.progress/(m.target||200)*100;return o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-end",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-black text-white uppercase",children:b==null?void 0:b.name}),o.jsxs("p",{className:"text-[10px] text-slate-500 font-bold tracking-tight",children:["Niv ",m.level]})]}),o.jsxs("span",{className:"text-xs font-mono text-indigo-500",children:[Object.values(m.progress||{}).reduce((v,x)=>v+x,0)," / ",m.target||200]})]}),o.jsxs("div",{className:"h-4 bg-black/40 rounded-full overflow-hidden border border-white/5 relative group/progress",children:[o.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-600 via-indigo-400 to-fuchsia-500 transition-all duration-1000 shadow-[0_0_15px_rgba(99,102,241,0.4)] relative",style:{width:`${p}%`},children:o.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover/progress:opacity-100 transition-opacity flex justify-between items-center px-1 pointer-events-none",children:[o.jsx("button",{onClick:v=>{v.stopPropagation(),a.handleBuildingLevelChange(m.id,-1)},className:"w-5 h-5 bg-white/10 hover:bg-rose-500 text-white rounded-full flex items-center justify-center text-[10px] font-black pointer-events-auto transition-all",children:"-"}),o.jsx("button",{onClick:v=>{v.stopPropagation(),a.handleBuildingLevelChange(m.id,1)},className:"w-5 h-5 bg-white/10 hover:bg-emerald-500 text-white rounded-full flex items-center justify-center text-[10px] font-black pointer-events-auto transition-all",children:"+"})]})]})]},m.id)})})]}),o.jsx("div",{className:"absolute top-[-20%] right-[-10%] text-[15rem] text-indigo-500 opacity-[0.03] pointer-events-none group-hover:rotate-6 transition-transform duration-[3000ms]",children:""})]})]})})]}),o.jsx(VJ,{roomData:e}),o.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 4px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: transparent;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.2);
                }
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
            `}})]})}),XZ="Enevelde",QZ=()=>{var U;const[t,e]=S.useState(""),[s,n]=S.useState([]),[i,r]=S.useState(!1),[a,l]=S.useState("LIST"),[c,u]=S.useState(()=>sessionStorage.getItem("admin_session")==="active"),{setFullWidth:d,setHideHeader:h}=HA(),{roomData:f,setRoomData:m,onlineCount:b}=j7(t),p=C=>C?Array.isArray(C)?C:Object.values(C).sort((j,$)=>j.timestamp-$.timestamp):[];S.useEffect(()=>(d(!0),h(!0),()=>{d(!1),h(!1)}),[d,h]),S.useEffect(()=>(t&&(a==="MANAGE"||a==="ECONOMY"||a==="AI_LAB")?document.title=`Host: ${t} | Eiriksbok`:document.title="Simuleringshallen | Eiriksbok",()=>{document.title="Eiriksbok"}),[t,a]),yR(t,(f==null?void 0:f.status)||"LOBBY",f==null?void 0:f.world,b),S.useEffect(()=>{if(!t||!(f!=null&&f.world)||f.status!=="PLAYING")return;const j=setInterval(async()=>{const $=f.world.sea_resources||{};if(Object.keys($).length<15){const z=Math.floor(Math.random()*2)+1,J={};for(let fe=0;fe<z;fe++){const me=`fish_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,ue=Math.floor(Math.random()*4e3),ne=Math.floor(Math.random()*4e3),Le=["COD","HERRING","SALMON","TUNA"],ft=Le[Math.floor(Math.random()*Le.length)];J[`simulation_rooms/${t}/world/sea_resources/${me}`]={id:me,x:ue,y:ne,type:ft,amount:Math.floor(Math.random()*5)+1,expiresAt:Date.now()+1e3*60*10}}const Y=Date.now();Object.values($).forEach(fe=>{fe.expiresAt<Y&&(J[`simulation_rooms/${t}/world/sea_resources/${fe.id}`]=null)}),Object.keys(J).length>0&&await ae(q(K),J)}},1e4);return()=>clearInterval(j)},[t,f==null?void 0:f.status,(U=f==null?void 0:f.world)==null?void 0:U.sea_resources]),S.useEffect(()=>{const C=q(K,"simulation_rooms"),j=Qe(C,$=>{const B=$.val();if(B){const D=Object.entries(B).map(([z,J])=>({...J,pin:J.pin||z}));n(D.reverse())}else n([])});return()=>j()},[]);const v=async()=>{const C=prompt("Hva skal riket hete? (La st tomt for automatisk navn)");if(C===null)return;r(!0);const j=Math.floor(1e3+Math.random()*9e3).toString(),$=C.trim()||`Rike #${j}`,B=i7(j,$);try{await pa(q(K,`simulation_rooms/${j}`),B),await Pm(j,B),e(j),l("MANAGE")}catch(D){console.error(D),alert("Kunne ikke opprette rom.")}finally{r(!1)}},[x,g]=S.useState(null),y=async C=>{if(window.confirm(`ER DU SIKKER? Dette vil slette rommet ${C} permanent!
Alle karakterer vil bli arkivert til spillernes Hall of Fame.`)){r(!0),g("Starter arkivering...");try{const j=await ve(q(K,`simulation_rooms/${C}`));if(j.exists()){const B=j.val().players||{},D=Object.values(B).filter(z=>z.uid);if(D.length>0){const{recordCharacterLife:z}=await xt(async()=>{const{recordCharacterLife:fe}=await Promise.resolve().then(()=>$Z);return{recordCharacterLife:fe}},void 0);g(`Arkiverer ${D.length} karakterer...`);const Y=(await Promise.allSettled(D.map(fe=>z(fe.uid,C,fe)))).filter(fe=>fe.status==="fulfilled").length;console.log(`Mass Archival Complete for ${C}: ${Y}/${D.length} archived.`)}}g("Fjerner rom-data..."),await yN(q(K,`simulation_rooms/${C}`)),await yN(q(K,`simulation_server_metadata/${C}`)),alert(`Slettet rom ${C}. Karakterer er arkivert.`)}catch(j){console.error(j),alert("Kunne ikke slette rommet.")}finally{r(!1),g(null)}}},w=async()=>{r(!0);try{const[C,j]=await Promise.all([ve(q(K,"simulation_server_metadata")),ve(q(K,"simulation_rooms"))]),$=C.val()||{},B=j.val()||{};let D=0;const z={};Object.keys($).forEach(J=>{B[J]||(z[`simulation_server_metadata/${J}`]=null,D++)}),D>0?(await ae(q(K),z),alert(`Ryddet opp ${D} dde serverkoblinger!`)):alert("Alt ser ryddig ut!")}catch(C){console.error(C)}finally{r(!1)}},k=async()=>{if(!(!f||!f.players)){r(!0);try{const C=t7(f.players),j={region_vest:{id:"region_vest",name:"Baroniet Vest",taxRate:10,defenseLevel:50,rulerName:"Ingen"},region_ost:{id:"region_ost",name:"Baroniet st",taxRate:10,defenseLevel:50,rulerName:"Ingen"}},$={...f.markets};$.capital||($.capital=JSON.parse(JSON.stringify(_t))),["region_vest","region_ost"].forEach(z=>{$[z]||($[z]=JSON.parse(JSON.stringify(_t)))}),Object.values(C).forEach(z=>{if(z.role==="BARON"){j[z.regionId]={...j[z.regionId],rulerName:z.name};const J=JSON.parse(JSON.stringify(_t));Object.keys(J).forEach(Y=>{J[Y].price=Math.floor(J[Y].price*(.8+Math.random()*.4)),J[Y].stock=Math.floor(J[Y].stock*(.8+Math.random()*.4))}),$[z.regionId]=J}});const B={};Object.values(C).forEach(z=>{B[z.id]={id:z.id,name:z.name,role:z.role,regionId:z.regionId,stats:{level:z.stats.level||1},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:z.lastActive}});const D={};D[`simulation_rooms/${t}/players`]=C,D[`simulation_rooms/${t}/public_profiles`]=B,D[`simulation_rooms/${t}/regions`]=j,D[`simulation_rooms/${t}/markets`]=$,D[`simulation_rooms/${t}/status`]="PLAYING",await ae(q(K),D),await Pm(t,{...f,status:"PLAYING"})}catch(C){console.error(C),alert("Klarte ikke starte.")}finally{r(!1)}}},N=async()=>{var C,j;if(f!=null&&f.players){r(!0);try{const $=((j=(C=f.world)==null?void 0:C.taxRateDetails)==null?void 0:j.kingTax)||20,{updatedPlayers:B,results:D}=s7(f.players,$);await ae(q(K,`simulation_rooms/${t}/players`),B),alert(`Suksess! ${D.length} bnder og baroner ble skattlagt.`)}catch($){console.error($)}finally{r(!1)}}},_=async()=>{var D,z;if(!f)return;const C=["Spring","Summer","Autumn","Winter"],$=(C.indexOf(((D=f.world)==null?void 0:D.season)||"Spring")+1)%C.length,B=C[$];r(!0);try{const J=((z=En[B])==null?void 0:z.label)||B,Y={id:`msg_${Date.now()}`,content:` rstiden har skiftet til ${J}!`,timestamp:Date.now(),type:"SEASON_CHANGE"},fe=[...p(f.messages),Y].slice(-50);await ae(q(K),{[`simulation_rooms/${t}/world/season`]:B,[`simulation_rooms/${t}/messages`]:fe})}catch(J){console.error(J)}finally{r(!1)}},T=async()=>{if(!f)return;const C=["Clear","Rain","Storm","Fog"],j=C.indexOf(f.world.weather||"Clear"),$=C[(j+1)%C.length];try{const B={Clear:"Klart",Rain:"Regn",Storm:"Storm",Fog:"Tke"},D={id:`msg_${Date.now()}`,content:` Vret har skiftet til ${B[$]||$}!`,timestamp:Date.now(),type:"WEATHER_CHANGE"},z=[...p(f.messages),D].slice(-50);await ae(q(K),{[`simulation_rooms/${t}/world/weather`]:$,[`simulation_rooms/${t}/messages`]:z})}catch(B){console.error(B)}},E=async()=>{if(!f)return;const{LAW_TEMPLATES:C}=await xt(async()=>{const{LAW_TEMPLATES:B}=await Promise.resolve().then(()=>zN);return{LAW_TEMPLATES:B}},void 0),j=C[Math.floor(Math.random()*C.length)],$={lawId:j.id,title:j.label,votes:{},expiresAt:Date.now()+6e4};try{const B={id:`msg_${Date.now()}`,content:` TINGET ER SATT! Det skal stemmes over loven: "${j.label}"!`,timestamp:Date.now(),type:"VOTE_START"},D=[...p(f.messages),B].slice(-50);await ae(q(K,`simulation_rooms/${t}`),{activeVote:$,messages:D}),setTimeout(()=>A(j.id),6e4)}catch(B){console.error(B)}},A=async C=>{var me;const j=await ve(q(K,`simulation_rooms/${t}/activeVote`));if(!j.exists())return;const $=j.val(),B=Object.values($.votes||{}),D=B.filter(ue=>ue==="YES").length,z=B.filter(ue=>ue==="NO").length;let J=((me=f==null?void 0:f.world)==null?void 0:me.activeLaws)||[],Y=D>z?` LOVEN ER VEDTATT! "${$.title}" er n gjeldende.`:` LOVEN BLE FORKASTET. "${$.title}" ble nedstemt.`;D>z&&(J=[...J,C]);const fe={id:`msg_${Date.now()}`,content:Y,timestamp:Date.now(),type:"VOTE_RESULT"};try{await ae(q(K,`simulation_rooms/${t}/world`),{activeLaws:J}),await ae(q(K,`simulation_rooms/${t}`),{activeVote:null,messages:[...p(f==null?void 0:f.messages),fe].slice(-50)})}catch(ue){console.error(ue)}},R=async()=>{if(!f)return;const{WORLD_EVENT_TEMPLATES:C}=await xt(async()=>{const{WORLD_EVENT_TEMPLATES:B}=await Promise.resolve().then(()=>zN);return{WORLD_EVENT_TEMPLATES:B}},void 0),j=C[Math.floor(Math.random()*C.length)],$=`event_${Date.now()}`;try{const B={id:`msg_${Date.now()}`,content:` HENDELSE: ${j.title}! Sjekk kartet!`,timestamp:Date.now(),type:"EVENT_SPAWN"},D=[...p(f.messages),B].slice(-50);await ae(q(K,`simulation_rooms/${t}/worldEvents`),{[$]:{...j,id:$,expiresAt:Date.now()+3e5}}),await ae(q(K,`simulation_rooms/${t}`),{messages:D})}catch(B){console.error(B)}},I=async C=>{r(!0);try{const j=`char_${Math.random().toString(36).substr(2,9)}`,$={id:j,name:C.name,role:C.role,regionId:C.role==="KING"?"capital":Math.random()>.5?"region_ost":"region_vest",resources:ms[C.role]||ms.PEASANT,status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:C.level,xp:0,reputation:10,contribution:0},skills:Rn[C.role]||Rn.PEASANT,lastActive:Date.now(),online:!0},B={};B[`simulation_rooms/${t}/players/${j}`]=$,B[`simulation_rooms/${t}/public_profiles/${j}`]={id:j,name:$.name,role:$.role,regionId:$.regionId,stats:{level:$.stats.level},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:$.lastActive},await ae(q(K),B)}catch(j){console.error(j)}finally{r(!1)}},V=async()=>{if(window.confirm("Er du sikker? Dette vil regenerere 'public_profiles'.")){r(!0);try{const C=await ve(q(K,`simulation_rooms/${t}`));if(!C.exists())return;const j=C.val(),$=j.players||{},B={};Object.entries($).forEach(([D,z])=>{var J,Y,fe,me;B[`simulation_rooms/${t}/public_profiles/${D}`]={id:D,uid:z.uid||null,name:z.name,role:z.role,regionId:z.regionId,stats:{level:((J=z.stats)==null?void 0:J.level)||1},status:{isJailed:((Y=z.status)==null?void 0:Y.isJailed)||!1,isFrozen:((fe=z.status)==null?void 0:fe.isFrozen)||!1,legitimacy:((me=z.status)==null?void 0:me.legitimacy)||100},online:!0,lastActive:z.lastActive||Date.now()}}),j.status||(B[`simulation_rooms/${t}/status`]="LOBBY"),await ae(q(K),B),alert("Data reparert!")}catch(C){console.error(C)}finally{r(!1)}}},H=async()=>{if(window.confirm("Er du sikker? Alt slettes.")){r(!0);try{const C={};C[`simulation_rooms/${t}/status`]="LOBBY",C[`simulation_rooms/${t}/worldEvents`]={},C[`simulation_rooms/${t}/messages`]=[],C[`simulation_rooms/${t}/market`]=_t,C[`simulation_rooms/${t}/markets`]={capital:_t},C[`simulation_rooms/${t}/regions`]={},C[`simulation_rooms/${t}/world/monumentProgress`]=0,C[`simulation_rooms/${t}/world/activeLaws`]=[],C[`simulation_rooms/${t}/world/settlement/buildings`]=Object.entries(Us).reduce((j,[$])=>({...j,[$]:{id:$,level:0,progress:{},target:200,contributions:{}}}),{}),Object.keys((f==null?void 0:f.players)||{}).forEach(j=>{C[`simulation_rooms/${t}/players/${j}/role`]="PEASANT",C[`simulation_rooms/${t}/players/${j}/regionId`]="capital",C[`simulation_rooms/${t}/players/${j}/resources`]=ms.PEASANT,C[`simulation_rooms/${t}/players/${j}/status`]={stamina:100,legitimacy:100,authority:50},C[`simulation_rooms/${t}/public_profiles/${j}/role`]="PEASANT",C[`simulation_rooms/${t}/public_profiles/${j}/regionId`]="capital",C[`simulation_rooms/${t}/public_profiles/${j}/stats/level`]=1}),await ae(q(K),C),m(j=>j?{...j,status:"LOBBY",messages:[]}:null),alert("Spillet er nullstilt!")}catch(C){console.error(C)}finally{r(!1)}}},[P,O]=S.useState(null);if(S.useEffect(()=>{xt(()=>import("./SimulationEconomyBlueprint-B3Xez8sN.js"),[]).then(C=>O(()=>C.SimulationEconomyBlueprint))},[]),!c)return o.jsx(MJ,{onAuth:()=>u(!0),adminPassword:XZ});if(a==="LIST")return o.jsx(DJ,{allRooms:s,isLoading:i,onCreateRoom:v,onDeleteRoom:y,onManageRoom:C=>{e(C),l("MANAGE")},onCleanupMetadata:w,archivingStatus:x});const L=async()=>{if(!t)return;r(!0);let C=[];try{const j=await ve(q(K,`simulation_archives/${t}/full_log`));j.exists()&&(C=Object.values(j.val()))}catch(j){console.warn("Archive fetch failed (likely permissions), falling back to live data.",j)}if(C.length===0&&(f!=null&&f.messages)&&(C=Array.isArray(f.messages)?f.messages:Object.values(f.messages),C.length>0&&console.log("Exported live data fallback.")),C.length===0){alert("Ingen data  eksportere (verken i arkiv eller live-feed)."),r(!1);return}try{const j=new Blob([JSON.stringify(C,null,2)],{type:"application/json"}),$=URL.createObjectURL(j),B=document.createElement("a");B.href=$,B.download=`simulation_log_${t}_${new Date().toISOString()}.json`,B.click(),URL.revokeObjectURL($)}catch(j){console.error("Blob creation failed:",j),alert("Kunne ikke generere fil.")}r(!1)};if(!f)return null;const M={onStartGame:k,onTogglePublic:()=>ae(q(K,`simulation_rooms/${t}`),{isPublic:!f.isPublic}),onRepairData:V,onResetGame:H,onNextSeason:_,onChangeWeather:T,onSpawnEvent:R,onStartTing:E,onExportLog:L,initializeSettlement:async()=>{r(!0),await ae(q(K,`simulation_rooms/${t}/world/settlement`),{buildings:Object.entries(Us).reduce((C,[j])=>({...C,[j]:{id:j,level:0,progress:{},target:200,contributions:{}}}),{})}),r(!1)},handleBuildingLevelChange:async(C,j)=>{var B,D,z;const $=(z=(D=(B=f.world)==null?void 0:B.settlement)==null?void 0:D.buildings)==null?void 0:z[C];$&&await ae(q(K,`simulation_rooms/${t}/world/settlement/buildings/${C}`),{level:Math.max(0,$.level+j),progress:{}})},onTaxationBase:N},F={onRegenStamina:async()=>{r(!0);const C={};Object.keys(f.players||{}).forEach(j=>{C[`simulation_rooms/${t}/players/${j}/status/stamina`]=100}),await ae(q(K),C),r(!1)},onResetUnrest:async()=>{r(!0);const C={};Object.keys(f.regions||{}).forEach(j=>{C[`simulation_rooms/${t}/regions/${j}/coup/bribeProgress`]=0,C[`simulation_rooms/${t}/regions/${j}/coup/contributions`]={}}),await ae(q(K),C),r(!1)},onKickAll:async()=>{window.confirm("Kast ut alle?")&&await ae(q(K),{[`simulation_rooms/${t}/players`]:{}})},onSpawnCharacter:I,kickPlayer:async(C,j)=>{window.confirm(`Kast ut ${j}?`)&&await ae(q(K),{[`simulation_rooms/${t}/players/${C}`]:null,[`simulation_rooms/${t}/public_profiles/${C}`]:null})},handlePlayerLevelChange:async(C,j)=>{await ae(q(K),{[`simulation_rooms/${t}/players/${C}/stats/level`]:j,[`simulation_rooms/${t}/public_profiles/${C}/stats/level`]:j})},handleRoleChange:async(C,j)=>{await ae(q(K),{[`simulation_rooms/${t}/players/${C}/role`]:j,[`simulation_rooms/${t}/public_profiles/${C}/role`]:j})},handleRegionChange:async(C,j)=>{await ae(q(K),{[`simulation_rooms/${t}/players/${C}/regionId`]:j,[`simulation_rooms/${t}/public_profiles/${C}/regionId`]:j})},controlPlayer:C=>window.open(`${window.location.origin}/Simulation_StandAlone_Pro/play/${t}?impersonate=${C}`,"_blank"),onGiveGold:(C,j)=>v7(t,C,j),onGiveResource:(C,j,$)=>_7(t,C,j,$),onGiveItem:(C,j,$)=>y7(t,C,j,$)};return o.jsx(YZ,{pin:t,roomData:f,view:a,setView:l,isLoading:i,onBack:()=>l("LIST"),worldActions:M,playerActions:F,SimulationEconomyBlueprint:P})};function JZ(t,e){const{user:s,authLoading:n}=Lo(),[i,r]=S.useState(null),[a,l]=S.useState(null),[c,u]=S.useState({}),[d,h]=S.useState("LOBBY"),[f,m]=S.useState(""),[b,p]=S.useState({}),[v,x]=S.useState({}),[g,y]=S.useState([]),[w,k]=S.useState(null),[N,_]=S.useState({}),[T,E]=S.useState({}),[A,R]=S.useState(!1),[I,V]=S.useState(!1),[H,P]=S.useState(!1),O=S.useRef(null),L=S.useRef(null);S.useEffect(()=>{if(n)return;const F=localStorage.getItem("sim_player_id");let U=e;if(U||(s!=null&&s.uid?U=s.uid:U=F),!U||!t)return;const C=`simulation_rooms/${t}`,j=q(K,`${C}/players/${U}`),$=Qe(j,ce=>{if(R(!0),ce.exists()){O.current&&(clearTimeout(O.current),O.current=null);const Se=ce.val();if(t==="TEST"&&Se.regionId==="unassigned"&&Se.role!=="KING"){const Bt=Math.random()>.5?"region_east":"region_west";ae(j,{regionId:Bt})}const St={...Se,id:U};r(St),L.current=St,V(!0)}else I?O.current||(O.current=setTimeout(()=>{P(!0),r(null),V(!1),L.current=null},5e3)):r(null)}),B=q(K,`${C}/world`),D=Qe(B,ce=>{const Se=ce.val();Se&&l(Se)}),z=q(K,`${C}/status`),J=Qe(z,ce=>{const Se=ce.val();Se&&h(Se||"LOBBY")}),Y=q(K,`${C}/name`),fe=Qe(Y,ce=>{m(ce.val()||"")}),me=q(K,`${C}/markets`),ue=Qe(me,ce=>{const Se=ce.val();Se&&p(Se)}),ne=q(K,`${C}/messages`),Le=Qe(ne,ce=>{const Se=ce.val();Se&&y(Se)}),ft=q(K,`${C}/activeVote`),se=Qe(ft,ce=>{k(ce.val())}),le=q(K,`${C}/diplomacy`),Pe=Qe(le,ce=>{_(ce.val()||{})}),_e=q(K,`${C}/trades`),Q=Qe(_e,ce=>{E(ce.val()||{})}),ie=q(K,`${C}/players`),G=Qe(ie,ce=>{const Se=ce.val()||{};u(Se)}),oe=q(K,`${C}/regions`),W=Qe(oe,ce=>{x(ce.val()||{})});return()=>{$(),D(),J(),fe(),ue(),Le(),se(),Pe(),G(),Q(),W()}},[t,e,s==null?void 0:s.uid,n,I]),S.useEffect(()=>{if(!i||!t)return;const F=q(K,`simulation_rooms/${t}/players/${i.id}`),U=q(K,`simulation_rooms/${t}/public_profiles/${i.id}`);vN(F).update({online:!1}),vN(U).update({online:!1});const C=setInterval(()=>{const j=Date.now();ae(F,{lastActive:j,online:!0}),ae(U,{lastActive:j,online:!0})},3e4);return ae(F,{lastActive:Date.now(),online:!0}),ae(U,{lastActive:Date.now(),online:!0}),()=>clearInterval(C)},[t,i==null?void 0:i.id]),S.useEffect(()=>{if(!t||!t.startsWith("v"))return;const F=localStorage.getItem("nexus_active_vessel");if(F)try{const U=JSON.parse(F);if(U.id===t){console.log("Nexus Vessel Detected. Injecting Mock Data...",U);const C={id:U.id,uid:(s==null?void 0:s.uid)||"nexus_user",name:U.name,role:U.role.toUpperCase(),regionId:"nexus_region",resources:{gold:U.gold,grain:100,flour:0,bread:5,wood:50,plank:0,iron_ore:0,iron_ingot:0,stone:0,swords:0,armor:0,favor:0,wool:0,cloth:0,honey:0,meat:0,glass:0,manpower:10,egg:0,omelette:0},stats:{xp:0,level:1,reputation:50,contribution:0},status:{hp:U.health,morale:100,stamina:100,legitimacy:100,authority:100,loyalty:100,isJailed:!1,isFrozen:!1},equipment:{},skills:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:1,xp:0,maxXp:100},COMBAT:{level:1,xp:0,maxXp:100},TRADING:{level:1,xp:0,maxXp:100},THEOLOGY:{level:1,xp:0,maxXp:100}},upgrades:[],lastActive:Date.now()};r(C),V(!0),R(!0),h("PLAYING"),l({year:1250,season:"Spring",weather:"Clear",gameTick:100,lastTickAt:Date.now(),taxRateDetails:{kingTax:10},settlement:{buildings:{}}})}}catch(U){console.error("Failed to parse Nexus vessel data",U)}},[t,s==null?void 0:s.uid]);const M=Object.values(c||{}).filter(F=>F.online&&Date.now()-(F.lastActive||0)<6e4).length;return yR(t,d,a,M),{player:i,world:a,players:c,roomStatus:d,roomName:f,markets:b,regions:v,messages:g,activeVote:w,diplomacy:N,trades:T,hasAttemptedPlayerLoad:A,hasActiveSession:I,isRetired:H,setIsRetired:P,setPlayer:r,lastValidPlayer:L.current}}function _O(t,e,s,n,i,r,a,l,c){const[u,d]=S.useState(null),[h,f]=S.useState(null);S.useEffect(()=>{if(u){const p=setTimeout(()=>{console.warn("[useSimulationActions] Self-Healing: Resetting stuck loading state:",u),d(null)},5e3);return()=>clearTimeout(p)}},[u]);const m=S.useCallback(()=>{f(null)},[]),b=S.useCallback(async p=>{var k;if(!t||!e||u)return;const v=typeof p=="string"?p:p.type,x=typeof p=="object"?p.method:null;if(["WORK","CHOP","CRAFT","DEFEND","EXPLORE","MINE","QUARRY","PATROL","FORAGE","REFINE","SMELT","BAKE","WEAVE","MIX","PLANT","HARVEST","GATHER_WOOL","HUNT","SAWMILL","MOUNT_HORSE","TRAVEL_START"].includes(v)&&!a&&!p.performance){const N=(s==null?void 0:s.season)||"Spring",_=(s==null?void 0:s.weather)||"Clear",T=(s==null?void 0:s.gameTick)||0,E=pO(e,p,N,_,T);if(!E.success){alert(`Du har ikke rd til dette: ${E.reason}`),f({success:!1,timestamp:Date.now(),message:`Kan ikke utfre: ${E.reason}`,utbytte:[],xp:[],durability:[]});return}let A=v;if(v==="REFINE"){const V=p.recipeId;(V==="iron_ingot"||V==="glass"||V==="smelt")&&(A="SMELT"),(V==="bread"||V==="pie"||V==="mead"||V==="bake")&&(A="BAKE"),(V==="cloth"||V==="weave")&&(A="WEAVE"),V==="plank"&&(A="SAWMILL"),["minor_stamina_potion","herbal_balm","focus_brew","strength_tincture","masters_draught","elixir_of_life"].includes(V)&&(A="MIX")}v==="CRAFT"&&p.subType==="omelette"&&(A="BAKE");const I=(e.activeProcesses||[]).find(V=>{var H;return(V.locationId===p.locationId||p.locationId&&((H=V.locationId)==null?void 0:H.startsWith(p.locationId)))&&V.readyAt<=Date.now()});if(!(v==="REFINE"&&p.recipeId==="flour"||v==="HARVEST"&&((I==null?void 0:I.type)==="MILL"||(I==null?void 0:I.type)==="CRAFT"))){n(A),x&&i(x),r(p),f(null);return}}const y=v==="EQUIP_ITEM"||v==="UNEQUIP_ITEM"||v==="CONSUME";p.performance&&!y&&(n(null),r(null),i(null)),y||d(v);const w=new Promise((N,_)=>{setTimeout(()=>_(new Error("Handlingen tok for lang tid (Timeout)")),3e4)});try{const N=await Promise.race([yO(t,e.id,p),w]);(!y||v==="CONSUME")&&(N.data?(f(N.data),l&&e&&xt(async()=>{const{checkEventAchievements:T}=await import("./achievementLogic-C0lNuDPY.js");return{checkEventAchievements:T}},[]).then(({checkEventAchievements:T})=>{var E,A;T(e.uid||e.id||"",e,l,"ACTION_COUNT",String(v),1,c),(v==="PLAY_DICE"||v==="PLAY_RESOURCE_GAME")&&((E=N.data)!=null&&E.isWin)&&(T(e.uid||e.id||"",e,l,"ACTION_COUNT","GAMBLE_WIN",1,c),(((A=N.data)==null?void 0:A.multiplier)||0)>=5&&T(e.uid||e.id||"",e,l,"MANUAL","GAMBLE_JACKPOT",1,c))})):N.success||f({success:!1,timestamp:Date.now(),message:`Handlingen feilet: ${((k=N.error)==null?void 0:k.message)||N.error||"Ukjent feil"}`,utbytte:[],xp:[],durability:[]}))}catch(N){console.error("Action Timeout/Error:",N),y||f({success:!1,timestamp:Date.now(),message:` ${N.message||"Ukjent feil"}`,utbytte:[],xp:[],durability:[]})}finally{y||d(null),n(null),r(null),i(null)}},[t,e,u,s,a,n,i,r]);return{actionLoading:u,actionResult:h,setActionResult:f,handleAction:b,handleClearActionResult:m,setActionLoading:d}}const Wi=({resource:t,amount:e,size:s="md",showLabel:n=!1,className:i=""})=>{const r=ze[t]||{label:t,icon:""},a={sm:"text-xl",md:"text-3xl",lg:"text-7xl"};return o.jsxs("div",{className:`flex items-center gap-2 ${i}`,title:r.label,children:[o.jsx("span",{className:`${a[s]}`,children:r.icon}),o.jsxs("div",{className:"flex flex-col leading-none",children:[n&&o.jsx("span",{className:"text-[10px] uppercase font-bold tracking-wider opacity-70 mb-0.5",children:r.label}),e!==void 0&&o.jsx("span",{className:`font-mono font-bold ${s==="lg"?"text-xl":"text-sm"}`,children:e.toLocaleString()})]})]})},gT=(t,e=800)=>{const[s,n]=S.useState(t),i=S.useRef(t);return S.useEffect(()=>{if(i.current===t)return;const r=i.current,a=t;let l=null;const c=u=>{l||(l=u);const d=Math.min((u-l)/e,1);n(r+(a-r)*d),d<1?requestAnimationFrame(c):i.current=t};requestAnimationFrame(c)},[t,e]),s},ZZ=({room:t,player:e,onAction:s})=>{var H,P,O,L,M,F,U,C,j,$,B;const{activeTab:n,setActiveTab:i,activeMinigame:r,showAchievement:a}=va(),{user:l}=Lo(),{playSfx:c}=j_(),[u,d]=S.useState(!1),h=S.useRef(0),f=S.useRef(null),m=()=>{i("INVENTORY"),c("ui_click.ogg"),h.current+=1;const D=h.current;console.log(`Debug Click: ${D} / 5`),f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{h.current=0,console.log("Debug Click Reset")},2e3),D>=5&&(l!=null&&l.uid)&&(console.log("TRIGGERING GULLFEBER!"),a("debug_master"),ae(q(K,`simulation_accounts/${l.uid}/unlockedAchievements`),{debug_master:Date.now()}).catch(z=>console.error(z)),h.current=0,f.current&&clearTimeout(f.current))},[b,p]=S.useState({tick:((H=t.world)==null?void 0:H.gameTick)||0,time:Date.now()});S.useEffect(()=>{var D,z;((D=t.world)==null?void 0:D.gameTick)!==b.tick&&p({tick:((z=t.world)==null?void 0:z.gameTick)||0,time:Date.now()})},[(P=t.world)==null?void 0:P.gameTick,b.tick]);const v=(O=t.regions)==null?void 0:O[e.regionId||"capital"],x=(((L=v==null?void 0:v.coup)==null?void 0:L.bribeProgress)||0)>0||!!(v!=null&&v.activeElection);S.useEffect(()=>{const D=z=>{if(z.target instanceof HTMLInputElement||z.target instanceof HTMLTextAreaElement||r)return;const J=z.key.toLowerCase(),Y={m:"MAP",l:"ACTIVITY",p:"PROFILE",i:"INVENTORY",f:"SKILLS",d:"DIPLOMACY",h:"HIERARCHY"};if(Y[J]){if(J==="d"&&e.role==="PEASANT")return;i(Y[J]),c("ui_click.ogg")}};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[i,e.role,c,r]);const[,g]=S.useState(0);S.useEffect(()=>{const D=setInterval(()=>g(z=>z+1),1e3);return()=>clearInterval(D)},[]);const y=e.status.stamina||0,w=e.status.hp||0,k=e.stats.xp||0,N=e.stats.level||1,_=Lm[N]||1e3,T=Math.min(100,k/_*100),E=gT(y),A=gT(w),R=[{id:"MAP",label:"Kart",icon:g1,short:"M"},{id:"ACTIVITY",label:"Live",icon:vd,short:"L"},{id:"INVENTORY",label:"Eiendeler",icon:oO,short:"I"},{id:"SKILLS",label:"Ferdigheter",icon:lO,short:"F"},...e.role!=="PEASANT"?[{id:"DIPLOMACY",label:"Diplomati",icon:vd,short:"D"}]:[],{id:"HIERARCHY",label:"Samfunn",icon:rO,short:"H"}],I=((M=t.world)==null?void 0:M.year)||1100,V=((U=En[(F=t.world)==null?void 0:F.season])==null?void 0:U.label)||((C=t.world)==null?void 0:C.season);return o.jsxs("header",{className:"flex-none h-14 md:h-16 border-b border-white/5 bg-slate-950/80 backdrop-blur-xl flex items-center justify-between px-4 md:px-6 z-50 relative shrink-0 transition-all",children:[o.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"text-2xl md:text-3xl font-black text-white tracking-tighter leading-none tabular-nums shadow-indigo-500/50 drop-shadow-lg",children:c7(b.tick,b.time)}),o.jsxs("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest hidden sm:inline",children:["R ",I]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-400 mt-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:((j=t.world)==null?void 0:j.season)==="Winter"?"text-blue-300 drop-shadow-[0_0_8px_rgba(147,197,253,0.5)]":"text-amber-400 drop-shadow-[0_0_8px_rgba(251,191,36,0.5)]",children:V}),o.jsx("span",{className:"text-slate-600",children:""}),o.jsx("span",{className:"",title:_a((($=t.world)==null?void 0:$.gameTick)||0)==="DAY"?"Dag":"Natt",children:_a(((B=t.world)==null?void 0:B.gameTick)||0)==="DAY"?" Dag":" Natt"})]}),x&&o.jsx("button",{onClick:()=>{i("POLITICS"),c("ui_click.ogg")},className:"flex items-center gap-2 bg-rose-600/20 border border-rose-500/50 px-2 py-0.5 rounded-full animate-pulse group hover:bg-rose-500 hover:text-white transition-all ml-2",title:"Uro i regionen! Klikk for  se politisk status.",children:o.jsx("span",{className:"text-[9px] font-black italic tracking-tighter",children:" URO"})})]})]}),o.jsx("nav",{className:"hidden md:flex items-center gap-1 bg-white/5 p-1 rounded-xl border border-white/5",children:R.map(D=>{const z=n===D.id,J=D.icon;return o.jsxs("button",{onClick:()=>{i(D.id),c("ui_click.ogg")},className:`
                                    relative px-3 py-1.5 md:py-2 rounded-lg flex items-center gap-2 transition-all group overflow-hidden
                                    ${z?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}
                                `,title:D.label,children:[o.jsx(J,{size:16,className:z?"animate-pulse":""}),o.jsx("span",{className:"hidden xl:block text-xs font-bold uppercase tracking-wider ",children:D.label}),D.short&&o.jsx("span",{className:`text-[9px] absolute top-0.5 right-1 font-mono font-bold transition-opacity hidden xl:block ${z?"text-indigo-300":"text-slate-700 group-hover:text-slate-500"}`,children:D.short})]},D.id)})})]}),o.jsxs("div",{className:"flex items-center gap-3 md:gap-5",children:[e.activeBuffs&&e.activeBuffs.length>0&&o.jsx("div",{className:"flex items-center gap-1 mr-1",children:e.activeBuffs.map(D=>o.jsx(eee,{buff:D},D.id))}),o.jsxs("div",{className:"hidden md:flex items-center bg-slate-900/50 rounded-full border border-white/5 overflow-hidden transition-all duration-300",children:[o.jsxs("button",{onClick:m,className:"flex items-center gap-2 hover:bg-white/5 px-3 py-1.5 transition-colors cursor-pointer group active:scale-95",title:"pne Eiendeler (I)",children:[o.jsx(Wi,{resource:"gold",amount:e.resources.gold,size:"sm"}),o.jsx("span",{className:"hidden xl:inline text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-slate-300 transition-colors ml-1",children:"Gull"})]}),o.jsx("div",{className:"w-px h-3 bg-white/10"}),o.jsxs("button",{onClick:()=>{e.resources.bread?(s==null||s({type:"CONSUME",itemId:"bread",isResource:!0}),c("eat.ogg")):(i("INVENTORY"),c("ui_click.ogg"))},disabled:!e.resources.bread,className:`flex items-center gap-2 px-3 py-1.5 transition-all cursor-pointer group border-l border-white/0 active:scale-95 ${e.resources.bread?"hover:bg-emerald-500/10 hover:border-emerald-500/20":"opacity-40 cursor-not-allowed"}`,title:e.resources.bread?"Spis Brd (+20 Stamina)":"Tomt for brd",children:[o.jsx(Wi,{resource:"bread",amount:e.resources.bread||0,size:"sm"}),o.jsx("div",{className:"hidden xl:flex flex-col items-start -space-y-1",children:o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest transition-colors ${e.resources.bread?"text-slate-500 group-hover:text-emerald-400":"text-slate-600"}`,children:e.resources.bread?"Spis":"Tom"})})]})]}),o.jsxs("div",{className:"flex flex-col gap-1 w-20 md:w-24",children:[o.jsxs("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden relative group",children:[o.jsx(Z.div,{className:"absolute inset-y-0 left-0 bg-rose-500 rounded-full",initial:{width:0},animate:{width:`${A}%`}}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 flex items-center justify-center text-[8px] font-black text-white bg-black/50 transition-opacity",children:["HP ",Math.round(A),"%"]})]}),o.jsxs("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden relative group",children:[o.jsx(Z.div,{className:"absolute inset-y-0 left-0 bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.5)]",initial:{width:0},animate:{width:`${E}%`}}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 flex items-center justify-center text-[8px] font-black text-black bg-white/50 transition-opacity",children:["STA ",Math.round(E),"%"]})]}),o.jsx("div",{className:"h-0.5 bg-slate-800/50 rounded-full overflow-hidden relative group mt-0.5",children:o.jsx(Z.div,{className:"absolute inset-y-0 left-0 bg-indigo-500",initial:{width:0},animate:{width:`${T}%`}})})]}),o.jsxs("button",{onClick:()=>{i("PROFILE"),c("ui_click.ogg")},className:"group flex items-center gap-3 bg-white/0 hover:bg-white/5 pl-2 pr-1 py-1 rounded-2xl border border-transparent hover:border-white/10 transition-all active:scale-95",title:"Min Karakter (P)",children:[o.jsx("div",{className:"hidden 2xl:flex flex-col items-end",children:o.jsx("span",{className:"text-sm font-black italic tracking-tighter text-white leading-none",children:e.name})}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 p-0.5 shadow-lg overflow-hidden group-hover:shadow-indigo-500/20",children:e.avatar?o.jsx("img",{src:e.avatar,alt:"Profile",className:"w-full h-full object-cover rounded-[6px]"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-900 rounded-[6px] text-base",children:e.role==="KING"?"":""})}),o.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-slate-900 rounded-full flex items-center justify-center border border-white/10 text-[8px] font-black text-white z-10",children:N})]})]}),o.jsx(xT,{icon:ZQ,onClick:()=>i("SETTINGS"),title:"Innstillinger"}),e.role==="MERCHANT"&&o.jsx(xT,{icon:vJ,onClick:()=>s==null?void 0:s({type:"OPEN_CARAVAN"}),title:"Karavane",className:"text-amber-400 border border-amber-400/20 bg-amber-100/5 hover:bg-amber-400/20"}),o.jsx("button",{className:"md:hidden text-white p-2",onClick:()=>d(!u),children:u?o.jsx(In,{}):o.jsx(RQ,{})})]}),o.jsx(Dt,{children:u&&o.jsxs(Z.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-16 left-0 right-0 bg-slate-900 border-b border-white/10 p-4 shadow-2xl md:hidden flex flex-col gap-2 z-40",children:[R.map(D=>o.jsxs("button",{onClick:()=>{i(D.id),d(!1)},className:`w-full p-4 rounded-xl text-left font-black uppercase flex items-center gap-4 ${n===D.id?"bg-indigo-600 text-white":"bg-white/5 text-slate-400"}`,children:[o.jsx(D.icon,{size:20}),D.label]},D.id)),o.jsx("div",{className:"h-px bg-white/5 my-2"}),o.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 font-bold uppercase tracking-widest px-2",children:[o.jsxs("span",{children:["r ",I]}),o.jsx("span",{children:V})]})]})})]})},xT=({icon:t,onClick:e,title:s,className:n})=>o.jsx("button",{onClick:e,title:s,className:`hidden md:flex p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all ${n}`,children:o.jsx(t,{size:20})}),eee=({buff:t})=>{const[e,s]=S.useState(Math.max(0,Math.ceil((t.expiresAt-Date.now())/6e4)));return S.useEffect(()=>{const n=setInterval(()=>{const i=Math.max(0,Math.ceil((t.expiresAt-Date.now())/6e4));s(i)},1e4);return()=>clearInterval(n)},[t.expiresAt]),Date.now()>t.expiresAt?null:o.jsxs("div",{className:"group relative flex items-center justify-center w-8 h-8 rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 cursor-help",children:[o.jsx("span",{className:"text-lg",children:""}),o.jsxs("span",{className:"absolute -bottom-1 -right-1 text-[8px] font-black bg-slate-900 px-1 rounded-full border border-white/10",children:[e,"m"]}),o.jsxs("div",{className:"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-slate-900 p-2 rounded-lg border border-white/10 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none w-32 text-center z-50",children:[o.jsx("p",{className:"text-[10px] font-bold text-white mb-0.5",children:t.label}),o.jsxs("p",{className:"text-[9px] text-emerald-400",children:[t.value*100,"% mindre stamina"]})]})]})},y1=Ne.memo(({src:t,placeholderSrc:e,alt:s,className:n,imgClassName:i="object-cover w-full h-full",priority:r=!1,disableMotion:a=!1})=>{const[l,c]=S.useState(!1),[u,d]=S.useState(e||t);return S.useEffect(()=>{c(!1),e&&d(e);const h=new Image;h.src=t,h.onload=()=>{d(t),c(!0)}},[t,e]),o.jsx("div",{className:`relative overflow-hidden ${n}`,children:o.jsx(Z.img,{src:u,alt:s,loading:r?"eager":"lazy",className:`${i} transition-all duration-700 ease-in-out`,initial:{filter:"blur(20px)",scale:a?1:1.1},animate:{filter:l?"blur(0px)":"blur(20px)",scale:a||l?1:1.1},style:{willChange:"filter, transform"}},t)})});y1.displayName="ProgressiveImage";const Gr=[{id:"fields",label:"krene",icon:"",top:"22%",left:"42%",vest:{top:"35%",left:"70%"},ost:{top:"35%",left:"45%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"forest",label:"Skogen",icon:"",top:"25%",left:"80%",vest:{top:"15%",left:"60%"},ost:{top:"27%",left:"14%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"castle",label:"Slottet",icon:"",top:"66%",left:"86%",vest:{top:"40%",left:"30%"},ost:{top:"40%",left:"68%"},roles:["PEASANT","BARON","KING","SOLDIER"],actions:[{id:"OPEN_CONSTRUCTION",label:"Bidra til bygging",cost:"Ressurser"},{id:"OPEN_TAXATION",label:"Skattekammeret",cost:"Baron Only",roleReq:"BARON"}],isHub:!0},{id:"peasant_farm",label:"Husmannsplassen",icon:"",top:"30%",left:"60%",vest:{top:"85%",left:"72%"},ost:{top:"75%",left:"30%"},roles:["PEASANT","BARON"],actions:[],isHub:!0},{id:"market",label:"Markedet",icon:"",top:"70%",left:"25%",vest:{top:"70%",left:"37%"},ost:{top:"70%",left:"63%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[{id:"MARKET_VIEW",label:"pne Handel",cost:"Gratis"},{id:"JOIN_ROLE",label:"Bli Kjpmann",cost:"500g + Niv 3",targetRole:"MERCHANT"}]},{id:"village",label:"Landsbyen",icon:"",top:"42%",left:"42%",vest:{top:"50%",left:"52%"},ost:{top:"55%",left:"44%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"mine",label:"Gruve-distriktet",icon:"",top:"12%",left:"25%",vest:{top:"13%",left:"39%"},ost:{top:"20%",left:"60%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"monastery",label:"Klosteret",icon:"",top:"16%",left:"55%",vest:{top:"50%",left:"78%"},ost:{top:"50%",left:"27%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"border",label:"Grensen",icon:"",top:"85%",left:"80%",vest:{top:"15%",left:"10%"},ost:{top:"15%",left:"10%"},roles:["BARON"],actions:[{id:"RAID",label:"Plyndre Nabo",cost:"-40"}]},{id:"dock",label:"Kaien",icon:"",top:"90%",left:"50%",vest:{top:"90%",left:"40%"},ost:{top:"90%",left:"60%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"flax_field",label:"Lin-keren",icon:"",roles:["PEASANT"],parentId:"fields",top:"70%",left:"40%",actions:[{id:"PLANT",label:"S Lin",cost:"-10 lin -30",cropId:"flax"}]},{id:"throne_room",label:"Tronsalen",icon:"",top:"40%",left:"50%",roles:["KING"],parentId:"castle",actions:[{id:"DECREE",label:"Utsted Dekret",cost:"King Only"}]},{id:"treasury",label:"Skattekammeret",icon:"",top:"55%",left:"65%",roles:["BARON","KING"],parentId:"castle",actions:[{id:"OPEN_TAXATION",label:"pne Skattekammeret",cost:"Administrasjon"}]},{id:"barracks",label:"Kasernen",icon:"",top:"60%",left:"30%",roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"DRAFT",label:"Verve Soldater",cost:"-5g -10"},{id:"JOIN_ROLE",label:"Bli Soldat",cost:"200g + Niv 3",targetRole:"SOLDIER"}]},{id:"royal_chambers",label:"Kongens Kammer",icon:"",top:"30%",left:"70%",roles:["BARON","KING"],parentId:"castle",actions:[{id:"REST",label:"Hvile i Kammeret",cost:"Full rest + Velvre"}]},{id:"castle_construction",label:"Byggeplass",icon:"",top:"75%",left:"80%",roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"OPEN_CONSTRUCTION",label:"Bidra til bygging",cost:"Ressurser"}]},{id:"war_room",label:"Krigsrommet",icon:"",top:"25%",left:"35%",roles:["BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"OPEN_WAR_ROOM",label:"pne Krigsrommet",cost:"Gratis"}]},{id:"village_square",label:"Landsbytorg",icon:"",top:"50%",left:"50%",village:{top:"48%",left:"50%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"village",actions:[{id:"REST",label:"Hvile p torget",cost:"+10"}]},{id:"tavern",label:"Vertshuset",icon:"",top:"35%",left:"75%",village:{top:"75%",left:"80%"},roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"village",actions:[{id:"ENTER_TAVERN",label:"G inn",cost:"Gratis"},{id:"REST_BASIC",label:"Hvile i Salen",cost:"Gratis"},{id:"REST_COMFY",label:"Bestille Kammer",cost:"-5g"},{id:"REST_ROYAL",label:"Kongelig Suite",cost:"-20g"}],isHub:!0,isInterior:!0},{id:"bakery",label:"Bakeri",icon:"",top:"80%",left:"30%",village:{top:"38%",left:"35%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"great_forge",label:"Storsmie",icon:"",top:"35%",left:"15%",village:{top:"48%",left:"23%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"windmill",label:"Vindmlle",icon:"",top:"20%",left:"37%",village:{top:"25%",left:"17%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_flour",label:"Male Mel",cost:"-15 -10korn"}],isHub:!0,isInterior:!0},{id:"smeltery",label:"Smeltehytte",icon:"",top:"60%",left:"95%",village:{top:"75%",left:"12%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_IRON_BASIC",label:"Smelte Jern",cost:"-20 -5malm"},{id:"REFINE_IRON_FAST",label:"Industri-smelting",cost:"-30 -10malm"},{id:"REFINE_STEEL",label:"Smelte Stl",cost:"-50 -20malm"}],isHub:!0,isInterior:!0},{id:"sawmill",label:"Sagbruk",icon:"",top:"55%",left:"15%",village:{top:"70%",left:"45%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_PLANK_BASIC",label:"Sag Planker",cost:"-10 -5ved"},{id:"REFINE_PLANK_FAST",label:"Hurtig-saging",cost:"-15 -5ved"}],isHub:!0,isInterior:!0},{id:"weavery",label:"Veveri",icon:"",top:"50%",left:"85%",village:{top:"45%",left:"65%"},roles:["PEASANT","BARON","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"watchtower",label:"Vaktrn",icon:"",top:"15%",left:"68%",village:{top:"25%",left:"82%"},roles:["BARON","SOLDIER","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"stables",label:"Stall",icon:"",top:"80%",left:"80%",village:{top:"45%",left:"90%"},roles:["PEASANT","BARON","SOLDIER","KING","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"well",label:"Bybrnn",icon:"",top:"69%",left:"60%",village:{top:"48%",left:"50%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0},{id:"apothecary",label:"Apoteker",icon:"",top:"20%",left:"82%",village:{top:"60%",left:"92%"},roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"forge_anvil",label:"Ambolt",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"great_forge",actions:[{id:"OPEN_CRAFTING",label:"pne Smia",cost:"Gratis"}]},{id:"forge_upgrades",label:"Tegneark",icon:"",top:"40%",left:"75%",roles:["PEASANT","BARON","KING"],parentId:"great_forge",actions:[{id:"BUILDING_UPGRADE_great_forge",label:"Oppgrader Smia",cost:"Varierer"}]},{id:"bakery_oven",label:"Bakerovn",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING"],parentId:"bakery",actions:[{id:"REFINE",label:"pne Bakeriet",cost:"Gratis"}]},{id:"bakery_upgrades",label:"Tegneark",icon:"",top:"30%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"bakery",actions:[{id:"BUILDING_UPGRADE_bakery",label:"Oppgrader Bakeriet",cost:"Varierer"}]},{id:"windmill_stones",label:"Kvernsteiner",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"windmill",actions:[{id:"REFINE",label:"pne Mlla",cost:"Gratis"}]},{id:"windmill_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"windmill",actions:[{id:"BUILDING_UPGRADE_windmill",label:"Oppgrader Mlla",cost:"Varierer"}]},{id:"sawmill_blade",label:"Saga",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"sawmill",actions:[{id:"REFINE",label:"pne Sagbruket",cost:"Gratis"}]},{id:"sawmill_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"sawmill",actions:[{id:"BUILDING_UPGRADE_sawmill",label:"Oppgrader Sagbruket",cost:"Varierer"}]},{id:"smeltery_furnace",label:"Smelteovn",icon:"",top:"50%",left:"30%",roles:["PEASANT","BARON","KING"],parentId:"smeltery",actions:[{id:"REFINE",label:"pne Smeltehytta",cost:"Gratis"}]},{id:"smeltery_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"smeltery",actions:[{id:"BUILDING_UPGRADE_smeltery",label:"Oppgrader Smeltehytta",cost:"Varierer"}]},{id:"weavery_loom",label:"Vevstol",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","MERCHANT"],parentId:"weavery",actions:[{id:"REFINE",label:"pne Veveriet",cost:"Gratis"}]},{id:"weavery_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON"],parentId:"weavery",actions:[{id:"BUILDING_UPGRADE_weavery",label:"Oppgrader Veveriet",cost:"Varierer"}]},{id:"stables_stall",label:"Stallplass",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","SOLDIER","KING","MERCHANT"],parentId:"stables",actions:[{id:"MOUNT_HORSE",label:"Ri ut",cost:"-5"}]},{id:"stables_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"stables",actions:[{id:"BUILDING_UPGRADE_stables",label:"Oppgrader Stallen",cost:"Varierer"}]},{id:"watchtower_top",label:"Vaktpost",icon:"",top:"30%",left:"50%",roles:["PEASANT","BARON","SOLDIER"],parentId:"watchtower",actions:[{id:"OPEN_GARRISON",label:"pne Garnisonen",cost:"Gratis"},{id:"PATROL",label:"Patruljer",cost:"-30"}]},{id:"watchtower_upgrades",label:"Tegneark",icon:"",top:"50%",left:"80%",roles:["BARON"],parentId:"watchtower",actions:[{id:"BUILDING_UPGRADE_watchtower",label:"Oppgrader Trnet",cost:"Varierer"}]},{id:"apothecary_bench",label:"Arbeidsbenk",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"apothecary",actions:[{id:"OPEN_CRAFTING",label:"pne Apoteket",cost:"Gratis"}]},{id:"apothecary_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"apothecary",actions:[{id:"BUILDING_UPGRADE_apothecary",label:"Oppgrader Apoteket",cost:"Varierer"}]},{id:"well_water",label:"Brnnkum",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING"],parentId:"well",actions:[{id:"GATHER_WATER",label:"Hent Vann",cost:"-10"}]},{id:"well_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"well",actions:[{id:"BUILDING_UPGRADE_well",label:"Oppgrader Brnnen",cost:"Varierer"}]},{id:"tavern_bar",label:"Baren",icon:"",top:"30%",left:"30%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_TAVERN_MENU",label:"Se Menykart",cost:"Gratis"}]},{id:"tavern_gambling",label:"Spillebordet",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_DICE_GAME",label:"Spill Terninger",cost:"Min. 0.5g"}]},{id:"tavern_resource_wheel",label:"Soga-hjulet",icon:"",top:"65%",left:"75%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_RESOURCE_GAME",label:"Sats Ressurser",cost:"Varer"}]},{id:"tavern_gossip",label:"Lokalbefolkningen",icon:"",top:"40%",left:"70%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"CHAT_LOCAL",label:"Snakk med folk",cost:"Gratis"}]},{id:"tavern_upgrades",label:"Tegneark",icon:"",top:"25%",left:"85%",roles:["PEASANT","BARON","KING"],parentId:"tavern",actions:[{id:"BUILDING_UPGRADE_tavern",label:"Oppgrader Vertshuset",cost:"Varierer"}]},{id:"grain_fields",label:"Kornker",icon:"",top:"50%",left:"20%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"PLANT",label:"S Korn",cost:"-5 korn -25"}]},{id:"sheep_pasture",label:"Sauebeite",icon:"",top:"35%",left:"65%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"GATHER_WOOL",label:"Klipp Sauer",cost:"-15"}]},{id:"beehives",label:"Bikuber",icon:"",top:"75%",left:"70%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"GATHER_HONEY",label:"Samle Honning",cost:"-20"}]},{id:"mine_shaft",label:"Jern-gruva",icon:"",top:"50%",left:"12%",roles:["PEASANT","BARON","KING"],parentId:"mine",actions:[{id:"MINE",label:"Bryte Malm",cost:"-25 -1"}]},{id:"quarry_poi",label:"Steinhuggeriet",icon:"",top:"40%",left:"85%",roles:["PEASANT","BARON","KING"],parentId:"mine",actions:[{id:"QUARRY",label:"Hugge Stein",cost:"-20 -1"}]},{id:"forest_clearing",label:"Hogstfeltet",icon:"",top:"60%",left:"30%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"CHOP",label:"Hugge Ved",cost:"-15 -1"}]},{id:"hunting_grounds",label:"Jaktmarker",icon:"",top:"30%",left:"75%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"HUNT",label:"Dra p Jakt",cost:"-30"}]},{id:"forest_forage",label:"Brplukking",icon:"",top:"60%",left:"90%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"FORAGE",label:"Sanke Mat (Nd)",cost:"-40"}]},{id:"monastery_chapel",label:"Klosterkirken",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"monastery",actions:[{id:"PRAY",label:"Be en Bnn",cost:"-15"}]},{id:"farm_house",label:"Inne i Stugo",icon:"",top:"52%",left:"58%",roles:["PEASANT"],parentId:"peasant_farm",actions:[],isHub:!0,isInterior:!0},{id:"stugo_bed",label:"Senga",icon:"",top:"65%",left:"42%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"SLEEP",label:"Sove tungt",cost:"Full "}]},{id:"stugo_fireplace",label:"Peisen",icon:"",top:"55%",left:"80%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"EAT",label:"Sitte ved varmen",cost:"-1 +40"}]},{id:"farm_well",label:"Brnnen",icon:"",top:"60%",left:"27%",roles:["PEASANT"],parentId:"peasant_farm",actions:[{id:"REST",label:"Drikke vann",cost:"+5"}]},{id:"farm_upgrade_spot",label:"Tegneark",icon:"",top:"40%",left:"15%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"BUILDING_UPGRADE_farm_house",label:"Bygg ut grden",cost:"Varierer"}]},{id:"chicken_coop",label:"Hnsehus",icon:"",top:"40%",left:"75%",roles:["PEASANT"],parentId:"peasant_farm",actions:[{id:"OPEN_CHICKEN_COOP",label:"G inn til hnene",cost:"Gratis"}]},{id:"dock_view",label:"Horisonten",icon:"",top:"30%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"dock",actions:[{id:"START_SAILING",label:"Sette seil",cost:"Bt kreves"}]},{id:"shipyard",label:"Skipsverftet",icon:"",top:"60%",left:"25%",roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"dock",actions:[{id:"OPEN_SHIPYARD",label:"pne Verftet",cost:"Bygg bt"}],isHub:!0,isInterior:!0},{id:"dock_administration",label:"Havnefuten",icon:"",top:"40%",left:"75%",roles:["BARON","KING","MERCHANT"],parentId:"dock",actions:[{id:"OPEN_WHARF_UPGRADE",label:"Oppgrader Kaien",cost:"Globalt prosjekt"}]}],bT=[{id:"pilegrim",name:"Sigurd Pilegrim",role:"Vandrer mot Nidaros",description:"Han sitter masserer sine sre ftter. En bredbremmet hatt med et kamskjell ligger p bordet, og vandringsstaven er slitt glatt av tusenvis av grep.",conversation:{start:{text:"Fred vre med deg, reisende. Kjenner du veien nordover? Mine ftter verker som om jeg har gtt p gldende kull, men sjelen... sjelen trekkes mot Hellig Olavs by.",options:[{label:"Hvorfor denne lange reisen?",nextId:"why"},{label:"Er det farlig langs veien?",nextId:"danger"},{label:"Fortell om kamskjellet.",nextId:"shell"},{label:"Lykke til videre. (G)",nextId:"EXIT"}]},why:{text:"For bot og bedring! Vi brer alle synder, min venn. Men i Nidaros, ved kongens skrin, er himmelen nrmere jorden. Det sies at en pilegrimsferd kan korte ned tiden i skjrsilden med mange r.",options:[{label:"Tror du virkelig p det?",nextId:"believe"},{label:"Hva hper du  finne?",nextId:"hope"}]},believe:{text:"Jeg *m* tro. Jeg har sett halte kaste krykkene og blinde f synet tilbake ved katedralen. Olavs kraft er sterk, selv om han har vrt dd i hundrevis av r. Han er Norges evige konge.",options:[{label:"Fortell om Olav.",nextId:"olav"}]},hope:{text:"Tilgivelse. Og kanskje litt sjelefred. Livet er hardt, vinteren er lang.  vite at man har gjort denne ofringen... det gir styrke.",options:[{label:"Forstelig.",nextId:"start"}]},danger:{text:" ja! Dovrefjell er ndelst. Snstormer kan komme midt p sommeren. Og i dalene lurer landeveisrvere som ser p oss pilegrimer som vandrende pengesekker. Men vi reiser ofte i flokk for beskyttelse.",options:[{label:"Har du blitt ranet?",nextId:"robbed"},{label:"Hvor sover dere?",nextId:"sjelehus"}]},robbed:{text:"Nesten. En gang, nr Gudbrandsdalen, s vi skygger i skogen. Vi sang salmer s hyt vi kunne, og drev dem bort med troens styrke! ...og kanskje fordi vi var frti stykker.",options:[{label:"God taktikk.",nextId:"danger"}]},sjelehus:{text:"Det finnes sjelehus  herberger bygget for Guds skyld  langs ruten. Der fr vi tak over hodet og enkel mat. Ofte deler vi rom med dyrene for varmen.",options:[{label:"Hres... koselig ut.",nextId:"danger"}]},shell:{text:"Ah, Ib-skjellet! Symbolet p St. Jakob. Dette viser at jeg har vandret helt til Santiago de Compostela i Spania. Jeg har sett verden, min venn. Fra nordlyset her til de solbrente slettene i sr.",options:[{label:"Du er en bereist mann.",nextId:"start"}]},olav:{text:"Han falt p Stiklestad i 1030. De sier at da de gravde ham opp et r senere, var kroppen like frisk, og hret og neglene hadde vokst! Det var beviset. Han kristnet oss med sverd, men reddet oss med sin hellighet.",options:[{label:"En mektig legende.",nextId:"start"}]}}},{id:"hansa",name:"Gerhard fra Lbeck",role:"Hansa-kjpmann",description:"Kledd i kostbar ull og pels. Han studerer en lang regnskapsrull med rynket panne og nipper til en vin som ser langt bedre ut enn husets vanlige.",conversation:{start:{text:"*Mumler p tysk* ...zwei schock, drei stck... Ah! En lokal? Si meg, har fiskerne i nord ftt opp farten? Mine skip venter i Bergen. Tid er penger, som vi sier i Lbeck.",options:[{label:"Hvem er du?",nextId:"intro"},{label:"Hvorfor er trrfisken s viktig?",nextId:"stockfish"},{label:"Hva er Hansaen egentlig?",nextId:"hansa_deep"},{label:"Jeg lar deg arbeide. (G)",nextId:"EXIT"}]},intro:{text:"Gerhard, handelsmann av Det Tyske Hanseforbund. Vi srger for at dere fr korn og mel, og at dere fr solgt den... vel, illeluktende fisken deres. En god byttehandel, *nicht wahr*?",options:[{label:"Vi klarer oss vel selv?",nextId:"monitor"},{label:"Takk for kornet.",nextId:"grain"}]},grain:{text:"Ja, det burde dere. Uten vrt baltiske korn ville mange nordmenn sultet nr avlingene svikter. Vi binder Nord-Europa sammen med vre kogger.",options:[{label:"Kogger?",nextId:"cog"}]},monitor:{text:"Haha! Tror du det? Uten oss ville fisken deres rtnet p stranden. Vi har nettverket. Vi har markedene i sr  katolikkene trenger fisk til fasten, og vi leverer.",options:[{label:"Dere tar stor fortjeneste.",nextId:"monopoly"}]},monopoly:{text:"Risiko koster! Stormer, pirater, kriger. Vi tar risikoen, vi tar profitten. Og vi har Kongens velsignelse... og privilegier. Vi dmmer vre egne p Bryggen.",options:[{label:"Egne lover?",nextId:"laws"}]},laws:{text:"Ja. En hanseat dmmes etter hansas lov, ikke norsk lov. Det... skaper litt friksjon med byborgerne, innrmmer jeg. Men handelen m flyte!",options:[{label:"Hres urettferdig ut.",nextId:"start"}]},stockfish:{text:'Det er "Det hvite gullet"! Trket i den kalde norske vinden blir den hard som tre og holder i revis. Perfekt mat for soldater og munker i hele Europa. Vi bytter det mot korn, klr, vin og krydder.',options:[{label:"En viktig ressurs.",nextId:"start"}]},hansa_deep:{text:"Et brorskap av handelsbyer. Lbeck, Hamburg, Rostock, Visby... og vrt kontor i Bergen. Vi beskytter hverandre mot konger som vil skattlegge oss for hardt, og mot sjrvere. Sammen er vi sterkere enn noe kongerike.",options:[{label:"Morsomt at du nevner pirater...",nextId:"pirates"},{label:"Imponerende.",nextId:"start"}]},pirates:{text:"Vitaliebrdrene... en plage! De herjer i stersjen. Men Hansaen har sine egne skip. Vi kan bite fra oss. Ikke tro at en kjpmann ikke kan svinge et sverd.",options:[{label:"Notert.",nextId:"EXIT"}]},cog:{text:"Vre skip. Brede, hye, med plass til enorme mengder last. De er ikke raske som vikingenes langskip, men de bygget vr rikdom. Ett skip kan f hele Bergen med korn.",options:[{label:"Teknologi er makt.",nextId:"start"}]}}},{id:"leilending",name:"Tormod",role:"Sliten Leilending",description:"Hendene hans er grove som bark, og ryggen er byd av r med plying. Han drikker tynt l og ser tankefullt ned i kruset.",conversation:{start:{text:"Enda en hst, enda en landskyld  betale. Livet til en leilending er  s for andre og hste smuler selv. Skl for det.",options:[{label:"Hva er landskyld?",nextId:"rent"},{label:"Hvorfor eier du ikke jorda?",nextId:"own"},{label:"Hvordan var det fr?",nextId:"plague"},{label:"Gr det s drlig? (G)",nextId:"EXIT"}]},rent:{text:"Leieavgiften. Jeg driver grden, men Kirken eier grunnen. Hvert r m jeg gi dem en fjerdedel av kornet, tre skippund smr og to kyr. Det som er igjen... det skal f familien min gjennom vinteren.",options:[{label:"Hva hvis avlingen svikter?",nextId:"fail"},{label:"Hvem bestemmer prisen?",nextId:"laws"}]},fail:{text:"Da sulter vi. Eller vi m lne skorn av jordeieren, og da havner vi dypere i gjeld. Det er en sirkel det er vanskelig  bryte.",options:[{label:"Trist skjebne.",nextId:"start"}]},own:{text:"F bnder eier sin egen jord n. Adelen og Kirken har kjpt opp nesten alt. Men jeg har i det minste *bygslebrev*. S lenge jeg betaler og driver jorda, kan de ikke kaste meg ut. Det er norsk lov.",options:[{label:"En viss trygghet.",nextId:"laws"}]},laws:{text:"Ja, Landsloven til Magnus Lagabte. Den gir oss rettigheter. Jordeieren kan ikke bare ta grden fordi han vil. Og jeg kan kreve at snnen min fr overta bygselen. Vi er ikke slaver, vi er frie menn... bare fattige.",options:[{label:"Viktig forskjell.",nextId:"start"}]},plague:{text:"*Han senker stemmen* Bestefar fortalte om Den Store Dden. Da to av tre dde. Etterp... etterp var det gode tider for de som overlevde. Masse ledig jord! Lav landskyld! N? N er vi mange igjen, og jordeierne strammer grepet.",options:[{label:"degrder?",nextId:"deserted"},{label:"Tidene skifter.",nextId:"start"}]},deserted:{text:"Ja, du kan fortsatt se ruinene i skogen. Grder der folk bodde fr, som n er grodd igjen. Noen sier det spker der, at de dde gr igjen og passer p arveslvet sitt.",options:[{label:"Grss.",nextId:"start"}]}}},{id:"steinhugger",name:"Master William",role:"Engelsk Steinhugger",description:"Han tegner geometriske figurer i slt l p bordet. Fingrene er hvite av steinstv.",conversation:{start:{text:"Ser du? Hvis du lfter buen *her*, og krysser hvelvet *slik*... da kan du bygge hyere enn fjellene! Ah, unnskyld. Jeg drmmer om stein.",options:[{label:"Bygger du katedralen?",nextId:"nidaros"},{label:"Du er ikke herfra?",nextId:"english"},{label:"Stein er bare stein. (G)",nextId:"EXIT"}]},nidaros:{text:"Kristkirken i Nidaros, ja! Verdens nordligste gotiske katedral. Vi hugger Kleberstein. Den er myk som smr nr den brytes, men blir hard som jern i luften. Et mirakulst materiale.",options:[{label:"Fortell om stilen.",nextId:"gothic"},{label:"Hvor lenge holder dere p?",nextId:"time"}]},gothic:{text:"Gotikk! Det er lysets arkitektur. I gamle dager bygget de tykke vegger og sm vinduer (romansk stil). N? Vi bruker strebepilarer p utsiden til  bre taket, s vi kan fylle veggene med glassmalerier. Guds lys strmmer inn!",options:[{label:"Hres vakkert ut.",nextId:"symbolism"}]},symbolism:{text:"Det er mer enn vakkert. Kirken er et bilde p himmelen. Hver syle, hver bue peker oppover. Nr bonden kommer inn fra gjrma, skal han fle at han trer inn i Guds rike.",options:[{label:"Mektig.",nextId:"start"}]},english:{text:"Nei, jeg kom fra Lincoln. Erkebiskopen hentet hndverkere fra England. Vi tar med oss kunnskapen om de nye stilene. Det er et internasjonalt laug, steinhuggerne. Vi reiser dit Gud og gullet kaller oss.",options:[{label:"Et reisende liv.",nextId:"start"}]},time:{text:'Haha! "Hvor lenge?" Min oldefar begynte. Jeg fortsetter. Mine barnebarn vil kanskje se spiret reise seg. En katedral bygges ikke for oss, men for evigheten.',options:[{label:"En tlmodighetsprve.",nextId:"EXIT"}]}}},{id:"vaering",name:"Halvdan",role:"Veteran fra Vringgarden",description:"Han brer en kappe av falmet, men kostbar silke. Et stygt arr deler venstre yenbryn i to. Han drikker ikke l, men vin fra en liten flaske.",conversation:{start:{text:"Dette stedet... det er kaldt, mrkt og lukter av vt hund. I Miklagard skinte solen p gulltakene hver dag, og keiserens hager duftet av sjasmin.",options:[{label:"Hvor er Miklagard?",nextId:"miklagard"},{label:"Var du en kriger?",nextId:"guard"},{label:"Hjemme best. (G)",nextId:"EXIT"}]},miklagard:{text:'"Den Store Byen". Konstantinopel! Verdens sentrum. Der mtes st og vest. Gatene er brolagt med marmor, og de har badehus med varmt vann i veggene! Kan du tenke deg? Varmt vann uten  koke det over bl!',options:[{label:"Utrolig.",nextId:"hagia"},{label:"Savner du det?",nextId:"miss"}]},hagia:{text:"Og Hagia Sofia... Guds Helligdoms Kirke. Kuppelen er s stor at den ser ut som om den henger i en gullkjede fra himmelen. Jeg har sett menn grte bare av  g inn der.",options:[{label:"M vre et syn.",nextId:"start"}]},guard:{text:'Vringgarden. Keiserens livvakt. Vi nordboere er hye, sterke og... vel, vi sviker ikke for penger. Grekerne er slueste folk, men de stoler bare p vre kser. "Pelekysphoroi" kaller de oss. ksebrere.',options:[{label:"Mtte dere slss?",nextId:"fight"},{label:"Ble du rik?",nextId:"rich"}]},fight:{text:"Mot sarasenere, mot bulgarere, mot opprrske generaler. Jeg har sett gresk ild  flytende flammer som brenner p vann! Det er djevelens verk, men effektivt.",options:[{label:"Gresk ild?",nextId:"start"}]},rich:{text:'Keiseren er sjeners. Nr han dr, har vi rett til  g gjennom skattkammeret og ta det vi kan bre. "Polutasvarf", kaller vi det. Palass-plyndring. Det er slik jeg fikk denne kappen... og denne ringen.',options:[{label:"En god pensjon.",nextId:"start"}]},miss:{text:"Hver vinter. Men her er min slekt, min jord. Og her snakker folk et sprk man kan forst. Men jeg vil alltid drmme om det Gyldne Horn.",options:[{label:"Skl for minnene.",nextId:"EXIT"}]}}},{id:"munk",name:"Broder Johannes",role:"Lrd Skrivermunk",description:"Fingrene hans er flekkete av blekk. Han myser, som om han er vant til  lese i drlig lys, og snakker lavmelt.",conversation:{start:{text:"Hysj. Hrer du stillheten? Nei, selvsagt ikke. Her er det sty. I skriptoriet hrer man bare fjrpennens skraping mot pergamentet. Guds ord som festes til huden.",options:[{label:"Hva skriver du?",nextId:"write"},{label:"Er du ikke ensom?",nextId:"lonely"},{label:"Jeg lar deg vre i fred. (G)",nextId:"EXIT"}]},write:{text:'Akkurat n? En kopi av "Kongespeilet"  *Konungs skuggsj*. En lrebok for prinser. Den forteller om hflighet, handel, stjernene og Guds orden. En klok konge m vre lrd, ikke bare sterk.',options:[{label:"Er bker dyre?",nextId:"expensive"},{label:"Hvem leser disse?",nextId:"readers"}]},expensive:{text:"Ufattelig. Et stort bibelverk krever skinnet fra 300 kalver! Tenk p flokken... og arbeidet.  forberede skinnet, blande blekket, male initialene med bladgull. En bok kan koste mer enn en grd.",options:[{label:"En skatt alts.",nextId:"start"}]},readers:{text:"De geistlige, kongen, og noen f adelige. Men kunnskapen risler nedover. Det vi bevarer i bibliotekene, er verdens hukommelse. Uten oss ville historien forsvinne i mrket.",options:[{label:"Et viktig ansvar.",nextId:"start"}]},lonely:{text:"Aldri. Jeg er omgitt av apostler, helgener og kirkefedrene. Augustin, Thomas Aquinas... de taler til meg gjennom sidene. Og brdrene i klosteret er min familie. Vi ber sammen, arbeider sammen.",options:[{label:"Ora et labora?",nextId:"rule"},{label:"Hres fredelig ut.",nextId:"start"}]},rule:{text:"Be og arbeid. Ja. Det er St. Benedikts regel. Lediggang er fienden av sjelen. S vi dyrker urter, brygger l (som dette, Guds gave!), og kopierer bker.",options:[{label:"Skl for let.",nextId:"EXIT"}]}}},{id:"pestlege",name:"Doktor Pestus",role:"Pestlege",description:"Han sitter litt for seg selv. En merkelig maske med nebb henger rundt halsen hans, og han lukter sterkt av eddik og trkede blomster.",conversation:{start:{text:"Ikke kom for nr! Balansen i vskene dine ser... urolig ut. Er du sangvinsk? Eller melankolsk? Luften her er tykk av miasma.",options:[{label:"Miasma?",nextId:"miasma"},{label:"Hva er masken til?",nextId:"mask"},{label:"Jeg er frisk! (G)",nextId:"EXIT"}]},miasma:{text:"Drlig luft! Sykdom kommer av rtten luft som stiger opp fra jorden eller fra syke kropper. Den forstyrrer balansen i kroppen  blod, slim, gul og svart galle. Pesten... den er den verste ubalansen.",options:[{label:"Svartedauden?",nextId:"plague"},{label:"Hvordan kurerer man det?",nextId:"cure"}]},plague:{text:"Den store dden. Den kom med et skip til Bergen i 1349. Jeg s hele landsbyer tmmes. Prester dde mens de ga den siste olje. Det var som om Gud hadde forlatt oss. De som overlevde... vi er merket.",options:[{label:"Forferdelig.",nextId:"social"}]},social:{text:"Men se rundt deg! De frre vi er, jo mer verdt er hver mann. Bndene krever bedre lnn n. Tjenestepikene gr med silke. Verden er snudd p hodet etter pesten.",options:[{label:"En ny tid.",nextId:"start"}]},mask:{text:"Nebbet fylles med urter. Nellik, roser, mynte. Sterk lukt motvirker den drlige luften. Det er som et filter mot dden selv. Og kappen er innsatt med voks s pestloppene glir av.",options:[{label:"Smart oppfinnelse.",nextId:"cure"}]},cure:{text:'relating for  fjerne ondt blod. Kopping. Og Theriak  en blanding av over 60 ingredienser, inkludert ormekjtt og opium. Det beste rdet? "Cito, longe, tarde." Dra fort, dra langt, kom sent tilbake.',options:[{label:"Skal huske det.",nextId:"EXIT"}]}}},{id:"birkebeiner",name:"Gunnar",role:"Birkebeiner-opprrer",description:"En hardfr mann med slitte klr, men sverdet ved beltet er velstelt. Han ser mistenksomt mot dren hver gang den pnes.",conversation:{start:{text:"Hvem holder du med? Kongen eller Kirken? Baglerne eller Birkebeinerne? Svar fort, fr let blir varmt.",options:[{label:"Birkebeinerne!",nextId:"birkebeiner"},{label:"Jeg blander meg ikke.",nextId:"neutral"},{label:"Baglerne?",nextId:"bagler"},{label:"Ingen. (G)",nextId:"EXIT"}]},birkebeiner:{text:"Godt svar! Vi er kong Sverres menn. Mange av oss startet med ingenting, med never rundt leggene i snen. Men vi kjemper for norges rettmessige konge mot biskopenes tyranni!",options:[{label:"Hvorfor hater dere biskopene?",nextId:"church"},{label:"Fortell om Kong Sverre.",nextId:"sverre"}]},bagler:{text:"*Han spytter p gulvet* Kirkens lpegutter. De vil at paven i Roma skal styre Norge, ikke kongen. Pass deg, ellers tror jeg du er en spion.",options:[{label:"Jeg mente det ikke snn.",nextId:"start"}]},neutral:{text:"Ingen kan vre nytrale i borgerkrig. Nr bror dreper bror, m man velge side. Men kanskje det er klokest  holde kjeft, ja.",options:[{label:"Nettopp.",nextId:"start"}]},church:{text:'Erkebiskopen vil ha makt. Han nekter  krone Sverre! Han lyste ham i bann! Men Sverre talte Roma midt imot. "En tale mot biskopene", kalte han det. Han sa at kirken er rtten, og at kongen er innsatt av Gud, ikke av Paven.',options:[{label:"Sterke ord.",nextId:"start"}]},sverre:{text:"En prest fra Fryene som ble konge! Han er liten av vekst, men en kjempe i klkt. Han lrte oss  slss p en ny mte. Ikke bare storme frem, men bruke terrenget, sl til og forsvinne. Gerilja, kaller de det visst i sr.",options:[{label:"En taktiker.",nextId:"EXIT"}]}}},{id:"kone",name:"Ragnhild",role:"Klok Kone",description:"En eldre kvinne med grtt hr flettet med fargerike bnd. Hun har en kurv full av trkede planter og rtter p bordet.",conversation:{start:{text:"Har du en plage, ungen min? En verkebyll? Kjrlighetssorg? Eller kanskje kua di har sluttet  melke? Naturen har en bot for alt, hvis man vet hvor man skal lete.",options:[{label:"Er du en heks?",nextId:"witch"},{label:"Har du noe mot sr?",nextId:"herbs"},{label:"Jeg tror p bnner. (G)",nextId:"EXIT"}]},witch:{text:"Hysj! Ikke bruk det ordet. Prestene brenner folk for mindre. Jeg er en hjelper. Jeg bruker bare Guds skaperverk. Er det trolldom  vite at groblad stanser bldning? Nei, det er kunnskap.",options:[{label:"Unnskyld.",nextId:"signs"},{label:"Hva med magi?",nextId:"magic"}]},herbs:{text:"Groblad for sr. Ryllik for feber. Og johannesurt for de tunge tankene som kommer om vinteren. Og honning... honning er bra for alt. Det holder betennelsen borte.",options:[{label:"Nyttig  vite.",nextId:"start"}]},signs:{text:"Man m lese tegnene. Hvis rogna brer mye br, blir vinteren sntung. Hvis krka skriker mot nord, kommer det gjester. Det er ikke magi, det er  lytte til verden.",options:[{label:"Klokt.",nextId:"start"}]},magic:{text:"*Hun lener seg frem* Det finnes krefter... de underjordiske. Nissen p lven, Huldra i skogen. Man m vise dem respekt. Ofre litt grt, litt l. Kirken liker det ikke, men bonden vet at det er best  holde seg inne med dem.",options:[{label:"Best  vre forsiktig.",nextId:"EXIT"}]}}},{id:"skald",name:"Einar Skald",role:"Hoff-poet",description:"Han sitter med lukkede yne og trommer rytmisk p bordet. Plutselig slr han ut med hnden og deklamerer en strofe.",conversation:{start:{text:'"Sverdets sang, blodets brang, ravnens fang..." Nei, nei. Det mangler bokstavrim. En god drpa skal vre som et vevd teppe, hver ord skal lse det neste.',options:[{label:"Hva er en drpa?",nextId:"drapa"},{label:"Fortell en saga!",nextId:"saga"},{label:"Du virker intens. (G)",nextId:"EXIT"}]},drapa:{text:'Det ypperste av kvad! Et hyllingsdikt til en fyrste eller konge. Det m ha "stef"  et omkved som gjentas. Hvis jeg gjr en feil i versefoten foran Jarlen, kan jeg miste hodet. Eller verre, miste min re.',options:[{label:"Hres vanskelig ut.",nextId:"oral"},{label:"Hva er versefot?",nextId:"poetry"}]},saga:{text:'Ah, historiene. Ikke bare dikt, men sannheten om vre forfedre. Som historien om Egil Skallagrimsson... kriger og poet. Han reddet sitt eget liv ved  dikte "Hodelsningen" til Eirik Blodks. Ord er makt, min venn.',options:[{label:"Fortell om Egil.",nextId:"egil"}]},egil:{text:"Han var stygg som juling, men sterk som en bjrn. Og han kunne drepe med et sverd i n hnd og dikte med den andre. En gang spydde han over en hirdmann som prvde  fornrme ham! En ekte helt.",options:[{label:"Fargerik type.",nextId:"start"}]},oral:{text:"Vi brer historien i hodet. Bker kan brenne, men et godt kvede lever p folkemunne i tusen r. Det er min oppgave.  srge for at kongens bedrifter aldri glemmes. Jeg er levende historie.",options:[{label:"Imponerende hukommelse.",nextId:"start"}]},poetry:{text:'Det er regler! Fornyrdislag, Ljogahtt... du m bruke "Kenninger". Du sier ikke "sverd", du sier "sr-isl". Du sier ikke "blod", du sier "sverd-vann". Det gjr sprket rikt og gtefullt.',options:[{label:"Vakkert sprk.",nextId:"EXIT"}]}}}];function tee(t,e,s){const{setActiveTab:n,setProductionContext:i,viewMode:r,setViewMode:a,viewingRegionId:l,setViewingRegionId:c,setActiveMinigame:u,activeTab:d}=va(),h=l||t.regionId||"capital",[f,m]=S.useState(null),[b,p]=S.useState(null),[v,x]=S.useState(null),[g,y]=S.useState(null),[w,k]=S.useState("start"),[N,_]=S.useState(!1),[T,E]=S.useState(!1),[A,R]=S.useState(!1),[I,V]=S.useState(!1),[H,P]=S.useState(!1),[O,L]=S.useState(!1),[M,F]=S.useState(!1),[U,C]=S.useState(!1),[j,$]=S.useState(!1),B=S.useCallback(me=>{if(me==="kingdom")return 0;if(me==="global")return 1;const ue=Gr.find(ne=>ne.id===me);return ue!=null&&ue.parentId?3:2},[]),[D,z]=S.useState(r),[J,Y]=S.useState("in");if(r!==D){const me=B(D),ue=B(r);ue>me?Y("in"):ue<me&&Y("out"),z(r)}S.useEffect(()=>{const me=ue=>{if(ue.key==="Escape"){if(d!=="MAP")return;if(v){x(null);return}if(N){_(!1);return}if(T){E(!1);return}if(I){V(!1);return}if(H){P(!1);return}if(O){L(!1);return}if(M){F(!1);return}if(j){$(!1);return}if(g){y(null);return}if(b){p(null);return}if(f){m(null);return}if(r!=="kingdom"){const ne=Gr.find(ft=>ft.id===r),Le=ne!=null&&ne.parentId?Gr.find(ft=>ft.id===ne.parentId):null;a(r==="global"?"kingdom":Le?Le.id:"global")}}};return window.addEventListener("keydown",me),()=>window.removeEventListener("keydown",me)},[r,v,N,T,I,g,b,f,a,d]);const fe=S.useCallback((me,ue)=>{var Pe,_e;const ne=typeof ue=="string"?ue:ue.type||ue.id,Le=Q=>Q==="windmill_stones"?{buildingId:"windmill",type:"REFINE"}:Q==="sawmill_blade"?{buildingId:"sawmill",type:"REFINE"}:Q==="smeltery_furnace"?{buildingId:"smeltery",type:"REFINE"}:Q==="bakery_oven"?{buildingId:"bakery",type:"REFINE"}:Q==="weavery_loom"?{buildingId:"weavery",type:"REFINE"}:Q==="forge_anvil"?{buildingId:"great_forge",type:"CRAFT"}:Q==="apothecary_bench"?{buildingId:"apothecary",type:"CRAFT"}:null;if(ne==="OPEN_CHICKEN_COOP"){E(!0),m(null);return}if(ne==="OPEN_GARRISON"){i({buildingId:"watchtower",type:"CRAFT",initialView:"PRODUCE"}),n("PRODUCTION"),m(null);return}if(ne==="OPEN_CONSTRUCTION"){R(!0),m(null);return}if(ne==="OPEN_WAR_ROOM"){n("WAR_ROOM"),m(null);return}if(ne==="OPEN_TAXATION"){V(!0),m(null);return}if(ne==="OPEN_SHIPYARD"){F(!0),m(null);return}if(ne==="START_SAILING"){u("SAILING"),m(null);return}if(ne==="OPEN_WHARF_UPGRADE"){C(!0),m(null);return}const ft=Le(me);if(ft&&(ne==="OPEN_CRAFTING"||ne==="CRAFT"||ne==="REFINE"||ne.startsWith("REFINE_")||ne.startsWith("CRAFT_")||An[ne]||ne==="REPAIR")){i({...ft,initialView:ne==="REPAIR"?"REPAIR":"PRODUCE"}),n("PRODUCTION"),m(null);return}const se=h===t.regionId,le=t.role==="KING";if(!se&&!le&&ne!=="MARKET_VIEW"){alert("Du har ingen myndighet i dette baroniet.");return}if(ne==="MARKET_VIEW")s();else if(ne.startsWith("REFINE_")){const Q=ne.replace("REFINE_","").split("_")[0].toLowerCase();e({type:"REFINE",recipeId:{plank:"plank",flour:"flour",iron:"iron_ingot",steel:"iron_ingot",cloth:"cloth"}[Q]||Q})}else if(ne.startsWith("CRAFT_")){const Q=ne.replace("CRAFT_","").toLowerCase();e(Q==="bread"||Q==="pie"||Q==="mead"?{type:"REFINE",recipeId:Q}:{type:"CRAFT",subType:Q})}else if(ne in An)e({type:"CRAFT",subType:ne});else if(ne.startsWith("BUILDING_UPGRADE_")){const Q=ne.replace("BUILDING_UPGRADE_","");x(Q)}else if(ne==="OPEN_RESOURCE_GAME")P(!0);else if(ne==="HARVEST"||ne==="PLANT"){const Q=Gr.find(oe=>oe.id===me),ie=((Pe=Q==null?void 0:Q.label)==null?void 0:Pe.toLowerCase().includes("lin"))||me==="flax_field",G=(_e=Q==null?void 0:Q.actions)==null?void 0:_e.find(oe=>oe.id===ne);ie&&ne==="HARVEST"?$(!0):!ie&&ne==="HARVEST"?L(!0):e({type:ne,...G,locationId:me})}else if(ne==="CHAT_LOCAL"){const Q=bT[Math.floor(Math.random()*bT.length)];y(Q),k("start")}else e(ne==="BUY_MEAL"?{type:"BUY_MEAL"}:ne);m(null)},[h,t,e,s,n,i,m]);return{viewMode:r,setViewMode:a,viewingRegionId:h,setViewingRegionId:c,selectedPOI:f,setSelectedPOI:m,selectedEvent:b,setSelectedEvent:p,upgradingBuildingId:v,setUpgradingBuildingId:x,dialogNPC:g,setDialogNPC:y,dialogStep:w,setDialogStep:k,isDiceGameOpen:N,setIsDiceGameOpen:_,isChickenCoopOpen:T,setIsChickenCoopOpen:E,isConstructionOpen:A,setIsConstructionOpen:R,isTaxationOpen:I,setIsTaxationOpen:V,isGambleGameOpen:H,setIsGambleGameOpen:P,isGrainGameOpen:O,setIsGrainGameOpen:L,isShipyardOpen:M,setIsShipyardOpen:F,isWharfUpgradeOpen:U,setIsWharfUpgradeOpen:C,isFlaxGameOpen:j,setIsFlaxGameOpen:$,direction:J,handlePOIAction:fe}}const see=({playerGold:t,onClose:e,onPlay:s})=>{const[n,i]=S.useState(1),[r,a]=S.useState(!1),[l,c]=S.useState([1,1]),[u,d]=S.useState([1,1]),[h,f]=S.useState("Plasser din innsats..."),[m,b]=S.useState(t);Ne.useEffect(()=>{b(t)},[t]);const p=()=>Math.floor(Math.random()*6)+1,v=()=>{if(r)return;if(n>t){f("Du har ikke nok gull!");return}if(n<.5){f("Minstesats er 0.5g");return}a(!0),f("Terningene ruller...");let y=0;const w=10,k=setInterval(()=>{c([p(),p()]),d([p(),p()]),y++,y>=w&&(clearInterval(k),x())},100)},x=()=>{const y=p(),w=p(),k=p(),N=p(),_=y+w,T=k+N;c([y,w]),d([k,N]);const E=_>T;E?(f(`DU VANT! ${_} mot ${T}`),b(A=>A+n)):(f(`HUSET VANT. ${T} mot ${_}`),b(A=>Math.max(0,A-n))),s({amount:n,isWin:E,playerRoll:_,houseRoll:T}),a(!1)},g=(y,w)=>o.jsx("div",{className:`w-16 h-16 rounded-xl shadow-[inset_0_0_10px_rgba(0,0,0,0.5)] flex bg-gradient-to-br ${w==="player"?"from-white to-slate-200 text-black":"from-red-600 to-red-800 text-white"} relative transition-transform duration-100 ${r?"animate-bounce":""}`,children:o.jsx("div",{className:"grid grid-cols-3 grid-rows-3 w-full h-full p-2 gap-1",children:[...Array(9)].map((k,N)=>{let _=!1;return y===1&&N===4&&(_=!0),y===2&&(N===0||N===8)&&(_=!0),y===3&&(N===0||N===4||N===8)&&(_=!0),y===4&&(N===0||N===2||N===6||N===8)&&(_=!0),y===5&&(N===0||N===2||N===4||N===6||N===8)&&(_=!0),y===6&&(N===0||N===2||N===3||N===5||N===6||N===8)&&(_=!0),o.jsx("div",{className:"flex items-center justify-center",children:_&&o.jsx("div",{className:`w-3 h-3 rounded-full ${w==="player"?"bg-black":"bg-white"} shadow-sm`})},N)})})});return o.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-500",children:[o.jsxs("div",{className:"absolute inset-0 z-0 opacity-50",children:[o.jsx("img",{src:"/Simulation_StandAlone_Pro/poi/tavern_dice_bg.png",alt:"Tavern Table",className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black"})]}),o.jsxs("div",{className:"relative z-10 bg-[#1a472a]/90 border-[4px] border-[#5d4037] rounded-[2rem] shadow-[0_50px_100px_rgba(0,0,0,0.8)] w-full max-w-2xl overflow-hidden backdrop-blur-md",children:[o.jsx("div",{className:"absolute inset-0 border-2 border-[#8d6e63] rounded-[1.2rem] pointer-events-none opacity-50"}),o.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-[#d7ccc8] hover:text-white transition-colors bg-black/20 hover:bg-black/40 rounded-full w-8 h-8 flex items-center justify-center font-bold z-50",children:""}),o.jsxs("div",{className:"p-8 flex flex-col items-center gap-8 relative",children:[o.jsxs("div",{className:"text-center space-y-1",children:[o.jsx("h2",{className:"text-3xl font-black text-[#ffecb3] uppercase tracking-widest drop-shadow-md",style:{fontFamily:"serif"},children:"Spillebordet"}),o.jsx("div",{className:"text-[#a5d6a7] font-bold tracking-wider text-sm",children:"Huset vinner ved uavgjort"}),o.jsx("div",{className:"text-xs text-white/50 uppercase tracking-widest font-black",children:"Lykke til!"})]}),o.jsxs("div",{className:"flex justify-between w-full px-8 gap-8",children:[o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsxs("span",{className:"text-[#90caf9] font-black uppercase tracking-widest text-xs",children:["Deg (",l[0]+l[1],")"]}),o.jsxs("div",{className:"flex gap-3",children:[g(l[0],"player"),g(l[1],"player")]})]}),o.jsx("div",{className:"flex items-center justify-center",children:o.jsx("span",{className:"text-2xl font-black text-white/20",children:"VS"})}),o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsxs("span",{className:"text-[#ef9a9a] font-black uppercase tracking-widest text-xs",children:["Huset (",u[0]+u[1],")"]}),o.jsxs("div",{className:"flex gap-3",children:[g(u[0],"house"),g(u[1],"house")]})]})]}),o.jsx("div",{className:`h-12 flex items-center justify-center w-full bg-black/30 rounded-xl border border-white/5 transition-all ${h.includes("VANT")?"bg-green-900/40 border-green-500/30":h.includes("tapte")?"bg-red-900/40 border-red-500/30":""}`,children:o.jsx("span",{className:"font-bold text-lg text-[#fff8e1] tracking-wide",children:h})}),o.jsxs("div",{className:"w-full bg-black/20 p-6 rounded-2xl border border-white/5 flex flex-col gap-4",children:[o.jsxs("div",{className:"flex justify-between items-center text-[#d7ccc8] font-bold text-sm uppercase tracking-widest",children:[o.jsx("span",{children:"Innsats"}),o.jsxs("span",{children:["Din Saldo: ",o.jsxs("span",{className:"text-[#ffd54f]",children:[m.toFixed(1),"g"]})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("input",{type:"range",min:.5,max:Math.min(t,100),step:.5,value:n,onChange:y=>i(parseFloat(y.target.value)),className:"w-full h-3 bg-black/50 rounded-lg appearance-none cursor-pointer accent-[#ffb74d]",disabled:r}),o.jsxs("div",{className:"bg-black/40 px-4 py-2 rounded-xl text-[#ffd54f] font-black min-w-[5rem] text-center border border-white/10",children:[n,"g"]})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:[1,5,10,50].map(y=>o.jsxs("button",{onClick:()=>i(y),disabled:y>t||r,className:`py-1 rounded-lg text-xs font-bold uppercase tracking-widest transition-colors ${n===y?"bg-[#ffb74d] text-black":"bg-white/5 text-[#d7ccc8] hover:bg-white/10"}`,children:[y,"g"]},y))}),o.jsx("button",{onClick:v,disabled:r||t<n,className:`w-full py-4 rounded-xl font-black uppercase tracking-widest text-lg shadow-lg transform transition-all active:scale-[0.98] ${r?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-[#ffca28] to-[#ff6f00] text-black hover:brightness-110 shadow-orange-900/40"}`,children:r?"Ruller...":"KAST TERNINGENE!"})]})]})]})]})},Uh=[{id:"gold",label:"GULL",icon:"",color:"from-yellow-400 to-amber-600",accent:"amber"},{id:"grain",label:"KORN",icon:"",color:"from-amber-400 to-amber-600",accent:"amber"},{id:"wood",label:"TREVIRKE",icon:"",color:"from-orange-500 to-amber-800",accent:"orange"},{id:"stone",label:"STEIN",icon:"",color:"from-slate-500 to-slate-700",accent:"slate"},{id:"iron",label:"JERN",icon:"",color:"from-blue-500 to-indigo-900",accent:"indigo"}],Ai=[{value:0,weight:50,label:"Tap",color:"#0f172a",multiplierText:"0x",angle:180},{value:1.5,weight:30,label:"Gevinst",color:"#10b981",multiplierText:"1.5x",angle:90},{value:2.5,weight:15,label:"Stor Gevinst",color:"#3b82f6",multiplierText:"2.5x",angle:60},{value:5,weight:5,label:"JACKPOT!",color:"#f59e0b",multiplierText:"5x",angle:30}],nee=({player:t,onClose:e,onPlay:s})=>{const[n,i]=S.useState("gold"),[r,a]=S.useState(100),[l,c]=S.useState(!1),[u,d]=S.useState(0),[h,f]=S.useState(null),[m,b]=S.useState([]),p=S.useRef(!1),v=t.resources||{},x=v[n]||0;S.useEffect(()=>{r>x&&a(Math.max(1,Math.floor(x)))},[n,x]);const g=()=>{if(p.current||l||r<=0||r>x)return;p.current=!0,c(!0),f(null);const k=Ai.reduce((j,$)=>j+$.weight,0),N=Math.random()*k;let _=0,T=0;for(let j=0;j<Ai.length;j++)if(T+=Ai[j].weight,N<T){_=j;break}const E=Ai[_],A=8+Math.floor(Math.random()*4);let R=0;for(let j=0;j<_;j++)R+=Ai[j].angle;const I=Ai[_],V=R+I.angle/2,H=I.angle/2*.6,P=(Math.random()-.5)*H,L=(360-(V+P+360)%360)%360,M=u,F=M%360,U=(L-F+360)%360,C=M+A*360+U;d(C),setTimeout(()=>{const j=E.value>0,$={multiplier:E.value,isWin:j,label:E.label};f($),c(!1),p.current=!1;const B={resource:n,amount:r,multiplier:E.value,isWin:j,timestamp:Date.now()};b(D=>[B,...D].slice(0,4)),s({resource:n,amount:r,multiplier:E.value,isWin:j})},3100)},y=Uh.find(k=>k.id===n)||Uh[0],w=S.useMemo(()=>{let k=0;return Ai.map(N=>{const _=k;return k+=N.angle,`${N.color} ${_}deg ${k}deg`}).join(", ")},[]);return o.jsxs("div",{className:"absolute inset-0 z-[100] flex items-center justify-center p-4",children:[o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l?void 0:e,className:"absolute inset-0 bg-slate-950/85 backdrop-blur-xl cursor-pointer"}),o.jsxs(Z.div,{initial:{scale:.95,opacity:0,y:30},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:30},className:"relative w-full max-w-5xl bg-slate-900 border border-white/5 rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col lg:flex-row h-[650px]",children:[o.jsx("button",{onClick:e,disabled:l,className:"absolute top-6 right-6 z-50 p-2 bg-white/5 hover:bg-white/10 rounded-full text-white/30 hover:text-white transition-all",children:o.jsx(In,{size:24})}),o.jsxs("div",{className:"flex-1 p-6 flex flex-col gap-4 z-10 overflow-hidden",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs("div",{className:"px-3 py-0.5 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-500 text-[9px] font-black uppercase tracking-[0.2em] flex items-center gap-2",children:[o.jsx(Ki,{size:10}),o.jsx("span",{children:"Soga-hjulet"})]})}),o.jsx("h2",{className:"text-3xl font-black text-white italic tracking-tighter leading-none",children:"Sats Dine Ressurser"}),o.jsx("div",{className:"grid grid-cols-5 gap-2",children:Uh.map(k=>{const N=n===k.id,_=v[k.id]||0;return o.jsxs("button",{onClick:()=>!l&&i(k.id),className:`relative p-3 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center gap-1.5
                                        ${N?`bg-white/5 border-${k.accent}-500 shadow-lg scale-105`:"bg-black/20 border-white/5 hover:border-white/10 opacity-70"}`,children:[o.jsx("div",{className:"text-2xl",children:k.icon}),o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:k.label}),o.jsx("div",{className:`text-lg font-black font-mono ${N?"text-white":"text-slate-300"}`,children:_%1!==0?_.toFixed(1):_.toLocaleString()})]})]},k.id)})}),o.jsxs("div",{className:"bg-black/40 border border-white/5 rounded-[2rem] p-6 space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-end",children:[o.jsxs("div",{className:"space-y-0.5",children:[o.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500",children:"Innsats Belp"}),o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"text-5xl font-black text-white font-mono",children:r.toLocaleString()}),o.jsx("span",{className:"text-sm font-black text-indigo-400 uppercase tracking-widest",children:y.label})]})]}),o.jsx("div",{className:"flex gap-2",children:[25,50,100].map(k=>o.jsx("button",{onClick:()=>a(Math.max(1,Math.floor(x*(k/100)))),className:"px-3 py-1.5 rounded-xl bg-white/5 hover:bg-white/10 text-[10px] font-black uppercase tracking-widest text-slate-300 border border-white/5",children:k===100?"MAX":`${k}%`},k))})]}),o.jsxs("div",{className:"relative h-8 flex items-center",children:[o.jsx("input",{type:"range",min:1,max:Math.max(1,Math.floor(x)),step:1,value:r,onChange:k=>a(parseInt(k.target.value)),disabled:l,className:"w-full h-1.5 bg-white/5 rounded-full appearance-none cursor-pointer accent-amber-500 z-10"}),o.jsx("div",{className:"absolute left-0 h-1.5 bg-gradient-to-r from-amber-600 to-amber-400 rounded-full pointer-events-none",style:{width:`${r/Math.max(1,Math.floor(x))*100}%`}})]}),o.jsx("button",{onClick:g,disabled:l||x<r||r<=0,className:`w-full relative h-14 rounded-xl font-black uppercase tracking-[0.3em] text-base shadow-2xl transition-all duration-300 ${l?"bg-slate-800":"bg-amber-500 hover:brightness-110 active:scale-95 text-slate-950"}`,children:l?"Spinner...":"SPINN HJULET!"})]}),o.jsxs("div",{className:"mt-auto border-t border-white/5 pt-3",children:[o.jsxs("div",{className:"flex items-center gap-2 text-[9px] font-black uppercase tracking-[0.3em] text-slate-600 mb-2",children:[o.jsx(m1,{size:10}),o.jsx("span",{children:"Siste Resultater"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:m.map((k,N)=>{const _=Uh.find(T=>T.id===k.resource);return o.jsxs("div",{className:"flex flex-col p-2 rounded-xl bg-black/40 border border-white/5 items-center",children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[o.jsx("span",{className:"text-xs",children:_==null?void 0:_.icon}),o.jsx("span",{className:"text-[10px] font-mono font-bold text-slate-400",children:k.amount.toLocaleString()})]}),o.jsx("div",{className:`text-xs font-black font-mono ${k.isWin?"text-emerald-500":"text-rose-900/40"}`,children:k.isWin?`x${k.multiplier}`:"TAP"})]},N)})})]})]}),o.jsxs("div",{className:"w-full lg:w-[480px] bg-black/50 border-l border-white/5 flex flex-col items-center justify-center p-12 relative",children:[o.jsxs("div",{className:"relative w-80 h-80 mb-10",children:[o.jsx("div",{className:`absolute -inset-12 rounded-full blur-[100px] opacity-20 transition-colors duration-1000 bg-${y.accent}-500`}),o.jsxs(Z.div,{animate:{rotate:u},transition:{duration:3,ease:[.32,.72,0,1]},className:"w-full h-full rounded-full border-[18px] border-slate-900 shadow-2xl relative overflow-hidden bg-slate-950",children:[o.jsx("div",{className:"absolute inset-0 transition-opacity duration-300",style:{background:`conic-gradient(${w})`,opacity:l?.4:.8}}),Ai.map((k,N)=>{let _=0;for(let E=0;E<N;E++)_+=Ai[E].angle;const T=_+k.angle/2;return o.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{transform:`rotate(${T}deg)`},children:o.jsx("div",{className:"absolute top-[16%] text-white font-black text-2xl drop-shadow-[0_2px_4px_rgba(0,0,0,1)] font-mono",children:k.multiplierText})},N)}),o.jsx("div",{className:"absolute inset-[80px] rounded-full border-2 border-white/5 bg-slate-950/80 backdrop-blur-md shadow-inner"})]}),o.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 z-50",children:o.jsx(Z.div,{animate:l?{y:[0,-5,0]}:{},transition:{duration:.1,repeat:1/0},className:"w-10 h-16 bg-amber-500 rounded-b-full shadow-[0_15px_30px_rgba(245,158,11,0.6)] border-4 border-slate-950 flex flex-col items-center justify-end pb-2",children:o.jsx("div",{className:"w-1.5 h-6 bg-slate-950/30 rounded-full"})})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-40 pointer-events-none",children:o.jsx(Dt,{mode:"wait",children:l?o.jsx(Z.div,{initial:{scale:.8},animate:{scale:1.1},exit:{scale:1.2,opacity:0},className:"text-7xl drop-shadow-2xl",children:y.icon},"spinning_icon"):o.jsxs(Z.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},className:"flex flex-col items-center gap-1 drop-shadow-2xl",children:[o.jsx("span",{className:"text-6xl",children:y.icon}),h&&o.jsxs(Z.span,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},className:`text-3xl font-black font-mono ${h.isWin?"text-emerald-400":"text-slate-500"}`,children:[h.multiplier,"x"]})]},"result_icon")})})]}),o.jsx("div",{className:"h-24 text-center flex flex-col items-center justify-center",children:o.jsx(Dt,{mode:"wait",children:h&&!l&&o.jsxs(Z.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},className:"space-y-1",children:[o.jsxs("div",{className:`text-xs font-black uppercase tracking-[0.3em] flex items-center justify-center gap-2 ${h.isWin?"text-emerald-400":"text-slate-500"}`,children:[h.isWin&&o.jsx(Ki,{size:12,className:"animate-pulse"}),h.label,h.isWin&&o.jsx(Ki,{size:12,className:"animate-pulse"})]}),o.jsx("h4",{className:`text-3xl font-black italic tracking-tighter drop-shadow-lg transition-all ${h.multiplier>=2.5?"text-yellow-400 scale-110":"text-white"}`,children:h.isWin?`+${(r*h.multiplier).toLocaleString()} ${y.label}`:"Fortellingen er over"}),h.multiplier>=5&&o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},className:"text-[10px] font-black text-amber-500 uppercase tracking-[0.5em] mt-2 animate-bounce",children:"LEGENDARISK GEVINST!"})]})})})]})]})]})};class iee{constructor(){Ie(this,"listeners",[])}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(s=>s!==e)}}emit(e){this.listeners.forEach(s=>s(e))}spawnFloatingText(e,s,n,i){const r=(Math.random()-.5)*4,a=(Math.random()-.5)*4;this.emit({id:Math.random().toString(36).substr(2,9),type:"FLOATING_TEXT",text:e,x:s+r,y:n+a,color:i,duration:1500})}spawnFlyingResource(e,s,n,i,r){this.emit({id:Math.random().toString(36).substr(2,9),type:"FLYING_RESOURCE",resource:e,startPoint:{x:s,y:n},endPoint:{x:i,y:r},duration:1e3})}spawnParticles(e,s,n){this.emit({id:Math.random().toString(36).substr(2,9),type:"PARTICLE",x:e,y:s,color:n,duration:800})}}const Ze=new iee,ree=({onComplete:t})=>{const[e,s]=S.useState([]),[n,i]=S.useState(!1),r=10,a=l=>{if(n)return;const c=l.currentTarget.getBoundingClientRect(),u=(l.clientX-c.left)/c.width*100,d=(l.clientY-c.top)/c.height*100,h={x:u,y:d,id:Date.now()};Ze.spawnParticles(u,d,"bg-emerald-400"),s(f=>{const m=[...f,h];return m.length>=r&&(i(!0),setTimeout(()=>t(1),1500)),m})};return o.jsxs("div",{onClick:a,className:"w-full h-[600px] relative overflow-hidden cursor-crosshair group active:scale-[0.99] transition-transform select-none",style:{backgroundImage:'url("/images/minigames/agriculture_bg.png")',backgroundSize:"cover",backgroundPosition:"center"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/40 z-0 pointer-events-none"}),o.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 pointer-events-none z-20 text-center",children:n?o.jsx("div",{className:"animate-in zoom-in duration-300",children:o.jsx("h2",{className:"text-5xl font-black text-emerald-400 drop-shadow-[0_4px_0_rgba(0,0,0,0.5)] uppercase tracking-tighter animate-bounce",children:"Mestrerlig Sdd! "})}):o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-3xl font-black text-white drop-shadow-md mb-2",children:"S dine fr"}),o.jsxs("div",{className:"bg-black/40 px-4 py-1 rounded-full text-emerald-400 font-bold uppercase tracking-widest text-sm inline-block",children:[e.length," / ",r]})]})}),e.map(l=>o.jsx("div",{className:"absolute w-4 h-4 bg-emerald-400 rounded-full shadow-[0_0_10px_rgba(52,211,153,0.8)] animate-in zoom-in duration-300",style:{left:`${l.x}%`,top:`${l.y}%`,transform:"translate(-50%, -50%)"},children:o.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 w-0.5 h-3 bg-white/50"})},l.id)),o.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 hidden group-hover:block",children:o.jsx("div",{className:"absolute w-8 h-8 border-2 border-white/50 rounded-full -translate-x-1/2 -translate-y-1/2"})})]})},vl=({onComplete:t,equipment:e=[],isMining:s,isQuarrying:n,isForaging:i,speedMultiplier:r=1,possibleYield:a=10,resourceName:l="Ressurs"})=>{const[c,u]=S.useState(0),[d,h]=S.useState([]),[f,m]=S.useState(!1),[b,p]=S.useState(!1),[v,x]=S.useState(!1),g=S.useRef(1),[y,w]=S.useState(50),k=S.useRef(1);S.useEffect(()=>{const T=E=>{E.code==="Space"&&(E.preventDefault(),N())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[d,f,c,y,e,r,v]),S.useEffect(()=>{if(d.length>=5||f||v)return;const T=setInterval(()=>{u(E=>{let A=2/r,R=E+A*g.current;return R>100?(g.current=-1,100):R<0?(g.current=1,0):R}),w(E=>{let R=E+.3*k.current;return Math.random()<.02&&(k.current*=-1),R>80?(k.current=-1,80):R<20?(k.current=1,20):R})},16);return()=>clearInterval(T)},[d.length,f,r,v]);const N=()=>{var O,L,M;if(d.length>=5||f||v)return;const T=Math.abs(c-y);let E=T<5?1:T<15?.7:T<25?.4:.1;const A=s?"MINE":n?"QUARRY":i?"FORAGE":"WORK",R=bR(A,e||[]);console.log(`[HarvestingGame] Init. Action: ${A}. Equipment Count: ${e==null?void 0:e.length}. Best Tool:`,R);const I=((O=R==null?void 0:R.stats)==null?void 0:O.yieldBonus)||(R&&ra(R)?(M=(L=Ke[ra(R)])==null?void 0:L.stats)==null?void 0:M.yieldBonus:0)||0,V=Math.ceil(a/5*(.5+E)),H=Math.ceil(I/5*(.5+E));T<15?(p(!0),x(!0),Ze.spawnParticles(50,40,T<5?"bg-amber-400":"bg-white"),T<5?Ze.spawnFloatingText(`PERFEKT! + ${V} ${H>0?`(+${H})`:""} `,50,40,"text-amber-400 font-black text-2xl"):Ze.spawnFloatingText(`Bra! +${V}`,50,40,"text-white font-bold"),setTimeout(()=>{p(!1),x(!1)},100)):Ze.spawnFloatingText("Svakt...",50,40,"text-slate-500 font-bold");const P=[...d,E];h(P),P.length===5&&(m(!0),setTimeout(()=>t(P.reduce((F,U)=>F+U,0)/5),800))},_=s||n?'url("/images/minigames/mining_bg.png")':i?'url("/images/minigames/foraging_bg.png")':'url("/images/minigames/agriculture_bg.png")';return o.jsxs("div",{className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${b?"animate-shake":""} `,style:{backgroundImage:_,backgroundSize:"cover",backgroundPosition:"center"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/70 z-0 transition-all duration-75 ${v?"bg-indigo-900/50 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 w-full flex flex-col items-center transition-all duration-75 ${v?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-4xl font-black text-white mb-8 drop-shadow-lg tracking-tighter uppercase",children:s?"Gruvedrift":n?"Steinhugger":i?"Sanking":l!=null&&l.toLowerCase().includes("lin")?"Linhsting":"Kornhsting"}),f?o.jsx("div",{className:"py-12 animate-bounce text-5xl font-black text-amber-500 uppercase tracking-tighter drop-shadow-[0_0_20px_rgba(245,158,11,0.5)]",children:"FERDIG! "}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mb-4 text-xs font-black text-amber-500 uppercase tracking-widest",children:l}),o.jsxs("div",{className:"w-full h-8 bg-white/5 rounded-full mb-12 relative border border-white/10 overflow-hidden shadow-inner",children:[o.jsx("div",{className:"absolute inset-y-0 bg-amber-500/30 border-x border-amber-500/50 transition-all duration-75 linear",style:{left:`${y-8}%`,right:`${100-(y+8)}%`}}),o.jsx("div",{className:"absolute inset-y-0 w-0.5 bg-amber-400/80 z-0",style:{left:`${y}%`}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_20px_white] z-10",style:{left:`${c}% `}})]}),o.jsx("button",{onClick:N,className:`w-full bg-amber-500 hover:bg-amber-400 text-slate-950 py-7 rounded-[2rem] font-black text-2xl shadow-2xl transition-all uppercase tracking-widest border-b-4 border-amber-700 ${v?"scale-95 brightness-125":"active:scale-95"}`,children:"KLIKK N! "})]})]})]})},aee=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=S.useState(50),[i,r]=S.useState(50),[a,l]=S.useState(0),[c,u]=S.useState(!1),[d,h]=S.useState(!1),[f,m]=S.useState(!1),b=S.useRef(1);S.useEffect(()=>{if(c||f)return;const v=setInterval(()=>{n(x=>{let g=x+.8*b.current*e;return g>90?(b.current=-1,90):g<10?(b.current=1,10):g})},16);return()=>clearInterval(v)},[c,e,f]),S.useEffect(()=>{const v=x=>{x.code==="Space"&&(x.preventDefault(),p({clientX:window.innerWidth/2,clientY:window.innerHeight/2}))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[c,i,s,f]);const p=v=>{if(c||f)return;const x=Math.abs(i-s),g=v.clientX,y=v.clientY;x<12?(h(!0),m(!0),l(w=>{const k=w+1;return k>=5&&(u(!0),Ze.spawnFloatingText("MESTERVERK! ",g,y-60,"text-amber-400 text-3xl font-black"),setTimeout(()=>t(1),1200)),k}),Ze.spawnParticles(g,y,"bg-amber-400"),Ze.spawnFloatingText("KLANG!",g,y-40,"text-amber-500 font-black"),setTimeout(()=>{h(!1),m(!1)},100)):x<25?(Ze.spawnFloatingText("Treff",g,y-40,"text-white font-bold"),Ze.spawnParticles(g,y,"bg-white")):Ze.spawnFloatingText("BOM!",g,y-40,"text-slate-500 font-bold")};return o.jsxs("div",{onMouseMove:v=>{const x=v.currentTarget.getBoundingClientRect();r((v.clientX-x.left)/x.width*100)},onClick:p,className:`p-12 min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden cursor-crosshair ${d?"animate-shake":""}`,style:{backgroundImage:'url("/images/minigames/smithing_bg.png")',backgroundSize:"cover",backgroundColor:"#0f172a"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/70 z-0 transition-all duration-75 ${f?"bg-amber-900/40 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 text-center mb-12 transition-all duration-75 ${f?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tighter drop-shadow-xl",children:"Smedarbeid"}),o.jsxs("div",{className:"text-amber-500 font-black uppercase tracking-widest text-xs mt-2 bg-black/40 px-4 py-1 rounded-full border border-amber-500/20",children:["Slag: ",a," / 5"]})]}),o.jsxs("div",{className:`relative z-10 w-full max-w-2xl space-y-4 transition-all duration-75 ${f?"scale-105":""}`,children:[o.jsxs("div",{className:"w-full h-24 bg-slate-900/50 rounded-2xl border-2 border-white/10 shadow-2xl flex items-center px-4 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-amber-500/5 transition-all duration-1000",style:{opacity:a/5}}),o.jsxs("div",{className:"relative w-full h-4 bg-white/5 rounded-full overflow-hidden",children:[o.jsx("div",{className:"absolute inset-y-0 w-24 bg-amber-500/40 blur-sm mix-blend-screen transition-all duration-75",style:{left:`${s}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-12 bg-white/40 blur-[2px]",style:{left:`${s}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_15px_white] z-20",style:{left:`${i}%`,transform:"translateX(-50%)"}})]})]}),o.jsxs("div",{className:"flex items-center gap-4 px-2",children:[o.jsx("div",{className:"flex-1 h-2 bg-black/40 rounded-full overflow-hidden border border-white/5",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-amber-600 to-amber-400 transition-all duration-500",style:{width:`${a/5*100}%`}})}),o.jsxs("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest",children:[Math.round(a/5*100),"%"]})]})]}),c&&o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in zoom-in duration-300",children:o.jsx("div",{className:"text-6xl font-black text-amber-500 animate-bounce drop-shadow-[0_0_30px_rgba(245,158,11,0.5)]",children:"FERDIG! "})}),o.jsx("div",{className:`mt-12 text-slate-400 text-sm font-bold uppercase tracking-widest animate-pulse relative z-10 transition-opacity ${f?"opacity-0":"opacity-100"}`,children:"Klikk nr markren er over den gldende sonen"})]})},oee=({onComplete:t,speedMultiplier:e=1,icon:s=""})=>{const[n,i]=S.useState(0),[r,a]=S.useState(!1),[l,c]=S.useState(null),[u,d]=S.useState(0),[h,f]=S.useState(80),m=S.useRef(-1);S.useEffect(()=>{if(r||l)return;const p=setInterval(()=>{i(x=>{const g=x+1*e;return g>=100?(c("BRENT! "),setTimeout(()=>{c(null),i(0)},1e3),0):g})},50),v=setInterval(()=>{f(x=>{let y=x+.8*m.current;return y>90?(m.current=-1,90):y<40?(m.current=1,40):y})},50);return()=>{clearInterval(p),clearInterval(v)}},[r,l,e]),S.useEffect(()=>{const p=v=>{v.code==="Space"&&(v.preventDefault(),b())};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[r,l,n,h]);const b=()=>{if(r||l)return;const p=h-10,v=h+10;n>p&&n<v?(c("PERFEKT GYLLEN! "),d(x=>{const g=x+1;return g>=3&&(a(!0),setTimeout(()=>t(1),1e3)),g})):n<p?c("R... "):c("LITT BRENT... "),setTimeout(()=>{c(null),i(0)},1e3)};return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/bakery_bg.png")',backgroundSize:"cover",backgroundColor:"#451a03"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Bakeri: Steking "}),o.jsxs("div",{className:"relative z-10 w-64 h-64 bg-slate-900 border-8 border-amber-900 rounded-3xl flex items-center justify-center overflow-hidden mb-12 shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 bg-orange-500/10 animate-pulse"}),o.jsx("div",{className:"text-8xl transition-all duration-300 transform",style:{filter:`grayscale(${100-n}%) sepia(${n}%)`,transform:`scale(${.8+n/500})`},children:s}),l&&o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white font-black text-2xl p-4 animate-in zoom-in",children:l})]}),o.jsxs("div",{className:`relative z-10 w-full max-w-sm h-8 bg-white/10 rounded-full mb-12 border ${n>h-10&&n<h+10?"border-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.5)]":"border-white/10"} overflow-hidden transition-all shadow-2xl`,children:[o.jsx("div",{className:"absolute inset-y-0 bg-emerald-500/30 border-x border-emerald-500/50 transition-all duration-75 ease-linear",style:{left:`${h-10}%`,right:`${100-(h+10)}%`},children:n>h-10&&n<h+10&&o.jsx("div",{className:"absolute inset-0 bg-emerald-400/20 animate-pulse"})}),o.jsx("div",{className:"h-full bg-orange-500 transition-all duration-75 relative z-10 opacity-80",style:{width:`${n}% `}}),o.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white/50 z-20",style:{left:`${h}%`}})]}),o.jsx("div",{className:"relative z-10 flex gap-4 mb-8",children:[...Array(3)].map((p,v)=>o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-2xl border-2 transition-all ${u>v?"bg-amber-500 border-amber-300 scale-110 shadow-lg":"bg-white/5 border-white/10 opacity-30"} `,children:s},v))}),o.jsx("button",{onClick:b,className:"relative z-10 w-full max-w-sm bg-amber-600 hover:bg-amber-500 text-white py-6 rounded-2xl font-black text-2xl shadow-xl active:scale-95 transition-all uppercase tracking-widest border-b-8 border-amber-800",children:"TA UT N! "})]})},lee=(t,e)=>{if(e)return e.find(s=>{var r;if(!s)return!1;const n=Object.keys(Ke).find(a=>s.id===a||s.id.startsWith(a+"_")),i=n?Ke[n]:null;return(r=i==null?void 0:i.relevantActions)==null?void 0:r.includes(t)})},cee=({onComplete:t,equipment:e=[]})=>{const[s,n]=S.useState(0),[i,r]=S.useState(!1),[a,l]=S.useState(!1),[c,u]=S.useState(0),[d,h]=S.useState({x:50,y:50}),[f,m]=S.useState(!1),b=()=>h({x:20+Math.random()*60,y:20+Math.random()*60}),p=x=>{if(a)return;l(!0),r(!0);const g=s+1;n(g);const y=g>5,w=g>2?`${g}x COMBO!`:y?"FLAWLESS!":"TREFF!",k=y?"text-amber-400 font-display":"text-white";Ze.spawnFloatingText(w,x.clientX,x.clientY-40,k),Ze.spawnParticles(x.clientX,x.clientY,y?"bg-amber-400":"bg-white"),setTimeout(()=>{l(!1),r(!1),u(N=>(N+1>=10&&(m(!0),Ze.spawnFloatingText("FULLFRT! ",x.clientX,x.clientY-100,"text-emerald-400 text-2xl"),setTimeout(()=>t(1),1200)),N+1)),b()},80)},v=lee("CHOP",e);return o.jsxs("div",{className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${i?"animate-shake":""} `,style:{backgroundImage:'url("/images/minigames/forestry_bg.png")',backgroundSize:"cover"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/60 z-0"}),o.jsx("div",{className:"relative z-10 w-full mb-8",children:o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx("h2",{className:"text-4xl font-black text-white drop-shadow-lg tracking-tighter uppercase",children:"Tmmerhogging"}),o.jsxs("div",{className:"flex gap-4",children:[o.jsxs("div",{className:"text-amber-400 font-black uppercase tracking-widest text-xs px-4 py-1 bg-black/40 rounded-full inline-block border border-amber-500/20",children:["Framdrift: ",c,"/10"]}),s>0&&o.jsxs("div",{className:"text-rose-500 font-black uppercase tracking-widest text-xs px-4 py-1 bg-rose-500/10 rounded-full inline-block border border-rose-500/30 animate-bounce",children:["COMBO: x",s]}),v&&o.jsxs("div",{className:"text-indigo-400 font-black uppercase tracking-widest text-xs px-4 py-1 bg-indigo-500/10 rounded-full inline-block border border-indigo-500/30",children:[v.icon," ",v.name]})]})]})}),o.jsxs("div",{className:`relative z-10 w-full h-96 bg-white/5 rounded-[3rem] border border-white/10 shadow-inner overflow-hidden ${a?"opacity-90 grayscale-[0.5]":""}`,children:[o.jsx("div",{className:"absolute bottom-0 left-0 h-2 bg-indigo-500/50 transition-all duration-300 z-0",style:{width:`${c/10*100}%`}}),f?o.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[o.jsx("div",{className:"animate-bounce text-5xl font-black text-amber-500 uppercase tracking-tighter drop-shadow-2xl",children:"VEDHOGST FERDIG! "}),o.jsxs("div",{className:"text-xl font-black text-white uppercase tracking-widest bg-indigo-600 px-8 py-2 rounded-full shadow-lg",children:["Maks Combo: ",s]})]}):o.jsx("button",{onClick:p,onKeyDown:x=>{x.key===" "&&x.preventDefault()},className:`absolute w-20 h-20 bg-rose-500 rounded-full border-4 border-white shadow-[0_0_30px_rose] transition-all active:scale-90 ${a?"scale-110 brightness-150":"animate-pulse cursor-pointer"}`,style:{left:`${d.x}%`,top:`${d.y}%`,transform:"translate(-50%, -50%)"},children:""})]})]})},uee=(t,e)=>{if(e)return e.find(s=>{var r;if(!s)return!1;const n=Object.keys(Ke).find(a=>s.id===a||s.id.startsWith(a+"_")),i=n?Ke[n]:null;return(r=i==null?void 0:i.relevantActions)==null?void 0:r.includes(t)})},vT=({onComplete:t,equipment:e=[],speedMultiplier:s=1,possibleYield:n=10,resourceName:i="Korn"})=>{const[r,a]=S.useState(0),[l,c]=S.useState(0),[u,d]=S.useState(!1),[h,f]=S.useState(!1),[m,b]=S.useState(!1),p=()=>{u||m||a(v=>{var g;const x=v+2*s;if(x>=100){const y=uee("WORK",e),w=((g=y==null?void 0:y.stats)==null?void 0:g.yieldBonus)||0,k=Math.ceil(n/5*1.25),N=Math.ceil(w/5*1.25);return f(!0),b(!0),Ze.spawnFloatingText(`+ ${k} ${i} ${N>0?`(+${N})`:""} `,50,40,"text-amber-400 font-black text-xl"),Ze.spawnParticles(50,50,"bg-emerald-400"),setTimeout(()=>{f(!1),b(!1)},100),c(_=>(_+1>=5&&(d(!0),setTimeout(()=>t(1),800)),_+1)),0}return x})};return o.jsxs("div",{onMouseMove:p,className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${h?"animate-shake":""} `,style:{backgroundImage:'url("/images/minigames/agriculture_bg.png")',backgroundSize:"cover"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/50 z-0 transition-all duration-75 ${m?"bg-emerald-900/40 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 w-full flex flex-col items-center transition-all duration-75 ${m?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-3xl font-black text-white mb-4",children:"Scythe Sweep"}),o.jsx("div",{className:"w-full h-4 bg-white/10 rounded-full mb-8 border border-white/20 overflow-hidden",children:o.jsx("div",{className:"h-full bg-amber-400 transition-all duration-75",style:{width:`${r}% `}})}),o.jsx("div",{className:"grid grid-cols-5 gap-2",children:[...Array(5)].map((v,x)=>o.jsx("div",{className:`w-8 h-8 rounded-lg border-2 ${l>x?"bg-amber-500 border-amber-300":"border-white/20"} `},x))}),o.jsx("div",{className:"mt-8 text-slate-400 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Beveg musen raskt frem og tilbake!"})]})]})},yT=({onComplete:t,speedMultiplier:e=1,variant:s="water"})=>{const[n,i]=S.useState(0),[r,a]=S.useState(0),[l,c]=S.useState(!1),[u,d]=S.useState(50),[h,f]=S.useState(1),[m,b]=S.useState(!1);S.useEffect(()=>{if(l)return;const v=setInterval(()=>{i(x=>{let g=3/e,y=x+g*h;return y>100?(f(-1),100):y<0?(f(1),0):y})},16);return()=>clearInterval(v)},[h,l,e]);const p=()=>{if(Math.abs(n-u)<10)b(!0),setTimeout(()=>b(!1),200),a(x=>{const g=s==="land"?"FANGST! ":"NAPP! ";return Ze.spawnFloatingText(g,50,40,"text-emerald-400 font-black text-3xl"),Ze.spawnParticles(50,50,"bg-emerald-400"),x+1>=3&&(c(!0),setTimeout(()=>t(1),1e3)),x+1}),d(20+Math.random()*60);else{b(!0),setTimeout(()=>b(!1),200);const x=s==="land"?"BOM... ":"INGENTING... ";Ze.spawnFloatingText(x,50,40,"text-rose-400 font-bold text-xl")}};return o.jsxs("div",{className:`p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden transition-transform ${m?"animate-shake":""}`,style:{backgroundImage:s==="land"?'url("/images/textures/bark.png")':'url("/images/minigames/foraging_bg.png")',backgroundColor:s==="land"?"#2f3e28":"#0c4a6e",backgroundSize:"cover"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-12 tracking-tighter uppercase italic drop-shadow-lg",children:s==="land"?"Fellefangst ":"Snarefiske "}),o.jsxs("div",{className:"relative z-10 w-full max-w-sm h-12 bg-white/5 rounded-full border border-white/10 mb-12 shadow-inner overflow-hidden",children:[o.jsx("div",{className:"absolute inset-y-0 w-20 bg-amber-500/40 border-x-2 border-amber-500/50 rounded-lg blur-[1px]",style:{left:`${u}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_15px_white] z-20",style:{left:`${n}%`}})]}),o.jsx("div",{className:"relative z-10 flex gap-4 mb-12",children:[...Array(3)].map((v,x)=>o.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl border-2 transition-all duration-300 ${r>x?"bg-emerald-500 border-emerald-300 scale-110 shadow-[0_0_20px_rgba(16,185,129,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:r>x?s==="land"?"":"":""},x))}),o.jsx("button",{onClick:p,className:"relative z-10 w-full max-w-md bg-sky-600 hover:bg-sky-500 text-white py-8 rounded-[2rem] font-black text-3xl shadow-2xl active:scale-95 transition-all uppercase tracking-widest border-b-8 border-sky-800 active:border-b-0 active:translate-y-2 group",children:o.jsx("span",{className:"drop-shadow-md group-hover:scale-105 inline-block transition-transform",children:s==="land"?"SJEKK FELLA! ":"HAL INN! "})})]})},dee=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=S.useState("right"),[i,r]=S.useState(0),[a,l]=S.useState(!1),[c,u]=S.useState(null),d=h=>{a||h!==s&&(n(h),r(f=>{const m=f+5*e;return m>=100?(l(!0),setTimeout(()=>t(1),1e3),100):m}),u(h==="left"?"":""),setTimeout(()=>u(null),200))};return S.useEffect(()=>{const h=f=>{(f.key==="ArrowLeft"||f.key==="a"||f.key==="A")&&d("left"),(f.key==="ArrowRight"||f.key==="d"||f.key==="D")&&d("right")};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[s,a]),o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/weavery_bg.png")',backgroundSize:"cover",backgroundColor:"#1e1b4b"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Veveri: Vevstol "}),o.jsxs("div",{className:`relative z-10 w-full max-w-lg aspect-video bg-slate-900/50 border-4 rounded-3xl p-8 mb-12 flex flex-col justify-between overflow-hidden transition-all ${c?"brightness-125":""} ${s==="left"?"border-indigo-500/50 shadow-[inset_20px_0_40px_rgba(99,102,241,0.1)]":"border-emerald-500/50 shadow-[inset_-20px_0_40px_rgba(16,185,129,0.1)]"} `,children:[o.jsxs("div",{className:"flex justify-between items-center mb-8 relative h-32",children:[o.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 text-6xl transition-all duration-300 ease-out z-20",style:{left:s==="left"?"0%":"calc(100% - 4rem)",transform:`translateY(-50%) rotate(${s==="left"?"0deg":"180deg"})`},children:""}),o.jsx("div",{className:`text-6xl transition-all duration-500 ${s==="left"?"scale-110 opacity-100 rotate-12":"scale-75 opacity-20"} `,children:""}),o.jsx("div",{className:"absolute inset-x-0 h-1 bg-white/20 top-1/2 -translate-y-1/2 pointer-events-none"}),o.jsx("div",{className:`text-6xl transition-all duration-500 ${s==="right"?"scale-110 opacity-100 -rotate-12":"scale-75 opacity-20"} `,children:""})]}),o.jsx("div",{className:"text-sm font-black text-indigo-300 uppercase tracking-[0.3em] h-8 animate-pulse",children:c||"Veksle mellom Venstre / Hyre"})]}),o.jsxs("div",{className:"relative z-10 flex gap-12 mb-8",children:[o.jsx("button",{onClick:()=>d("left"),className:`w-28 h-28 rounded-[2rem] flex items-center justify-center text-4xl border-4 transition-all active:scale-90 ${s==="right"?"bg-indigo-600 border-indigo-400 scale-110 shadow-[0_0_30px_rgba(99,102,241,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:""}),o.jsx("button",{onClick:()=>d("right"),className:`w-28 h-28 rounded-[2rem] flex items-center justify-center text-4xl border-4 transition-all active:scale-90 ${s==="left"?"bg-emerald-600 border-emerald-400 scale-110 shadow-[0_0_30px_rgba(16,185,129,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:""})]}),o.jsx("div",{className:"relative z-10 w-full max-w-sm h-4 bg-white/10 rounded-full border border-white/10 overflow-hidden",children:o.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${i}% `}})})]})},hee=({onComplete:t,speedMultiplier:e=1})=>{var b;const[s,n]=S.useState([]),[i,r]=S.useState([]),[a,l]=S.useState(0),[c,u]=S.useState(!1),[d,h]=S.useState(null),f=[{id:"red",icon:"",label:"Rdurt"},{id:"blue",icon:"",label:"Blbr"},{id:"green",icon:"",label:"Grnnmose"},{id:"yellow",icon:"",label:"Gulrot"}];S.useEffect(()=>{const p=[];for(let v=0;v<5;v++)p.push(f[Math.floor(Math.random()*f.length)].id);n(p)},[]);const m=p=>{if(!(c||d))if(p===s[a]){const v=a+1;r(x=>[...x,p]),l(v),h("RIKTIG! "),setTimeout(()=>h(null),500),v>=s.length&&(u(!0),setTimeout(()=>t(1),1e3))}else h("FEIL... "),l(0),r([]),setTimeout(()=>h(null),1e3)};return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/apothecary_bg.png")',backgroundSize:"cover",backgroundColor:"#2e1065"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Apoteker: Brygging "}),o.jsx("div",{className:"relative z-10 mb-12 flex gap-4 h-24 items-center",children:s.map((p,v)=>{var x;return o.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl transition-all border-2 border-white/10 ${a>v?"opacity-10 scale-90":"bg-black/40 scale-100"} `,children:(x=f.find(g=>g.id===p))==null?void 0:x.icon},v)})}),d&&o.jsx("div",{className:`relative z-10 text-3xl font-black mb-8 animate-in zoom-in ${d.includes("FEIL")?"text-rose-500":"text-emerald-400"} `,children:d}),o.jsxs("div",{className:"relative z-10 w-48 h-64 bg-white/5 border-4 border-white/20 rounded-b-[4rem] rounded-t-3xl overflow-hidden mb-12 shadow-inner",children:[o.jsx("div",{className:"absolute bottom-0 inset-x-0 transition-all duration-1000 ease-out",style:{height:`${a/s.length*100}%`,backgroundColor:a>0?(b=f.find(p=>p.id===s[a-1]))==null?void 0:b.id:"transparent",opacity:.6},children:o.jsx("div",{className:"absolute top-0 inset-x-0 h-4 bg-white/20 animate-pulse pointer-events-none"})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-6xl opacity-20 transition-transform duration-500 scale-125",children:""})]}),o.jsx("div",{className:"relative z-10 grid grid-cols-2 gap-4",children:f.map(p=>o.jsxs("button",{onClick:()=>m(p.id),className:`w-32 h-32 bg-slate-900/80 border-2 rounded-3xl flex flex-col items-center justify-center transition-all active:scale-90 shadow-xl group ${d==="RIKTIG! "&&s[a-1]===p.id?"border-emerald-500 scale-105 shadow-emerald-500/20":"border-white/20 hover:border-white/40"} `,children:[o.jsx("span",{className:"text-4xl mb-2 group-hover:scale-110 transition-transform",children:p.icon}),o.jsx("span",{className:"font-bold text-white uppercase text-sm",children:p.label})]},p.id))})]})},fee=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=S.useState(0),[i,r]=S.useState(0),[a,l]=S.useState(!0),[c,u]=S.useState(0),[d,h]=S.useState(!1),[f,m]=S.useState(1);S.useEffect(()=>{if(d)return;const p=setInterval(()=>{u(v=>{let x=v+f*3*e;return x>=100?(m(-1),100):x<=0?(m(1),0):x})},16);return()=>clearInterval(p)},[f,d,e]);const b=S.useCallback(p=>{if(d)return;const v=Math.abs(c-50),x=v<15,g=v>35;let y=0,w="",k="";x?(y=1,w="PERFEKT!",k="text-amber-400"):g?(y=.1,w="BOM!",k="text-rose-400"):(y=.5,w="BRA!",k="text-emerald-400");const N="clientX"in p?p.clientX:p.touches[0].clientX,_="clientY"in p?p.clientY:p.touches[0].clientY;Ze.spawnFloatingText(w,N,_-40,k),y>.1&&Ze.spawnParticles(N,_,y===1?"bg-amber-400":"bg-emerald-400"),r(E=>E+1),l(!a);const T=y*10;n(E=>{const A=E+T;return A>=100?(h(!0),Ze.spawnFloatingText("PLANKER FERDIG! ",N,_-100,"text-emerald-400 text-2xl font-black"),setTimeout(()=>t(1),1e3),100):A})},[c,d,a,t]);return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 bg-slate-950 z-0",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 bg-[url('/images/textures/wood_pattern.png')] bg-repeat"}),o.jsx("div",{className:"absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-indigo-500/10 to-transparent"})]}),o.jsxs("div",{className:"relative z-10 w-full mb-12",children:[o.jsx("h2",{className:"text-5xl font-black text-white uppercase tracking-tighter mb-2 italic drop-shadow-[0_0_20px_rgba(255,255,255,0.2)]",children:"Saging"}),o.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-[0.3em] text-xs",children:"Pull og Push i takt for perfekte planker"})]}),o.jsxs("div",{className:"relative z-10 w-full max-w-2xl h-64 bg-slate-900/50 rounded-[3rem] border border-white/5 shadow-2xl overflow-hidden flex items-center justify-center group cursor-pointer",onClick:b,children:[o.jsx("div",{className:"absolute inset-y-0 left-0 bg-indigo-500/20 transition-all duration-500 z-0",style:{width:`${s}%`}}),o.jsxs("div",{className:"relative w-4/5 h-16 bg-[#3d2b1f] rounded-lg border-2 border-[#2a1d15] shadow-2xl flex items-center",children:[o.jsx("div",{className:"absolute inset-0 opacity-30 bg-[url('/images/textures/bark.png')] bg-cover mix-blend-overlay"}),o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 transition-transform duration-300 ${a?"-rotate-12 translate-x-4":"rotate-12 -translate-x-4"}`,children:o.jsx("div",{className:"text-6xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]",children:""})}),o.jsxs("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 flex gap-1 opacity-40",children:[o.jsx("div",{className:"w-1 h-1 bg-amber-200 rounded-full animate-ping"}),o.jsx("div",{className:"w-1 h-1 bg-amber-400 rounded-full animate-ping delay-75"}),o.jsx("div",{className:"w-1 h-1 bg-amber-100 rounded-full animate-ping delay-150"})]})]})]}),o.jsxs("div",{className:"relative z-10 mt-12 w-full max-w-md h-12 bg-black/40 rounded-full border border-white/10 p-1 flex items-center shadow-inner",children:[o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-1/4 h-3/4 bg-amber-500/20 blur-sm rounded-full"}),o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-[2px] h-full bg-amber-500/50"}),o.jsx("div",{className:"absolute w-8 h-8 bg-white rounded-full shadow-[0_0_20px_white] flex items-center justify-center transition-all duration-16 ease-linear",style:{left:`${c}%`,transform:"translateX(-50%)"},children:o.jsx("div",{className:"w-4 h-4 bg-indigo-500 rounded-full animate-pulse"})})]}),o.jsxs("div",{className:"relative z-10 mt-8",children:[o.jsxs("div",{className:"text-3xl font-black text-indigo-400 italic",children:[s.toFixed(0),"%"]}),o.jsxs("div",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-2",children:["Stroke: ",i]})]}),o.jsx("div",{className:"absolute inset-0 z-20 cursor-pointer",onClick:b})]})},mee=({onComplete:t,speedMultiplier:e=1})=>{const s=S.useRef(20),n=S.useRef(0),i=S.useRef(0),r=S.useRef({min:60,max:85}),a=.025*e,l=1.5,c=3,[u,d]=S.useState("playing"),[h,f]=S.useState(0),m=S.useRef(void 0),b=S.useRef(void 0),p=S.useCallback(x=>{if(u==="playing"){if(b.current!==void 0){n.current-=a,s.current+=n.current,s.current<0?(s.current=0,n.current=0):s.current>100&&(s.current=100,n.current=-n.current*.5);const g=s.current>=r.current.min&&s.current<=r.current.max;if(g?(n.current*=.9,i.current+=.15*e):i.current=Math.max(0,i.current-.05),i.current>=100){d("won"),t(1);return}g?Math.random()>.8?f(1):f(0):s.current>90?f(3):f(0)}b.current=x,m.current=requestAnimationFrame(p)}},[u,t,e,a]);S.useEffect(()=>(m.current=requestAnimationFrame(p),()=>{m.current&&cancelAnimationFrame(m.current)}),[p]);const v=S.useCallback(()=>{u==="playing"&&(n.current+=l,n.current=Math.min(n.current,c))},[u,l]);return{heatRef:s,progressRef:i,targetRange:r.current,gameState:u,shakeIntensity:h,pump:v}},pee=({heatRef:t,targetRange:e})=>{const s=S.useRef(null),n=S.useRef(null);return S.useEffect(()=>{let i;const r=()=>{const a=t.current;s.current&&(s.current.style.height=`${a}%`,a>90?s.current.style.filter=`hue-rotate(${Math.sin(Date.now()/50)*10}deg) brightness(1.2)`:s.current.style.filter="none"),n.current&&(n.current.style.opacity=`${a/100}`),i=requestAnimationFrame(r)};return i=requestAnimationFrame(r),()=>cancelAnimationFrame(i)},[t]),o.jsxs("div",{className:"relative w-24 h-96 bg-slate-900 rounded-full border-4 border-slate-700 shadow-2xl overflow-hidden backdrop-blur-sm",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 flex flex-col justify-between py-4 px-2",children:[...Array(10)].map((i,r)=>o.jsx("div",{className:"w-full h-px bg-white"},r))}),o.jsx("div",{className:"absolute w-full bg-green-500/20 border-y-2 border-green-500/50 z-10",style:{bottom:`${e.min}%`,height:`${e.max-e.min}%`},children:o.jsx("div",{className:"w-full h-full animate-pulse bg-green-400/10"})}),o.jsx("div",{className:"absolute bottom-0 w-full px-2 pb-2 transition-transform duration-75 ease-out z-20 h-full flex items-end pointer-events-none",children:o.jsx("div",{ref:s,className:"w-full rounded-b-full rounded-t-sm bg-gradient-to-t from-red-900 via-orange-600 to-yellow-300 shadow-[0_0_20px_rgba(255,165,0,0.6)]",style:{height:"0%",transition:"height 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)"}})}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 to-transparent pointer-events-none z-30 rounded-full"}),o.jsx("div",{ref:n,className:"absolute inset-0 z-0 bg-orange-500/30 blur-xl pointer-events-none transition-opacity duration-300"})]})},gee=({onPump:t})=>{const[e,s]=S.useState(!1),n=()=>{s(!0),t()},i=()=>{s(!1)};return o.jsxs("button",{onPointerDown:n,onPointerUp:i,onPointerLeave:i,"aria-label":"Pump Bellows",className:`
                relative group
                w-48 h-32 
                flex items-center justify-center
                transition-all duration-75 ease-out
                ${e?"scale-95":"scale-100 hover:scale-[1.02]"}
            `,children:[o.jsxs("div",{className:"absolute inset-0 bg-[#5d4037] rounded-xl shadow-[0_10px_0_#3e2723] active:shadow-none active:translate-y-[10px] transition-all duration-75 overflow-hidden border-2 border-[#8d6e63]",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 bg-[radial-gradient(circle,_transparent_20%,_#000_120%)]"}),o.jsxs("div",{className:"w-full h-full flex flex-col justify-between py-2 px-4 opacity-50",children:[o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"})]})]}),o.jsx("div",{className:"relative z-10 text-orange-100 font-black uppercase text-2xl tracking-widest drop-shadow-md select-none pointer-events-none",children:"PUMP"})]})},xee=({onComplete:t,speedMultiplier:e=1})=>{const{heatRef:s,progressRef:n,targetRange:i,shakeIntensity:r,gameState:a,pump:l}=mee({onComplete:t,speedMultiplier:e}),c=S.useRef(null),u=S.useRef(null);S.useEffect(()=>{let h;const f=()=>{if(c.current)if(r>0){const m=(Math.random()-.5)*r*4,b=(Math.random()-.5)*r*4;c.current.style.transform=`translate(${m}px, ${b}px)`}else c.current.style.transform="none";if(u.current){const m=n.current;u.current.style.background=`conic-gradient(#f97316 ${m}%, transparent 0)`;const b=u.current.querySelector('[data-role="progress-text"]');b&&(b.innerText=`${Math.floor(m)}%`)}h=requestAnimationFrame(f)};return h=requestAnimationFrame(f),()=>cancelAnimationFrame(h)},[r,n]);const d=()=>{if(l(),c.current){const h=c.current.getBoundingClientRect();Ze.spawnParticles(h.left+h.width/2,h.bottom-100,"bg-orange-200")}};return o.jsxs("div",{ref:c,className:"p-8 min-h-[600px] w-full relative flex flex-col items-center justify-center overflow-hidden select-none",style:{backgroundImage:'url("/images/minigames/smeltery_bg.png")',backgroundSize:"cover",backgroundColor:"#1a0f0a"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0 backdrop-blur-[2px]"}),o.jsxs("div",{className:"relative z-10 text-center mb-8",children:[o.jsx("h2",{className:"text-5xl font-black text-transparent bg-clip-text bg-gradient-to-br from-orange-400 to-red-600 uppercase tracking-tighter drop-shadow-2xl filter contrast-125",children:"Smelting"}),o.jsx("div",{className:"text-orange-200/80 font-bold uppercase tracking-[0.2em] text-xs mt-2",children:"Hold varmen i sonen"})]}),o.jsxs("div",{className:"relative z-10 flex gap-12 items-end",children:[o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx(pee,{heatRef:s,targetRange:i}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Heat"})]}),o.jsxs("div",{className:"flex flex-col items-center gap-4 mb-4",children:[o.jsxs("div",{role:"progressbar","aria-valuenow":Math.round(n.current),"aria-valuemin":0,"aria-valuemax":100,className:"relative w-32 h-32 rounded-full bg-slate-900 border-4 border-slate-700 shadow-xl flex items-center justify-center",children:[o.jsx("div",{ref:u,className:"absolute inset-0 rounded-full opacity-80",style:{background:"conic-gradient(#f97316 0%, transparent 0)"}}),o.jsx("div",{className:"absolute inset-2 bg-slate-900 rounded-full flex items-center justify-center",children:o.jsx("span",{"data-role":"progress-text",className:"text-3xl font-black text-white",children:"0%"})})]}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Fremgang"})]})]}),o.jsx("div",{className:"relative z-10 mt-12",children:o.jsx(gee,{onPump:d})}),a==="won"&&o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md animate-in fade-in duration-300",children:o.jsxs("div",{className:"flex flex-col items-center gap-4 animate-in zoom-in-50 duration-500",children:[o.jsx("div",{className:"text-7xl",children:""}),o.jsx("div",{className:"text-6xl font-black text-white tracking-tighter drop-shadow-[0_0_30px_rgba(249,115,22,0.8)]",children:"PERFEKT!"})]})})]})},_T={ride_easy:{speed:.012,spawnRate:80,targetDistance:8,label:"Engelskogen",colors:{sky:"#1e293b",path:"#451a03"},xpMult:1},ride_medium:{speed:.018,spawnRate:60,targetDistance:12,label:"Fjellpasset",colors:{sky:"#0f172a",path:"#262626"},xpMult:1.5},ride_hard:{speed:.025,spawnRate:45,targetDistance:15,label:"Ulvestien",colors:{sky:"#020617",path:"#171717"},xpMult:2.2}},bee={tree:"",house:"",cow:"",rock:"",bush:""},vee=({onComplete:t,speedMultiplier:e=1,levelId:s="ride_easy",level:n=1,horse:i})=>{const r=_T[s]||_T.ride_easy,a=1+(n-1)*.15,l=1-(n-1)*.1,c=1+(n-1)*.2,u=S.useRef(null),[d,h]=S.useState(!1),[f,m]=S.useState(0),[b,p]=S.useState(0),v=S.useRef({lane:1,targetLane:1,cameraTilt:0,isJumping:!1,jumpTime:0,obstacles:[],sideObjects:[],lastSpawn:0,lastSideSpawn:0,distance:0,speed:r.speed*e*a,gameOver:!1,bobAmt:0,ticks:0});return S.useEffect(()=>{const x=g=>{v.current.gameOver||(g.key==="a"||g.key==="ArrowLeft"?v.current.targetLane=Math.max(0,v.current.targetLane-1):g.key==="d"||g.key==="ArrowRight"?v.current.targetLane=Math.min(2,v.current.targetLane+1):g.code==="Space"&&!v.current.isJumping&&(v.current.isJumping=!0,v.current.jumpTime=0,Ye.playSfx("jump")))};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[]),S.useEffect(()=>{const x=u.current;if(!x)return;const g=x.getContext("2d");if(!g)return;let y;const w=()=>{if(v.current.gameOver)return;if(v.current.ticks++,v.current.distance+=v.current.speed,v.current.lane!==v.current.targetLane){const E=v.current.targetLane-v.current.lane;v.current.lane+=E*.2,Math.abs(v.current.targetLane-v.current.lane)<.01&&(v.current.lane=v.current.targetLane),v.current.cameraTilt=E*.15}else v.current.cameraTilt*=.9;if(v.current.isJumping&&(v.current.jumpTime+=.05,v.current.jumpTime>=Math.PI&&(v.current.isJumping=!1,v.current.jumpTime=0)),v.current.bobAmt=Math.sin(v.current.ticks*.2)*5,v.current.ticks-v.current.lastSpawn>r.spawnRate*l/e&&(Math.random()>.4&&v.current.obstacles.push({id:Date.now(),lane:Math.floor(Math.random()*3),z:0,type:Math.random()>.5?"log":"rock"}),v.current.lastSpawn=v.current.ticks),v.current.ticks-v.current.lastSideSpawn>15/e){const E=["tree","tree","bush","rock","house","cow"];v.current.sideObjects.push({id:Date.now(),side:Math.random()>.5?"left":"right",z:0,type:E[Math.floor(Math.random()*E.length)],offset:.2+Math.random()*.5}),v.current.lastSideSpawn=v.current.ticks}v.current.obstacles.forEach(E=>{if(E.z+=v.current.speed,E.z>.88&&E.z<.96){const A=Math.round(v.current.lane);if(E.lane===A){const R=E.type==="log",I=v.current.isJumping&&Math.sin(v.current.jumpTime)>.6;R&&I||k()}}}),v.current.sideObjects.forEach(E=>{E.z+=v.current.speed}),v.current.obstacles=v.current.obstacles.filter(E=>E.z<1.05),v.current.sideObjects=v.current.sideObjects.filter(E=>E.z<1.05);const T=v.current.distance;m(Math.floor(T*100)),T>=r.targetDistance*c&&N(1)},k=()=>{p(15),v.current.speed*=.6,Ze.spawnFloatingText("OUCH!",50,40,"text-rose-500 font-black text-3xl"),v.current.obstacles=v.current.obstacles.filter(T=>T.z<.85),setTimeout(()=>p(0),300)},N=T=>{v.current.gameOver||(v.current.gameOver=!0,h(!0),setTimeout(()=>t(T),2e3))},_=()=>{var U,C;if(!g)return;g.clearRect(0,0,x.width,x.height);const T=v.current.cameraTilt;g.save(),g.translate(x.width/2,x.height/2),g.rotate(T),g.translate(-x.width/2,-x.height/2);const E=g.createLinearGradient(0,0,0,x.height);E.addColorStop(0,r.colors.sky),E.addColorStop(.5,"#334155"),E.addColorStop(.5,"#064e3b"),E.addColorStop(1,"#065f46"),g.fillStyle=E,g.fillRect(-x.width*.5,0,x.width*2,x.height),g.beginPath(),g.moveTo(x.width*.45,x.height*.5),g.lineTo(x.width*.55,x.height*.5),g.lineTo(x.width*1.3,x.height),g.lineTo(x.width*-.3,x.height),g.closePath(),g.fillStyle=r.colors.path,g.fill(),g.strokeStyle="rgba(255,255,255,0.15)",g.setLineDash([20,10]),g.lineWidth=4,[.33,.66].forEach(j=>{g.beginPath(),g.moveTo(x.width*(.45+j*.1),x.height*.5),g.lineTo(x.width*(-.3+j*1.6),x.height),g.stroke()}),g.setLineDash([]),v.current.sideObjects.forEach(j=>{const $=j.z*j.z,B=x.height*.5,D=B+(x.height-B)*$,z=x.width*.1+x.width*1.6*$,J=z*j.offset+z*.1,Y=x.width*.5+(j.side==="left"?-J:J),fe=20+200*$;g.save(),g.translate(Y,D),g.font=`${fe}px serif`,g.textAlign="center",g.textBaseline="bottom",g.globalAlpha=j.z>.95?Math.max(0,1-(j.z-.95)*10):1,g.fillText(bee[j.type]||"",0,0),g.restore()}),v.current.obstacles.forEach(j=>{const $=j.z*j.z,B=x.height*.5,D=B+(x.height-B)*$,z=x.width*.1+x.width*1.6*$,J=x.width*.5+(j.lane-1)*(z/3),Y=30+150*$,fe=j.z>.95?Math.max(0,1-(j.z-.95)*10):1;g.save(),g.globalAlpha=fe,g.translate(J,D),j.type==="log"?(g.fillStyle="#78350f",g.fillRect(-Y/2,-Y/6,Y,Y/3),g.strokeStyle="#451a03",g.lineWidth=2,g.strokeRect(-Y/2,-Y/6,Y,Y/3)):(g.fillStyle="#475569",g.beginPath(),g.arc(0,0,Y/2,0,Math.PI*2),g.fill(),g.strokeStyle="#1e293b",g.stroke()),g.restore()}),g.restore();const A=v.current.lane,R=x.width*.5+(A-1)*(x.width*.45);g.save(),g.fillStyle="rgba(0,0,0,0.3)",g.beginPath(),g.ellipse(R,x.height-40,60,20,0,0,Math.PI*2),g.fill(),g.restore(),g.save(),g.strokeStyle="rgba(255,255,255,0.1)",g.lineWidth=2;for(let j=0;j<10;j++){const $=(v.current.ticks*20+j*200)%x.width,B=j*77%x.height;g.beginPath(),g.moveTo($,B),g.lineTo($+50,B),g.stroke()}g.restore();const I=v.current.bobAmt,V=v.current.isJumping?-Math.sin(v.current.jumpTime)*120:0,H=i!=null&&i.skinId&&{brown:"#8B4513",white:"#E2E8F0",black:"#1A202C",golden:"#F6E05E",chestnut:"#7C2D12",grey:"#94A3B8"}[i.skinId]||"#8B4513";g.save(),g.translate(R+(b>0?(Math.random()-.5)*b:0),x.height-110+I+V),g.rotate(T*.5),g.fillStyle=H,g.beginPath(),g.ellipse(0,150,80,200,0,0,Math.PI*2),g.fill(),g.beginPath(),g.ellipse(0,0,40,70,0,0,Math.PI*2),g.fill(),g.fillStyle=(i==null?void 0:i.skinId)==="black"||(i==null?void 0:i.skinId)==="chestnut"?"#020617":"#451a03",g.beginPath(),g.ellipse(0,40,30,40,0,0,Math.PI*2),g.fill(),g.fillStyle=H,g.beginPath(),g.moveTo(-30,-50),g.lineTo(-40,-90),g.lineTo(-10,-60),g.fill(),g.beginPath(),g.moveTo(30,-50),g.lineTo(40,-90),g.lineTo(10,-60),g.fill();const P=(i==null?void 0:i.maneColor)||"#1e1b4b";if(P==="rainbow"){const j=g.createLinearGradient(-10,-60,20,100);j.addColorStop(0,"#f43f5e"),j.addColorStop(.3,"#fbbf24"),j.addColorStop(.6,"#10b981"),j.addColorStop(1,"#6366f1"),g.fillStyle=j}else g.fillStyle=P;if(g.fillRect(-10,-60,20,100),i!=null&&i.hatId&&(i==null?void 0:i.hatId)!=="none"){const j={straw_hat:"",cowboy_hat:"",crown:"",viking:"",tophat:""}[i.hatId];j&&(g.font="60px serif",g.textAlign="center",g.fillText(j,0,-60))}g.restore();const O=v.current.distance/(r.targetDistance*c),L=x.width*.6,M=(x.width-L)/2,F=20;g.fillStyle="rgba(0,0,0,0.5)",(U=g.roundRect)==null||U.call(g,M,F,L,10,5),g.fill(),g.fillStyle="#fbbf24",(C=g.roundRect)==null||C.call(g,M,F,L*Math.min(1,O),10,5),g.fill(),g.fillStyle="white",g.font="bold 12px Inter",g.textAlign="center",g.fillText(r.label.toUpperCase()+` - NIV ${n}`,x.width/2,F+25),w(),y=requestAnimationFrame(_)};return _(),()=>cancelAnimationFrame(y)},[e]),o.jsxs("div",{className:"relative w-full h-[600px] bg-slate-950 overflow-hidden flex flex-col items-center justify-center",children:[o.jsx("canvas",{ref:u,width:800,height:600,className:"w-full h-full object-cover"}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col items-center justify-between p-12",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-4xl font-black text-white italic tracking-tighter uppercase drop-shadow-[0_0_10px_rgba(0,0,0,0.5)]",children:"Galopp!"}),o.jsx("p",{className:"text-amber-400 font-bold uppercase tracking-widest text-sm",children:"Bruk A/D for  bytte bane, SPACE for  hoppe"})]}),d&&o.jsxs("div",{className:"bg-slate-950/80 backdrop-blur-xl p-12 rounded-[3rem] border-2 border-amber-500 animate-in zoom-in duration-300",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-5xl font-black text-white italic mb-2",children:"RITT FULLFRT!"}),o.jsxs("p",{className:"text-xl text-slate-400 font-bold uppercase",children:["Du red ",f," meter"]})]})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",children:o.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,transparent_0%,rgba(255,255,255,0.1)_100%)]"})})]})},wT=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=S.useState(0),[i,r]=S.useState(5),[a,l]=S.useState(!1),[c,u]=S.useState(50),[d,h]=S.useState(50),f=S.useRef(0),m=S.useRef(0),[b,p]=S.useState({x:50,y:50});S.useEffect(()=>{if(a)return;const x=()=>{f.current+=.02*e;const g=Math.sin(f.current)*4+Math.cos(f.current*2.3)*2,y=Math.cos(f.current*.8)*3+Math.sin(f.current*1.5)*1.5;u(50+g),h(50+y),m.current=requestAnimationFrame(x)};return m.current=requestAnimationFrame(x),()=>cancelAnimationFrame(m.current)},[a,e]);const v=()=>{if(a||i<=0)return;const x=c-b.x,g=d-b.y,y=Math.sqrt(x*x+g*g);let w=0,k="BOM!",N="text-rose-500";y<3?(w=50,k="BULLSEYE! ",N="text-amber-400",Ze.spawnParticles(50,50,"bg-amber-400")):y<8?(w=20,k="TREFF!",N="text-emerald-400",Ze.spawnParticles(50,50,"bg-white")):y<15&&(w=5,k="KANTEN...",N="text-slate-400"),Ze.spawnFloatingText(k,50,40,N),n(_=>_+w),r(_=>{const T=_-1;if(T<=0){l(!0);let E=.5;s+w>=100?E=1.2:s+w>=50?E=1:E=.8,setTimeout(()=>t(E),2e3)}else p({x:45+Math.random()*10,y:45+Math.random()*10});return T})};return o.jsxs("div",{onClick:v,className:"relative w-full h-[600px] overflow-hidden bg-slate-900 cursor-crosshair select-none group",style:{backgroundImage:'url("/images/minigames/forestry_bg.png")',backgroundSize:"cover",backgroundPosition:"center 30%"},children:[o.jsx("div",{className:"absolute inset-0 bg-radial-gradient from-transparent to-black/60 pointer-events-none"}),o.jsx("div",{className:"absolute w-32 h-32 rounded-full bg-white border-4 border-slate-800 shadow-2xl flex items-center justify-center transition-all duration-500",style:{left:`${b.x}%`,top:`${b.y}%`,transform:"translate(-50%, -50%) scale(0.8)"},children:o.jsx("div",{className:"w-24 h-24 rounded-full bg-rose-600 border-4 border-white flex items-center justify-center",children:o.jsx("div",{className:"w-16 h-16 rounded-full bg-white border-4 border-rose-600 flex items-center justify-center",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-rose-600 shadow-inner"})})})}),o.jsx("div",{className:"absolute pointer-events-none transition-transform duration-75 ease-out z-20",style:{left:`${c}%`,top:`${d}%`,transform:"translate(-50%, -50%)"},children:o.jsxs("div",{className:"relative w-16 h-16 opacity-80",children:[o.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-white shadow-sm"}),o.jsx("div",{className:"absolute left-1/2 top-0 h-full w-0.5 bg-white shadow-sm"}),o.jsx("div",{className:"absolute inset-0 border-2 border-white/50 rounded-full"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-1 bg-red-500 rounded-full shadow-[0_0_10px_red]"})]})}),o.jsx("div",{className:"absolute bottom-0 right-10 w-96 h-96 pointer-events-none z-10 translate-y-10 rotate-[-10deg]",children:o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx("div",{className:"absolute bottom-0 right-20 w-8 h-80 bg-stone-800 rounded-full origin-bottom rotate-12"}),o.jsx("div",{className:"absolute bottom-20 right-24 w-0.5 h-[400px] bg-white/20 rotate-12 origin-bottom border-l border-dashed border-white/30"})]})}),o.jsxs("div",{className:"absolute top-8 left-8 text-white font-black text-2xl drop-shadow-md",children:["SCORE: ",o.jsx("span",{className:"text-amber-400",children:s})]}),o.jsx("div",{className:"absolute top-8 right-8 flex gap-2",children:[...Array(5)].map((x,g)=>o.jsx("div",{className:`text-3xl transition-opacity ${g<i?"opacity-100":"opacity-20 grayscale"}`,children:""},g))}),!a&&o.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-white/70 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Klikk for  skyte"}),a&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-50 animate-in fade-in run-in",children:o.jsx("h1",{className:"text-6xl font-black text-white italic uppercase tracking-tighter drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]",children:s>=100?"Mesterbueskytter!":"Ferdig!"})}),o.jsx("div",{className:"absolute inset-0 bg-stone-800 -z-10"})]})},wO=({level:t,upgrades:e=[],className:s,isMoving:n,customization:i,horseCustomization:r})=>{const a="#1e293b",l="#fbbf24",c="#94a3b8",u="#0f172a",d="#fcd34d",h=S.useMemo(()=>({chassis:(i==null?void 0:i.chassis)||"chassis_oak",wheels:(i==null?void 0:i.wheels)||(t===1?"wheels_wood":"wheels_iron"),cover:(i==null?void 0:i.cover)||"cover_canvas",lanterns:(i==null?void 0:i.lanterns)||"lantern_oil",flag:(i==null?void 0:i.flag)||"flag_none",skin:(i==null?void 0:i.skin)||"skin_ox",decor:(i==null?void 0:i.decor)||"decor_none",companion:(i==null?void 0:i.companion)||"companion_none"}),[i,t]);return o.jsxs("svg",{viewBox:"0 0 260 140",className:`${s} ${n?"animate-bounce":""}`,style:{animationDuration:"0.8s"},children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"rainbowGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#ff0000"}),o.jsx("stop",{offset:"20%",stopColor:"#ffff00"}),o.jsx("stop",{offset:"40%",stopColor:"#00ff00"}),o.jsx("stop",{offset:"60%",stopColor:"#00ffff"}),o.jsx("stop",{offset:"80%",stopColor:"#0000ff"}),o.jsx("stop",{offset:"100%",stopColor:"#ff00ff"})]}),o.jsxs("filter",{id:"glow",children:[o.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("ellipse",{cx:"130",cy:"110",rx:"100",ry:"10",fill:"rgba(0,0,0,0.15)"}),(()=>{const f=t>1,m=h.wheels==="wheels_iron"?"#475569":h.wheels==="wheels_spiked"?"#334155":"#78350f",b=h.wheels==="wheels_spiked"?"#94a3b8":"#000";return f?o.jsxs("g",{children:[o.jsxs("g",{transform:"translate(60, 95)",children:[o.jsx("circle",{r:"15",fill:m,stroke:b,strokeWidth:"2"}),o.jsx("circle",{r:"4",fill:u}),h.wheels==="wheels_spiked"&&o.jsxs(o.Fragment,{children:[o.jsx("path",{d:"M 0 -17 L 3 -14 L -3 -14 Z",fill:"#94a3b8"}),o.jsx("path",{d:"M 0 17 L 3 14 L -3 14 Z",fill:"#94a3b8",transform:"rotate(180)"}),o.jsx("path",{d:"M 17 0 L 14 3 L 14 -3 Z",fill:"#94a3b8",transform:"rotate(90)"}),o.jsx("path",{d:"M -17 0 L -14 3 L -14 -3 Z",fill:"#94a3b8",transform:"rotate(-90)"})]})]}),o.jsxs("g",{transform:"translate(140, 95)",children:[o.jsx("circle",{r:"15",fill:m,stroke:b,strokeWidth:"2"}),o.jsx("circle",{r:"4",fill:u}),h.wheels==="wheels_spiked"&&o.jsxs(o.Fragment,{children:[o.jsx("path",{d:"M 0 -17 L 3 -14 L -3 -14 Z",fill:"#94a3b8"}),o.jsx("path",{d:"M 0 17 L 3 14 L -3 14 Z",fill:"#94a3b8",transform:"rotate(180)"}),o.jsx("path",{d:"M 17 0 L 14 3 L 14 -3 Z",fill:"#94a3b8",transform:"rotate(90)"}),o.jsx("path",{d:"M -17 0 L -14 3 L -14 -3 Z",fill:"#94a3b8",transform:"rotate(-90)"})]})]})]}):o.jsxs("g",{transform:"translate(100, 100)",children:[o.jsx("circle",{r:"10",fill:m,stroke:b,strokeWidth:"1.5"}),h.wheels==="wheels_spiked"&&o.jsx("path",{d:"M 0 -12 L 2 -10 L -2 -10 Z",fill:"#94a3b8"})]})})(),(()=>{const f=h.chassis==="chassis_gold"?d:h.chassis==="chassis_iron"?"#334155":a,m=h.chassis==="chassis_gold"?"#b45309":void 0;return t===1?o.jsxs("g",{children:[o.jsx("path",{d:"M 50 85 L 150 85 L 155 70 L 45 70 Z",fill:f,stroke:m}),o.jsx("rect",{x:"55",y:"60",width:"30",height:"15",fill:c,opacity:"0.5"}),o.jsx("line",{x1:"150",y1:"80",x2:"175",y2:"80",stroke:f,strokeWidth:"4"})]}):o.jsxs("g",{children:[o.jsx("rect",{x:"40",y:"55",width:"120",height:"35",rx:"2",fill:f,stroke:m,strokeWidth:m?2:0}),(t>=4||h.chassis!=="chassis_oak")&&o.jsxs("g",{children:[o.jsx("rect",{x:"40",y:"55",width:"120",height:"4",fill:h.chassis==="chassis_gold"?"#fff":"#64748b",opacity:"0.5"}),o.jsx("rect",{x:"40",y:"86",width:"120",height:"4",fill:h.chassis==="chassis_gold"?"#fff":"#64748b",opacity:"0.5"})]}),o.jsx("line",{x1:"160",y1:"90",x2:"180",y2:"85",stroke:"#334155",strokeWidth:"3"})]})})(),h.decor==="decor_shields"&&t>1&&o.jsxs("g",{transform:"translate(45, 65)",children:[o.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"#ef4444",stroke:"#fff"}),o.jsx("circle",{cx:"30",cy:"10",r:"8",fill:"#3b82f6",stroke:"#fff"}),o.jsx("circle",{cx:"50",cy:"10",r:"8",fill:"#22c55e",stroke:"#fff"})]}),h.decor==="decor_flowers"&&t>1&&o.jsxs("g",{transform:"translate(45, 82)",children:[o.jsx("rect",{width:"110",height:"6",fill:"#78350f",rx:"2"}),o.jsx("circle",{cx:"20",cy:"-2",r:"3",fill:"#ec4899"}),o.jsx("circle",{cx:"40",cy:"-2",r:"3",fill:"#eab308"}),o.jsx("circle",{cx:"60",cy:"-2",r:"3",fill:"#a855f7"}),o.jsx("circle",{cx:"80",cy:"-2",r:"3",fill:"#ef4444"})]}),t>=3&&o.jsx("path",{d:"M 40 55 C 40 55 100 10 160 55 Z",fill:h.cover==="cover_stars"?"#1e1b4b":h.cover==="cover_silk"?"#f8fafc":h.cover==="cover_leather"?"#78350f":t>=5?"#1e1b4b":"#334155",stroke:u,strokeWidth:"1"}),h.cover==="cover_stars"&&t>=3&&o.jsxs("g",{clipPath:"url(#coverClip)",children:[o.jsx("circle",{cx:"80",cy:"40",r:"1",fill:"#fff"}),o.jsx("circle",{cx:"100",cy:"30",r:"1.5",fill:"#fff"}),o.jsx("circle",{cx:"120",cy:"45",r:"1",fill:"#fff"})]}),o.jsxs("g",{filter:"url(#glow)",children:[o.jsx("circle",{cx:t===1?140:160,cy:"45",r:h.lanterns==="lantern_fireflies"?4:3,fill:h.lanterns==="lantern_crystal"?"#3b82f6":h.lanterns==="lantern_fireflies"?"#84cc16":l}),h.lanterns==="lantern_fireflies"&&o.jsx(Z.circle,{cx:t===1?142:162,cy:"43",r:"1",fill:"#fff",animate:{opacity:[0,1,0]}}),o.jsx("rect",{x:t===1?138:158,y:"38",width:"4",height:"8",rx:"1",fill:a})]}),h.flag!=="flag_none"&&t>=2&&o.jsxs("g",{transform:"translate(160, 55)",children:[o.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-20",stroke:"#000",strokeWidth:"1"}),h.flag==="flag_pirate"?o.jsx("path",{d:"M 0 -20 L 15 -15 L 0 -10 Z",fill:"#000"}):o.jsx("path",{d:"M 0 -20 L 15 -15 L 0 -10 Z",fill:"#ef4444"})]}),h.companion==="companion_dog"&&o.jsxs("g",{transform:"translate(60, 55)",children:[o.jsx("path",{d:"M 0 0 Q 5 -10 10 0 Z",fill:"#d97706"}),o.jsx("circle",{cx:"5",cy:"-5",r:"3",fill:"#d97706"})]}),h.companion==="companion_cat"&&o.jsxs("g",{transform:`translate(100, ${t>=3?"15":"55"})`,children:[o.jsx("path",{d:"M 0 0 Q 3 -8 6 0 Z",fill:"#000"}),o.jsx("circle",{cx:"3",cy:"-4",r:"2.5",fill:"#000"}),o.jsx("path",{d:"M 3 -4 L 1 -7 M 3 -4 L 5 -7",stroke:"#000",strokeWidth:"0.5"})]}),t>=1&&o.jsx("g",{transform:"translate(160, 35) scale(0.4)",children:(()=>{let f="#8B4513",m="#1e1b4b",b="none";if(h.skin==="skin_horse_linked"&&r){const v=db.skins.find(x=>x.id===r.skinId);v&&(f=v.color),m=r.maneColor||m,b=r.hatId||b}else if(h.skin.startsWith("skin_horse_")){const v=h.skin.replace("skin_horse_",""),x=db.skins.find(g=>g.id===v);x?f=x.color:h.skin==="skin_horse_mech"&&(f="#94a3b8")}else return o.jsxs("g",{transform:"translate(0, 60) scale(1.5)",children:[o.jsx("path",{d:"M 0 0 Q 20 -20 40 0 L 40 40 L 0 40 Z",fill:"#78350f"}),o.jsx("path",{d:"M 40 0 Q 60 -10 65 15",stroke:"#78350f",strokeWidth:"8",fill:"none",strokeLinecap:"round"}),o.jsx("circle",{cx:"55",cy:"5",r:"10",fill:"#78350f"}),o.jsx("path",{d:"M 50 0 L 45 -10 M 60 0 L 65 -10",stroke:"#fff",strokeWidth:"2"})]});const p=m==="rainbow";return o.jsxs("g",{children:[o.jsx("path",{d:"M70,160 L70,190 L85,190 L85,150 Z",fill:f,filter:"brightness(0.7)"}),o.jsx("path",{d:"M140,160 L140,190 L155,190 L155,150 Z",fill:f,filter:"brightness(0.7)"}),o.jsx("path",{d:"M50,100 Q40,60 90,60 L140,60 Q180,60 170,110 Q160,160 120,150 L80,150 Q50,150 50,100 Z",fill:f}),o.jsx("path",{d:"M60,150 L60,195 L75,195 L75,150 Z",fill:f}),o.jsx("path",{d:"M130,150 L130,195 L145,195 L145,150 Z",fill:f}),o.jsx("path",{d:"M130,65 Q130,30 160,20 L165,25 Q185,25 185,50 L175,70 Q160,85 145,65 Z",fill:f}),o.jsx("path",{d:"M185,50 L195,55 L190,65 L175,70 Z",fill:f,filter:"brightness(0.9)"}),o.jsx("path",{d:"M160,20 Q120,20 120,80 L130,90 Q140,30 165,25 Z",fill:p?"url(#rainbowGradient)":m,className:p?"animate-pulse":""}),o.jsx("path",{d:"M50,80 Q20,80 20,140",fill:"none",stroke:p?"url(#rainbowGradient)":m,strokeWidth:"8",strokeLinecap:"round"}),o.jsx("circle",{cx:"170",cy:"40",r:"2",fill:"white"}),o.jsx("circle",{cx:"170.5",cy:"39.5",r:"0.5",fill:"black"}),b==="straw_hat"&&o.jsx("text",{x:"160",y:"25",fontSize:"40",transform:"rotate(10, 160, 25)",children:""}),b==="cowboy_hat"&&o.jsx("text",{x:"155",y:"25",fontSize:"40",transform:"rotate(-5, 155, 25)",children:""}),b==="crown"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(-10, 155, 20)",children:""}),b==="viking"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(0, 155, 20)",children:""}),b==="tophat"&&o.jsx("text",{x:"152",y:"15",fontSize:"45",transform:"rotate(-10, 155, 20)",children:""})]})})()}),e.includes("heavy_axles")&&o.jsx("g",{stroke:l,strokeWidth:"1",opacity:"0.6",children:o.jsx("line",{x1:"60",y1:"95",x2:"140",y2:"95"})})]})},yee=({onComplete:t,targetRegionId:e,caravanLevel:s,upgrades:n=[],initialDurability:i=100,maxDurability:r=100,customization:a,horseCustomization:l})=>{var w,k;const c=S.useRef(null),[u,d]=S.useState(0),[h,f]=S.useState(!1),[m,b]=S.useState(i),[p,v]=S.useState(!1),x=S.useRef({distance:0,speed:0,isJumping:!1,jumpHeight:0,obstacles:[],lastObstacleTime:0,shake:0,penaltyTimer:0,durability:i,isBroken:!1,hasFinished:!1}),g=S.useRef([{speed:.15,height:280,color:"#0f172a",amplitude:60,freq:.002},{speed:.4,height:200,color:"#1e293b",amplitude:40,freq:.005},{speed:.9,height:120,color:"#334155",amplitude:30,freq:.012}]);S.useEffect(()=>{const N=_=>{_.code==="Space"&&!x.current.isJumping&&!h&&!x.current.isBroken&&(x.current.isJumping=!0,x.current.jumpHeight=12)};return window.addEventListener("keydown",N),()=>window.removeEventListener("keydown",N)},[h]),S.useEffect(()=>{const N=c.current;if(!N)return;const _=N.getContext("2d");if(!_)return;let T,E=0;const A=1e4,R=n.includes("heavy_axles"),I=n.includes("guard_post"),V=n.includes("silk_chests"),H=1+s*.1+(R?.15:0),P=O=>{E||(E=O);const L=O-E;E=O;const M=x.current;if(!h&&!M.isBroken){let j=H;M.penaltyTimer>0&&(j*=V?.6:.3,M.penaltyTimer-=L),M.speed=j,M.distance+=L*M.speed;const $=Math.min(1,M.distance/A);if(d($),$>=1&&!M.hasFinished&&(M.hasFinished=!0,f(!0),setTimeout(()=>t(!0,{durability:M.durability}),3e3)),M.isJumping&&(M.jumpHeight-=.45,M.jumpHeight<0&&M.jumpHeight>-10||M.jumpHeight<=-10&&(M.isJumping=!1,M.jumpHeight=0)),M.shake>0&&(M.shake*=.9),O-M.lastObstacleTime>2e3+Math.random()*3e3){const B=Math.random();let D="ROCK";B>.8&&!I?D="BANDIT":B>.5&&(D="MUD"),(D!=="BANDIT"||!I)&&(M.obstacles.push({x:N.width+100,typ:D}),M.lastObstacleTime=O)}for(let B=M.obstacles.length-1;B>=0;B--){const D=M.obstacles[B];D.x-=L*M.speed*.8;const z=N.width*.15;if(D.x<z+200-50&&D.x>z+50){let Y=!1;D.typ==="BANDIT"?(Y=!0,M.penaltyTimer=1e3,M.shake=20,M.durability=Math.max(0,M.durability-25)):(D.typ==="ROCK"||D.typ==="MUD")&&!M.isJumping&&(Y=!0,M.penaltyTimer=800,M.shake=10,M.durability=Math.max(0,M.durability-10)),Y&&(M.obstacles.splice(B,1),b(M.durability),v(!0),setTimeout(()=>v(!1),200),M.durability<=0&&(M.isBroken=!0,setTimeout(()=>t(!1,{durability:0}),3e3)))}D.x<-200&&M.obstacles.splice(B,1)}}const F=(Math.random()-.5)*M.shake,U=(Math.random()-.5)*M.shake;_.clearRect(0,0,N.width,N.height),_.save(),_.translate(F,U);const C=_.createLinearGradient(0,0,0,N.height);C.addColorStop(0,"#020617"),C.addColorStop(1,"#1e293b"),_.fillStyle=C,_.fillRect(0,0,N.width,N.height),_.fillStyle="rgba(255,255,255,0.2)";for(let j=0;j<50;j++){const $=j*137%N.width,B=j*79%(N.height*.6);_.fillRect($,B,1,1)}if(g.current.forEach(j=>{_.fillStyle=j.color,_.beginPath(),_.moveTo(0,N.height);for(let $=0;$<=N.width+10;$+=10){const B=$+M.distance*j.speed,D=N.height-j.height+Math.sin(B*j.freq)*j.amplitude+Math.cos(B*j.freq*.5)*(j.amplitude*.5);_.lineTo($,D)}_.lineTo(N.width,N.height),_.fill()}),_.fillStyle="#020617",_.fillRect(0,N.height-60,N.width,60),M.obstacles.forEach(j=>{const $=N.height-60;j.typ==="ROCK"?(_.fillStyle="#64748b",_.beginPath(),_.arc(j.x,$-15,20,0,Math.PI*2),_.fill()):j.typ==="BANDIT"?(_.fillStyle="#e11d48",_.fillRect(j.x,$-60,30,60),_.fillStyle="#fff",_.fillRect(j.x+5,$-50,5,5),_.fillRect(j.x+15,$-50,5,5)):j.typ==="MUD"&&(_.fillStyle="#78350f",_.beginPath(),_.ellipse(j.x,$-5,40,10,0,0,Math.PI*2),_.fill())}),!h&&!M.isBroken){_.strokeStyle=`rgba(255,255,255,${M.speed>H*.5?.05:.01})`,_.lineWidth=1;for(let j=0;j<10;j++){const $=(M.distance*2+j*150)%N.width,B=N.height-30+j*5%20;_.beginPath(),_.moveTo($,B),_.lineTo($+40,B),_.stroke()}}_.restore(),T=requestAnimationFrame(P)};return T=requestAnimationFrame(P),()=>cancelAnimationFrame(T)},[h,t,s,n]);const y=e==="capital"?"Hovedstaden":e==="region_vest"?"Vestfjella":"stlandet";return o.jsxs("div",{className:"fixed inset-0 z-[200] bg-slate-950 flex flex-col items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"relative w-full max-w-5xl h-[500px] border border-slate-800 rounded-[3rem] overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.8)]",children:[o.jsx("canvas",{ref:c,width:1200,height:500,className:"w-full h-full object-cover"}),p&&o.jsx("div",{className:"absolute inset-0 bg-rose-500/30 animate-pulse pointer-events-none"}),o.jsxs("div",{className:"absolute left-[15%] bottom-[70px] w-48 transition-transform duration-100 ease-out",style:{transform:`translateY(${-Math.max(0,(((w=x.current)==null?void 0:w.jumpHeight)||0)*12)}px) rotate(${(k=x.current)!=null&&k.isJumping?-5:0}deg)`},children:[o.jsx(wO,{level:s,upgrades:n,customization:a,horseCustomization:l,isMoving:!h&&!x.current.isBroken,className:"w-full drop-shadow-[0_15px_25px_rgba(0,0,0,0.8)]"}),!h&&!x.current.isBroken&&o.jsx("div",{className:"absolute top-1/2 right-0 w-8 h-8 bg-amber-400/20 blur-xl animate-pulse rounded-full"}),x.current.isBroken&&o.jsx("div",{className:"absolute top-0 right-1/2 w-12 h-24 bg-gray-500/50 blur-xl animate-pulse -translate-y-full"})]}),o.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 text-slate-500 font-bold uppercase text-xs tracking-widest animate-pulse opacity-50",children:"Trykk [MELLOMROM] for  hoppe"}),o.jsxs("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 w-full max-w-md px-12 z-10",children:[o.jsxs("div",{className:"flex justify-between items-end mb-2",children:[o.jsxs("div",{className:"text-left",children:[o.jsx("h2",{className:"text-white font-black uppercase italic tracking-tighter text-3xl",children:"Mitt-Europa"}),o.jsxs("p",{className:"text-slate-500 font-bold uppercase text-[9px] tracking-widest leading-none",children:["Vegen mot ",y]})]}),o.jsx("div",{className:"text-right flex flex-col items-end",children:o.jsxs("span",{className:"text-amber-400 font-black italic text-xl",children:[Math.floor(u*100),"%"]})})]}),o.jsx("div",{className:"h-1 w-full bg-slate-800/50 rounded-full overflow-hidden backdrop-blur-md mb-4",children:o.jsx(Z.div,{initial:{width:0},animate:{width:`${u*100}%`},className:"h-full bg-gradient-to-r from-amber-600 to-amber-400"})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-bold uppercase text-slate-400 w-12 text-right",children:"Helse"}),o.jsx("div",{className:"flex-1 h-3 bg-slate-900 border border-slate-700 rounded-sm overflow-hidden relative",children:o.jsx(Z.div,{className:`h-full ${m<r*.3?"bg-rose-500":"bg-emerald-500"}`,animate:{width:`${m/r*100}%`}})}),o.jsxs("span",{className:`text-[10px] font-bold ${m<r*.3?"text-rose-500":"text-emerald-500"}`,children:[Math.round(m)," / ",r]})]})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none shadow-[inset_0_0_100px_rgba(0,0,0,0.8)]"})]}),h&&o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center bg-slate-950/90 backdrop-blur-2xl",children:o.jsxs("div",{className:"text-center space-y-6",children:[o.jsx(Z.div,{initial:{scale:.5,rotate:-20},animate:{scale:1,rotate:0},className:"text-8xl",children:""}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-6xl font-black text-white italic uppercase tracking-tighter",children:"Ankomst"}),o.jsx("p",{className:"text-amber-400 font-black uppercase tracking-[0.5em] text-sm",children:y})]}),o.jsx("div",{className:"h-px w-24 bg-slate-800 mx-auto"}),o.jsx("p",{className:"text-slate-500 font-bold uppercase text-xs tracking-widest",children:"Handelsruten er etablert"})]})}),x.current.isBroken&&o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center bg-rose-950/90 backdrop-blur-2xl",children:o.jsxs("div",{className:"text-center space-y-6",children:[o.jsx(Z.div,{initial:{scale:.5,rotate:20},animate:{scale:1,rotate:0},className:"text-8xl",children:""}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-6xl font-black text-rose-500 italic uppercase tracking-tighter",children:"HAVARI"}),o.jsx("p",{className:"text-rose-200 font-black uppercase tracking-[0.5em] text-sm",children:"Vognen er delagt"})]}),o.jsx("div",{className:"h-px w-24 bg-rose-800 mx-auto"}),o.jsx("p",{className:"text-rose-300 font-bold uppercase text-xs tracking-widest",children:"Reisen avbrutt  Reparer vognen"})]})})]})},Dl={WORK:[{id:"sickle",label:"Sigd",icon:"",desc:"Presisjons-hsting for hy kvalitet."},{id:"sweep",label:"Lj",icon:"",desc:"Rask innhsting av store omrder."}],CHOP:[{id:"axe",label:"ks",icon:"",desc:"Fell trr med r makt."}],FORAGE:[{id:"gather",label:"Sanking",icon:"",desc:"Let etter mat og urter i skogen."},{id:"traps",label:"Snarefangst",icon:"",desc:"Sett feller for smvilt."}],MINE:[{id:"pickaxe",label:"Hakke",icon:"",desc:"Hugg ut malm fra fjellet."}],QUARRY:[{id:"chisel",label:"Meisel",icon:"",desc:"Hugg ut steinblokker."}],CRAFT:[{id:"hammer",label:"Smiing",icon:"",desc:"Form metallet p ambolten."}],BAKE:[{id:"oven",label:"Steking",icon:"",desc:"Stek brd i ovnen."}],WEAVE:[{id:"loom",label:"Veving",icon:"",desc:"Vev trd til stoffer."}],MIX:[{id:"brew",label:"Brygging",icon:"",desc:"Bland urter til medisiner."}],SMELT:[{id:"furnace",label:"Smelting",icon:"",desc:"Smelt malm til barrer."}],PLANT:[{id:"manual",label:"Hndsing",icon:"",desc:"S fr for hnd."}],HUNT:[{id:"bow",label:"Bueskyting",icon:"",desc:"Presisjonsjakt fra avstand."},{id:"trap",label:"Fellefangst",icon:"",desc:"Sett ut snarer for smvilt."}],SAWMILL:[{id:"saw",label:"Saging",icon:"",desc:"Sag opp tmmer til planker."}],GATHER_WOOL:[{id:"shears",label:"Saks",icon:"",desc:"Klipp ullen av sauene."}]},_ee=({item:t})=>{const e=t.durability/t.maxDurability*100;return o.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-[110] animate-in slide-in-from-bottom-4 fade-in duration-500",children:o.jsxs("div",{className:"bg-slate-900/90 border border-white/10 rounded-full px-6 py-3 flex items-center gap-4 backdrop-blur-md shadow-2xl",children:[o.jsx("div",{className:"text-3xl drop-shadow-[0_0_10px_rgba(255,255,255,0.2)]",children:t.icon}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:t.name}),o.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-slate-300",children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${e>20?"bg-emerald-500":"bg-rose-500"} animate-pulse`}),o.jsx("span",{children:"Slitasje"}),o.jsxs("span",{children:[Math.round(e),"%"]})]})]})]})})},wee=({type:t,onComplete:e,onCancel:s,equipment:n,skills:i,playerUpgrades:r,currentSeason:a="Spring",currentWeather:l="Clear",totalTicks:c=0,selectedMethod:u,action:d,player:h})=>{var k,N,_;const[f,m]=Ne.useState(u||null);Ne.useEffect(()=>{const T=Dl[t];T&&T.length===1&&!f&&m(T[0].id)},[t,f]);const b=Ne.useMemo(()=>bR(t,n||[]),[t,n]),p=Ne.useMemo(()=>{var A,R;const T=En[a],E=Fi[l];return{speedMultiplier:((E==null?void 0:E.speedMod)||1)*(((A=b==null?void 0:b.stats)==null?void 0:A.speedBonus)||1),staminaCostMod:((T==null?void 0:T.staminaMod)||1)*((E==null?void 0:E.staminaMod)||1),yieldMod:(((R=b==null?void 0:b.stats)==null?void 0:R.yieldBonus)||0)+((T==null?void 0:T.yieldMod)||1)}},[a,l,b]),v=Ne.useMemo(()=>{var V,H;const T={skills:i||{},equipment:{}};n&&n.forEach(P=>{const O=P.slot||P.type;P&&O&&(T.equipment[O]=P)});let E=10,A="FARMING",R=t;switch(t){case"MINE":E=re.YIELD.MINE_ORE,A="MINING";break;case"QUARRY":E=re.YIELD.QUARRY_STONE,A="MINING";break;case"CHOP":E=re.YIELD.CHOP_WOOD,a==="Summer"&&(E+=re.YIELD.SUMMER_WOOD_BONUS),A="WOODCUTTING";break;case"WORK":case"HARVEST":E=re.YIELD.WORK_GRAIN,r!=null&&r.includes("iron_plow")&&(E+=re.YIELD.PLOW_BONUS),A="FARMING";break;case"FORAGE":E=re.YIELD.FORAGE_BREAD,A="FARMING";break}const I={season:((V=En[a])==null?void 0:V.yieldMod)||1,weather:((H=Fi[l])==null?void 0:H.yieldMod)||1,actionType:R,upgrades:1};try{const P=wi(T,E,A,I);return console.log(`[MinigameOverlay] Yield Calc. Type: ${t}, Base: ${E}. Result: ${P}. Equipment:`,T.equipment),isNaN(P)?1.5:P}catch(P){return console.error("Yield Calc Error:",P),1.5}},[t,i,n,r,a,l]),x=Ne.useMemo(()=>{let T=10;switch(t){case"MINE":T=re.YIELD.MINE_ORE;break;case"QUARRY":T=re.YIELD.QUARRY_STONE;break;case"CHOP":T=re.YIELD.CHOP_WOOD;break;case"WORK":case"HARVEST":T=re.YIELD.WORK_GRAIN;break;case"FORAGE":T=re.YIELD.FORAGE_BREAD;break}return v<=2||v<T*.4},[v,t]),g=T=>{m(T)},[y,w]=Ne.useState(!1);return x&&!y&&(t==="MINE"||t==="QUARRY"||t==="CHOP"||t==="WORK"||t==="HARVEST"||t==="FORAGE")&&f?o.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in zoom-in duration-300",children:o.jsxs("div",{className:"bg-slate-900 border-2 border-rose-500 rounded-3xl p-8 max-w-md w-full text-center shadow-[0_0_50px_rgba(244,63,94,0.3)]",children:[o.jsx("div",{className:"text-6xl mb-6",children:""}),o.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter mb-4",children:"Manglende Verkty!"}),o.jsxs("p",{className:"text-slate-300 font-medium mb-8 leading-relaxed",children:["Du forsker  utfre ",o.jsx("span",{className:"text-rose-400 font-bold",children:t})," uten riktig verkty. Effektiviteten din er redusert med 80%."]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("button",{onClick:()=>w(!0),className:"w-full py-4 bg-rose-600 hover:bg-rose-500 text-white rounded-xl font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all",children:"Fortsett likevel"}),o.jsx("button",{onClick:s,className:"w-full py-4 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white rounded-xl font-bold uppercase tracking-widest transition-all",children:"Avbryt"})]})]})}):!f&&Dl[t]?o.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/80 backdrop-blur-md animate-in fade-in duration-300",children:o.jsxs("div",{className:"max-w-4xl w-full p-8",children:[o.jsx("h2",{className:"text-4xl font-black text-white text-center mb-12 uppercase tracking-tighter drop-shadow-lg",children:"Velg Metode"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:Dl[t].map(T=>o.jsxs("button",{onClick:()=>g(T.id),className:"group relative bg-slate-900 border-2 border-slate-700 hover:border-indigo-500 rounded-3xl p-8 transition-all hover:-translate-y-2 hover:shadow-[0_0_50px_rgba(79,70,229,0.3)] text-left overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center gap-6",children:[o.jsx("div",{className:"text-6xl group-hover:scale-110 transition-transform duration-300",children:T.icon}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-black text-white mb-2 uppercase tracking-wide group-hover:text-indigo-400 transition-colors",children:T.label}),o.jsx("p",{className:"text-slate-400 font-medium leading-relaxed",children:T.desc})]}),o.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 w-full",children:(()=>{const E=gO(t,a,l,c);return E?o.jsx("div",{className:"flex items-center justify-center gap-2 text-sm font-bold text-slate-500",children:o.jsx("span",{children:E})}):null})()})]})]},T.id))}),o.jsx("button",{onClick:s,className:"mt-12 mx-auto block text-slate-500 font-bold hover:text-white transition-colors uppercase tracking-widest text-sm",children:"Avbryt"})]})}):o.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/90 backdrop-blur-xl animate-in fade-in duration-300",children:[o.jsx("div",{className:"absolute top-8 right-8 z-[110]",children:o.jsx("button",{onClick:s,className:"bg-black/40 hover:bg-rose-500/20 text-white/50 hover:text-rose-400 w-12 h-12 rounded-full flex items-center justify-center transition-all",children:""})}),o.jsx("div",{className:"absolute top-8 left-8 z-[110] flex gap-4",children:o.jsxs("div",{className:"bg-black/40 backdrop-blur-md px-4 py-2 rounded-2xl border border-white/5 flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",title:((k=En[a])==null?void 0:k.label)||a,children:a==="Winter"?"":a==="Summer"?"":a==="Autumn"?"":""}),o.jsx("span",{className:"text-2xl",title:((N=Fi[l])==null?void 0:N.label)||l,children:(_=Fi[l])==null?void 0:_.icon}),o.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-2"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-wider",children:"Forhold"}),o.jsxs("span",{className:`text-xs font-bold ${p.speedMultiplier<1?"text-rose-400":"text-emerald-400"}`,children:[Math.round(p.speedMultiplier*100),"% Hastighet"]})]})]})}),o.jsxs("div",{className:"w-full max-w-5xl bg-slate-900 rounded-[3rem] shadow-2xl relative overflow-hidden border border-white/5",children:[(()=>{var T,E,A,R,I,V;switch(t){case"PLANT":return o.jsx(ree,{onComplete:e});case"HARVEST":case"WORK":return f==="sweep"||f==="scythe"?o.jsx(vT,{onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier}):o.jsx(vl,{onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier,possibleYield:v});case"CHOP":return o.jsx(cee,{onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier,possibleYield:v});case"SAWMILL":return o.jsx(fee,{onComplete:e,speedMultiplier:p.speedMultiplier});case"FORAGE":return f==="traps"?o.jsx(yT,{onComplete:e,speedMultiplier:p.speedMultiplier,variant:"land"}):o.jsx(vl,{isForaging:!0,onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier,resourceName:"Mat/Urter",possibleYield:v});case"MINE":return o.jsx(vl,{isMining:!0,onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier,resourceName:"Malm",possibleYield:v});case"QUARRY":return o.jsx(vl,{isQuarrying:!0,onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier,resourceName:"Stein",possibleYield:v});case"CRAFT":case"REPAIR":return o.jsx(aee,{onComplete:e,speedMultiplier:p.speedMultiplier});case"SMELT":return o.jsx(xee,{onComplete:e,speedMultiplier:p.speedMultiplier});case"BAKE":const H=d!=null&&d.subType?((T=Ke[d.subType])==null?void 0:T.icon)||"":((E=ze[d==null?void 0:d.recipeId])==null?void 0:E.icon)||"";return o.jsx(oee,{onComplete:e,speedMultiplier:p.speedMultiplier,icon:H});case"WEAVE":return o.jsx(dee,{onComplete:e,speedMultiplier:p.speedMultiplier});case"MIX":return o.jsx(hee,{onComplete:e,speedMultiplier:p.speedMultiplier});case"GATHER_WOOL":return o.jsx(vT,{onComplete:e,equipment:n,speedMultiplier:p.speedMultiplier});case"MOUNT_HORSE":return o.jsx(vee,{onComplete:e,speedMultiplier:p.speedMultiplier,levelId:f||"ride_easy",level:(d==null?void 0:d.level)||1,horse:h==null?void 0:h.horseCustomization});case"HUNT":return f==="bow"?o.jsx(wT,{onComplete:e,speedMultiplier:p.speedMultiplier}):f==="trap"?o.jsx(yT,{onComplete:e,speedMultiplier:p.speedMultiplier,variant:"land"}):o.jsx(wT,{onComplete:e,speedMultiplier:p.speedMultiplier});case"TRAVEL_START":const P=((A=h==null?void 0:h.caravan)==null?void 0:A.level)||1,L=(re.CARAVAN.LEVELS.find(M=>M.level===P)||re.CARAVAN.LEVELS[0]).durability;return o.jsx(yee,{onComplete:(M,F)=>e(M?1:0,F),targetRegionId:(d==null?void 0:d.targetRegionId)||"capital",caravanLevel:P,upgrades:((R=h==null?void 0:h.caravan)==null?void 0:R.upgrades)||[],initialDurability:((I=h==null?void 0:h.caravan)==null?void 0:I.durability)||L,maxDurability:L,customization:(V=h==null?void 0:h.caravan)==null?void 0:V.customization,horseCustomization:h==null?void 0:h.horseCustomization});default:return o.jsxs("div",{className:"p-12 text-center",children:[o.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Ukjent Minispill: ",t]}),o.jsx("button",{onClick:()=>e(.5),className:"px-6 py-3 bg-indigo-600 rounded-xl font-bold text-white",children:"Fullfr (Skip)"})]})}})(),b&&o.jsx(_ee,{item:b})]})]})},kee=({isOpen:t,onClose:e,onConfirm:s,roleId:n,cost:i})=>{const[r,a]=S.useState(!1);if(S.useEffect(()=>{a(!!t)},[t]),!t)return null;const l=n==="MERCHANT",c=l?{modalBg:"bg-[#050810]",borderColor:"border-amber-500/20",glowColor:"bg-amber-500",shadowColor:"shadow-[0_0_200px_rgba(245,158,11,0.15)]",iconBg:"bg-gradient-to-br from-amber-400/20 to-amber-900/40",iconBorder:"border-amber-500/30",iconColor:"text-amber-400",titleColor:"text-amber-100",accentText:"text-amber-400",mutedText:"text-amber-100/50",cardBg:"bg-white/5 hover:bg-white/10",cardBorder:"border-white/5 hover:border-amber-500/30",buttonPrimary:"bg-amber-400 hover:bg-amber-300 text-black border-amber-300 shadow-[0_0_30px_rgba(245,158,11,0.4)] hover:shadow-[0_0_50px_rgba(245,158,11,0.6)]",buttonSecondary:"bg-transparent text-amber-100/40 hover:text-amber-100 hover:bg-white/5 border-transparent hover:border-white/10",icon:x1}:{modalBg:"bg-[#0F0505]",borderColor:"border-red-500/20",glowColor:"bg-red-600",shadowColor:"shadow-[0_0_150px_rgba(220,38,38,0.2)]",iconBg:"bg-red-900/20",iconBorder:"border-red-500/30",iconColor:"text-red-500",titleColor:"text-red-100",accentText:"text-red-500",mutedText:"text-red-200/50",cardBg:"bg-red-950/20",cardBorder:"border-red-500/10",buttonPrimary:"bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white border-red-600/30",buttonSecondary:"bg-transparent text-slate-500 hover:text-slate-300 border-transparent",icon:oc},u=c.icon;return o.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 perspective-[1000px]",children:[o.jsx("div",{className:`absolute inset-0 bg-black/80 backdrop-blur-2xl transition-opacity duration-700 ${t?"opacity-100":"opacity-0"}`,onClick:e,children:o.jsx("div",{className:`absolute inset-0 opacity-20 bg-radial-gradient from-${l?"amber":"red"}-900/20 to-transparent`})}),o.jsxs("div",{className:`relative z-10 w-full ${l?"max-w-3xl":"max-w-lg"} 
                ${c.modalBg} border ${c.borderColor} rounded-[3rem] ${c.shadowColor} 
                overflow-hidden flex flex-col transition-all duration-700 ease-out transform
                ${r?"scale-100 translate-y-0 opacity-100 rotate-x-0":"scale-90 translate-y-10 opacity-0 rotate-x-12"}
                `,children:[o.jsx("div",{className:"absolute -top-1/2 -left-1/2 w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none opacity-20"}),o.jsx("div",{className:`absolute -top-64 left-1/2 -translate-x-1/2 w-[800px] h-[600px] ${c.glowColor} opacity-10 blur-[150px] rounded-full pointer-events-none`}),o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-30 pointer-events-none",children:[o.jsx("div",{className:"absolute top-20 left-20 w-1 h-1 bg-white rounded-full animate-pulse"}),o.jsx("div",{className:"absolute top-40 right-40 w-1.5 h-1.5 bg-white rounded-full animate-pulse delay-700"}),o.jsx("div",{className:"absolute bottom-20 left-1/3 w-1 h-1 bg-white rounded-full animate-pulse delay-300"})]}),o.jsxs("div",{className:`p-12 relative flex flex-col items-center text-center ${l?"gap-10":"gap-6"}`,children:[o.jsx("button",{onClick:e,className:"absolute top-8 right-8 group p-2 rounded-full transition-all hover:bg-white/5",children:o.jsx(In,{size:24,className:`${c.mutedText} group-hover:text-white transition-colors`})}),o.jsxs("div",{className:"relative group",children:[l&&o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 border border-amber-500/20 rounded-full animate-[spin_10s_linear_infinite]"}),o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 ${c.glowColor} blur-[60px] opacity-40 group-hover:opacity-60 transition-opacity duration-1000`}),o.jsxs("div",{className:`relative w-28 h-28 mx-auto rounded-[2.5rem] ${c.iconBg} ${c.iconBorder} border flex items-center justify-center shadow-2xl backdrop-blur-sm z-10 transition-transform duration-500 group-hover:scale-105 group-hover:-translate-y-1`,children:[o.jsx(u,{size:64,className:`${c.iconColor} drop-shadow-[0_0_20px_rgba(251,191,36,0.5)]`}),o.jsx("div",{className:"absolute inset-0 rounded-[2.5rem] bg-gradient-to-tr from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"})]})]}),o.jsxs("div",{className:"space-y-4 max-w-lg mx-auto z-10",children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 opacity-80",children:[o.jsx("div",{className:`h-px w-12 ${c.glowColor} opacity-50`}),o.jsx("h4",{className:`text-xs font-bold uppercase tracking-[0.4em] ${c.accentText}`,children:"Ny Karrierevei"}),o.jsx("div",{className:`h-px w-12 ${c.glowColor} opacity-50`})]}),o.jsx("h2",{className:`text-6xl font-black uppercase tracking-tighter italic drop-shadow-2xl ${c.titleColor}`,children:l?"Kjpmann":"Soldat"})]}),l?o.jsxs("div",{className:"w-full max-w-2xl space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-150",children:[o.jsx("p",{className:"text-xl text-slate-300 font-light leading-relaxed max-w-lg mx-auto italic",children:'"Som kjpmann beveger du ikke bare varer, du beveger verden. Gull er blodet som strmmer gjennom rikets rer."'}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(r0,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Fltestyring"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Bygg og oppgrader din egen karavaneflte. Velg mellom raske kjerrer eller tunge vogner med enorm lastekapasitet."})]})]})}),o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(g1,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Global Handel"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Kryss landegrenser og utnytt dype prisforskjeller mellom regionene. Kjp billig i st, selg dyrt i vest."})]})]})}),o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(zm,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Markedsmakt"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Invester i landsbyens konomi, ls opp passiv inntekt gjennom luksusvarer og dominer de lokale markedene."})]})]})})]}),o.jsx("div",{className:"bg-amber-500/5 border border-amber-500/10 p-4 rounded-2xl",children:o.jsxs("p",{className:"text-xs text-amber-200/70 font-medium",children:[o.jsx(Ki,{size:12,className:"inline mr-2 mb-0.5"}),"Som Kjpmann lser du opp en helt ny dimensjon av spillet fokusert p logistikk, risiko og massiv profitt."]})})]}):o.jsxs("div",{className:"bg-red-950/20 border border-red-500/20 p-8 rounded-[2rem] max-w-md mx-auto",children:[o.jsx(b1,{size:48,className:"text-red-500 mx-auto mb-4"}),o.jsx("p",{className:"text-red-200 font-medium",children:"Denne rollen er under utvikling. Forvent ubalanse og manglende funksjoner."})]}),o.jsxs("div",{className:"flex flex-col items-center gap-6 w-full pt-4 animate-in fade-in slide-in-from-bottom-4 duration-1000 delay-300",children:[o.jsxs("div",{className:`flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em] opacity-60 ${c.accentText}`,children:[o.jsx(oc,{size:12}),o.jsx("span",{children:"Dette valget er permanent"})]}),o.jsxs("div",{className:"flex items-center gap-4 w-full justify-center",children:[o.jsx("button",{onClick:e,className:`px-8 py-4 rounded-2xl font-bold tracking-widest uppercase text-xs transition-all ${c.buttonSecondary}`,children:"Avbryt"}),o.jsxs("button",{onClick:s,className:`group relative px-10 py-5 rounded-2xl font-black tracking-widest uppercase text-sm border-2 transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center gap-4 ${c.buttonPrimary}`,children:[o.jsx("div",{className:"absolute inset-0 bg-white/20 blur-xl opacity-0 group-hover:opacity-50 transition-opacity"}),o.jsx("span",{className:"relative z-10",children:l?"Signer Kontrakt":"Jeg forstr"}),i&&l&&o.jsx("div",{className:"relative z-10 flex items-center gap-2 bg-black/20 backdrop-blur-md px-3 py-1.5 rounded-lg border border-black/10",children:o.jsx("span",{className:"text-xs font-mono font-bold text-amber-900",children:i})}),l&&o.jsx(Ki,{size:16,className:"relative z-10 animate-pulse text-amber-900"})]})]})]})]})]})]})},Nee=({poi:t,player:e,room:s,viewingRegionId:n,onAction:i,onClose:r})=>{var E,A,R,I,V,H;const a=S.useRef(null),l=n==="region_ost"&&t.ost?t.ost.top:t.top,c=n==="region_ost"&&t.ost?t.ost.left:t.left,[u,d]=S.useState({x:"3rem",y:"-50%"}),[h,f]=S.useState(!1),[m,b]=S.useState({isOpen:!1,action:null}),p=((E=s.world)==null?void 0:E.season)||"Spring",v=((A=s.world)==null?void 0:A.weather)||"Clear",x=S.useMemo(()=>{var j,$,B;const P=t.id in Us?t.id:t.parentId,O=Us[P],M=((B=($=(((j=s.world)==null?void 0:j.settlement)||{}).buildings)==null?void 0:$[P])==null?void 0:B.level)||1;let F=[];if(O)for(let D=1;D<=M;D++)O.levels[D]&&(F=[...F,...O.levels[D].unlocks]);const U=t.actions.filter(D=>{if(D.id==="TAX_PEASANTS"&&e.role!=="BARON"||D.id==="TAX_ROYAL"&&e.role!=="KING"||D.id==="DECREE"&&e.role!=="KING"||D.id==="RAID"&&e.role!=="BARON"||D.id==="FEAST"&&e.role!=="KING"&&e.role!=="BARON"||D.id==="JOIN_ROLE"&&e.role===D.targetRole)return!1;const z=["OPEN_CRAFTING","CRAFT","REFINE","MARKET_VIEW","OPEN_GARRISON","OPEN_TAVERN_MENU","OPEN_WEAPON_RACK","OPEN_DICE_GAME","OPEN_RESOURCE_GAME"];return!(O&&!D.id.startsWith("BUILDING_UPGRADE_")&&!z.includes(D.id)&&!F.includes(D.id))});return["windmill_stones","sawmill_blade","smeltery_furnace","bakery_oven","weavery_loom","forge_anvil"].includes(t.id)?U.filter(D=>D.id==="OPEN_CRAFTING"||D.id==="REFINE"||D.id==="CRAFT"||D.id.startsWith("REFINE_")||D.id.startsWith("CRAFT_")||D.id in An).slice(0,1):U},[t,e.role,(R=s.world)==null?void 0:R.settlement]);S.useLayoutEffect(()=>{if(!a.current)return;const P=a.current.getBoundingClientRect(),O=a.current.offsetParent;if(!O){f(!0);return}const L=O.getBoundingClientRect(),M=parseFloat(c),F=parseFloat(l),U=M<50?"3rem":"calc(-100% - 3rem)",C=F/100*L.height-P.height/2,j=C+P.height;let $="-50%";C<20?$=`calc(-50% + ${20-C}px)`:j>L.height-20&&($=`calc(-50% - ${j-(L.height-20)}px)`),d({x:U,y:$}),f(!0)},[l,c,x.length]);const g=P=>{var C,j,$;const O=[],L=Bb(e,P);if(L.forEach(B=>{var D,z,J;(D=B.stats)!=null&&D.speedBonus&&B.stats.speedBonus!==1&&O.push({source:B.name,type:"Fart",value:`+${Math.round((B.stats.speedBonus-1)*100)}%`,icon:B.icon,isBonus:!0}),(z=B.stats)!=null&&z.yieldBonus&&O.push({source:B.name,type:"Utbytte",value:`+${B.stats.yieldBonus}`,icon:B.icon,isBonus:!0}),(J=B.stats)!=null&&J.luckBonus&&O.push({source:B.name,type:"Flaks",value:`+${Math.round(B.stats.luckBonus*100)}%`,icon:B.icon,isBonus:!0})}),e.upgrades){const B=C_[e.role]||[];e.upgrades.forEach(D=>{const z=B.find(J=>J.id===D);z&&(z.benefit==="YIELD_GRAIN"&&(P==="WORK"||P==="MILL")&&O.push({source:z.name,type:"Utbytte",value:"+5",icon:"",isBonus:!0}),z.benefit==="RAID_SPEED"&&P==="RAID"&&O.push({source:z.name,type:"Fart",value:"Raskere",icon:"",isBonus:!0}))})}const M=t.id==="tavern"||t.id==="bakery"||t.id==="great_forge"||t.id==="weavery"||t.id==="sawmill"||t.id==="windmill"||t.id==="smeltery"?t.id:t.parentId,U=(($=(j=(((C=s.world)==null?void 0:C.settlement)||{}).buildings)==null?void 0:j[M])==null?void 0:$.level)||1;if(U>=2&&O.push({source:"Bygningsbonus (Lvl 2)",type:"Utbytte",value:"+10% XP",icon:"",isBonus:!0}),U>=3&&O.push({source:"Bygningsbonus (Lvl 3)",type:"Utbytte",value:"Master Tier",icon:"",isBonus:!0}),Dl[P]){const B=Dl[P][0];B.id==="manual"||B.id==="gather"||L.some(J=>{var Y;return((Y=J.type)==null?void 0:Y.toLowerCase().includes(B.id.toLowerCase()))||J.id.toLowerCase().includes(B.id.toLowerCase())})||O.push({source:"System",type:"ADVARSEL",value:`Du mangler ${B.label}, utbytte redusert med 80%`,icon:"",isBonus:!1})}return O},y=S.useMemo(()=>{var P;return(P=e.activeProcesses)==null?void 0:P.find(O=>!(O.locationId!==t.id||O.type==="COOP"||O.type==="WELL"&&O.readyAt<=Date.now()))},[e.activeProcesses,t.id]),w=()=>{if(!y)return 0;const P=Date.now();return Math.max(0,y.readyAt-P)},[k,N]=S.useState(w());S.useEffect(()=>{if(!y)return;const P=setInterval(()=>{const O=w();N(O),O<=0&&clearInterval(P)},1e3);return()=>clearInterval(P)},[y]);const _=P=>{const O=Math.floor(P/6e4),L=Math.floor(P%6e4/1e3);return`${O}m ${L}s`},T=o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 z-[90]",onClick:r}),o.jsx("div",{ref:a,style:{top:l,left:c,transform:`translate(${u.x}, ${u.y})`,visibility:h?"visible":"hidden",opacity:h?1:0},className:`absolute z-[100] ${h?"animate-in fade-in zoom-in":""} duration-200 pointer-events-auto`,children:o.jsxs("div",{className:"bg-slate-900/90 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] p-6 shadow-[0_40px_100px_rgba(0,0,0,0.8)] min-w-[320px] w-max max-w-[400px] relative transition-all duration-500 overflow-hidden group/tooltip",children:[o.jsx("div",{className:"absolute -top-24 -left-24 w-48 h-48 bg-indigo-500/10 blur-[80px] pointer-events-none group-hover/tooltip:bg-indigo-500/20 transition-all duration-1000"}),o.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"w-14 h-14 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-3xl shadow-inner relative overflow-hidden group/icon",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover/icon:opacity-100 transition-opacity"}),t.icon]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h3",{className:"font-display font-black text-white text-xl uppercase tracking-tighter leading-none",children:t.label}),o.jsx("span",{className:"text-xs font-black text-indigo-400 uppercase tracking-[.2em] mt-1 opacity-90",children:"Landemerke"})]})]}),o.jsx("div",{className:"flex items-center gap-3",children:o.jsx("button",{onClick:r,className:"text-white/60 hover:text-white transition-all bg-white/10 hover:bg-white/20 rounded-full w-10 h-10 flex items-center justify-center border border-white/10 hover:border-white/30 active:scale-90",children:""})})]}),o.jsxs("div",{className:"space-y-3",children:[y?o.jsx("div",{className:"w-full relative py-4",children:k<=0?o.jsxs("div",{className:"relative group/harvest",children:[o.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl blur opacity-25 group-hover/harvest:opacity-50 transition duration-1000 group-hover:duration-200"}),o.jsxs("button",{onClick:()=>i({type:"HARVEST",locationId:t.id}),disabled:e.status.stamina<Pn(15,p,v),className:`w-full relative px-6 py-8 border rounded-3xl flex items-center justify-between overflow-hidden active:scale-[0.98] transition-all
                                                ${e.status.stamina<Pn(15,p,v)?"bg-red-900/20 border-red-500/30 cursor-not-allowed grayscale opacity-80":"bg-slate-900 border-emerald-500/50 hover:bg-emerald-950/30"}`,children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 blur-3xl -mr-16 -mt-16"}),o.jsxs("div",{className:"flex flex-col items-start z-10",children:[o.jsx("span",{className:`text-2xl font-black uppercase tracking-tighter italic ${e.status.stamina<Pn(15,p,v)?"text-slate-500":"text-white"}`,children:(I=t.label)!=null&&I.toLowerCase().includes("lin")?"Linhsting":t.id==="grain_fields"?"Kornhsting":"Innhsting"}),o.jsx("span",{className:`text-xs font-black uppercase tracking-[0.2em] mt-1 ${e.status.stamina<Pn(15,p,v)?"text-red-400":"text-emerald-400"}`,children:e.status.stamina<Pn(15,p,v)?`Mangler energi (${Math.ceil(e.status.stamina)}/${Pn(15,p,v).toFixed(0)})`:"Klar til  hentes!"})]}),o.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-[0_0_20px_rgba(16,185,129,0.3)] ${e.status.stamina<Pn(15,p,v)?"bg-slate-800 text-slate-600":"bg-emerald-500/20 animate-bounce"}`,children:e.status.stamina<Pn(15,p,v)?o.jsx(cc,{size:24,className:"text-red-500"}):""})]})]}):o.jsxs("div",{className:"p-8 bg-white/5 border border-white/10 rounded-[2rem] flex flex-col items-center gap-6 relative overflow-hidden group/timer",children:[o.jsx("div",{className:"absolute -bottom-12 -right-12 w-24 h-24 bg-indigo-500/5 blur-2xl rounded-full"}),o.jsxs("div",{className:"relative w-24 h-24",children:[o.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 36 36",children:[o.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-white/5",strokeWidth:"2"}),o.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-emerald-500 transition-all duration-1000 ease-linear",strokeWidth:"2",strokeDasharray:"100",strokeDashoffset:100-(1-k/y.duration)*100,strokeLinecap:"round"})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("span",{className:"text-3xl animate-pulse",children:y.type==="MILL"?"":y.type==="WELL"?"":""})})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[o.jsx("span",{className:"text-sm font-black text-slate-400 uppercase tracking-widest leading-none",children:y.type==="WELL"?"Brnnen fyller seg med vann":"Venter p produksjon"}),o.jsx("span",{className:"text-2xl font-mono font-black text-white",children:_(k)})]}),o.jsx("div",{className:"w-full h-1 bg-white/5 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-1000 ease-linear",style:{width:`${(1-k/y.duration)*100}%`}})})]})}):o.jsx("div",{className:"space-y-6",children:x.map(P=>{var B,D,z,J;const O=((B=s.world)==null?void 0:B.season)||"Spring",L=((D=s.world)==null?void 0:D.weather)||"Clear",M=g(P.id);let F=!0,U="";const C=["CRAFT","REFINE","OPEN_CRAFTING","BAKE","SMELT","MILL","WEAVE","MIX","OPEN_CHICKEN_COOP","OPEN_DICE_GAME","MARKET_VIEW","OPEN_GARRISON","OPEN_WEAPON_RACK"];if(n!==e.regionId&&e.role!=="KING"&&P.id!=="MARKET_VIEW")F=!1,U="Dette er ikke ditt baroni";else if(!C.includes(P.id)){const Y=pO(e,P.id,O,L,((z=s.world)==null?void 0:z.gameTick)||0);Y.success||(F=!1,U=Y.reason||"Krav ikke mtt")}const j=gO(P.id,O,L,((J=s.world)==null?void 0:J.gameTick)||0),$=Dl[P.id];return o.jsxs("div",{className:"w-full animate-in fade-in slide-in-from-bottom-2 duration-500",children:[o.jsxs("div",{className:"flex items-center justify-between px-1 mb-3",children:[o.jsx("h4",{className:"text-xs font-black text-slate-300 uppercase tracking-[0.3em]",children:P.label}),j&&o.jsx("span",{className:"text-xs font-black text-indigo-400 uppercase tracking-widest",children:j})]}),$?o.jsx("div",{className:"grid grid-cols-1 gap-4",children:$.map(Y=>{const fe=Bb(e,P.id),me=fe.find(ne=>{var Le;return((Le=ne.type)==null?void 0:Le.toLowerCase().includes(Y.id.toLowerCase()))||ne.id.toLowerCase().includes(Y.id.toLowerCase())})||fe[0],ue=me?me.durability/me.maxDurability*100:null;return o.jsxs("button",{onClick:()=>i({type:P.id,method:Y.id,locationId:t.id}),disabled:!F,className:`group relative flex items-center gap-6 w-full p-5 rounded-[2rem] border transition-all duration-300 ${F?"bg-white/5 border-white/10 hover:border-indigo-500/50 hover:bg-indigo-500/5 active:scale-[0.98]":"bg-black/20 border-white/5 cursor-not-allowed"}`,children:[o.jsx("div",{className:`w-16 h-16 rounded-2xl bg-white/5 flex-shrink-0 flex items-center justify-center text-4xl group-hover:scale-110 transition-transform duration-500 ${!F&&"opacity-40"}`,children:Y.icon}),o.jsxs("div",{className:"flex-1 flex flex-col justify-center min-w-0 items-start",children:[o.jsx("span",{className:"font-display font-black text-white text-xl uppercase tracking-tighter group-hover:text-indigo-400 transition-colors truncate",children:Y.label}),F?o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.jsx("span",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest truncate opacity-60",children:Y.desc}),M.length>0&&o.jsx("div",{className:"flex gap-1.5",children:M.filter(ne=>!ne.isBonus||ne.value.includes("+")).slice(0,1).map((ne,Le)=>o.jsx("span",{className:"text-[10px] text-emerald-400 font-black px-2 py-0.5 bg-emerald-400/10 rounded-full",children:ne.value},Le))})]}):o.jsx("span",{className:"text-xs font-black text-rose-500 uppercase tracking-widest mt-0.5",children:U})]}),o.jsxs("div",{className:"flex flex-col items-end gap-3 ml-2",children:[ue!==null&&F&&o.jsx("div",{className:"w-10 h-1.5 bg-white/10 rounded-full overflow-hidden shadow-inner",children:o.jsx("div",{className:`h-full transition-all duration-1000 ${ue>50?"bg-indigo-500 shadow-[0_0_8px_rgba(99,102,241,0.5)]":ue>20?"bg-amber-500":"bg-rose-500"}`,style:{width:`${ue}%`}})}),o.jsx(aa,{size:22,className:`transition-all ${F?"text-white/20 group-hover:text-indigo-400 group-hover:translate-x-1":"text-white/5"}`})]})]},Y.id)})}):o.jsx("button",{onClick:()=>{P.id==="JOIN_ROLE"?b({isOpen:!0,action:{...P,type:P.id,locationId:t.id}}):i({...P,type:P.id,locationId:t.id})},disabled:!F,className:`w-full group relative overflow-hidden p-5 rounded-3xl border transition-all duration-300 ${F?"bg-white/5 border-white/10 hover:border-indigo-500/50 hover:bg-indigo-500/5 active:scale-[0.98]":"bg-black/20 border-white/5 opacity-50 cursor-not-allowed"}`,children:o.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[o.jsxs("div",{className:"flex flex-col items-start",children:[o.jsx("span",{className:"text-xl font-black text-white group-hover:text-indigo-400 transition-colors uppercase tracking-tight",children:P.label}),!F&&o.jsx("span",{className:"text-sm font-black text-rose-500 uppercase tracking-widest mt-1",children:U})]}),o.jsx(aa,{size:20,className:"text-white/20 group-hover:text-indigo-400 group-hover:translate-x-1 transition-all"})]})})]},P.id)})}),(()=>{var U,C,j,$,B;const P=x.map(D=>D.id),O=Object.values(e.equipment||{}),F=Object.values(Ke).filter(D=>{var z;return(z=D.relevantActions)==null?void 0:z.some(J=>P.includes(J))}).map(D=>{if(O.find(J=>J.id===D.id||J.id.startsWith(D.id+"_"))){const J=D.nextTierId;return J?Ke[J]:null}else return D.level===1?D:null}).filter(Boolean).filter((D,z,J)=>J.findIndex(Y=>(Y==null?void 0:Y.id)===(D==null?void 0:D.id))===z).sort((D,z)=>{if(!D||!z)return 0;const J=D.type==="MAIN_HAND"||D.type==="AXE"||D.type==="PICKAXE"||D.type==="SCYTHE"||D.type==="BOW"||D.type==="CHISEL"?1:0;return(z.type==="MAIN_HAND"||z.type==="AXE"||z.type==="PICKAXE"||z.type==="SCYTHE"||z.type==="BOW"||z.type==="CHISEL"?1:0)-J});if(F.length>0){const D=F[0];if(!D)return null;const z=Object.values(An).find(ft=>ft.outputItemId===D.id),J=((U=s.world)==null?void 0:U.settlement)||{buildings:{}},Y=(z==null?void 0:z.buildingId)||"great_forge",fe=((j=(C=J.buildings)==null?void 0:C[Y])==null?void 0:j.level)||1,me=(z==null?void 0:z.level)||1,ue=fe<me,ne=(($=Us[Y])==null?void 0:$.name)||"Smien",Le=O.find(ft=>{var Pe;if(!ft)return!1;const se=Object.keys(Ke).find(_e=>ft.id===_e||ft.id.startsWith(_e+"_")),le=se?Ke[se]:null;return(Pe=le==null?void 0:le.relevantActions)==null?void 0:Pe.some(_e=>P.includes(_e))});return o.jsx("div",{className:"mt-8 pt-8 border-t border-white/5 relative z-10",children:o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[o.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent flex-1"}),o.jsx("span",{className:`text-xs font-black uppercase tracking-[0.2em] ${ue?"text-slate-400":"text-amber-500 animate-pulse"}`,children:ue?`Krever niv ${me}`:"Utvikling venter"}),o.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent flex-1"})]}),o.jsxs("div",{className:"flex items-center justify-between gap-6 px-4",children:[o.jsxs("div",{className:"flex flex-col items-center gap-2 group/evolve",children:[o.jsx("div",{className:"w-16 h-16 rounded-[1.5rem] bg-white/5 border border-white/10 flex items-center justify-center text-3xl opacity-40 transition-all group-hover/evolve:opacity-60",children:(Le==null?void 0:Le.icon)||""}),o.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"N"})]}),o.jsxs("div",{className:"flex flex-col items-center flex-1 gap-2 pt-2",children:[o.jsxs("div",{className:"relative w-full flex justify-center",children:[o.jsx("div",{className:"absolute top-1/2 left-0 w-full h-px bg-gradient-to-r from-indigo-500/0 via-indigo-500/30 to-indigo-500/0"}),o.jsx(aa,{className:"text-indigo-500/50 w-6 h-6 animate-pulse relative z-10"})]}),((B=D.stats)==null?void 0:B.yieldBonus)&&o.jsxs("span",{className:"text-[10px] font-black text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded-full border border-emerald-400/20",children:["+",D.stats.yieldBonus," Utbytte"]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-2 group/next",children:[o.jsx("div",{className:`w-20 h-20 rounded-[2rem] flex items-center justify-center text-4xl border-2 shadow-2xl transition-all duration-500 ${ue?"bg-slate-900/50 border-white/5 grayscale":"bg-indigo-600/20 border-indigo-500/50 shadow-indigo-500/20 hover:scale-110 active:scale-95"}`,children:D.icon}),o.jsx("span",{className:`text-xs font-black uppercase tracking-tight ${ue?"text-slate-500":"text-amber-500"}`,children:D.name})]})]}),o.jsx("p",{className:"text-xs text-slate-400 text-center font-medium italic px-6 mt-2",children:ue?`Forbedre ${ne} til niv ${me} for  lse opp.`:`Besk ${ne} i landsbyen for  smi din ${D.name}.`})]})})}return null})()]})]})})]});return o.jsxs(o.Fragment,{children:[T,o.jsx(kee,{isOpen:m.isOpen,onClose:()=>b({isOpen:!1,action:null}),onConfirm:()=>{m.action&&i(m.action),b({isOpen:!1,action:null})},roleId:((V=m.action)==null?void 0:V.targetRole)||"",cost:(H=m.action)==null?void 0:H.cost})]})},See=({weather:t,season:e,hideClouds:s,isInterior:n})=>{const i=S.useMemo(()=>Array.from({length:12}).map((d,h)=>({id:h,top:`${Math.random()*100}%`,delay:Math.random()*60,duration:40+Math.random()*60,scale:.5+Math.random()*1.5,opacity:.1+Math.random()*.3})),[]),r=S.useMemo(()=>Array.from({length:10}).map((d,h)=>({id:h,left:`${Math.random()*100}%`,delay:Math.random()*20,duration:10+Math.random()*20,size:5+Math.random()*10,rotation:Math.random()*360,drift:50+Math.random()*150})),[]),a=S.useMemo(()=>Array.from({length:5}).map((d,h)=>({id:h,left:`${10+Math.random()*80}%`,top:`${-10+Math.random()*40}%`,rotation:h*45+Math.random()*20,delay:h*2})),[]),l=()=>e==="Autumn"?"":e==="Spring"?"":e==="Winter"?"":"",u=100*(t==="Storm"?2.5:t==="Rain"?1.5:1);return o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-[5]",children:[t==="Clear"&&!n&&o.jsx("div",{className:"absolute inset-0 opacity-40",children:a.map(d=>o.jsx("div",{className:"absolute w-[400px] h-[800px] animate-sunbeam",style:{left:d.left,top:d.top,background:"radial-gradient(ellipse at top, rgba(253, 224, 71, 0.15) 0%, transparent 70%)",transform:`rotate(${d.rotation}deg)`,animationDelay:`${d.delay}s`}},d.id))}),!s&&!n&&o.jsx("div",{className:"absolute inset-0",children:i.map(d=>o.jsx("div",{className:"absolute text-white animate-cloud-drift select-none",style:{top:d.top,fontSize:`${d.scale*4}rem`,opacity:t==="Storm"?d.opacity*2:d.opacity,filter:"blur(8px)",animationDuration:`${t==="Storm"?d.duration/2:d.duration}s`,animationDelay:`-${d.delay}s`,color:t==="Storm"?"#475569":"white"},children:""},d.id))}),t==="Fog"&&!n&&o.jsx("div",{className:"absolute inset-0 bg-slate-400/10 backdrop-blur-[2px] animate-mist"}),!n&&o.jsx("div",{className:"absolute inset-0",children:r.map(d=>o.jsx("div",{className:"absolute animate-particle opacity-0",style:{left:d.left,fontSize:`${d.size}px`,animationDuration:`${d.duration}s`,animationDelay:`${d.delay}s`,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))","--wind-drift":`${u+d.drift}px`,"--wind-rotation":`${720+d.rotation}deg`},children:l()},d.id))}),(t==="Clear"||n)&&o.jsx("div",{className:"absolute inset-0",children:Array.from({length:15}).map((d,h)=>o.jsx("div",{className:"absolute w-1 h-1 bg-white/40 rounded-full animate-dust-float",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${6+Math.random()*8}s`,animationDelay:`${Math.random()*10}s`,filter:"blur(1px)"}},`dust-${h}`))}),(t==="Rain"||t==="Storm")&&!n&&o.jsx("div",{className:"absolute inset-0 bg-indigo-900/10 mix-blend-overlay"})]})},Tee=({player:t,room:e})=>{const[s,n]=S.useState(Date.now()),{handleAction:i}=_O(e==null?void 0:e.pin,t,(e==null?void 0:e.world)||null,()=>{},()=>{},()=>{},null),[r,a]=S.useState({});S.useEffect(()=>{const m=setInterval(()=>{var p;const b=Date.now();if(n(b),Math.random()<.05){const v=((p=t.activeProcesses)==null?void 0:p.filter(x=>x.type==="CROP"&&x.readyAt>b))||[];if(v.length>0){const x=v[Math.floor(Math.random()*v.length)];if(!r[x.id]){const g=Math.random()>.5?"CROW":"WEED";a(y=>({...y,[x.id]:{type:g,expiresAt:b+1e4}}))}}}a(v=>{const x={...v};let g=!1;return Object.entries(x).forEach(([y,w])=>{w.expiresAt<b&&(delete x[y],g=!0)}),g?x:v})},1e3);return()=>clearInterval(m)},[t.activeProcesses,r]);const l=S.useCallback((m,b)=>{a(p=>{const v={...p};return delete v[m],v}),i({type:"MAINTAIN_CROP",processId:m,subType:b})},[i]),c=t.activeProcesses||[],u=s,d=c.filter(m=>!(!(m.type==="CROP"||m.type==="COOP"||m.type==="MILL"||m.type==="WELL"||m.type==="CRAFT")||m.type==="WELL"&&m.readyAt>0&&u>m.readyAt+1e4)),h=(t.activeBuffs||[]).filter(m=>m.expiresAt>u);if(d.length===0&&h.length===0)return null;d.sort((m,b)=>m.readyAt-b.readyAt);const f=m=>{const b=Math.floor(m/6e4),p=Math.floor(m%6e4/1e3);return`${b}m ${p}s`};return o.jsxs("div",{className:"absolute top-6 right-6 z-[60] flex flex-col gap-2 pointer-events-none items-end",children:[h.map(m=>{const b=Math.max(0,m.expiresAt-u);return o.jsxs("div",{className:"group bg-indigo-900/90 backdrop-blur-md border border-indigo-500/30 rounded-xl p-3 shadow-xl pointer-events-auto flex items-center gap-4 transition-all hover:bg-indigo-900/100 hover:scale-105 animate-in slide-in-from-right-4 duration-300 relative",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center border bg-indigo-500/20 border-indigo-500 text-indigo-300",children:o.jsx("span",{className:"text-xl",children:""})}),o.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[o.jsx("span",{className:"text-xs font-bold text-indigo-300 uppercase tracking-wider",children:m.label}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:"text-sm font-black text-white",children:f(b)})})]}),m.description&&o.jsx("div",{className:"absolute right-full top-1/2 -translate-y-1/2 mr-3 w-48 bg-slate-900/95 border border-indigo-500/30 p-3 rounded-xl shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none translate-x-2 group-hover:translate-x-0",children:o.jsx("p",{className:"text-[10px] text-indigo-100 leading-tight",children:m.description})})]},m.id)}),d.map(m=>{const b=Math.max(0,m.readyAt-u),p=b<=0;let v="Avling Gror",x=o.jsx(Lb,{size:20}),g="Innhsting Klar!";const y=ze[m.itemId];if(m.type==="COOP")v="Hner Spiser",x=o.jsx("span",{className:"text-xl",children:""}),g="Egg klare!";else if(m.type==="MILL")v="Kverner korn",x=o.jsx("span",{className:"text-xl",children:""}),g="Mel klart!";else if(m.type==="WELL")v="Brnnen fyller seg",x=o.jsx("span",{className:"text-xl",children:""}),g="Brnnen er klar!";else if(m.type==="CRAFT"){const N=ya[m.itemId],_=Ke[m.itemId];N?(x=o.jsx("span",{className:"text-xl",children:N.icon||""}),v=N.label?`Lager ${N.label}...`:"Hndverk pgr...",g=N.label?`${N.label} klar!`:"Hndverk ferdig!"):_?(x=o.jsx("span",{className:"text-xl",children:_.icon||""}),v=`Lager ${_.name}...`,g=`${_.name} ferdig!`):(x=o.jsx("span",{className:"text-xl",children:""}),v="Hndverk pgr...",g="Hndverk ferdig!")}else y?(x=o.jsx("span",{className:"text-xl",children:y.icon}),v=`${y.label} gror`,g=`${y.label} klar!`):x=p?o.jsx(Vc,{size:20}):o.jsx(Lb,{size:20});const w=r[m.id],k=!!w&&!p;return o.jsxs("div",{className:`relative bg-slate-900/90 backdrop-blur-md border rounded-xl p-3 shadow-xl pointer-events-auto flex items-center gap-4 transition-all hover:bg-slate-900/95 animate-in slide-in-from-right-4 duration-300 ${m.type==="WELL"&&p?"animate-pulse":""} ${k?"border-rose-500/50 hover:border-rose-400 cursor-pointer group":"border-white/10"}`,onClick:k?()=>l(m.id,w.type):void 0,children:[k&&o.jsx("div",{className:"absolute -top-3 -right-3 z-50 animate-bounce",children:o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shadow-lg border-2 border-white ${w.type==="CROW"?"bg-slate-800":"bg-emerald-700"}`,children:o.jsx("span",{className:"text-lg",children:w.type==="CROW"?"":""})})}),m.yieldBonus&&m.yieldBonus>0&&o.jsxs("div",{className:"absolute -bottom-2 -right-2 px-2 py-0.5 bg-emerald-600 text-white text-[10px] font-black rounded-full shadow-lg border border-emerald-400 z-10",children:["+",Math.round(m.yieldBonus*100),"%"]}),o.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center border ${p?"bg-emerald-500/20 border-emerald-500 text-emerald-400 animate-pulse":"bg-slate-800 border-white/10 text-slate-400"}`,children:x}),o.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[o.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:p?g:k?w.type==="CROW"?"Fjern Krke!":"Luk ugress!":v}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:`text-sm font-black ${p?"text-emerald-400":k?"text-rose-400":"text-white"}`,children:p?"Hent n":f(b)})})]})]},m.id)})]})},Wn=({title:t,subtitle:e,icon:s,headerRight:n,children:i,onClose:r,className:a,maxWidth:l,hideHeader:c=!1,noPadding:u=!1})=>(S.useEffect(()=>{const d=h=>{h.key==="Escape"&&r()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[r]),o.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center p-4 md:p-8",children:[o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"absolute inset-0 bg-black/20 backdrop-blur-[1px] cursor-pointer"}),o.jsxs(Z.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:260,damping:25,mass:1},className:`relative w-full ${l||"max-w-5xl"} max-h-full bg-slate-950/90 backdrop-blur-md border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto will-change-transform`,children:[!c&&o.jsxs("div",{className:"flex-none flex justify-between items-center px-6 py-4 border-b border-white/10 bg-gradient-to-r from-white/5 to-transparent min-h-[72px]",children:[o.jsxs("div",{className:"flex items-center gap-5 overflow-hidden",children:[s&&o.jsx("div",{className:"w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-3xl shadow-inner border border-white/5 shrink-0",children:s}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[t&&o.jsx("h2",{className:"text-xl font-display font-black text-white tracking-tighter uppercase truncate",children:t}),e&&o.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest truncate opacity-80",children:e})]}),n&&o.jsx("div",{className:"hidden sm:flex items-center pl-4 border-l border-white/10 ml-2",children:n})]}),o.jsx("button",{onClick:()=>{console.log("Close button clicked"),Ye.resume().catch(()=>{}),Ye.playSfx("click"),r()},className:"w-8 h-8 bg-white/5 hover:bg-rose-500/20 text-slate-400 hover:text-rose-500 rounded-full flex items-center justify-center transition-all group",title:"Lukk vindu",children:o.jsx("span",{className:"text-lg group-hover:rotate-90 transition-transform",children:""})})]}),o.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar ${u?"":"p-6"} ${a||""}`,children:i})]})]})),Eee=({children:t,variant:e="primary",size:s="md",icon:n,className:i="",...r})=>{const a="relative inline-flex items-center justify-center font-bold tracking-wide transition-all duration-200 uppercase rounded shadow-lg active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",l={primary:"bg-blue-600 hover:bg-blue-500 text-white border-b-4 border-blue-800 hover:border-blue-700",secondary:"bg-game-stone hover:bg-gray-500 text-white border-b-4 border-gray-700",danger:"bg-game-danger hover:bg-red-500 text-white border-b-4 border-red-700",wood:"bg-game-wood hover:bg-amber-800 text-game-paper border-2 border-game-wood_light shadow-inner",ghost:"bg-transparent hover:bg-white/10 text-white shadow-none"},c={sm:"px-3 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},u=h=>{Ye.resume().catch(()=>{}),e==="primary"||e==="danger"?Ye.playSfx("confirm"):Ye.playSfx("ui_click"),r.onClick&&r.onClick(h)},d=h=>{Ye.playSfx("ui_hover"),r.onMouseEnter&&r.onMouseEnter(h)};return o.jsxs("button",{className:`${a} ${l[e]} ${c[s]} ${i}`,onClick:u,onMouseEnter:d,...r,children:[n&&o.jsx("span",{className:"mr-2",children:n}),t]})},Aee=({player:t,room:e,onAction:s,onClose:n})=>{var N,_,T,E;const i=t.role==="KING",r=(t.regionId||"").trim().toLowerCase(),a=t.regionId||"Riket";if(!e||!e.world)return null;const{world:l,regions:c}=e,u=i?null:c==null?void 0:c[t.regionId||""],d=i?l.lastRoyalTaxCollection:u==null?void 0:u.lastTaxCollection,h=d&&d.year===l.year&&d.season===l.season,f=i?l.royalTaxHistory||[]:(u==null?void 0:u.taxHistory)||[],[m,b]=S.useState(i?((_=(N=e.world)==null?void 0:N.taxRateDetails)==null?void 0:_.kingTax)||20:((E=(T=e.regions)==null?void 0:T[t.regionId||""])==null?void 0:E.taxRate)||10),[p,v]=S.useState("ADJUST"),[x,g]=S.useState(!1),{estimates:y,citizenList:w}=Ne.useMemo(()=>{let A=0,R=0,I=[];const V=m/100;return Object.values(e.players||{}).forEach(P=>{var M,F,U,C,j;if(!P||P.id===t.id)return;const O=(P.regionId||"").trim().toLowerCase();if(i?P.role==="BARON":P.role==="PEASANT"&&(O===r||O.includes(r))){const $=Number(((M=P.resources)==null?void 0:M.gold)??P.gold??P.wealth??((F=P.stats)==null?void 0:F.gold)??((C=(U=P.inventory)==null?void 0:U.find(D=>D.id==="gold"))==null?void 0:C.amount)??0),B=Number(((j=P.resources)==null?void 0:j.grain)??0);A+=$*V,R+=B*V,I.push({id:P.id,name:P.name,gold:$,grain:B,role:P.role,hasResources:!!P.resources,raw:P})}}),{estimates:{gold:Math.floor(A),grain:Math.floor(R),count:I.length,penalty:Math.max(0,Math.floor((m-10)/1.5))},citizenList:I.sort((P,O)=>O.gold-P.gold)}},[m,e.players,i,r,t.id]),k=()=>{s({type:i?"TAX_ROYAL":"TAX",taxRate:m}),n()};return o.jsx(Wn,{title:i?"STATSKASSEN":`SKATT: ${a.toUpperCase()}`,icon:o.jsx(x1,{size:18,className:"text-game-gold"}),onClose:n,children:o.jsxs("div",{className:`p-4 sm:p-6 lg:p-10 flex flex-col gap-8 w-full ${i?"max-w-6xl":"max-w-3xl"} mx-auto transition-all ${h?"grayscale-[0.5] opacity-90":""}`,children:[o.jsxs("nav",{className:"flex bg-slate-900/80 backdrop-blur-md border border-white/5 rounded-2xl p-1.5 max-w-sm mx-auto w-full shadow-2xl relative z-20",children:[o.jsxs("button",{onClick:()=>v("ADJUST"),className:`flex-1 flex items-center justify-center gap-2 py-3 text-[10px] font-black uppercase tracking-widest transition-all rounded-xl ${p==="ADJUST"?"bg-white text-black shadow-xl scale-[1.02]":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:[o.jsx(zm,{size:14})," Justering"]}),o.jsxs("button",{onClick:()=>v("HISTORY"),className:`flex-1 flex items-center justify-center gap-2 py-3 text-[10px] font-black uppercase tracking-widest transition-all rounded-xl ${p==="HISTORY"?"bg-white text-black shadow-xl scale-[1.02]":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:[o.jsx(m1,{size:14})," Historikk"]})]}),p==="ADJUST"?o.jsxs("div",{className:`grid grid-cols-1 ${i?"lg:grid-cols-12":"gap-6"} items-start animate-in fade-in zoom-in-95 duration-700`,children:[o.jsxs("div",{className:i?"lg:col-span-4 space-y-6":"space-y-6",children:[o.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-950 to-black border border-white/10 rounded-[3rem] p-8 lg:p-10 shadow-[0_30px_60px_-15px_rgba(0,0,0,0.7)] relative overflow-hidden group",children:[o.jsx("div",{className:"absolute -top-12 -right-12 w-48 h-48 bg-game-gold/5 blur-[80px] rounded-full group-hover:bg-game-gold/10 transition-colors"}),o.jsxs("div",{className:"flex justify-between items-start mb-10 relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-2xl bg-game-gold/10 flex items-center justify-center text-game-gold border border-game-gold/20",children:o.jsx(Vb,{size:24})}),o.jsxs("div",{children:[o.jsx("span",{className:"text-[10px] font-black text-game-gold/60 uppercase tracking-[0.3em] block mb-1",children:"Innkrevingsniv"}),o.jsxs("div",{className:"flex items-baseline gap-3",children:[o.jsxs("h2",{className:"text-7xl font-black text-white italic tracking-tighter leading-none",children:[m,"%"]}),o.jsx("div",{className:`px-2.5 py-1 rounded-full border text-[9px] font-black uppercase tracking-widest shadow-lg ${y.penalty>15?"bg-red-500/10 border-red-500/20 text-red-500":"bg-emerald-500/10 border-emerald-500/20 text-emerald-500"}`,children:y.penalty===0?"Optimalt":`-${y.penalty} Lojalitet`})]})]})]}),i&&o.jsx("button",{onClick:()=>g(!x),className:"p-2.5 hover:bg-white/5 rounded-full transition-all group/info",children:o.jsx(iO,{size:18,className:x?"text-game-gold":"text-slate-700 group-hover/info:text-slate-400"})})]}),o.jsxs("div",{className:"relative h-20 flex items-center mb-6 relative z-10 px-2",children:[o.jsx("div",{className:"absolute h-2 w-full bg-slate-800/50 rounded-full"}),o.jsx("div",{className:"absolute h-2 bg-gradient-to-r from-game-gold via-orange-500 to-red-600 rounded-full shadow-[0_0_30px_rgba(251,191,36,0.5)]",style:{width:`${m/50*100}%`}}),o.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:m,onChange:A=>b(parseInt(A.target.value)),disabled:h,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30"}),o.jsx("div",{className:"absolute w-12 h-12 bg-white border-[6px] border-game-gold rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.6)] transition-all pointer-events-none flex items-center justify-center scale-110",style:{left:`calc(${m/50*100}% - 24px)`},children:o.jsx("div",{className:"w-2.5 h-2.5 bg-game-gold rounded-full"})})]}),o.jsxs("div",{className:"flex justify-between text-[11px] font-black uppercase tracking-[0.25em] px-2",children:[o.jsx("span",{className:"text-slate-600",children:"Sknsel"}),o.jsx("span",{className:"text-slate-400",children:"Rettferd"}),o.jsx("span",{className:"text-red-900/80 shadow-red-500/10",children:"Tyranni"})]})]}),o.jsxs("div",{className:`grid ${i?"grid-cols-1":"grid-cols-1 sm:grid-cols-3"} gap-4`,children:[o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-900 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-game-gold/10 text-game-gold rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(hh,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:"Gull"}),o.jsxs("p",{className:"text-2xl font-black text-white italic tracking-tighter truncate leading-none mt-1",children:[y.gold,"g"]})]})]}),o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-900 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-orange-500/10 text-orange-400 rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(zm,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:"Korn"}),o.jsx("p",{className:"text-2xl font-black text-white italic tracking-tighter truncate leading-none mt-1",children:y.grain})]})]}),o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-800 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-indigo-500/10 text-indigo-400 rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(wn,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:i?"Baroner":"Borgere"}),o.jsx("p",{className:"text-2xl font-black text-white italic tracking-tighter leading-none mt-1",children:y.count})]})]})]}),o.jsx(Eee,{variant:h?"ghost":"primary",onClick:k,disabled:h||m===0||y.count===0,className:"w-full py-8 text-2xl font-black italic uppercase rounded-[2.5rem] shadow-[0_20px_40px_-10px_rgba(37,99,235,0.4)] hover:shadow-[0_25px_50px_-10px_rgba(37,99,235,0.6)] active:scale-95 transition-all h-24",children:h?"Du har skattlagt, vent til neste rstid":"EKSEKVER SKATT"})]}),i&&o.jsx("div",{className:"lg:col-span-8 h-full",children:o.jsxs("div",{className:"bg-slate-900/40 backdrop-blur-xl border border-white/5 rounded-[3.5rem] overflow-hidden flex flex-col shadow-inner h-full min-h-[600px]",children:[o.jsxs("div",{className:"px-10 py-6 border-b border-white/5 flex justify-between items-center bg-black/40",children:[o.jsx("h4",{className:"text-[12px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Vasaller & Rikdom"}),o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-game-gold/10 rounded-full border border-game-gold/20",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-game-gold animate-pulse"}),o.jsx("span",{className:"text-[10px] font-black uppercase text-game-gold tracking-widest",children:w.length})]})]}),o.jsx("div",{className:"p-8 overflow-y-auto custom-scrollbar flex-1",children:w.length===0?o.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-10 italic text-center py-20",children:[o.jsx(wn,{size:64,className:"mb-6"}),o.jsx("p",{className:"text-xl font-black uppercase tracking-[0.4em]",children:"Ingen vasaller funnet"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:w.map(A=>o.jsxs("div",{className:"group flex items-center justify-between p-6 bg-slate-900 border border-white/[0.03] rounded-[2rem] hover:bg-white/[0.07] hover:border-white/10 transition-all cursor-default",children:[o.jsxs("div",{className:"flex items-center gap-5 min-w-0",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-800 flex items-center justify-center text-slate-500 border border-white/5 group-hover:bg-game-gold/10 group-hover:text-game-gold transition-all duration-300",children:o.jsx(wn,{size:22})}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"text-base font-black text-white truncate leading-tight group-hover:tracking-wide transition-all",children:A.name}),o.jsx("span",{className:"text-[10px] font-black uppercase text-slate-600 tracking-widest mt-1.5",children:A.role})]})]}),o.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[o.jsxs("p",{className:"text-2xl font-black italic tracking-tighter text-white group-hover:text-game-gold transition-colors",children:[Math.floor(A.gold),"g"]}),o.jsx("div",{className:"w-24 h-1.5 bg-white/[0.03] rounded-full mt-2.5 overflow-hidden border border-white/[0.02]",children:o.jsx("div",{className:"h-full bg-game-gold/30 shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-all duration-700",style:{width:`${Math.min(100,A.gold/500*100)}%`}})})]})]},A.id))})})]})})]}):o.jsx("div",{className:"bg-slate-900/50 backdrop-blur-xl border border-white/5 rounded-[3rem] overflow-hidden animate-in fade-in slide-in-from-right-8 duration-700 max-w-4xl mx-auto w-full shadow-[0_40px_80px_-20px_rgba(0,0,0,0.8)]",children:o.jsxs("table",{className:"w-full text-base text-left",children:[o.jsx("thead",{className:"bg-black/40 text-[11px] text-game-gold font-black uppercase tracking-[0.25em] border-b border-white/5",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-10 py-8",children:"Tidsepoke"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Sats"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Gull"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Korn"})]})}),o.jsx("tbody",{className:"divide-y divide-white/5 font-bold",children:f.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"py-40 text-center opacity-10 font-black uppercase tracking-widest text-3xl",children:"Portalens historie er tom"})}):[...f].reverse().map((A,R)=>o.jsxs("tr",{className:"hover:bg-white/5 transition-all group",children:[o.jsxs("td",{className:"px-10 py-7 text-slate-400 group-hover:text-white transition-colors",children:["r ",A.year,", ",o.jsx("span",{className:"font-black italic text-indigo-400 uppercase tracking-widest ml-3",children:A.season.toUpperCase()})]}),o.jsxs("td",{className:"px-10 py-7 text-right font-black italic text-slate-500 group-hover:text-game-gold transition-colors",children:[A.rate,"%"]}),o.jsxs("td",{className:"px-10 py-7 text-right font-black italic text-game-gold text-2xl whitespace-nowrap",children:[A.amountGold,"g"]}),o.jsx("td",{className:"px-10 py-7 text-right font-black italic text-orange-400 text-2xl whitespace-nowrap",children:A.amountGrain||0})]},R))})]})}),x&&i&&o.jsxs("div",{className:"p-8 bg-black/60 backdrop-blur-2xl border border-red-500/20 rounded-[2.5rem] mt-6 animate-in slide-in-from-top-6 max-w-lg mx-auto w-full shadow-2xl",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-5 border-b border-red-500/10 pb-4",children:[o.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg text-red-500",children:o.jsx(oc,{size:20})}),o.jsx("p",{className:"text-[12px] font-black text-red-400 uppercase tracking-[0.3em]",children:"Systemisk Diagnose"})]}),o.jsxs("div",{className:"text-[11px] font-mono text-slate-500 space-y-2",children:[o.jsxs("div",{className:"flex justify-between border-b border-white/[0.02] pb-1",children:[o.jsx("span",{children:"Region ID:"})," ",o.jsx("span",{className:"text-white font-bold",children:r})]}),o.jsxs("div",{className:"flex justify-between border-b border-white/[0.02] pb-1",children:[o.jsx("span",{children:"Active Entities:"})," ",o.jsx("span",{className:"text-white font-bold",children:Object.keys(e.players).length})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Match Success:"})," ",o.jsx("span",{className:"text-emerald-500 font-bold",children:w.length>0?"YES":"NO"})]})]})]})]})})},jee=({player:t,activeProcesses:e,onAction:s,onClose:n})=>{var x,g;const i=e.filter(y=>y.type==="COOP"&&y.locationId==="chicken_coop"),r=i.length>0,a=i[0],[l,c]=S.useState(0);S.useEffect(()=>{if(!a){c(0);return}const y=()=>{const k=Math.max(0,a.readyAt-Date.now());c(k)};y();const w=setInterval(y,1e3);return()=>clearInterval(w)},[a]);const u=r&&l<=0,d=t.resources.grain||0,h=()=>{s({type:"FEED_CHICKENS",locationId:"chicken_coop"})},f=()=>{s({type:"COLLECT_EGGS",locationId:"chicken_coop"})},m=a?a.readyAt-a.startedAt:1,b=a?1-l/m:0,p=((g=(x=t.buildings)==null?void 0:x.farm_house)==null?void 0:g.level)||1,v=p>1?`map_peasant_farm_lvl${p}`:"map_peasant_farm";return o.jsx(Wn,{title:"Hnsehuset",icon:o.jsx("span",{className:"text-2xl",children:""}),onClose:n,children:o.jsxs("div",{className:"p-6 flex flex-col items-center gap-8 min-h-[400px]",children:[o.jsxs("div",{className:"relative w-full h-48 bg-slate-900/50 rounded-2xl overflow-hidden border border-white/10 flex items-center justify-center",children:[o.jsx("img",{src:`/Simulation_StandAlone_Pro/${v}.png`,className:"absolute inset-0 w-full h-full object-cover opacity-30 grayscale",alt:"Coop Background"}),o.jsxs("div",{className:"relative z-10 flex gap-4",children:[o.jsx(Z.div,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},className:"text-6xl",children:""}),r&&!u&&o.jsx(Z.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-6xl",children:""}),u&&o.jsx(Z.div,{initial:{scale:0},animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1},className:"text-6xl drop-shadow-[0_0_15px_rgba(251,191,36,0.8)]",children:""})]})]}),o.jsxs("div",{className:"text-center space-y-4 max-w-sm",children:[!r&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Sultne Hner"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Hnene kakler utlmodig. Gi dem korn for  starte eggproduksjonen."}),o.jsxs("div",{className:"flex items-center justify-center gap-4 bg-slate-800/50 p-4 rounded-xl border border-white/5",children:[o.jsx(Wi,{resource:"grain",amount:d,size:"lg"}),o.jsx("button",{onClick:h,disabled:d<5,className:`
                                        px-6 py-3 rounded-xl font-bold uppercase tracking-wider text-sm transition-all
                                        ${d>=5?"bg-amber-500 hover:bg-amber-400 text-amber-950 shadow-amber-500/20 shadow-lg":"bg-slate-700 text-slate-500 cursor-not-allowed"}
                                    `,children:"Fr Hner (5 Korn)"})]})]}),r&&!u&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Hnene Spiser"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Det tar tid  lage gode egg..."}),o.jsx("div",{className:"w-full h-4 bg-slate-800 rounded-full overflow-hidden border border-white/10",children:o.jsx(Z.div,{className:"h-full bg-amber-500",initial:{width:`${b*100}%`},animate:{width:`${b*100}%`},transition:{duration:1,ease:"linear"}})}),o.jsxs("p",{className:"font-mono text-amber-400 font-bold",children:[Math.ceil(l/6e4)," minutter igjen"]})]}),u&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Eggene er klare!"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Redet er fullt av ferske egg."}),o.jsx("button",{onClick:f,className:"px-8 py-4 bg-emerald-500 hover:bg-emerald-400 text-white rounded-xl font-black uppercase tracking-widest text-lg shadow-emerald-500/30 shadow-2xl animate-pulse",children:"Samle Egg"})]})]})]})})},Cee=({buildingId:t,player:e,room:s,onAction:n})=>{var v,x,g,y;const i=Us[t];if(!i)return null;const r=t==="farm_house",l=["manor_ost","manor_vest","throne_room"].includes(t)?0:1,c=r?((v=e.buildings)==null?void 0:v[t])||{level:1,progress:{}}:((y=(g=(x=s.world)==null?void 0:x.settlement)==null?void 0:g.buildings)==null?void 0:y[t])||{level:l,progress:{}},u=c.level??0,d=Object.keys(i.levels).map(Number).sort((w,k)=>w-k),h=d[d.length-1],f=u>=h,m=u+1,b=i.levels[m],p=i.levels[u];return f?o.jsxs("div",{className:"relative w-full overflow-hidden rounded-[2.5rem] bg-gradient-to-br from-amber-600/20 to-slate-900 border border-amber-500/30 shadow-2xl p-8 text-center group",children:[o.jsx("div",{className:"absolute inset-0 bg-[url('/patterns/topographic.svg')] opacity-10"}),o.jsx("div",{className:"absolute top-0 right-0 p-12 opacity-10 group-hover:opacity-20 transition-opacity",children:o.jsx(lc,{size:120,className:"text-amber-400"})}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-6",children:[o.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-[0_0_40px_rgba(251,191,36,0.4)] animate-pulse",children:o.jsx(lc,{size:40,className:"text-white drop-shadow-md"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-3xl font-black text-amber-100 uppercase tracking-tighter mb-2",children:"Mesterverk Fullfrt"}),o.jsxs("p",{className:"text-amber-200/60 font-medium max-w-md mx-auto",children:[i.name," har ndd sitt ypperste potensial (Niv ",h,")."]})]}),o.jsx("div",{className:"grid grid-cols-1 gap-3 w-full max-w-md mt-4",children:o.jsxs("div",{className:"bg-amber-950/40 border border-amber-500/20 rounded-xl p-4 flex items-center gap-4",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsxs("div",{className:"text-left",children:[o.jsx("div",{className:"text-[10px] font-black uppercase text-amber-500 tracking-widest",children:"Aktiv Bonus"}),o.jsx("div",{className:"font-bold text-amber-100",children:(p==null?void 0:p.bonus)||"Maksimal effekt"})]})]})})]})]}):o.jsxs("div",{className:"space-y-8 w-full",children:[o.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-4 items-center",children:[o.jsxs("div",{className:"bg-slate-900/50 rounded-2xl p-4 border border-white/5 flex flex-col items-center gap-2 opacity-60",children:[o.jsx("div",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Nvrende"}),o.jsxs("div",{className:"text-3xl font-black text-slate-300",children:["Niv ",u]}),o.jsx("div",{className:"text-xs text-center text-slate-500 font-medium px-2",children:(p==null?void 0:p.bonus)||"Ingen effekt"})]}),o.jsx("div",{className:"flex flex-col items-center justify-center text-indigo-500",children:o.jsx(gX,{size:32,className:"animate-pulse"})}),o.jsxs("div",{className:"bg-indigo-600/10 rounded-2xl p-5 border border-indigo-500/30 flex flex-col items-center gap-2 relative overflow-hidden shadow-[0_0_30px_rgba(99,102,241,0.1)]",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-indigo-500"}),o.jsx("div",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-widest",children:"Neste Oppgradering"}),o.jsxs("div",{className:"text-4xl font-black text-white",children:["Niv ",m]}),o.jsx("div",{className:"text-xs text-center text-indigo-200 font-bold px-2 bg-indigo-500/20 py-1 rounded-full mt-1",children:(b==null?void 0:b.bonus)||"???"})]})]}),o.jsx("div",{className:"bg-slate-950/30 rounded-xl p-4 text-center border border-white/5",children:o.jsxs("p",{className:"text-slate-400 text-sm italic",children:['"',i.description,'"']})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between px-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]",children:"Ressurskrav"}),o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:r?"Privat Bygg":"Felles Dugnad"})]}),o.jsx("div",{className:"grid grid-cols-1 gap-3",children:Object.entries(b.requirements||{}).map(([w,k])=>{var V,H;const N=Math.floor(((V=c.progress)==null?void 0:V[w])||0),_=Math.min(100,N/k*100),T=Math.floor(((H=e.resources)==null?void 0:H[w])||0),E=k-N,A=T>0&&E>0,R=Math.min(T,E),I=N>=k;return o.jsxs("div",{className:"relative group overflow-hidden bg-slate-900 border border-white/10 rounded-2xl transition-all hover:border-white/20",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-950",children:o.jsx("div",{className:`h-full transition-all duration-1000 ease-out opacity-20 ${I?"bg-emerald-500":"bg-indigo-500"}`,style:{width:`${_}%`}})}),o.jsxs("div",{className:"relative z-10 p-4 flex items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center gap-4 min-w-[120px]",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-xl shadow-inner ${I?"bg-emerald-500/20 text-emerald-400":"bg-slate-800 text-slate-400"}`,children:I?o.jsx(Vc,{size:20}):w==="gold"?"":w==="wood"?"":w==="stone"?"":w==="plank"?"":""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:w}),o.jsxs("div",{className:`font-bold ${I?"text-emerald-400":"text-white"}`,children:[N," / ",o.jsx("span",{className:"text-slate-500",children:k})]})]})]}),!I&&o.jsx("div",{className:"flex items-center gap-3",children:A?o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsxs("span",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-wide",children:["Du har: ",T]}),o.jsxs("button",{onClick:()=>n({type:r?"CONTRIBUTE_TO_PRIVATE_UPGRADE":"CONTRIBUTE_TO_UPGRADE",buildingId:t,resource:w,amount:R}),className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest rounded-lg transition-all active:scale-95 shadow-lg shadow-indigo-900/20 flex items-center gap-2",children:[o.jsx(To,{size:12}),"Gi ",R]})]}):o.jsxs("div",{className:"px-4 py-2 bg-rose-500/10 border border-rose-500/20 rounded-lg text-rose-500 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[o.jsx(Bo,{size:12}),"Mangler ",w," (",E,")"]})}),I&&o.jsx("div",{className:"px-4 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-400 text-[10px] font-black uppercase tracking-widest",children:"Fullfrt"})]})]},w)})})]}),Object.entries(b.requirements).every(([k,N])=>{var _;return(((_=c.progress)==null?void 0:_[k])||0)>=N})?o.jsxs("button",{onClick:()=>{n({type:r?"CONTRIBUTE_TO_PRIVATE_UPGRADE":"CONTRIBUTE_TO_UPGRADE",buildingId:t,resource:"dummy",amount:0})},className:"w-full py-5 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-black uppercase tracking-widest rounded-2xl shadow-[0_0_30px_rgba(16,185,129,0.4)] transition-all active:scale-95 flex items-center justify-center gap-3 animate-bounce",children:[o.jsx(To,{size:24}),"Fullfr Oppgradering til Niv ",m,"!"]}):null]})},Ree=({npc:t,step:e,setStep:s,onClose:n})=>{var i,r;return o.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in duration-300",children:o.jsxs("div",{className:"bg-slate-900 border-2 border-amber-600/30 rounded-2xl max-w-lg w-full overflow-hidden shadow-2xl",children:[o.jsxs("div",{className:"bg-slate-950 p-6 border-b border-white/5 flex gap-4 items-center",children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 border-2 border-amber-500/50 flex items-center justify-center text-3xl shadow-inner",children:""}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-black text-amber-500",children:t.name}),o.jsx("p",{className:"text-sm text-slate-400 italic font-medium",children:t.role})]}),o.jsx("button",{onClick:n,className:"ml-auto w-8 h-8 bg-white/5 hover:bg-white/10 rounded-full flex items-center justify-center text-white transition-colors",children:""})]}),o.jsxs("div",{className:"p-8 space-y-6",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest mb-2 opacity-50",children:t.description}),o.jsxs("p",{className:"text-slate-300 text-lg leading-relaxed italic border-l-4 border-amber-500/20 pl-4 py-2",children:['"',((i=t.conversation[e])==null?void 0:i.text)||"...",'"']}),o.jsx("div",{className:"grid gap-3 pt-4",children:(r=t.conversation[e])==null?void 0:r.options.map((a,l)=>o.jsxs("button",{onClick:()=>{a.nextId==="EXIT"?n():s(a.nextId)},className:"w-full text-left bg-white/5 hover:bg-amber-500/10 hover:border-amber-500/50 border border-white/10 p-4 rounded-xl transition-all font-medium text-slate-200 active:scale-[0.98]",children:[o.jsx("span",{className:"text-amber-500 mr-2",children:""})," ",a.label]},l))})]})]})})},Iee=({viewMode:t,viewingRegionId:e,player:s,onSelect:n,onEnterHub:i,onPOIAction:r,room:a})=>{const[l,c]=Ne.useState(Date.now());if(Ne.useEffect(()=>{const d=setInterval(()=>c(Date.now()),1e3);return()=>clearInterval(d)},[]),t==="kingdom")return null;const u=s.activeProcesses||[];return o.jsx(o.Fragment,{children:Gr.map(d=>{var V,H,P,O;const h=u.find(L=>L.locationId===d.id&&L.readyAt>l),f=h?Math.ceil((h.readyAt-l)/1e3):0,m=f>0;if(!(t==="global"?!d.parentId:d.parentId===t))return null;const p=s.role==="KING"&&d.id!=="peasant_farm"||d.roles.includes(s.role)||d.id==="market"||d.isHub,v=["grain_fields","flax_field","forest_clearing","mine_shaft","quarry_poi","forest_forage"].includes(d.id),x=t==="global",g=x&&e==="region_ost",y=x&&(e==="region_vest"||e==="capital"),w=t==="village",k=Object.values(a.players||{});let N=d.top,_=d.left;w&&d.village?(N=d.village.top,_=d.village.left):g&&d.ost?(N=d.ost.top,_=d.ost.left):y&&d.vest&&(N=d.vest.top,_=d.vest.left);const T=d.id==="castle",E=T&&k.some(L=>L.role==="BARON"&&L.regionId===e||e==="capital"&&L.role==="KING"),A=T?e==="capital"?"throne_room":e==="region_ost"?"manor_ost":"manor_vest":"",I=(T&&((O=(P=(H=(V=a.world)==null?void 0:V.settlement)==null?void 0:H.buildings)==null?void 0:P[A])==null?void 0:O.level)||0)>=1||E;return o.jsx(Z.div,{style:{top:N,left:_},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"absolute -translate-x-1/2 -translate-y-1/2 group z-20 pointer-events-auto",children:o.jsxs("button",{onMouseEnter:()=>xt(async()=>{const{audioManager:L}=await Promise.resolve().then(()=>So);return{audioManager:L}},void 0).then(({audioManager:L})=>L.playSfx("ui_hover")),onClick:()=>{if(xt(async()=>{const{audioManager:L}=await Promise.resolve().then(()=>So);return{audioManager:L}},void 0).then(({audioManager:L})=>L.playSfx("ui_click")),T&&!I){r(d.id,"OPEN_CONSTRUCTION");return}d.isHub?i(d.id):n(d)},className:`flex flex-col items-center transition-all ${p?"scale-100":"scale-75 opacity-40 grayscale pointer-events-none"}`,children:[o.jsxs("div",{className:"w-16 h-16 rounded-3xl flex items-center justify-center text-4xl shadow-2xl border-2 transition-all duration-300 group-hover:scale-110 bg-slate-900/90 backdrop-blur-xl border-white/10 hover:bg-slate-800 overflow-hidden relative",children:[d.icon,m&&o.jsxs("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-[2px] rounded-3xl flex flex-col items-center justify-center z-10 transition-all group-hover:scale-110",children:[o.jsx(Lb,{className:"w-5 h-5 text-indigo-400 mb-0.5 animate-pulse"}),o.jsxs("span",{className:"text-white font-black text-xs",children:[f,"s"]})]})]}),o.jsx("span",{className:"bg-indigo-600 text-white text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full mt-2 shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-indigo-600/30",children:m?`KLAR OM ${f}S`:v?"KLIKK FOR  STARTE":T?I?"G INN":"BIDRA TIL BYGGING":d.label})]})},d.id)})})},Oee=({viewMode:t,viewingRegionId:e,worldEvents:s,onSelect:n})=>t==="kingdom"||!s?null:o.jsx(o.Fragment,{children:Object.values(s).map(i=>{const r=Gr.find(m=>m.id===i.locationId);if(!r||!(t==="global"?!r.parentId:r.parentId===t))return null;const l=t==="global",c=l&&e==="region_ost",u=l&&(e==="region_vest"||e==="capital"),d=t==="village";let h=r.top,f=r.left;return d&&r.village?(h=r.village.top,f=r.village.left):c&&r.ost?(h=r.ost.top,f=r.ost.left):u&&r.vest&&(h=r.vest.top,f=r.vest.left),o.jsx(Z.div,{style:{top:h,left:f},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"absolute -translate-x-1/2 -translate-y-[150%] z-30 pointer-events-auto",children:o.jsx("button",{onClick:()=>n(i),className:`w-14 h-14 rounded-full flex items-center justify-center text-3xl shadow-[0_0_30px_rgba(255,255,255,0.4)] border-4 animate-bounce hover:scale-110 transition-transform ${i.type==="RAID"?"bg-rose-600 border-rose-900 text-white":"bg-amber-400 border-amber-700 text-slate-800"}`,children:i.type==="RAID"?"":""})},i.id)})}),Mee=({players:t,setViewingRegionId:e,setViewMode:s,currentUserId:n})=>{const i=t[n],r=i==null?void 0:i.role,a=d=>{if(i){if(i.regionId===d){e(d),s("global");return}if(r==="MERCHANT"||r==="KING"){e(d),s("global");return}alert("Du kan ikke se inn i andre regioner. Du m reise dit med Karavanen!")}},l=Object.values(t||{}),c=l.find(d=>{var h;return d.role==="BARON"&&(d.regionId==="region_vest"||((h=d.regionId)==null?void 0:h.includes("vest")))}),u=l.find(d=>{var h;return d.role==="BARON"&&(d.regionId==="region_ost"||((h=d.regionId)==null?void 0:h.includes("ost")))});return o.jsxs(o.Fragment,{children:[o.jsx(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"absolute top-[35%] left-[50%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("capital"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-6xl drop-shadow-[0_0_15px_rgba(255,215,0,0.8)] animate-pulse",children:""}),o.jsx("div",{className:"bg-black/80 text-amber-400 px-4 py-2 rounded-xl mt-2 font-black uppercase tracking-widest text-xs border border-amber-500/50 shadow-xl backdrop-blur-md",children:"Kongeriket"})]})}),o.jsx(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"absolute top-[65%] left-[15%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("region_vest"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-5xl drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]",children:""}),o.jsx("div",{className:"bg-black/80 text-indigo-300 px-3 py-1 rounded-xl mt-2 font-bold text-[10px] uppercase tracking-wider border border-white/10 shadow-xl backdrop-blur-md whitespace-nowrap",children:(c==null?void 0:c.name)||"Baroni Vest"})]})}),o.jsx(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"absolute top-[65%] left-[85%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("region_ost"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-5xl drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]",children:""}),o.jsx("div",{className:"bg-black/80 text-emerald-300 px-3 py-1 rounded-xl mt-2 font-bold text-[10px] uppercase tracking-wider border border-white/10 shadow-xl backdrop-blur-md whitespace-nowrap",children:(u==null?void 0:u.name)||"Baroni st"})]})})]})},kT=({player:t,room:e,onAction:s,onClose:n,viewingRegionId:i,initialProjectId:r})=>{var _,T,E,A;const a=i==="dock_hub"?["wharf"]:i==="region_ost"?["manor_ost"]:i==="region_vest"?["manor_vest"]:i==="capital"||t.role==="BARON"||t.role==="KING"?["throne_room","manor_ost","manor_vest","wharf"]:["throne_room"],l=r&&(a.includes(r)||["throne_room","wharf"].includes(r))?r:a[0],[c,u]=S.useState(l),d=((T=(_=e.world)==null?void 0:_.settlement)==null?void 0:T.buildings)||{},h=a.filter(R=>d[R]),f=h.includes(c)?c:h[0]||c,m=d[f],b=Us[f];if(!m||!b)return o.jsx(Wn,{title:"Gjenoppbygging",onClose:n,children:o.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-center p-12",children:[o.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-6 text-2xl opacity-50",children:""}),o.jsx("h3",{className:"text-xl font-black text-white italic mb-2",children:"Ingen aktive byggeprosjekter"}),o.jsx("p",{className:"text-slate-500 text-sm max-w-xs",children:"Det er ingen storsltte prosjekter i dette omrdet som krever din hjelp akkurat n. Prv  dra til hovedstaden eller et av baroniene."}),o.jsx("button",{onClick:n,className:"mt-8 px-8 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-[11px] font-black uppercase tracking-widest text-slate-400",children:"Lukk vindu"})]})});const p=(m.level||0)+1,v=((A=(E=b.levels)==null?void 0:E[p])==null?void 0:A.requirements)||{},x=m.contributions||{};let g=0,y=0;Object.entries(v).forEach(([R,I])=>{var V;g+=I,y+=((V=m.progress)==null?void 0:V[R])||0});const w=g>0?y/g*100:0,k=(R,I)=>{s({type:"CONTRIBUTE",buildingId:f,resource:R,amount:I})},N=Object.entries(x).map(([R,I])=>{const V=re.CONTRIBUTION_VALUES;let H=0;return Object.entries(I.resources||{}).forEach(([P,O])=>{H+=O*(V[P]||V.default)}),{id:R,name:I.name,total:H}}).sort((R,I)=>I.total-R.total);return o.jsx(Wn,{title:"Gjenoppbygging & Lederskap",onClose:n,children:o.jsxs("div",{className:"max-h-[70vh] overflow-y-auto custom-scrollbar p-1",children:[h.length>1&&o.jsx("div",{className:"flex gap-2 mb-6 bg-slate-900/50 p-1.5 rounded-2xl border border-white/5 w-fit",children:h.map(R=>{var I;return o.jsx("button",{onClick:()=>u(R),className:`px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-widest transition-all ${f===R?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:((I=Us[R])==null?void 0:I.name)||R},R)})}),o.jsxs("div",{className:"relative h-48 rounded-3xl overflow-hidden mb-8 group border border-white/5",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-900/40 to-transparent z-10"}),o.jsx("img",{src:`/Simulation_StandAlone_Pro/antigravity/brain/07597a3b-439f-498d-aa43-1b02768f5015/${f==="throne_room"?"maritime_shipyard_blueprint_bg_1768089214778.png":"maritime_wharf_upgrade_epic_1768089228676.png"}`,alt:b.name,className:"w-full h-48 object-cover rounded-2xl mb-6 shadow-2xl border border-white/10"}),o.jsxs("div",{className:"absolute bottom-6 left-8 z-20",children:[o.jsx("h3",{className:"text-3xl font-black text-white italic tracking-tighter uppercase",children:b.name}),o.jsx("p",{className:"text-slate-300 font-medium text-xs max-w-md",children:b.description})]}),o.jsxs("div",{className:"absolute top-6 right-8 z-20 flex flex-col items-end gap-2",children:[o.jsx("div",{className:"bg-emerald-500/20 backdrop-blur-md px-4 py-2 rounded-full border border-emerald-500/30",children:o.jsxs("span",{className:"text-emerald-400 font-black text-xs tabular-nums",children:[w.toFixed(0),"% FULLFRT"]})}),o.jsx("div",{className:"bg-white/5 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 opacity-40",children:o.jsxs("span",{className:"text-white/60 font-bold text-[11px] uppercase tracking-tighter",children:["DB Niv: ",m.level||0," / Max: ",Object.keys(b.levels||{}).length]})})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsx("div",{className:"space-y-6",children:o.jsxs("section",{children:[o.jsx("h4",{className:"text-[11px] font-black text-slate-500 uppercase tracking-widest mb-4",children:"Mangler for ferdigstillelse"}),o.jsx("div",{className:"space-y-4",children:Object.entries(v).map(([R,I])=>{var M,F,U,C,j;const V=((M=m.progress)==null?void 0:M[R])||0,H=I,P=Math.min(100,V/H*100),O=V>=H,L=((F=t.resources)==null?void 0:F[R])||0;return o.jsxs("div",{className:`p-4 rounded-2xl border transition-all ${O?"bg-emerald-500/5 border-emerald-500/20":"bg-slate-900/50 border-white/5"}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-xl",children:((U=ze[R])==null?void 0:U.icon)||""}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-bold text-white tracking-tight italic",children:((C=ze[R])==null?void 0:C.label)||R}),o.jsxs("p",{className:"text-[11px] text-slate-500 font-medium",children:["Beholdning: ",o.jsx("span",{className:"text-slate-300",children:typeof L=="number"?L.toLocaleString():L})]})]})]}),o.jsx("div",{className:"text-right",children:o.jsxs("span",{className:`text-xs font-black ${O?"text-emerald-400":"text-slate-300"}`,children:[V," / ",H]})})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-950 rounded-full overflow-hidden mb-4",children:o.jsx("div",{style:{width:`${P}%`},className:`h-full transition-all duration-500 ${O?"bg-emerald-500":"bg-indigo-500"}`})}),(L>0||O)&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>k(R,Math.min(10,L||1)),className:`flex-1 py-2 rounded-xl text-[11px] font-black text-white transition-all uppercase border
                                                            ${O?"bg-white/5 border-white/10 opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}
                                                        `,children:O?"Lager Fullt":"Gi 10"}),o.jsx("button",{onClick:()=>k(R,Math.min(50,L||1)),className:`flex-1 py-2 rounded-xl text-[11px] font-black text-white transition-all uppercase
                                                            ${O?"bg-indigo-600/20 text-indigo-300/50 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}
                                                        `,children:O?"Fullfrt":"Gi 50"})]}),L<=0&&!O&&o.jsx("div",{className:"py-2 text-center bg-black/20 rounded-xl border border-white/5",children:o.jsxs("span",{className:"text-[11px] font-black text-slate-600 uppercase tracking-widest",children:["Du mangler ",((j=ze[R])==null?void 0:j.label)||R]})})]},R)})})]})}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("section",{className:"bg-slate-900/50 border border-white/5 rounded-[2rem] p-6",children:[o.jsx("h4",{className:"text-[11px] font-black text-slate-500 uppercase tracking-widest mb-6 px-2",children:"Toppbidragsytere"}),o.jsx("div",{className:"space-y-2",children:N.length===0?o.jsx("div",{className:"text-center py-8 text-slate-500 text-xs italic",children:"Ingen bidrag enda. Bli den frste!"}):N.slice(0,5).map((R,I)=>o.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl ${I===0?"bg-amber-500/10 border border-amber-500/20":"hover:bg-white/5 transition-colors"}`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center text-[11px] font-black ${I===0?"bg-amber-500 text-slate-950":"bg-slate-800 text-slate-400"}`,children:I+1}),o.jsx("span",{className:`text-sm font-bold ${I===0?"text-white":"text-slate-300"}`,children:R.name})]}),o.jsxs("span",{className:"text-xs font-mono text-slate-500",children:[R.total.toLocaleString()," poeng"]})]},R.id))})]}),o.jsxs("section",{className:"bg-indigo-600/10 border border-indigo-500/20 rounded-[2rem] p-6 relative overflow-hidden",children:[o.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-indigo-500/10 blur-2xl rounded-full"}),o.jsx("h4",{className:"text-[11px] font-black text-indigo-400 uppercase tracking-widest mb-4",children:"Gevinst"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("span",{className:"text-4xl",children:c==="throne_room"?"":""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white font-black italic tracking-tight underline decoration-indigo-500/50",children:c==="throne_room"?"TITTEL: KONGE":"TITTEL: BARON"}),o.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Spilleren med hyest poengsum ved ferdigstillelse overtar styringen."})]})]})]})]})]})]})})},Ag=[{level:0,label:"Gammelt Trestativ",slots:2,cost:{wood:50},visual:"wood"},{level:1,label:"Forsterket Jernstativ",slots:4,cost:{wood:100,ore:50},visual:"iron"},{level:2,label:"Forgylt Kongestativ",slots:6,cost:{wood:200,ore:100,gold:500},visual:"gold"}],Dee=[{id:"trophy_rusty_sword",label:"Rustent Sverd",desc:"Funnet i myra.",price:50,icon:o.jsx(Hm,{size:24,className:"text-amber-800"})},{id:"trophy_broken_shield",label:"Knust Skjold",desc:"Fra et glemt slag.",price:100,icon:o.jsx(a0,{size:24,className:"text-slate-600"})},{id:"trophy_golden_chalice",label:"Gullbeger",desc:"Kanskje litt uekte gull?",price:500,icon:o.jsx(lc,{size:24,className:"text-yellow-400"})},{id:"trophy_dragon_skull",label:"Dragehodeskalle",desc:"En fryktinngytende replika.",price:2500,icon:o.jsx("div",{className:"text-2xl",children:""})}],kO=({level:t,slots:e})=>{const s="#5D4037",n="#3E2723",i="#B7950B",r=()=>t===1?"#263238":t===2?i:n,a={filter:t===2?"drop-shadow(0 0 15px rgba(255, 215, 0, 0.3))":"drop-shadow(0 10px 15px rgba(0,0,0,0.5))"};return o.jsxs("svg",{viewBox:"0 0 400 300",className:"w-full h-full transition-all duration-500",style:a,children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"woodGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[o.jsx("stop",{offset:"0%",stopColor:n}),o.jsx("stop",{offset:"50%",stopColor:s}),o.jsx("stop",{offset:"100%",stopColor:n})]}),o.jsxs("linearGradient",{id:"goldGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"0%",stopColor:"#FFF9C4"}),o.jsx("stop",{offset:"50%",stopColor:"#FFD700"}),o.jsx("stop",{offset:"100%",stopColor:"#B7950B"})]})]}),o.jsx("ellipse",{cx:"200",cy:"270",rx:"140",ry:"20",fill:"black",opacity:"0.4"}),o.jsx("rect",{x:"60",y:"40",width:"20",height:"240",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"320",y:"40",width:"20",height:"240",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"80",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"150",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"220",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),t>=1&&o.jsxs(o.Fragment,{children:[o.jsx("circle",{cx:"70",cy:"87.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"330",cy:"87.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"70",cy:"157.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"330",cy:"157.5",r:"4",fill:t===2?"black":"#CFD8DC"})]}),e.map((l,c)=>{if(!l||!l.itemId)return null;const u=2,d=Math.floor(c/u),f=c%u===0?140:260,m=90+d*70;return o.jsxs("g",{transform:`translate(${f}, ${m})`,children:[o.jsx("ellipse",{cx:"0",cy:"40",rx:"15",ry:"5",fill:"black",opacity:"0.3"}),l.type==="ITEM"?o.jsxs("g",{transform:"scale(1.2) rotate(15)",children:[o.jsx("path",{d:"M0,-30 L0,30",stroke:"#90A4AE",strokeWidth:"4"}),o.jsx("rect",{x:"-6",y:"-10",width:"12",height:"4",fill:"#546E7A"}),o.jsx("circle",{cx:"0",cy:"32",r:"3",fill:"#FFD700"})]}):o.jsxs("g",{transform:"scale(1.5)",children:[l.itemId==="trophy_rusty_sword"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_broken_shield"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_golden_chalice"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_dragon_skull"&&o.jsx("text",{x:"-12",y:"12",fontSize:"28",children:""})]})]},c)})]})},Lee=({player:t,onAction:e,onClose:s})=>{const[n,i]=S.useState("status"),r=t.weaponRack||{},a={level:r.level||0,slots:r.slots||[],unlockedTrophies:r.unlockedTrophies||[],lastPolishedAt:r.lastPolishedAt||0},l=Ag.find(g=>g.level===a.level)||Ag[0],c=Ag.find(g=>g.level===a.level+1),u=l.slots,d=(t.inventory||[]).filter(g=>["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET","AXE","BOW","HAMMER"].includes(g.type));d.sort((g,y)=>(y.value||0)-(g.value||0));const h=g=>{e({type:"RACK_MOUNT_ITEM",itemId:g.id,instanceId:g.id})},f=g=>{e({type:"RACK_MOUNT_TROPHY",trophyId:g})},m=g=>{e({type:"RACK_UNMOUNT",slotId:g})},b=()=>{e({type:"RACK_UPGRADE"})},p=(g,y)=>{e({type:"RACK_BUY_TROPHY",trophyId:g,price:y})},v=()=>{e({type:"RACK_POLISH"})},x=a.slots.length>=u;return o.jsx(Wn,{title:"VPENKAMMERET",subtitle:"The Royal Armory",icon:o.jsx(To,{className:"text-amber-500",size:24}),onClose:s,maxWidth:"max-w-7xl",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-[700px] text-slate-200 select-none overflow-hidden",children:[o.jsxs("div",{className:"lg:col-span-3 flex flex-col bg-slate-900/50 rounded-3xl border border-white/5 overflow-hidden",children:[o.jsxs("div",{className:"p-4 border-b border-white/5 bg-white/5 flex items-center justify-between",children:[o.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Ditt Utstyr"}),o.jsxs("span",{className:"text-[10px] bg-slate-800 px-2 py-1 rounded text-slate-400",children:[d.length," gjenstander"]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2",children:[d.length===0&&o.jsx("div",{className:"text-center py-10 text-slate-600 text-xs italic",children:"Tomt i sekken..."}),d.map((g,y)=>o.jsxs("button",{disabled:x,onClick:()=>h(g),className:"w-full flex items-center gap-3 p-3 bg-slate-900 rounded-xl border border-white/5 hover:border-indigo-500/50 hover:bg-indigo-500/10 transition-all text-left disabled:opacity-50 group",children:[o.jsx("div",{className:"w-10 h-10 flex items-center justify-center bg-slate-950 rounded-lg border border-white/5 text-lg shadow-inner group-hover:scale-105 transition-transform",children:""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-bold text-base text-indigo-100 truncate group-hover:text-indigo-400 transition-colors",children:g.name}),o.jsx("div",{className:"flex items-center gap-2 text-[10px] text-slate-500",children:o.jsxs("span",{children:["Slitasje: ",g.durability||100,"%"]})})]}),o.jsx("div",{className:"opacity-0 group-hover:opacity-100 text-indigo-400 transition-opacity",children:o.jsx(h1,{size:14})})]},`inv-${y}`))]})]}),o.jsx("div",{className:"lg:col-span-6 flex flex-col relative group",children:o.jsxs("div",{className:"flex-1 bg-gradient-to-b from-slate-900 to-slate-950 rounded-3xl border border-white/10 shadow-2xl relative overflow-hidden flex items-center justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-amber-900/10 via-slate-950/50 to-slate-950 pointer-events-none"}),o.jsx("div",{className:"relative z-10 w-full h-full p-8",children:o.jsx(kO,{level:a.level,slots:a.slots})}),o.jsx("div",{className:"absolute bottom-8 right-8 z-20",children:(()=>{const g=Date.now(),y=a.lastPolishedAt||0,w=6e4*60,k=g-y,N=k>=w,_=w-k,T=Math.ceil(_/6e4);return o.jsxs("button",{onClick:v,disabled:!N,className:`flex items-center gap-2 px-4 py-3 rounded-full border transition-all backdrop-blur-sm shadow-xl 
                                            ${N?"bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 hover:text-amber-400 border-amber-500/30 hover:border-amber-500/50 hover:shadow-amber-500/10 cursor-pointer":"bg-slate-900/50 text-slate-500 border-slate-700 cursor-not-allowed grayscale"}`,children:[o.jsx(CJ,{size:18,className:N?"animate-pulse":""}),o.jsxs("div",{className:"flex flex-col items-start leading-none",children:[o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:N?"Puss Utstyr":"Ny-pusset"}),!N&&o.jsxs("span",{className:"text-[10px] lowercase text-slate-400",children:[T,"m ventetid"]})]})]})})()})]})}),o.jsxs("div",{className:"lg:col-span-3 flex flex-col gap-4",children:[o.jsxs("div",{className:"bg-slate-900/80 rounded-2xl p-2 flex border border-white/10",children:[o.jsx("button",{onClick:()=>i("status"),className:`flex-1 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${n==="status"?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-300"}`,children:"Oversikt"}),o.jsx("button",{onClick:()=>i("shop"),className:`flex-1 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${n==="shop"?"bg-amber-900/30 text-amber-500 shadow":"text-slate-500 hover:text-slate-300"}`,children:"Trofer"})]}),o.jsxs("div",{className:"flex-1 bg-slate-900/50 rounded-3xl border border-white/5 p-4 overflow-y-auto custom-scrollbar",children:[n==="status"&&o.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[o.jsxs("div",{children:[o.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-3 flex justify-between",children:[o.jsx("span",{children:"P Veggen"}),o.jsxs("span",{children:[a.slots.length," / ",u]})]}),o.jsxs("div",{className:"space-y-2",children:[a.slots.length===0&&o.jsx("div",{className:"text-xs text-slate-600 italic",children:"Tomt stativ..."}),a.slots.map(g=>o.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-800/50 rounded-lg border border-white/5",children:[o.jsx("div",{className:"text-lg",children:g.type==="TROPHY"?"":""}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsx("div",{className:"text-sm font-bold text-slate-300 truncate",children:g.itemId})}),o.jsx("button",{onClick:()=>m(g.id),className:"text-rose-500 hover:text-rose-400 p-1 hover:bg-rose-500/10 rounded",children:o.jsx("span",{className:"text-xs",children:""})})]},g.id))]})]}),o.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(MX,{className:"text-amber-500",size:16}),o.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-amber-500",children:"Neste Niv"})]}),c?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 p-4 rounded-xl border border-white/5",children:[o.jsx("div",{className:"text-sm font-bold text-white mb-2",children:c.label}),o.jsxs("div",{className:"text-[10px] text-slate-400 mb-4",children:["ker kapasiteten til ",o.jsxs("span",{className:"text-amber-400 font-bold",children:[c.slots," plasser"]}),"."]}),o.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:Object.entries(c.cost).map(([g,y])=>o.jsxs("div",{className:`text-xs px-2 py-1 rounded bg-slate-950 flex justify-between ${t.resources[g]>=y?"text-slate-300":"text-rose-400"}`,children:[o.jsx("span",{className:"capitalize",children:g}),o.jsx("span",{className:"font-mono",children:y})]},g))}),o.jsx("button",{onClick:b,disabled:!1,className:"w-full py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg font-bold text-xs shadow-lg shadow-amber-900/20 transition-all uppercase tracking-wider",children:"Oppgrader"})]}):o.jsx("div",{className:"text-center py-4 text-emerald-500 text-xs font-bold bg-emerald-500/10 rounded-xl border border-emerald-500/20",children:"Maksimalt niv ndd!"})]})]}),n==="shop"&&o.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-4 duration-300",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 p-3 bg-amber-900/10 border border-amber-500/20 rounded-xl text-amber-200 text-xs",children:[o.jsx(Ki,{size:14,className:"text-amber-400"}),o.jsx("span",{children:"Kjp unike trofer for re og bermmelse!"})]}),Dee.map(g=>{const y=a.unlockedTrophies.includes(g.id),w=(t.resources.gold||0)>=g.price;return o.jsx("div",{className:"relative p-3 bg-slate-800/40 rounded-xl border border-white/5 hover:bg-slate-800/80 transition-all group",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-lg bg-black/40 flex items-center justify-center text-2xl shadow-inner group-hover:scale-110 transition-transform duration-300",children:g.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-sm text-slate-200",children:g.label}),o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:g.desc}),o.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[o.jsxs("span",{className:"font-mono text-amber-500 font-bold text-xs",children:[g.price,"g"]}),y?a.slots.some(k=>k.itemId===g.id)?o.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider bg-slate-800 px-2 py-0.5 rounded",children:"P veggen"}):o.jsx("button",{onClick:()=>f(g.id),disabled:x,className:"px-3 py-1 rounded text-[10px] font-bold uppercase tracking-wider transition-colors bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Heng Opp"}):o.jsx("button",{onClick:()=>p(g.id,g.price),disabled:!w,className:`px-3 py-1 rounded text-[10px] font-bold uppercase tracking-wider transition-colors ${w?"bg-amber-600/20 text-amber-400 hover:bg-amber-600 hover:text-white":"bg-slate-800 text-slate-600 cursor-not-allowed"}`,children:"Kjp"})]})]})]})},g.id)})]})]})]})]})})},jg={standard:"M-150,-40 Q-120,-40 0,-50 Q120,-40 150,0 Q120,40 0,50 Q-120,40 -150,40 L-150,-40 Z",sloop:"M-140,-35 Q-100,-35 0,-45 Q100,-35 160,0 Q100,35 0,45 Q-100,35 -140,35 L-140,-35 Z",cog:"M-160,-50 Q-120,-50 0,-60 Q120,-50 140,0 Q120,50 0,60 Q-120,50 -160,50 L-160,-50 Z",galleon:"M-180,-55 Q-130,-55 0,-65 Q130,-55 170,0 Q130,55 0,65 Q-130,55 -180,55 L-180,-55 Z"},NT={standard:"M-40,-70 Q10,-70 20,0 Q10,70 -40,70",sloop:"M-60,-80 Q20,-60 60,0 Q20,60 -60,80 L-50,0 Z",cog:"M-50,-90 Q0,-90 50,0 Q0,90 -50,90",galleon:"M-60,-100 Q10,-100 60,-30 Q10,-30 -60,-30 M-50,30 Q10,30 50,90 Q10,90 -50,90"},qm=Ne.memo(({stage:t,model:e="standard",componentLevels:s={sails:0,hull:0,cannons:0,nets:0},view:n="top",variant:i="standard",customization:r={},scale:a=1,rotation:l=0,className:c=""})=>{const u=i==="drafting",d={standard:{hullFill:r.color||"#453020",hullStroke:"#2a1b12",deckFill:"#1a0f0a",deckOpacity:.4,sailFill:r.sailPattern==="striped"?"url(#stripedPattern)":"#f0e6d2",sailStroke:(s.sails||0)>=3?"#b45309":"#a8a29e",metal:"#3f3f46",wood:"#453020",gold:"#d97706"},drafting:{hullFill:"#f5f5f4",hullStroke:"#1c1917",deckFill:"#e7e5e4",deckOpacity:1,sailFill:"#fafaf9",sailStroke:"#1c1917",metal:"#44403c",wood:"#57534e",gold:"#1c1917"}},h=u?d.drafting:d.standard,f=u?"2.5":"4",m=u?"url(#inkRoughness)":"none",b=u?"300 5":"none",p=t<4,v=jg[e]||jg.standard,x=NT[e]||NT.standard,g=s.cannons||0;return n==="side"?o.jsxs(Z.svg,{viewBox:"0 0 400 300",className:`w-full h-full ${c}`,initial:!1,animate:{scale:a},style:{filter:u?"none":"drop-shadow(0 4px 6px rgba(0,0,0,0.3))"},transition:{type:"spring",stiffness:300,damping:30},children:[u&&o.jsx("defs",{children:o.jsxs("filter",{id:"inkRoughness",children:[o.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.04",numOctaves:"3",result:"noise"}),o.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"2"})]})}),o.jsxs("g",{transform:"translate(200, 180)",filter:m,children:[t>=1&&o.jsx("g",{id:"hull-side",children:o.jsx("path",{d:e==="galleon"?"M-190,-40 Q-100,50 0,60 Q100,50 180,-40 L160,-50 L-160,-50 Z":"M-160,-20 Q-150,40 0,50 Q150,40 160,-30 L140,-40 L-140,-40 Z",fill:h.hullFill,stroke:h.hullStroke,strokeWidth:f,strokeLinecap:"round",strokeDasharray:b})}),t>=2&&o.jsxs("g",{id:"mast-side",children:[o.jsx("rect",{x:"-4",y:"-180",width:"8",height:"150",rx:"2",fill:u?"none":h.wood,stroke:h.wood,strokeWidth:u?2:0}),o.jsx(Z.path,{d:"M0,-145 Q60,-90 0,-20",fill:h.sailFill,stroke:h.sailStroke,strokeWidth:"2",strokeDasharray:u?"4 2":"none",animate:{d:["M0,-145 Q60,-90 0,-20","M0,-145 Q80,-90 0,-20","M0,-145 Q60,-90 0,-20"]},transition:{repeat:1/0,duration:6,ease:"easeInOut"}})]})]})]}):o.jsxs(Z.svg,{viewBox:"0 0 400 300",className:`w-full h-full ${c}`,style:{rotate:l},initial:!1,animate:{scale:a},transition:{type:"spring",stiffness:300,damping:30},children:[u&&o.jsx("defs",{children:o.jsxs("filter",{id:"inkRoughness",children:[o.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.04",numOctaves:"3",result:"noise"}),o.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"2"})]})}),o.jsxs("g",{transform:"translate(200, 150) scale(1)",filter:m,children:[t>=1&&o.jsxs("g",{id:"hull",children:[o.jsx("path",{d:p?jg.standard:v,fill:h.hullFill,stroke:h.hullStroke,strokeWidth:f,strokeLinecap:"round"}),o.jsx("path",{d:"M-130,-30 L110,-30 L130,0 L110,30 L-130,30 Z",fill:h.deckFill,fillOpacity:h.deckOpacity})]}),!p&&g>0&&o.jsxs("g",{id:"cannons",children:[o.jsx("rect",{x:"-80",y:"-45",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-40",y:"-48",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"0",y:"-50",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-80",y:"37",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-40",y:"40",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"0",y:"42",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),e==="galleon"&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"-120",y:"-42",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-120",y:"34",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"})]})]}),t>=2&&o.jsxs("g",{id:"mast-rigging",children:[o.jsx("circle",{cx:"0",cy:"0",r:"6",fill:h.wood}),o.jsx("rect",{x:"-4",y:"-80",width:"8",height:"160",rx:"2",fill:h.wood,transform:"rotate(90)"}),o.jsx("path",{d:x,fill:h.sailFill,stroke:h.sailStroke,strokeWidth:"2",opacity:u?1:.9,strokeDasharray:u?"4 2":"none"}),o.jsx(Z.path,{d:"M-4,-80 L-40,-70 L-40,-90 Z",fill:u?h.gold:r.color||"#ef4444",animate:{scaleX:[1,1.2,1],rotate:[0,5,0]},transition:{repeat:1/0,duration:1.5}})]})]})]})},(t,e)=>{var s,n,i,r,a,l;return t.stage===e.stage&&t.model===e.model&&t.view===e.view&&t.variant===e.variant&&t.scale===e.scale&&t.rotation===e.rotation&&((s=t.customization)==null?void 0:s.color)===((n=e.customization)==null?void 0:n.color)&&((i=t.componentLevels)==null?void 0:i.sails)===((r=e.componentLevels)==null?void 0:r.sails)&&((a=t.componentLevels)==null?void 0:a.cannons)===((l=e.componentLevels)==null?void 0:l.cannons)}),Pee=({children:t,color:e="amber"})=>o.jsx("div",{className:`px-4 py-1.5 rounded-full bg-${e}-500/20 border border-${e}-400/30 text-${e}-400 text-[11px] font-black uppercase tracking-widest shadow-[0_0_20px_rgba(0,0,0,0.3)]`,children:t}),Cg=({children:t,onClick:e,disabled:s,variant:n="primary"})=>o.jsx("button",{onClick:e,disabled:s,className:`px-8 py-4 rounded-2xl font-black uppercase italic tracking-tighter transition-all active:scale-95 flex items-center gap-3
            ${s?"opacity-30 cursor-not-allowed grayscale":"hover:scale-105"}
            ${n==="primary"?"bg-amber-500 text-slate-950 shadow-[0_10px_30px_rgba(245,158,11,0.2)]":""}
            ${n==="ghost"?"bg-white/5 text-white border border-white/10 hover:bg-white/10":""}
            ${n==="danger"?"bg-red-500/20 text-red-400 border border-red-500/30 hover:bg-red-500/30":""}
        `,children:t}),Vee=({player:t,world:e,onAction:s})=>{var f,m;const{season:n,time:i}=e,r=((f=t.boat)==null?void 0:f.isDamaged)||!1,a=((m=t.boat)==null?void 0:m.cannonballs)||0,l=t.resources.cannonball||0,c=t.boat&&t.boat.stage>=2&&!r,u=n.toLowerCase(),d=i.toLowerCase(),h=`/Simulation_StandAlone_Pro/assets/maritime/dock_${u}_${d}.png`;return o.jsxs("div",{className:"relative w-full h-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center font-sans tracking-tight",children:[o.jsxs("div",{className:"absolute inset-0 z-0",children:[o.jsx(y1,{src:h,alt:`${n} ${i} Dock View`,className:"w-full h-full object-cover brightness-[0.7] contrast-[1.1]",disableMotion:!0}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950/90 via-transparent to-slate-950/40 pointer-events-none"})]}),o.jsx(Dt,{children:t.boat&&t.boat.stage>0&&o.jsx(Z.div,{initial:{x:-100,opacity:0},animate:{x:0,opacity:1,y:[0,-10,0]},transition:{y:{repeat:1/0,duration:6,ease:"easeInOut"},default:{type:"spring",damping:20}},className:"absolute bottom-[5%] left-[5%] w-[800px] h-[500px] z-10 pointer-events-none drop-shadow-[0_40px_80px_rgba(0,0,0,0.8)]",children:o.jsx(qm,{stage:t.boat.stage,view:"side",customization:t.boat.customization,scale:.85,className:"drop-shadow-[0_10px_20px_rgba(0,0,0,0.7)]"})})}),o.jsxs("div",{className:"relative z-20 w-full h-full flex flex-col justify-between p-12",children:[o.jsxs("div",{className:"flex justify-between items-start pt-16",children:[o.jsx(Z.div,{initial:{x:-50,opacity:0},animate:{x:0,opacity:1},className:"bg-slate-950/40 backdrop-blur-2xl border border-white/5 p-6 rounded-[2rem] shadow-2xl",children:o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(Pee,{color:"amber",children:"Maritim Hub"}),o.jsx("div",{className:"h-px w-12 bg-white/10"}),o.jsxs("span",{className:"text-white/40 text-[10px] uppercase font-black tracking-widest",children:["Region ",t.regionId==="region_vest"?"Vest":"st"]})]}),o.jsx("h1",{className:"text-8xl font-black text-white italic tracking-tighter leading-none mb-2 drop-shadow-2xl",children:"KAIA"}),o.jsx("p",{className:"text-slate-400 text-base max-w-[280px] leading-relaxed font-medium",children:t.boat?"Bten din ligger klar ved bryggen. Vinden er gunstig.":"Verftet venter. Legg ned den frste kjlen for  erobre havet."})]})}),t.boat&&o.jsxs(Z.div,{initial:{x:50,opacity:0},animate:{x:0,opacity:1},className:"w-72 bg-slate-950/40 backdrop-blur-3xl border border-white/10 p-6 rounded-[2rem] shadow-2xl flex flex-col gap-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h3",{className:"text-white font-black italic uppercase tracking-tighter",children:"Arsenalet"}),o.jsx(oO,{className:"text-amber-500",size:20})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[o.jsx("span",{className:"text-white/40 text-[9px] uppercase font-bold block mb-1",children:"I Lasterom"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(tO,{size:14,className:"text-amber-400"}),o.jsx("span",{className:"text-xl font-black text-white italic",children:a})]})]}),o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[o.jsx("span",{className:"text-white/40 text-[9px] uppercase font-bold block mb-1",children:"Ryggsekk"}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:"text-xl font-black text-white italic",children:l})})]})]}),o.jsx("button",{onClick:()=>s("REFILL_AMMO"),disabled:l<=0,className:`w-full py-4 rounded-2xl font-black uppercase italic text-xs tracking-widest transition-all
                                    ${l>0?"bg-white text-slate-950 hover:scale-[1.02] active:scale-95 shadow-xl":"bg-white/5 text-white/20 cursor-not-allowed"}
                                `,children:"Last ombord"})]})]}),o.jsx(Z.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"flex justify-center gap-6",children:o.jsxs("div",{className:"flex items-center gap-6 bg-slate-950/20 backdrop-blur-md p-4 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[o.jsxs(Cg,{variant:"ghost",onClick:()=>s("OPEN_SHIPYARD"),children:[o.jsx(To,{size:18})," Verftet"]}),o.jsxs(Cg,{disabled:!c,onClick:()=>s("START_SAILING"),variant:c?"primary":"ghost",children:[o.jsx(aO,{size:20}),r?"SKADET SKROG!":"Sette Seil"]}),r&&o.jsxs(Cg,{variant:"danger",onClick:()=>s("REPAIR_BOAT"),children:[o.jsx(b1,{size:18})," Reparer"]})]})})]}),o.jsx("div",{className:"absolute top-[45%] w-full h-px bg-white/5 shadow-[0_0_50px_rgba(255,255,255,0.1)] pointer-events-none"})]})},NO=S.memo(({stage:t,model:e,componentLevels:s,customization:n})=>o.jsxs("div",{className:"absolute inset-0 flex items-center justify-center p-12 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none mix-blend-multiply",style:{backgroundColor:"#1c1917",backgroundImage:"radial-gradient(circle at center, #292524 0%, #1c1917 100%)"}}),o.jsx(Z.div,{initial:{opacity:0,scale:.95,filter:"blur(2px)"},animate:{opacity:1,scale:1,filter:"blur(0px)"},transition:{duration:.8,ease:"easeInOut"},className:"w-full h-full relative z-10",children:o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(qm,{stage:t,model:e,componentLevels:s,customization:n,view:"side",variant:"standard",className:"opacity-100 drop-shadow-2xl"})})},e),o.jsx("div",{className:"absolute top-8 left-8 flex flex-col gap-1 pointer-events-none opacity-60",children:o.jsx("span",{className:"font-serif italic text-[#1e293b] text-sm",children:"Fig. 1: Lateral View"})}),o.jsxs("div",{className:"absolute bottom-8 right-8 text-right pointer-events-none opacity-60",children:[o.jsxs("div",{className:"font-serif font-bold text-[#1e293b] text-xs uppercase tracking-widest",children:["Model: ",(e==null?void 0:e.toUpperCase())||"UNKNOWN"]}),o.jsxs("div",{className:"font-mono text-[#57534e] text-[10px] mt-1",children:["REF: ",e?e.toUpperCase().split("").reduce((i,r)=>i+r.charCodeAt(0),0).toString(16).padEnd(4,"0").toUpperCase():"0000"]})]})]}),(t,e)=>t.stage===e.stage&&t.model===e.model&&t.componentLevels===e.componentLevels&&JSON.stringify(t.customization)===JSON.stringify(e.customization));NO.displayName="ShipyardVisualizer";const $h={parchment:"#d6cbb8",inkPrimary:"#0c0a09"},_d=({onClick:t,children:e,disabled:s,variant:n="primary",className:i=""})=>{const r=n==="primary";return o.jsxs(Z.button,{whileHover:s?{}:{scale:1.02,y:-1},whileTap:s?{}:{scale:.98,y:1},onClick:t,disabled:s,className:`
                relative px-6 py-2 font-bold uppercase tracking-widest text-xs transition-all
                ${s?"opacity-40 cursor-not-allowed grayscale":"cursor-pointer"}
                ${i}
            `,style:{backgroundColor:r?$h.inkPrimary:"transparent",color:r?$h.parchment:$h.inkPrimary,border:r?"none":`2px solid ${$h.inkPrimary}`,borderRadius:"2px"},children:[!r&&o.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-visible",style:{opacity:.6},children:o.jsx("path",{d:"M0,0 L100%,0 L100%,100% L0,100% Z",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeDasharray:"4 2"})}),e]})},SO=({onClick:t,label:e,color:s="#b91c1c"})=>o.jsxs(Z.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:t,className:"flex flex-col items-center gap-2 group",children:[o.jsxs("div",{className:"w-16 h-16 rounded-full flex items-center justify-center shadow-lg relative",style:{background:`radial-gradient(circle at 30% 30%, ${s}, #7f1d1d)`,boxShadow:"0 4px 6px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.2)"},children:[o.jsx("div",{className:"absolute inset-0 border-4 border-dashed border-black/10 rounded-full opacity-50",style:{transform:"rotate(15deg)"}}),o.jsx("span",{className:"font-serif font-black text-white/90 text-xl drop-shadow-md",children:""})]}),e&&o.jsx("span",{className:"font-serif font-bold text-[10px] uppercase tracking-widest text-slate-600 transition-colors group-hover:text-amber-800",children:e})]}),Fee=({title:t,level:e,maxLevel:s,description:n,effect:i,cost:r,playerResources:a,onAction:l,actionLabel:c="MONTERE"})=>{const u=e>=s;let d=!0;return u||Object.entries(r).forEach(([h,f])=>{(a[h]||0)<f&&(d=!1)}),o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#a8a29e]/20 hover:bg-[#a8a29e]/5 transition-colors group relative",children:[o.jsxs("div",{className:"flex-1 pr-8",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[o.jsx("h4",{className:"font-serif font-bold text-lg text-[#292524]",children:t}),o.jsxs("span",{className:`text-xs font-black px-2 py-0.5 rounded border uppercase tracking-widest ${e>0?"bg-amber-900/10 text-amber-800 border-amber-900/10":"bg-stone-300/50 text-stone-600 border-stone-300"}`,children:["NIV ",e," ",o.jsxs("span",{className:"text-stone-500/80",children:["/ ",s]})]})]}),o.jsx("p",{className:"text-[#44403c] italic font-serif leading-snug mb-2 text-sm max-w-md",children:n}),i&&o.jsxs("div",{className:"text-emerald-700 font-bold text-[10px] uppercase tracking-wider flex items-center gap-2",children:[o.jsx(cc,{size:12}),i]})]}),o.jsx("div",{className:"flex flex-col items-end gap-3 min-w-[240px]",children:u?o.jsx("div",{className:"flex flex-col items-center justify-center py-2 px-6 border border-[#b45309]/30 rounded bg-[#b45309]/10 w-full",children:o.jsxs("span",{className:"text-[#aa5212] font-black uppercase tracking-[0.2em] text-[10px] flex items-center gap-2",children:[o.jsx(cc,{size:10,strokeWidth:3})," Mesterverk"]})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex items-center justify-end gap-3 w-full",children:Object.entries(r).map(([h,f])=>{const m=(a[h]||0)>=f;return o.jsx("div",{className:"flex items-center gap-1.5 opacity-100",children:o.jsx(Wi,{resource:h,amount:f,size:"sm",showLabel:!0,className:m?"text-[#292524]":"text-rose-700 font-bold"})},h)})}),o.jsx(_d,{onClick:l,disabled:!d,className:`w-full py-1.5 text-xs ${d?"":"opacity-50 cursor-not-allowed"}`,children:c})]})})]})},Bee=({isOpen:t,onConfirm:e,onCancel:s,title:n,cost:i})=>t?o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-8",children:o.jsxs(Z.div,{initial:{opacity:0,scale:.9,rotate:-2},animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:.9},className:"bg-[#f2e8d5] p-8 w-full max-w-md shadow-2xl relative rotate-1 border border-[#b45309]/30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E")`},children:[o.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-32 h-8 bg-white/40 rotate-1 shadow-sm backdrop-blur-sm"}),o.jsxs("div",{className:"border-b-2 border-dashed border-[#292524]/20 pb-6 mb-6 text-center",children:[o.jsx("h3",{className:"font-serif font-black text-2xl uppercase tracking-widest text-[#2a1b12] mb-1",children:"Faktura"}),o.jsx("p",{className:"font-serif italic text-stone-600 text-sm",children:"Kongelig Skipsverft"})]}),o.jsxs("div",{className:"space-y-6 mb-8",children:[o.jsxs("div",{className:"flex justify-between items-baseline border-b border-stone-300 pb-2",children:[o.jsx("span",{className:"font-bold text-stone-500 text-sm uppercase tracking-wide",children:"Vare"}),o.jsx("span",{className:"font-serif font-bold text-lg text-[#292524]",children:n})]}),o.jsxs("div",{className:"bg-[#e7ded0] p-4 rounded-sm border border-[#d6cbb8]",children:[o.jsx("div",{className:"text-xs font-black uppercase tracking-widest text-[#b45309] mb-3 text-center",children:"Kostnader"}),o.jsx("div",{className:"flex flex-wrap justify-center gap-4 text-[#292524]",children:Object.entries(i).map(([r,a])=>o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(Wi,{resource:r,amount:a,size:"sm",showLabel:!0,className:"text-[#292524]"})},r))})]})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:s,className:"flex-1 py-3 border-2 border-[#292524]/20 font-bold uppercase tracking-widest text-xs text-[#57534e] hover:bg-[#292524]/5 transition-colors",children:"Avsl"}),o.jsx(_d,{onClick:e,className:"flex-1 py-3",variant:"primary",children:"Signer"})]})]})}):null,Uee=[{id:"construct",label:"Construction",icon:To},{id:"upgrade",label:"The Ledger",icon:vX},{id:"models",label:"Models",icon:r0},{id:"cosmetics",label:"Aesthetics",icon:VQ}],$ee=({player:t,onClose:e,onAction:s})=>{var d,h,f,m,b,p,v,x,g,y,w,k,N,_,T,E,A,R,I,V,H,P,O;const[n,i]=S.useState("construct"),r={stage:((d=t.boat)==null?void 0:d.stage)??0,hullType:((h=t.boat)==null?void 0:h.hullType)??"oak_standard",model:((f=t.boat)==null?void 0:f.model)??"standard",hp:(m=t.boat)==null?void 0:m.hp,maxHp:((b=t.boat)==null?void 0:b.maxHp)||((v=e0[(p=t.boat)==null?void 0:p.model])==null?void 0:v.baseHp)||100,componentLevels:{sails:((g=(x=t.boat)==null?void 0:x.componentLevels)==null?void 0:g.sails)??0,hull:((w=(y=t.boat)==null?void 0:y.componentLevels)==null?void 0:w.hull)??0,cannons:((N=(k=t.boat)==null?void 0:k.componentLevels)==null?void 0:N.cannons)??0,nets:((T=(_=t.boat)==null?void 0:_.componentLevels)==null?void 0:T.nets)??0},customization:{color:((A=(E=t.boat)==null?void 0:E.customization)==null?void 0:A.color)??"#4b2c20",flagId:((I=(R=t.boat)==null?void 0:R.customization)==null?void 0:I.flagId)??"none",figurehead:((H=(V=t.boat)==null?void 0:V.customization)==null?void 0:H.figurehead)??"none",unlocked:Array.isArray((O=(P=t.boat)==null?void 0:P.customization)==null?void 0:O.unlocked)?t.boat.customization.unlocked:[]}},[a,l]=S.useState(null),c=(L,M,F)=>{["BUY_BOAT_MODEL","BUY_BOAT_COSMETIC"].includes(L.type)&&F&&Object.keys(F).length>0?l({action:L,label:M||"Ukjent Vare",cost:F}):s(L)},u=()=>{a&&(s(a.action),l(null))};return o.jsx(Wn,{title:"",onClose:e,maxWidth:"max-w-7xl",hideHeader:!0,noPadding:!0,children:o.jsxs("div",{className:"flex flex-col h-[700px] w-full overflow-hidden rounded-b-xl shadow-2xl bg-[#0f0a05] relative",children:[o.jsx(Dt,{children:a&&o.jsx(Bee,{isOpen:!0,title:a.label,cost:a.cost,onConfirm:u,onCancel:()=>l(null)})}),o.jsxs("div",{className:"h-24 bg-[#2a1b12] flex items-center justify-between px-10 border-b border-[#453020] relative z-20 shadow-xl",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsx(r0,{className:"text-amber-500 drop-shadow-md",size:40}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-serif font-black text-[#e7ded0] uppercase tracking-[0.2em] leading-none",children:["Kongelig ",o.jsx("span",{className:"text-amber-500",children:"Skipsverft"})]}),o.jsx("div",{className:"h-1 w-16 bg-amber-600 mt-2 rounded-full opacity-60"})]})]}),o.jsx("div",{className:"flex gap-2 h-full pt-6 pr-12 relative z-30",children:Uee.map(L=>{const F=!(L.id==="construct")&&r.stage<4,U=n===L.id;return o.jsxs("button",{type:"button",onClick:()=>i(L.id),disabled:F,className:`
                                        flex items-center gap-3 px-8 h-full rounded-t-lg transition-all group relative overflow-hidden
                                        ${U?"bg-[#d6cbb8] text-[#2a1b12] shadow-[0_-5px_20px_rgba(0,0,0,0.3)] scale-y-110 translate-y-1":"bg-transparent text-[#a8a29e] hover:bg-[#453020] hover:text-[#e7ded0]"}
                                        ${F?"opacity-30 cursor-not-allowed grayscale":""}
                                    `,children:[o.jsx(L.icon,{size:18,className:U?"text-[#b45309]":"text-[#57534e] group-hover:text-[#e7ded0]"}),o.jsx("span",{className:"font-serif font-bold uppercase tracking-widest text-sm",children:{Construction:"Konstruksjon","The Ledger":"Loggbok",Models:"Modeller",Aesthetics:"Estetikk"}[L.label]})]},L.id)})}),o.jsx("button",{onClick:e,className:"absolute top-6 right-6 w-10 h-10 bg-black/20 hover:bg-rose-900/40 text-[#a8a29e] hover:text-rose-400 rounded-full flex items-center justify-center transition-all group border border-white/5 z-50 backdrop-blur-sm",title:"Lukk Vinduet",children:o.jsx("span",{className:"text-xl group-hover:rotate-90 transition-transform",children:""})})]}),o.jsxs("div",{className:"flex-1 grid grid-cols-[40%_60%] min-h-0 overflow-hidden bg-[#0c0a09]",children:[o.jsxs("div",{className:"relative border-r border-[#292524] bg-[#1c1917]",children:[o.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='100' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10 Q25 20 50 10 T100 10' fill='none' stroke='%2338bdf8' opacity='0.05'/%3E%3C/svg%3E")`}}),o.jsx("div",{className:"h-full flex items-center justify-center p-8 relative z-10",children:o.jsx(NO,{stage:r.stage,model:r.model,componentLevels:r.componentLevels,customization:r.customization})}),o.jsx("div",{className:"absolute bottom-6 left-0 right-0 text-center z-20",children:o.jsxs("span",{className:"font-serif italic text-[#57534e] text-sm opacity-50",children:["Fig. ",r.model.toUpperCase()]})})]}),o.jsxs("div",{className:"relative bg-[#d6cbb8] flex flex-col h-full overflow-hidden shadow-[inset_10px_0_30px_rgba(0,0,0,0.3)]",children:[o.jsx("div",{className:"absolute inset-0 opacity-[0.08] pointer-events-none mix-blend-multiply",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E")`}}),o.jsx("div",{className:"flex-1 overflow-hidden p-8 relative z-10",children:o.jsxs("div",{className:"h-full relative overflow-hidden",children:[n==="construct"&&o.jsx(Gee,{boat:r,player:t,onAction:c}),n==="upgrade"&&o.jsx(Hee,{boat:r,player:t,onAction:c}),n==="models"&&o.jsx(zee,{boat:r,player:t,onAction:c}),n==="cosmetics"&&o.jsx(Kee,{boat:r,onAction:c})]})})]})]})]})})},Gee=({boat:t,player:e,onAction:s})=>{if(console.log("[Shipyard] Rendering ConstructionView",{boat:t,stage:t==null?void 0:t.stage,player:e}),!e||!t)return console.error("[Shipyard] ConstructionView missing props",{player:e,boat:t}),o.jsx("div",{className:"p-8 text-red-500 font-bold",children:"Error: Missing Data"});const n=t.stage??0,i=["Kjlstrekking","Mast & Rigg","Dekk & Detaljer","Sjsetting"][n]||"Ukjent Fase",r=n<4?{stage:n+1,name:i,reqs:[{plank:20},{plank:40,linen_canvas:10},{plank:30,iron_ingot:10},{plank:50,tar:20}][n]||{}}:null,a=n>=4,l=t.hp??t.maxHp??100,c=t.maxHp??100,u=l/c*100,d=l<c,h=c-l,f=Math.ceil(h/10),m=d?{plank:f,tar:f}:{};return o.jsxs("div",{className:"p-8 flex flex-col gap-6 h-full overflow-y-auto scrollbar-thin scrollbar-thumb-stone-400 scrollbar-track-transparent",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-4xl font-serif font-black uppercase text-amber-900 tracking-[0.2em] mb-2 drop-shadow-sm",children:a?"VEDLIKEHOLD":`FASE ${n+1}`}),o.jsx("p",{className:"text-stone-700 font-serif italic text-lg tracking-wide",children:a?"Verft & Reparasjon":r==null?void 0:r.name})]}),a&&o.jsxs("div",{className:"bg-[#292524] rounded-sm p-6 border border-white/5 relative overflow-hidden group shadow-lg",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("span",{className:"text-sm font-bold text-stone-400 uppercase tracking-widest font-serif flex items-center gap-2",children:[o.jsx(gQ,{size:14,className:d?"text-rose-500":"text-emerald-500"}),"Skrog Integritet"]}),o.jsxs("span",{className:`font-mono text-lg font-bold ${d?"text-rose-500":"text-emerald-500"}`,children:[l," / ",c," HP"]})]}),o.jsxs("div",{className:"h-4 bg-black/40 rounded-full overflow-hidden mb-8 border border-white/5 relative",children:[o.jsx("div",{className:"absolute inset-0 flex justify-between px-1 opacity-20",children:[...Array(9)].map((b,p)=>o.jsx("div",{className:"w-[1px] h-full bg-white"},p))}),o.jsx("div",{className:`h-full transition-all duration-1000 ease-out relative ${d?"bg-rose-600":"bg-emerald-600"}`,style:{width:`${u}%`},children:o.jsx("div",{className:"absolute inset-0 bg-white/10"})})]}),d?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6 p-4 bg-black/20 rounded border border-white/5",children:[o.jsx("span",{className:"text-stone-400 text-sm font-serif italic",children:"Reparasjonskostnad:"}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(Wi,{resource:"plank",size:"sm",amount:m.plank,className:e.resources.plank>=f?"text-[#e7ded0]":"text-rose-500 font-bold"})}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(Wi,{resource:"tar",size:"sm",amount:m.tar,className:e.resources.tar>=f?"text-[#e7ded0]":"text-rose-500 font-bold"})})]})]}),o.jsx(_d,{onClick:()=>s({type:"REPAIR_BOAT"},"Reparer Skrog",m),disabled:(e.resources.plank||0)<f||(e.resources.tar||0)<f,className:"w-full py-4 text-sm",children:"Utfr Reparasjon"})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center py-6 gap-4 opacity-80",children:[o.jsx(SO,{label:"GODKJENT",color:"#10b981"}),o.jsx("span",{className:"text-emerald-500/50 text-xs font-black tracking-[0.3em] uppercase",children:"Ingen feil funnet"})]})]}),!a&&r&&o.jsxs("div",{className:"bg-[#292524] rounded-sm p-6 border border-white/5 relative overflow-hidden group shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-white/5 pb-4",children:[o.jsx("span",{className:"text-sm font-bold text-stone-400 uppercase tracking-widest font-serif",children:"Ndvendige Materialer"}),o.jsxs("span",{className:"font-serif font-bold text-[#b45309] text-lg",children:["Steg ",r.stage,"/4"]})]}),o.jsx("div",{className:"grid grid-cols-2 gap-6 mb-8",children:Object.entries(r.reqs).map(([b,p])=>{const v=e.resources[b]||0,x=v>=p;return o.jsxs("div",{className:`flex justify-between items-center pb-2 border-b ${x?"border-green-800/20":"border-red-800/20"}`,children:[o.jsx(Wi,{resource:b,size:"sm",showLabel:!0}),o.jsxs("span",{className:`font-mono text-lg font-bold ${x?"text-green-500":"text-red-500"}`,children:[v," / ",p]})]},b)})}),o.jsx(_d,{onClick:()=>s({type:"CONTRIBUTE_TO_BOAT",stage:r.stage,resources:r.reqs}),className:"w-full py-5 text-base",children:"Start Bygging"})]})]})},Hee=({boat:t,player:e,onAction:s})=>o.jsx("div",{className:"flex flex-col pb-10 overflow-y-auto max-h-[600px] scrollbar-thin scrollbar-thumb-[#b45309]/20 px-4",children:Object.entries(I_).map(([n,i])=>{const r=t.componentLevels[n]||0,a=i.levels.length,l=i.levels[r];return o.jsx(Fee,{title:i.name,level:r,maxLevel:a,description:i.description,effect:l==null?void 0:l.effect,cost:(l==null?void 0:l.cost)||{},playerResources:e.resources,onAction:()=>s({type:"UPGRADE_BOAT_COMPONENT",componentId:n})},n)})}),zee=({boat:t,player:e,onAction:s})=>o.jsx("div",{className:"flex flex-col gap-6 p-6 overflow-y-auto h-full scrollbar-thin scrollbar-thumb-stone-400 scrollbar-track-transparent",children:Object.values(e0).map(n=>{const i=t.model===n.id;return o.jsxs("div",{className:`relative p-8 rounded border transition-all ${i?"bg-[#e7ded0] border-[#b45309]":"bg-[#e0d5c1] border-[#c0b39c]"}`,children:[i&&o.jsx("div",{className:"absolute top-4 right-4 text-[#b45309] opacity-20",children:o.jsx(r0,{size:80})}),o.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:`text-2xl font-black uppercase tracking-[0.1em] mb-2 font-serif ${i?"text-amber-700":"text-stone-800"}`,children:n.name}),o.jsxs("div",{className:"flex gap-6 text-xs font-mono text-stone-600 mb-6 uppercase tracking-widest",children:[o.jsxs("span",{className:"flex items-center gap-1 font-bold",children:[o.jsx(tO,{size:14})," ",n.baseHp," HP"]}),o.jsxs("span",{className:"flex items-center gap-1 font-bold",children:[o.jsx(fO,{size:14})," ",n.baseSpeed," KNOP"]})]}),o.jsxs("p",{className:"text-base text-stone-700 max-w-lg italic border-l-4 border-[#292524]/10 pl-4 py-1 mb-4",children:['"',n.description,'"']})]}),i?o.jsx("div",{className:"flex flex-col items-center justify-center h-full pl-8",children:o.jsx(SO,{label:"Aktiv",color:"#b45309"})}):o.jsxs("div",{className:"text-right flex flex-col items-end gap-3 pl-8 min-w-[200px]",children:[o.jsx(_d,{onClick:()=>s({type:"BUY_BOAT_MODEL",modelId:n.id},`Kjp Skjte: ${n.name}`,n.cost),className:"mb-2 w-full py-3 text-sm",children:"Kjp Skjte"}),o.jsx("div",{className:"flex flex-wrap justify-end gap-2 mt-2",children:Object.entries(n.cost).map(([r,a])=>{const c=(e.resources[r]||0)>=a;return o.jsx("div",{className:`bg-stone-800/10 rounded px-2 py-1 ${c?"":"bg-rose-900/10 border border-rose-900/30"}`,children:o.jsx(Wi,{resource:r,amount:a,size:"sm",className:c?"text-[#292524]":"text-rose-700 font-bold"})},r)})})]})]})]},n.id)})}),qee=t=>o.jsx($ee,{...t}),Kee=({boat:t,onAction:e})=>o.jsx("div",{className:"p-6 space-y-8 overflow-y-auto max-h-[600px]",children:o.jsxs("div",{children:[o.jsx("h4",{className:"text-xs font-black text-stone-700 uppercase tracking-[0.2em] mb-6 border-b border-stone-400/30 pb-2 font-serif",children:"Skrogmaling"}),o.jsx("div",{className:"flex gap-4 flex-wrap",children:ju.colors.map(s=>{var r,a;const n=t.customization.unlocked.includes(s.id)||((r=s.cost)==null?void 0:r.gold)===void 0,i=t.customization.color===s.hex;return o.jsxs("button",{onClick:()=>e({type:"BUY_BOAT_COSMETIC",cosmeticType:"color",id:s.id},`Maling: ${s.name}`,n?{}:s.cost),className:`relative w-16 h-16 rounded shadow-sm transition-all ${i?"ring-4 ring-amber-600 ring-offset-2 ring-offset-[#d6cbb8] scale-105":"hover:scale-105 ring-1 ring-stone-900/10"}`,style:{backgroundColor:s.hex},title:s.name,children:[!n&&o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center rounded",children:o.jsxs("span",{className:"text-[10px] text-white font-bold bg-black/50 px-1.5 py-0.5 rounded backdrop-blur-sm",children:[(a=s.cost)==null?void 0:a.gold,"g"]})}),i&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(Vc,{size:28,className:"text-white drop-shadow-md",strokeWidth:3})})]},s.id)})})]})}),TO=({player:t,room:e,world:s,worldEvents:n,players:i,onAction:r,onOpenMarket:a})=>{var se,le,Pe,_e;const l=(s==null?void 0:s.season)||"Spring",{viewMode:c,setViewMode:u,viewingRegionId:d,setViewingRegionId:h,selectedPOI:f,setSelectedPOI:m,selectedEvent:b,setSelectedEvent:p,upgradingBuildingId:v,setUpgradingBuildingId:x,dialogNPC:g,setDialogNPC:y,dialogStep:w,setDialogStep:k,isDiceGameOpen:N,setIsDiceGameOpen:_,isChickenCoopOpen:T,setIsChickenCoopOpen:E,isConstructionOpen:A,setIsConstructionOpen:R,isTaxationOpen:I,setIsTaxationOpen:V,isGambleGameOpen:H,setIsGambleGameOpen:P,isGrainGameOpen:O,setIsGrainGameOpen:L,isShipyardOpen:M,setIsShipyardOpen:F,isWharfUpgradeOpen:U,setIsWharfUpgradeOpen:C,isFlaxGameOpen:j,setIsFlaxGameOpen:$,direction:B,handlePOIAction:D}=tee(t,r,a),z=(s==null?void 0:s.weather)||"Clear",Y=(()=>{var W,ce,Se,St,Bt;const Q=_a(((W=e.world)==null?void 0:W.gameTick)||0)==="NIGHT",ie=l==="Winter";let G="";switch(c){case"kingdom":G=ie?Q?"map_kingdom_169_winter_night":"map_kingdom_169_winter":Q?"map_kingdom_169_night":"map_kingdom_169";break;case"village":G=ie?Q?"map_village_hub_1610_winter_night":"map_village_hub_1610_winter":Q?"map_village_hub_1610_night":"map_village_hub_1610";break;case"castle":G="map_castle_interior";break;case"fields":G=ie?Q?"map_farm_fields_winter_night":"map_farm_fields_winter":Q?"map_farm_fields_night":"map_farm_fields";break;case"peasant_farm":{const jt=((Se=(ce=t.buildings)==null?void 0:ce.farm_house)==null?void 0:Se.level)||1;G=jt>1?`map_peasant_farm_lvl${jt}`:"map_peasant_farm";break}case"farm_house":{const jt=((Bt=(St=t.buildings)==null?void 0:St.farm_house)==null?void 0:Bt.level)||1;G=jt>1?`map_stugo_interior_lvl${jt}`:"map_stugo_interior";break}case"mine":G=ie?Q?"map_mountain_pass_winter_night":"map_mountain_pass_winter":Q?"map_mountain_pass_night":"map_mountain_pass";break;case"forest":G=ie?Q?"map_forest_winter_night":"map_forest_winter":Q?"map_forest_night":"map_forest";break;case"monastery":G=ie?Q?"map_monastery_winter_night":"map_monastery_winter":Q?"map_monastery_night":"map_monastery";break;case"tavern":G="map_tavern_interior";break;case"great_forge":G="map_forge_interior";break;case"bakery":G="map_bakery_interior";break;case"windmill":G="map_windmill_interior";break;case"sawmill":G="map_sawmill_interior";break;case"smeltery":G="map_smeltery_interior";break;case"weavery":G="map_weavery_interior";break;case"stables":G="map_stables_interior";break;case"watchtower":G="map_watchtower_interior";break;case"well":G=ie?Q?"map_well_interior_winter_night":"map_well_interior_winter":Q?"map_well_interior_night":"map_well_interior";break;case"apothecary":G="map_apothecary_interior";break;case"global":d==="region_ost"?G=ie?Q?"map_barony_ost_169_winter_night":"map_barony_ost_169_winter":Q?"map_barony_ost_169_night":"map_barony_ost_169":d==="capital"?G=ie?Q?"map_hovedstad_169_winter_night":"map_hovedstad_169_winter":Q?"map_hovedstad_169_night":"map_hovedstad_169":G=ie?Q?"map_barony_vest_v2_1610_winter_night":"map_barony_vest_v2_1610_winter":Q?"map_barony_vest_v2_1610_night":"map_barony_vest_v2_1610";break;case"dock":G=`map_dock_${l.toLowerCase()}_${Q?"night":"day"}`;break;default:G="map_barony_vest_v2_1610"}const oe="/Simulation_StandAlone_Pro/";return{src:`${oe}${G}.webp`,placeholder:`${oe}${G}_tiny.webp`,original:`${oe}${G}.png`}})(),me=c==="kingdom"||c==="global"&&(d==="region_ost"||d==="capital")?"aspect-video":"aspect-[16/10]",ue={initial:Q=>({opacity:0,scale:Q==="in"?.9:1.1,filter:"blur(10px)"}),animate:{opacity:1,scale:1,filter:"blur(0px)",transition:{duration:.6,ease:[.16,1,.3,1],staggerChildren:.05}},exit:Q=>({opacity:0,scale:Q==="in"?1.1:.9,filter:"blur(10px)",transition:{duration:.4,ease:[.7,0,.84,0]}})},ne=`${c}-${d}`,Le=S.useMemo(()=>Gr.find(Q=>Q.id===c),[c]),ft=!!(Le!=null&&Le.isInterior);return o.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-0",children:[o.jsxs("div",{className:`relative w-full max-w-full max-h-full mx-auto ${me} rounded-[2rem] overflow-hidden shadow-[0_0_80px_rgba(0,0,0,0.5)] border-4 border-white/5 bg-slate-950 transition-all duration-1000`,children:[o.jsx(Dt,{mode:"popLayout",custom:B,children:o.jsxs(Z.div,{custom:B,variants:ue,initial:"initial",animate:"animate",exit:"exit",className:"absolute inset-0 w-full h-full",children:[o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx(y1,{src:Y.src,placeholderSrc:Y.placeholder,alt:"Map View",className:`w-full h-full ${d!==t.regionId?"grayscale-[0.8] sepia-[0.2] brightness-125 contrast-125":""}`,disableMotion:!0}),o.jsx("div",{className:`absolute inset-0 pointer-events-none transition-opacity duration-1000 ${z==="Fog"?"opacity-100 backdrop-blur-sm bg-white/10":"opacity-0"}`}),d!==t.regionId&&o.jsx("div",{className:"absolute inset-0 pointer-events-none border-[20px] border-indigo-500/10 shadow-[inset_0_0_100px_rgba(79,70,229,0.3)] z-50 flex items-start justify-center pt-8",children:o.jsxs("div",{className:"bg-indigo-600/20 backdrop-blur-md border border-indigo-400/30 px-6 py-2 rounded-full flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),o.jsx("span",{className:"text-[10px] font-black text-indigo-200 uppercase tracking-[0.2em]",children:"Remote View"})]})})]}),c==="dock"&&o.jsx("div",{className:"absolute inset-0 z-30",children:o.jsx(Vee,{player:t,world:{season:l,weather:z,time:_a(((se=e.world)==null?void 0:se.gameTick)||0)==="NIGHT"?"Night":"Day"},onAction:Q=>D("dock",Q)})}),c==="farm_house"&&o.jsxs("div",{className:"absolute bottom-[70%] left-[10%] w-[18%] h-auto z-20 cursor-pointer hover:scale-105 hover:brightness-110 transition-all drop-shadow-2xl opacity-90 hover:opacity-100",onClick:()=>r("OPEN_WEAPON_RACK"),title:"pne Vpenstativet",children:[o.jsx("div",{className:"absolute -inset-4 bg-black/40 blur-xl rounded-full"}),o.jsx("div",{className:"relative",children:o.jsx(kO,{level:((le=t.weaponRack)==null?void 0:le.level)||0,slots:((Pe=t.weaponRack)==null?void 0:Pe.slots)||[]})})]}),o.jsx(See,{weather:z,season:l,isInterior:ft}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[c==="kingdom"&&o.jsx(Mee,{players:i||{},setViewingRegionId:h,setViewMode:u,currentUserId:t.id}),o.jsx(Iee,{viewMode:c,viewingRegionId:d,player:t,room:e,onSelect:m,onEnterHub:u,onPOIAction:Q=>D(c,Q)}),o.jsx(Oee,{viewMode:c,viewingRegionId:d,worldEvents:n,onSelect:p})]})]},ne)}),o.jsx(Tee,{player:t,room:e}),c!=="kingdom"&&o.jsxs("button",{onClick:()=>{if(Ye.playSfx("click"),c==="global")u("kingdom");else{const Q=Gr.find(ie=>ie.id===c);Q!=null&&Q.parentId?u(Q.parentId):u("global")}},className:"absolute top-6 left-6 z-50 px-6 py-3 bg-slate-950/80 backdrop-blur-md border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white hover:border-white/20 transition-all active:scale-95 flex items-center gap-2 group",children:[o.jsx("span",{className:"text-lg group-hover:-translate-x-1 transition-transform",children:""}),"Tilbake"]}),b&&o.jsx("div",{className:"absolute inset-x-6 bottom-6 z-40 animate-in slide-in-from-bottom-8 duration-500",children:o.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-2xl rounded-[2.5rem] shadow-[0_30px_100px_rgba(0,0,0,0.8)] border border-white/10 p-8",children:[o.jsxs("div",{className:"flex justify-between items-start mb-6",children:[o.jsxs("div",{children:[o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${b.type==="RAID"?"bg-rose-500/20 text-rose-400":"bg-amber-500/20 text-amber-500"}`,children:b.type==="RAID"?" Akutt Trussel":" Spesielt Oppdrag"}),o.jsx("h3",{className:"text-3xl font-black text-white mt-4 tracking-tighter",children:b.title})]}),o.jsx("button",{onClick:()=>p(null),className:"w-10 h-10 bg-white/5 hover:bg-white/10 text-white rounded-full flex items-center justify-center transition-colors",children:""})]}),o.jsxs("p",{className:"text-sm font-medium text-slate-400 mb-8 leading-relaxed italic opacity-80",children:['"',b.description,'"']}),o.jsx("button",{onClick:()=>{r({type:b.type==="RAID"?"DEFEND":"EXPLORE",eventId:b.id}),p(null)},className:`w-full py-5 rounded-2xl font-black uppercase tracking-widest text-sm shadow-2xl transition-all active:scale-95 ${b.type==="RAID"?"bg-rose-600 text-white shadow-rose-600/20":"bg-amber-500 text-slate-950 shadow-amber-500/20"}`,children:b.type==="RAID"?"TIL VPEN! ":"UTFORSK OMRDET! "})]})}),o.jsx(Dt,{children:f&&o.jsx(Nee,{poi:f,player:t,room:e,onAction:Q=>D(f.id,Q),onClose:()=>m(null),viewingRegionId:d})})]}),o.jsxs(Dt,{children:[v&&o.jsx(Wn,{title:"Bygg & Oppgrader",onClose:()=>x(null),children:o.jsx(Cee,{buildingId:v,player:t,room:e,onAction:r})}),N&&o.jsx(see,{playerGold:((_e=t.resources)==null?void 0:_e.gold)||0,onClose:()=>_(!1),onPlay:Q=>r({type:"PLAY_DICE",...Q})}),H&&o.jsx(nee,{player:t,onClose:()=>P(!1),onPlay:Q=>r({type:"PLAY_RESOURCE_GAME",...Q})}),O&&o.jsx(Wn,{title:"Kornhsting",onClose:()=>L(!1),maxWidth:"max-w-xl",children:o.jsx(vl,{resourceName:"Korn",possibleYield:12,equipment:Object.values(t.equipment||{}),onComplete:Q=>{r({type:"HARVEST",locationId:"grain_fields",cropId:"grain",performance:Q}),L(!1)}})}),T&&o.jsx(jee,{player:t,activeProcesses:t.activeProcesses||[],onAction:r,onClose:()=>E(!1)}),g&&o.jsx(Ree,{npc:g,step:w,setStep:k,onClose:()=>y(null)}),A&&o.jsx(kT,{player:t,room:e,onAction:r,onClose:()=>R(!1),viewingRegionId:d}),I&&o.jsx(Aee,{player:t,room:e,onAction:r,onClose:()=>V(!1)}),M&&o.jsx(qee,{player:t,room:e,onClose:()=>F(!1),onAction:r}),U&&o.jsx(kT,{player:t,room:e,onAction:r,onClose:()=>C(!1),viewingRegionId:"dock_hub",initialProjectId:"wharf"}),j&&o.jsx(Wn,{title:"Linhsting",onClose:()=>$(!1),maxWidth:"max-w-xl",children:o.jsx(vl,{resourceName:"Lin",possibleYield:12,equipment:Object.values(t.equipment||{}),onComplete:Q=>{r({type:"HARVEST",locationId:"flax_field",cropId:"flax",performance:Q}),$(!1)}})})]})]})};TO.displayName="GameMap";function On(t){return Ne.lazy(async()=>{try{return await t()}catch(e){if(/failed to fetch dynamically imported module/i.test(e.message)||/loading chunk/i.test(e.message)||/dynamic import/i.test(e.message)||e.name==="TypeError"&&/fetch/i.test(e.message)){const n="last_chunk_reload",i=Date.now(),r=parseInt(localStorage.getItem(n)||"0",10);if(i-r>1e4)return localStorage.setItem(n,i.toString()),console.warn("Chunk load error detected. Reloading application to fetch latest version..."),window.location.reload(),new Promise(()=>{})}throw e}})}const Wee=({onClose:t})=>{const{currentTrackId:e,playlist:s,playNext:n,playPrevious:i,toggleIgnoreTrack:r,isIgnored:a,playMusic:l,stopMusic:c}=j_(),[u,d]=S.useState(!!e),h=s.find(m=>m.id===e)||s[0],f=()=>{u&&e?(c(),d(!1)):(e?l(e):n(),d(!0))};return o.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center p-4",children:[o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/60 backdrop-blur-sm cursor-pointer"}),o.jsxs(Z.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",bounce:.3},className:"relative w-full max-w-4xl h-[600px] bg-slate-950/80 backdrop-blur-2xl border border-white/10 rounded-[3rem] shadow-2xl overflow-hidden flex flex-col md:flex-row",children:[o.jsx("button",{onClick:t,className:"absolute top-6 right-6 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white transition-colors",children:o.jsx(In,{size:24})}),o.jsxs("div",{className:"flex-1 relative flex flex-col items-center justify-center p-12 bg-gradient-to-br from-indigo-900/40 to-slate-900/40 border-r border-white/5",children:[o.jsx("div",{className:`absolute inset-0 opacity-30 bg-gradient-to-tr ${(h==null?void 0:h.mood)==="Dark"?"from-rose-900/40":"from-indigo-600/20"} to-transparent transition-colors duration-1000`}),o.jsxs("div",{className:"relative z-10 mb-12 group",children:[o.jsxs("div",{className:`w-64 h-64 rounded-full bg-slate-900 border-4 border-white/10 shadow-[0_0_60px_rgba(0,0,0,0.6)] flex items-center justify-center relative overflow-hidden ${u&&e?"animate-[spin_8s_linear_infinite]":""}`,children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle,rgba(99,102,241,0.2)0%,transparent_70%)]"}),o.jsx("div",{className:"absolute inset-2 rounded-full border border-white/5 opacity-50"}),o.jsx("div",{className:"absolute inset-8 rounded-full border border-white/5 opacity-30"}),o.jsx(zX,{size:64,className:"text-white/20"})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx("button",{onClick:f,className:"w-20 h-20 bg-white/90 rounded-full flex items-center justify-center shadow-2xl hover:scale-105 active:scale-95 transition-all text-slate-900",children:u&&e?o.jsx(Pb,{size:32,fill:"currentColor"}):o.jsx(yd,{size:32,fill:"currentColor",className:"ml-1"})})})]}),o.jsxs("div",{className:"text-center space-y-2 z-10",children:[o.jsx("p",{className:"text-xs font-black uppercase tracking-[0.3em] text-indigo-400",children:"N Spiller"}),o.jsx("h2",{className:"text-3xl font-black text-white tracking-tighter max-w-sm leading-tight",children:h?h.title:"Ingen Musikk"}),(h==null?void 0:h.mood)&&o.jsxs("span",{className:"inline-block px-3 py-1 bg-white/5 rounded-full text-[10px] font-bold text-slate-400 uppercase tracking-widest border border-white/5",children:[h.mood," Mood"]})]})]}),o.jsxs("div",{className:"w-full md:w-[400px] bg-black/20 flex flex-col",children:[o.jsxs("div",{className:"p-8 pb-4 border-b border-white/5 flex items-center justify-between",children:[o.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-widest flex items-center gap-2",children:[o.jsx(MQ,{size:16,className:"text-indigo-400"})," Spilleliste"]}),o.jsxs("span",{className:"text-[10px] font-bold text-slate-500",children:[s.length," Spor"]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-2",children:s.map((m,b)=>{const p=e===m.id,v=a(m.id);return o.jsxs("div",{className:`group flex items-center justify-between p-4 rounded-xl border transition-all duration-300 ${p?"bg-indigo-600/10 border-indigo-500/50 shadow-lg shadow-indigo-900/20":v?"bg-transparent border-transparent opacity-40 grayscale hover:opacity-100 hover:bg-slate-800/50":"bg-transparent border-transparent hover:bg-white/5 hover:border-white/5"}`,children:[o.jsxs("button",{onClick:()=>{l(m.id),d(!0)},className:"flex items-center gap-4 flex-1 text-left min-w-0",children:[o.jsx("span",{className:`text-xs font-bold w-6 text-center ${p?"text-indigo-400":"text-slate-600"}`,children:p?o.jsx(NJ,{size:14,className:"mx-auto animate-pulse"}):b+1}),o.jsx("div",{className:"min-w-0",children:o.jsx("p",{className:`text-sm font-bold truncate ${p?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:m.title})})]}),o.jsx("button",{onClick:x=>{x.stopPropagation(),r(m.id)},className:`p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all ${v?"opacity-100 text-rose-400 hover:bg-rose-500/10":"text-slate-500 hover:text-white hover:bg-white/10"}`,title:v?"Gjenoppta":"Ignorer",children:v?o.jsx(KX,{size:16}):o.jsx(YX,{size:16})})]},m.id)})}),o.jsxs("div",{className:"p-6 border-t border-white/5 bg-black/40 flex items-center justify-between",children:[o.jsx("button",{onClick:i,className:"p-4 rounded-full hover:bg-white/5 text-slate-400 hover:text-white transition-colors",children:o.jsx(iJ,{size:20})}),o.jsx("div",{className:"h-10 w-[1px] bg-white/5"}),o.jsx("button",{onClick:f,className:"p-4 rounded-full hover:bg-white/5 text-white transition-colors scale-110 active:scale-95",children:u&&e?o.jsx(Pb,{size:24,fill:"currentColor"}):o.jsx(yd,{size:24,fill:"currentColor",className:"ml-1"})}),o.jsx("div",{className:"h-10 w-[1px] bg-white/5"}),o.jsx("button",{onClick:n,className:"p-4 rounded-full hover:bg-white/5 text-slate-400 hover:text-white transition-colors",children:o.jsx(aJ,{size:20})})]})]})]})]})},Yee=({result:t,onClear:e})=>(S.useEffect(()=>{if(t){t.success&&t.utbytte&&t.utbytte.length>0&&t.utbytte.forEach((n,i)=>{n.amount>0&&setTimeout(()=>{Ze.spawnFlyingResource(n.resource,window.innerWidth/2,window.innerHeight/2,window.innerWidth-150,60)},i*200)});const s=setTimeout(()=>{e()},6e3);return()=>clearTimeout(s)}},[t,e]),o.jsx(Dt,{children:t&&o.jsxs(Z.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"fixed top-[5%] left-1/2 transform -translate-x-1/2 bg-slate-900/95 border-2 border-amber-500/30 p-5 rounded-[2rem] shadow-[0_0_50px_rgba(0,0,0,0.5)] backdrop-blur-md min-w-[300px] text-center z-[300] overflow-hidden",children:[o.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-amber-500/20 w-full overflow-hidden",children:o.jsx(Z.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:7,ease:"linear"},className:"h-full bg-amber-500"})}),o.jsx("button",{onClick:s=>{s.stopPropagation(),e()},className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors p-1",children:o.jsx(In,{className:"w-5 h-5"})}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:`text-lg font-black mb-3 tracking-tight ${t.success?"text-white":"text-rose-400"}`,children:t.message}),t.utbytte&&t.utbytte.length>0&&o.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:t.utbytte.map((s,n)=>{const i=ze[s.resource]||{label:s.resource,icon:""},r=s.name||i.label,a=s.icon||i.icon,l=s.amount>=0,c=s.jackpot;return o.jsxs(Z.div,{initial:{scale:0,y:10},animate:{scale:1,y:0},transition:{delay:.2+n*.1,type:"spring"},className:`flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-black border shadow-lg ${c?"bg-gradient-to-r from-amber-200 to-yellow-400 border-yellow-300 text-yellow-900 shadow-amber-500/50 animate-pulse":l?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":"bg-rose-500/10 border-rose-500/30 text-rose-400"}`,children:[o.jsx("span",{className:"text-lg",children:a}),o.jsxs("span",{children:[l?"+":"",s.resource==="gold"?s.amount.toFixed(2):s.amount," ",c&&r]})]},`${s.resource}-${n}`)})}),t.xp&&t.xp.length>0&&o.jsx("div",{className:"flex flex-col gap-2 mb-2",children:t.xp.map((s,n)=>o.jsxs(Z.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+n*.1},className:"text-xs font-black uppercase tracking-widest text-indigo-400 bg-indigo-500/5 py-1 rounded-lg",children:["+",s.amount," XP ",s.skill,s.levelUp&&o.jsxs(Z.div,{initial:{scale:.5,opacity:0,rotate:-5},animate:{scale:[1,1.2,1],opacity:1,rotate:[0,5,-5,0],filter:["brightness(1)","brightness(2)","brightness(1)"]},transition:{duration:.6,times:[0,.5,1],repeat:1/0,repeatType:"reverse"},className:"mt-2 inline-flex items-center gap-2 bg-gradient-to-r from-amber-400 to-amber-600 text-black px-4 py-1.5 rounded-full text-[10px] font-black shadow-[0_0_20px_rgba(245,158,11,0.5)] border border-amber-300/50",children:[o.jsx("span",{children:""}),o.jsx("span",{className:"tracking-[0.2em]",children:"NIV OPPGGRADERT!"}),o.jsx("span",{children:""})]})]},`xp-${n}`))}),t.durability&&t.durability.length>0&&o.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-wrap justify-center gap-3",children:t.durability.map((s,n)=>o.jsxs("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider flex items-center gap-1",children:[" ",s.item,": ",o.jsxs("span",{className:s.amount>0?"text-rose-400":"text-emerald-400",children:[s.amount>0?"-":"+",Math.abs(s.amount),"%"]}),s.broken&&o.jsx("span",{className:"text-rose-500 font-black ml-1 animate-pulse",children:"(DELAGT!)"})]},`dura-${n}`))})]})]})})),Xee=async(t,e,s,n)=>{if(e===s)return{success:!1,error:"Kan ikke gi gave til deg selv"};const i=q(K,`simulation_rooms/${t}/players/${e}`),r=q(K,`simulation_rooms/${t}/players/${s}`),a=await ve(i),l=await ve(r);if(!a.exists())return{success:!1,error:"Sender finnes ikke"};if(!l.exists())return{success:!1,error:"Mottaker finnes ikke"};const c=a.val(),u=l.val(),d=u.name;if(c.regionId!==u.regionId)return{success:!1,error:"Du kan kun sende gaver til spillere i din region."};let h=!1,f="";if(await De(i,p=>{if(p===null)return p;p.resources||(p.resources={});for(const[v,x]of Object.entries(n))if((p.resources[v]||0)<x)return;for(const[v,x]of Object.entries(n))p.resources[v]-=x,f+=`${x} ${v}, `;return h=!0,p}),!h)return{success:!1,error:"Ikke nok ressurser til  sende gaven."};let m=!1;if(await De(r,p=>{if(p===null)return p;p.resources||(p.resources={});for(const[v,x]of Object.entries(n))p.resources[v]=(p.resources[v]||0)+x;return m=!0,p}),!m)return console.error("CRITICAL: Gift transaction partial failure. Sender deducted but target failed.",e,s),{success:!1,error:"Transaksjonsfeil: Gaven gikk tapt i posten (Mottaker utilgjengelig i skrivende stund)."};const b=`Sendte gave (${f.slice(0,-2)}) til ${d}.`;return dt(t,`[GAVE] ${c.name} -> ${d}: ${f}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:b}}},Qee=async(t,e,s,n,i)=>{const r=q(K,`simulation_rooms/${t}/players/${e}`),a=q(K,`simulation_rooms/${t}/trades`),l=await ve(r),c=await ve(q(K,`simulation_rooms/${t}/players/${s}`));if(!l.exists()||!c.exists())return{success:!1,error:"Spiller finnes ikke"};const u=l.val(),d=c.val(),h=u.name,f=d.name;if(u.regionId!==d.regionId)return{success:!1,error:"Handel er kun tillatt med spillere i din region."};let m=!1;if(await De(r,v=>{var x;if(v===null)return v;for(const[g,y]of Object.entries(n))if((((x=v.resources)==null?void 0:x[g])||0)<y)return;for(const[g,y]of Object.entries(n))v.resources[g]-=y;return m=!0,v}),!m)return{success:!1,error:"Ikke nok ressurser til  opprette handelen."};const b=Fy(a),p={id:b.key,senderId:e,senderName:h,receiverId:s,receiverName:f,offer:n,demand:i,status:"PENDING",createdAt:Date.now(),expiresAt:Date.now()+1e3*60*60*24};return await pa(b,p),dt(t,`[HANDEL] ${h} tilbd handel til ${f}.`),{success:!0,message:"Handelstilbud sendt."}},Jee=async(t,e,s,n)=>{const i=q(K,`simulation_rooms/${t}/trades/${s}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Handelen finnes ikke lenger."};const a=r.val();if(a.status!=="PENDING")return{success:!1,error:"Handelen er ikke lenger aktiv."};if(a.receiverId!==e&&a.senderId!==e&&!(a.senderId===e&&n==="REJECT"))return{success:!1,error:"Du har ikke tilgang til denne handelen."};if(n==="REJECT"){const l=q(K,`simulation_rooms/${t}/players/${a.senderId}`);return await De(l,c=>{if(c===null)return c;c.resources||(c.resources={});for(const[u,d]of Object.entries(a.offer))c.resources[u]=(c.resources[u]||0)+d;return c}),await ae(i,{status:a.senderId===e?"CANCELLED":"REJECTED"}),{success:!0,message:"Handel avbrutt/avsltt."}}if(n==="ACCEPT"){const l=q(K,`simulation_rooms/${t}/players/${e}`);let c=!1;if(await De(l,d=>{var h;if(d===null)return d;for(const[f,m]of Object.entries(a.demand))if((((h=d.resources)==null?void 0:h[f])||0)<m)return;for(const[f,m]of Object.entries(a.demand))d.resources[f]-=m;for(const[f,m]of Object.entries(a.offer))d.resources[f]=(d.resources[f]||0)+m;return c=!0,d}),!c)return{success:!1,error:"Du har ikke rd til denne handelen."};const u=q(K,`simulation_rooms/${t}/players/${a.senderId}`);return await De(u,d=>{if(d===null)return d;d.resources||(d.resources={});for(const[h,f]of Object.entries(a.demand))d.resources[h]=(d.resources[h]||0)+f;return d}),await ae(i,{status:"ACCEPTED"}),dt(t,`[HANDEL] ${a.receiverName} godtok handelen fra ${a.senderName}.`),{success:!0,message:"Handel gjennomfrt!"}}},Zee=({player:t,room:e,onAction:s,pin:n})=>{const[i,r]=S.useState([]),a=S.useRef({}),l=S.useRef(0),c=S.useMemo(()=>e.messages?Array.isArray(e.messages)?e.messages:Object.values(e.messages).sort((m,b)=>m.timestamp-b.timestamp):[],[e.messages]),u=m=>{r(p=>[...p,m]);const b=m.actions?1e4:5e3;setTimeout(()=>d(m.id),b)},d=m=>{r(b=>b.filter(p=>p.id!==m))},h=async(m,b)=>{const p=await Jee(n,t.id,m,b);p&&p.success?(d(`trade-${m}`),u({id:`trade-res-${Date.now()}`,title:b==="ACCEPT"?"Handel Gjennomfrt":"Handel Avsltt",message:p.message||"Transaksjon fullfrt.",type:"TRADE"})):u({id:`trade-err-${Date.now()}`,title:"Feil ved handel",message:(p==null?void 0:p.error)||"Noe gikk galt.",type:"TRADE"})},f=(m,b,p)=>!p[m];return S.useEffect(()=>{const m=e.trades||{},b=a.current;Object.entries(m).forEach(([p,v])=>{if(f(p,v,b)&&v.receiverId===t.id&&v.status==="PENDING"){const x=Object.entries(v.offer).map(([y,w])=>`${w} ${y}`).join(", "),g=Object.entries(v.demand).map(([y,w])=>`${w} ${y}`).join(", ");u({id:`trade-${p}`,title:"Nytt Handelstilbud",message:`${v.senderName} tilbyr ${x} for ${g}.`,type:"TRADE",actions:[{label:"Aksepter",variant:"primary",icon:o.jsx(Vc,{size:14}),onClick:()=>h(p,"ACCEPT")},{label:"Forhandle",variant:"neutral",icon:o.jsx(vd,{size:14}),onClick:()=>{d(`trade-${p}`),alert("Forhandling er ikke implementert enn. Avsl handelen for  sende nytt tilbud.")}},{label:"Avsl",variant:"danger",icon:o.jsx(In,{size:14}),onClick:()=>h(p,"REJECT")}]})}}),a.current=m},[e.trades,t.id,n]),S.useEffect(()=>{var p;const m=c;if(m.length===0)return;const b=m[m.length-1];if(l.current===0&&m.length>0){l.current=m[m.length-1].timestamp;return}if(b.timestamp>l.current){const v=b.content;if(v.startsWith("[GAVE]")&&v.includes(`-> ${t.name}`)){const g=v.split("->")[0].replace("[GAVE]","").trim(),y=((p=v.split(":")[1])==null?void 0:p.trim())||"";u({id:`gift-${b.timestamp}`,title:`Gave fra ${g}`,message:`Du mottok: ${y}`,type:"GIFT"})}l.current=b.timestamp}},[c,t.name]),i.length===0?null:o.jsx("div",{className:"absolute top-24 right-8 z-[100] flex flex-col gap-4 pointer-events-none",children:i.map(m=>o.jsxs("div",{className:"pointer-events-auto bg-slate-900/95 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl flex flex-col gap-3 animate-in slide-in-from-right duration-300 w-96",children:[o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:`p-3 rounded-lg ${m.type==="GIFT"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"}`,children:m.type==="GIFT"?o.jsx(nO,{size:24}):o.jsx(f1,{size:24})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-white text-sm",children:m.title}),o.jsx("p",{className:"text-slate-400 text-xs mt-1 leading-relaxed",children:m.message})]}),o.jsx("button",{onClick:()=>d(m.id),className:"text-slate-600 hover:text-white transition-colors",children:o.jsx(In,{size:16})})]}),m.actions&&o.jsx("div",{className:"flex gap-2 pt-2 border-t border-white/5",children:m.actions.map((b,p)=>o.jsxs("button",{onClick:b.onClick,className:`
                                        flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all active:scale-95
                                        ${b.variant==="primary"?"bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":""}
                                        ${b.variant==="danger"?"bg-rose-600/20 hover:bg-rose-600/30 text-rose-400 border border-rose-500/30":""}
                                        ${b.variant==="neutral"?"bg-slate-700 hover:bg-slate-600 text-slate-200":""}
                                    `,children:[b.icon,b.label]},p))})]},m.id))})},ete=On(()=>xt(()=>import("./SimulationMarket-Cq384681.js"),__vite__mapDeps([0,1])).then(t=>({default:t.SimulationMarket}))),tte=On(()=>xt(()=>import("./SimulationVault-o-SrchBY.js"),__vite__mapDeps([2,3])).then(t=>({default:t.SimulationVault}))),ste=On(()=>xt(()=>import("./SimulationSkills-CbJFzChB.js"),__vite__mapDeps([4,5])).then(t=>({default:t.SimulationSkills}))),nte=On(()=>xt(()=>import("./SimulationProduction--mYJ7evg.js"),__vite__mapDeps([6,7])).then(t=>({default:t.SimulationProduction}))),ite=On(()=>xt(()=>import("./SimulationActivity-BXuYhemu.js"),[]).then(t=>({default:t.SimulationActivity}))),rte=On(()=>xt(()=>import("./SimulationDiplomacy-sSE0T5_l.js"),[]).then(t=>({default:t.SimulationDiplomacy}))),ate=On(()=>xt(()=>import("./SimulationHierarchy-BmUxAwv6.js"),__vite__mapDeps([8,9,5,1,3])).then(t=>({default:t.SimulationHierarchy}))),ote=On(()=>xt(()=>import("./SimulationSettings-8Q56j93k.js"),[]).then(t=>({default:t.SimulationSettings}))),lte=On(()=>xt(()=>import("./PoliticalHub-s3El8DKe.js"),__vite__mapDeps([9,5,1,3])).then(t=>({default:t.PoliticalHub}))),cte=On(()=>xt(()=>import("./SimulationWarRoom-CpZP9WRi.js"),[]).then(t=>({default:t.SimulationWarRoom}))),ute=On(()=>xt(()=>import("./SiegeEngine-B_enaDvT.js"),[]).then(t=>({default:t.SiegeEngine}))),dte=On(()=>xt(()=>import("./ApothecaryWindow-DhrSt_Wa.js"),__vite__mapDeps([10,7,3])).then(t=>({default:t.ApothecaryWindow}))),hte=({player:t,room:e,pin:s,onAction:n,actionResult:i,onClearActionResult:r})=>{var p,v,x;const{activeTab:a,setActiveTab:l,isMusicWindowOpen:c,setMusicWindowOpen:u,viewingRegionId:d}=va(),[h,f]=Ne.useState(!1),m=async g=>{if(!h){f(!0);try{await ae(q(K,`simulation_rooms/${s}/activeVote/votes`),{[t.id]:g})}catch(y){console.error("Voting failed",y)}finally{setTimeout(()=>f(!1),1500)}}},b=["MAP","PRODUCTION","MARKET","INVENTORY","SKILLS","DIPLOMACY","HIERARCHY","PROFILE","POLITICS"].includes(a);return o.jsxs("div",{className:"flex-1 relative flex flex-col overflow-hidden w-full h-full",children:[o.jsxs("div",{className:`flex-1 relative w-full h-full ${b?"p-2 md:p-3 overflow-hidden flex items-center justify-center":"p-4 md:p-8 overflow-y-auto overflow-x-hidden custom-scrollbar"}`,children:[b&&o.jsx("div",{className:"absolute inset-0 z-0",children:o.jsx(TO,{player:t,room:e,world:e.world,worldEvents:e.worldEvents,players:e.players,onAction:n,onOpenMarket:()=>l("MARKET")})}),o.jsxs(Ne.Suspense,{fallback:o.jsx("div",{className:"w-full h-full flex items-center justify-center pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"})}),children:[(()=>{var w;const g=d||t.regionId||"",y=(w=e.regions[g])==null?void 0:w.activeSiege;return!y||!(a==="SIEGE"||b)?null:o.jsx("div",{className:`absolute inset-0 z-10 ${a!=="SIEGE"?"opacity-20 pointer-events-none blur-sm grayscale":""}`,children:o.jsx(ute,{player:t,siege:y,regionId:g,onAction:n,messages:Array.isArray(e.messages)?e.messages:Object.values(e.messages||{}),regions:e.regions})})})(),o.jsxs("div",{className:"absolute inset-0 z-20 pointer-events-none flex flex-col items-center justify-center",children:[a==="PRODUCTION"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-6xl md:h-auto md:max-h-[90vh] overflow-hidden",children:((p=va().productionContext)==null?void 0:p.buildingId)==="apothecary"?o.jsx(dte,{player:t,room:e,onAction:n,pin:s||""}):o.jsx(nte,{player:t,room:e,onAction:n,pin:s||""})}),a==="MARKET"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-5xl md:h-[90vh] overflow-hidden",children:o.jsx(ete,{player:t,market:((v=e.markets)==null?void 0:v[d||t.regionId||"capital"])||e.market,regions:e.regions,allMarkets:e.markets,onAction:n,pin:s||""})}),a==="INVENTORY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[80vh] overflow-hidden",children:o.jsx(tte,{player:t,onAction:n})}),a==="SKILLS"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[80vh] overflow-hidden",children:o.jsx(ste,{player:t})}),a==="DIPLOMACY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[85vh] overflow-hidden",children:o.jsx(rte,{player:t,diplomacy:e.diplomacy,pin:s||""})}),a==="HIERARCHY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-5xl md:h-[85vh] overflow-hidden",children:o.jsx(ate,{players:e.players,currentPlayer:t,regions:e.regions,onAction:n,pin:s||""})}),a==="POLITICS"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-6xl md:h-[90vh] overflow-hidden",children:o.jsx(lte,{player:t,room:e,onClose:()=>l("MAP")})}),a==="WAR_ROOM"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[85vh] overflow-hidden",children:o.jsx(cte,{player:t,regions:e.regions,onAction:n,onClose:()=>l("HIERARCHY")})})]}),a!=="MAP"&&!b&&o.jsx("div",{className:"max-w-4xl mx-auto w-full space-y-8 animate-in slide-in-from-bottom-4 duration-500 relative z-20",children:a==="SETTINGS"?o.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/40 backdrop-blur-md p-8 animate-in fade-in duration-300",children:o.jsx(ote,{onClose:()=>l("MAP")})}):a==="ACTIVITY"?o.jsx(ite,{messages:e.messages}):null})]})]}),e.activeVote&&!((x=e.activeVote.votes)!=null&&x[t.id])&&o.jsx("div",{className:"absolute bottom-6 right-6 z-[50] w-96 animate-in slide-in-from-right duration-500",children:o.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-indigo-500/50 p-6 shadow-2xl shadow-indigo-500/10",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-bold text-lg leading-tight mb-1",children:"Tinget er satt"}),o.jsx("p",{className:"text-indigo-300 text-xs font-medium uppercase tracking-wider",children:"Avgi din stemme"})]}),o.jsx("div",{className:"bg-indigo-500/20 p-2 rounded-lg",children:o.jsx("span",{className:"text-2xl",children:""})})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h4",{className:"text-white font-medium mb-2",children:e.activeVote.title}),o.jsx("p",{className:"text-slate-400 text-sm line-clamp-3 leading-relaxed",children:e.activeVote.description})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:()=>m("YES"),disabled:h,className:`bg-emerald-600/80 hover:bg-emerald-500 text-white py-3 rounded-xl font-bold text-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${h?"opacity-50 cursor-not-allowed":""}`,children:[o.jsx("span",{children:""})," VEDTA"]}),o.jsxs("button",{onClick:()=>m("NO"),disabled:h,className:`bg-rose-600/80 hover:bg-rose-500 text-white py-3 rounded-xl font-bold text-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${h?"opacity-50 cursor-not-allowed":""}`,children:[o.jsx("span",{children:""})," AVSL"]})]})]})}),o.jsx(Dt,{}),o.jsx(Dt,{children:c&&o.jsx(Wee,{onClose:()=>u(!1)})}),o.jsx(Zee,{player:t,room:e,onAction:n,pin:s||""}),o.jsx(Yee,{result:i,onClear:r})]})},fte=()=>{const[t,e]=S.useState([]);return S.useEffect(()=>Ze.subscribe(n=>{e(i=>[...i,n]),setTimeout(()=>{e(i=>i.filter(r=>r.id!==n.id))},n.duration+500)}),[]),o.jsx("div",{className:"fixed inset-0 pointer-events-none z-[200] overflow-hidden",children:o.jsx(Dt,{children:t.map(s=>{if(s.type==="FLOATING_TEXT")return o.jsx(Z.div,{initial:{opacity:0,scale:.5,y:0,rotate:(Math.random()-.5)*20},animate:{opacity:1,scale:1.2,y:-120,x:(Math.random()-.5)*40,rotate:(Math.random()-.5)*40},exit:{opacity:0,scale:.8},transition:{duration:.8,ease:"easeOut"},className:`absolute font-black text-4xl drop-shadow-2xl ${s.color||"text-amber-500"}`,style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)",zIndex:210},children:s.text},s.id);if(s.type==="FLYING_RESOURCE"){const n=ze[s.resource]||{icon:""};return o.jsx(Z.div,{initial:{left:`${s.startPoint.x}px`,top:`${s.startPoint.y}px`,scale:.5,opacity:0},animate:{left:`${s.endPoint.x}px`,top:`${s.endPoint.y}px`,scale:[.5,1.5,1],opacity:1},exit:{opacity:0,scale:.5},transition:{duration:1,ease:"easeInOut"},className:"absolute text-4xl z-[220] drop-shadow-xl",children:n.icon},s.id)}return s.type==="PARTICLE"?o.jsx(Ne.Fragment,{children:[...Array(6)].map((n,i)=>o.jsx(Z.div,{initial:{left:`${s.x}%`,top:`${s.y}%`,scale:1,opacity:1},animate:{left:`${s.x+(Math.random()-.5)*15}%`,top:`${s.y+(Math.random()-.5)*15}%`,scale:0,opacity:0},transition:{duration:.6,ease:"easeOut"},className:`absolute w-3 h-3 rounded-sm ${s.color||"bg-amber-400"} z-[205]`},`${s.id}-p-${i}`))},s.id):null})})})},mte=({level:t,title:e,onClose:s})=>o.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-500",children:[o.jsx("div",{className:"bg-gradient-to-br from-amber-400 via-amber-500 to-amber-600 p-1 rounded-[2.5rem] shadow-[0_0_50px_rgba(245,158,11,0.5)] animate-in zoom-in duration-500",children:o.jsxs("div",{className:"bg-white rounded-[2.2rem] p-10 text-center relative overflow-hidden max-w-sm",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-200"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"text-7xl mb-6 animate-bounce",children:""}),o.jsx("h2",{className:"text-sm font-black text-amber-600 uppercase tracking-[0.3em] mb-2",children:"Niv Oppndd!"}),o.jsxs("h3",{className:"text-6xl font-black text-slate-800 mb-4",children:["Niv ",t]}),o.jsx("div",{className:"h-0.5 w-16 bg-slate-200 mx-auto mb-6"}),o.jsx("p",{className:"text-slate-500 font-medium mb-1",children:"Ny Tittel:"}),o.jsx("p",{className:"text-3xl font-black text-indigo-600 mb-8",children:e}),o.jsx("button",{onClick:s,className:"w-full bg-slate-900 hover:bg-slate-800 text-white py-5 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-95",children:"FORTSETT REISEN"})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",children:[...Array(20)].map((n,i)=>o.jsx("div",{className:"absolute w-2 h-2 bg-amber-500 rounded-full animate-ping",style:{top:`${Math.random()*100}%`,left:`${Math.random()*100}%`,animationDelay:`${Math.random()*2}s`,animationDuration:`${2+Math.random()*2}s`}},i))})]})}),o.jsx("style",{dangerouslySetInnerHTML:{__html:`
                    @keyframes ping-slow {
                        0% { transform: scale(1); opacity: 0.8; }
                        100% { transform: scale(3); opacity: 0; }
                    }
                `}})]}),pte=({pin:t,account:e,onCreatePlayer:s,isCreating:n})=>{const i=vc(),[r,a]=S.useState("WELCOME"),[l,c]=S.useState((e==null?void 0:e.displayName)||""),[u,d]=S.useState("PEASANT");return r==="WELCOME"?o.jsxs("div",{className:"bg-slate-900/40 backdrop-blur-3xl border border-white/5 p-12 md:p-16 rounded-[3.5rem] text-center space-y-10 shadow-2xl animate-in fade-in zoom-in duration-500",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h1",{className:"text-6xl md:text-8xl font-black italic text-white tracking-tighter leading-none",children:"FEUDAL SIM"}),o.jsx("p",{className:"text-indigo-400 font-black uppercase tracking-[0.4em] text-xs",children:"En Levende Simulator"})]}),o.jsx("div",{className:"space-y-6",children:o.jsx("p",{className:"text-slate-400 text-lg md:text-xl font-medium max-w-md mx-auto leading-relaxed",children:"Dette er et spill om makt, ressurser og overlevelse i et feydalt samfunn."})}),o.jsxs("div",{className:"pt-4 space-y-4",children:[o.jsxs("button",{onClick:()=>a("CREATE"),className:"px-12 py-5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[2rem] font-black uppercase tracking-widest text-sm shadow-2xl shadow-indigo-600/40 transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-3 mx-auto w-64",children:["Skap din Karakter ",o.jsx(aa,{size:20})]}),o.jsx("button",{onClick:()=>i("/sim"),className:"text-slate-500 hover:text-white font-black uppercase tracking-widest text-xs transition-colors",children:"G til Lobby"})]})]}):r==="CREATE"?o.jsxs("div",{className:"bg-slate-900 border border-white/10 p-12 rounded-[3.5rem] shadow-2xl space-y-10 animate-in slide-in-from-bottom-8 duration-500",children:[o.jsxs("div",{className:"text-center space-y-2",children:[o.jsx("h2",{className:"text-4xl font-black italic text-white tracking-tighter uppercase",children:"Hvem er du?"}),o.jsxs("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-xs",children:["Opprett din karakter i ",t]})]}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx("label",{className:"text-xs font-black text-indigo-400 uppercase tracking-[0.2em] ml-2",children:"Ditt Navn i Riket"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-6 flex items-center text-slate-500 group-focus-within:text-indigo-400",children:o.jsx(wn,{size:20})}),o.jsx("input",{type:"text",value:l,onChange:h=>c(h.target.value),placeholder:"f.eks. Eirik den Rde",className:"w-full bg-slate-950 border-2 border-white/5 rounded-3xl py-5 pl-16 pr-6 text-xl font-black text-white outline-none focus:border-indigo-500/50 transition-all"})]})]}),t==="TEST"&&o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["PEASANT","SOLDIER","MERCHANT","BARON"].map(h=>o.jsx("button",{onClick:()=>d(h),className:`py-4 rounded-2xl font-black uppercase tracking-widest text-xs border-2 transition-all ${u===h?"bg-indigo-600/20 border-indigo-500 text-white":"bg-white/5 border-transparent text-slate-500"}`,children:h},h))}),o.jsxs("div",{className:"pt-4 flex gap-4",children:[o.jsx("button",{onClick:()=>{xt(()=>Promise.resolve().then(()=>So),void 0).then(h=>h.audioManager.playSfx("click")),a("WELCOME")},className:"flex-1 py-5 bg-white/5 text-slate-400 rounded-3xl font-black uppercase tracking-widest text-xs",children:"Tilbake"}),o.jsx("button",{onClick:()=>{s(l,u),a("SUCCESS")},disabled:!l.trim()||n,className:"flex-[2] py-5 bg-indigo-600 text-white rounded-3xl font-black uppercase tracking-widest text-sm",children:n?"Oppretter...":"Start Reisen"})]})]})]}):o.jsxs("div",{className:"bg-emerald-500/10 backdrop-blur-3xl border border-emerald-500/30 p-16 rounded-[4rem] text-center space-y-8 shadow-2xl animate-in zoom-in duration-500",children:[o.jsx(Vc,{size:48,className:"text-white mx-auto bg-emerald-500 rounded-[2rem] p-4 shadow-2xl"}),o.jsx("h2",{className:"text-4xl font-black italic text-white uppercase",children:"Velkommen inn!"})]})},gte=[{id:"ride_easy",label:"Engelskogen",icon:"",desc:"En rolig tur i vakkert terreng.",difficultly:"Lett",color:"from-emerald-600 to-emerald-800"},{id:"ride_medium",label:"Fjellpasset",icon:"",desc:"Hyere fart og flere klipper.",difficultly:"Medium",color:"from-amber-600 to-amber-800"},{id:"ride_hard",label:"Ulvestien",icon:"",desc:"Livsfarlig galopp gjennom tett mrke.",difficultly:"Hard",color:"from-rose-600 to-rose-800"}],Fa={skins:[{id:"brown",label:"Rust",color:"#8B4513",price:0},{id:"white",label:"Pearl",color:"#E2E8F0",price:1e3},{id:"black",label:"Void",color:"#1A202C",price:2500},{id:"golden",label:"Gold",color:"#F6E05E",price:5e3},{id:"chestnut",label:"Red",color:"#7C2D12",price:750},{id:"grey",label:"Mist",color:"#94A3B8",price:1200}],manes:[{id:"#1e1b4b",label:"Shadow",price:0},{id:"#f1f5f9",label:"Snow",price:400},{id:"#ea580c",label:"Flame",price:800},{id:"rainbow",label:"Mythic",price:1500},{id:"#FCD34D",label:"Blonde",price:600}],hats:[{id:"none",label:"Ingen",icon:"",price:0},{id:"straw_hat",label:"Strhatt",icon:"",price:500},{id:"cowboy_hat",label:"Sheriff",icon:"",price:1e3},{id:"crown",label:"Konge",icon:"",price:1500},{id:"viking",label:"Viking",icon:"",price:2e3},{id:"tophat",label:"Grev",icon:"",price:3e3}]},xte=(t,e)=>{let s=1;t==="ride_medium"&&(s=1.6),t==="ride_hard"&&(s=2.5);const n=1+(e-1)*.5;return Math.ceil(10*s*n)},bte=({skinColor:t,maneColor:e,hatId:s})=>{const n=e==="rainbow";return o.jsxs("svg",{viewBox:"0 0 200 200",className:"w-full h-full drop-shadow-2xl",children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"rainbowGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#ff0000"}),o.jsx("stop",{offset:"20%",stopColor:"#ffff00"}),o.jsx("stop",{offset:"40%",stopColor:"#00ff00"}),o.jsx("stop",{offset:"60%",stopColor:"#00ffff"}),o.jsx("stop",{offset:"80%",stopColor:"#0000ff"}),o.jsx("stop",{offset:"100%",stopColor:"#ff00ff"})]}),o.jsxs("filter",{id:"glow",children:[o.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("path",{d:"M70,160 L70,190 L85,190 L85,150 Z",fill:t,filter:"brightness(0.7)"}),o.jsx("path",{d:"M140,160 L140,190 L155,190 L155,150 Z",fill:t,filter:"brightness(0.7)"}),o.jsx("path",{d:"M50,100 Q40,60 90,60 L140,60 Q180,60 170,110 Q160,160 120,150 L80,150 Q50,150 50,100 Z",fill:t}),o.jsx("path",{d:"M60,150 L60,195 L75,195 L75,150 Z",fill:t}),o.jsx("path",{d:"M130,150 L130,195 L145,195 L145,150 Z",fill:t}),o.jsx("path",{d:"M130,65 Q130,30 160,20 L165,25 Q185,25 185,50 L175,70 Q160,85 145,65 Z",fill:t}),o.jsx("path",{d:"M185,50 L195,55 L190,65 L175,70 Z",fill:t,filter:"brightness(0.9)"}),o.jsx("path",{d:"M160,20 Q120,20 120,80 L130,90 Q140,30 165,25 Z",fill:n?"url(#rainbowGradient)":e,className:n?"animate-pulse":""}),o.jsx("path",{d:"M50,80 Q20,80 20,140",fill:"none",stroke:n?"url(#rainbowGradient)":e,strokeWidth:"8",strokeLinecap:"round"}),o.jsx("circle",{cx:"170",cy:"40",r:"2",fill:"white"}),o.jsx("circle",{cx:"170.5",cy:"39.5",r:"0.5",fill:"black"}),s==="straw_hat"&&o.jsx("text",{x:"160",y:"25",fontSize:"40",transform:"rotate(10, 160, 25)",children:""}),s==="cowboy_hat"&&o.jsx("text",{x:"155",y:"25",fontSize:"40",transform:"rotate(-5, 155, 25)",children:""}),s==="crown"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(-10, 155, 20)",children:""}),s==="viking"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(0, 155, 20)",children:""}),s==="tophat"&&o.jsx("text",{x:"152",y:"15",fontSize:"45",transform:"rotate(-10, 155, 20)",children:""})]})},vte=({player:t,onAction:e,onClose:s})=>{var g;const[n,i]=Ne.useState("ride"),[r,a]=Ne.useState("skin"),[l,c]=Ne.useState(null),u=t.minigameProgress||{},d=t.horseCustomization||{},h={skinId:d.skinId||"brown",maneColor:d.maneColor||"#1e1b4b",hatId:d.hatId||"none",unlockedSkins:d.unlockedSkins||["brown"],unlockedManeColors:d.unlockedManeColors||["#1e1b4b"],unlockedHats:d.unlockedHats||[]},f=Fa.skins.find(y=>y.id===h.skinId)||Fa.skins[0],m=Fa.manes.find(y=>y.id===h.maneColor)||Fa.manes[0],b=(y,w)=>{e({type:"MOUNT_HORSE",method:y,level:w}),s()},p=(y,w,k)=>{c({id:y,type:w,price:k})},v=()=>{l&&(e({type:"BUY_HORSE_COSMETIC",cosmeticId:l.id,cosmeticType:l.type,price:l.price}),c(null))},x=(y,w)=>{e({type:"SELECT_HORSE_COSMETIC",cosmeticId:y,cosmeticType:w})};return o.jsxs(Wn,{title:"KONGELIG STALL",subtitle:"Equestrian Center",icon:o.jsx(lc,{className:"text-amber-500",size:24}),onClose:s,children:[l&&o.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-8 animate-in fade-in duration-200",children:o.jsxs("div",{className:"bg-slate-900 border border-amber-500/30 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl space-y-6",children:[o.jsx("div",{className:"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto text-amber-500 border border-amber-500/20",children:o.jsx(Ki,{size:32})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-black text-white uppercase mb-2",children:"Bekreft Kjp"}),o.jsxs("p",{className:"text-slate-400 text-sm",children:["Er du sikker p at du vil kjpe dette for ",o.jsxs("span",{className:"text-amber-400 font-bold",children:[l.price,"g"]}),"?"]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>c(null),className:"flex-1 py-3 rounded-xl bg-slate-800 text-slate-400 font-bold text-xs uppercase hover:bg-slate-700 transition-colors",children:"Avbryt"}),o.jsx("button",{onClick:v,className:"flex-1 py-3 rounded-xl bg-amber-600 text-white font-bold text-xs uppercase hover:bg-amber-500 shadow-lg shadow-amber-900/20 transition-all",children:"Kjp"})]})]})}),o.jsxs("div",{className:"flex flex-col h-[650px] select-none text-slate-200",children:[o.jsxs("div",{className:"flex items-center gap-4 p-6 pb-2",children:[o.jsxs("div",{className:"flex bg-slate-900/50 p-1 rounded-2xl border border-white/5",children:[o.jsxs("button",{onClick:()=>i("ride"),className:`px-8 py-2.5 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center gap-2 ${n==="ride"?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx(aO,{size:14})," Turer"]}),o.jsxs("button",{onClick:()=>i("horse"),className:`px-8 py-2.5 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center gap-2 ${n==="horse"?"bg-amber-600 text-white shadow-lg shadow-amber-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx(Ki,{size:14})," Min Hest"]})]}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex items-center gap-3 px-5 py-2 bg-slate-950/50 rounded-2xl border border-amber-500/20 shadow-inner",children:[o.jsx("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest",children:"Saldo"}),o.jsxs("span",{className:"text-base font-black text-amber-400 font-mono tracking-tight",children:[(((g=t.resources)==null?void 0:g.gold)||0).toLocaleString(),o.jsx("span",{className:"text-xs ml-1 text-amber-600",children:"G"})]})]})]}),o.jsx("div",{className:"flex-1 p-6 overflow-hidden",children:n==="ride"?o.jsx("div",{className:"h-full flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500",children:o.jsx("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto pr-2 custom-scrollbar pb-4",children:gte.map(y=>{const w=u[y.id]||1;return o.jsxs("div",{className:"group relative bg-gradient-to-r from-slate-900 via-slate-900 to-slate-800/50 border border-white/5 rounded-[2rem] p-1 overflow-hidden hover:border-white/10 transition-all",children:[o.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b ${y.color}`}),o.jsxs("div",{className:"flex flex-col md:flex-row items-stretch gap-6 pl-6 p-5",children:[o.jsxs("div",{className:"flex items-center gap-5 min-w-[200px]",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl bg-slate-950 flex items-center justify-center text-4xl shadow-inner border border-white/5 group-hover:scale-105 transition-transform duration-500",children:y.icon}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-black uppercase tracking-tight text-white group-hover:text-indigo-400 transition-colors",children:y.label}),o.jsx("div",{className:"flex items-center gap-2 mt-1",children:o.jsx("span",{className:"px-2 py-0.5 bg-white/5 rounded text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:y.difficultly})})]})]}),o.jsx("div",{className:"flex-1 flex flex-wrap items-center gap-3",children:[1,2,3,4,5].map(k=>{var A;const N=k<=w,_=k<w,T=xte(y.id,k),E=(((A=t.resources)==null?void 0:A.grain)||0)>=T;return o.jsx("button",{disabled:!N||!_&&!E,onClick:()=>b(y.id,k),className:`
                                                                    relative h-12 flex-1 min-w-[60px] max-w-[80px] rounded-xl flex flex-col items-center justify-center gap-0.5 border transition-all duration-300
                                                                    ${_?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":N?E?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-500/20 hover:-translate-y-1":"bg-slate-800 border-slate-700 text-slate-500 saturate-0":"bg-transparent border-slate-800/50 text-slate-800"}
                                                                `,children:_?o.jsx(LX,{size:20}):N?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-sm font-black leading-none",children:k}),o.jsxs("span",{className:"text-[9px] font-medium opacity-80 leading-none",children:[T," "]})]}):o.jsx(Bo,{size:16})},k)})}),o.jsx("button",{onClick:()=>b(y.id,w),className:"w-14 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 flex items-center justify-center text-slate-400 hover:text-white transition-all",children:o.jsx(h1,{size:24})})]})]},y.id)})})}):o.jsxs("div",{className:"h-full grid grid-cols-12 gap-8 animate-in fade-in zoom-in-95 duration-500",children:[o.jsx("div",{className:"col-span-5 flex flex-col",children:o.jsxs("div",{className:"flex-1 relative bg-gradient-to-b from-slate-800/50 to-slate-900/90 rounded-[3rem] border border-white/10 shadow-2xl flex items-center justify-center overflow-hidden",children:[o.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/60 to-transparent"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] bg-indigo-500/10 blur-[100px] rounded-full"}),o.jsx("div",{className:"relative z-10 w-full h-full p-8 transition-all hover:scale-105 duration-700 ease-out",children:o.jsx(bte,{skinColor:f.color,maneColor:m.id,hatId:h.hatId})}),o.jsx("div",{className:"absolute bottom-6 inset-x-8 text-center",children:o.jsx("div",{className:"inline-block px-6 py-2 bg-black/40 backdrop-blur-md rounded-full border border-white/5",children:o.jsxs("span",{className:"text-xs font-black uppercase tracking-[0.3em] text-white/80",children:[f.label," Stalon"]})})})]})}),o.jsxs("div",{className:"col-span-7 flex flex-col gap-6",children:[o.jsx("div",{className:"flex p-1 bg-slate-950/50 rounded-xl border border-white/5 w-fit",children:["skin","mane","hat"].map(y=>o.jsx("button",{onClick:()=>a(y),className:`px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${r===y?"bg-amber-600 text-white shadow-lg shadow-amber-900/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5"}`,children:y==="skin"?"Pels":y==="mane"?"Manke":"Hodeplagg"},y))}),o.jsx("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar",children:o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[r==="skin"&&Fa.skins.map(y=>{const w=h.unlockedSkins.includes(y.id),k=h.skinId===y.id;return o.jsxs("button",{onClick:()=>w?x(y.id,"skin"):p(y.id,"skin",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all group
                                                        ${k?"bg-indigo-600 border-indigo-400 ring-2 ring-indigo-500/30":w?"bg-slate-800 border-white/5 hover:bg-slate-700 hover:border-white/20":"bg-slate-900/50 border-white/5 opacity-70 hover:opacity-100 hover:border-amber-500/50"}
                                                    `,children:[o.jsx("div",{className:"w-8 h-8 rounded-full border border-white/10 shadow-lg",style:{backgroundColor:y.color}}),o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${k?"text-white":"text-slate-400"}`,children:y.label}),!w&&o.jsxs("span",{className:"text-[10px] font-bold text-amber-500",children:[y.price,"g"]})]})]},y.id)}),r==="mane"&&Fa.manes.map(y=>{const w=h.unlockedManeColors.includes(y.id),k=h.maneColor===y.id;return o.jsxs("button",{onClick:()=>w?x(y.id,"mane"):p(y.id,"mane",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-3 transition-all
                                                        ${k?"bg-indigo-600 border-indigo-400":"bg-slate-800 border-white/5 hover:bg-slate-700"}
                                                    `,children:[o.jsx("div",{className:"w-12 h-4 rounded-full border border-white/10 shadow-sm",style:{background:y.id==="rainbow"?"linear-gradient(90deg, #f43f5e, #fbbf24, #10b981, #6366f1)":y.id}}),w?o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${k?"text-white":"text-slate-400"}`,children:y.label}):o.jsxs("span",{className:"text-xs font-bold text-amber-500",children:[y.price,"g"]})]},y.id)}),r==="hat"&&Fa.hats.map(y=>{const w=h.unlockedHats.includes(y.id)||y.id==="none",k=h.hatId===y.id||!1;return o.jsxs("button",{onClick:()=>w?x(y.id,"hat"):p(y.id,"hat",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all
                                                        ${k?"bg-indigo-600 border-indigo-400":"bg-slate-800 border-white/5 hover:bg-slate-700"}
                                                    `,children:[o.jsx("span",{className:"text-4xl drop-shadow-lg",children:y.icon}),!w&&o.jsxs("span",{className:"text-xs font-bold text-amber-500",children:[y.price,"g"]})]},y.id)})]})})]})]})})]})]})},yte=({player:t,room:e,onAction:s,onClose:n})=>{var b,p;const i=e.metadata||{},r=Date.now(),a=i.lastTavernRest||r,l=(r-a)/3e5;let c=i.tavernDemand||1;l>0&&(c=Math.max(1,c-l*.05));const u=v=>Math.ceil(v*c),d=t.regionId||"capital",h=((b=e.markets)==null?void 0:b[d])||e.market,f=((p=h==null?void 0:h.bread)==null?void 0:p.price)||5,m=Math.ceil(f*1.2);return o.jsx(Wn,{title:"Vertshuset: Den Glade Gris",subtitle:"Mat & Losji",icon:o.jsx(hO,{className:"text-amber-400"}),onClose:n,maxWidth:"max-w-4xl",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"p-2 bg-amber-500/20 rounded-lg text-amber-400",children:o.jsx(UX,{size:20})}),o.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-wider",children:"Mat & Drikke"})]}),o.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-5 hover:bg-white/10 transition-colors group",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-lg text-amber-100",children:"Dagens Husmannskost"}),o.jsx("p",{className:"text-xs text-amber-400/60 uppercase tracking-widest font-bold mt-1",children:"Markedspris + Servering"})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-xl font-black text-amber-400",children:[m,"g"]}),o.jsxs("div",{className:"text-[10px] text-slate-400",children:["oppr. ",f.toFixed(1),"g"]})]})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-4 leading-relaxed",children:"En varm tallerken med brd, litt kjttrester og dagens suppe. Ikke noe fancy, men det metter."}),o.jsx("div",{className:"flex items-center gap-4 text-xs font-medium text-slate-400 mb-5",children:o.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-950/50 px-2.5 py-1 rounded-md border border-white/5",children:[o.jsx("span",{className:"text-emerald-400",children:""}),o.jsx("span",{children:"+10 Stamina"})]})}),o.jsx("button",{onClick:()=>{s({type:"BUY_MEAL",locationId:"tavern_bar"})},className:"w-full py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-amber-900/20",children:o.jsx("span",{children:"Kjp Mltid"})})]}),o.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 flex gap-3 text-sm text-blue-200",children:[o.jsx(iO,{className:"shrink-0 mt-0.5",size:16}),o.jsx("p",{children:"Prisene justeres automatisk basert p rvarepriser i markedet."})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg text-indigo-400",children:o.jsx(cT,{size:20})}),o.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-wider",children:"Overnatting"}),c>1.1&&o.jsxs("span",{className:"ml-auto text-[10px] font-black bg-rose-500 text-white px-2 py-0.5 rounded-full animate-pulse",children:["HY ETTERSPRSEL (x",c.toFixed(2),")"]})]}),o.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 hover:border-indigo-500/30 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-slate-200",children:"Sovesal (Hengekye)"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(150),"g"]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"+30 Stamina"}),o.jsx("span",{children:""}),o.jsx("span",{children:"Ingen buffs"})]}),o.jsx("button",{onClick:()=>s({type:"REST_BASIC",locationId:"tavern_bar"}),className:"w-full py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold rounded-lg transition-colors",children:"Lei Kye"})]}),o.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/20 to-slate-900/40 border border-indigo-500/30 rounded-2xl p-4 hover:border-indigo-400/50 transition-colors relative overflow-hidden group",children:[o.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-5 scale-150 group-hover:scale-110 transition-transform",children:o.jsx(cT,{size:64})}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-indigo-200",children:"Komfortabelt Rom"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(500),"g"]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"+80 Stamina"}),o.jsx("span",{className:"text-rose-400 font-bold",children:"+10 HP"}),o.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 px-1.5 py-0.5 rounded border border-indigo-500/30",children:"Buff: Utvilt"})]}),o.jsx("button",{onClick:()=>s({type:"REST_COMFY",locationId:"tavern_bar"}),className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-indigo-900/20",children:"Lei Rom"})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-slate-900/40 border border-amber-500/30 rounded-2xl p-4 hover:border-amber-400/50 transition-colors relative overflow-hidden group",children:[o.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-5 scale-150 group-hover:scale-110 transition-transform",children:o.jsx(qi,{size:64})}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-amber-200",children:"Kongesuite"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(1500),"g"]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"FULL Stamina"}),o.jsx("span",{className:"text-rose-400 font-bold",children:"+50 HP"}),o.jsx("span",{className:"bg-amber-500/20 text-amber-300 px-1.5 py-0.5 rounded border border-amber-500/30",children:"Buff: Luksusliv"})]}),o.jsx("button",{onClick:()=>s({type:"REST_ROYAL",locationId:"tavern_bar"}),className:"w-full py-2 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-amber-900/20",children:"Lei Suite"})]})]})]})]})})},_te={KING:qi,BARON:a0,PEASANT:To,SOLDIER:Hm,MERCHANT:hh},wte={KING:["Sikre rikets stabilitet","Samle inn skatter fra baronene","Beskytte 'The Orb of Power'"],BARON:["Administrer din region","Krev inn skatter fra bndene","Bygg opp forsvaret mot invasjoner"],PEASANT:["Dyrk jorden og hst korn","Betal skatt for  unng fengsel","Overlev vinteren"],SOLDIER:["Beskytt riket mot farer","Tren deg opp i kamp","Adlyde ordrer fra Kongen"],MERCHANT:["Kjp og selg varer p markedet","Tjen deg rik p handel","Unng  bli plyndret"]},kte={KING:"Du er den verste lederen. Din makt er absolutt, men ditt ansvar er tungt. Riket hviler p dine skuldre.",BARON:"Du styrer et av rikets store landomrder. Du er bindeleddet mellom Kongen og folket.",PEASANT:"Du er ryggraden i samfunnet. Uten ditt harde arbeid ville riket sultet. Livet er hardt, men rlig.",SOLDIER:"Du er sverdets mester. Din plikt er  beskytte de svake og opprettholde lov og orden.",MERCHANT:"Du forstr verdien av gull. Mens andre slss eller dyrker, bygger du formuer gjennom smart handel."},Nte=({player:t,pin:e,onComplete:s})=>{var d,h;const[n,i]=S.useState(0),[r,a]=S.useState(!1),l=_te[t.role]||wn,c=wte[t.role]||["Overlev","Utforsk","Lr"];S.useEffect(()=>{if(n===0){const f=setTimeout(()=>i(1),3e3);return()=>clearTimeout(f)}},[n]);const u=async()=>{a(!0);try{const f={};f[`simulation_rooms/${e}/players/${t.id}/hasSeenIntro`]=!0,await ae(q(K),f),setTimeout(s,500)}catch(f){console.error("Failed to save intro state",f),s()}};return n===0?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950 text-white animate-in fade-in duration-1000",children:o.jsxs("div",{className:"text-center space-y-8 animate-in zoom-in duration-1000 slide-in-from-bottom-10 fill-mode-forwards",children:[o.jsxs("div",{className:"relative inline-block",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-[100px] rounded-full animate-pulse"}),o.jsx(l,{size:120,className:"relative z-10 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-[0.5em] text-sm animate-in fade-in delay-500 duration-1000",children:"Skjebnen har valgt..."}),o.jsx("h1",{className:"text-6xl md:text-8xl font-black italic tracking-tighter uppercase animate-in slide-in-from-bottom-5 delay-700 duration-500",children:((d=fd[t.role])==null?void 0:d.label)||t.role})]})]})}):o.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-slate-950/90 backdrop-blur-3xl transition-opacity duration-500 ${r?"opacity-0":"opacity-100"}`,children:o.jsxs("div",{className:"max-w-4xl w-full mx-4 grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center",children:[o.jsxs("div",{className:"text-center space-y-8 order-2 md:order-1 animate-in slide-in-from-left-10 duration-700",children:[o.jsxs("div",{className:"relative inline-block p-10 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-[3rem] border border-white/10 shadow-2xl",children:[o.jsx(l,{size:180,className:"text-white drop-shadow-2xl"}),o.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 border border-white/20 px-6 py-2 rounded-full whitespace-nowrap",children:o.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-indigo-300",children:"Din tildelte rolle"})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-4xl font-black italic tracking-tighter uppercase mb-4",children:(h=fd[t.role])==null?void 0:h.label}),o.jsx("p",{className:"text-slate-400 font-medium leading-relaxed max-w-sm mx-auto",children:kte[t.role]})]})]}),o.jsxs("div",{className:"space-y-8 order-1 md:order-2 animate-in slide-in-from-right-10 duration-700 delay-200",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.3em] text-indigo-400",children:"Dine Ml"}),o.jsx("h1",{className:"text-5xl font-black italic tracking-tighter text-white",children:"Oppdrag"})]}),o.jsx("div",{className:"space-y-4",children:c.map((f,m)=>o.jsxs("div",{className:"flex items-center gap-4 bg-white/5 border border-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors group",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 border border-emerald-500/20 group-hover:scale-110 transition-transform",children:o.jsx("span",{className:"font-black text-sm",children:m+1})}),o.jsx("span",{className:"font-bold text-slate-200",children:f})]},m))}),o.jsx("div",{className:"pt-8",children:o.jsxs("button",{onClick:u,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-6 rounded-[2rem] font-black uppercase text-lg tracking-widest shadow-2xl shadow-indigo-600/30 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-4 group",children:["Start Din Reise ",o.jsx(aa,{className:"group-hover:translate-x-2 transition-transform"})]})})]})]})})},Ste=(t,e)=>{const[s,n]=S.useState("global"),[i,r]=S.useState({}),[a,l]=S.useState({}),[c,u]=S.useState(!1),[d,h]=S.useState(0),[f,m]=S.useState(()=>{if(!(e!=null&&e.id))return{};const p=localStorage.getItem(`chat_last_read_${t}_${e.id}`);return p?JSON.parse(p):{}}),b=p=>{const v=Date.now();m(x=>{const g={...x,[p]:v};return e!=null&&e.id&&localStorage.setItem(`chat_last_read_${t}_${e.id}`,JSON.stringify(g)),g})};return S.useEffect(()=>{if(!e)return;const p={};if(p.global={id:"global",name:"Riket",type:"GLOBAL",unreadCount:0,description:"Offentlig torg"},e.role==="KING")p.region_vest={id:"region_vest",name:"Vest",type:"REGION",unreadCount:0,description:"Regional kanal for Vest"},p.region_ost={id:"region_ost",name:"st",type:"REGION",unreadCount:0,description:"Regional kanal for st"},p.capital={id:"capital",name:"Hovedstaden",type:"REGION",unreadCount:0,description:"Hovedstaden"};else if(e.regionId){const v=e.regionId==="capital"?"Hovedstaden":e.regionId==="region_vest"?"Vest":e.regionId==="region_ost"?"st":e.regionId;p[e.regionId]={id:e.regionId,name:v,type:"REGION",unreadCount:0,description:"Ditt hjemsted"}}(e.role==="BARON"||e.role==="KING")&&(p.diplomacy={id:"diplomacy",name:"Rdet",type:"DIPLOMACY",unreadCount:0,description:"Hemmelig kanal for ledere"}),r(v=>{const x={...p};return Object.keys(v).forEach(g=>{x[g]&&(x[g].unreadCount=v[g].unreadCount)}),x})},[e==null?void 0:e.regionId,e==null?void 0:e.role]),S.useEffect(()=>{if(!t||!e||Object.keys(i).length===0)return;const p=[];return Object.keys(i).forEach(v=>{const x=q(K,`simulation_rooms/${t}/channels/${v}/messages`),g=BB(x,FB(20)),y=Qe(g,w=>{const k=w.val(),N=k?Object.values(k):[];N.sort((E,A)=>E.timestamp-A.timestamp),l(E=>({...E,[v]:N}));const _=f[v]||0,T=N.filter(E=>E.timestamp>_&&E.senderId!==e.id).length;r(E=>E[v]&&E[v].unreadCount===T?E:{...E,[v]:{...E[v],unreadCount:T}})});p.push(y)}),()=>p.forEach(v=>v())},[t,e==null?void 0:e.id,Object.keys(i).join(","),f]),S.useEffect(()=>{const p=Object.values(i).reduce((v,x)=>v+(x.unreadCount||0),0);h(p)},[i]),{activeChannelId:s,setActiveChannelId:n,channels:i,messages:a[s]||[],isLoading:c&&!a[s],totalUnreadCount:d,markChannelAsRead:b}},Gh=(...t)=>t.filter(Boolean).join(" "),Tte=({pin:t,player:e,onOpenProfile:s})=>{var y;const[n,i]=S.useState(!1),{activeChannelId:r,setActiveChannelId:a,channels:l,messages:c,totalUnreadCount:u,markChannelAsRead:d,isLoading:h}=Ste(t,e),[f,m]=S.useState(""),[b,p]=S.useState(!1),v=S.useRef(null);S.useEffect(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},[c,n]),S.useEffect(()=>{n&&d(r)},[n,r,d]),S.useEffect(()=>{const w=k=>{var N;["INPUT","TEXTAREA"].includes(((N=document.activeElement)==null?void 0:N.tagName)||"")||k.key.toLowerCase()==="c"&&i(_=>!_)};return window.addEventListener("keydown",w),()=>window.removeEventListener("keydown",w)},[]);const x=async()=>{if(!f.trim()||b)return;p(!0);const w=await w7(t,e.id,f,r);w.success?m(""):alert(w.error||"Feil ved sending."),p(!1)},g=w=>{switch(w){case"GLOBAL":return o.jsx(o0,{size:14});case"REGION":return o.jsx(p1,{size:14});case"DIPLOMACY":return o.jsx(qi,{size:14,className:"text-amber-400"});case"DM":return o.jsx(Bo,{size:14});default:return o.jsx(vd,{size:14})}};return n?o.jsxs("div",{className:"fixed bottom-6 left-6 z-50 w-[380px] h-[500px] flex flex-col bg-slate-950/95 border border-slate-800/80 rounded-2xl shadow-2xl backdrop-blur-xl animate-in slide-in-from-bottom-10 fade-in duration-300",children:[o.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-800/50 bg-slate-900/50 rounded-t-2xl drag-handle cursor-grab active:cursor-grabbing",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-slate-400",children:"Comms Array"})]}),o.jsx("button",{onClick:()=>i(!1),className:"text-slate-500 hover:text-white transition-colors",children:o.jsx(CX,{size:18})})]}),o.jsx("div",{className:"flex gap-1 p-2 bg-slate-900/30 overflow-x-auto scrollbar-hide",children:Object.values(l).map(w=>o.jsxs("button",{onClick:()=>a(w.id),className:Gh("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition-all relative",r===w.id?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-slate-200"),children:[g(w.type),w.name,w.unreadCount>0&&r!==w.id&&o.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full border border-slate-900"})]},w.id))}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-gradient-to-b from-slate-950/50 to-transparent",children:[h?o.jsx("div",{className:"flex justify-center p-4",children:o.jsx("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):c.length===0?o.jsx("div",{className:"text-center text-slate-600 text-xs italic mt-10",children:"Ingen meldinger i denne kanalen enn."}):c.map(w=>{const k=w.senderId===e.id;return o.jsxs("div",{className:Gh("flex flex-col gap-1 max-w-[85%]",k?"ml-auto items-end":"mr-auto items-start"),children:[o.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 px-1",children:[o.jsx("span",{onClick:()=>s&&s(w.senderId||""),className:Gh("font-bold hover:underline cursor-pointer",k?"text-indigo-400":"text-amber-500"),children:w.senderName}),o.jsxs("span",{className:"opacity-50",children:[" ",new Date(w.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),o.jsxs("div",{className:Gh("px-3 py-2 rounded-2xl text-sm leading-relaxed shadow-sm break-words relative group",k?"bg-indigo-600 text-white rounded-tr-sm":"bg-slate-800 text-slate-200 rounded-tl-sm border border-slate-700/50"),children:[w.content,!k&&w.senderRole!=="PEASANT"&&o.jsx("div",{className:"absolute -top-2 -right-2 bg-slate-950 border border-slate-700 text-[8px] font-black uppercase px-1.5 py-0.5 rounded shadow-xl scale-0 group-hover:scale-100 transition-transform",children:w.senderRole})]})]},w.id)}),o.jsx("div",{ref:v})]}),o.jsx("div",{className:"p-3 bg-slate-900/80 border-t border-slate-800 backdrop-blur-md",children:o.jsxs("div",{className:"relative flex items-center gap-2",children:[o.jsx("input",{value:f,onChange:w=>m(w.target.value),onKeyDown:w=>w.key==="Enter"&&!w.shiftKey&&x(),placeholder:`Melding til #${((y=l[r])==null?void 0:y.name)||"kanal"}...`,className:"flex-1 bg-slate-950 border border-slate-700 rounded-xl px-4 py-2.5 text-sm text-white placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all shadow-inner",disabled:b}),o.jsx("button",{onClick:x,disabled:!f.trim()||b,className:"bg-indigo-600 hover:bg-indigo-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-indigo-500/20 active:scale-95",children:b?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx(cO,{size:16})}),e.role!=="KING"&&r==="global"&&o.jsx("div",{className:"absolute -top-6 right-2 text-[10px] text-amber-500 font-mono bg-amber-950/30 px-2 py-0.5 rounded border border-amber-900/50",children:"Kostnad: 2 Gull"})]})})]}):o.jsx("button",{onClick:()=>i(!0),className:"fixed bottom-6 left-6 z-50 bg-slate-900/90 border border-slate-700/50 text-white p-3 rounded-full shadow-2xl hover:bg-indigo-600 hover:scale-105 transition-all group backdrop-blur-md",children:o.jsxs("div",{className:"relative",children:[o.jsx(vd,{size:24,className:"group-hover:text-white text-slate-200"}),u>0&&o.jsx("div",{className:"absolute -top-2 -right-2 min-w-[20px] h-5 bg-red-500 rounded-full flex items-center justify-center text-[10px] font-black border-2 border-slate-900 px-1 animate-in zoom-in duration-300",children:u>9?"9+":u})]})})},ST=["gold","grain","wood","iron_ore","stone","plank","iron_ingot","bread","swords","armor","cloth","wool"],Ete=({isOpen:t,onClose:e,myPlayer:s,targetPlayer:n,pin:i})=>{const[r,a]=S.useState({gold:0}),[l,c]=S.useState({gold:0}),[u,d]=S.useState(!1),[h,f]=S.useState(null);if(!t)return null;Ne.useEffect(()=>{const x=g=>{g.key==="Escape"&&e()};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[e]);const m=async()=>{d(!0),f(null);try{const x=await Qee(i,s.id,n.id,r,l);x.success?(f("Handelstilbud sendt!"),setTimeout(e,1500)):(f("Feil: "+x.error),d(!1))}catch(x){console.error(x),f("En ukjent feil oppstod."),d(!1)}},b=(x,g)=>{a(y=>({...y,[x]:Math.max(0,g)}))},p=(x,g)=>{c(y=>({...y,[x]:Math.max(0,g)}))},v=({label:x,values:g,onChange:y,max:w})=>o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 tracking-wider mb-2",children:x}),o.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar",children:[ST.map(k=>{var T;const N=g[k]||0,_=w?w(k):9999;return w&&_<=0&&N<=0?null:o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50",children:[o.jsx("span",{className:"text-lg w-8 text-center",children:ic[k.toUpperCase()]||""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-xs text-slate-300 font-medium capitalize truncate",children:((T=ze[k])==null?void 0:T.label)||k.replace("_"," ")}),w&&o.jsxs("div",{className:"text-[10px] text-slate-500",children:["Du har: ",_]})]}),o.jsx("input",{type:"number",value:N||"",placeholder:"0",onChange:E=>y(k,parseInt(E.target.value)||0),className:"w-20 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-right text-sm font-mono focus:outline-none focus:border-indigo-500"})]},k)}),!w&&o.jsx("div",{className:"text-xs text-slate-500 text-center italic mt-2",children:"Velg hva du krever"})]})]});return o.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-4xl bg-slate-900 border border-indigo-500/30 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"p-6 bg-slate-900 border-b border-indigo-500/20 flex justify-between items-center relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-black italic text-white flex items-center gap-3",children:[o.jsx(f1,{className:"text-indigo-400"}),"HANDELSKONTRAKT"]}),o.jsxs("p",{className:"text-slate-400 text-sm",children:["Opprett et tilbud til ",o.jsx("span",{className:"text-white font-bold",children:n.name})]})]}),o.jsx("button",{onClick:e,className:"relative z-10 p-2 hover:bg-slate-800 rounded-full transition-colors cursor-pointer",children:o.jsx(In,{className:"text-slate-400"})})]}),o.jsxs("div",{className:"flex-1 overflow-hidden grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-800 bg-slate-950/50",children:[o.jsx("div",{className:"p-6 overflow-hidden flex flex-col",children:o.jsx(v,{label:"Ditt Tilbud (Assets)",values:r,onChange:b,max:x=>s.resources[x]||0})}),o.jsx("div",{className:"p-6 overflow-hidden flex flex-col",children:o.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar",children:[o.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 tracking-wider mb-2",children:"Ditt Krav (Liabilities)"}),ST.map(x=>{var g;return o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50 hover:border-indigo-500/30 transition-colors",children:[o.jsx("span",{className:"text-lg w-8 text-center opacity-70",children:ic[x.toUpperCase()]||""}),o.jsx("span",{className:"flex-1 text-xs text-slate-300 font-medium capitalize truncate",children:((g=ze[x])==null?void 0:g.label)||x.replace("_"," ")}),o.jsx("input",{type:"number",value:l[x]||"",placeholder:"0",onChange:y=>p(x,parseInt(y.target.value)||0),className:"w-20 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-right text-sm font-mono focus:outline-none focus:border-indigo-500"})]},x)})]})})]}),o.jsxs("div",{className:"p-6 bg-slate-900 border-t border-indigo-500/20 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-yellow-500/80 text-xs",children:[o.jsx(Db,{size:14}),o.jsx("span",{children:"Ressursene trekkes umiddelbart (Escrow)."})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[h&&o.jsx("span",{className:`text-sm font-bold ${h.startsWith("Feil")?"text-red-400":"text-green-400"}`,children:h}),o.jsx("button",{onClick:m,disabled:u||h!==null,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-500/20",children:u?"Signerer...":o.jsxs(o.Fragment,{children:[o.jsx(cO,{size:18}),"Send Kontrakt"]})})]})]})]})})},Ate=["gold","grain","wood","iron_ore","bread"],jte=({isOpen:t,onClose:e,myPlayer:s,targetPlayer:n,pin:i})=>{const[r,a]=S.useState("INFO"),[l,c]=S.useState(!1);Ne.useEffect(()=>{const x=g=>{g.key==="Escape"&&e()};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[e]);const[u,d]=S.useState("gold"),[h,f]=S.useState(0),[m,b]=S.useState(null),p=x=>{switch(x){case"KING":return o.jsx(qi,{size:32,className:"text-yellow-400"});case"BARON":return o.jsx(a0,{size:32,className:"text-purple-400"});case"SOLDIER":return o.jsx(Hm,{size:32,className:"text-red-400"});case"MERCHANT":return o.jsx(hh,{size:32,className:"text-emerald-400"});default:return o.jsx(wn,{size:32,className:"text-slate-400"})}},v=async()=>{if(h<=0)return;b("Sender...");const x={};x[u]=h;const g=await Xee(i,s.id,n.id,x);g.success?(b(`Sendte ${h} ${u}!`),setTimeout(()=>{b(null),a("INFO")},1500)):b("Feil: "+g.error)};return t?l?o.jsx(Ete,{isOpen:!0,onClose:()=>c(!1),myPlayer:s,targetPlayer:n,pin:i}):o.jsx("div",{className:"fixed inset-0 z-[50] flex items-center justify-center p-4 bg-slate-950/60 backdrop-blur-sm animate-in fade-in duration-200",children:o.jsxs("div",{className:"w-full max-w-md bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl overflow-hidden flex flex-col relative",children:[o.jsx("div",{className:`h-32 w-full relative bg-gradient-to-br ${n.role==="KING"?"from-yellow-900/40 to-slate-900":"from-indigo-900/40 to-slate-900"}`,children:o.jsx("div",{className:"absolute top-4 right-4",children:o.jsx("button",{onClick:e,className:"p-2 bg-black/20 hover:bg-black/40 rounded-full transition-colors backdrop-blur-sm text-white",children:o.jsx(In,{size:20})})})}),o.jsxs("div",{className:"px-8 relative -mt-16 mb-4 flex flex-col items-center",children:[o.jsxs("div",{className:"w-32 h-32 rounded-full border-4 border-slate-900 bg-slate-800 flex items-center justify-center shadow-xl relative group overflow-hidden",children:[n.avatar?o.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full object-cover"}):p(n.role),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),o.jsx("h2",{className:"text-2xl font-black text-white mt-4",children:n.name}),o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm font-medium uppercase tracking-wider",children:[o.jsx("span",{className:"text-indigo-400",children:n.role}),o.jsx("span",{children:""}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(p1,{size:12})," ",n.regionId||"Ukjent"]})]})]}),o.jsxs("div",{className:"flex-1 px-8 pb-8 space-y-6",children:[r==="INFO"&&o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mb-1",children:"Level"}),o.jsx("div",{className:"text-3xl font-black text-white",children:n.stats.level})]}),o.jsxs("div",{className:"bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mb-1",children:"Reputasjon"}),o.jsx("div",{className:"text-3xl font-black text-indigo-400",children:n.stats.reputation})]})]}),r==="GIFT"&&o.jsxs("div",{className:"bg-slate-950/50 p-6 rounded-2xl border border-slate-800 space-y-4 animate-in slide-in-from-bottom-4 duration-300",children:[o.jsx("h3",{className:"text-center text-slate-300 font-bold",children:"Send en gave"}),o.jsx("div",{className:"flex gap-2 justify-center",children:Ate.map(x=>o.jsx("button",{onClick:()=>d(x),className:`p-2 rounded-lg border transition-all ${u===x?"bg-indigo-600 border-indigo-500":"bg-slate-900 border-slate-700 hover:border-slate-500"}`,children:o.jsx("span",{className:"text-xl",children:ic[x.toUpperCase()]||""})},x))}),o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 border border-slate-700 rounded-xl px-4 py-2",children:[o.jsx("input",{type:"number",className:"bg-transparent w-full text-center text-xl font-bold focus:outline-none",value:h,onChange:x=>f(parseInt(x.target.value)||0),placeholder:"0"}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:u})]}),o.jsx("button",{onClick:v,disabled:!!m,className:"w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/20 disabled:opacity-50",children:m||"Send Gave"})]}),o.jsx("div",{className:"flex gap-2",children:r==="INFO"?o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:()=>a("GIFT"),className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95",children:[o.jsx(nO,{size:18}),o.jsx("span",{children:"Gave"})]}),o.jsxs("button",{onClick:()=>c(!0),className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95 shadow-lg shadow-indigo-500/20",children:[o.jsx(f1,{size:18}),o.jsx("span",{children:"Handel"})]})]}):o.jsx("button",{onClick:()=>a("INFO"),className:"w-full py-3 text-slate-400 hover:text-white font-bold",children:"Avbryt"})}),n.role==="SOLDIER"&&s.role==="SOLDIER"&&o.jsxs("button",{className:"w-full py-2 border border-red-500/30 text-red-400 hover:bg-red-500/10 rounded-xl font-bold uppercase tracking-widest text-xs flex items-center justify-center gap-2",children:[o.jsx(Hm,{size:14}),"Utfordre til Duell (Kommer snart)"]})]})]})}):null},bf=[{id:"first_steps",name:"Frste Skritt",description:"Du har overlevd din frste dag i villmarken. Verden ligger for dine ftter.",requirementText:"Overlev 1 dag.",icon:"Footprints",rarity:"COMMON",xp:100,category:"LIFE",triggerType:"PASSIVE",condition:{type:"STAT",target:"level",value:2,comparison:"GTE"}},{id:"full_belly",name:"Mett Mage",description:"En kriger marsjerer p magen. Du har spist godt.",requirementText:"Spis 5 mltider p rad uten  bli sulten.",icon:"Utensils",rarity:"COMMON",xp:50,category:"LIFE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"EAT_MEAL",value:5}},{id:"lumberjack",name:"Tmmerhogger",description:"Skogen gir, og du har tatt. Ditt frste skritt mot sivilisasjon.",requirementText:"Hogg 100 enheter ved.",icon:"Axe",rarity:"COMMON",xp:150,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"wood",value:100,comparison:"GTE"}},{id:"miner",name:"Fjellets Snn",description:"Dypt i fjellet fant du rikdom. Jernets tid er kommet.",requirementText:"Utvinn 50 Jernmalm.",icon:"Pickaxe",rarity:"COMMON",xp:150,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"iron",value:50,comparison:"GTE"}},{id:"survivor_week",name:"Ukenemnda",description:"Syv dager med motgang har herdet deg.",requirementText:"Overlev 7 dager i ett liv.",icon:"Calendar",rarity:"RARE",xp:500,category:"LIFE",triggerType:"PASSIVE",condition:{type:"STAT",target:"daysAlive",value:7,comparison:"GTE"}},{id:"master_craftsman",name:"Mesterhndverker",description:"Dine hender skaper vidundere. Du har ndd toppen av ditt fag.",requirementText:"N niv 10 i en ferdighet.",icon:"Hammer",rarity:"RARE",xp:400,category:"LIFE",triggerType:"PASSIVE",condition:{type:"STAT",target:"maxSkillLevel",value:10,comparison:"GTE"}},{id:"first_gold",name:"Smpenger",description:"Din frste gullmynt. Starten p en formue.",requirementText:"Samle 100 Gull.",icon:"Coins",rarity:"COMMON",xp:100,category:"ROLE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"gold",value:100,comparison:"GTE"}},{id:"merchant_trade",name:"Kremmernd",description:"En god handel er bedre enn en vunnet krig.",requirementText:"Gjennomfr 10 handler p markedet.",icon:"Scale",rarity:"COMMON",xp:200,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"TRADE",value:10}},{id:"wealth_builder",name:"Lokalt Velstand",description:"Du har samlet nok gull til  kjpe en liten landsby.",requirementText:"Ha 5,000 Gull i banken.",icon:"Wallet",rarity:"RARE",xp:600,category:"ROLE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"gold",value:5e3,comparison:"GTE"}},{id:"baron_rising",name:"Baron",description:"Du er ikke lenger en av folket. Du er deres leder.",requirementText:"Bli utnevnt til Baron.",icon:"Shield",rarity:"RARE",xp:1e3,category:"ROLE",triggerType:"PASSIVE",condition:{type:"ROLE",target:"role",value:"BARON",comparison:"EQ"}},{id:"tax_collector",name:"Skattemester",description:"Kongens kasse m fylles, og du gjorde jobben.",requirementText:"Krev inn skatt 5 ganger.",icon:"Scroll",rarity:"RARE",xp:500,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"COLLECT_TAX",value:5}},{id:"duke_treasury",name:"Hertugens Skatt",description:"En formue som fr selv konger til  sjalue.",requirementText:"Samle 50,000 Gull.",icon:"Gem",rarity:"EPIC",xp:2500,category:"ROLE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"gold",value:5e4,comparison:"GTE"}},{id:"midas_touch",name:"Midas Touch",description:"Alt du tar i blir til gull. Din rikdom er legendarisk.",requirementText:"Samle 100,000 Gull.",icon:"Sparkles",rarity:"LEGENDARY",xp:5e3,category:"ROLE",isSecret:!0,triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"gold",value:1e5,comparison:"GTE"}},{id:"king_slayer",name:"Konge",description:"Kronet og salvet. Hele riket byer seg for deg.",requirementText:"Bli Konge.",icon:"Crown",rarity:"EPIC",xp:4e3,category:"ROLE",triggerType:"PASSIVE",condition:{type:"ROLE",target:"role",value:"KING",comparison:"EQ"}},{id:"tyrant",name:"Jernhnd",description:"Din vilje er lov. Ingen tr  opponere.",requirementText:"Ha 100% Autoritet som Konge.",icon:"Gavel",rarity:"EPIC",xp:3e3,category:"ROLE",isSecret:!0,triggerType:"PASSIVE",condition:{type:"STAT",target:"authority",value:100,comparison:"GTE"}},{id:"soul_awakening",name:"Sjelens Gnist",description:"Du begynner  huske hvem du var fr.",requirementText:"N Sjelsniv 2.",icon:"Zap",rarity:"COMMON",xp:200,category:"SOUL",triggerType:"PASSIVE",condition:{type:"ACCOUNT_STAT",target:"globalLevel",value:2,comparison:"GTE"}},{id:"soul_master",name:"Opplyst",description:"Din sjel brenner lysere enn stjernene.",requirementText:"N Sjelsniv 10.",icon:"Sun",rarity:"EPIC",xp:2e3,category:"SOUL",triggerType:"PASSIVE",condition:{type:"ACCOUNT_STAT",target:"globalLevel",value:10,comparison:"GTE"}},{id:"ancestor",name:"Forfader",description:"Ditt navn vil ikke bli glemt.",requirementText:"D og bli lagret i Hall of Fame for frste gang.",icon:"Ghost",rarity:"COMMON",xp:300,category:"SOUL",triggerType:"EVENT",condition:{type:"MANUAL",target:"DEATH_FIRST",value:1}},{id:"eternal_dynasty",name:"Evig Dynasti",description:"En lang linje av helter str bak deg.",requirementText:"Ha 10 forfedre i historikken.",icon:"Users",rarity:"LEGENDARY",xp:5e3,category:"SOUL",triggerType:"PASSIVE",condition:{type:"ACCOUNT_STAT",target:"historyLength",value:10,comparison:"GTE"}},{id:"world_traveler",name:"Vandreren",description:"Verden er stor, og du har sett alt.",requirementText:"Besk 5 forskjellige regioner.",icon:"Map",rarity:"RARE",xp:800,category:"SOUL",triggerType:"PASSIVE",condition:{type:"STAT",target:"regionsVisited",value:5,comparison:"GTE"}},{id:"secret_death",name:"Sort Uflaks",description:"Dde p en... spektakulr mte.",requirementText:"D av ???",icon:"Skull",rarity:"RARE",xp:666,category:"SOUL",isSecret:!0,triggerType:"EVENT",condition:{type:"MANUAL",target:"DEATH_WEIRD",value:1}},{id:"legendary_blacksmith",name:"Gudesmed",description:"Dette vpenet hrer hjemme i legendene.",requirementText:"Smi en LEGENDARY gjenstand.",icon:"Flame",rarity:"LEGENDARY",xp:4e3,category:"ROLE",triggerType:"EVENT",condition:{type:"MANUAL",target:"CRAFT_LEGENDARY",value:1}},{id:"diplomat",name:"Fredsmegler",description:"Ord kan avverge kriger.",requirementText:"Signer en fredsavtale.",icon:"Feather",rarity:"RARE",xp:750,category:"ROLE",triggerType:"EVENT",condition:{type:"MANUAL",target:"PEACE_TREATY",value:1}},{id:"hoard_wood_1",name:"Vedhogger",description:"Du har samlet en respektabel stabel med ved.",requirementText:"Samle 100 Ved.",icon:"Axe",rarity:"COMMON",xp:100,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"wood",value:100,comparison:"GTE"}},{id:"hoard_wood_2",name:"Tmmerbaron",description:"Skogen frykter deg.",requirementText:"Samle 1,000 Ved.",icon:"Trees",rarity:"RARE",xp:500,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"wood",value:1e3,comparison:"GTE"}},{id:"hoard_stone_1",name:"Steinbruddsarbeider",description:"Grunnlaget for ethvert slott.",requirementText:"Samle 100 Stein.",icon:"Mountain",rarity:"COMMON",xp:100,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"stone",value:100,comparison:"GTE"}},{id:"hoard_iron_1",name:"Malmleter",description:"Det glimter i mrket.",requirementText:"Samle 50 Jernmalm.",icon:"Pickaxe",rarity:"COMMON",xp:150,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"iron_ore",value:50,comparison:"GTE"}},{id:"hoard_fish_1",name:"Fisker",description:"Havets skatter.",requirementText:"Fang 50 Fisk.",icon:"Fish",rarity:"COMMON",xp:100,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"fish_raw",value:50,comparison:"GTE"}},{id:"bread_winner",name:"Brdvinner",description:"Mel og vann, livets gave.",requirementText:"Ha 50 Brd i lageret.",icon:"Croissant",rarity:"COMMON",xp:100,category:"LIFE",triggerType:"PASSIVE",condition:{type:"RESOURCE",target:"bread",value:50,comparison:"GTE"}},{id:"master_baker",name:"Mesterbaker",description:"Duften av nystekt brd flger deg.",requirementText:"Bak 50 ganger.",icon:"ChefHat",rarity:"RARE",xp:400,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"BAKE",value:50}},{id:"forge_master",name:"Smed",description:"Hammeren treffer ambolten med rytmisk presisjon.",requirementText:"Smelt jern 50 ganger.",icon:"Hammer",rarity:"RARE",xp:400,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"SMELT",value:50}},{id:"weaver_specialist",name:"Vever",description:"Trder flettes til kunst.",requirementText:"Vev ty 20 ganger.",icon:"Scissors",rarity:"COMMON",xp:200,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"WEAVE",value:20}},{id:"alchemist_novice",name:"Lrling Alkemist",description:"Ikke drikk det der...",requirementText:"Brygg 10 eliksirer.",icon:"FlaskConical",rarity:"RARE",xp:300,category:"ROLE",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"MIX",value:10}},{id:"gamble_first_win",name:"Nybegynnerflaks",description:"Den frste gevinsten smaker best.",requirementText:"Vinn i terningspill eller p hjulet.",icon:"Clover",rarity:"COMMON",xp:100,category:"SOUL",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"GAMBLE_WIN",value:1}},{id:"gamble_high_roller",name:"High Roller",description:"Huset taper alltid... til slutt?",requirementText:"Vinn 25 ganger p gambling.",icon:"Dice5",rarity:"EPIC",xp:1e3,category:"SOUL",triggerType:"EVENT",condition:{type:"ACTION_COUNT",target:"GAMBLE_WIN",value:25}},{id:"gamble_jackpot",name:"JACKPOT!",description:"Gudene smiler til deg. En legendarisk gevinst!",requirementText:"Vinn 5x eller mer p Soga-hjulet.",icon:"Sparkles",rarity:"LEGENDARY",xp:5e3,category:"SOUL",triggerType:"EVENT",condition:{type:"MANUAL",target:"GAMBLE_JACKPOT",value:1}}],Cte=t=>bf.find(e=>e.id===t),EO={Footprints:o.jsx(nQ,{size:28}),Utensils:o.jsx(hO,{size:28}),Axe:o.jsx(wX,{size:28}),Pickaxe:o.jsx(UQ,{size:28}),Calendar:o.jsx(sO,{size:28}),Hammer:o.jsx(To,{size:28}),Coins:o.jsx(hh,{size:28}),Scale:o.jsx(x1,{size:28}),Wallet:o.jsx(AJ,{size:28}),Shield:o.jsx(a0,{size:28}),Scroll:o.jsx(lO,{size:28}),Gem:o.jsx(oQ,{size:28}),Sparkles:o.jsx(Ki,{size:28}),Crown:o.jsx(qi,{size:28}),Gavel:o.jsx(rQ,{size:28}),Zap:o.jsx(cc,{size:28}),Sun:o.jsx(dO,{size:28}),Ghost:o.jsx(cQ,{size:28}),Users:o.jsx(o0,{size:28}),Map:o.jsx(g1,{size:28}),Skull:o.jsx(uO,{size:28}),Flame:o.jsx(tQ,{size:28}),Feather:o.jsx(QX,{size:28})},Rte=({achievement:t,unlocked:e,onClick:s})=>{const i={COMMON:{border:"border-slate-600/50",bg:"bg-gradient-to-br from-slate-800/40 to-slate-900/60",glow:"shadow-slate-500/10",text:"text-slate-300",iconBg:"bg-slate-700/30"},RARE:{border:"border-cyan-500/40",bg:"bg-gradient-to-br from-cyan-900/40 to-slate-900/80",glow:"shadow-cyan-500/20",text:"text-cyan-400",iconBg:"bg-cyan-500/20"},EPIC:{border:"border-fuchsia-500/40",bg:"bg-gradient-to-br from-fuchsia-900/40 to-slate-900/80",glow:"shadow-fuchsia-500/20",text:"text-fuchsia-400",iconBg:"bg-fuchsia-500/20"},LEGENDARY:{border:"border-amber-500/50",bg:"bg-gradient-to-br from-amber-900/40 to-slate-900/80",glow:"shadow-amber-500/30",text:"text-amber-400",iconBg:"bg-amber-500/20"}}[t.rarity],r=t.isSecret&&!e;let l=EO[t.icon]||o.jsx(cc,{size:32}),c=i.text;e||(r&&(l=o.jsx(Bo,{size:28})),c="text-slate-800");const u=r?"Hemmelig Bragd":t.name,d=e?t.description:r?"???":`${t.requirementText}`,h=e?`border ${i.border} ${i.bg} ${i.glow} hover:scale-[1.02] hover:shadow-2xl hover:border-opacity-100`:"border border-slate-800 bg-slate-950 hover:bg-slate-900 hover:border-slate-700";return o.jsxs("div",{onClick:s,role:"button",className:`
                group relative flex flex-col items-center justify-between p-6 rounded-[1.5rem] min-h-[240px] text-center
                transition-all duration-300 overflow-hidden select-none
                ${h}
            `,children:[e&&o.jsx("div",{className:`absolute inset-0 opacity-20 bg-gradient-to-tr ${i.text.replace("text-","from-")}/10 to-transparent pointer-events-none`}),o.jsxs("div",{className:`
                relative w-20 h-20 rounded-3xl flex items-center justify-center mb-5 text-4xl
                transition-transform duration-500 group-hover:scale-110
                ${e?i.iconBg+" "+c:"bg-slate-900/50 border border-slate-800/50 "+c}
            `,children:[l,e&&t.rarity==="LEGENDARY"&&o.jsx("div",{className:"absolute inset-0 animate-pulse bg-amber-400/20 blur-2xl rounded-full"})]}),o.jsxs("div",{className:"flex-1 flex flex-col items-center justify-start w-full gap-3",children:[o.jsx("h5",{className:`font-black uppercase tracking-wider text-xl leading-tight ${e?"text-white":"text-slate-300"}`,children:u}),o.jsx("div",{className:"flex-1 flex items-center justify-center",children:o.jsx("p",{className:`text-sm font-medium leading-relaxed ${e?"text-slate-300":"text-slate-500"}`,children:d})}),!r&&o.jsxs("div",{className:"mt-auto px-3 py-1 rounded-full border border-slate-800 bg-black/20 text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-slate-300 group-hover:border-slate-600 transition-colors",children:[t.xp," XP"]})]}),e&&o.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 ${i.text.replace("text-","bg-")} opacity-50`})]})},Ite=({inGameMode:t=!1})=>{const{account:e}=Lo(),[s,n]=S.useState("ALL"),i=S.useMemo(()=>{const h=(e==null?void 0:e.unlockedAchievements)||{};return Array.isArray(h)?new Set(h):new Set(Object.keys(h))},[e]),r=h=>i.has(h),a=S.useMemo(()=>s==="ALL"?bf:bf.filter(h=>h.category===s),[s]),l=bf.length,c=i.size,u=Math.round(c/l*100),d=[{id:"ALL",label:"Alle Bragder",icon:""},{id:"LIFE",label:"Nuet",icon:""},{id:"SOUL",label:"Sjelen",icon:""},{id:"ROLE",label:"Rollene",icon:""}];return o.jsxs("div",{className:`w-full ${t?"max-w-6xl mx-auto":""} space-y-8 animate-in fade-in duration-700`,children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 italic uppercase tracking-tighter",children:"Mine Bragder"}),o.jsx("p",{className:"text-sm text-slate-400 font-medium max-w-lg",children:"En samling av dine strste triumfer gjennom alle dine liv. Hver bragd styrker sjelen din for evigheten."})]}),o.jsxs("div",{className:"flex items-center gap-4 bg-slate-900/50 backdrop-blur-md p-2 rounded-2xl border border-white/5",children:[o.jsxs("div",{className:"px-4 py-2 bg-indigo-500/10 rounded-xl border border-indigo-500/20 shadow-lg shadow-indigo-500/5 flex flex-col items-center min-w-[100px]",children:[o.jsx("span",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-wider",children:"Antall"}),o.jsxs("span",{className:"text-xl font-black text-white",children:[c," ",o.jsxs("span",{className:"text-slate-500 text-sm",children:["/ ",l]})]})]}),o.jsxs("div",{className:"px-4 py-2 bg-amber-500/10 rounded-xl border border-amber-500/20 shadow-lg shadow-amber-500/5 flex flex-col items-center min-w-[100px]",children:[o.jsx("span",{className:"text-[10px] font-black uppercase text-amber-400 tracking-wider",children:"Fullfrt"}),o.jsxs("span",{className:"text-xl font-black text-white",children:[u,"%"]})]})]})]}),o.jsx("div",{className:"flex overflow-x-auto pb-2 gap-2 custom-scrollbar",children:d.map(h=>o.jsxs("button",{onClick:()=>n(h.id),className:`
                            px-6 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] whitespace-nowrap transition-all
                            flex items-center gap-2 border
                            ${s===h.id?"bg-white text-slate-900 border-white shadow-lg shadow-white/10 scale-105":"bg-white/5 text-slate-400 border-white/5 hover:bg-white/10 hover:text-white"}
                        `,children:[o.jsx("span",{className:"text-base",children:h.icon}),h.label]},h.id))}),o.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8",children:a.map(h=>o.jsx(Rte,{achievement:h,unlocked:r(h.id)},h.id))}),a.length===0&&o.jsx("div",{className:"py-20 text-center opacity-30",children:o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"Ingen bragder funnet i denne kategorien"})})]})},Ote=({onClose:t,currentRoomPin:e})=>{const{account:s,logout:n,isAnonymous:i}=Lo(),{profileTab:r}=va(),[a,l]=S.useState(r||"overview");Ne.useEffect(()=>{r&&l(r)},[r]);const c=S.useMemo(()=>s!=null&&s.activeSessions?(Array.isArray(s.activeSessions)?s.activeSessions:Object.values(s.activeSessions)).sort((w,k)=>k.lastPlayed-w.lastPlayed):[],[s]),u=S.useMemo(()=>c.reduce((y,w)=>y+(w.xp||0),0),[c]),d=(s==null?void 0:s.globalXp)||0,h=d+u,f=(s==null?void 0:s.globalLevel)||1,m=Math.pow(f,2)*100,b=Math.pow(f-1,2)*100,p=Math.min(100,Math.max(0,(h-b)/(m-b)*100)),v=()=>{var y;return o.jsxs("div",{className:"space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start text-center md:text-left gap-10",children:[o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500 blur-3xl opacity-20 group-hover:opacity-40 transition-opacity rounded-full"}),o.jsx("div",{className:"w-40 h-40 bg-slate-900 border border-white/10 rounded-full flex items-center justify-center relative overflow-hidden shadow-2xl",children:o.jsx(wn,{size:80,className:"text-slate-200"})}),o.jsx("div",{className:"absolute bottom-0 right-0 bg-indigo-500 text-white text-xs font-black px-3 py-1 rounded-full border-4 border-[#0A0A15] uppercase tracking-wider",children:"Operator"})]}),o.jsxs("div",{className:"flex-1 space-y-8 pt-4 max-w-5xl",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-sm font-bold text-indigo-400 uppercase tracking-[0.4em] mb-2",children:"Global Profil"}),o.jsx("h2",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 uppercase tracking-tighter",children:(s==null?void 0:s.displayName)||"Ukjent Identitet"})]}),o.jsxs("div",{className:"flex flex-wrap gap-6 justify-center md:justify-start",children:[o.jsxs("div",{className:"px-8 py-5 bg-white/5 border border-white/10 rounded-3xl flex items-center gap-6 relative overflow-hidden group/lvl min-w-[200px]",children:[o.jsx("div",{className:"p-3 bg-indigo-500/20 rounded-2xl text-indigo-400",children:o.jsx(lT,{size:24})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-[0.2em] font-black mb-1",children:"Sjelsniv"}),o.jsx("p",{className:"text-4xl font-black text-white italic",children:f})]}),o.jsx("div",{className:"absolute bottom-0 left-0 h-1.5 bg-indigo-600/30 w-full",children:o.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.5)]",style:{width:`${p}%`}})})]}),o.jsxs("div",{className:"px-8 py-5 bg-white/5 border border-white/10 rounded-3xl flex items-center gap-6 min-w-[200px]",children:[o.jsx("div",{className:"p-3 bg-amber-500/20 rounded-2xl text-amber-400",children:o.jsx(hJ,{size:24})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-[0.2em] font-black mb-1",children:"Total Erfaring"}),o.jsxs("p",{className:"text-3xl font-black text-white italic flex items-baseline gap-2",children:[d,u>0&&o.jsxs("span",{className:"text-indigo-400 text-sm opacity-60 font-bold",title:"Hstbar XP",children:["(+",u,")"]})]})]})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-8 border-t border-white/5",children:[o.jsxs("div",{className:"p-6 bg-slate-900/50 rounded-2xl border border-white/5 text-center",children:[o.jsx("p",{className:"text-3xl font-black text-white",children:c.length}),o.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mt-1",children:"Aktive Spill"})]}),o.jsxs("div",{className:"p-6 bg-slate-900/50 rounded-2xl border border-white/5 text-center",children:[o.jsx("p",{className:"text-3xl font-black text-white",children:((y=s==null?void 0:s.characterHistory)==null?void 0:y.length)||0}),o.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mt-1",children:"Falne Helter"})]})]})]})},x=()=>o.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("h3",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:o.jsx(wn,{size:20})}),"Mine Karakterer"]}),o.jsxs("span",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest",children:[c.length," Aktive"]})]}),c.length===0?o.jsxs("div",{className:"p-16 border border-white/5 border-dashed rounded-[2rem] text-center text-slate-500",children:[o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"Ingen aktive karakterer"}),o.jsx("p",{className:"text-base mt-2 opacity-60",children:"G til lobbyen for  starte din reise."})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:c.map((y,w)=>{const k=e&&y.roomPin===e,N=y.role==="KING",_=y.role==="BARON",T=N?"text-amber-500 bg-amber-500/10 border-amber-500/20":_?"text-purple-400 bg-purple-500/10 border-purple-500/20":"text-slate-400 bg-slate-500/10 border-slate-500/20";return o.jsxs("div",{className:`group relative overflow-hidden rounded-[2rem] border transition-all duration-300
                                ${k?"bg-indigo-900/20 border-indigo-500/50 shadow-lg shadow-indigo-500/10":"bg-[#0F0F1A] border-white/5 hover:border-white/10 hover:bg-[#131320]"}
                            `,children:[o.jsx("div",{className:`absolute top-0 right-0 p-6 opacity-0 group-hover:opacity-10 transition-all transform scale-150 rotate-12 duration-500 ${N?"text-amber-500 opactiy-5":"text-white"}`,children:N?o.jsx(qi,{size:140}):o.jsx(wn,{size:140})}),o.jsxs("div",{className:"relative z-10 p-6 flex flex-col h-full",children:[o.jsxs("div",{className:"flex items-start justify-between mb-6",children:[o.jsxs("div",{children:[o.jsxs("div",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-lg border text-[10px] font-black uppercase tracking-widest mb-3 ${T}`,children:[N&&o.jsx(qi,{size:10}),y.role]}),o.jsx("h4",{className:"text-2xl font-black text-white leading-none tracking-tight truncate max-w-[200px]",title:y.name,children:y.name})]}),o.jsx("div",{className:"w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-slate-400 border border-white/5",children:N?o.jsx(qi,{size:14,className:"text-amber-500"}):o.jsx(wn,{size:14})})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-6",children:[o.jsxs("div",{className:"bg-slate-950/50 rounded-xl p-3 border border-white/5",children:[o.jsxs("div",{className:"text-[11px] uppercase tracking-wider text-slate-400 font-bold mb-1 flex items-center gap-1.5",children:[o.jsx(lc,{size:12})," Level"]}),o.jsx("div",{className:"text-lg font-black text-cyan-400",children:y.level?`Lvl ${y.level}`:o.jsx("span",{className:"text-slate-600",children:"-"})})]}),o.jsxs("div",{className:"bg-slate-950/50 rounded-xl p-3 border border-white/5",children:[o.jsxs("div",{className:"text-[11px] uppercase tracking-wider text-slate-400 font-bold mb-1 flex items-center gap-1.5",children:[o.jsx(hh,{size:12})," Gull"]}),o.jsx("div",{className:"text-lg font-black text-amber-400",children:y.gold!==void 0?`${Math.floor(Number(y.gold))}`:o.jsx("span",{className:"text-slate-600",children:"-"})})]}),o.jsxs("div",{className:"bg-slate-950/50 rounded-xl p-3 border border-white/5 col-span-2",children:[o.jsxs("div",{className:"text-[11px] uppercase tracking-wider text-slate-400 font-bold mb-1 flex items-center gap-1.5",children:[o.jsx(p1,{size:12})," Region"]}),o.jsx("div",{className:"text-sm font-bold text-slate-200 truncate",children:y.regionName||y.regionId||"Ukjent"})]}),o.jsxs("div",{className:"bg-slate-950/50 rounded-xl p-3 border border-white/5 col-span-2 flex items-center justify-between",children:[o.jsxs("div",{className:"text-[11px] uppercase tracking-wider text-slate-400 font-bold flex items-center gap-1.5",children:[o.jsx(QQ,{size:12})," Server"]}),o.jsx("div",{className:"text-xs font-bold text-slate-300",children:y.roomName||y.roomPin})]})]}),o.jsx("button",{onClick:()=>{if(k){t==null||t();return}confirm(`Vil du fortlate nvrende spill for  bytte til ${y.name}?`)&&(window.location.href=`/play/${y.roomPin}`)},className:`mt-auto w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] flex items-center justify-center gap-2 border transition-all
                                            ${k?"bg-emerald-500/10 border-emerald-500/50 text-emerald-400 hover:bg-emerald-500/20":"bg-indigo-600 text-white border-indigo-500 hover:bg-indigo-500 hover:border-indigo-400 shadow-lg shadow-indigo-600/20"}`,children:k?o.jsxs(o.Fragment,{children:[o.jsx(Vc,{size:14})," Du spiller denne"]}):o.jsxs(o.Fragment,{children:[o.jsx(yd,{size:14})," Spill N"]})})]})]},w)})})]}),g=()=>o.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("h3",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-slate-400",children:o.jsx(m1,{size:20})}),"Hall of Fame"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:!(s!=null&&s.characterHistory)||s.characterHistory.length===0?o.jsx("div",{className:"col-span-full py-20 text-center opacity-30 border-2 border-dashed border-white/10 rounded-[2rem]",children:o.jsx("p",{className:"text-sm font-bold uppercase tracking-widest",children:"Ingen falne helter i historiebkene"})}):s.characterHistory.slice().reverse().map((y,w)=>o.jsxs("div",{className:"flex items-center justify-between p-6 bg-slate-900/60 rounded-2xl border border-white/5 hover:border-white/10 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-5",children:[o.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center text-2xl grayscale group-hover:grayscale-0 transition-all shadow-inner",children:y.role==="KING"?"":y.role==="BARON"?"":""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-black text-white uppercase tracking-wide group-hover:text-indigo-400 transition-colors",children:y.name}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 uppercase font-bold mt-0.5",children:[o.jsx("span",{className:"bg-white/5 px-1.5 py-0.5 rounded text-slate-400",children:y.role}),o.jsx("span",{children:""}),o.jsxs("span",{className:"text-indigo-400",children:["Lvl ",y.level]})]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-[10px] font-mono text-slate-600 block",children:new Date(y.timestamp).toLocaleDateString()}),o.jsx("p",{className:"text-[10px] font-black text-indigo-900 group-hover:text-indigo-500 transition-colors uppercase pt-1",children:y.roomPin})]})]},w))})]});return o.jsxs("div",{className:"relative z-10 flex flex-col h-full bg-[#0A0A15]",children:[o.jsx("div",{className:"sticky top-0 z-50 bg-[#0A0A15]/95 backdrop-blur-xl border-b border-white/5 shadow-2xl transition-all pt-8 pb-4",children:o.jsx("div",{className:"w-full px-6 md:px-16 lg:px-24",children:o.jsxs("div",{className:"flex flex-wrap md:flex-nowrap items-center justify-center md:justify-start gap-3 md:gap-4 overflow-x-auto no-scrollbar pb-1",children:[o.jsxs("button",{onClick:()=>l("overview"),className:`px-4 py-2 md:px-8 md:py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border whitespace-nowrap ${a==="overview"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(rO,{size:14}),o.jsx("span",{children:"Oversikt"})]}),o.jsxs("button",{onClick:()=>l("vessels"),className:`px-4 py-2 md:px-8 md:py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border whitespace-nowrap ${a==="vessels"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(yd,{size:14}),o.jsx("span",{children:"Karakterer"})]}),o.jsxs("button",{onClick:()=>l("achievements"),className:`px-4 py-2 md:px-8 md:py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border whitespace-nowrap ${a==="achievements"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(lT,{size:14}),o.jsx("span",{children:"Bragder"})]}),o.jsxs("button",{onClick:()=>l("history"),className:`px-4 py-2 md:px-8 md:py-3 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border whitespace-nowrap ${a==="history"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(zQ,{size:14}),o.jsx("span",{children:"Historikk"})]})]})})}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-16 pt-8",children:o.jsxs("div",{className:"w-full px-6 md:px-16 lg:px-24",children:[a==="overview"&&v(),a==="vessels"&&x(),a==="achievements"&&o.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:o.jsx(Ite,{inGameMode:!0})}),a==="history"&&g()]})}),o.jsx("div",{className:"mt-auto py-8 border-t border-white/5 bg-[#0A0A15]/50 backdrop-blur-md",children:o.jsx("div",{className:"w-full px-6 md:px-16 lg:px-24 flex justify-end",children:i?o.jsxs("button",{className:"px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase text-xs tracking-widest shadow-lg flex items-center gap-2",children:[o.jsx(b1,{size:14})," Sikre Profil"]}):o.jsxs("button",{onClick:async()=>{await n(),t==null||t(),window.location.href="/"},className:"px-6 py-3 bg-white/5 text-rose-400 hover:bg-rose-500/10 rounded-xl font-bold uppercase text-xs tracking-widest border border-white/5 flex items-center gap-2",children:[o.jsx(SQ,{size:14})," Logg Ut"]})})})]})},Mte=({isOpen:t,onClose:e,currentRoomPin:s})=>(S.useEffect(()=>{if(t){const n=window.getComputedStyle(document.body).overflow;document.body.style.overflow="hidden";const i=r=>{r.key==="Escape"&&e()};return window.addEventListener("keydown",i),()=>{document.body.style.overflow=n,window.removeEventListener("keydown",i)}}},[t,e]),t?qb.createPortal(o.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-[#0A0A15]/60 backdrop-blur-xl animate-in fade-in duration-300",children:o.jsxs("div",{className:"w-full h-[100dvh] md:w-[80vw] md:max-w-[1400px] md:h-[80vh] bg-[#0A0A15] md:border border-white/10 md:rounded-[3rem] shadow-2xl overflow-hidden relative flex flex-col animate-in slide-in-from-bottom-4 md:zoom-in-95 duration-500 ease-out",children:[o.jsx("div",{className:"absolute top-6 right-6 md:top-8 md:right-8 z-50",children:o.jsx("button",{onClick:e,"aria-label":"Lukk profil",className:"p-3 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white rounded-full transition-all backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50 active:scale-95",children:o.jsx(In,{size:24})})}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar flex flex-col",children:o.jsx(Ote,{onClose:e,currentRoomPin:s})})]})}),document.body):null),TT=[{id:"CHASSIS",label:"Vogn",icon:""},{id:"WHEELS",label:"Hjul",icon:""},{id:"COVER",label:"Kalesje",icon:""},{id:"LANTERNS",label:"Lykter",icon:""},{id:"SKIN",label:"Trekkdyr",icon:""},{id:"FLAG",label:"Flagg",icon:""},{id:"COMPANION",label:"Passasjer",icon:""},{id:"TRAIL",label:"Spor",icon:""},{id:"DECOR",label:"Dekor",icon:""}],Dte=({player:t,onBuy:e,onEquip:s})=>{var u,d,h;const[n,i]=S.useState(()=>sessionStorage.getItem("caravan_shop_cat")||"CHASSIS");Ne.useEffect(()=>{sessionStorage.setItem("caravan_shop_cat",n)},[n]);const r=((d=(u=t.caravan)==null?void 0:u.customization)==null?void 0:d.unlocked)||[],a=((h=t.caravan)==null?void 0:h.customization)||{},l=S.useMemo(()=>Object.values(v1).filter(f=>f.category===n),[n]),c=f=>{var m;(t.resources.gold||0)<f.cost||f.reqLevel&&(((m=t.caravan)==null?void 0:m.level)||1)<f.reqLevel||e(f.id)};return o.jsxs("div",{className:"flex h-full p-6 pt-0 gap-8 relative",children:[o.jsx("div",{className:"w-56 flex flex-col relative z-10 h-full border-r border-white/5 pr-6",children:o.jsx("div",{className:"flex-1 flex flex-col gap-2 overflow-y-auto no-scrollbar mask-scroll pb-2",children:TT.map(f=>o.jsxs("button",{onClick:()=>i(f.id),className:`relative group shrink-0 h-14 flex items-center px-4 gap-4 rounded-xl transition-all duration-200 ${n===f.id?"bg-gradient-to-r from-amber-400 to-amber-500 text-black shadow-lg shadow-amber-500/20 z-10 scale-[1.02]":"bg-transparent text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx("span",{className:`text-2xl filter transition-all ${n===f.id?"scale-110 drop-shadow-sm":"grayscale opacity-70 group-hover:grayscale-0 group-hover:opacity-100"}`,children:f.icon}),o.jsx("span",{className:`text-xs uppercase font-black tracking-widest leading-none ${n===f.id?"opacity-100":"opacity-70"}`,children:f.label}),n===f.id&&o.jsx("div",{className:"absolute inset-0 rounded-xl border border-white/20 pointer-events-none"})]},f.id))})}),o.jsx("div",{className:"flex-1 pt-0 pb-6 overflow-y-auto no-scrollbar mask-scroll-content",children:o.jsx(Dt,{mode:"popLayout",children:o.jsx(Z.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.15},className:"flex flex-col gap-2.5",children:l.map(f=>{var w,k,N;const m=r.includes(f.id),b=Object.values(a).includes(f.id),p=(t.resources.gold||0)>=f.cost,v=(((w=t.caravan)==null?void 0:w.level)||1)>=(f.reqLevel||0),x=f.id==="skin_horse_linked",g=(k=t.horseCustomization)==null?void 0:k.skinId;let y="";return m||(v?p||(y="Mangler Gull"):y=`Lvl ${f.reqLevel}`),x&&!g&&(y="Ingen Hest"),o.jsx(Z.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`relative p-[1px] rounded-xl transition-all group overflow-hidden ${b?"bg-gradient-to-r from-amber-400 to-amber-600 shadow-md shadow-amber-500/10":"bg-slate-800"}`,children:o.jsxs("div",{className:"bg-[#0B0F19] rounded-[11px] h-16 pr-4 flex items-center gap-5 relative z-10 pl-3",children:[o.jsx("div",{className:`w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center text-xl bg-slate-900 border border-white/5 ${b?"shadow-[0_0_10px_rgba(251,191,36,0.1)]":""}`,children:(N=TT.find(_=>_.id===n))==null?void 0:N.icon}),o.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[o.jsx("h4",{className:`font-black uppercase text-sm truncate leading-none mb-1.5 ${b?"text-white":"text-slate-300"}`,children:f.name.replace("Vogn: ","")}),o.jsxs("div",{className:"flex items-center gap-2",children:[f.reqLevel&&!m&&o.jsxs("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest ",children:["Lvl ",f.reqLevel]}),!m&&o.jsxs("span",{className:"text-xs text-amber-500 font-bold bg-amber-500/10 px-2 py-0.5 rounded border border-amber-500/20",children:[f.cost,"g"]}),m&&!b&&o.jsx("span",{className:"text-xs text-emerald-500 font-bold uppercase tracking-widest",children:"Eies"})]})]}),o.jsx("div",{className:"flex-shrink-0 w-28",children:m?o.jsx("button",{onClick:()=>s(f.id),disabled:b||x&&!g,className:`w-full py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${b?"bg-amber-500/10 text-amber-500 border border-amber-500/20 cursor-default shadow-[0_0_10px_rgba(245,158,11,0.1)]":x&&!g?"bg-slate-800 text-red-500 cursor-not-allowed":"bg-white text-black hover:bg-amber-400 hover:scale-[1.02]"}`,children:b?"VALGT":x&&!g?"MANGLER HEST":"VELG"}):o.jsx("button",{onClick:()=>c(f),disabled:!!y,className:`w-full py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${y?"bg-slate-800 text-slate-500 cursor-not-allowed":"bg-amber-400 text-black hover:bg-amber-300 hover:scale-[1.02] shadow-lg shadow-amber-900/10"}`,children:y||"KJP"})})]})},f.id)})},n)})}),o.jsx("style",{children:`
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
                .no-scrollbar {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
                .mask-scroll {
                     mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
                    -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
                }
                .mask-scroll-content {
                    mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
                    -webkit-mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
                }
            `})]})},Lte=({player:t,onAction:e,onClose:s,preselectedTarget:n})=>{var p;const[i,r]=S.useState(()=>sessionStorage.getItem("caravan_tab")||(n?"TRAVEL":"CARGO"));Ne.useEffect(()=>{sessionStorage.setItem("caravan_tab",i)},[i]);const a=Ne.useMemo(()=>{const v=t.caravan||{};return{level:v.level||1,inventory:v.inventory||{},durability:v.durability??100,upgrades:v.upgrades||[],customization:v.customization}},[t.caravan]),l=re.CARAVAN.LEVELS.find(v=>v.level===a.level)||re.CARAVAN.LEVELS[0],c=Object.values(a.inventory).reduce((v,x)=>v+(x||0),0),u=l.capacity,d=v=>{e({type:"LOAD_CARAVAN",resource:v,amount:1})},h=v=>{e({type:"UNLOAD_CARAVAN",resource:v,amount:1})},f=(v,x)=>{e({type:"UPGRADE_CARAVAN",upgradeType:v,upgradeId:x})},m=v=>{e({type:"TRAVEL_START",targetRegionId:v}),s()},b=()=>{e({type:"REPAIR_CARAVAN"})};return o.jsx(Z.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:o.jsxs("div",{className:"relative w-full max-w-7xl h-[750px] bg-[#0B0F19] rounded-[2rem] overflow-hidden flex shadow-2xl border border-white/5",children:[o.jsxs("div",{className:"w-[38%] relative flex flex-col pointer-events-none",children:[o.jsxs("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900 to-[#05080f]",children:[o.jsx("div",{className:"absolute top-[-20%] left-[-20%] w-[140%] h-[80%] bg-blue-500/10 blur-[100px] rounded-full"}),o.jsx("div",{className:"absolute bottom-[0%] right-[0%] w-[80%] h-[60%] bg-amber-500/5 blur-[80px] rounded-full"})]}),o.jsxs("div",{className:"relative z-10 px-8 pt-8 space-y-6",children:[o.jsx("div",{className:"flex justify-between items-start",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-black text-white italic tracking-tighter uppercase drop-shadow-lg",children:"Karavane"}),o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.jsxs("span",{className:"px-2 py-0.5 bg-amber-400/10 border border-amber-400/20 text-amber-400 text-xs font-black uppercase rounded",children:["Niv ",a.level]}),o.jsx("span",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest",children:l.name})]})]})}),o.jsxs("div",{className:"space-y-3 bg-black/20 p-4 rounded-xl border border-white/5 backdrop-blur-sm pointer-events-auto",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Lastkapasitet"}),o.jsxs("span",{className:c>=u?"text-rose-400":"text-white",children:[c," / ",u]})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden",children:o.jsx(Z.div,{initial:{width:0},animate:{width:`${c/u*100}%`},className:"h-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.5)]"})})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Tilstand"}),o.jsxs("span",{className:a.durability<l.durability*.3?"text-rose-500":"text-emerald-400",children:[Math.round(a.durability)," / ",l.durability]})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden",children:o.jsx(Z.div,{initial:{width:0},animate:{width:`${a.durability/l.durability*100}%`},className:`h-full shadow-[0_0_10px_rgba(16,185,129,0.5)] ${a.durability<l.durability*.3?"bg-rose-500":"bg-emerald-500"}`})})]}),a.durability<l.durability&&o.jsxs("button",{onClick:b,className:"w-full mt-2 py-2 bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 rounded-lg text-xs font-black uppercase transition-all flex items-center justify-center gap-2 group",children:[o.jsx("span",{children:" Reparer"}),o.jsxs("span",{className:"opacity-50 group-hover:opacity-100",children:["(",Math.round((l.durability-(a.durability||0))*2),"g)"]})]})]})]}),o.jsxs("div",{className:"flex-1 flex items-center justify-center relative translate-y-[-20px] pointer-events-auto",children:[o.jsx(wO,{level:a.level,upgrades:a.upgrades,customization:(p=t.caravan)==null?void 0:p.customization,horseCustomization:t.horseCustomization,className:"w-full max-w-[340px] drop-shadow-[0_50px_60px_rgba(0,0,0,0.6)] z-10"}),o.jsx("div",{className:"absolute bottom-[20%] w-[60%] h-[20px] bg-black/40 blur-xl rounded-[100%]"})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col bg-[#111624] border-l border-white/5 relative z-20",children:[o.jsxs("div",{className:"h-20 flex items-center justify-between px-8 border-b border-white/5",children:[o.jsx("div",{className:"flex gap-1 bg-slate-900/50 p-1 rounded-xl border border-white/5",children:["CARGO","UPGRADES","STYLE","TRAVEL"].map(v=>o.jsx("button",{onClick:()=>r(v),className:`px-5 py-2 text-xs font-black uppercase tracking-widest rounded-lg transition-all ${i===v?"bg-amber-400 text-black shadow-lg shadow-amber-400/20":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:v==="CARGO"?"Last":v==="UPGRADES"?"Oppgraderinger":v==="STYLE"?"Style":"Reise"},v))}),o.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/5 hover:bg-rose-500/20 hover:text-rose-400 flex items-center justify-center text-slate-400 transition-colors",children:""})]}),o.jsx("div",{className:"flex-1 overflow-hidden relative",children:o.jsx("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-8",children:o.jsxs(Dt,{mode:"wait",children:[i==="CARGO"&&o.jsx(Z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"space-y-6",children:o.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx("span",{children:"Ditt Lager"}),o.jsx("div",{className:"h-px bg-slate-800 flex-1"})]}),o.jsx("div",{className:"space-y-2",children:Object.entries(t.resources).map(([v,x])=>{if(v==="gold"||x<=0)return null;const g=ze[v];return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/40 rounded-xl border border-white/5 hover:border-amber-400/30 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-lg shadow-inner",children:ic[v.toUpperCase()]||""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-white uppercase group-hover:text-amber-400 transition-colors",children:(g==null?void 0:g.label)||v}),o.jsxs("div",{className:"text-xs text-slate-500 font-bold",children:["Antall: ",x]})]})]}),o.jsx("button",{onClick:()=>d(v),className:"px-3 py-1.5 bg-slate-800 text-white hover:bg-amber-400 hover:text-black text-xs font-black uppercase rounded-lg transition-all",children:""})]},v)})})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx("span",{children:"Karavane-Lass"}),o.jsx("div",{className:"h-px bg-slate-800 flex-1"})]}),o.jsxs("div",{className:"space-y-2",children:[Object.entries(a.inventory).map(([v,x])=>{if(x<=0)return null;const g=ze[v];return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-400/5 rounded-xl border border-amber-400/20 hover:bg-amber-400/10 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-400/10 flex items-center justify-center text-lg border border-amber-400/20",children:ic[v.toUpperCase()]||""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-amber-200 uppercase",children:(g==null?void 0:g.label)||v}),o.jsxs("div",{className:"text-xs text-amber-400/60 font-bold",children:["Lastet: ",x]})]})]}),o.jsx("button",{onClick:()=>h(v),className:"px-3 py-1.5 bg-slate-900 text-slate-300 hover:text-white border border-slate-700 hover:border-slate-500 text-xs font-black uppercase rounded-lg transition-all",children:"Loss"})]},v)}),Object.values(a.inventory).every(v=>!v||v<=0)&&o.jsx("div",{className:"h-24 flex items-center justify-center border-2 border-dashed border-slate-800 rounded-xl",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl opacity-20 mb-1",children:""}),o.jsx("div",{className:"text-slate-600 text-xs font-bold uppercase",children:"Tomt Lasterom"})]})})]})]})]})},"cargo"),i==="UPGRADES"&&o.jsxs(Z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-8",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:"Neste Niv"}),(()=>{const v=re.CARAVAN.LEVELS.find(x=>x.level===a.level+1);return v?o.jsxs("div",{className:"p-6 bg-gradient-to-br from-indigo-900/20 to-slate-900/50 rounded-2xl border border-indigo-500/30 flex justify-between items-center group hover:border-indigo-400/50 transition-colors",children:[o.jsxs("div",{className:"flex gap-4 items-center",children:[o.jsx("div",{className:"w-12 h-12 bg-indigo-500/20 rounded-xl flex items-center justify-center text-2xl border border-indigo-500/30",children:""}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-white font-black uppercase italic text-lg group-hover:text-indigo-300 transition-colors",children:v.name}),o.jsxs("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-widest",children:["Kapasitet: ",o.jsx("span",{className:"text-indigo-400",children:v.capacity}),"  Fart: ",o.jsxs("span",{className:"text-indigo-400",children:[v.speed,"x"]})]})]})]}),o.jsxs("button",{onClick:()=>f("LEVEL"),className:"px-6 py-3 bg-white text-slate-950 font-black uppercase italic rounded-xl hover:bg-indigo-400 hover:scale-105 transition-all shadow-lg shadow-indigo-900/20",children:["Kjp ",v.cost,"g"]})]}):o.jsx("p",{className:"text-xs text-emerald-400 font-bold uppercase italic bg-emerald-500/10 p-4 rounded-xl border border-emerald-500/20",children:"Maks niv ndd!"})})()]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:"Spesialmoduler"}),o.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(re.CARAVAN.UPGRADES).map(([v,x])=>{const g=(a.upgrades||[]).includes(x.id);return o.jsxs("div",{className:`p-5 rounded-2xl border transition-all ${g?"bg-emerald-900/10 border-emerald-500/20":"bg-slate-900/40 border-white/5 hover:border-white/10"}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm ${g?"bg-emerald-500/20 text-emerald-400":"bg-slate-800 text-slate-400"}`,children:""}),o.jsx("h4",{className:`font-black text-xs uppercase ${g?"text-emerald-400":"text-white"}`,children:x.name})]}),g&&o.jsx("span",{className:"text-xs font-black text-emerald-950 bg-emerald-400 px-2 py-0.5 rounded uppercase",children:"Eies"})]}),o.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase leading-relaxed mb-4 h-8",children:x.benefit}),!g&&o.jsxs("button",{onClick:()=>f("MODULE",v.toLowerCase()),className:"w-full py-2 bg-slate-800 text-white text-xs font-black uppercase rounded-lg hover:bg-slate-700 border border-slate-700 transition-colors",children:["Kjp for ",x.cost,"g"]})]},v)})})]})]},"upgrades"),i==="STYLE"&&o.jsx(Z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"h-full -m-8",children:o.jsx(Dte,{player:t,onBuy:v=>e({type:"BUY_CARAVAN_COSMETIC",cosmeticId:v}),onEquip:v=>e({type:"EQUIP_CARAVAN_COSMETIC",cosmeticId:v})})},"style"),i==="TRAVEL"&&o.jsxs(Z.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[o.jsx("div",{className:"bg-amber-400/10 p-4 border border-amber-400/20 rounded-xl",children:o.jsxs("p",{className:"text-xs text-amber-200 font-bold uppercase flex items-center gap-2",children:[o.jsx("span",{children:""})," Reisen krever 20 Stamina og 1 Brd-niste."]})}),o.jsx("div",{className:"grid grid-cols-1 gap-4",children:["region_ost","region_vest","capital"].map(v=>{if(v===t.regionId)return null;const x=v==="capital"?"Hovedstaden":v==="region_vest"?"Vestfjella":"stlandet",g=v===n;return o.jsxs("button",{onClick:()=>m(v),className:`group p-6 rounded-2xl border transition-all text-left flex justify-between items-center ${g?"bg-indigo-600/20 border-indigo-400 shadow-[0_0_30px_rgba(99,102,241,0.2)]":"bg-slate-900/40 border-white/5 hover:border-amber-400/50 hover:bg-amber-400/5"}`,children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("h4",{className:`font-black uppercase italic text-xl transition-colors ${g?"text-indigo-300":"text-white group-hover:text-amber-400"}`,children:x}),g&&o.jsx("span",{className:"bg-indigo-500 text-white text-xs font-black px-2 py-0.5 rounded uppercase animate-pulse",children:"Destinasjon"})]}),o.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest mt-1 group-hover:text-slate-400",children:"Klikk for  starte reisen"})]}),o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform ${g?"bg-indigo-500 text-white":"bg-slate-800 text-slate-500 group-hover:bg-amber-400 group-hover:text-black"}`,children:""})]},v)})})]},"travel")]})})})]})]})})},AO=Ne.memo(({pos:t})=>{const[i,r]=S.useState(0);S.useEffect(()=>{let l;const c=()=>{r(u=>u+.15),l=requestAnimationFrame(c)};return l=requestAnimationFrame(c),()=>cancelAnimationFrame(l)},[]);const a=S.useMemo(()=>Array.from({length:15},(l,c)=>({id:c,seedX:c*777%4e3,seedY:c*999%4e3,scale:.6+c%5*.4,parallaxFactor:1,driftSpeedX:.15+c%3*.1,driftSpeedY:.05+c%2*.05,opacity:.25+c%3*.15,blur:10+c%3*10,hue:200+c%5*2})),[]);return o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-[200]",style:{contain:"strict"},children:[o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[6000px] h-[6000px] opacity-[0.03] mix-blend-overlay z-[-1]",style:{backgroundColor:"hsl(210, 65%, 12%)",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1000' height='1000'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='1000' height='1000' filter='url(%23noise)'/%3E%3C/svg%3E")`,transform:`translate3d(${-t.x*.4}px, ${-t.y*.4}px, 0)`,willChange:"transform"}}),o.jsx("div",{className:"absolute inset-0",style:{perspective:"1000px"},children:a.map(l=>{let c=(l.seedX+i*l.driftSpeedX-t.x*l.parallaxFactor)%4e3,u=(l.seedY+i*l.driftSpeedY-t.y*l.parallaxFactor)%4e3;return c<-2e3&&(c+=4e3),c>2e3&&(c-=4e3),u<-2e3&&(u+=4e3),u>2e3&&(u-=4e3),o.jsx("div",{className:"absolute left-1/2 top-1/2 rounded-full mix-blend-screen",style:{width:250*l.scale,height:150*l.scale,background:`radial-gradient(circle at 30% 40%, hsla(${l.hue}, 20%, 100%, ${l.opacity}) 0%, hsla(${l.hue}, 10%, 90%, ${l.opacity*.6}) 40%, transparent 80%)`,boxShadow:`
                                    ${20*l.scale}px ${10*l.scale}px ${30*l.scale}px hsla(${l.hue}, 10%, 95%, ${l.opacity*.8}),
                                    ${-30*l.scale}px ${20*l.scale}px ${40*l.scale}px hsla(${l.hue}, 10%, 90%, ${l.opacity*.5})
                                `,filter:`blur(${l.blur}px)`,transform:`translate3d(${c}px, ${u}px, 0)`,willChange:"transform"}},l.id)})}),o.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[1200px] h-[1200px] rounded-full pointer-events-none opacity-20 mix-blend-soft-light",style:{background:"radial-gradient(circle, hsla(200, 100%, 50%, 0.2) 0%, transparent 70%)"}})]})});AO.displayName="SeaBackground";const wr=5e3,Hh=[{id:1,x:1200,y:800,r:180,color:"#064e3b",name:"Furuy"},{id:2,x:3500,y:1200,r:250,color:"#14532d",name:"Jungel-atollen"},{id:3,x:800,y:3800,r:120,color:"#451a03",name:"Smuglerbukta"},{id:4,x:4200,y:4e3,r:200,color:"#0f172a",name:"Jernfestningen"},{id:5,x:2500,y:2500,r:150,color:"#1e3a8a",name:"Hovedposten"}],Pte=({player:t,roomPin:e,onExit:s,onActionResult:n})=>{var Le,ft,se,le,Pe,_e,Q,ie;const{setActiveMinigame:i}=va(),[r,a]=S.useState({x:1e3,y:1e3}),[l,c]=S.useState(0),[u,d]=S.useState(!1),[h,f]=S.useState({}),[m,b]=S.useState([]),[p,v]=S.useState(((Le=t.boat)==null?void 0:Le.hp)||100),[x]=S.useState(((ft=t.boat)==null?void 0:ft.maxHp)||100),[g,y]=S.useState(((se=t.boat)==null?void 0:se.cannonballs)||0),[w,k]=S.useState(!1),[N,_]=S.useState(0),[T,E]=S.useState([]),[A,R]=S.useState([]),[I,V]=S.useState(0),[H,P]=S.useState(null),[O,L]=S.useState([]),M=S.useRef(0),F=S.useRef(0),U=S.useRef({x:0,y:0}),C=S.useRef({x:1e3,y:1e3,rotation:0,angularVelocity:0,speed:0,targetSpeed:0,targetRotation:0,velocityVector:{x:0,y:0},projectiles:[],explosions:[],net:null}),j=S.useRef(0),$=S.useRef(Date.now()),B=S.useRef(Date.now()),D=S.useRef({left:!1,right:!1,up:!1,down:!1,action:!1});S.useEffect(()=>{const G=q(K,`simulation_rooms/${e}/sea_state`),oe=Qe(G,jt=>{const He=jt.val();if(He){const{[t.id]:Ia,...dn}=He;f(dn)}else f({})}),W=q(K,`simulation_rooms/${e}/world/sea_resources`),ce=Qe(W,jt=>{const He=jt.val();b(He?Object.values(He):[])}),Se=q(K,`simulation_rooms/${e}/sea_state/${t.id}/hp`),St=Qe(Se,jt=>{const He=jt.val();He!=null&&(v(He),He<=0&&k(!0))}),Bt=q(K,`simulation_rooms/${e}/sea_state/${t.id}`);return Qe(Bt,jt=>{const He=jt.val();He&&He.x&&He.y&&C.current.x===1e3&&C.current.y===1e3&&(C.current.x=He.x,C.current.y=He.y,C.current.rotation=He.rotation||0,a({x:He.x,y:He.y}),c(He.rotation||0))},{onlyOnce:!0}),()=>{oe(),ce(),St()}},[e,t.id]),S.useEffect(()=>{var G;y(((G=t.boat)==null?void 0:G.cannonballs)||0)},[(le=t.boat)==null?void 0:le.cannonballs]),S.useEffect(()=>(i("SAILING"),()=>i(null)),[]),S.useEffect(()=>{const G=()=>{const oe=q(K,`simulation_rooms/${e}/sea_state/${t.id}`);ae(oe,{isOffline:!0,timestamp:Date.now()})};return window.addEventListener("beforeunload",G),()=>window.removeEventListener("beforeunload",G)},[e,t.id]),S.useEffect(()=>{ae(q(K,`simulation_rooms/${e}/sea_state/${t.id}`),{hp:p,maxHp:x,isOffline:!1})},[]);const z=G=>{const oe={CANNON:"sounds/sfx/cannon_fire.mp3",EXPLOSION:"sounds/sfx/explosion.mp3",SPLASH:"sounds/sfx/splash.mp3"},W=new Audio(`/Simulation_StandAlone_Pro/${oe[G]}`);W.volume=.5,W.play().catch(()=>{})},J=async()=>{try{await ae(q(K,`simulation_rooms/${e}/players/${t.id}/boat`),{hp:p,isDamaged:p<=0}),s()}catch(G){console.error("Failed to save boat state:",G),s()}},Y=()=>{const G=Date.now();if(G-N<1500||u||w||g<=0)return;const oe=g-1;y(oe),ae(q(K,`simulation_rooms/${e}/players/${t.id}/boat`),{cannonballs:oe}),_(G),V(5),setTimeout(()=>V(0),200),z("CANNON");const W=C.current,ce=W.rotation*Math.PI/180,Se=40,St=W.x+Math.cos(ce)*Se,Bt=W.y+Math.sin(ce)*Se,jt=600,He=Math.cos(ce)*jt,Ia=Math.sin(ce)*jt,dn={id:F.current++,x:St,y:Bt,vx:He,vy:Ia,ownerId:t.id,createdAt:G};C.current.projectiles.push(dn)},fe=async G=>{if(G==="FIRE"){Y();return}if(G==="FISH"){if(u||C.current.speed>1)return;const oe=C.current,W=oe.rotation*Math.PI/180,ce=60;oe.net={active:!0,x:oe.x+Math.cos(W)*ce,y:oe.y+Math.sin(W)*ce,radius:0,t:0,caught:!1},d(!0),P({...oe.net}),V(2),setTimeout(()=>V(0),100)}},me=G=>1+2.70158*Math.pow(G-1,3)+1.70158*Math.pow(G-1,2),ue=G=>2.70158*G*G*G-1.70158*G*G,ne=()=>{const G=Date.now(),oe=(G-$.current)/1e3;$.current=G;const W=C.current;if(p<=0&&!w){k(!0),W.speed=0,W.targetSpeed=0;return}if(w)return;const ce=.92,Se=.2,St=.15,Bt=.985,jt=.05;D.current.left&&(W.angularVelocity-=Se),D.current.right&&(W.angularVelocity+=Se),W.angularVelocity*=ce,W.rotation+=W.angularVelocity,D.current.up&&(W.targetSpeed=Math.min(W.targetSpeed+jt,5)),D.current.down&&(W.targetSpeed=Math.max(W.targetSpeed-jt,0)),W.speed=W.speed*Bt+W.targetSpeed*(1-Bt);const He=W.rotation*Math.PI/180,Ia=Math.cos(He)*W.speed,dn=Math.sin(He)*W.speed;W.velocityVector.x=W.velocityVector.x*(1-St)+Ia*St,W.velocityVector.y=W.velocityVector.y*(1-St)+dn*St;let Oa=W.x+W.velocityVector.x,br=W.y+W.velocityVector.y,qs=null;for(const Fe of Hh)if(Math.hypot(Oa-Fe.x,br-Fe.y)<Fe.r+30){qs=Fe;break}if(!qs&&Oa>0&&Oa<wr&&br>0&&br<wr)W.x=Oa,W.y=br;else if(qs){const Fe=(W.x-qs.x)/Math.hypot(W.x-qs.x,W.y-qs.y),Cs=(W.y-qs.y)/Math.hypot(W.x-qs.x,W.y-qs.y),cs=W.velocityVector.x*Fe+W.velocityVector.y*Cs;W.velocityVector.x=(W.velocityVector.x-2*cs*Fe)*.5,W.velocityVector.y=(W.velocityVector.y-2*cs*Cs)*.5,W.speed*=.5,W.targetSpeed*=.3,V(8),setTimeout(()=>V(0),300)}else W.velocityVector.x*=-.5,W.velocityVector.y*=-.5;a({x:W.x,y:W.y}),c(W.rotation);const jO=W.projectiles,_1=[];for(const Fe of jO){if(Fe.x+=Fe.vx*oe,Fe.y+=Fe.vy*oe,G-Fe.createdAt>2e3)continue;let Cs=!1;for(const cs of Hh)if(Math.hypot(Fe.x-cs.x,Fe.y-cs.y)<cs.r){Cs=!0,C.current.explosions.push({id:Math.random(),x:Fe.x,y:Fe.y,createdAt:G}),z("EXPLOSION");break}if(!Cs){for(const cs in h){const Ma=h[cs];if(Math.hypot(Fe.x-Ma.x,Fe.y-Ma.y)<40){Cs=!0,C.current.explosions.push({id:Math.random(),x:Fe.x,y:Fe.y,createdAt:G}),z("EXPLOSION");const fh=q(K,`simulation_rooms/${e}/sea_state/${cs}/hp`);De(fh,k1=>k1===null?100:Math.max(0,k1-25));break}}Cs||_1.push(Fe)}}W.projectiles=_1,W.explosions=W.explosions.filter(Fe=>G-Fe.createdAt<500),E([...W.projectiles]),R([...W.explosions]);const w1=40,l0=W.x-Math.cos(He)*w1,c0=W.y-Math.sin(He)*w1;if(Math.hypot(l0-U.current.x,c0-U.current.y)>25&&(L(Fe=>{const Cs=[...Fe,{x:l0,y:c0,id:M.current++}];return Cs.length>40&&Cs.shift(),Cs}),U.current={x:l0,y:c0}),W.net&&W.net.active){if(W.net.t+=oe*.8,W.net.t<.5){const Fe=W.net.t*2;W.net.radius=me(Fe)*120}else if(W.net.t<.6){if(!W.net.caught){const Fe=W.net.x,Cs=W.net.y,cs=m.find(Ma=>{const Da=Ma.x-Fe,fh=Ma.y-Cs;return Math.sqrt(Da*Da+fh*fh)<120});if(cs){W.net.caught=!0;const Ma=q(K,`simulation_rooms/${e}/world/sea_resources/${cs.id}`);De(Ma,Da=>{if(Da!==null)return null}).then(()=>{const Da=(t.resources.fish_raw||0)+cs.amount;ae(q(K,`simulation_rooms/${e}/players/${t.id}/resources`),{fish_raw:Da}),z("SPLASH")}).catch(()=>{W.net.caught=!1}),n&&n({success:!0,timestamp:Date.now(),message:`Du fanget ${cs.amount} stk ${cs.type}!`,utbytte:[{resource:"fish_raw",amount:cs.amount,name:cs.type,icon:""}],xp:[{skill:"SAILING",amount:15}],durability:[]})}}W.net.radius=120}else{const Fe=(W.net.t-.6)/.4;W.net.radius=(1-ue(Fe))*120}W.net.t>=1&&(W.net.active=!1,d(!1),W.net=null),P(W.net?{...W.net}:null)}j.current=requestAnimationFrame(ne)};return S.useEffect(()=>{let G;const oe=()=>{var ce,Se,St,Bt;const W=Date.now();W-B.current>100&&(ae(q(K,`simulation_rooms/${e}/sea_state/${t.id}`),{id:t.id,name:t.name,x:C.current.x,y:C.current.y,rotation:C.current.rotation,speed:C.current.speed,stage:((ce=t.boat)==null?void 0:ce.stage)||1,model:((Se=t.boat)==null?void 0:Se.model)||"standard",componentLevels:((St=t.boat)==null?void 0:St.componentLevels)||{sails:0,hull:0,cannons:0,nets:0},customization:((Bt=t.boat)==null?void 0:Bt.customization)||{color:"#4b2c20",flagId:"none",figurehead:"none",unlocked:[]},isFishing:u,timestamp:W}),B.current=W),G=requestAnimationFrame(oe)};return oe(),j.current=requestAnimationFrame(ne),()=>{cancelAnimationFrame(G),cancelAnimationFrame(j.current)}},[e,t.id,u]),S.useEffect(()=>{const G=W=>{(W.key==="a"||W.key==="ArrowLeft")&&(D.current.left=!0),(W.key==="d"||W.key==="ArrowRight")&&(D.current.right=!0),(W.key==="w"||W.key==="ArrowUp")&&(D.current.up=!0),(W.key==="s"||W.key==="ArrowDown")&&(D.current.down=!0),W.key===" "&&fe("FISH"),W.key==="f"&&fe("FIRE")},oe=W=>{(W.key==="a"||W.key==="ArrowLeft")&&(D.current.left=!1),(W.key==="d"||W.key==="ArrowRight")&&(D.current.right=!1),(W.key==="w"||W.key==="ArrowUp")&&(D.current.up=!1),(W.key==="s"||W.key==="ArrowDown")&&(D.current.down=!1)};return window.addEventListener("keydown",G),window.addEventListener("keyup",oe),()=>{window.removeEventListener("keydown",G),window.removeEventListener("keyup",oe)}},[]),w?o.jsxs("div",{className:"fixed inset-0 z-[300] bg-black flex flex-col items-center justify-center text-red-600 font-black animate-in fade-in duration-1000",children:[o.jsx(uO,{size:128,className:"mb-4 animate-pulse"}),o.jsx("h1",{className:"text-6xl uppercase tracking-tighter",children:"Skipbrudden"}),o.jsx("p",{className:"text-white/50 mt-4 text-xl",children:"Ditt skip er sunket til havets bunn."}),o.jsx("button",{onClick:async()=>{try{await ae(q(K,`simulation_rooms/${e}/players/${t.id}/boat`),{hp:10,isDamaged:!0}),s()}catch(G){console.error("Failed to wash ashore:",G),s()}},className:"mt-12 px-8 py-3 bg-red-900/20 border border-red-900 hover:bg-red-900/40 text-red-500 rounded transition-all uppercase tracking-widest",children:"Skyll i land"})]}):o.jsxs("div",{className:"absolute inset-0 z-0 bg-[#051a2e] overflow-hidden cursor-crosshair font-sans",onMouseDown:()=>fe("FIRE"),style:{background:"radial-gradient(circle at 50% 50%, #0a2e4d 0%, #051a2e 100%)",transform:I>0?`translate(${(Math.random()-.5)*I}px, ${(Math.random()-.5)*I}px)`:"none",transition:"transform 0.05s linear",contain:"strict"},children:[o.jsx(AO,{pos:r}),o.jsx("svg",{className:"absolute inset-0 w-full h-full overflow-visible blur-md pointer-events-none",children:O.map((G,oe)=>{if(oe===0)return null;const W=O[oe-1],ce=oe/O.length;return o.jsx("line",{x1:W.x-r.x+window.innerWidth/2,y1:W.y-r.y+window.innerHeight/2,x2:G.x-r.x+window.innerWidth/2,y2:G.y-r.y+window.innerHeight/2,stroke:"#fff",strokeWidth:25*ce,strokeOpacity:.08*ce,strokeLinecap:"round"},G.id)})}),Hh.map(G=>o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0)`},children:[o.jsx("div",{className:"absolute inset-0 bg-white/5 blur-3xl opacity-30 rounded-full",style:{width:G.r*3,height:G.r*3,transform:"translate(-50%, -50%)"}}),o.jsx("div",{className:"absolute rounded-full shadow-[0_0_50px_rgba(0,0,0,0.5)]",style:{width:G.r*2,height:G.r*2,backgroundColor:G.color,transform:"translate(-50%, -50%)",border:"8px solid rgba(255,255,255,0.05)"}}),o.jsx("div",{className:"absolute top-[110%] left-1/2 -translate-x-1/2 text-white/20 text-[10px] uppercase tracking-[0.3em] font-black whitespace-nowrap",children:G.name})]},G.id)),m.map(G=>o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0)`},children:[o.jsx("div",{className:"absolute inset-0 bg-white/30 blur-md rounded-full animate-ping",style:{width:40,height:40,transform:"translate(-50%, -50%)",animationDuration:"3s"}}),o.jsxs("div",{className:"absolute flex flex-col items-center",style:{transform:"translate(-50%, -50%)"},children:[o.jsx(Z.div,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},children:o.jsx(ZX,{size:20,className:"text-cyan-400 drop-shadow-[0_0_8px_rgba(34,211,238,0.8)]"})}),o.jsxs("div",{className:"text-[9px] font-black text-cyan-200/60 uppercase tracking-widest mt-1 bg-black/40 px-1.5 py-0.5 rounded backdrop-blur-sm border border-white/5",children:[G.amount," ",G.type]})]})]},G.id)),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[T.map(G=>o.jsx("div",{className:"absolute w-2 h-2 bg-black rounded-full shadow-lg",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0)`}},G.id)),A.map(G=>o.jsx("div",{className:"absolute w-16 h-16 bg-orange-500 rounded-full animate-ping opacity-60",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0) translate(-50%, -50%)`}},G.id))]}),H&&H.active&&o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${H.x-r.x+window.innerWidth/2}px, ${H.y-r.y+window.innerHeight/2}px, 0)`},children:[H.t>=.5&&H.t<.7&&o.jsx(Z.div,{initial:{scale:.8,opacity:.8},animate:{scale:1.2,opacity:0},className:"absolute inset-0 rounded-full border-4 border-white/40 blur-sm",style:{width:240,height:240,transform:"translate(-50%, -50%)"}}),o.jsxs("svg",{width:H.radius*2.5,height:H.radius*2.5,viewBox:"0 0 100 100",className:"absolute",style:{transform:"translate(-50%, -50%)"},children:[o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"hsl(28, 55%, 35%)",strokeWidth:"3",strokeDasharray:"4 2",className:"opacity-80"}),o.jsx("circle",{cx:"50",cy:"50",r:"38",fill:"hsl(28, 55%, 20%)",fillOpacity:"0.1",stroke:"hsl(28, 55%, 45%)",strokeWidth:"1"}),o.jsx("path",{d:"M 50 10 L 50 90 M 10 50 L 90 50 M 22 22 L 78 78 M 22 78 L 78 22",stroke:"hsl(28, 55%, 35%)",strokeWidth:"1",strokeOpacity:"0.3"})]}),H.caught&&o.jsx(Z.div,{initial:{scale:0},animate:{scale:[0,1.5,1]},className:"absolute -top-12 left-1/2 -translate-x-1/2 text-cyan-400 font-black text-xs uppercase tracking-widest bg-black/60 px-2 py-1 rounded backdrop-blur-md border border-cyan-500/30",children:"Fangst!"})]}),Object.values(h).map(G=>G.isOffline?null:o.jsxs("div",{className:"absolute w-32 h-32",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0) translate(-50%, -50%)`},children:[o.jsx(Z.div,{style:{rotate:G.rotation},className:"w-full h-full",children:o.jsx(qm,{stage:G.stage,model:G.model,componentLevels:G.componentLevels,customization:G.customization||{color:"#64748b"},rotation:0})}),o.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 text-center w-48",children:o.jsx("div",{className:"text-[10px] font-black text-white/40 uppercase tracking-widest shadow-black drop-shadow-md",children:G.name})})]},G.id)),o.jsx(Z.div,{animate:{scale:N>Date.now()-200?[1,.92,1]:H!=null&&H.active?[1,1.05,1]:1,opacity:u?.9:1},transition:{duration:.2},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-40 h-40 z-10 pointer-events-none",children:o.jsx(qm,{stage:((Pe=t.boat)==null?void 0:Pe.stage)||1,model:(_e=t.boat)==null?void 0:_e.model,componentLevels:(Q=t.boat)==null?void 0:Q.componentLevels,customization:(ie=t.boat)==null?void 0:ie.customization,rotation:l})}),o.jsx(Dt,{children:o.jsxs(Z.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"absolute bottom-12 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 pointer-events-none",children:[o.jsx("div",{className:"px-3 py-1 bg-black/40 backdrop-blur-xl border border-white/10 rounded-full text-[10px] font-black uppercase text-red-500 tracking-[0.2em]",children:"Skrog"}),o.jsx("div",{className:"w-80 h-3 bg-black/60 border border-white/5 rounded-full overflow-hidden shadow-2xl backdrop-blur-md",role:"progressbar","aria-valuenow":p,"aria-valuemin":0,"aria-valuemax":x,"aria-label":"Skipets holdbarhet",children:o.jsx(Z.div,{className:"h-full bg-gradient-to-r from-red-600 via-orange-500 to-red-600 shadow-[0_0_20px_rgba(220,38,38,0.5)]",animate:{width:`${p/x*100}%`},transition:{type:"spring",stiffness:50,damping:15}})}),o.jsxs("div",{className:"text-[10px] text-white/30 font-bold uppercase tracking-widest",children:[Math.round(p)," / ",x," HP"]})]})}),o.jsx(Dt,{children:o.jsxs(Z.div,{initial:{x:50,opacity:0},animate:{x:0,opacity:1},className:"absolute bottom-12 right-12 flex flex-col items-end gap-2 pointer-events-none",children:[o.jsx("div",{className:"px-3 py-1 bg-black/40 backdrop-blur-xl border border-white/10 rounded-full text-[10px] font-black uppercase text-amber-500 tracking-[0.2em]",children:"AMMUNISJON"}),o.jsxs("div",{className:`p-6 rounded-[2rem] border backdrop-blur-2xl flex flex-col items-center justify-center min-w-[120px] transition-colors duration-500
                        ${g>10?"bg-slate-950/40 border-white/10":g>0?"bg-amber-950/40 border-amber-500/30":"bg-red-950/60 border-red-500/50 animate-pulse"}
                    `,children:[o.jsxs("div",{className:"flex items-end gap-1 mb-1",children:[o.jsx("span",{className:`text-5xl font-black italic tracking-tighter leading-none
                                ${g>10?"text-white":g>0?"text-amber-400":"text-red-500"}
                            `,children:g}),o.jsx("span",{className:"text-white/20 text-sm font-bold uppercase mb-1",children:"stk"})]}),o.jsxs("div",{className:"flex items-center gap-2 opacity-50",children:[o.jsx(VX,{size:12,className:g>0?"fill-current text-white":"text-red-500"}),o.jsx("div",{className:"w-12 h-1 bg-white/10 rounded-full overflow-hidden",children:o.jsx(Z.div,{className:`h-full ${g>0?"bg-white":"bg-red-500"}`,animate:{width:`${Math.min(100,g/50*100)}%`}})})]})]})]})}),o.jsx(Z.button,{whileHover:{scale:1.05,backgroundColor:"rgba(127, 29, 29, 0.6)"},whileTap:{scale:.95},onClick:()=>{xt(()=>Promise.resolve().then(()=>So),void 0).then(G=>G.audioManager.playSfx("click")),J()},"aria-label":"Tilbake til kai",className:"absolute top-8 left-8 z-[110] px-6 py-2 bg-red-950/40 backdrop-blur-md border border-[#c29d0b]/40 rounded-sm text-[10px] text-[#e5e7eb] font-black uppercase tracking-[0.25em] transition-all hover:border-[#c29d0b] shadow-2xl",children:"Tilbake til kai"}),o.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-8 text-white/20 text-[9px] font-black uppercase tracking-[0.2em]",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"WASD"})," Manvrering"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"SPACE"})," Fisking"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"F"})," Avfyr Kanon"]})]}),o.jsx("div",{className:"absolute top-6 right-6 w-44 h-44 bg-black/30 rounded-full border border-white/5 backdrop-blur-md overflow-hidden z-50 pointer-events-none opacity-60",children:o.jsxs("div",{className:"relative w-full h-full p-6",children:[Hh.map(G=>o.jsx("div",{className:"absolute rounded-full bg-emerald-500/20",style:{width:G.r/wr*100+"%",height:G.r/wr*100+"%",left:G.x/wr*100+"%",top:G.y/wr*100+"%",transform:"translate(-50%, -50%)"}},G.id)),o.jsx("div",{className:"absolute w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_cyan]",style:{left:r.x/wr*100+"%",top:r.y/wr*100+"%",transform:"translate(-50%, -50%)"}})]})}),window.matchMedia("(pointer: coarse)").matches&&o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsxs("div",{className:"absolute bottom-12 right-12 flex flex-col items-center gap-2 pointer-events-auto scale-75 md:scale-100 origin-bottom-right",children:[o.jsx(Z.button,{whileTap:{scale:.9},onTouchStart:()=>{D.current.up=!0},onTouchEnd:()=>{D.current.up=!1},"aria-label":"Manvrer opp",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"W"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(Z.button,{whileTap:{scale:.9},onTouchStart:()=>{D.current.left=!0},onTouchEnd:()=>{D.current.left=!1},"aria-label":"Snu til venstre",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"A"}),o.jsx(Z.button,{whileTap:{scale:.9},onTouchStart:()=>{D.current.down=!0},onTouchEnd:()=>{D.current.down=!1},"aria-label":"Manvrer ned",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"S"}),o.jsx(Z.button,{whileTap:{scale:.9},onTouchStart:()=>{D.current.right=!0},onTouchEnd:()=>{D.current.right=!1},"aria-label":"Snu til hyre",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"D"})]})]}),o.jsxs("div",{className:"absolute bottom-12 left-12 flex gap-4 pointer-events-auto scale-75 md:scale-100 origin-bottom-left",children:[o.jsxs(Z.button,{whileTap:{scale:.9},onClick:()=>fe("FIRE"),"aria-label":"Avfyr kanon",className:"w-20 h-20 bg-red-900/20 backdrop-blur-md rounded-full border border-red-500/20 flex flex-col items-center justify-center text-red-500/60 font-black text-[10px] tracking-widest",children:[o.jsx("span",{children:"F"}),o.jsx("span",{children:"ILD"})]}),o.jsxs(Z.button,{whileTap:{scale:.9},onClick:()=>fe("FISH"),"aria-label":"Fiske",className:"w-20 h-20 bg-blue-900/20 backdrop-blur-md rounded-full border border-blue-500/20 flex flex-col items-center justify-center text-blue-500/60 font-black text-[10px] tracking-widest",children:[o.jsx("span",{children:"SPACE"}),o.jsx("span",{children:"FISK"})]})]})]})]})},Vte=({player:t,room:e,onOpenHub:s})=>{const[n,i]=S.useState(null),[r,a]=S.useState(!1);return S.useEffect(()=>{var d,h;if(!(e!=null&&e.regions)||!t)return;const l=t.regionId,c=e.regions[l];let u=null;if(c!=null&&c.activeElection)u={type:"ELECTION",region:c};else if(c&&!c.rulerId&&l!=="capital")u={type:"VACANT",region:c};else if(t.role==="KING"){const f=Object.values(e.regions).find(m=>m.activeElection);f&&(u={type:"ELECTION",region:f})}(((d=u==null?void 0:u.region)==null?void 0:d.id)!==((h=n==null?void 0:n.region)==null?void 0:h.id)||(u==null?void 0:u.type)!==(n==null?void 0:n.type))&&a(!1),i(u)},[e==null?void 0:e.regions,t==null?void 0:t.regionId,t==null?void 0:t.role]),!n||r?null:o.jsx(Dt,{children:o.jsx(Z.div,{initial:{y:200,opacity:0,scale:.8},animate:{y:0,opacity:1,scale:1},exit:{y:200,opacity:0,scale:.8},transition:{type:"spring",stiffness:300,damping:25},className:"fixed bottom-32 left-1/2 -translate-x-1/2 z-[3000]",children:o.jsxs("div",{className:"relative flex items-center gap-8 p-8 pr-16 bg-slate-900/95 backdrop-blur-2xl border border-amber-500/50 rounded-3xl shadow-[0_0_80px_rgba(245,158,11,0.4)] min-w-[600px] overflow-hidden group",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-500/10 to-transparent animate-pulse pointer-events-none"}),o.jsxs("div",{className:"relative shrink-0",children:[o.jsx("div",{className:"absolute inset-0 bg-amber-500/40 blur-2xl rounded-full"}),o.jsx("div",{className:"w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-500/20 to-orange-600/20 flex items-center justify-center text-amber-500 border border-amber-500/50 shadow-inner relative z-10",children:n.type==="ELECTION"?o.jsx(TJ,{size:40}):o.jsx(oc,{size:40})})]}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"text-3xl font-black uppercase text-white tracking-widest leading-none mb-3 drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]",children:n.type==="ELECTION"?"Valg Pgr!":"Makt-Vakuum"}),o.jsx("p",{className:"text-lg text-amber-100/90 font-medium leading-tight text-shadow-sm",children:n.type==="ELECTION"?`Skjebnevalg i ${n.region.name}! Din stemme teller.`:`${n.region.name} str uten herre. Kaos herjer!`})]}),o.jsxs("button",{onClick:s,className:"shrink-0 flex items-center gap-3 px-8 py-4 bg-amber-500 hover:bg-amber-400 text-black text-sm font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl shadow-amber-500/30 hover:scale-105 active:scale-95 group/btn",children:[o.jsx("span",{children:"Grip Makten"}),o.jsx(aa,{size:18,className:"group-hover/btn:translate-x-1 transition-transform"})]}),o.jsx("button",{onClick:()=>a(!0),className:"absolute top-4 right-4 p-2 text-slate-500 hover:text-white hover:bg-white/10 rounded-full transition-colors","aria-label":"Lukk",children:o.jsx(In,{size:24})})]})})})},Fte=({color:t})=>{const e=Array.from({length:24}).map((s,n)=>({id:n,angle:n/24*360,distance:120+Math.random()*120,delay:Math.random()*.2,size:4+Math.random()*6,scale:Math.random()}));return o.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center justify-center z-50",children:e.map(s=>o.jsx(Z.div,{initial:{opacity:1,x:0,y:0,scale:0},animate:{opacity:0,x:Math.cos(s.angle*(Math.PI/180))*s.distance,y:Math.sin(s.angle*(Math.PI/180))*s.distance,scale:s.scale},transition:{duration:1.2,ease:"easeOut",delay:s.delay},className:`absolute rounded-full ${t}`,style:{width:s.size,height:s.size}},s.id))})},Bte=()=>{const{currentAchievement:t,dismissAchievement:e,setActiveTab:s,setProfileTab:n}=va(),[i,r]=S.useState(!1),a=t?Cte(t):null;S.useEffect(()=>{t?(r(!0),Os.playSuccess()):r(!1)},[t]);const l=()=>{r(!1),setTimeout(()=>e(),300)},c=()=>{r(!1),setTimeout(()=>{e(),n("achievements"),s("PROFILE")},300)};if(!a)return null;const d={COMMON:{bg:"bg-gradient-to-br from-slate-200 to-slate-400",textTitle:"text-slate-900",textDesc:"text-slate-700",border:"border-white/50",iconBg:"bg-slate-900",iconColor:"text-slate-200",particle:"bg-slate-300",glow:"shadow-[0_0_100px_Infinity_rgba(148,163,184,0.3)]",outerGlow:"bg-slate-400",buttonPrimary:"bg-slate-900 text-white hover:bg-slate-800",buttonSecondary:"text-slate-600 hover:text-slate-900"},RARE:{bg:"bg-gradient-to-br from-indigo-300 via-indigo-400 to-indigo-500",textTitle:"text-indigo-950",textDesc:"text-indigo-900",border:"border-white/40",iconBg:"bg-indigo-950",iconColor:"text-indigo-200",particle:"bg-indigo-200",glow:"shadow-[0_0_100px_Infinity_rgba(99,102,241,0.3)]",outerGlow:"bg-indigo-500",buttonPrimary:"bg-indigo-950 text-indigo-100 hover:bg-indigo-900",buttonSecondary:"text-indigo-800 hover:text-indigo-950"},EPIC:{bg:"bg-gradient-to-br from-amber-200 via-amber-400 to-amber-500",textTitle:"text-amber-950",textDesc:"text-amber-900",border:"border-amber-100/50",iconBg:"bg-amber-950",iconColor:"text-amber-300",particle:"bg-amber-100",glow:"shadow-[0_0_120px_Infinity_rgba(251,191,36,0.5)]",outerGlow:"bg-amber-500",buttonPrimary:"bg-amber-950 text-amber-100 hover:bg-amber-900 shadow-xl shadow-amber-900/20",buttonSecondary:"text-amber-800 hover:text-amber-950"},LEGENDARY:{bg:"bg-gradient-to-br from-rose-300 via-rose-500 to-rose-600",textTitle:"text-rose-950",textDesc:"text-rose-900",border:"border-rose-200/50",iconBg:"bg-rose-950",iconColor:"text-rose-200",particle:"bg-rose-200",glow:"shadow-[0_0_150px_Infinity_rgba(244,63,94,0.5)]",outerGlow:"bg-rose-500",buttonPrimary:"bg-rose-950 text-rose-100 hover:bg-rose-900",buttonSecondary:"text-rose-800 hover:text-rose-950"}}[a.rarity],h=EO[a.icon];return qb.createPortal(o.jsx(Dt,{children:i&&o.jsxs("div",{className:"fixed inset-0 z-[4000] flex items-center justify-center pointer-events-none",children:[o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-[#020205]/95 backdrop-blur-md pointer-events-auto"}),o.jsxs(Z.div,{initial:{scale:.5,opacity:0,y:100,rotateX:20},animate:{scale:1,opacity:1,y:0,rotateX:0},exit:{scale:.9,opacity:0,y:50},transition:{type:"spring",damping:12,stiffness:100},className:"relative w-[90vw] max-w-sm pointer-events-auto perspective-1000",children:[o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[120%] h-[120%] rounded-full blur-[80px] opacity-40 animate-pulse-slow ${d.outerGlow}`}),o.jsx(Z.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[150%] h-[150%] opacity-20 bg-gradient-conic from-transparent via-${d.outerGlow.split("-")[1]}-300 to-transparent blur-3xl`}),o.jsxs("div",{className:`relative w-full rounded-[2.5rem] p-8 shadow-2xl overflow-hidden ${d.bg} border ${d.border}`,children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-white/0 via-white/30 to-white/0 translate-x-[-100%] animate-shimmer pointer-events-none"}),o.jsx(Fte,{color:d.particle}),o.jsxs("div",{className:"relative z-10 text-center",children:[o.jsx(Z.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",delay:.1},className:`w-28 h-28 mx-auto mb-8 rounded-[2rem] flex items-center justify-center shadow-xl ${d.iconBg} ${d.iconColor} ring-4 ring-white/10`,children:h?Ne.cloneElement(h,{size:56,strokeWidth:1.5}):o.jsx(cc,{size:56})}),o.jsxs(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[o.jsx("div",{className:`text-[10px] font-black uppercase tracking-[0.3em] mb-3 opacity-70 ${d.textTitle}`,children:"Bragd Lst Opp"}),o.jsx("h2",{className:`text-4xl font-black italic tracking-tighter mb-4 ${d.textTitle} drop-shadow-md leading-[0.9]`,children:a.name}),o.jsx("p",{className:`text-sm font-bold leading-relaxed mb-8 px-2 ${d.textDesc}`,children:a.description})]}),o.jsxs(Z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"flex flex-col gap-3",children:[o.jsxs("button",{onClick:c,className:`w-full py-4 rounded-2xl font-black uppercase text-[11px] tracking-widest flex items-center justify-center gap-2 transform active:scale-95 transition-all shadow-xl hover:-translate-y-1 ${d.buttonPrimary}`,children:["Se mine bragder ",o.jsx(h1,{size:14,strokeWidth:3})]}),o.jsx("button",{onClick:l,className:`py-3 text-[10px] font-bold uppercase tracking-widest opacity-60 hover:opacity-100 transition-opacity ${d.textTitle}`,children:"Lukk vindu"})]})]})]})]})]})}),document.body)},Ute=()=>{var Q;const{pin:t}=FA(),[e]=E3(),s=e.get("impersonate"),n=vc(),{user:i,account:r,loading:a}=Lo(),{activeMinigame:l,setActiveMinigame:c,activeMinigameAction:u,setActiveMinigameAction:d,activeMinigameMethod:h,setActiveMinigameMethod:f,activeTab:m,setActiveTab:b,showAchievement:p}=va(),{setHideHeader:v,setFullWidth:x}=HA(),[g,y]=S.useState(!1);Ne.useEffect(()=>{m==="PROFILE"&&(y(!0),b("MAP"))},[m,b]),Ne.useEffect(()=>{v(!0),x(!0);const ie=()=>{xt(async()=>{const{audioManager:G}=await Promise.resolve().then(()=>So);return{audioManager:G}},void 0).then(({audioManager:G})=>{G.resume()}),window.removeEventListener("click",ie),window.removeEventListener("keydown",ie)};return window.addEventListener("click",ie),window.addEventListener("keydown",ie),()=>{v(!1),x(!1),window.removeEventListener("click",ie),window.removeEventListener("keydown",ie)}},[v,x]);const{player:w,world:k,players:N,roomStatus:_,markets:T,messages:E,diplomacy:A,activeVote:R,worldEvents:I,trades:V,regions:H,isRetired:P}=JZ(t,s);Ne.useEffect(()=>{if(!w||!t||!w.resources)return;const ie=w.resources,G=ie.oak_log||0,oe=ie.oak_lumber||0;if(G>0||oe>0){console.log("MIGRATION: Converting Legacy Oak...",{oakLog:G,oakLumber:oe});const W={};W[`players/${w.id}/resources/oak_log`]=null,W[`players/${w.id}/resources/oak_lumber`]=null,W[`players/${w.id}/resources/wood`]=(ie.wood||0)+G,W[`players/${w.id}/resources/plank`]=(ie.plank||0)+oe;const ce=q(K,`simulation_rooms/${t}`);ae(ce,W).then(()=>console.log("MIGRATION: Success")).catch(Se=>console.error("MIGRATION: Failed",Se))}},[w==null?void 0:w.id,w==null?void 0:w.resources,t]),Ne.useEffect(()=>{if(!w||!t||!i||!r)return;(async()=>{var jt,He,Ia;const G=r.activeSessions;let oe={},W=!1;Array.isArray(G)?(console.log("ULTRATHINK: Detected Legacy Session Array. Migrating to Map..."),W=!0,G.forEach(dn=>{dn&&dn.roomPin&&(oe[dn.roomPin]=dn)})):G&&(oe=G);const ce=oe[t],Se=!ce,St=ce?Date.now()-ce.lastPlayed>2*60*1e3:!0,Bt=ce&&(ce.gold===void 0||ce.level===void 0);if(W||Se||St||Bt){const dn=H&&H[w.regionId]?H[w.regionId].name:"Ukjent Region",Oa={roomPin:t,name:w.name,role:w.role,regionId:w.regionId,regionName:dn,gold:((jt=w.resources)==null?void 0:jt.gold)||0,level:((He=w.stats)==null?void 0:He.level)||1,xp:((Ia=w.stats)==null?void 0:Ia.xp)||0,lastPlayed:Date.now()},br={};if(W){const qs={...oe,[t]:Oa};br[`simulation_accounts/${i.uid}/activeSessions`]=qs}else br[`simulation_accounts/${i.uid}/activeSessions/${t}`]=Oa;try{await ae(q(K),br)}catch(qs){console.error("ULTRATHINK: Session Sync Failed",qs)}}})()},[w,t,i,r,H]),Ne.useEffect(()=>{!w||!i||!r||xt(async()=>{const{checkPassiveAchievements:ie}=await import("./achievementLogic-C0lNuDPY.js");return{checkPassiveAchievements:ie}},[]).then(({checkPassiveAchievements:ie})=>{ie(i.uid,w,r,p)})},[(Q=w==null?void 0:w.stats)==null?void 0:Q.level,w==null?void 0:w.role,r==null?void 0:r.globalXp,JSON.stringify(w==null?void 0:w.resources)]);const{handleAction:O,actionResult:L,setActionResult:M,handleClearActionResult:F}=_O(t,w,k,c,f,d,l,r,p),[U,C]=S.useState(!1),[j,$]=S.useState(null),[B,D]=S.useState(null),[z,J]=S.useState(!1),[Y,fe]=S.useState(!1),[me,ue]=S.useState(!1),[ne,Le]=S.useState(!1),[ft,se]=S.useState(void 0),le=ie=>{const G=typeof ie=="string"?ie:ie.type;if(G==="MOUNT_HORSE"&&!ie.method){J(!0);return}if(G==="OPEN_TAVERN_MENU"){fe(!0);return}if(G==="OPEN_WEAPON_RACK"){ue(!0);return}if(G==="OPEN_CARAVAN"){ie.targetRegionId&&se(ie.targetRegionId),Le(!0);return}if(G==="OPEN_POLITICAL_HUB"){b("POLITICS");return}O(ie)},Pe=async(ie,G)=>{if(!(!t||!i)){C(!0);try{const oe=q(K,`simulation_rooms/${t}`),W=s||i.uid;let ce=Math.random()>.5?"region_ost":"region_vest";G==="BARON"?ce=`region_${W}`:G==="KING"&&(ce="capital");const Se={id:W,uid:i.uid,name:ie,role:G,regionId:ce,resources:ms[G]||ms.PEASANT,skills:Rn[G]||Rn.PEASANT,stats:{xp:0,level:1,reputation:50,contribution:0},status:{hp:100,morale:100,stamina:50,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},equipment:ub[G]||ub.PEASANT,upgrades:[],lastActive:Date.now()},St={id:W,uid:i.uid,name:ie,role:G,regionId:ce,stats:{level:1},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:Date.now()},Bt={};Bt[`players/${W}`]=Se,Bt[`public_profiles/${W}`]=St,await ae(oe,Bt)}catch(oe){console.error("Failed to create player:",oe),alert("Kunne ikke opprette karakter.")}finally{C(!1)}}},_e=S.useMemo(()=>({status:_,world:k,players:N||{},messages:E||[],markets:T||{},market:(T&&(w!=null&&w.regionId)?T[w.regionId]:Object.values(T||{})[0])||{},diplomacy:A||{},trades:V||{},activeVote:R,worldEvents:I||{},regions:H||{},settings:"feudal_europe",pin:t||""}),[_,k,N,E,T,A,R,I,V,H,t]);return a&&!w?o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin mb-6"}),o.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-widest animate-pulse",children:"Vkner til liv..."})]}):P?o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 text-center",children:[o.jsx("div",{className:"w-20 h-20 bg-indigo-500/20 rounded-3xl flex items-center justify-center text-indigo-400 mb-8 border border-white/10 shadow-2xl",children:o.jsx(lc,{size:40})}),o.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter mb-4",children:"Karakteren er pensjonert"}),o.jsx("p",{className:"text-slate-400 max-w-sm mb-12",children:"Ditt ettermle er sikret i Hall of Fame. G tilbake til lobbyen for  starte et nytt liv."}),o.jsx("button",{onClick:()=>n("/sim"),className:"px-12 py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl shadow-indigo-600/20 active:scale-95",children:"Til Lobbyen"})]}):w?k?o.jsxs("div",{className:"relative min-h-screen bg-slate-900 text-white overflow-hidden flex flex-col",children:[o.jsx("div",{className:"flex-1 flex flex-col relative",children:o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 flex overflow-hidden",children:[o.jsx("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full animate-pulse"})}),!w.hasSeenIntro&&o.jsx(Nte,{player:w,pin:t||"",onComplete:()=>{w.hasSeenIntro=!0}}),l&&l!=="SAILING"&&o.jsx(wee,{type:l,player:w,playerUpgrades:w.upgrades,equipment:Object.values(w.equipment||{}),skills:w.skills,selectedMethod:h||void 0,action:u,onComplete:(ie,G)=>{if(l==="TRAVEL_START")ie>0?(console.log("[SimulationPlayer] Minigame Complete. Data:",G),O({type:"TRAVEL_COMPLETE",targetRegionId:u==null?void 0:u.targetRegionId,finalDurability:G==null?void 0:G.durability})):O({type:"TRAVEL_FAILED",targetRegionId:u==null?void 0:u.targetRegionId,finalDurability:0});else{const oe=l,W=u||{};!W.type&&oe&&console.warn(`[SimulationPlayer] Warning: Minigame '${oe}' completed without explicit action object. Using fallback.`);const ce={type:oe,...W,performance:ie,method:h};O(ce)}},onCancel:()=>{c(null),d(null),f(null)},currentSeason:(k==null?void 0:k.season)||"Spring",currentWeather:(k==null?void 0:k.weather)||"Clear",totalTicks:(k==null?void 0:k.totalTicks)||0}),z&&o.jsx(vte,{player:w,onAction:O,onClose:()=>J(!1)}),Y&&o.jsx(yte,{player:w,room:_e,onAction:O,onClose:()=>fe(!1)}),me&&o.jsx(Lee,{player:w,onAction:O,onClose:()=>ue(!1)}),ne&&o.jsx(Lte,{player:w,onAction:O,onClose:()=>{Le(!1),se(void 0)},preselectedTarget:ft}),o.jsx(fte,{}),o.jsxs("div",{className:"flex flex-col h-full w-full overflow-hidden",children:[o.jsx(ZZ,{room:_e,player:w,pin:t,onAction:le}),o.jsxs("main",{className:"flex-1 relative overflow-hidden bg-slate-950/50",children:[o.jsx(hte,{player:w,room:_e,pin:t,onAction:le,actionResult:L,onClearActionResult:F}),o.jsx(Dt,{children:l==="SAILING"&&o.jsx(Z.div,{initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.4,ease:[.22,1,.36,1]},className:"absolute inset-0 z-50 bg-slate-950",children:o.jsx(Pte,{player:w,roomPin:_e.pin,onExit:()=>c(null),onActionResult:M})})})]})]})]})}),j&&o.jsx(mte,{level:j.level,title:j.title,onClose:()=>$(null)}),o.jsx(Tte,{pin:t||"",player:w,onOpenProfile:ie=>{const G=_e.players[ie];G?D(G):console.warn("Spiller ikke funnet i rommet:",ie)}}),B&&o.jsx(jte,{isOpen:!0,onClose:()=>D(null),myPlayer:w,targetPlayer:B,pin:t||""}),w&&_e&&o.jsx(Vte,{player:w,room:_e,onOpenHub:()=>{le({type:"OPEN_BUILDING",buildingId:"manor"}),le("OPEN_POLITICAL_HUB")}}),o.jsx(Mte,{isOpen:g,onClose:()=>{y(!1),m==="PROFILE"&&b("MAP")},currentRoomPin:t}),o.jsx(Bte,{})]}):o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center gap-4 text-white",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-white rounded-full animate-spin"}),o.jsx("p",{className:"text-sm font-bold uppercase tracking-widest text-indigo-400",children:"Laster verden..."})]}):o.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-6",children:o.jsx(pte,{pin:t||"",account:r,onCreatePlayer:Pe,isCreating:U})})},$te=()=>o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2,3,4].map(t=>o.jsx("div",{className:"h-36 bg-white/5 rounded-2xl animate-pulse border border-white/5 relative overflow-hidden",children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"})},t))}),Gte=({server:t,onClick:e})=>{const s={Spring:{color:"text-emerald-400",icon:_Q,label:"Vr",bg:"group-hover:bg-emerald-500/10"},Summer:{color:"text-amber-400",icon:dO,label:"Sommer",bg:"group-hover:bg-amber-500/10"},Autumn:{color:"text-orange-400",icon:fO,label:"Hst",bg:"group-hover:bg-orange-500/10"},Winter:{color:"text-blue-400",icon:cJ,label:"Vinter",bg:"group-hover:bg-blue-500/10"}},n=s[t.season]||s.Spring;return o.jsxs(Z.button,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},whileHover:{y:-4},onClick:e,className:`group relative overflow-hidden flex flex-col p-6 bg-white/5 border border-white/5 hover:border-white/20 rounded-2xl transition-all text-left shadow-xl ${n.bg}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h3",{className:"text-lg font-black text-white group-hover:text-white transition-colors leading-tight truncate max-w-[200px]",children:t.name||`Rike #${t.pin}`}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mt-1",children:[o.jsxs("span",{className:"px-1.5 py-0.5 bg-white/5 rounded",children:["PIN: ",t.pin]}),o.jsxs("span",{className:"opacity-50",children:["BY: ",t.hostName]})]})]}),o.jsx("div",{className:`p-2.5 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 ${n.color} group-hover:scale-110 transition-transform`,children:o.jsx(n.icon,{size:20})})]}),o.jsxs("div",{className:"mt-auto flex items-center justify-between relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-[0.15em] text-white/20 font-black mb-1",children:"Live N"}),o.jsxs("div",{className:"flex items-center gap-1.5 text-white/80 font-black",children:[o.jsx(o0,{size:14,className:"text-indigo-400"}),o.jsx("span",{className:"text-sm tabular-nums",children:t.playerCount||0})]})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-[0.15em] text-white/20 font-black mb-1",children:"Tidsalder"}),o.jsxs("div",{className:"flex items-center gap-1.5 text-white/80 font-black",children:[o.jsx(sO,{size:14,className:"text-amber-500"}),o.jsxs("span",{className:"text-sm italic",children:[n.label," ",t.worldYear]})]})]})]}),o.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-black uppercase tracking-wider text-white/10 group-hover:text-white transition-colors",children:["Join ",o.jsx(aa,{size:14})]})]}),o.jsx("div",{className:"absolute -bottom-6 -right-6 opacity-[0.02] group-hover:opacity-[0.05] transition-opacity",children:o.jsx(n.icon,{size:120})}),o.jsx("div",{className:"absolute inset-0 border-2 border-indigo-500/0 group-hover:border-indigo-500/20 rounded-2xl transition-all"})]})},Hte=()=>{const[t,e]=S.useState([]),[s,n]=S.useState(!0),[i,r]=S.useState(""),a=vc();S.useEffect(()=>{const c=q(K,"simulation_server_metadata"),u=Qe(c,d=>{const h=d.val();if(h){const f=Object.values(h);e(f.filter(m=>m.isPublic&&(m.status==="LOBBY"||m.status==="PLAYING")).sort((m,b)=>b.lastUpdated-m.lastUpdated))}else e([]);n(!1)});return()=>u()},[]);const l=t.filter(c=>{var u;return c.pin.includes(i)||((u=c.name)==null?void 0:u.toLowerCase().includes(i.toLowerCase()))||c.hostName.toLowerCase().includes(i.toLowerCase())});return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity rounded-2xl"}),o.jsx(WQ,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/40 group-focus-within:text-indigo-400 transition-colors",size:18}),o.jsx("input",{type:"text",placeholder:"Sk etter en verden  erobre...",value:i,onChange:c=>r(c.target.value),className:"relative w-full bg-white/5 border border-white/10 focus:border-indigo-500/50 rounded-2xl py-4 pl-12 pr-4 text-sm text-white placeholder:text-white/20 outline-none transition-all shadow-inner"})]}),o.jsx(Dt,{mode:"popLayout",children:s?o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:o.jsx($te,{})},"loading"):l.length===0?o.jsx(Z.div,{initial:{opacity:0},animate:{opacity:1},className:"py-16 text-center border-2 border-white/5 border-dashed rounded-[2rem] bg-white/[0.02]",children:o.jsx("p",{className:"text-lg text-white/20 font-black italic uppercase tracking-widest",children:"Ingen riker funnet for sket."})},"empty"):o.jsx(Z.div,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",initial:"hidden",animate:"show",variants:{show:{transition:{staggerChildren:.05}}},children:l.map(c=>o.jsx(Gte,{server:c,onClick:()=>a(`/play/${c.pin}`)},c.pin))},"list")})]})},zte=({isOpen:t,onClose:e,initialMode:s="REGISTER"})=>{const{login:n,register:i,resetPassword:r,checkNameAvailability:a,error:l}=Lo(),[c,u]=S.useState(s),[d,h]=S.useState(""),[f,m]=S.useState(""),[b,p]=S.useState(""),[v,x]=S.useState(!1),[g,y]=S.useState(null),[w,k]=S.useState(null),[N,_]=S.useState(null),[T,E]=S.useState(!1);if(S.useEffect(()=>{if(c!=="REGISTER"||b.length<3){_(null);return}const R=setTimeout(async()=>{E(!0);try{const I=await a(b);_(I)}catch(I){console.error(I)}finally{E(!1)}},500);return()=>clearTimeout(R)},[b,c,a]),!t)return null;const A=async R=>{R.preventDefault(),y(null),k(null),x(!0);try{if(c==="LOGIN")await n(d,f),e();else if(c==="REGISTER"){if(N===!1)throw new Error("Navnet er allerede tatt.");await i(d,f,b),e()}else c==="FORGOT"&&(await r(d),k("E-post for tilbakestilling er sendt!"))}catch(I){y(I.message||"Noe gikk galt. Vennligst prv igjen.")}finally{x(!1)}};return o.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm",onClick:e}),o.jsxs("div",{className:"relative w-full max-w-md bg-slate-900 border border-white/10 rounded-[2.5rem] shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-300",children:[o.jsx("div",{className:"bg-indigo-600 h-2 w-full"}),o.jsxs("div",{className:"p-8 space-y-8",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-3xl font-black italic text-white tracking-tighter uppercase",children:c==="LOGIN"?"Velkommen tilbake":c==="REGISTER"?"Opprett Profil":"Glemt Passord"}),o.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-1",children:c==="LOGIN"?"Fortsett din reise i simulation":"Bli en del av historien"})]}),o.jsx("button",{onClick:e,className:"p-2 hover:bg-white/5 rounded-xl transition-colors",children:o.jsx(In,{className:"text-slate-500",size:20})})]}),o.jsxs("form",{onSubmit:A,className:"space-y-4",children:[c==="REGISTER"&&o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Vises som (Unikt navn)"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(wn,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"text",required:!0,placeholder:"Ditt kallenavn...",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:b,onChange:R=>p(R.target.value)}),o.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:T?o.jsx(uT,{size:16,className:"text-slate-500 animate-spin"}):N===!0?o.jsx(Vb,{size:16,className:"text-emerald-500"}):N===!1?o.jsx(Db,{size:16,className:"text-rose-500"}):null})]}),N===!1&&o.jsx("p",{className:"text-[10px] text-rose-400 font-bold px-1 italic",children:"Dette navnet er dessverre opptatt."})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"E-post"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(EQ,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"email",required:!0,placeholder:"navn@epost.no",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:d,onChange:R=>h(R.target.value)})]})]}),c!=="FORGOT"&&o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Passord"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(Bo,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"password",required:!0,placeholder:"Min. 8 tegn...",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:f,onChange:R=>m(R.target.value)})]})]}),(g||l)&&o.jsxs("div",{className:"bg-rose-500/10 border border-rose-500/20 p-4 rounded-2xl flex items-center gap-3 text-rose-400",children:[o.jsx(Db,{size:18}),o.jsx("p",{className:"text-xs font-bold",children:g||l})]}),w&&o.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 p-4 rounded-2xl flex items-center gap-3 text-emerald-400",children:[o.jsx(Vb,{size:18}),o.jsx("p",{className:"text-xs font-bold",children:w})]}),o.jsxs("div",{className:"pt-4 space-y-4",children:[o.jsx("button",{type:"submit",disabled:v||c==="REGISTER"&&N===!1,className:"w-full bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-800 disabled:text-slate-500 text-white rounded-2xl py-4 font-black uppercase tracking-widest text-sm flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-indigo-600/20",children:v?o.jsx(uT,{className:"animate-spin",size:20}):o.jsxs(o.Fragment,{children:[c==="LOGIN"?"Logg Inn":c==="REGISTER"?"Opprett Profil":"Send E-post",o.jsx(aa,{size:18})]})}),o.jsx("div",{className:"flex items-center justify-between px-2",children:c==="LOGIN"?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>u("REGISTER"),className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest hover:text-white transition-colors",children:"Ny her? Opprett profil"}),o.jsx("button",{type:"button",onClick:()=>u("FORGOT"),className:"text-[10px] font-medium text-slate-500 hover:text-white transition-colors",children:"Glemt passord?"})]}):o.jsx("button",{type:"button",onClick:()=>u("LOGIN"),className:"w-full text-center text-[10px] font-black text-indigo-400 uppercase tracking-widest hover:text-white transition-colors",children:"Har du allerede profil? Logg inn"})})]})]})]})]})]})},qte=()=>{const{user:t,isAnonymous:e,logout:s}=Lo(),[n,i]=S.useState(!1),[r,a]=S.useState("LOGIN"),l=vc(),{startPlaylist:c,resume:u}=j_(),[d,h]=S.useState(!1),[f,m]=S.useState(0);S.useEffect(()=>{const v=q(K,"simulation_server_metadata"),x=Qe(v,g=>{if(g.exists()){const y=g.val(),w=Object.values(y).reduce((k,N)=>k+(N.playerCount||0),0);m(w)}});return()=>x()},[]),S.useEffect(()=>{c()},[c]);const b=()=>{d||(u(),c(),h(!0))},p=v=>{b(),a(v),i(!0)};return o.jsxs("div",{onClick:b,className:"min-h-screen relative font-sans text-slate-200 overflow-x-hidden",children:[o.jsxs("div",{className:"absolute inset-0 z-0",children:[o.jsx("img",{src:"/Simulation_StandAlone_Pro/makthjulet_landingpage_bakgrunn.png",alt:"Background",className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/60 to-transparent"}),o.jsx("div",{className:"absolute inset-0 bg-black/40"})]}),o.jsxs("div",{className:"relative z-10 flex flex-col min-h-screen",children:[o.jsxs("header",{className:"w-full px-8 py-8 flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(qi,{className:"text-white/90",size:24,strokeWidth:1.5}),o.jsx("span",{className:"text-sm font-black tracking-[0.2em] text-white/90 uppercase",children:"Simuleringshallen"})]}),o.jsx("div",{className:"flex items-center gap-6 text-xs font-bold tracking-widest uppercase",children:t&&!e?o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("button",{onClick:()=>l("/profile"),className:"group flex items-center gap-2 text-white/70 hover:text-white transition-colors",children:[o.jsx(wn,{size:14,className:"group-hover:text-indigo-400 transition-colors"}),o.jsxs("span",{children:["Velkommen, ",o.jsx("span",{className:"text-white group-hover:underline decoration-indigo-500/50 underline-offset-4 transition-all",children:t.displayName||"Eventyrer"})]})]}),o.jsx("div",{className:"h-4 w-px bg-white/10"}),o.jsx("button",{onClick:()=>s(),className:"hover:text-rose-400 text-white/40 transition-colors",children:"Logg ut"})]}):o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsx("button",{onClick:()=>p("LOGIN"),className:"hover:text-white transition-colors text-white/70",children:"Logg Inn"}),o.jsx("button",{onClick:()=>p("REGISTER"),className:"px-5 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-full transition-all text-white",children:"Bli Med"})]})})]}),o.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center w-full max-w-7xl mx-auto px-6 py-12",children:[o.jsxs("div",{className:"text-center mb-16 space-y-6 max-w-3xl",children:[o.jsx("h1",{className:"text-7xl md:text-9xl font-black text-white tracking-tighter leading-none drop-shadow-2xl",children:"MAKTHJULET"}),o.jsx("p",{className:"text-lg md:text-xl text-white/80 font-light tracking-wide max-w-xl mx-auto leading-relaxed",children:"Skjebnen er ikke skrevet. Den smis i ilden av ambisjoner."})]}),o.jsxs("div",{className:"w-full max-w-5xl bg-black/40 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] p-4 md:p-10 shadow-2xl relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://grainy-gradients.vercel.app/noise.svg')] bg-repeat"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"mb-8 flex items-center justify-between border-b border-white/5 pb-6",children:[o.jsxs("h3",{className:"text-[10px] font-black tracking-[0.3em] text-white/40 uppercase flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]"}),"Aktive Verdener"]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex -space-x-1.5 items-center mr-1",children:[[...Array(Math.min(3,f))].map((v,x)=>o.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-slate-900 bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.3)]"},x)),f>3&&o.jsxs("div",{className:"w-5 h-5 rounded-full border-2 border-slate-900 bg-slate-800 flex items-center justify-center text-[8px] font-black text-white/60",children:["+",f-3]}),f===0&&o.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-slate-800 bg-slate-900/50"})]}),o.jsxs("span",{className:"text-[10px] text-white/40 uppercase font-black tracking-widest",children:[f," Live N"]})]})]}),o.jsx("div",{className:"max-h-[500px] overflow-y-auto custom-scrollbar pr-2",children:o.jsx(Hte,{})})]})]})]}),o.jsxs("footer",{className:"w-full p-8 relative flex justify-center text-[10px] uppercase tracking-[0.2em] text-white/30",children:[o.jsx("span",{children:" 2026 Eiriksbok  Maktens Pris"}),o.jsx("button",{onClick:()=>l("/host"),className:"absolute right-8 bottom-8 text-white/10 hover:text-white/50 transition-colors duration-500 font-bold",children:"Admin"})]})]}),o.jsx(zte,{isOpen:n,onClose:()=>i(!1),initialMode:r})]})},Kte=()=>o.jsx(T3,{basename:"/Simulation_StandAlone_Pro/",children:o.jsx(A3,{children:o.jsx(n9,{children:o.jsx(Wz,{children:o.jsx("div",{className:"min-h-screen bg-slate-950 text-white",children:o.jsxs(w3,{children:[o.jsx(nu,{path:"/",element:o.jsx(qte,{})}),o.jsx(nu,{path:"/host",element:o.jsx(QZ,{})}),o.jsx(nu,{path:"/play/:pin/*",element:o.jsx(Yz,{children:o.jsx(Ute,{})})}),o.jsx(nu,{path:"*",element:o.jsx(y3,{to:"/",replace:!0})})]})})})})})});class Wte extends Ne.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Uncaught error:",e,s)}render(){var e,s,n,i,r,a,l;if(this.state.hasError){const c=((e=this.state.error)==null?void 0:e.name)==="TypeError"&&(((n=(s=this.state.error)==null?void 0:s.message)==null?void 0:n.toLowerCase().includes("failed to fetch dynamically imported module"))||((r=(i=this.state.error)==null?void 0:i.message)==null?void 0:r.toLowerCase().includes("loading chunk"))||((l=(a=this.state.error)==null?void 0:a.message)==null?void 0:l.toLowerCase().includes("dynamic import")));return o.jsx("div",{style:{padding:"2rem",backgroundColor:"#0f172a",color:"#f8fafc",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"Inter, system-ui, sans-serif",textAlign:"center"},children:o.jsxs("div",{style:{maxWidth:"600px",padding:"3rem",backgroundColor:"#1e293b",borderRadius:"2rem",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},children:[o.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),o.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",marginBottom:"1rem",color:"#ef4444"},children:c?"Applikasjonen m oppdateres":"Noe gikk galt"}),o.jsx("p",{style:{color:"#94a3b8",marginBottom:"2rem",fontSize:"1.1rem"},children:c?"En ny versjon av simulatoren er tilgjengelig. Trykk p knappen under for  laste inn p nytt.":"Det oppstod en uventet feil i simuleringshallen."}),o.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"1rem 2rem",backgroundColor:"#4f46e5",color:"white",border:"none",borderRadius:"1rem",fontWeight:"bold",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 10px 15px -3px rgba(79, 70, 229, 0.4)"},onMouseOver:u=>u.currentTarget.style.backgroundColor="#4338ca",onMouseOut:u=>u.currentTarget.style.backgroundColor="#4f46e5",children:"Oppdater applikasjonen"}),o.jsxs("details",{style:{marginTop:"2rem",textAlign:"left"},children:[o.jsx("summary",{style:{cursor:"pointer",color:"#64748b",fontSize:"0.8rem"},children:"Teknisk feilinfo"}),o.jsx("pre",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#0f172a",borderRadius:"0.5rem",fontSize:"0.75rem",overflowX:"auto",color:"#ef4444",whiteSpace:"pre-wrap"},children:this.state.error&&this.state.error.toString()+`

`+this.state.error.stack})]})]})})}return this.props.children}}CD.createRoot(document.getElementById("root")).render(o.jsx(Ne.StrictMode,{children:o.jsx(Wte,{children:o.jsx(Kte,{})})}));export{ic as $,Mc as A,Ase as B,An as C,Cse as D,jse as E,uO as F,re as G,Hm as H,a0 as I,gQ as J,lO as K,SQ as L,vd as M,ZQ as N,h1 as O,te as P,Jz as Q,ya as R,Wn as S,zm as T,wn as U,Us as V,Bo as W,To as X,qN as Y,cc as Z,wa as _,ze as a,_t as a0,xt as a1,kee as a2,Sse as a3,pO as a4,Ki as a5,o0 as a6,WQ as a7,qi as a8,VX as a9,hh as aa,jte as ab,Ke as ac,oO as ad,qb as ae,tO as af,In as ag,Pn as ah,aa as ai,Ye as aj,cb as ak,iO as al,So as am,bf as b,Ne as c,va as d,FA as e,j_ as f,Cte as g,S as h,NJ as i,o as j,MQ as k,QQ as l,Mte as m,TJ as n,Wi as o,Dt as p,Z as q,q as r,K as s,oc as t,ae as u,b1 as v,Eee as w,Ese as x,rQ as y,Tse as z};
