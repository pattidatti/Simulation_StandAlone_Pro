const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SimulationMarket-CjfDNZC7.js","assets/Badge-_uOMlRbW.js","assets/SimulationVault-mKaxFVlF.js","assets/timer-B4nLXo_R.js","assets/SimulationSkills-DDe2P2zd.js","assets/GameCard-D9x3eLMM.js","assets/SimulationProduction-CFP6wN5Z.js","assets/RecipeCard-BlS4xgws.js","assets/SimulationHierarchy-TezynnSK.js","assets/PoliticalHub-CHcH0fma.js","assets/ApothecaryWindow-DflYiXs7.js"])))=>i.map(i=>d[i]);
var NO=Object.defineProperty;var SO=(t,e,s)=>e in t?NO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Ie=(t,e,s)=>SO(t,typeof e!="symbol"?e+"":e,s);function TO(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(n,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();function wT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var kT={exports:{}},Km={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EO=Symbol.for("react.transitional.element"),AO=Symbol.for("react.fragment");function NT(t,e,s){var n=null;if(s!==void 0&&(n=""+s),e.key!==void 0&&(n=""+e.key),"key"in e){s={};for(var i in e)i!=="key"&&(s[i]=e[i])}else s=e;return e=s.ref,{$$typeof:EO,type:t,key:n,ref:e!==void 0?e:null,props:s}}Km.Fragment=AO;Km.jsx=NT;Km.jsxs=NT;kT.exports=Km;var o=kT.exports,ST={exports:{}},ye={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vb=Symbol.for("react.transitional.element"),jO=Symbol.for("react.portal"),CO=Symbol.for("react.fragment"),RO=Symbol.for("react.strict_mode"),IO=Symbol.for("react.profiler"),OO=Symbol.for("react.consumer"),MO=Symbol.for("react.context"),DO=Symbol.for("react.forward_ref"),LO=Symbol.for("react.suspense"),PO=Symbol.for("react.memo"),TT=Symbol.for("react.lazy"),VO=Symbol.for("react.activity"),b1=Symbol.iterator;function BO(t){return t===null||typeof t!="object"?null:(t=b1&&t[b1]||t["@@iterator"],typeof t=="function"?t:null)}var ET={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},AT=Object.assign,jT={};function sc(t,e,s){this.props=t,this.context=e,this.refs=jT,this.updater=s||ET}sc.prototype.isReactComponent={};sc.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sc.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function CT(){}CT.prototype=sc.prototype;function Bb(t,e,s){this.props=t,this.context=e,this.refs=jT,this.updater=s||ET}var Fb=Bb.prototype=new CT;Fb.constructor=Bb;AT(Fb,sc.prototype);Fb.isPureReactComponent=!0;var v1=Array.isArray;function Eg(){}var mt={H:null,A:null,T:null,S:null},RT=Object.prototype.hasOwnProperty;function Ub(t,e,s){var n=s.ref;return{$$typeof:Vb,type:t,key:e,ref:n!==void 0?n:null,props:s}}function FO(t,e){return Ub(t.type,e,t.props)}function $b(t){return typeof t=="object"&&t!==null&&t.$$typeof===Vb}function UO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(s){return e[s]})}var y1=/\/+/g;function o0(t,e){return typeof t=="object"&&t!==null&&t.key!=null?UO(""+t.key):e.toString(36)}function $O(t){switch(t.status){case"fulfilled":return t.value;case"rejected":throw t.reason;default:switch(typeof t.status=="string"?t.then(Eg,Eg):(t.status="pending",t.then(function(e){t.status==="pending"&&(t.status="fulfilled",t.value=e)},function(e){t.status==="pending"&&(t.status="rejected",t.reason=e)})),t.status){case"fulfilled":return t.value;case"rejected":throw t.reason}}throw t}function Fo(t,e,s,n,i){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(r){case"bigint":case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Vb:case jO:a=!0;break;case TT:return a=t._init,Fo(a(t._payload),e,s,n,i)}}if(a)return i=i(t),a=n===""?"."+o0(t,0):n,v1(i)?(s="",a!=null&&(s=a.replace(y1,"$&/")+"/"),Fo(i,e,s,"",function(u){return u})):i!=null&&($b(i)&&(i=FO(i,s+(i.key==null||t&&t.key===i.key?"":(""+i.key).replace(y1,"$&/")+"/")+a)),e.push(i)),1;a=0;var l=n===""?".":n+":";if(v1(t))for(var c=0;c<t.length;c++)n=t[c],r=l+o0(n,c),a+=Fo(n,e,s,r,i);else if(c=BO(t),typeof c=="function")for(t=c.call(t),c=0;!(n=t.next()).done;)n=n.value,r=l+o0(n,c++),a+=Fo(n,e,s,r,i);else if(r==="object"){if(typeof t.then=="function")return Fo($O(t),e,s,n,i);throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return a}function fh(t,e,s){if(t==null)return t;var n=[],i=0;return Fo(t,n,"","",function(r){return e.call(s,r,i++)}),n}function HO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(s){(t._status===0||t._status===-1)&&(t._status=1,t._result=s)},function(s){(t._status===0||t._status===-1)&&(t._status=2,t._result=s)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var _1=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},GO={map:fh,forEach:function(t,e,s){fh(t,function(){e.apply(this,arguments)},s)},count:function(t){var e=0;return fh(t,function(){e++}),e},toArray:function(t){return fh(t,function(e){return e})||[]},only:function(t){if(!$b(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ye.Activity=VO;ye.Children=GO;ye.Component=sc;ye.Fragment=CO;ye.Profiler=IO;ye.PureComponent=Bb;ye.StrictMode=RO;ye.Suspense=LO;ye.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=mt;ye.__COMPILER_RUNTIME={__proto__:null,c:function(t){return mt.H.useMemoCache(t)}};ye.cache=function(t){return function(){return t.apply(null,arguments)}};ye.cacheSignal=function(){return null};ye.cloneElement=function(t,e,s){if(t==null)throw Error("The argument must be a React element, but you passed "+t+".");var n=AT({},t.props),i=t.key;if(e!=null)for(r in e.key!==void 0&&(i=""+e.key),e)!RT.call(e,r)||r==="key"||r==="__self"||r==="__source"||r==="ref"&&e.ref===void 0||(n[r]=e[r]);var r=arguments.length-2;if(r===1)n.children=s;else if(1<r){for(var a=Array(r),l=0;l<r;l++)a[l]=arguments[l+2];n.children=a}return Ub(t.type,i,n)};ye.createContext=function(t){return t={$$typeof:MO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null},t.Provider=t,t.Consumer={$$typeof:OO,_context:t},t};ye.createElement=function(t,e,s){var n,i={},r=null;if(e!=null)for(n in e.key!==void 0&&(r=""+e.key),e)RT.call(e,n)&&n!=="key"&&n!=="__self"&&n!=="__source"&&(i[n]=e[n]);var a=arguments.length-2;if(a===1)i.children=s;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)i[n]===void 0&&(i[n]=a[n]);return Ub(t,r,i)};ye.createRef=function(){return{current:null}};ye.forwardRef=function(t){return{$$typeof:DO,render:t}};ye.isValidElement=$b;ye.lazy=function(t){return{$$typeof:TT,_payload:{_status:-1,_result:t},_init:HO}};ye.memo=function(t,e){return{$$typeof:PO,type:t,compare:e===void 0?null:e}};ye.startTransition=function(t){var e=mt.T,s={};mt.T=s;try{var n=t(),i=mt.S;i!==null&&i(s,n),typeof n=="object"&&n!==null&&typeof n.then=="function"&&n.then(Eg,_1)}catch(r){_1(r)}finally{e!==null&&s.types!==null&&(e.types=s.types),mt.T=e}};ye.unstable_useCacheRefresh=function(){return mt.H.useCacheRefresh()};ye.use=function(t){return mt.H.use(t)};ye.useActionState=function(t,e,s){return mt.H.useActionState(t,e,s)};ye.useCallback=function(t,e){return mt.H.useCallback(t,e)};ye.useContext=function(t){return mt.H.useContext(t)};ye.useDebugValue=function(){};ye.useDeferredValue=function(t,e){return mt.H.useDeferredValue(t,e)};ye.useEffect=function(t,e){return mt.H.useEffect(t,e)};ye.useEffectEvent=function(t){return mt.H.useEffectEvent(t)};ye.useId=function(){return mt.H.useId()};ye.useImperativeHandle=function(t,e,s){return mt.H.useImperativeHandle(t,e,s)};ye.useInsertionEffect=function(t,e){return mt.H.useInsertionEffect(t,e)};ye.useLayoutEffect=function(t,e){return mt.H.useLayoutEffect(t,e)};ye.useMemo=function(t,e){return mt.H.useMemo(t,e)};ye.useOptimistic=function(t,e){return mt.H.useOptimistic(t,e)};ye.useReducer=function(t,e,s){return mt.H.useReducer(t,e,s)};ye.useRef=function(t){return mt.H.useRef(t)};ye.useState=function(t){return mt.H.useState(t)};ye.useSyncExternalStore=function(t,e,s){return mt.H.useSyncExternalStore(t,e,s)};ye.useTransition=function(){return mt.H.useTransition()};ye.version="19.2.3";ST.exports=ye;var N=ST.exports;const Se=wT(N),zO=TO({__proto__:null,default:Se},[N]);var IT={exports:{}},Wm={},OT={exports:{}},MT={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(M,D){var I=M.length;M.push(D);e:for(;0<I;){var F=I-1>>>1,U=M[F];if(0<i(U,D))M[F]=D,M[I]=U,I=F;else break e}}function s(M){return M.length===0?null:M[0]}function n(M){if(M.length===0)return null;var D=M[0],I=M.pop();if(I!==D){M[0]=I;e:for(var F=0,U=M.length,R=U>>>1;F<R;){var C=2*(F+1)-1,$=M[C],V=C+1,P=M[V];if(0>i($,I))V<U&&0>i(P,$)?(M[F]=P,M[V]=I,F=V):(M[F]=$,M[C]=I,F=C);else if(V<U&&0>i(P,I))M[F]=P,M[V]=I,F=V;else break e}}return D}function i(M,D){var I=M.sortIndex-D.sortIndex;return I!==0?I:M.id-D.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,f=3,m=!1,b=!1,x=!1,v=!1,g=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;function k(M){for(var D=s(u);D!==null;){if(D.callback===null)n(u);else if(D.startTime<=M)n(u),D.sortIndex=D.expirationTime,e(c,D);else break;D=s(u)}}function w(M){if(x=!1,k(M),!b)if(s(c)!==null)b=!0,S||(S=!0,O());else{var D=s(u);D!==null&&L(w,D.startTime-M)}}var S=!1,_=-1,T=5,E=-1;function A(){return v?!0:!(t.unstable_now()-E<T)}function j(){if(v=!1,S){var M=t.unstable_now();E=M;var D=!0;try{e:{b=!1,x&&(x=!1,p(_),_=-1),m=!0;var I=f;try{t:{for(k(M),h=s(c);h!==null&&!(h.expirationTime>M&&A());){var F=h.callback;if(typeof F=="function"){h.callback=null,f=h.priorityLevel;var U=F(h.expirationTime<=M);if(M=t.unstable_now(),typeof U=="function"){h.callback=U,k(M),D=!0;break t}h===s(c)&&n(c),k(M)}else n(c);h=s(c)}if(h!==null)D=!0;else{var R=s(u);R!==null&&L(w,R.startTime-M),D=!1}}break e}finally{h=null,f=I,m=!1}D=void 0}}finally{D?O():S=!1}}}var O;if(typeof y=="function")O=function(){y(j)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,G=H.port2;H.port1.onmessage=j,O=function(){G.postMessage(null)}}else O=function(){g(j,0)};function L(M,D){_=g(function(){M(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(M){M.callback=null},t.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<M?Math.floor(1e3/M):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_next=function(M){switch(f){case 1:case 2:case 3:var D=3;break;default:D=f}var I=f;f=D;try{return M()}finally{f=I}},t.unstable_requestPaint=function(){v=!0},t.unstable_runWithPriority=function(M,D){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var I=f;f=M;try{return D()}finally{f=I}},t.unstable_scheduleCallback=function(M,D,I){var F=t.unstable_now();switch(typeof I=="object"&&I!==null?(I=I.delay,I=typeof I=="number"&&0<I?F+I:F):I=F,M){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=I+U,M={id:d++,callback:D,priorityLevel:M,startTime:I,expirationTime:U,sortIndex:-1},I>F?(M.sortIndex=I,e(u,M),s(c)===null&&M===s(u)&&(x?(p(_),_=-1):x=!0,L(w,I-F))):(M.sortIndex=U,e(c,M),b||m||(b=!0,S||(S=!0,O()))),M},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(M){var D=f;return function(){var I=f;f=D;try{return M.apply(this,arguments)}finally{f=I}}}})(MT);OT.exports=MT;var qO=OT.exports,DT={exports:{}},As={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KO=N;function LT(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function pr(){}var ws={d:{f:pr,r:function(){throw Error(LT(522))},D:pr,C:pr,L:pr,m:pr,X:pr,S:pr,M:pr},p:0,findDOMNode:null},WO=Symbol.for("react.portal");function YO(t,e,s){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:WO,key:n==null?null:""+n,children:t,containerInfo:e,implementation:s}}var su=KO.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Ym(t,e){if(t==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}As.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ws;As.createPortal=function(t,e){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(LT(299));return YO(t,e,null,s)};As.flushSync=function(t){var e=su.T,s=ws.p;try{if(su.T=null,ws.p=2,t)return t()}finally{su.T=e,ws.p=s,ws.d.f()}};As.preconnect=function(t,e){typeof t=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,ws.d.C(t,e))};As.prefetchDNS=function(t){typeof t=="string"&&ws.d.D(t)};As.preinit=function(t,e){if(typeof t=="string"&&e&&typeof e.as=="string"){var s=e.as,n=Ym(s,e.crossOrigin),i=typeof e.integrity=="string"?e.integrity:void 0,r=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;s==="style"?ws.d.S(t,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:n,integrity:i,fetchPriority:r}):s==="script"&&ws.d.X(t,{crossOrigin:n,integrity:i,fetchPriority:r,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};As.preinitModule=function(t,e){if(typeof t=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var s=Ym(e.as,e.crossOrigin);ws.d.M(t,{crossOrigin:s,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&ws.d.M(t)};As.preload=function(t,e){if(typeof t=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var s=e.as,n=Ym(s,e.crossOrigin);ws.d.L(t,s,{crossOrigin:n,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};As.preloadModule=function(t,e){if(typeof t=="string")if(e){var s=Ym(e.as,e.crossOrigin);ws.d.m(t,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:s,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else ws.d.m(t)};As.requestFormReset=function(t){ws.d.r(t)};As.unstable_batchedUpdates=function(t,e){return t(e)};As.useFormState=function(t,e,s){return su.H.useFormState(t,e,s)};As.useFormStatus=function(){return su.H.useHostTransitionStatus()};As.version="19.2.3";function PT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PT)}catch(t){console.error(t)}}PT(),DT.exports=As;var VT=DT.exports;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jt=qO,BT=N,XO=VT;function X(t){var e="https://react.dev/errors/"+t;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)e+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function FT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function vd(t){var e=t,s=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(s=e.return),t=e.return;while(t)}return e.tag===3?s:null}function UT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function $T(t){if(t.tag===31){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function w1(t){if(vd(t)!==t)throw Error(X(188))}function QO(t){var e=t.alternate;if(!e){if(e=vd(t),e===null)throw Error(X(188));return e!==t?null:t}for(var s=t,n=e;;){var i=s.return;if(i===null)break;var r=i.alternate;if(r===null){if(n=i.return,n!==null){s=n;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===s)return w1(i),t;if(r===n)return w1(i),e;r=r.sibling}throw Error(X(188))}if(s.return!==n.return)s=i,n=r;else{for(var a=!1,l=i.child;l;){if(l===s){a=!0,s=i,n=r;break}if(l===n){a=!0,n=i,s=r;break}l=l.sibling}if(!a){for(l=r.child;l;){if(l===s){a=!0,s=r,n=i;break}if(l===n){a=!0,n=r,s=i;break}l=l.sibling}if(!a)throw Error(X(189))}}if(s.alternate!==n)throw Error(X(190))}if(s.tag!==3)throw Error(X(188));return s.stateNode.current===s?t:e}function HT(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t;for(t=t.child;t!==null;){if(e=HT(t),e!==null)return e;t=t.sibling}return null}var gt=Object.assign,JO=Symbol.for("react.element"),mh=Symbol.for("react.transitional.element"),Kc=Symbol.for("react.portal"),Go=Symbol.for("react.fragment"),GT=Symbol.for("react.strict_mode"),Ag=Symbol.for("react.profiler"),zT=Symbol.for("react.consumer"),Ri=Symbol.for("react.context"),Hb=Symbol.for("react.forward_ref"),jg=Symbol.for("react.suspense"),Cg=Symbol.for("react.suspense_list"),Gb=Symbol.for("react.memo"),yr=Symbol.for("react.lazy"),Rg=Symbol.for("react.activity"),ZO=Symbol.for("react.memo_cache_sentinel"),k1=Symbol.iterator;function Dc(t){return t===null||typeof t!="object"?null:(t=k1&&t[k1]||t["@@iterator"],typeof t=="function"?t:null)}var eM=Symbol.for("react.client.reference");function Ig(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===eM?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Go:return"Fragment";case Ag:return"Profiler";case GT:return"StrictMode";case jg:return"Suspense";case Cg:return"SuspenseList";case Rg:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case Kc:return"Portal";case Ri:return t.displayName||"Context";case zT:return(t._context.displayName||"Context")+".Consumer";case Hb:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Gb:return e=t.displayName||null,e!==null?e:Ig(t.type)||"Memo";case yr:e=t._payload,t=t._init;try{return Ig(t(e))}catch{}}return null}var Wc=Array.isArray,be=BT.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$e=XO.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Wa={pending:!1,data:null,method:null,action:null},Og=[],zo=-1;function fi(t){return{current:t}}function as(t){0>zo||(t.current=Og[zo],Og[zo]=null,zo--)}function ut(t,e){zo++,Og[zo]=t.current,t.current=e}var ii=fi(null),ju=fi(null),Fr=fi(null),bf=fi(null);function vf(t,e){switch(ut(Fr,e),ut(ju,t),ut(ii,null),e.nodeType){case 9:case 11:t=(t=e.documentElement)&&(t=t.namespaceURI)?jw(t):0;break;default:if(t=e.tagName,e=e.namespaceURI)e=jw(e),t=dA(e,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}as(ii),ut(ii,t)}function Cl(){as(ii),as(ju),as(Fr)}function Mg(t){t.memoizedState!==null&&ut(bf,t);var e=ii.current,s=dA(e,t.type);e!==s&&(ut(ju,t),ut(ii,s))}function yf(t){ju.current===t&&(as(ii),as(ju)),bf.current===t&&(as(bf),Fu._currentValue=Wa)}var l0,N1;function Ma(t){if(l0===void 0)try{throw Error()}catch(s){var e=s.stack.trim().match(/\n( *(at )?)/);l0=e&&e[1]||"",N1=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+l0+t+N1}var c0=!1;function u0(t,e){if(!t||c0)return"";c0=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(e){var h=function(){throw Error()};if(Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(m){var f=m}Reflect.construct(t,[],h)}else{try{h.call()}catch(m){f=m}t.call(h.prototype)}}else{try{throw Error()}catch(m){f=m}(h=t())&&typeof h.catch=="function"&&h.catch(function(){})}}catch(m){if(m&&f&&typeof m.stack=="string")return[m.stack,f.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var r=n.DetermineComponentFrameRoot(),a=r[0],l=r[1];if(a&&l){var c=a.split(`
`),u=l.split(`
`);for(i=n=0;n<c.length&&!c[n].includes("DetermineComponentFrameRoot");)n++;for(;i<u.length&&!u[i].includes("DetermineComponentFrameRoot");)i++;if(n===c.length||i===u.length)for(n=c.length-1,i=u.length-1;1<=n&&0<=i&&c[n]!==u[i];)i--;for(;1<=n&&0<=i;n--,i--)if(c[n]!==u[i]){if(n!==1||i!==1)do if(n--,i--,0>i||c[n]!==u[i]){var d=`
`+c[n].replace(" at new "," at ");return t.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",t.displayName)),d}while(1<=n&&0<=i);break}}}finally{c0=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?Ma(s):""}function tM(t,e){switch(t.tag){case 26:case 27:case 5:return Ma(t.type);case 16:return Ma("Lazy");case 13:return t.child!==e&&e!==null?Ma("Suspense Fallback"):Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 15:return u0(t.type,!1);case 11:return u0(t.type.render,!1);case 1:return u0(t.type,!0);case 31:return Ma("Activity");default:return""}}function S1(t){try{var e="",s=null;do e+=tM(t,s),s=t,t=t.return;while(t);return e}catch(n){return`
Error generating stack: `+n.message+`
`+n.stack}}var Dg=Object.prototype.hasOwnProperty,zb=Jt.unstable_scheduleCallback,d0=Jt.unstable_cancelCallback,sM=Jt.unstable_shouldYield,nM=Jt.unstable_requestPaint,tn=Jt.unstable_now,iM=Jt.unstable_getCurrentPriorityLevel,qT=Jt.unstable_ImmediatePriority,KT=Jt.unstable_UserBlockingPriority,_f=Jt.unstable_NormalPriority,rM=Jt.unstable_LowPriority,WT=Jt.unstable_IdlePriority,aM=Jt.log,oM=Jt.unstable_setDisableYieldValue,yd=null,sn=null;function Rr(t){if(typeof aM=="function"&&oM(t),sn&&typeof sn.setStrictMode=="function")try{sn.setStrictMode(yd,t)}catch{}}var nn=Math.clz32?Math.clz32:uM,lM=Math.log,cM=Math.LN2;function uM(t){return t>>>=0,t===0?32:31-(lM(t)/cM|0)|0}var ph=256,gh=262144,xh=4194304;function Da(t){var e=t&42;if(e!==0)return e;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Xm(t,e,s){var n=t.pendingLanes;if(n===0)return 0;var i=0,r=t.suspendedLanes,a=t.pingedLanes;t=t.warmLanes;var l=n&134217727;return l!==0?(n=l&~r,n!==0?i=Da(n):(a&=l,a!==0?i=Da(a):s||(s=l&~t,s!==0&&(i=Da(s))))):(l=n&~r,l!==0?i=Da(l):a!==0?i=Da(a):s||(s=n&~t,s!==0&&(i=Da(s)))),i===0?0:e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===32&&(s&4194048)!==0)?e:i}function _d(t,e){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&e)===0}function dM(t,e){switch(t){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function YT(){var t=xh;return xh<<=1,!(xh&62914560)&&(xh=4194304),t}function h0(t){for(var e=[],s=0;31>s;s++)e.push(t);return e}function wd(t,e){t.pendingLanes|=e,e!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function hM(t,e,s,n,i,r){var a=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var l=t.entanglements,c=t.expirationTimes,u=t.hiddenUpdates;for(s=a&~s;0<s;){var d=31-nn(s),h=1<<d;l[d]=0,c[d]=-1;var f=u[d];if(f!==null)for(u[d]=null,d=0;d<f.length;d++){var m=f[d];m!==null&&(m.lane&=-536870913)}s&=~h}n!==0&&XT(t,n,0),r!==0&&i===0&&t.tag!==0&&(t.suspendedLanes|=r&~(a&~e))}function XT(t,e,s){t.pendingLanes|=e,t.suspendedLanes&=~e;var n=31-nn(e);t.entangledLanes|=e,t.entanglements[n]=t.entanglements[n]|1073741824|s&261930}function QT(t,e){var s=t.entangledLanes|=e;for(t=t.entanglements;s;){var n=31-nn(s),i=1<<n;i&e|t[n]&e&&(t[n]|=e),s&=~i}}function JT(t,e){var s=e&-e;return s=s&42?1:qb(s),s&(t.suspendedLanes|e)?0:s}function qb(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Kb(t){return t&=-t,2<t?8<t?t&134217727?32:268435456:8:2}function ZT(){var t=$e.p;return t!==0?t:(t=window.event,t===void 0?32:wA(t.type))}function T1(t,e){var s=$e.p;try{return $e.p=t,e()}finally{$e.p=s}}var _a=Math.random().toString(36).slice(2),hs="__reactFiber$"+_a,Us="__reactProps$"+_a,nc="__reactContainer$"+_a,Lg="__reactEvents$"+_a,fM="__reactListeners$"+_a,mM="__reactHandles$"+_a,E1="__reactResources$"+_a,kd="__reactMarker$"+_a;function Wb(t){delete t[hs],delete t[Us],delete t[Lg],delete t[fM],delete t[mM]}function qo(t){var e=t[hs];if(e)return e;for(var s=t.parentNode;s;){if(e=s[nc]||s[hs]){if(s=e.alternate,e.child!==null||s!==null&&s.child!==null)for(t=Mw(t);t!==null;){if(s=t[hs])return s;t=Mw(t)}return e}t=s,s=t.parentNode}return null}function ic(t){if(t=t[hs]||t[nc]){var e=t.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return t}return null}function Yc(t){var e=t.tag;if(e===5||e===26||e===27||e===6)return t.stateNode;throw Error(X(33))}function fl(t){var e=t[E1];return e||(e=t[E1]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function is(t){t[kd]=!0}var eE=new Set,tE={};function _o(t,e){Rl(t,e),Rl(t+"Capture",e)}function Rl(t,e){for(tE[t]=e,t=0;t<e.length;t++)eE.add(e[t])}var pM=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),A1={},j1={};function gM(t){return Dg.call(j1,t)?!0:Dg.call(A1,t)?!1:pM.test(t)?j1[t]=!0:(A1[t]=!0,!1)}function Gh(t,e,s){if(gM(e))if(s===null)t.removeAttribute(e);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(e);return;case"boolean":var n=e.toLowerCase().slice(0,5);if(n!=="data-"&&n!=="aria-"){t.removeAttribute(e);return}}t.setAttribute(e,""+s)}}function bh(t,e,s){if(s===null)t.removeAttribute(e);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(e);return}t.setAttribute(e,""+s)}}function _i(t,e,s,n){if(n===null)t.removeAttribute(s);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(e,s,""+n)}}function hn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sE(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function xM(t,e,s){var n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e);if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){s=""+a,r.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(a){s=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Pg(t){if(!t._valueTracker){var e=sE(t)?"checked":"value";t._valueTracker=xM(t,e,""+t[e])}}function nE(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var s=e.getValue(),n="";return t&&(n=sE(t)?t.checked?"true":"false":t.value),t=n,t!==s?(e.setValue(t),!0):!1}function wf(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var bM=/[\n"\\]/g;function pn(t){return t.replace(bM,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Vg(t,e,s,n,i,r,a,l){t.name="",a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"?t.type=a:t.removeAttribute("type"),e!=null?a==="number"?(e===0&&t.value===""||t.value!=e)&&(t.value=""+hn(e)):t.value!==""+hn(e)&&(t.value=""+hn(e)):a!=="submit"&&a!=="reset"||t.removeAttribute("value"),e!=null?Bg(t,a,hn(e)):s!=null?Bg(t,a,hn(s)):n!=null&&t.removeAttribute("value"),i==null&&r!=null&&(t.defaultChecked=!!r),i!=null&&(t.checked=i&&typeof i!="function"&&typeof i!="symbol"),l!=null&&typeof l!="function"&&typeof l!="symbol"&&typeof l!="boolean"?t.name=""+hn(l):t.removeAttribute("name")}function iE(t,e,s,n,i,r,a,l){if(r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(t.type=r),e!=null||s!=null){if(!(r!=="submit"&&r!=="reset"||e!=null)){Pg(t);return}s=s!=null?""+hn(s):"",e=e!=null?""+hn(e):s,l||e===t.value||(t.value=e),t.defaultValue=e}n=n??i,n=typeof n!="function"&&typeof n!="symbol"&&!!n,t.checked=l?t.checked:!!n,t.defaultChecked=!!n,a!=null&&typeof a!="function"&&typeof a!="symbol"&&typeof a!="boolean"&&(t.name=a),Pg(t)}function Bg(t,e,s){e==="number"&&wf(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function ml(t,e,s,n){if(t=t.options,e){e={};for(var i=0;i<s.length;i++)e["$"+s[i]]=!0;for(s=0;s<t.length;s++)i=e.hasOwnProperty("$"+t[s].value),t[s].selected!==i&&(t[s].selected=i),i&&n&&(t[s].defaultSelected=!0)}else{for(s=""+hn(s),e=null,i=0;i<t.length;i++){if(t[i].value===s){t[i].selected=!0,n&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function rE(t,e,s){if(e!=null&&(e=""+hn(e),e!==t.value&&(t.value=e),s==null)){t.defaultValue!==e&&(t.defaultValue=e);return}t.defaultValue=s!=null?""+hn(s):""}function aE(t,e,s,n){if(e==null){if(n!=null){if(s!=null)throw Error(X(92));if(Wc(n)){if(1<n.length)throw Error(X(93));n=n[0]}s=n}s==null&&(s=""),e=s}s=hn(e),t.defaultValue=s,n=t.textContent,n===s&&n!==""&&n!==null&&(t.value=n),Pg(t)}function Il(t,e){if(e){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=e;return}}t.textContent=e}var vM=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function C1(t,e,s){var n=e.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?n?t.setProperty(e,""):e==="float"?t.cssFloat="":t[e]="":n?t.setProperty(e,s):typeof s!="number"||s===0||vM.has(e)?e==="float"?t.cssFloat=s:t[e]=(""+s).trim():t[e]=s+"px"}function oE(t,e,s){if(e!=null&&typeof e!="object")throw Error(X(62));if(t=t.style,s!=null){for(var n in s)!s.hasOwnProperty(n)||e!=null&&e.hasOwnProperty(n)||(n.indexOf("--")===0?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="");for(var i in e)n=e[i],e.hasOwnProperty(i)&&s[i]!==n&&C1(t,i,n)}else for(var r in e)e.hasOwnProperty(r)&&C1(t,r,e[r])}function Yb(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yM=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),_M=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function zh(t){return _M.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function Ii(){}var Fg=null;function Xb(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ko=null,pl=null;function R1(t){var e=ic(t);if(e&&(t=e.stateNode)){var s=t[Us]||null;e:switch(t=e.stateNode,e.type){case"input":if(Vg(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),e=s.name,s.type==="radio"&&e!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+pn(""+e)+'"][type="radio"]'),e=0;e<s.length;e++){var n=s[e];if(n!==t&&n.form===t.form){var i=n[Us]||null;if(!i)throw Error(X(90));Vg(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(e=0;e<s.length;e++)n=s[e],n.form===t.form&&nE(n)}break e;case"textarea":rE(t,s.value,s.defaultValue);break e;case"select":e=s.value,e!=null&&ml(t,!!s.multiple,e,!1)}}}var f0=!1;function lE(t,e,s){if(f0)return t(e,s);f0=!0;try{var n=t(e);return n}finally{if(f0=!1,(Ko!==null||pl!==null)&&(lp(),Ko&&(e=Ko,t=pl,pl=Ko=null,R1(e),t)))for(e=0;e<t.length;e++)R1(t[e])}}function Cu(t,e){var s=t.stateNode;if(s===null)return null;var n=s[Us]||null;if(n===null)return null;s=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(X(231,e,typeof s));return s}var qi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ug=!1;if(qi)try{var Lc={};Object.defineProperty(Lc,"passive",{get:function(){Ug=!0}}),window.addEventListener("test",Lc,Lc),window.removeEventListener("test",Lc,Lc)}catch{Ug=!1}var Ir=null,Qb=null,qh=null;function cE(){if(qh)return qh;var t,e=Qb,s=e.length,n,i="value"in Ir?Ir.value:Ir.textContent,r=i.length;for(t=0;t<s&&e[t]===i[t];t++);var a=s-t;for(n=1;n<=a&&e[s-n]===i[r-n];n++);return qh=i.slice(t,1<n?1-n:void 0)}function Kh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function vh(){return!0}function I1(){return!1}function Gs(t){function e(s,n,i,r,a){this._reactName=s,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(s=t[l],this[l]=s?s(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?vh:I1,this.isPropagationStopped=I1,this}return gt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=vh)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=vh)},persist:function(){},isPersistent:vh}),e}var wo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qm=Gs(wo),Nd=gt({},wo,{view:0,detail:0}),wM=Gs(Nd),m0,p0,Pc,Jm=gt({},Nd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Pc&&(Pc&&t.type==="mousemove"?(m0=t.screenX-Pc.screenX,p0=t.screenY-Pc.screenY):p0=m0=0,Pc=t),m0)},movementY:function(t){return"movementY"in t?t.movementY:p0}}),O1=Gs(Jm),kM=gt({},Jm,{dataTransfer:0}),NM=Gs(kM),SM=gt({},Nd,{relatedTarget:0}),g0=Gs(SM),TM=gt({},wo,{animationName:0,elapsedTime:0,pseudoElement:0}),EM=Gs(TM),AM=gt({},wo,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),jM=Gs(AM),CM=gt({},wo,{data:0}),M1=Gs(CM),RM={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IM={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},OM={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MM(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=OM[t])?!!e[t]:!1}function Jb(){return MM}var DM=gt({},Nd,{key:function(t){if(t.key){var e=RM[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Kh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?IM[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jb,charCode:function(t){return t.type==="keypress"?Kh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Kh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),LM=Gs(DM),PM=gt({},Jm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),D1=Gs(PM),VM=gt({},Nd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jb}),BM=Gs(VM),FM=gt({},wo,{propertyName:0,elapsedTime:0,pseudoElement:0}),UM=Gs(FM),$M=gt({},Jm,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HM=Gs($M),GM=gt({},wo,{newState:0,oldState:0}),zM=Gs(GM),qM=[9,13,27,32],Zb=qi&&"CompositionEvent"in window,nu=null;qi&&"documentMode"in document&&(nu=document.documentMode);var KM=qi&&"TextEvent"in window&&!nu,uE=qi&&(!Zb||nu&&8<nu&&11>=nu),L1=" ",P1=!1;function dE(t,e){switch(t){case"keyup":return qM.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hE(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Wo=!1;function WM(t,e){switch(t){case"compositionend":return hE(e);case"keypress":return e.which!==32?null:(P1=!0,L1);case"textInput":return t=e.data,t===L1&&P1?null:t;default:return null}}function YM(t,e){if(Wo)return t==="compositionend"||!Zb&&dE(t,e)?(t=cE(),qh=Qb=Ir=null,Wo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uE&&e.locale!=="ko"?null:e.data;default:return null}}var XM={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function V1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!XM[t.type]:e==="textarea"}function fE(t,e,s,n){Ko?pl?pl.push(n):pl=[n]:Ko=n,e=Ff(e,"onChange"),0<e.length&&(s=new Qm("onChange","change",null,s,n),t.push({event:s,listeners:e}))}var iu=null,Ru=null;function QM(t){lA(t,0)}function Zm(t){var e=Yc(t);if(nE(e))return t}function B1(t,e){if(t==="change")return e}var mE=!1;if(qi){var x0;if(qi){var b0="oninput"in document;if(!b0){var F1=document.createElement("div");F1.setAttribute("oninput","return;"),b0=typeof F1.oninput=="function"}x0=b0}else x0=!1;mE=x0&&(!document.documentMode||9<document.documentMode)}function U1(){iu&&(iu.detachEvent("onpropertychange",pE),Ru=iu=null)}function pE(t){if(t.propertyName==="value"&&Zm(Ru)){var e=[];fE(e,Ru,t,Xb(t)),lE(QM,e)}}function JM(t,e,s){t==="focusin"?(U1(),iu=e,Ru=s,iu.attachEvent("onpropertychange",pE)):t==="focusout"&&U1()}function ZM(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Zm(Ru)}function eD(t,e){if(t==="click")return Zm(e)}function tD(t,e){if(t==="input"||t==="change")return Zm(e)}function sD(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var on=typeof Object.is=="function"?Object.is:sD;function Iu(t,e){if(on(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var s=Object.keys(t),n=Object.keys(e);if(s.length!==n.length)return!1;for(n=0;n<s.length;n++){var i=s[n];if(!Dg.call(e,i)||!on(t[i],e[i]))return!1}return!0}function $1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function H1(t,e){var s=$1(t);t=0;for(var n;s;){if(s.nodeType===3){if(n=t+s.textContent.length,t<=e&&n>=e)return{node:s,offset:e-t};t=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=$1(s)}}function gE(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?gE(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function xE(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var e=wf(t.document);e instanceof t.HTMLIFrameElement;){try{var s=typeof e.contentWindow.location.href=="string"}catch{s=!1}if(s)t=e.contentWindow;else break;e=wf(t.document)}return e}function ev(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}var nD=qi&&"documentMode"in document&&11>=document.documentMode,Yo=null,$g=null,ru=null,Hg=!1;function G1(t,e,s){var n=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Hg||Yo==null||Yo!==wf(n)||(n=Yo,"selectionStart"in n&&ev(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ru&&Iu(ru,n)||(ru=n,n=Ff($g,"onSelect"),0<n.length&&(e=new Qm("onSelect","select",null,e,s),t.push({event:e,listeners:n}),e.target=Yo)))}function Ca(t,e){var s={};return s[t.toLowerCase()]=e.toLowerCase(),s["Webkit"+t]="webkit"+e,s["Moz"+t]="moz"+e,s}var Xo={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionrun:Ca("Transition","TransitionRun"),transitionstart:Ca("Transition","TransitionStart"),transitioncancel:Ca("Transition","TransitionCancel"),transitionend:Ca("Transition","TransitionEnd")},v0={},bE={};qi&&(bE=document.createElement("div").style,"AnimationEvent"in window||(delete Xo.animationend.animation,delete Xo.animationiteration.animation,delete Xo.animationstart.animation),"TransitionEvent"in window||delete Xo.transitionend.transition);function ko(t){if(v0[t])return v0[t];if(!Xo[t])return t;var e=Xo[t],s;for(s in e)if(e.hasOwnProperty(s)&&s in bE)return v0[t]=e[s];return t}var vE=ko("animationend"),yE=ko("animationiteration"),_E=ko("animationstart"),iD=ko("transitionrun"),rD=ko("transitionstart"),aD=ko("transitioncancel"),wE=ko("transitionend"),kE=new Map,Gg="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Gg.push("scrollEnd");function Xn(t,e){kE.set(t,e),_o(e,[t])}var kf=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},dn=[],Qo=0,tv=0;function ep(){for(var t=Qo,e=tv=Qo=0;e<t;){var s=dn[e];dn[e++]=null;var n=dn[e];dn[e++]=null;var i=dn[e];dn[e++]=null;var r=dn[e];if(dn[e++]=null,n!==null&&i!==null){var a=n.pending;a===null?i.next=i:(i.next=a.next,a.next=i),n.pending=i}r!==0&&NE(s,i,r)}}function tp(t,e,s,n){dn[Qo++]=t,dn[Qo++]=e,dn[Qo++]=s,dn[Qo++]=n,tv|=n,t.lanes|=n,t=t.alternate,t!==null&&(t.lanes|=n)}function sv(t,e,s,n){return tp(t,e,s,n),Nf(t)}function No(t,e){return tp(t,null,null,e),Nf(t)}function NE(t,e,s){t.lanes|=s;var n=t.alternate;n!==null&&(n.lanes|=s);for(var i=!1,r=t.return;r!==null;)r.childLanes|=s,n=r.alternate,n!==null&&(n.childLanes|=s),r.tag===22&&(t=r.stateNode,t===null||t._visibility&1||(i=!0)),t=r,r=r.return;return t.tag===3?(r=t.stateNode,i&&e!==null&&(i=31-nn(s),t=r.hiddenUpdates,n=t[i],n===null?t[i]=[e]:n.push(e),e.lane=s|536870912),r):null}function Nf(t){if(50<mu)throw mu=0,dx=null,Error(X(185));for(var e=t.return;e!==null;)t=e,e=t.return;return t.tag===3?t.stateNode:null}var Jo={};function oD(t,e,s,n){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(t,e,s,n){return new oD(t,e,s,n)}function nv(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Bi(t,e){var s=t.alternate;return s===null?(s=Ys(t.tag,e,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=e,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function SE(t,e){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=e,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),t}function Wh(t,e,s,n,i,r){var a=0;if(n=t,typeof t=="function")nv(t)&&(a=1);else if(typeof t=="string")a=h4(t,s,ii.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case Rg:return t=Ys(31,s,e,i),t.elementType=Rg,t.lanes=r,t;case Go:return Ya(s.children,i,r,e);case GT:a=8,i|=24;break;case Ag:return t=Ys(12,s,e,i|2),t.elementType=Ag,t.lanes=r,t;case jg:return t=Ys(13,s,e,i),t.elementType=jg,t.lanes=r,t;case Cg:return t=Ys(19,s,e,i),t.elementType=Cg,t.lanes=r,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ri:a=10;break e;case zT:a=9;break e;case Hb:a=11;break e;case Gb:a=14;break e;case yr:a=16,n=null;break e}a=29,s=Error(X(130,t===null?"null":typeof t,"")),n=null}return e=Ys(a,s,e,i),e.elementType=t,e.type=n,e.lanes=r,e}function Ya(t,e,s,n){return t=Ys(7,t,n,e),t.lanes=s,t}function y0(t,e,s){return t=Ys(6,t,null,e),t.lanes=s,t}function TE(t){var e=Ys(18,null,null,0);return e.stateNode=t,e}function _0(t,e,s){return e=Ys(4,t.children!==null?t.children:[],t.key,e),e.lanes=s,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}var z1=new WeakMap;function gn(t,e){if(typeof t=="object"&&t!==null){var s=z1.get(t);return s!==void 0?s:(e={value:t,source:e,stack:S1(e)},z1.set(t,e),e)}return{value:t,source:e,stack:S1(e)}}var Zo=[],el=0,Sf=null,Ou=0,fn=[],mn=0,na=null,ti=1,si="";function ji(t,e){Zo[el++]=Ou,Zo[el++]=Sf,Sf=t,Ou=e}function EE(t,e,s){fn[mn++]=ti,fn[mn++]=si,fn[mn++]=na,na=t;var n=ti;t=si;var i=32-nn(n)-1;n&=~(1<<i),s+=1;var r=32-nn(e)+i;if(30<r){var a=i-i%5;r=(n&(1<<a)-1).toString(32),n>>=a,i-=a,ti=1<<32-nn(e)+i|s<<i|n,si=r+t}else ti=1<<r|s<<i|n,si=t}function iv(t){t.return!==null&&(ji(t,1),EE(t,1,0))}function rv(t){for(;t===Sf;)Sf=Zo[--el],Zo[el]=null,Ou=Zo[--el],Zo[el]=null;for(;t===na;)na=fn[--mn],fn[mn]=null,si=fn[--mn],fn[mn]=null,ti=fn[--mn],fn[mn]=null}function AE(t,e){fn[mn++]=ti,fn[mn++]=si,fn[mn++]=na,ti=e.id,si=e.overflow,na=t}var fs=null,ft=null,De=!1,Ur=null,xn=!1,zg=Error(X(519));function ia(t){var e=Error(X(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Mu(gn(e,t)),zg}function q1(t){var e=t.stateNode,s=t.type,n=t.memoizedProps;switch(e[hs]=t,e[Us]=n,s){case"dialog":je("cancel",e),je("close",e);break;case"iframe":case"object":case"embed":je("load",e);break;case"video":case"audio":for(s=0;s<Vu.length;s++)je(Vu[s],e);break;case"source":je("error",e);break;case"img":case"image":case"link":je("error",e),je("load",e);break;case"details":je("toggle",e);break;case"input":je("invalid",e),iE(e,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":je("invalid",e);break;case"textarea":je("invalid",e),aE(e,n.value,n.defaultValue,n.children)}s=n.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||e.textContent===""+s||n.suppressHydrationWarning===!0||uA(e.textContent,s)?(n.popover!=null&&(je("beforetoggle",e),je("toggle",e)),n.onScroll!=null&&je("scroll",e),n.onScrollEnd!=null&&je("scrollend",e),n.onClick!=null&&(e.onclick=Ii),e=!0):e=!1,e||ia(t,!0)}function K1(t){for(fs=t.return;fs;)switch(fs.tag){case 5:case 31:case 13:xn=!1;return;case 27:case 3:xn=!0;return;default:fs=fs.return}}function Mo(t){if(t!==fs)return!1;if(!De)return K1(t),De=!0,!1;var e=t.tag,s;if((s=e!==3&&e!==27)&&((s=e===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||gx(t.type,t.memoizedProps)),s=!s),s&&ft&&ia(t),K1(t),e===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));ft=Ow(t)}else if(e===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(317));ft=Ow(t)}else e===27?(e=ft,wa(t.type)?(t=yx,yx=null,ft=t):ft=e):ft=fs?_n(t.stateNode.nextSibling):null;return!0}function ro(){ft=fs=null,De=!1}function w0(){var t=Ur;return t!==null&&(Ms===null?Ms=t:Ms.push.apply(Ms,t),Ur=null),t}function Mu(t){Ur===null?Ur=[t]:Ur.push(t)}var qg=fi(null),So=null,Oi=null;function kr(t,e,s){ut(qg,e._currentValue),e._currentValue=s}function Fi(t){t._currentValue=qg.current,as(qg)}function Kg(t,e,s){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===s)break;t=t.return}}function Wg(t,e,s,n){var i=t.child;for(i!==null&&(i.return=t);i!==null;){var r=i.dependencies;if(r!==null){var a=i.child;r=r.firstContext;e:for(;r!==null;){var l=r;r=i;for(var c=0;c<e.length;c++)if(l.context===e[c]){r.lanes|=s,l=r.alternate,l!==null&&(l.lanes|=s),Kg(r.return,s,t),n||(a=null);break e}r=l.next}}else if(i.tag===18){if(a=i.return,a===null)throw Error(X(341));a.lanes|=s,r=a.alternate,r!==null&&(r.lanes|=s),Kg(a,s,t),a=null}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===t){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}}function rc(t,e,s,n){t=null;for(var i=e,r=!1;i!==null;){if(!r){if(i.flags&524288)r=!0;else if(i.flags&262144)break}if(i.tag===10){var a=i.alternate;if(a===null)throw Error(X(387));if(a=a.memoizedProps,a!==null){var l=i.type;on(i.pendingProps.value,a.value)||(t!==null?t.push(l):t=[l])}}else if(i===bf.current){if(a=i.alternate,a===null)throw Error(X(387));a.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(t!==null?t.push(Fu):t=[Fu])}i=i.return}t!==null&&Wg(e,t,s,n),e.flags|=262144}function Tf(t){for(t=t.firstContext;t!==null;){if(!on(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function ao(t){So=t,Oi=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function ps(t){return jE(So,t)}function yh(t,e){return So===null&&ao(t),jE(t,e)}function jE(t,e){var s=e._currentValue;if(e={context:e,memoizedValue:s,next:null},Oi===null){if(t===null)throw Error(X(308));Oi=e,t.dependencies={lanes:0,firstContext:e},t.flags|=524288}else Oi=Oi.next=e;return s}var lD=typeof AbortController<"u"?AbortController:function(){var t=[],e=this.signal={aborted:!1,addEventListener:function(s,n){t.push(n)}};this.abort=function(){e.aborted=!0,t.forEach(function(s){return s()})}},cD=Jt.unstable_scheduleCallback,uD=Jt.unstable_NormalPriority,Ht={$$typeof:Ri,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function av(){return{controller:new lD,data:new Map,refCount:0}}function Sd(t){t.refCount--,t.refCount===0&&cD(uD,function(){t.controller.abort()})}var au=null,Yg=0,Ol=0,gl=null;function dD(t,e){if(au===null){var s=au=[];Yg=0,Ol=Rv(),gl={status:"pending",value:void 0,then:function(n){s.push(n)}}}return Yg++,e.then(W1,W1),e}function W1(){if(--Yg===0&&au!==null){gl!==null&&(gl.status="fulfilled");var t=au;au=null,Ol=0,gl=null;for(var e=0;e<t.length;e++)(0,t[e])()}}function hD(t,e){var s=[],n={status:"pending",value:null,reason:null,then:function(i){s.push(i)}};return t.then(function(){n.status="fulfilled",n.value=e;for(var i=0;i<s.length;i++)(0,s[i])(e)},function(i){for(n.status="rejected",n.reason=i,i=0;i<s.length;i++)(0,s[i])(void 0)}),n}var Y1=be.S;be.S=function(t,e){H2=tn(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&dD(t,e),Y1!==null&&Y1(t,e)};var Xa=fi(null);function ov(){var t=Xa.current;return t!==null?t:ot.pooledCache}function Yh(t,e){e===null?ut(Xa,Xa.current):ut(Xa,e.pool)}function CE(){var t=ov();return t===null?null:{parent:Ht._currentValue,pool:t}}var ac=Error(X(460)),lv=Error(X(474)),sp=Error(X(542)),Ef={then:function(){}};function X1(t){return t=t.status,t==="fulfilled"||t==="rejected"}function RE(t,e,s){switch(s=t[s],s===void 0?t.push(e):s!==e&&(e.then(Ii,Ii),e=s),e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,J1(t),t;default:if(typeof e.status=="string")e.then(Ii,Ii);else{if(t=ot,t!==null&&100<t.shellSuspendCounter)throw Error(X(482));t=e,t.status="pending",t.then(function(n){if(e.status==="pending"){var i=e;i.status="fulfilled",i.value=n}},function(n){if(e.status==="pending"){var i=e;i.status="rejected",i.reason=n}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw t=e.reason,J1(t),t}throw Qa=e,ac}}function La(t){try{var e=t._init;return e(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(Qa=s,ac):s}}var Qa=null;function Q1(){if(Qa===null)throw Error(X(459));var t=Qa;return Qa=null,t}function J1(t){if(t===ac||t===sp)throw Error(X(483))}var xl=null,Du=0;function _h(t){var e=Du;return Du+=1,xl===null&&(xl=[]),RE(xl,t,e)}function Vc(t,e){e=e.props.ref,t.ref=e!==void 0?e:null}function wh(t,e){throw e.$$typeof===JO?Error(X(525)):(t=Object.prototype.toString.call(e),Error(X(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)))}function IE(t){function e(g,p){if(t){var y=g.deletions;y===null?(g.deletions=[p],g.flags|=16):y.push(p)}}function s(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function n(g){for(var p=new Map;g!==null;)g.key!==null?p.set(g.key,g):p.set(g.index,g),g=g.sibling;return p}function i(g,p){return g=Bi(g,p),g.index=0,g.sibling=null,g}function r(g,p,y){return g.index=y,t?(y=g.alternate,y!==null?(y=y.index,y<p?(g.flags|=67108866,p):y):(g.flags|=67108866,p)):(g.flags|=1048576,p)}function a(g){return t&&g.alternate===null&&(g.flags|=67108866),g}function l(g,p,y,k){return p===null||p.tag!==6?(p=y0(y,g.mode,k),p.return=g,p):(p=i(p,y),p.return=g,p)}function c(g,p,y,k){var w=y.type;return w===Go?d(g,p,y.props.children,k,y.key):p!==null&&(p.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===yr&&La(w)===p.type)?(p=i(p,y.props),Vc(p,y),p.return=g,p):(p=Wh(y.type,y.key,y.props,null,g.mode,k),Vc(p,y),p.return=g,p)}function u(g,p,y,k){return p===null||p.tag!==4||p.stateNode.containerInfo!==y.containerInfo||p.stateNode.implementation!==y.implementation?(p=_0(y,g.mode,k),p.return=g,p):(p=i(p,y.children||[]),p.return=g,p)}function d(g,p,y,k,w){return p===null||p.tag!==7?(p=Ya(y,g.mode,k,w),p.return=g,p):(p=i(p,y),p.return=g,p)}function h(g,p,y){if(typeof p=="string"&&p!==""||typeof p=="number"||typeof p=="bigint")return p=y0(""+p,g.mode,y),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case mh:return y=Wh(p.type,p.key,p.props,null,g.mode,y),Vc(y,p),y.return=g,y;case Kc:return p=_0(p,g.mode,y),p.return=g,p;case yr:return p=La(p),h(g,p,y)}if(Wc(p)||Dc(p))return p=Ya(p,g.mode,y,null),p.return=g,p;if(typeof p.then=="function")return h(g,_h(p),y);if(p.$$typeof===Ri)return h(g,yh(g,p),y);wh(g,p)}return null}function f(g,p,y,k){var w=p!==null?p.key:null;if(typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint")return w!==null?null:l(g,p,""+y,k);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case mh:return y.key===w?c(g,p,y,k):null;case Kc:return y.key===w?u(g,p,y,k):null;case yr:return y=La(y),f(g,p,y,k)}if(Wc(y)||Dc(y))return w!==null?null:d(g,p,y,k,null);if(typeof y.then=="function")return f(g,p,_h(y),k);if(y.$$typeof===Ri)return f(g,p,yh(g,y),k);wh(g,y)}return null}function m(g,p,y,k,w){if(typeof k=="string"&&k!==""||typeof k=="number"||typeof k=="bigint")return g=g.get(y)||null,l(p,g,""+k,w);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case mh:return g=g.get(k.key===null?y:k.key)||null,c(p,g,k,w);case Kc:return g=g.get(k.key===null?y:k.key)||null,u(p,g,k,w);case yr:return k=La(k),m(g,p,y,k,w)}if(Wc(k)||Dc(k))return g=g.get(y)||null,d(p,g,k,w,null);if(typeof k.then=="function")return m(g,p,y,_h(k),w);if(k.$$typeof===Ri)return m(g,p,y,yh(p,k),w);wh(p,k)}return null}function b(g,p,y,k){for(var w=null,S=null,_=p,T=p=0,E=null;_!==null&&T<y.length;T++){_.index>T?(E=_,_=null):E=_.sibling;var A=f(g,_,y[T],k);if(A===null){_===null&&(_=E);break}t&&_&&A.alternate===null&&e(g,_),p=r(A,p,T),S===null?w=A:S.sibling=A,S=A,_=E}if(T===y.length)return s(g,_),De&&ji(g,T),w;if(_===null){for(;T<y.length;T++)_=h(g,y[T],k),_!==null&&(p=r(_,p,T),S===null?w=_:S.sibling=_,S=_);return De&&ji(g,T),w}for(_=n(_);T<y.length;T++)E=m(_,g,T,y[T],k),E!==null&&(t&&E.alternate!==null&&_.delete(E.key===null?T:E.key),p=r(E,p,T),S===null?w=E:S.sibling=E,S=E);return t&&_.forEach(function(j){return e(g,j)}),De&&ji(g,T),w}function x(g,p,y,k){if(y==null)throw Error(X(151));for(var w=null,S=null,_=p,T=p=0,E=null,A=y.next();_!==null&&!A.done;T++,A=y.next()){_.index>T?(E=_,_=null):E=_.sibling;var j=f(g,_,A.value,k);if(j===null){_===null&&(_=E);break}t&&_&&j.alternate===null&&e(g,_),p=r(j,p,T),S===null?w=j:S.sibling=j,S=j,_=E}if(A.done)return s(g,_),De&&ji(g,T),w;if(_===null){for(;!A.done;T++,A=y.next())A=h(g,A.value,k),A!==null&&(p=r(A,p,T),S===null?w=A:S.sibling=A,S=A);return De&&ji(g,T),w}for(_=n(_);!A.done;T++,A=y.next())A=m(_,g,T,A.value,k),A!==null&&(t&&A.alternate!==null&&_.delete(A.key===null?T:A.key),p=r(A,p,T),S===null?w=A:S.sibling=A,S=A);return t&&_.forEach(function(O){return e(g,O)}),De&&ji(g,T),w}function v(g,p,y,k){if(typeof y=="object"&&y!==null&&y.type===Go&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case mh:e:{for(var w=y.key;p!==null;){if(p.key===w){if(w=y.type,w===Go){if(p.tag===7){s(g,p.sibling),k=i(p,y.props.children),k.return=g,g=k;break e}}else if(p.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===yr&&La(w)===p.type){s(g,p.sibling),k=i(p,y.props),Vc(k,y),k.return=g,g=k;break e}s(g,p);break}else e(g,p);p=p.sibling}y.type===Go?(k=Ya(y.props.children,g.mode,k,y.key),k.return=g,g=k):(k=Wh(y.type,y.key,y.props,null,g.mode,k),Vc(k,y),k.return=g,g=k)}return a(g);case Kc:e:{for(w=y.key;p!==null;){if(p.key===w)if(p.tag===4&&p.stateNode.containerInfo===y.containerInfo&&p.stateNode.implementation===y.implementation){s(g,p.sibling),k=i(p,y.children||[]),k.return=g,g=k;break e}else{s(g,p);break}else e(g,p);p=p.sibling}k=_0(y,g.mode,k),k.return=g,g=k}return a(g);case yr:return y=La(y),v(g,p,y,k)}if(Wc(y))return b(g,p,y,k);if(Dc(y)){if(w=Dc(y),typeof w!="function")throw Error(X(150));return y=w.call(y),x(g,p,y,k)}if(typeof y.then=="function")return v(g,p,_h(y),k);if(y.$$typeof===Ri)return v(g,p,yh(g,y),k);wh(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint"?(y=""+y,p!==null&&p.tag===6?(s(g,p.sibling),k=i(p,y),k.return=g,g=k):(s(g,p),k=y0(y,g.mode,k),k.return=g,g=k),a(g)):s(g,p)}return function(g,p,y,k){try{Du=0;var w=v(g,p,y,k);return xl=null,w}catch(_){if(_===ac||_===sp)throw _;var S=Ys(29,_,null,g.mode);return S.lanes=k,S.return=g,S}finally{}}}var oo=IE(!0),OE=IE(!1),_r=!1;function cv(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Xg(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function $r(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Hr(t,e,s){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,Ue&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,e=Nf(t),NE(t,null,s),e}return tp(t,n,e,s),Nf(t)}function ou(t,e,s){if(e=e.updateQueue,e!==null&&(e=e.shared,(s&4194048)!==0)){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,QT(t,s)}}function k0(t,e){var s=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,s===n)){var i=null,r=null;if(s=s.firstBaseUpdate,s!==null){do{var a={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};r===null?i=r=a:r=r.next=a,s=s.next}while(s!==null);r===null?i=r=e:r=r.next=e}else i=r=e;s={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:n.shared,callbacks:n.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=e:t.next=e,s.lastBaseUpdate=e}var Qg=!1;function lu(){if(Qg){var t=gl;if(t!==null)throw t}}function cu(t,e,s,n){Qg=!1;var i=t.updateQueue;_r=!1;var r=i.firstBaseUpdate,a=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,u=c.next;c.next=null,a===null?r=u:a.next=u,a=c;var d=t.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==a&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(r!==null){var h=i.baseState;a=0,d=u=c=null,l=r;do{var f=l.lane&-536870913,m=f!==l.lane;if(m?(Me&f)===f:(n&f)===f){f!==0&&f===Ol&&(Qg=!0),d!==null&&(d=d.next={lane:0,tag:l.tag,payload:l.payload,callback:null,next:null});e:{var b=t,x=l;f=e;var v=s;switch(x.tag){case 1:if(b=x.payload,typeof b=="function"){h=b.call(v,h,f);break e}h=b;break e;case 3:b.flags=b.flags&-65537|128;case 0:if(b=x.payload,f=typeof b=="function"?b.call(v,h,f):b,f==null)break e;h=gt({},h,f);break e;case 2:_r=!0}}f=l.callback,f!==null&&(t.flags|=64,m&&(t.flags|=8192),m=i.callbacks,m===null?i.callbacks=[f]:m.push(f))}else m={lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=m,c=h):d=d.next=m,a|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;m=l,l=m.next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}while(!0);d===null&&(c=h),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=d,r===null&&(i.shared.lanes=0),aa|=a,t.lanes=a,t.memoizedState=h}}function ME(t,e){if(typeof t!="function")throw Error(X(191,t));t.call(e)}function DE(t,e){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)ME(s[t],e)}var Ml=fi(null),Af=fi(0);function Z1(t,e){t=Xi,ut(Af,t),ut(Ml,e),Xi=t|e.baseLanes}function Jg(){ut(Af,Xi),ut(Ml,Ml.current)}function uv(){Xi=Af.current,as(Ml),as(Af)}var ln=fi(null),yn=null;function Nr(t){var e=t.alternate;ut(Dt,Dt.current&1),ut(ln,t),yn===null&&(e===null||Ml.current!==null||e.memoizedState!==null)&&(yn=t)}function Zg(t){ut(Dt,Dt.current),ut(ln,t),yn===null&&(yn=t)}function LE(t){t.tag===22?(ut(Dt,Dt.current),ut(ln,t),yn===null&&(yn=t)):Sr()}function Sr(){ut(Dt,Dt.current),ut(ln,ln.current)}function Ks(t){as(ln),yn===t&&(yn=null),as(Dt)}var Dt=fi(0);function jf(t){for(var e=t;e!==null;){if(e.tag===13){var s=e.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||bx(s)||vx(s)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ki=0,_e=null,st=null,Ut=null,Cf=!1,bl=!1,lo=!1,Rf=0,Lu=0,vl=null,fD=0;function At(){throw Error(X(321))}function dv(t,e){if(e===null)return!1;for(var s=0;s<e.length&&s<t.length;s++)if(!on(t[s],e[s]))return!1;return!0}function hv(t,e,s,n,i,r){return Ki=r,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,be.H=t===null||t.memoizedState===null?f2:kv,lo=!1,r=s(n,i),lo=!1,bl&&(r=VE(e,s,n,i)),PE(t),r}function PE(t){be.H=Pu;var e=st!==null&&st.next!==null;if(Ki=0,Ut=st=_e=null,Cf=!1,Lu=0,vl=null,e)throw Error(X(300));t===null||Gt||(t=t.dependencies,t!==null&&Tf(t)&&(Gt=!0))}function VE(t,e,s,n){_e=t;var i=0;do{if(bl&&(vl=null),Lu=0,bl=!1,25<=i)throw Error(X(301));if(i+=1,Ut=st=null,t.updateQueue!=null){var r=t.updateQueue;r.lastEffect=null,r.events=null,r.stores=null,r.memoCache!=null&&(r.memoCache.index=0)}be.H=m2,r=e(s,n)}while(bl);return r}function mD(){var t=be.H,e=t.useState()[0];return e=typeof e.then=="function"?Td(e):e,t=t.useState()[0],(st!==null?st.memoizedState:null)!==t&&(_e.flags|=1024),e}function fv(){var t=Rf!==0;return Rf=0,t}function mv(t,e,s){e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s}function pv(t){if(Cf){for(t=t.memoizedState;t!==null;){var e=t.queue;e!==null&&(e.pending=null),t=t.next}Cf=!1}Ki=0,Ut=st=_e=null,bl=!1,Lu=Rf=0,vl=null}function ys(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?_e.memoizedState=Ut=t:Ut=Ut.next=t,Ut}function Pt(){if(st===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=st.next;var e=Ut===null?_e.memoizedState:Ut.next;if(e!==null)Ut=e,st=t;else{if(t===null)throw _e.alternate===null?Error(X(467)):Error(X(310));st=t,t={memoizedState:st.memoizedState,baseState:st.baseState,baseQueue:st.baseQueue,queue:st.queue,next:null},Ut===null?_e.memoizedState=Ut=t:Ut=Ut.next=t}return Ut}function np(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Td(t){var e=Lu;return Lu+=1,vl===null&&(vl=[]),t=RE(vl,t,e),e=_e,(Ut===null?e.memoizedState:Ut.next)===null&&(e=e.alternate,be.H=e===null||e.memoizedState===null?f2:kv),t}function ip(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Td(t);if(t.$$typeof===Ri)return ps(t)}throw Error(X(438,String(t)))}function gv(t){var e=null,s=_e.updateQueue;if(s!==null&&(e=s.memoCache),e==null){var n=_e.alternate;n!==null&&(n=n.updateQueue,n!==null&&(n=n.memoCache,n!=null&&(e={data:n.data.map(function(i){return i.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),s===null&&(s=np(),_e.updateQueue=s),s.memoCache=e,s=e.data[e.index],s===void 0)for(s=e.data[e.index]=Array(t),n=0;n<t;n++)s[n]=ZO;return e.index++,s}function Wi(t,e){return typeof e=="function"?e(t):e}function Xh(t){var e=Pt();return xv(e,st,t)}function xv(t,e,s){var n=t.queue;if(n===null)throw Error(X(311));n.lastRenderedReducer=s;var i=t.baseQueue,r=n.pending;if(r!==null){if(i!==null){var a=i.next;i.next=r.next,r.next=a}e.baseQueue=i=r,n.pending=null}if(r=t.baseState,i===null)t.memoizedState=r;else{e=i.next;var l=a=null,c=null,u=e,d=!1;do{var h=u.lane&-536870913;if(h!==u.lane?(Me&h)===h:(Ki&h)===h){var f=u.revertLane;if(f===0)c!==null&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===Ol&&(d=!0);else if((Ki&f)===f){u=u.next,f===Ol&&(d=!0);continue}else h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},c===null?(l=c=h,a=r):c=c.next=h,_e.lanes|=f,aa|=f;h=u.action,lo&&s(r,h),r=u.hasEagerState?u.eagerState:s(r,h)}else f={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},c===null?(l=c=f,a=r):c=c.next=f,_e.lanes|=h,aa|=h;u=u.next}while(u!==null&&u!==e);if(c===null?a=r:c.next=l,!on(r,t.memoizedState)&&(Gt=!0,d&&(s=gl,s!==null)))throw s;t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}return i===null&&(n.lanes=0),[t.memoizedState,n.dispatch]}function N0(t){var e=Pt(),s=e.queue;if(s===null)throw Error(X(311));s.lastRenderedReducer=t;var n=s.dispatch,i=s.pending,r=e.memoizedState;if(i!==null){s.pending=null;var a=i=i.next;do r=t(r,a.action),a=a.next;while(a!==i);on(r,e.memoizedState)||(Gt=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),s.lastRenderedState=r}return[r,n]}function BE(t,e,s){var n=_e,i=Pt(),r=De;if(r){if(s===void 0)throw Error(X(407));s=s()}else s=e();var a=!on((st||i).memoizedState,s);if(a&&(i.memoizedState=s,Gt=!0),i=i.queue,bv($E.bind(null,n,i,t),[t]),i.getSnapshot!==e||a||Ut!==null&&Ut.memoizedState.tag&1){if(n.flags|=2048,Dl(9,{destroy:void 0},UE.bind(null,n,i,s,e),null),ot===null)throw Error(X(349));r||Ki&127||FE(n,e,s)}return s}function FE(t,e,s){t.flags|=16384,t={getSnapshot:e,value:s},e=_e.updateQueue,e===null?(e=np(),_e.updateQueue=e,e.stores=[t]):(s=e.stores,s===null?e.stores=[t]:s.push(t))}function UE(t,e,s,n){e.value=s,e.getSnapshot=n,HE(e)&&GE(t)}function $E(t,e,s){return s(function(){HE(e)&&GE(t)})}function HE(t){var e=t.getSnapshot;t=t.value;try{var s=e();return!on(t,s)}catch{return!0}}function GE(t){var e=No(t,2);e!==null&&Vs(e,t,2)}function ex(t){var e=ys();if(typeof t=="function"){var s=t;if(t=s(),lo){Rr(!0);try{s()}finally{Rr(!1)}}}return e.memoizedState=e.baseState=t,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:t},e}function zE(t,e,s,n){return t.baseState=s,xv(t,st,typeof n=="function"?n:Wi)}function pD(t,e,s,n,i){if(ap(t))throw Error(X(485));if(t=e.action,t!==null){var r={payload:i,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(a){r.listeners.push(a)}};be.T!==null?s(!0):r.isTransition=!1,n(r),s=e.pending,s===null?(r.next=e.pending=r,qE(e,r)):(r.next=s.next,e.pending=s.next=r)}}function qE(t,e){var s=e.action,n=e.payload,i=t.state;if(e.isTransition){var r=be.T,a={};be.T=a;try{var l=s(i,n),c=be.S;c!==null&&c(a,l),ew(t,e,l)}catch(u){tx(t,e,u)}finally{r!==null&&a.types!==null&&(r.types=a.types),be.T=r}}else try{r=s(i,n),ew(t,e,r)}catch(u){tx(t,e,u)}}function ew(t,e,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(n){tw(t,e,n)},function(n){return tx(t,e,n)}):tw(t,e,s)}function tw(t,e,s){e.status="fulfilled",e.value=s,KE(e),t.state=s,e=t.pending,e!==null&&(s=e.next,s===e?t.pending=null:(s=s.next,e.next=s,qE(t,s)))}function tx(t,e,s){var n=t.pending;if(t.pending=null,n!==null){n=n.next;do e.status="rejected",e.reason=s,KE(e),e=e.next;while(e!==n)}t.action=null}function KE(t){t=t.listeners;for(var e=0;e<t.length;e++)(0,t[e])()}function WE(t,e){return e}function sw(t,e){if(De){var s=ot.formState;if(s!==null){e:{var n=_e;if(De){if(ft){t:{for(var i=ft,r=xn;i.nodeType!==8;){if(!r){i=null;break t}if(i=_n(i.nextSibling),i===null){i=null;break t}}r=i.data,i=r==="F!"||r==="F"?i:null}if(i){ft=_n(i.nextSibling),n=i.data==="F!";break e}}ia(n)}n=!1}n&&(e=s[0])}}return s=ys(),s.memoizedState=s.baseState=e,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:WE,lastRenderedState:e},s.queue=n,s=u2.bind(null,_e,n),n.dispatch=s,n=ex(!1),r=wv.bind(null,_e,!1,n.queue),n=ys(),i={state:e,dispatch:null,action:t,pending:null},n.queue=i,s=pD.bind(null,_e,i,r,s),i.dispatch=s,n.memoizedState=t,[e,s,!1]}function nw(t){var e=Pt();return YE(e,st,t)}function YE(t,e,s){if(e=xv(t,e,WE)[0],t=Xh(Wi)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var n=Td(e)}catch(a){throw a===ac?sp:a}else n=e;e=Pt();var i=e.queue,r=i.dispatch;return s!==e.memoizedState&&(_e.flags|=2048,Dl(9,{destroy:void 0},gD.bind(null,i,s),null)),[n,r,t]}function gD(t,e){t.action=e}function iw(t){var e=Pt(),s=st;if(s!==null)return YE(e,s,t);Pt(),e=e.memoizedState,s=Pt();var n=s.queue.dispatch;return s.memoizedState=t,[e,n,!1]}function Dl(t,e,s,n){return t={tag:t,create:s,deps:n,inst:e,next:null},e=_e.updateQueue,e===null&&(e=np(),_e.updateQueue=e),s=e.lastEffect,s===null?e.lastEffect=t.next=t:(n=s.next,s.next=t,t.next=n,e.lastEffect=t),t}function XE(){return Pt().memoizedState}function Qh(t,e,s,n){var i=ys();_e.flags|=t,i.memoizedState=Dl(1|e,{destroy:void 0},s,n===void 0?null:n)}function rp(t,e,s,n){var i=Pt();n=n===void 0?null:n;var r=i.memoizedState.inst;st!==null&&n!==null&&dv(n,st.memoizedState.deps)?i.memoizedState=Dl(e,r,s,n):(_e.flags|=t,i.memoizedState=Dl(1|e,r,s,n))}function rw(t,e){Qh(8390656,8,t,e)}function bv(t,e){rp(2048,8,t,e)}function xD(t){_e.flags|=4;var e=_e.updateQueue;if(e===null)e=np(),_e.updateQueue=e,e.events=[t];else{var s=e.events;s===null?e.events=[t]:s.push(t)}}function QE(t){var e=Pt().memoizedState;return xD({ref:e,nextImpl:t}),function(){if(Ue&2)throw Error(X(440));return e.impl.apply(void 0,arguments)}}function JE(t,e){return rp(4,2,t,e)}function ZE(t,e){return rp(4,4,t,e)}function e2(t,e){if(typeof e=="function"){t=t();var s=e(t);return function(){typeof s=="function"?s():e(null)}}if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function t2(t,e,s){s=s!=null?s.concat([t]):null,rp(4,4,e2.bind(null,e,t),s)}function vv(){}function s2(t,e){var s=Pt();e=e===void 0?null:e;var n=s.memoizedState;return e!==null&&dv(e,n[1])?n[0]:(s.memoizedState=[t,e],t)}function n2(t,e){var s=Pt();e=e===void 0?null:e;var n=s.memoizedState;if(e!==null&&dv(e,n[1]))return n[0];if(n=t(),lo){Rr(!0);try{t()}finally{Rr(!1)}}return s.memoizedState=[n,e],n}function yv(t,e,s){return s===void 0||Ki&1073741824&&!(Me&261930)?t.memoizedState=e:(t.memoizedState=s,t=z2(),_e.lanes|=t,aa|=t,s)}function i2(t,e,s,n){return on(s,e)?s:Ml.current!==null?(t=yv(t,s,n),on(t,e)||(Gt=!0),t):!(Ki&42)||Ki&1073741824&&!(Me&261930)?(Gt=!0,t.memoizedState=s):(t=z2(),_e.lanes|=t,aa|=t,e)}function r2(t,e,s,n,i){var r=$e.p;$e.p=r!==0&&8>r?r:8;var a=be.T,l={};be.T=l,wv(t,!1,e,s);try{var c=i(),u=be.S;if(u!==null&&u(l,c),c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=hD(c,n);uu(t,e,d,rn(t))}else uu(t,e,n,rn(t))}catch(h){uu(t,e,{then:function(){},status:"rejected",reason:h},rn())}finally{$e.p=r,a!==null&&l.types!==null&&(a.types=l.types),be.T=a}}function bD(){}function sx(t,e,s,n){if(t.tag!==5)throw Error(X(476));var i=a2(t).queue;r2(t,i,e,Wa,s===null?bD:function(){return o2(t),s(n)})}function a2(t){var e=t.memoizedState;if(e!==null)return e;e={memoizedState:Wa,baseState:Wa,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:Wa},next:null};var s={};return e.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Wi,lastRenderedState:s},next:null},t.memoizedState=e,t=t.alternate,t!==null&&(t.memoizedState=e),e}function o2(t){var e=a2(t);e.next===null&&(e=t.alternate.memoizedState),uu(t,e.next.queue,{},rn())}function _v(){return ps(Fu)}function l2(){return Pt().memoizedState}function c2(){return Pt().memoizedState}function vD(t){for(var e=t.return;e!==null;){switch(e.tag){case 24:case 3:var s=rn();t=$r(s);var n=Hr(e,t,s);n!==null&&(Vs(n,e,s),ou(n,e,s)),e={cache:av()},t.payload=e;return}e=e.return}}function yD(t,e,s){var n=rn();s={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ap(t)?d2(e,s):(s=sv(t,e,s,n),s!==null&&(Vs(s,t,n),h2(s,e,n)))}function u2(t,e,s){var n=rn();uu(t,e,s,n)}function uu(t,e,s,n){var i={lane:n,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(ap(t))d2(e,i);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var a=e.lastRenderedState,l=r(a,s);if(i.hasEagerState=!0,i.eagerState=l,on(l,a))return tp(t,e,i,0),ot===null&&ep(),!1}catch{}finally{}if(s=sv(t,e,i,n),s!==null)return Vs(s,t,n),h2(s,e,n),!0}return!1}function wv(t,e,s,n){if(n={lane:2,revertLane:Rv(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ap(t)){if(e)throw Error(X(479))}else e=sv(t,s,n,2),e!==null&&Vs(e,t,2)}function ap(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function d2(t,e){bl=Cf=!0;var s=t.pending;s===null?e.next=e:(e.next=s.next,s.next=e),t.pending=e}function h2(t,e,s){if(s&4194048){var n=e.lanes;n&=t.pendingLanes,s|=n,e.lanes=s,QT(t,s)}}var Pu={readContext:ps,use:ip,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useLayoutEffect:At,useInsertionEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useSyncExternalStore:At,useId:At,useHostTransitionStatus:At,useFormState:At,useActionState:At,useOptimistic:At,useMemoCache:At,useCacheRefresh:At};Pu.useEffectEvent=At;var f2={readContext:ps,use:ip,useCallback:function(t,e){return ys().memoizedState=[t,e===void 0?null:e],t},useContext:ps,useEffect:rw,useImperativeHandle:function(t,e,s){s=s!=null?s.concat([t]):null,Qh(4194308,4,e2.bind(null,e,t),s)},useLayoutEffect:function(t,e){return Qh(4194308,4,t,e)},useInsertionEffect:function(t,e){Qh(4,2,t,e)},useMemo:function(t,e){var s=ys();e=e===void 0?null:e;var n=t();if(lo){Rr(!0);try{t()}finally{Rr(!1)}}return s.memoizedState=[n,e],n},useReducer:function(t,e,s){var n=ys();if(s!==void 0){var i=s(e);if(lo){Rr(!0);try{s(e)}finally{Rr(!1)}}}else i=e;return n.memoizedState=n.baseState=i,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},n.queue=t,t=t.dispatch=yD.bind(null,_e,t),[n.memoizedState,t]},useRef:function(t){var e=ys();return t={current:t},e.memoizedState=t},useState:function(t){t=ex(t);var e=t.queue,s=u2.bind(null,_e,e);return e.dispatch=s,[t.memoizedState,s]},useDebugValue:vv,useDeferredValue:function(t,e){var s=ys();return yv(s,t,e)},useTransition:function(){var t=ex(!1);return t=r2.bind(null,_e,t.queue,!0,!1),ys().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,e,s){var n=_e,i=ys();if(De){if(s===void 0)throw Error(X(407));s=s()}else{if(s=e(),ot===null)throw Error(X(349));Me&127||FE(n,e,s)}i.memoizedState=s;var r={value:s,getSnapshot:e};return i.queue=r,rw($E.bind(null,n,r,t),[t]),n.flags|=2048,Dl(9,{destroy:void 0},UE.bind(null,n,r,s,e),null),s},useId:function(){var t=ys(),e=ot.identifierPrefix;if(De){var s=si,n=ti;s=(n&~(1<<32-nn(n)-1)).toString(32)+s,e="_"+e+"R_"+s,s=Rf++,0<s&&(e+="H"+s.toString(32)),e+="_"}else s=fD++,e="_"+e+"r_"+s.toString(32)+"_";return t.memoizedState=e},useHostTransitionStatus:_v,useFormState:sw,useActionState:sw,useOptimistic:function(t){var e=ys();e.memoizedState=e.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=s,e=wv.bind(null,_e,!0,s),s.dispatch=e,[t,e]},useMemoCache:gv,useCacheRefresh:function(){return ys().memoizedState=vD.bind(null,_e)},useEffectEvent:function(t){var e=ys(),s={impl:t};return e.memoizedState=s,function(){if(Ue&2)throw Error(X(440));return s.impl.apply(void 0,arguments)}}},kv={readContext:ps,use:ip,useCallback:s2,useContext:ps,useEffect:bv,useImperativeHandle:t2,useInsertionEffect:JE,useLayoutEffect:ZE,useMemo:n2,useReducer:Xh,useRef:XE,useState:function(){return Xh(Wi)},useDebugValue:vv,useDeferredValue:function(t,e){var s=Pt();return i2(s,st.memoizedState,t,e)},useTransition:function(){var t=Xh(Wi)[0],e=Pt().memoizedState;return[typeof t=="boolean"?t:Td(t),e]},useSyncExternalStore:BE,useId:l2,useHostTransitionStatus:_v,useFormState:nw,useActionState:nw,useOptimistic:function(t,e){var s=Pt();return zE(s,st,t,e)},useMemoCache:gv,useCacheRefresh:c2};kv.useEffectEvent=QE;var m2={readContext:ps,use:ip,useCallback:s2,useContext:ps,useEffect:bv,useImperativeHandle:t2,useInsertionEffect:JE,useLayoutEffect:ZE,useMemo:n2,useReducer:N0,useRef:XE,useState:function(){return N0(Wi)},useDebugValue:vv,useDeferredValue:function(t,e){var s=Pt();return st===null?yv(s,t,e):i2(s,st.memoizedState,t,e)},useTransition:function(){var t=N0(Wi)[0],e=Pt().memoizedState;return[typeof t=="boolean"?t:Td(t),e]},useSyncExternalStore:BE,useId:l2,useHostTransitionStatus:_v,useFormState:iw,useActionState:iw,useOptimistic:function(t,e){var s=Pt();return st!==null?zE(s,st,t,e):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:gv,useCacheRefresh:c2};m2.useEffectEvent=QE;function S0(t,e,s,n){e=t.memoizedState,s=s(n,e),s=s==null?e:gt({},e,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var nx={enqueueSetState:function(t,e,s){t=t._reactInternals;var n=rn(),i=$r(n);i.payload=e,s!=null&&(i.callback=s),e=Hr(t,i,n),e!==null&&(Vs(e,t,n),ou(e,t,n))},enqueueReplaceState:function(t,e,s){t=t._reactInternals;var n=rn(),i=$r(n);i.tag=1,i.payload=e,s!=null&&(i.callback=s),e=Hr(t,i,n),e!==null&&(Vs(e,t,n),ou(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var s=rn(),n=$r(s);n.tag=2,e!=null&&(n.callback=e),e=Hr(t,n,s),e!==null&&(Vs(e,t,s),ou(e,t,s))}};function aw(t,e,s,n,i,r,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,r,a):e.prototype&&e.prototype.isPureReactComponent?!Iu(s,n)||!Iu(i,r):!0}function ow(t,e,s,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(s,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(s,n),e.state!==t&&nx.enqueueReplaceState(e,e.state,null)}function co(t,e){var s=e;if("ref"in e){s={};for(var n in e)n!=="ref"&&(s[n]=e[n])}if(t=t.defaultProps){s===e&&(s=gt({},s));for(var i in t)s[i]===void 0&&(s[i]=t[i])}return s}function p2(t){kf(t)}function g2(t){console.error(t)}function x2(t){kf(t)}function If(t,e){try{var s=t.onUncaughtError;s(e.value,{componentStack:e.stack})}catch(n){setTimeout(function(){throw n})}}function lw(t,e,s){try{var n=t.onCaughtError;n(s.value,{componentStack:s.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(i){setTimeout(function(){throw i})}}function ix(t,e,s){return s=$r(s),s.tag=3,s.payload={element:null},s.callback=function(){If(t,e)},s}function b2(t){return t=$r(t),t.tag=3,t}function v2(t,e,s,n){var i=s.type.getDerivedStateFromError;if(typeof i=="function"){var r=n.value;t.payload=function(){return i(r)},t.callback=function(){lw(e,s,n)}}var a=s.stateNode;a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){lw(e,s,n),typeof i!="function"&&(Gr===null?Gr=new Set([this]):Gr.add(this));var l=n.stack;this.componentDidCatch(n.value,{componentStack:l!==null?l:""})})}function _D(t,e,s,n,i){if(s.flags|=32768,n!==null&&typeof n=="object"&&typeof n.then=="function"){if(e=s.alternate,e!==null&&rc(e,s,i,!0),s=ln.current,s!==null){switch(s.tag){case 31:case 13:return yn===null?Pf():s.alternate===null&&Rt===0&&(Rt=3),s.flags&=-257,s.flags|=65536,s.lanes=i,n===Ef?s.flags|=16384:(e=s.updateQueue,e===null?s.updateQueue=new Set([n]):e.add(n),L0(t,n,i)),!1;case 22:return s.flags|=65536,n===Ef?s.flags|=16384:(e=s.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([n])},s.updateQueue=e):(s=e.retryQueue,s===null?e.retryQueue=new Set([n]):s.add(n)),L0(t,n,i)),!1}throw Error(X(435,s.tag))}return L0(t,n,i),Pf(),!1}if(De)return e=ln.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=i,n!==zg&&(t=Error(X(422),{cause:n}),Mu(gn(t,s)))):(n!==zg&&(e=Error(X(423),{cause:n}),Mu(gn(e,s))),t=t.current.alternate,t.flags|=65536,i&=-i,t.lanes|=i,n=gn(n,s),i=ix(t.stateNode,n,i),k0(t,i),Rt!==4&&(Rt=2)),!1;var r=Error(X(520),{cause:n});if(r=gn(r,s),fu===null?fu=[r]:fu.push(r),Rt!==4&&(Rt=2),e===null)return!0;n=gn(n,s),s=e;do{switch(s.tag){case 3:return s.flags|=65536,t=i&-i,s.lanes|=t,t=ix(s.stateNode,n,t),k0(s,t),!1;case 1:if(e=s.type,r=s.stateNode,(s.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||r!==null&&typeof r.componentDidCatch=="function"&&(Gr===null||!Gr.has(r))))return s.flags|=65536,i&=-i,s.lanes|=i,i=b2(i),v2(i,t,s,n),k0(s,i),!1}s=s.return}while(s!==null);return!1}var Nv=Error(X(461)),Gt=!1;function ds(t,e,s,n){e.child=t===null?OE(e,null,s,n):oo(e,t.child,s,n)}function cw(t,e,s,n,i){s=s.render;var r=e.ref;if("ref"in n){var a={};for(var l in n)l!=="ref"&&(a[l]=n[l])}else a=n;return ao(e),n=hv(t,e,s,a,r,i),l=fv(),t!==null&&!Gt?(mv(t,e,i),Yi(t,e,i)):(De&&l&&iv(e),e.flags|=1,ds(t,e,n,i),e.child)}function uw(t,e,s,n,i){if(t===null){var r=s.type;return typeof r=="function"&&!nv(r)&&r.defaultProps===void 0&&s.compare===null?(e.tag=15,e.type=r,y2(t,e,r,n,i)):(t=Wh(s.type,null,n,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!Sv(t,i)){var a=r.memoizedProps;if(s=s.compare,s=s!==null?s:Iu,s(a,n)&&t.ref===e.ref)return Yi(t,e,i)}return e.flags|=1,t=Bi(r,n),t.ref=e.ref,t.return=e,e.child=t}function y2(t,e,s,n,i){if(t!==null){var r=t.memoizedProps;if(Iu(r,n)&&t.ref===e.ref)if(Gt=!1,e.pendingProps=n=r,Sv(t,i))t.flags&131072&&(Gt=!0);else return e.lanes=t.lanes,Yi(t,e,i)}return rx(t,e,s,n,i)}function _2(t,e,s,n){var i=n.children,r=t!==null?t.memoizedState:null;if(t===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.mode==="hidden"){if(e.flags&128){if(r=r!==null?r.baseLanes|s:s,t!==null){for(n=e.child=t.child,i=0;n!==null;)i=i|n.lanes|n.childLanes,n=n.sibling;n=i&~r}else n=0,e.child=null;return dw(t,e,r,s,n)}if(s&536870912)e.memoizedState={baseLanes:0,cachePool:null},t!==null&&Yh(e,r!==null?r.cachePool:null),r!==null?Z1(e,r):Jg(),LE(e);else return n=e.lanes=536870912,dw(t,e,r!==null?r.baseLanes|s:s,s,n)}else r!==null?(Yh(e,r.cachePool),Z1(e,r),Sr(),e.memoizedState=null):(t!==null&&Yh(e,null),Jg(),Sr());return ds(t,e,i,s),e.child}function Xc(t,e){return t!==null&&t.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function dw(t,e,s,n,i){var r=ov();return r=r===null?null:{parent:Ht._currentValue,pool:r},e.memoizedState={baseLanes:s,cachePool:r},t!==null&&Yh(e,null),Jg(),LE(e),t!==null&&rc(t,e,n,!0),e.childLanes=i,null}function Jh(t,e){return e=Of({mode:e.mode,children:e.children},t.mode),e.ref=t.ref,t.child=e,e.return=t,e}function hw(t,e,s){return oo(e,t.child,null,s),t=Jh(e,e.pendingProps),t.flags|=2,Ks(e),e.memoizedState=null,t}function wD(t,e,s){var n=e.pendingProps,i=(e.flags&128)!==0;if(e.flags&=-129,t===null){if(De){if(n.mode==="hidden")return t=Jh(e,n),e.lanes=536870912,Xc(null,t);if(Zg(e),(t=ft)?(t=fA(t,xn),t=t!==null&&t.data==="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:na!==null?{id:ti,overflow:si}:null,retryLane:536870912,hydrationErrors:null},s=TE(t),s.return=e,e.child=s,fs=e,ft=null)):t=null,t===null)throw ia(e);return e.lanes=536870912,null}return Jh(e,n)}var r=t.memoizedState;if(r!==null){var a=r.dehydrated;if(Zg(e),i)if(e.flags&256)e.flags&=-257,e=hw(t,e,s);else if(e.memoizedState!==null)e.child=t.child,e.flags|=128,e=null;else throw Error(X(558));else if(Gt||rc(t,e,s,!1),i=(s&t.childLanes)!==0,Gt||i){if(n=ot,n!==null&&(a=JT(n,s),a!==0&&a!==r.retryLane))throw r.retryLane=a,No(t,a),Vs(n,t,a),Nv;Pf(),e=hw(t,e,s)}else t=r.treeContext,ft=_n(a.nextSibling),fs=e,De=!0,Ur=null,xn=!1,t!==null&&AE(e,t),e=Jh(e,n),e.flags|=4096;return e}return t=Bi(t.child,{mode:n.mode,children:n.children}),t.ref=e.ref,e.child=t,t.return=e,t}function Zh(t,e){var s=e.ref;if(s===null)t!==null&&t.ref!==null&&(e.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(X(284));(t===null||t.ref!==s)&&(e.flags|=4194816)}}function rx(t,e,s,n,i){return ao(e),s=hv(t,e,s,n,void 0,i),n=fv(),t!==null&&!Gt?(mv(t,e,i),Yi(t,e,i)):(De&&n&&iv(e),e.flags|=1,ds(t,e,s,i),e.child)}function fw(t,e,s,n,i,r){return ao(e),e.updateQueue=null,s=VE(e,n,s,i),PE(t),n=fv(),t!==null&&!Gt?(mv(t,e,r),Yi(t,e,r)):(De&&n&&iv(e),e.flags|=1,ds(t,e,s,r),e.child)}function mw(t,e,s,n,i){if(ao(e),e.stateNode===null){var r=Jo,a=s.contextType;typeof a=="object"&&a!==null&&(r=ps(a)),r=new s(n,r),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=nx,e.stateNode=r,r._reactInternals=e,r=e.stateNode,r.props=n,r.state=e.memoizedState,r.refs={},cv(e),a=s.contextType,r.context=typeof a=="object"&&a!==null?ps(a):Jo,r.state=e.memoizedState,a=s.getDerivedStateFromProps,typeof a=="function"&&(S0(e,s,a,n),r.state=e.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(a=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),a!==r.state&&nx.enqueueReplaceState(r,r.state,null),cu(e,n,r,i),lu(),r.state=e.memoizedState),typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!0}else if(t===null){r=e.stateNode;var l=e.memoizedProps,c=co(s,l);r.props=c;var u=r.context,d=s.contextType;a=Jo,typeof d=="object"&&d!==null&&(a=ps(d));var h=s.getDerivedStateFromProps;d=typeof h=="function"||typeof r.getSnapshotBeforeUpdate=="function",l=e.pendingProps!==l,d||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(l||u!==a)&&ow(e,r,n,a),_r=!1;var f=e.memoizedState;r.state=f,cu(e,n,r,i),lu(),u=e.memoizedState,l||f!==u||_r?(typeof h=="function"&&(S0(e,s,h,n),u=e.memoizedState),(c=_r||aw(e,s,c,n,f,u,a))?(d||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=u),r.props=n,r.state=u,r.context=a,n=c):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{r=e.stateNode,Xg(t,e),a=e.memoizedProps,d=co(s,a),r.props=d,h=e.pendingProps,f=r.context,u=s.contextType,c=Jo,typeof u=="object"&&u!==null&&(c=ps(u)),l=s.getDerivedStateFromProps,(u=typeof l=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==h||f!==c)&&ow(e,r,n,c),_r=!1,f=e.memoizedState,r.state=f,cu(e,n,r,i),lu();var m=e.memoizedState;a!==h||f!==m||_r||t!==null&&t.dependencies!==null&&Tf(t.dependencies)?(typeof l=="function"&&(S0(e,s,l,n),m=e.memoizedState),(d=_r||aw(e,s,d,n,f,m,c)||t!==null&&t.dependencies!==null&&Tf(t.dependencies))?(u||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(n,m,c),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(n,m,c)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),r.props=n,r.state=m,r.context=c,n=d):(typeof r.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return r=n,Zh(t,e),n=(e.flags&128)!==0,r||n?(r=e.stateNode,s=n&&typeof s.getDerivedStateFromError!="function"?null:r.render(),e.flags|=1,t!==null&&n?(e.child=oo(e,t.child,null,i),e.child=oo(e,null,s,i)):ds(t,e,s,i),e.memoizedState=r.state,t=e.child):t=Yi(t,e,i),t}function pw(t,e,s,n){return ro(),e.flags|=256,ds(t,e,s,n),e.child}var T0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function E0(t){return{baseLanes:t,cachePool:CE()}}function A0(t,e,s){return t=t!==null?t.childLanes&~s:0,e&&(t|=Qs),t}function w2(t,e,s){var n=e.pendingProps,i=!1,r=(e.flags&128)!==0,a;if((a=r)||(a=t!==null&&t.memoizedState===null?!1:(Dt.current&2)!==0),a&&(i=!0,e.flags&=-129),a=(e.flags&32)!==0,e.flags&=-33,t===null){if(De){if(i?Nr(e):Sr(),(t=ft)?(t=fA(t,xn),t=t!==null&&t.data!=="&"?t:null,t!==null&&(e.memoizedState={dehydrated:t,treeContext:na!==null?{id:ti,overflow:si}:null,retryLane:536870912,hydrationErrors:null},s=TE(t),s.return=e,e.child=s,fs=e,ft=null)):t=null,t===null)throw ia(e);return vx(t)?e.lanes=32:e.lanes=536870912,null}var l=n.children;return n=n.fallback,i?(Sr(),i=e.mode,l=Of({mode:"hidden",children:l},i),n=Ya(n,i,s,null),l.return=e,n.return=e,l.sibling=n,e.child=l,n=e.child,n.memoizedState=E0(s),n.childLanes=A0(t,a,s),e.memoizedState=T0,Xc(null,n)):(Nr(e),ax(e,l))}var c=t.memoizedState;if(c!==null&&(l=c.dehydrated,l!==null)){if(r)e.flags&256?(Nr(e),e.flags&=-257,e=j0(t,e,s)):e.memoizedState!==null?(Sr(),e.child=t.child,e.flags|=128,e=null):(Sr(),l=n.fallback,i=e.mode,n=Of({mode:"visible",children:n.children},i),l=Ya(l,i,s,null),l.flags|=2,n.return=e,l.return=e,n.sibling=l,e.child=n,oo(e,t.child,null,s),n=e.child,n.memoizedState=E0(s),n.childLanes=A0(t,a,s),e.memoizedState=T0,e=Xc(null,n));else if(Nr(e),vx(l)){if(a=l.nextSibling&&l.nextSibling.dataset,a)var u=a.dgst;a=u,n=Error(X(419)),n.stack="",n.digest=a,Mu({value:n,source:null,stack:null}),e=j0(t,e,s)}else if(Gt||rc(t,e,s,!1),a=(s&t.childLanes)!==0,Gt||a){if(a=ot,a!==null&&(n=JT(a,s),n!==0&&n!==c.retryLane))throw c.retryLane=n,No(t,n),Vs(a,t,n),Nv;bx(l)||Pf(),e=j0(t,e,s)}else bx(l)?(e.flags|=192,e.child=t.child,e=null):(t=c.treeContext,ft=_n(l.nextSibling),fs=e,De=!0,Ur=null,xn=!1,t!==null&&AE(e,t),e=ax(e,n.children),e.flags|=4096);return e}return i?(Sr(),l=n.fallback,i=e.mode,c=t.child,u=c.sibling,n=Bi(c,{mode:"hidden",children:n.children}),n.subtreeFlags=c.subtreeFlags&65011712,u!==null?l=Bi(u,l):(l=Ya(l,i,s,null),l.flags|=2),l.return=e,n.return=e,n.sibling=l,e.child=n,Xc(null,n),n=e.child,l=t.child.memoizedState,l===null?l=E0(s):(i=l.cachePool,i!==null?(c=Ht._currentValue,i=i.parent!==c?{parent:c,pool:c}:i):i=CE(),l={baseLanes:l.baseLanes|s,cachePool:i}),n.memoizedState=l,n.childLanes=A0(t,a,s),e.memoizedState=T0,Xc(t.child,n)):(Nr(e),s=t.child,t=s.sibling,s=Bi(s,{mode:"visible",children:n.children}),s.return=e,s.sibling=null,t!==null&&(a=e.deletions,a===null?(e.deletions=[t],e.flags|=16):a.push(t)),e.child=s,e.memoizedState=null,s)}function ax(t,e){return e=Of({mode:"visible",children:e},t.mode),e.return=t,t.child=e}function Of(t,e){return t=Ys(22,t,null,e),t.lanes=0,t}function j0(t,e,s){return oo(e,t.child,null,s),t=ax(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function gw(t,e,s){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Kg(t.return,e,s)}function C0(t,e,s,n,i,r){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:s,tailMode:i,treeForkCount:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=s,a.tailMode=i,a.treeForkCount=r)}function k2(t,e,s){var n=e.pendingProps,i=n.revealOrder,r=n.tail;n=n.children;var a=Dt.current,l=(a&2)!==0;if(l?(a=a&1|2,e.flags|=128):a&=1,ut(Dt,a),ds(t,e,n,s),n=De?Ou:0,!l&&t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&gw(t,s,e);else if(t.tag===19)gw(t,s,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(i){case"forwards":for(s=e.child,i=null;s!==null;)t=s.alternate,t!==null&&jf(t)===null&&(i=s),s=s.sibling;s=i,s===null?(i=e.child,e.child=null):(i=s.sibling,s.sibling=null),C0(e,!1,i,s,r,n);break;case"backwards":case"unstable_legacy-backwards":for(s=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&jf(t)===null){e.child=i;break}t=i.sibling,i.sibling=s,s=i,i=t}C0(e,!0,s,null,r,n);break;case"together":C0(e,!1,null,null,void 0,n);break;default:e.memoizedState=null}return e.child}function Yi(t,e,s){if(t!==null&&(e.dependencies=t.dependencies),aa|=e.lanes,!(s&e.childLanes))if(t!==null){if(rc(t,e,s,!1),(s&e.childLanes)===0)return null}else return null;if(t!==null&&e.child!==t.child)throw Error(X(153));if(e.child!==null){for(t=e.child,s=Bi(t,t.pendingProps),e.child=s,s.return=e;t.sibling!==null;)t=t.sibling,s=s.sibling=Bi(t,t.pendingProps),s.return=e;s.sibling=null}return e.child}function Sv(t,e){return t.lanes&e?!0:(t=t.dependencies,!!(t!==null&&Tf(t)))}function kD(t,e,s){switch(e.tag){case 3:vf(e,e.stateNode.containerInfo),kr(e,Ht,t.memoizedState.cache),ro();break;case 27:case 5:Mg(e);break;case 4:vf(e,e.stateNode.containerInfo);break;case 10:kr(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,Zg(e),null;break;case 13:var n=e.memoizedState;if(n!==null)return n.dehydrated!==null?(Nr(e),e.flags|=128,null):s&e.child.childLanes?w2(t,e,s):(Nr(e),t=Yi(t,e,s),t!==null?t.sibling:null);Nr(e);break;case 19:var i=(t.flags&128)!==0;if(n=(s&e.childLanes)!==0,n||(rc(t,e,s,!1),n=(s&e.childLanes)!==0),i){if(n)return k2(t,e,s);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ut(Dt,Dt.current),n)break;return null;case 22:return e.lanes=0,_2(t,e,s,e.pendingProps);case 24:kr(e,Ht,t.memoizedState.cache)}return Yi(t,e,s)}function N2(t,e,s){if(t!==null)if(t.memoizedProps!==e.pendingProps)Gt=!0;else{if(!Sv(t,s)&&!(e.flags&128))return Gt=!1,kD(t,e,s);Gt=!!(t.flags&131072)}else Gt=!1,De&&e.flags&1048576&&EE(e,Ou,e.index);switch(e.lanes=0,e.tag){case 16:e:{var n=e.pendingProps;if(t=La(e.elementType),e.type=t,typeof t=="function")nv(t)?(n=co(t,n),e.tag=1,e=mw(null,e,t,n,s)):(e.tag=0,e=rx(null,e,t,n,s));else{if(t!=null){var i=t.$$typeof;if(i===Hb){e.tag=11,e=cw(null,e,t,n,s);break e}else if(i===Gb){e.tag=14,e=uw(null,e,t,n,s);break e}}throw e=Ig(t)||t,Error(X(306,e,""))}}return e;case 0:return rx(t,e,e.type,e.pendingProps,s);case 1:return n=e.type,i=co(n,e.pendingProps),mw(t,e,n,i,s);case 3:e:{if(vf(e,e.stateNode.containerInfo),t===null)throw Error(X(387));n=e.pendingProps;var r=e.memoizedState;i=r.element,Xg(t,e),cu(e,n,null,s);var a=e.memoizedState;if(n=a.cache,kr(e,Ht,n),n!==r.cache&&Wg(e,[Ht],s,!0),lu(),n=a.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:a.cache},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){e=pw(t,e,n,s);break e}else if(n!==i){i=gn(Error(X(424)),e),Mu(i),e=pw(t,e,n,s);break e}else{switch(t=e.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(ft=_n(t.firstChild),fs=e,De=!0,Ur=null,xn=!0,s=OE(e,null,n,s),e.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling}else{if(ro(),n===i){e=Yi(t,e,s);break e}ds(t,e,n,s)}e=e.child}return e;case 26:return Zh(t,e),t===null?(s=Lw(e.type,null,e.pendingProps,null))?e.memoizedState=s:De||(s=e.type,t=e.pendingProps,n=Uf(Fr.current).createElement(s),n[hs]=e,n[Us]=t,gs(n,s,t),is(n),e.stateNode=n):e.memoizedState=Lw(e.type,t.memoizedProps,e.pendingProps,t.memoizedState),null;case 27:return Mg(e),t===null&&De&&(n=e.stateNode=mA(e.type,e.pendingProps,Fr.current),fs=e,xn=!0,i=ft,wa(e.type)?(yx=i,ft=_n(n.firstChild)):ft=i),ds(t,e,e.pendingProps.children,s),Zh(t,e),t===null&&(e.flags|=4194304),e.child;case 5:return t===null&&De&&((i=n=ft)&&(n=ZD(n,e.type,e.pendingProps,xn),n!==null?(e.stateNode=n,fs=e,ft=_n(n.firstChild),xn=!1,i=!0):i=!1),i||ia(e)),Mg(e),i=e.type,r=e.pendingProps,a=t!==null?t.memoizedProps:null,n=r.children,gx(i,r)?n=null:a!==null&&gx(i,a)&&(e.flags|=32),e.memoizedState!==null&&(i=hv(t,e,mD,null,null,s),Fu._currentValue=i),Zh(t,e),ds(t,e,n,s),e.child;case 6:return t===null&&De&&((t=s=ft)&&(s=e4(s,e.pendingProps,xn),s!==null?(e.stateNode=s,fs=e,ft=null,t=!0):t=!1),t||ia(e)),null;case 13:return w2(t,e,s);case 4:return vf(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=oo(e,null,n,s):ds(t,e,n,s),e.child;case 11:return cw(t,e,e.type,e.pendingProps,s);case 7:return ds(t,e,e.pendingProps,s),e.child;case 8:return ds(t,e,e.pendingProps.children,s),e.child;case 12:return ds(t,e,e.pendingProps.children,s),e.child;case 10:return n=e.pendingProps,kr(e,e.type,n.value),ds(t,e,n.children,s),e.child;case 9:return i=e.type._context,n=e.pendingProps.children,ao(e),i=ps(i),n=n(i),e.flags|=1,ds(t,e,n,s),e.child;case 14:return uw(t,e,e.type,e.pendingProps,s);case 15:return y2(t,e,e.type,e.pendingProps,s);case 19:return k2(t,e,s);case 31:return wD(t,e,s);case 22:return _2(t,e,s,e.pendingProps);case 24:return ao(e),n=ps(Ht),t===null?(i=ov(),i===null&&(i=ot,r=av(),i.pooledCache=r,r.refCount++,r!==null&&(i.pooledCacheLanes|=s),i=r),e.memoizedState={parent:n,cache:i},cv(e),kr(e,Ht,i)):(t.lanes&s&&(Xg(t,e),cu(e,null,null,s),lu()),i=t.memoizedState,r=e.memoizedState,i.parent!==n?(i={parent:n,cache:n},e.memoizedState=i,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=i),kr(e,Ht,n)):(n=r.cache,kr(e,Ht,n),n!==i.cache&&Wg(e,[Ht],s,!0))),ds(t,e,e.pendingProps.children,s),e.child;case 29:throw e.pendingProps}throw Error(X(156,e.tag))}function wi(t){t.flags|=4}function R0(t,e,s,n,i){if((e=(t.mode&32)!==0)&&(e=!1),e){if(t.flags|=16777216,(i&335544128)===i)if(t.stateNode.complete)t.flags|=8192;else if(W2())t.flags|=8192;else throw Qa=Ef,lv}else t.flags&=-16777217}function xw(t,e){if(e.type!=="stylesheet"||e.state.loading&4)t.flags&=-16777217;else if(t.flags|=16777216,!xA(e))if(W2())t.flags|=8192;else throw Qa=Ef,lv}function kh(t,e){e!==null&&(t.flags|=4),t.flags&16384&&(e=t.tag!==22?YT():536870912,t.lanes|=e,Ll|=e)}function Bc(t,e){if(!De)switch(t.tailMode){case"hidden":e=t.tail;for(var s=null;e!==null;)e.alternate!==null&&(s=e),e=e.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var n=null;s!==null;)s.alternate!==null&&(n=s),s=s.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function ht(t){var e=t.alternate!==null&&t.alternate.child===t.child,s=0,n=0;if(e)for(var i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags&65011712,n|=i.flags&65011712,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)s|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=n,t.childLanes=s,e}function ND(t,e,s){var n=e.pendingProps;switch(rv(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ht(e),null;case 1:return ht(e),null;case 3:return s=e.stateNode,n=null,t!==null&&(n=t.memoizedState.cache),e.memoizedState.cache!==n&&(e.flags|=2048),Fi(Ht),Cl(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Mo(e)?wi(e):t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,w0())),ht(e),null;case 26:var i=e.type,r=e.memoizedState;return t===null?(wi(e),r!==null?(ht(e),xw(e,r)):(ht(e),R0(e,i,null,n,s))):r?r!==t.memoizedState?(wi(e),ht(e),xw(e,r)):(ht(e),e.flags&=-16777217):(t=t.memoizedProps,t!==n&&wi(e),ht(e),R0(e,i,t,n,s)),null;case 27:if(yf(e),s=Fr.current,i=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==n&&wi(e);else{if(!n){if(e.stateNode===null)throw Error(X(166));return ht(e),null}t=ii.current,Mo(e)?q1(e):(t=mA(i,n,s),e.stateNode=t,wi(e))}return ht(e),null;case 5:if(yf(e),i=e.type,t!==null&&e.stateNode!=null)t.memoizedProps!==n&&wi(e);else{if(!n){if(e.stateNode===null)throw Error(X(166));return ht(e),null}if(r=ii.current,Mo(e))q1(e);else{var a=Uf(Fr.current);switch(r){case 1:r=a.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:r=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":r=a.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":r=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":r=a.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof n.is=="string"?a.createElement("select",{is:n.is}):a.createElement("select"),n.multiple?r.multiple=!0:n.size&&(r.size=n.size);break;default:r=typeof n.is=="string"?a.createElement(i,{is:n.is}):a.createElement(i)}}r[hs]=e,r[Us]=n;e:for(a=e.child;a!==null;){if(a.tag===5||a.tag===6)r.appendChild(a.stateNode);else if(a.tag!==4&&a.tag!==27&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===e)break e;for(;a.sibling===null;){if(a.return===null||a.return===e)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}e.stateNode=r;e:switch(gs(r,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&wi(e)}}return ht(e),R0(e,e.type,t===null?null:t.memoizedProps,e.pendingProps,s),null;case 6:if(t&&e.stateNode!=null)t.memoizedProps!==n&&wi(e);else{if(typeof n!="string"&&e.stateNode===null)throw Error(X(166));if(t=Fr.current,Mo(e)){if(t=e.stateNode,s=e.memoizedProps,n=null,i=fs,i!==null)switch(i.tag){case 27:case 5:n=i.memoizedProps}t[hs]=e,t=!!(t.nodeValue===s||n!==null&&n.suppressHydrationWarning===!0||uA(t.nodeValue,s)),t||ia(e,!0)}else t=Uf(t).createTextNode(n),t[hs]=e,e.stateNode=t}return ht(e),null;case 31:if(s=e.memoizedState,t===null||t.memoizedState!==null){if(n=Mo(e),s!==null){if(t===null){if(!n)throw Error(X(318));if(t=e.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(X(557));t[hs]=e}else ro(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ht(e),t=!1}else s=w0(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return e.flags&256?(Ks(e),e):(Ks(e),null);if(e.flags&128)throw Error(X(558))}return ht(e),null;case 13:if(n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(i=Mo(e),n!==null&&n.dehydrated!==null){if(t===null){if(!i)throw Error(X(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(X(317));i[hs]=e}else ro(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ht(e),i=!1}else i=w0(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=i),i=!0;if(!i)return e.flags&256?(Ks(e),e):(Ks(e),null)}return Ks(e),e.flags&128?(e.lanes=s,e):(s=n!==null,t=t!==null&&t.memoizedState!==null,s&&(n=e.child,i=null,n.alternate!==null&&n.alternate.memoizedState!==null&&n.alternate.memoizedState.cachePool!==null&&(i=n.alternate.memoizedState.cachePool.pool),r=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),r!==i&&(n.flags|=2048)),s!==t&&s&&(e.child.flags|=8192),kh(e,e.updateQueue),ht(e),null);case 4:return Cl(),t===null&&Iv(e.stateNode.containerInfo),ht(e),null;case 10:return Fi(e.type),ht(e),null;case 19:if(as(Dt),n=e.memoizedState,n===null)return ht(e),null;if(i=(e.flags&128)!==0,r=n.rendering,r===null)if(i)Bc(n,!1);else{if(Rt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(r=jf(t),r!==null){for(e.flags|=128,Bc(n,!1),t=r.updateQueue,e.updateQueue=t,kh(e,t),e.subtreeFlags=0,t=s,s=e.child;s!==null;)SE(s,t),s=s.sibling;return ut(Dt,Dt.current&1|2),De&&ji(e,n.treeForkCount),e.child}t=t.sibling}n.tail!==null&&tn()>Df&&(e.flags|=128,i=!0,Bc(n,!1),e.lanes=4194304)}else{if(!i)if(t=jf(r),t!==null){if(e.flags|=128,i=!0,t=t.updateQueue,e.updateQueue=t,kh(e,t),Bc(n,!0),n.tail===null&&n.tailMode==="hidden"&&!r.alternate&&!De)return ht(e),null}else 2*tn()-n.renderingStartTime>Df&&s!==536870912&&(e.flags|=128,i=!0,Bc(n,!1),e.lanes=4194304);n.isBackwards?(r.sibling=e.child,e.child=r):(t=n.last,t!==null?t.sibling=r:e.child=r,n.last=r)}return n.tail!==null?(t=n.tail,n.rendering=t,n.tail=t.sibling,n.renderingStartTime=tn(),t.sibling=null,s=Dt.current,ut(Dt,i?s&1|2:s&1),De&&ji(e,n.treeForkCount),t):(ht(e),null);case 22:case 23:return Ks(e),uv(),n=e.memoizedState!==null,t!==null?t.memoizedState!==null!==n&&(e.flags|=8192):n&&(e.flags|=8192),n?s&536870912&&!(e.flags&128)&&(ht(e),e.subtreeFlags&6&&(e.flags|=8192)):ht(e),s=e.updateQueue,s!==null&&kh(e,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),n=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(n=e.memoizedState.cachePool.pool),n!==s&&(e.flags|=2048),t!==null&&as(Xa),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),e.memoizedState.cache!==s&&(e.flags|=2048),Fi(Ht),ht(e),null;case 25:return null;case 30:return null}throw Error(X(156,e.tag))}function SD(t,e){switch(rv(e),e.tag){case 1:return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Fi(Ht),Cl(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 26:case 27:case 5:return yf(e),null;case 31:if(e.memoizedState!==null){if(Ks(e),e.alternate===null)throw Error(X(340));ro()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 13:if(Ks(e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(X(340));ro()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return as(Dt),null;case 4:return Cl(),null;case 10:return Fi(e.type),null;case 22:case 23:return Ks(e),uv(),t!==null&&as(Xa),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 24:return Fi(Ht),null;case 25:return null;default:return null}}function S2(t,e){switch(rv(e),e.tag){case 3:Fi(Ht),Cl();break;case 26:case 27:case 5:yf(e);break;case 4:Cl();break;case 31:e.memoizedState!==null&&Ks(e);break;case 13:Ks(e);break;case 19:as(Dt);break;case 10:Fi(e.type);break;case 22:case 23:Ks(e),uv(),t!==null&&as(Xa);break;case 24:Fi(Ht)}}function Ed(t,e){try{var s=e.updateQueue,n=s!==null?s.lastEffect:null;if(n!==null){var i=n.next;s=i;do{if((s.tag&t)===t){n=void 0;var r=s.create,a=s.inst;n=r(),a.destroy=n}s=s.next}while(s!==i)}}catch(l){Ye(e,e.return,l)}}function ra(t,e,s){try{var n=e.updateQueue,i=n!==null?n.lastEffect:null;if(i!==null){var r=i.next;n=r;do{if((n.tag&t)===t){var a=n.inst,l=a.destroy;if(l!==void 0){a.destroy=void 0,i=e;var c=s,u=l;try{u()}catch(d){Ye(i,c,d)}}}n=n.next}while(n!==r)}}catch(d){Ye(e,e.return,d)}}function T2(t){var e=t.updateQueue;if(e!==null){var s=t.stateNode;try{DE(e,s)}catch(n){Ye(t,t.return,n)}}}function E2(t,e,s){s.props=co(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(n){Ye(t,e,n)}}function du(t,e){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var n=t.stateNode;break;case 30:n=t.stateNode;break;default:n=t.stateNode}typeof s=="function"?t.refCleanup=s(n):s.current=n}}catch(i){Ye(t,e,i)}}function ni(t,e){var s=t.ref,n=t.refCleanup;if(s!==null)if(typeof n=="function")try{n()}catch(i){Ye(t,e,i)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(i){Ye(t,e,i)}else s.current=null}function A2(t){var e=t.type,s=t.memoizedProps,n=t.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break e;case"img":s.src?n.src=s.src:s.srcSet&&(n.srcset=s.srcSet)}}catch(i){Ye(t,t.return,i)}}function I0(t,e,s){try{var n=t.stateNode;KD(n,t.type,s,e),n[Us]=e}catch(i){Ye(t,t.return,i)}}function j2(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&wa(t.type)||t.tag===4}function O0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||j2(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&wa(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ox(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,e):(e=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,e.appendChild(t),s=s._reactRootContainer,s!=null||e.onclick!==null||(e.onclick=Ii));else if(n!==4&&(n===27&&wa(t.type)&&(s=t.stateNode,e=null),t=t.child,t!==null))for(ox(t,e,s),t=t.sibling;t!==null;)ox(t,e,s),t=t.sibling}function Mf(t,e,s){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?s.insertBefore(t,e):s.appendChild(t);else if(n!==4&&(n===27&&wa(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Mf(t,e,s),t=t.sibling;t!==null;)Mf(t,e,s),t=t.sibling}function C2(t){var e=t.stateNode,s=t.memoizedProps;try{for(var n=t.type,i=e.attributes;i.length;)e.removeAttributeNode(i[0]);gs(e,n,s),e[hs]=t,e[Us]=s}catch(r){Ye(t,t.return,r)}}var Ci=!1,$t=!1,M0=!1,bw=typeof WeakSet=="function"?WeakSet:Set,ss=null;function TD(t,e){if(t=t.containerInfo,mx=zf,t=xE(t),ev(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var n=s.getSelection&&s.getSelection();if(n&&n.rangeCount!==0){s=n.anchorNode;var i=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{s.nodeType,r.nodeType}catch{s=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=t,f=null;t:for(;;){for(var m;h!==s||i!==0&&h.nodeType!==3||(l=a+i),h!==r||n!==0&&h.nodeType!==3||(c=a+n),h.nodeType===3&&(a+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===s&&++u===i&&(l=a),f===r&&++d===n&&(c=a),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}s=l===-1||c===-1?null:{start:l,end:c}}else s=null}s=s||{start:0,end:0}}else s=null;for(px={focusedElem:t,selectionRange:s},zf=!1,ss=e;ss!==null;)if(e=ss,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ss=t;else for(;ss!==null;){switch(e=ss,r=e.alternate,t=e.flags,e.tag){case 0:if(t&4&&(t=e.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)i=t[s],i.ref.impl=i.nextImpl;break;case 11:case 15:break;case 1:if(t&1024&&r!==null){t=void 0,s=e,i=r.memoizedProps,r=r.memoizedState,n=s.stateNode;try{var b=co(s.type,i);t=n.getSnapshotBeforeUpdate(b,r),n.__reactInternalSnapshotBeforeUpdate=t}catch(x){Ye(s,s.return,x)}}break;case 3:if(t&1024){if(t=e.stateNode.containerInfo,s=t.nodeType,s===9)xx(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":xx(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(t&1024)throw Error(X(163))}if(t=e.sibling,t!==null){t.return=e.return,ss=t;break}ss=e.return}}function R2(t,e,s){var n=s.flags;switch(s.tag){case 0:case 11:case 15:Ni(t,s),n&4&&Ed(5,s);break;case 1:if(Ni(t,s),n&4)if(t=s.stateNode,e===null)try{t.componentDidMount()}catch(a){Ye(s,s.return,a)}else{var i=co(s.type,e.memoizedProps);e=e.memoizedState;try{t.componentDidUpdate(i,e,t.__reactInternalSnapshotBeforeUpdate)}catch(a){Ye(s,s.return,a)}}n&64&&T2(s),n&512&&du(s,s.return);break;case 3:if(Ni(t,s),n&64&&(t=s.updateQueue,t!==null)){if(e=null,s.child!==null)switch(s.child.tag){case 27:case 5:e=s.child.stateNode;break;case 1:e=s.child.stateNode}try{DE(t,e)}catch(a){Ye(s,s.return,a)}}break;case 27:e===null&&n&4&&C2(s);case 26:case 5:Ni(t,s),e===null&&n&4&&A2(s),n&512&&du(s,s.return);break;case 12:Ni(t,s);break;case 31:Ni(t,s),n&4&&M2(t,s);break;case 13:Ni(t,s),n&4&&D2(t,s),n&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=DD.bind(null,s),t4(t,s))));break;case 22:if(n=s.memoizedState!==null||Ci,!n){e=e!==null&&e.memoizedState!==null||$t,i=Ci;var r=$t;Ci=n,($t=e)&&!r?Ei(t,s,(s.subtreeFlags&8772)!==0):Ni(t,s),Ci=i,$t=r}break;case 30:break;default:Ni(t,s)}}function I2(t){var e=t.alternate;e!==null&&(t.alternate=null,I2(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&Wb(e)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var xt=null,Os=!1;function ki(t,e,s){for(s=s.child;s!==null;)O2(t,e,s),s=s.sibling}function O2(t,e,s){if(sn&&typeof sn.onCommitFiberUnmount=="function")try{sn.onCommitFiberUnmount(yd,s)}catch{}switch(s.tag){case 26:$t||ni(s,e),ki(t,e,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:$t||ni(s,e);var n=xt,i=Os;wa(s.type)&&(xt=s.stateNode,Os=!1),ki(t,e,s),pu(s.stateNode),xt=n,Os=i;break;case 5:$t||ni(s,e);case 6:if(n=xt,i=Os,xt=null,ki(t,e,s),xt=n,Os=i,xt!==null)if(Os)try{(xt.nodeType===9?xt.body:xt.nodeName==="HTML"?xt.ownerDocument.body:xt).removeChild(s.stateNode)}catch(r){Ye(s,e,r)}else try{xt.removeChild(s.stateNode)}catch(r){Ye(s,e,r)}break;case 18:xt!==null&&(Os?(t=xt,Rw(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),Fl(t)):Rw(xt,s.stateNode));break;case 4:n=xt,i=Os,xt=s.stateNode.containerInfo,Os=!0,ki(t,e,s),xt=n,Os=i;break;case 0:case 11:case 14:case 15:ra(2,s,e),$t||ra(4,s,e),ki(t,e,s);break;case 1:$t||(ni(s,e),n=s.stateNode,typeof n.componentWillUnmount=="function"&&E2(s,e,n)),ki(t,e,s);break;case 21:ki(t,e,s);break;case 22:$t=(n=$t)||s.memoizedState!==null,ki(t,e,s),$t=n;break;default:ki(t,e,s)}}function M2(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Fl(t)}catch(s){Ye(e,e.return,s)}}}function D2(t,e){if(e.memoizedState===null&&(t=e.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Fl(t)}catch(s){Ye(e,e.return,s)}}function ED(t){switch(t.tag){case 31:case 13:case 19:var e=t.stateNode;return e===null&&(e=t.stateNode=new bw),e;case 22:return t=t.stateNode,e=t._retryCache,e===null&&(e=t._retryCache=new bw),e;default:throw Error(X(435,t.tag))}}function Nh(t,e){var s=ED(t);e.forEach(function(n){if(!s.has(n)){s.add(n);var i=LD.bind(null,t,n);n.then(i,i)}})}function Rs(t,e){var s=e.deletions;if(s!==null)for(var n=0;n<s.length;n++){var i=s[n],r=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 27:if(wa(l.type)){xt=l.stateNode,Os=!1;break e}break;case 5:xt=l.stateNode,Os=!1;break e;case 3:case 4:xt=l.stateNode.containerInfo,Os=!0;break e}l=l.return}if(xt===null)throw Error(X(160));O2(r,a,i),xt=null,Os=!1,r=i.alternate,r!==null&&(r.return=null),i.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)L2(e,t),e=e.sibling}var Mn=null;function L2(t,e){var s=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Rs(e,t),Is(t),n&4&&(ra(3,t,t.return),Ed(3,t),ra(5,t,t.return));break;case 1:Rs(e,t),Is(t),n&512&&($t||s===null||ni(s,s.return)),n&64&&Ci&&(t=t.updateQueue,t!==null&&(n=t.callbacks,n!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?n:s.concat(n))));break;case 26:var i=Mn;if(Rs(e,t),Is(t),n&512&&($t||s===null||ni(s,s.return)),n&4){var r=s!==null?s.memoizedState:null;if(n=t.memoizedState,s===null)if(n===null)if(t.stateNode===null){e:{n=t.type,s=t.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":r=i.getElementsByTagName("title")[0],(!r||r[kd]||r[hs]||r.namespaceURI==="http://www.w3.org/2000/svg"||r.hasAttribute("itemprop"))&&(r=i.createElement(n),i.head.insertBefore(r,i.querySelector("head > title"))),gs(r,n,s),r[hs]=t,is(r),n=r;break e;case"link":var a=Vw("link","href",i).get(n+(s.href||""));if(a){for(var l=0;l<a.length;l++)if(r=a[l],r.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&r.getAttribute("rel")===(s.rel==null?null:s.rel)&&r.getAttribute("title")===(s.title==null?null:s.title)&&r.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){a.splice(l,1);break t}}r=i.createElement(n),gs(r,n,s),i.head.appendChild(r);break;case"meta":if(a=Vw("meta","content",i).get(n+(s.content||""))){for(l=0;l<a.length;l++)if(r=a[l],r.getAttribute("content")===(s.content==null?null:""+s.content)&&r.getAttribute("name")===(s.name==null?null:s.name)&&r.getAttribute("property")===(s.property==null?null:s.property)&&r.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&r.getAttribute("charset")===(s.charSet==null?null:s.charSet)){a.splice(l,1);break t}}r=i.createElement(n),gs(r,n,s),i.head.appendChild(r);break;default:throw Error(X(468,n))}r[hs]=t,is(r),n=r}t.stateNode=n}else Bw(i,t.type,t.stateNode);else t.stateNode=Pw(i,n,t.memoizedProps);else r!==n?(r===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):r.count--,n===null?Bw(i,t.type,t.stateNode):Pw(i,n,t.memoizedProps)):n===null&&t.stateNode!==null&&I0(t,t.memoizedProps,s.memoizedProps)}break;case 27:Rs(e,t),Is(t),n&512&&($t||s===null||ni(s,s.return)),s!==null&&n&4&&I0(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Rs(e,t),Is(t),n&512&&($t||s===null||ni(s,s.return)),t.flags&32){i=t.stateNode;try{Il(i,"")}catch(b){Ye(t,t.return,b)}}n&4&&t.stateNode!=null&&(i=t.memoizedProps,I0(t,i,s!==null?s.memoizedProps:i)),n&1024&&(M0=!0);break;case 6:if(Rs(e,t),Is(t),n&4){if(t.stateNode===null)throw Error(X(162));n=t.memoizedProps,s=t.stateNode;try{s.nodeValue=n}catch(b){Ye(t,t.return,b)}}break;case 3:if(sf=null,i=Mn,Mn=$f(e.containerInfo),Rs(e,t),Mn=i,Is(t),n&4&&s!==null&&s.memoizedState.isDehydrated)try{Fl(e.containerInfo)}catch(b){Ye(t,t.return,b)}M0&&(M0=!1,P2(t));break;case 4:n=Mn,Mn=$f(t.stateNode.containerInfo),Rs(e,t),Is(t),Mn=n;break;case 12:Rs(e,t),Is(t);break;case 31:Rs(e,t),Is(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Nh(t,n)));break;case 13:Rs(e,t),Is(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(op=tn()),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Nh(t,n)));break;case 22:i=t.memoizedState!==null;var c=s!==null&&s.memoizedState!==null,u=Ci,d=$t;if(Ci=u||i,$t=d||c,Rs(e,t),$t=d,Ci=u,Is(t),n&8192)e:for(e=t.stateNode,e._visibility=i?e._visibility&-2:e._visibility|1,i&&(s===null||c||Ci||$t||Pa(t)),s=null,e=t;;){if(e.tag===5||e.tag===26){if(s===null){c=s=e;try{if(r=c.stateNode,i)a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,f=h!=null&&h.hasOwnProperty("display")?h.display:null;l.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(b){Ye(c,c.return,b)}}}else if(e.tag===6){if(s===null){c=e;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(b){Ye(c,c.return,b)}}}else if(e.tag===18){if(s===null){c=e;try{var m=c.stateNode;i?Iw(m,!0):Iw(c.stateNode,!1)}catch(b){Ye(c,c.return,b)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===t)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;s===e&&(s=null),e=e.return}s===e&&(s=null),e.sibling.return=e.return,e=e.sibling}n&4&&(n=t.updateQueue,n!==null&&(s=n.retryQueue,s!==null&&(n.retryQueue=null,Nh(t,s))));break;case 19:Rs(e,t),Is(t),n&4&&(n=t.updateQueue,n!==null&&(t.updateQueue=null,Nh(t,n)));break;case 30:break;case 21:break;default:Rs(e,t),Is(t)}}function Is(t){var e=t.flags;if(e&2){try{for(var s,n=t.return;n!==null;){if(j2(n)){s=n;break}n=n.return}if(s==null)throw Error(X(160));switch(s.tag){case 27:var i=s.stateNode,r=O0(t);Mf(t,r,i);break;case 5:var a=s.stateNode;s.flags&32&&(Il(a,""),s.flags&=-33);var l=O0(t);Mf(t,l,a);break;case 3:case 4:var c=s.stateNode.containerInfo,u=O0(t);ox(t,u,c);break;default:throw Error(X(161))}}catch(d){Ye(t,t.return,d)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function P2(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var e=t;P2(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),t=t.sibling}}function Ni(t,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)R2(t,e.alternate,e),e=e.sibling}function Pa(t){for(t=t.child;t!==null;){var e=t;switch(e.tag){case 0:case 11:case 14:case 15:ra(4,e,e.return),Pa(e);break;case 1:ni(e,e.return);var s=e.stateNode;typeof s.componentWillUnmount=="function"&&E2(e,e.return,s),Pa(e);break;case 27:pu(e.stateNode);case 26:case 5:ni(e,e.return),Pa(e);break;case 22:e.memoizedState===null&&Pa(e);break;case 30:Pa(e);break;default:Pa(e)}t=t.sibling}}function Ei(t,e,s){for(s=s&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var n=e.alternate,i=t,r=e,a=r.flags;switch(r.tag){case 0:case 11:case 15:Ei(i,r,s),Ed(4,r);break;case 1:if(Ei(i,r,s),n=r,i=n.stateNode,typeof i.componentDidMount=="function")try{i.componentDidMount()}catch(u){Ye(n,n.return,u)}if(n=r,i=n.updateQueue,i!==null){var l=n.stateNode;try{var c=i.shared.hiddenCallbacks;if(c!==null)for(i.shared.hiddenCallbacks=null,i=0;i<c.length;i++)ME(c[i],l)}catch(u){Ye(n,n.return,u)}}s&&a&64&&T2(r),du(r,r.return);break;case 27:C2(r);case 26:case 5:Ei(i,r,s),s&&n===null&&a&4&&A2(r),du(r,r.return);break;case 12:Ei(i,r,s);break;case 31:Ei(i,r,s),s&&a&4&&M2(i,r);break;case 13:Ei(i,r,s),s&&a&4&&D2(i,r);break;case 22:r.memoizedState===null&&Ei(i,r,s),du(r,r.return);break;case 30:break;default:Ei(i,r,s)}e=e.sibling}}function Tv(t,e){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(t=e.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Sd(s))}function Ev(t,e){t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Sd(t))}function Cn(t,e,s,n){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)V2(t,e,s,n),e=e.sibling}function V2(t,e,s,n){var i=e.flags;switch(e.tag){case 0:case 11:case 15:Cn(t,e,s,n),i&2048&&Ed(9,e);break;case 1:Cn(t,e,s,n);break;case 3:Cn(t,e,s,n),i&2048&&(t=null,e.alternate!==null&&(t=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==t&&(e.refCount++,t!=null&&Sd(t)));break;case 12:if(i&2048){Cn(t,e,s,n),t=e.stateNode;try{var r=e.memoizedProps,a=r.id,l=r.onPostCommit;typeof l=="function"&&l(a,e.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(c){Ye(e,e.return,c)}}else Cn(t,e,s,n);break;case 31:Cn(t,e,s,n);break;case 13:Cn(t,e,s,n);break;case 23:break;case 22:r=e.stateNode,a=e.alternate,e.memoizedState!==null?r._visibility&2?Cn(t,e,s,n):hu(t,e):r._visibility&2?Cn(t,e,s,n):(r._visibility|=2,Uo(t,e,s,n,(e.subtreeFlags&10256)!==0||!1)),i&2048&&Tv(a,e);break;case 24:Cn(t,e,s,n),i&2048&&Ev(e.alternate,e);break;default:Cn(t,e,s,n)}}function Uo(t,e,s,n,i){for(i=i&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var r=t,a=e,l=s,c=n,u=a.flags;switch(a.tag){case 0:case 11:case 15:Uo(r,a,l,c,i),Ed(8,a);break;case 23:break;case 22:var d=a.stateNode;a.memoizedState!==null?d._visibility&2?Uo(r,a,l,c,i):hu(r,a):(d._visibility|=2,Uo(r,a,l,c,i)),i&&u&2048&&Tv(a.alternate,a);break;case 24:Uo(r,a,l,c,i),i&&u&2048&&Ev(a.alternate,a);break;default:Uo(r,a,l,c,i)}e=e.sibling}}function hu(t,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var s=t,n=e,i=n.flags;switch(n.tag){case 22:hu(s,n),i&2048&&Tv(n.alternate,n);break;case 24:hu(s,n),i&2048&&Ev(n.alternate,n);break;default:hu(s,n)}e=e.sibling}}var Qc=8192;function Do(t,e,s){if(t.subtreeFlags&Qc)for(t=t.child;t!==null;)B2(t,e,s),t=t.sibling}function B2(t,e,s){switch(t.tag){case 26:Do(t,e,s),t.flags&Qc&&t.memoizedState!==null&&f4(s,Mn,t.memoizedState,t.memoizedProps);break;case 5:Do(t,e,s);break;case 3:case 4:var n=Mn;Mn=$f(t.stateNode.containerInfo),Do(t,e,s),Mn=n;break;case 22:t.memoizedState===null&&(n=t.alternate,n!==null&&n.memoizedState!==null?(n=Qc,Qc=16777216,Do(t,e,s),Qc=n):Do(t,e,s));break;default:Do(t,e,s)}}function F2(t){var e=t.alternate;if(e!==null&&(t=e.child,t!==null)){e.child=null;do e=t.sibling,t.sibling=null,t=e;while(t!==null)}}function Fc(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var s=0;s<e.length;s++){var n=e[s];ss=n,$2(n,t)}F2(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)U2(t),t=t.sibling}function U2(t){switch(t.tag){case 0:case 11:case 15:Fc(t),t.flags&2048&&ra(9,t,t.return);break;case 3:Fc(t);break;case 12:Fc(t);break;case 22:var e=t.stateNode;t.memoizedState!==null&&e._visibility&2&&(t.return===null||t.return.tag!==13)?(e._visibility&=-3,ef(t)):Fc(t);break;default:Fc(t)}}function ef(t){var e=t.deletions;if(t.flags&16){if(e!==null)for(var s=0;s<e.length;s++){var n=e[s];ss=n,$2(n,t)}F2(t)}for(t=t.child;t!==null;){switch(e=t,e.tag){case 0:case 11:case 15:ra(8,e,e.return),ef(e);break;case 22:s=e.stateNode,s._visibility&2&&(s._visibility&=-3,ef(e));break;default:ef(e)}t=t.sibling}}function $2(t,e){for(;ss!==null;){var s=ss;switch(s.tag){case 0:case 11:case 15:ra(8,s,e);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var n=s.memoizedState.cachePool.pool;n!=null&&n.refCount++}break;case 24:Sd(s.memoizedState.cache)}if(n=s.child,n!==null)n.return=s,ss=n;else e:for(s=t;ss!==null;){n=ss;var i=n.sibling,r=n.return;if(I2(n),n===s){ss=null;break e}if(i!==null){i.return=r,ss=i;break e}ss=r}}}var AD={getCacheForType:function(t){var e=ps(Ht),s=e.data.get(t);return s===void 0&&(s=t(),e.data.set(t,s)),s},cacheSignal:function(){return ps(Ht).controller.signal}},jD=typeof WeakMap=="function"?WeakMap:Map,Ue=0,ot=null,Ce=null,Me=0,We=0,qs=null,Or=!1,oc=!1,Av=!1,Xi=0,Rt=0,aa=0,Ja=0,jv=0,Qs=0,Ll=0,fu=null,Ms=null,lx=!1,op=0,H2=0,Df=1/0,Lf=null,Gr=null,Xt=0,zr=null,Pl=null,Ui=0,cx=0,ux=null,G2=null,mu=0,dx=null;function rn(){return Ue&2&&Me!==0?Me&-Me:be.T!==null?Rv():ZT()}function z2(){if(Qs===0)if(!(Me&536870912)||De){var t=gh;gh<<=1,!(gh&3932160)&&(gh=262144),Qs=t}else Qs=536870912;return t=ln.current,t!==null&&(t.flags|=32),Qs}function Vs(t,e,s){(t===ot&&(We===2||We===9)||t.cancelPendingCommit!==null)&&(Vl(t,0),Mr(t,Me,Qs,!1)),wd(t,s),(!(Ue&2)||t!==ot)&&(t===ot&&(!(Ue&2)&&(Ja|=s),Rt===4&&Mr(t,Me,Qs,!1)),mi(t))}function q2(t,e,s){if(Ue&6)throw Error(X(327));var n=!s&&(e&127)===0&&(e&t.expiredLanes)===0||_d(t,e),i=n?ID(t,e):D0(t,e,!0),r=n;do{if(i===0){oc&&!n&&Mr(t,e,0,!1);break}else{if(s=t.current.alternate,r&&!CD(s)){i=D0(t,e,!1),r=!1;continue}if(i===2){if(r=e,t.errorRecoveryDisabledLanes&r)var a=0;else a=t.pendingLanes&-536870913,a=a!==0?a:a&536870912?536870912:0;if(a!==0){e=a;e:{var l=t;i=fu;var c=l.current.memoizedState.isDehydrated;if(c&&(Vl(l,a).flags|=256),a=D0(l,a,!1),a!==2){if(Av&&!c){l.errorRecoveryDisabledLanes|=r,Ja|=r,i=4;break e}r=Ms,Ms=i,r!==null&&(Ms===null?Ms=r:Ms.push.apply(Ms,r))}i=a}if(r=!1,i!==2)continue}}if(i===1){Vl(t,0),Mr(t,e,0,!0);break}e:{switch(n=t,r=i,r){case 0:case 1:throw Error(X(345));case 4:if((e&4194048)!==e)break;case 6:Mr(n,e,Qs,!Or);break e;case 2:Ms=null;break;case 3:case 5:break;default:throw Error(X(329))}if((e&62914560)===e&&(i=op+300-tn(),10<i)){if(Mr(n,e,Qs,!Or),Xm(n,0,!0)!==0)break e;Ui=e,n.timeoutHandle=hA(vw.bind(null,n,s,Ms,Lf,lx,e,Qs,Ja,Ll,Or,r,"Throttled",-0,0),i);break e}vw(n,s,Ms,Lf,lx,e,Qs,Ja,Ll,Or,r,null,-0,0)}}break}while(!0);mi(t)}function vw(t,e,s,n,i,r,a,l,c,u,d,h,f,m){if(t.timeoutHandle=-1,h=e.subtreeFlags,h&8192||(h&16785408)===16785408){h={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ii},B2(e,r,h);var b=(r&62914560)===r?op-tn():(r&4194048)===r?H2-tn():0;if(b=m4(h,b),b!==null){Ui=r,t.cancelPendingCommit=b(_w.bind(null,t,e,r,s,n,i,a,l,c,d,h,null,f,m)),Mr(t,r,a,!u);return}}_w(t,e,r,s,n,i,a,l,c)}function CD(t){for(var e=t;;){var s=e.tag;if((s===0||s===11||s===15)&&e.flags&16384&&(s=e.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var n=0;n<s.length;n++){var i=s[n],r=i.getSnapshot;i=i.value;try{if(!on(r(),i))return!1}catch{return!1}}if(s=e.child,e.subtreeFlags&16384&&s!==null)s.return=e,e=s;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Mr(t,e,s,n){e&=~jv,e&=~Ja,t.suspendedLanes|=e,t.pingedLanes&=~e,n&&(t.warmLanes|=e),n=t.expirationTimes;for(var i=e;0<i;){var r=31-nn(i),a=1<<r;n[r]=-1,i&=~a}s!==0&&XT(t,s,e)}function lp(){return Ue&6?!0:(Ad(0),!1)}function Cv(){if(Ce!==null){if(We===0)var t=Ce.return;else t=Ce,Oi=So=null,pv(t),xl=null,Du=0,t=Ce;for(;t!==null;)S2(t.alternate,t),t=t.return;Ce=null}}function Vl(t,e){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,XD(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Ui=0,Cv(),ot=t,Ce=s=Bi(t.current,null),Me=e,We=0,qs=null,Or=!1,oc=_d(t,e),Av=!1,Ll=Qs=jv=Ja=aa=Rt=0,Ms=fu=null,lx=!1,e&8&&(e|=e&32);var n=t.entangledLanes;if(n!==0)for(t=t.entanglements,n&=e;0<n;){var i=31-nn(n),r=1<<i;e|=t[i],n&=~r}return Xi=e,ep(),s}function K2(t,e){_e=null,be.H=Pu,e===ac||e===sp?(e=Q1(),We=3):e===lv?(e=Q1(),We=4):We=e===Nv?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,qs=e,Ce===null&&(Rt=1,If(t,gn(e,t.current)))}function W2(){var t=ln.current;return t===null?!0:(Me&4194048)===Me?yn===null:(Me&62914560)===Me||Me&536870912?t===yn:!1}function Y2(){var t=be.H;return be.H=Pu,t===null?Pu:t}function X2(){var t=be.A;return be.A=AD,t}function Pf(){Rt=4,Or||(Me&4194048)!==Me&&ln.current!==null||(oc=!0),!(aa&134217727)&&!(Ja&134217727)||ot===null||Mr(ot,Me,Qs,!1)}function D0(t,e,s){var n=Ue;Ue|=2;var i=Y2(),r=X2();(ot!==t||Me!==e)&&(Lf=null,Vl(t,e)),e=!1;var a=Rt;e:do try{if(We!==0&&Ce!==null){var l=Ce,c=qs;switch(We){case 8:Cv(),a=6;break e;case 3:case 2:case 9:case 6:ln.current===null&&(e=!0);var u=We;if(We=0,qs=null,tl(t,l,c,u),s&&oc){a=0;break e}break;default:u=We,We=0,qs=null,tl(t,l,c,u)}}RD(),a=Rt;break}catch(d){K2(t,d)}while(!0);return e&&t.shellSuspendCounter++,Oi=So=null,Ue=n,be.H=i,be.A=r,Ce===null&&(ot=null,Me=0,ep()),a}function RD(){for(;Ce!==null;)Q2(Ce)}function ID(t,e){var s=Ue;Ue|=2;var n=Y2(),i=X2();ot!==t||Me!==e?(Lf=null,Df=tn()+500,Vl(t,e)):oc=_d(t,e);e:do try{if(We!==0&&Ce!==null){e=Ce;var r=qs;t:switch(We){case 1:We=0,qs=null,tl(t,e,r,1);break;case 2:case 9:if(X1(r)){We=0,qs=null,yw(e);break}e=function(){We!==2&&We!==9||ot!==t||(We=7),mi(t)},r.then(e,e);break e;case 3:We=7;break e;case 4:We=5;break e;case 7:X1(r)?(We=0,qs=null,yw(e)):(We=0,qs=null,tl(t,e,r,7));break;case 5:var a=null;switch(Ce.tag){case 26:a=Ce.memoizedState;case 5:case 27:var l=Ce;if(a?xA(a):l.stateNode.complete){We=0,qs=null;var c=l.sibling;if(c!==null)Ce=c;else{var u=l.return;u!==null?(Ce=u,cp(u)):Ce=null}break t}}We=0,qs=null,tl(t,e,r,5);break;case 6:We=0,qs=null,tl(t,e,r,6);break;case 8:Cv(),Rt=6;break e;default:throw Error(X(462))}}OD();break}catch(d){K2(t,d)}while(!0);return Oi=So=null,be.H=n,be.A=i,Ue=s,Ce!==null?0:(ot=null,Me=0,ep(),Rt)}function OD(){for(;Ce!==null&&!sM();)Q2(Ce)}function Q2(t){var e=N2(t.alternate,t,Xi);t.memoizedProps=t.pendingProps,e===null?cp(t):Ce=e}function yw(t){var e=t,s=e.alternate;switch(e.tag){case 15:case 0:e=fw(s,e,e.pendingProps,e.type,void 0,Me);break;case 11:e=fw(s,e,e.pendingProps,e.type.render,e.ref,Me);break;case 5:pv(e);default:S2(s,e),e=Ce=SE(e,Xi),e=N2(s,e,Xi)}t.memoizedProps=t.pendingProps,e===null?cp(t):Ce=e}function tl(t,e,s,n){Oi=So=null,pv(e),xl=null,Du=0;var i=e.return;try{if(_D(t,i,e,s,Me)){Rt=1,If(t,gn(s,t.current)),Ce=null;return}}catch(r){if(i!==null)throw Ce=i,r;Rt=1,If(t,gn(s,t.current)),Ce=null;return}e.flags&32768?(De||n===1?t=!0:oc||Me&536870912?t=!1:(Or=t=!0,(n===2||n===9||n===3||n===6)&&(n=ln.current,n!==null&&n.tag===13&&(n.flags|=16384))),J2(e,t)):cp(e)}function cp(t){var e=t;do{if(e.flags&32768){J2(e,Or);return}t=e.return;var s=ND(e.alternate,e,Xi);if(s!==null){Ce=s;return}if(e=e.sibling,e!==null){Ce=e;return}Ce=e=t}while(e!==null);Rt===0&&(Rt=5)}function J2(t,e){do{var s=SD(t.alternate,t);if(s!==null){s.flags&=32767,Ce=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!e&&(t=t.sibling,t!==null)){Ce=t;return}Ce=t=s}while(t!==null);Rt=6,Ce=null}function _w(t,e,s,n,i,r,a,l,c){t.cancelPendingCommit=null;do up();while(Xt!==0);if(Ue&6)throw Error(X(327));if(e!==null){if(e===t.current)throw Error(X(177));if(r=e.lanes|e.childLanes,r|=tv,hM(t,s,r,a,l,c),t===ot&&(Ce=ot=null,Me=0),Pl=e,zr=t,Ui=s,cx=r,ux=i,G2=n,e.subtreeFlags&10256||e.flags&10256?(t.callbackNode=null,t.callbackPriority=0,PD(_f,function(){return nA(),null})):(t.callbackNode=null,t.callbackPriority=0),n=(e.flags&13878)!==0,e.subtreeFlags&13878||n){n=be.T,be.T=null,i=$e.p,$e.p=2,a=Ue,Ue|=4;try{TD(t,e,s)}finally{Ue=a,$e.p=i,be.T=n}}Xt=1,Z2(),eA(),tA()}}function Z2(){if(Xt===1){Xt=0;var t=zr,e=Pl,s=(e.flags&13878)!==0;if(e.subtreeFlags&13878||s){s=be.T,be.T=null;var n=$e.p;$e.p=2;var i=Ue;Ue|=4;try{L2(e,t);var r=px,a=xE(t.containerInfo),l=r.focusedElem,c=r.selectionRange;if(a!==l&&l&&l.ownerDocument&&gE(l.ownerDocument.documentElement,l)){if(c!==null&&ev(l)){var u=c.start,d=c.end;if(d===void 0&&(d=u),"selectionStart"in l)l.selectionStart=u,l.selectionEnd=Math.min(d,l.value.length);else{var h=l.ownerDocument||document,f=h&&h.defaultView||window;if(f.getSelection){var m=f.getSelection(),b=l.textContent.length,x=Math.min(c.start,b),v=c.end===void 0?x:Math.min(c.end,b);!m.extend&&x>v&&(a=v,v=x,x=a);var g=H1(l,x),p=H1(l,v);if(g&&p&&(m.rangeCount!==1||m.anchorNode!==g.node||m.anchorOffset!==g.offset||m.focusNode!==p.node||m.focusOffset!==p.offset)){var y=h.createRange();y.setStart(g.node,g.offset),m.removeAllRanges(),x>v?(m.addRange(y),m.extend(p.node,p.offset)):(y.setEnd(p.node,p.offset),m.addRange(y))}}}}for(h=[],m=l;m=m.parentNode;)m.nodeType===1&&h.push({element:m,left:m.scrollLeft,top:m.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<h.length;l++){var k=h[l];k.element.scrollLeft=k.left,k.element.scrollTop=k.top}}zf=!!mx,px=mx=null}finally{Ue=i,$e.p=n,be.T=s}}t.current=e,Xt=2}}function eA(){if(Xt===2){Xt=0;var t=zr,e=Pl,s=(e.flags&8772)!==0;if(e.subtreeFlags&8772||s){s=be.T,be.T=null;var n=$e.p;$e.p=2;var i=Ue;Ue|=4;try{R2(t,e.alternate,e)}finally{Ue=i,$e.p=n,be.T=s}}Xt=3}}function tA(){if(Xt===4||Xt===3){Xt=0,nM();var t=zr,e=Pl,s=Ui,n=G2;e.subtreeFlags&10256||e.flags&10256?Xt=5:(Xt=0,Pl=zr=null,sA(t,t.pendingLanes));var i=t.pendingLanes;if(i===0&&(Gr=null),Kb(s),e=e.stateNode,sn&&typeof sn.onCommitFiberRoot=="function")try{sn.onCommitFiberRoot(yd,e,void 0,(e.current.flags&128)===128)}catch{}if(n!==null){e=be.T,i=$e.p,$e.p=2,be.T=null;try{for(var r=t.onRecoverableError,a=0;a<n.length;a++){var l=n[a];r(l.value,{componentStack:l.stack})}}finally{be.T=e,$e.p=i}}Ui&3&&up(),mi(t),i=t.pendingLanes,s&261930&&i&42?t===dx?mu++:(mu=0,dx=t):mu=0,Ad(0)}}function sA(t,e){(t.pooledCacheLanes&=e)===0&&(e=t.pooledCache,e!=null&&(t.pooledCache=null,Sd(e)))}function up(){return Z2(),eA(),tA(),nA()}function nA(){if(Xt!==5)return!1;var t=zr,e=cx;cx=0;var s=Kb(Ui),n=be.T,i=$e.p;try{$e.p=32>s?32:s,be.T=null,s=ux,ux=null;var r=zr,a=Ui;if(Xt=0,Pl=zr=null,Ui=0,Ue&6)throw Error(X(331));var l=Ue;if(Ue|=4,U2(r.current),V2(r,r.current,a,s),Ue=l,Ad(0,!1),sn&&typeof sn.onPostCommitFiberRoot=="function")try{sn.onPostCommitFiberRoot(yd,r)}catch{}return!0}finally{$e.p=i,be.T=n,sA(t,e)}}function ww(t,e,s){e=gn(s,e),e=ix(t.stateNode,e,2),t=Hr(t,e,2),t!==null&&(wd(t,2),mi(t))}function Ye(t,e,s){if(t.tag===3)ww(t,t,s);else for(;e!==null;){if(e.tag===3){ww(e,t,s);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Gr===null||!Gr.has(n))){t=gn(s,t),s=b2(2),n=Hr(e,s,2),n!==null&&(v2(s,n,e,t),wd(n,2),mi(n));break}}e=e.return}}function L0(t,e,s){var n=t.pingCache;if(n===null){n=t.pingCache=new jD;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(s)||(Av=!0,i.add(s),t=MD.bind(null,t,e,s),e.then(t,t))}function MD(t,e,s){var n=t.pingCache;n!==null&&n.delete(e),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,ot===t&&(Me&s)===s&&(Rt===4||Rt===3&&(Me&62914560)===Me&&300>tn()-op?!(Ue&2)&&Vl(t,0):jv|=s,Ll===Me&&(Ll=0)),mi(t)}function iA(t,e){e===0&&(e=YT()),t=No(t,e),t!==null&&(wd(t,e),mi(t))}function DD(t){var e=t.memoizedState,s=0;e!==null&&(s=e.retryLane),iA(t,s)}function LD(t,e){var s=0;switch(t.tag){case 31:case 13:var n=t.stateNode,i=t.memoizedState;i!==null&&(s=i.retryLane);break;case 19:n=t.stateNode;break;case 22:n=t.stateNode._retryCache;break;default:throw Error(X(314))}n!==null&&n.delete(e),iA(t,s)}function PD(t,e){return zb(t,e)}var Vf=null,$o=null,hx=!1,Bf=!1,P0=!1,Dr=0;function mi(t){t!==$o&&t.next===null&&($o===null?Vf=$o=t:$o=$o.next=t),Bf=!0,hx||(hx=!0,BD())}function Ad(t,e){if(!P0&&Bf){P0=!0;do for(var s=!1,n=Vf;n!==null;){if(t!==0){var i=n.pendingLanes;if(i===0)var r=0;else{var a=n.suspendedLanes,l=n.pingedLanes;r=(1<<31-nn(42|t)+1)-1,r&=i&~(a&~l),r=r&201326741?r&201326741|1:r?r|2:0}r!==0&&(s=!0,kw(n,r))}else r=Me,r=Xm(n,n===ot?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),!(r&3)||_d(n,r)||(s=!0,kw(n,r));n=n.next}while(s);P0=!1}}function VD(){rA()}function rA(){Bf=hx=!1;var t=0;Dr!==0&&YD()&&(t=Dr);for(var e=tn(),s=null,n=Vf;n!==null;){var i=n.next,r=aA(n,e);r===0?(n.next=null,s===null?Vf=i:s.next=i,i===null&&($o=s)):(s=n,(t!==0||r&3)&&(Bf=!0)),n=i}Xt!==0&&Xt!==5||Ad(t),Dr!==0&&(Dr=0)}function aA(t,e){for(var s=t.suspendedLanes,n=t.pingedLanes,i=t.expirationTimes,r=t.pendingLanes&-62914561;0<r;){var a=31-nn(r),l=1<<a,c=i[a];c===-1?(!(l&s)||l&n)&&(i[a]=dM(l,e)):c<=e&&(t.expiredLanes|=l),r&=~l}if(e=ot,s=Me,s=Xm(t,t===e?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n=t.callbackNode,s===0||t===e&&(We===2||We===9)||t.cancelPendingCommit!==null)return n!==null&&n!==null&&d0(n),t.callbackNode=null,t.callbackPriority=0;if(!(s&3)||_d(t,s)){if(e=s&-s,e===t.callbackPriority)return e;switch(n!==null&&d0(n),Kb(s)){case 2:case 8:s=KT;break;case 32:s=_f;break;case 268435456:s=WT;break;default:s=_f}return n=oA.bind(null,t),s=zb(s,n),t.callbackPriority=e,t.callbackNode=s,e}return n!==null&&n!==null&&d0(n),t.callbackPriority=2,t.callbackNode=null,2}function oA(t,e){if(Xt!==0&&Xt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(up()&&t.callbackNode!==s)return null;var n=Me;return n=Xm(t,t===ot?n:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),n===0?null:(q2(t,n,e),aA(t,tn()),t.callbackNode!=null&&t.callbackNode===s?oA.bind(null,t):null)}function kw(t,e){if(up())return null;q2(t,e,!0)}function BD(){QD(function(){Ue&6?zb(qT,VD):rA()})}function Rv(){if(Dr===0){var t=Ol;t===0&&(t=ph,ph<<=1,!(ph&261888)&&(ph=256)),Dr=t}return Dr}function Nw(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:zh(""+t)}function Sw(t,e){var s=e.ownerDocument.createElement("input");return s.name=e.name,s.value=e.value,t.id&&s.setAttribute("form",t.id),e.parentNode.insertBefore(s,e),t=new FormData(t),s.parentNode.removeChild(s),t}function FD(t,e,s,n,i){if(e==="submit"&&s&&s.stateNode===i){var r=Nw((i[Us]||null).action),a=n.submitter;a&&(e=(e=a[Us]||null)?Nw(e.formAction):a.getAttribute("formAction"),e!==null&&(r=e,a=null));var l=new Qm("action","action",null,n,i);t.push({event:l,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(Dr!==0){var c=a?Sw(i,a):new FormData(i);sx(s,{pending:!0,data:c,method:i.method,action:r},null,c)}}else typeof r=="function"&&(l.preventDefault(),c=a?Sw(i,a):new FormData(i),sx(s,{pending:!0,data:c,method:i.method,action:r},r,c))},currentTarget:i}]})}}for(var V0=0;V0<Gg.length;V0++){var B0=Gg[V0],UD=B0.toLowerCase(),$D=B0[0].toUpperCase()+B0.slice(1);Xn(UD,"on"+$D)}Xn(vE,"onAnimationEnd");Xn(yE,"onAnimationIteration");Xn(_E,"onAnimationStart");Xn("dblclick","onDoubleClick");Xn("focusin","onFocus");Xn("focusout","onBlur");Xn(iD,"onTransitionRun");Xn(rD,"onTransitionStart");Xn(aD,"onTransitionCancel");Xn(wE,"onTransitionEnd");Rl("onMouseEnter",["mouseout","mouseover"]);Rl("onMouseLeave",["mouseout","mouseover"]);Rl("onPointerEnter",["pointerout","pointerover"]);Rl("onPointerLeave",["pointerout","pointerover"]);_o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_o("onBeforeInput",["compositionend","keypress","textInput","paste"]);_o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HD=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vu));function lA(t,e){e=(e&4)!==0;for(var s=0;s<t.length;s++){var n=t[s],i=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var a=n.length-1;0<=a;a--){var l=n[a],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;r=l,i.currentTarget=u;try{r(i)}catch(d){kf(d)}i.currentTarget=null,r=c}else for(a=0;a<n.length;a++){if(l=n[a],c=l.instance,u=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;r=l,i.currentTarget=u;try{r(i)}catch(d){kf(d)}i.currentTarget=null,r=c}}}}function je(t,e){var s=e[Lg];s===void 0&&(s=e[Lg]=new Set);var n=t+"__bubble";s.has(n)||(cA(e,t,2,!1),s.add(n))}function F0(t,e,s){var n=0;e&&(n|=4),cA(s,t,n,e)}var Sh="_reactListening"+Math.random().toString(36).slice(2);function Iv(t){if(!t[Sh]){t[Sh]=!0,eE.forEach(function(s){s!=="selectionchange"&&(HD.has(s)||F0(s,!1,t),F0(s,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Sh]||(e[Sh]=!0,F0("selectionchange",!1,e))}}function cA(t,e,s,n){switch(wA(e)){case 2:var i=x4;break;case 8:i=b4;break;default:i=Lv}s=i.bind(null,e,s,t),i=void 0,!Ug||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?t.addEventListener(e,s,{capture:!0,passive:i}):t.addEventListener(e,s,!0):i!==void 0?t.addEventListener(e,s,{passive:i}):t.addEventListener(e,s,!1)}function U0(t,e,s,n,i){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var a=n.tag;if(a===3||a===4){var l=n.stateNode.containerInfo;if(l===i)break;if(a===4)for(a=n.return;a!==null;){var c=a.tag;if((c===3||c===4)&&a.stateNode.containerInfo===i)return;a=a.return}for(;l!==null;){if(a=qo(l),a===null)return;if(c=a.tag,c===5||c===6||c===26||c===27){n=r=a;continue e}l=l.parentNode}}n=n.return}lE(function(){var u=r,d=Xb(s),h=[];e:{var f=kE.get(t);if(f!==void 0){var m=Qm,b=t;switch(t){case"keypress":if(Kh(s)===0)break e;case"keydown":case"keyup":m=LM;break;case"focusin":b="focus",m=g0;break;case"focusout":b="blur",m=g0;break;case"beforeblur":case"afterblur":m=g0;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=O1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=NM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=BM;break;case vE:case yE:case _E:m=EM;break;case wE:m=UM;break;case"scroll":case"scrollend":m=wM;break;case"wheel":m=HM;break;case"copy":case"cut":case"paste":m=jM;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=D1;break;case"toggle":case"beforetoggle":m=zM}var x=(e&4)!==0,v=!x&&(t==="scroll"||t==="scrollend"),g=x?f!==null?f+"Capture":null:f;x=[];for(var p=u,y;p!==null;){var k=p;if(y=k.stateNode,k=k.tag,k!==5&&k!==26&&k!==27||y===null||g===null||(k=Cu(p,g),k!=null&&x.push(Bu(p,k,y))),v)break;p=p.return}0<x.length&&(f=new m(f,b,null,s,d),h.push({event:f,listeners:x}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&s!==Fg&&(b=s.relatedTarget||s.fromElement)&&(qo(b)||b[nc]))break e;if((m||f)&&(f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window,m?(b=s.relatedTarget||s.toElement,m=u,b=b?qo(b):null,b!==null&&(v=vd(b),x=b.tag,b!==v||x!==5&&x!==27&&x!==6)&&(b=null)):(m=null,b=u),m!==b)){if(x=O1,k="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(x=D1,k="onPointerLeave",g="onPointerEnter",p="pointer"),v=m==null?f:Yc(m),y=b==null?f:Yc(b),f=new x(k,p+"leave",m,s,d),f.target=v,f.relatedTarget=y,k=null,qo(d)===u&&(x=new x(g,p+"enter",b,s,d),x.target=y,x.relatedTarget=v,k=x),v=k,m&&b)t:{for(x=GD,g=m,p=b,y=0,k=g;k;k=x(k))y++;k=0;for(var w=p;w;w=x(w))k++;for(;0<y-k;)g=x(g),y--;for(;0<k-y;)p=x(p),k--;for(;y--;){if(g===p||p!==null&&g===p.alternate){x=g;break t}g=x(g),p=x(p)}x=null}else x=null;m!==null&&Tw(h,f,m,x,!1),b!==null&&v!==null&&Tw(h,v,b,x,!0)}}e:{if(f=u?Yc(u):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var S=B1;else if(V1(f))if(mE)S=tD;else{S=ZM;var _=JM}else m=f.nodeName,!m||m.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?u&&Yb(u.elementType)&&(S=B1):S=eD;if(S&&(S=S(t,u))){fE(h,S,s,d);break e}_&&_(t,f,u),t==="focusout"&&u&&f.type==="number"&&u.memoizedProps.value!=null&&Bg(f,"number",f.value)}switch(_=u?Yc(u):window,t){case"focusin":(V1(_)||_.contentEditable==="true")&&(Yo=_,$g=u,ru=null);break;case"focusout":ru=$g=Yo=null;break;case"mousedown":Hg=!0;break;case"contextmenu":case"mouseup":case"dragend":Hg=!1,G1(h,s,d);break;case"selectionchange":if(nD)break;case"keydown":case"keyup":G1(h,s,d)}var T;if(Zb)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Wo?dE(t,s)&&(E="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(E="onCompositionStart");E&&(uE&&s.locale!=="ko"&&(Wo||E!=="onCompositionStart"?E==="onCompositionEnd"&&Wo&&(T=cE()):(Ir=d,Qb="value"in Ir?Ir.value:Ir.textContent,Wo=!0)),_=Ff(u,E),0<_.length&&(E=new M1(E,t,null,s,d),h.push({event:E,listeners:_}),T?E.data=T:(T=hE(s),T!==null&&(E.data=T)))),(T=KM?WM(t,s):YM(t,s))&&(E=Ff(u,"onBeforeInput"),0<E.length&&(_=new M1("onBeforeInput","beforeinput",null,s,d),h.push({event:_,listeners:E}),_.data=T)),FD(h,t,u,s,d)}lA(h,e)})}function Bu(t,e,s){return{instance:t,listener:e,currentTarget:s}}function Ff(t,e){for(var s=e+"Capture",n=[];t!==null;){var i=t,r=i.stateNode;if(i=i.tag,i!==5&&i!==26&&i!==27||r===null||(i=Cu(t,s),i!=null&&n.unshift(Bu(t,i,r)),i=Cu(t,e),i!=null&&n.push(Bu(t,i,r))),t.tag===3)return n;t=t.return}return[]}function GD(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Tw(t,e,s,n,i){for(var r=e._reactName,a=[];s!==null&&s!==n;){var l=s,c=l.alternate,u=l.stateNode;if(l=l.tag,c!==null&&c===n)break;l!==5&&l!==26&&l!==27||u===null||(c=u,i?(u=Cu(s,r),u!=null&&a.unshift(Bu(s,u,c))):i||(u=Cu(s,r),u!=null&&a.push(Bu(s,u,c)))),s=s.return}a.length!==0&&t.push({event:e,listeners:a})}var zD=/\r\n?/g,qD=/\u0000|\uFFFD/g;function Ew(t){return(typeof t=="string"?t:""+t).replace(zD,`
`).replace(qD,"")}function uA(t,e){return e=Ew(e),Ew(t)===e}function Ze(t,e,s,n,i,r){switch(s){case"children":typeof n=="string"?e==="body"||e==="textarea"&&n===""||Il(t,n):(typeof n=="number"||typeof n=="bigint")&&e!=="body"&&Il(t,""+n);break;case"className":bh(t,"class",n);break;case"tabIndex":bh(t,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":bh(t,s,n);break;case"style":oE(t,n,r);break;case"data":if(e!=="object"){bh(t,"data",n);break}case"src":case"href":if(n===""&&(e!=="a"||s!=="href")){t.removeAttribute(s);break}if(n==null||typeof n=="function"||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=zh(""+n),t.setAttribute(s,n);break;case"action":case"formAction":if(typeof n=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof r=="function"&&(s==="formAction"?(e!=="input"&&Ze(t,e,"name",i.name,i,null),Ze(t,e,"formEncType",i.formEncType,i,null),Ze(t,e,"formMethod",i.formMethod,i,null),Ze(t,e,"formTarget",i.formTarget,i,null)):(Ze(t,e,"encType",i.encType,i,null),Ze(t,e,"method",i.method,i,null),Ze(t,e,"target",i.target,i,null)));if(n==null||typeof n=="symbol"||typeof n=="boolean"){t.removeAttribute(s);break}n=zh(""+n),t.setAttribute(s,n);break;case"onClick":n!=null&&(t.onclick=Ii);break;case"onScroll":n!=null&&je("scroll",t);break;case"onScrollEnd":n!=null&&je("scrollend",t);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(X(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(X(60));t.innerHTML=s}}break;case"multiple":t.multiple=n&&typeof n!="function"&&typeof n!="symbol";break;case"muted":t.muted=n&&typeof n!="function"&&typeof n!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(n==null||typeof n=="function"||typeof n=="boolean"||typeof n=="symbol"){t.removeAttribute("xlink:href");break}s=zh(""+n),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""+n):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":n===!0?t.setAttribute(s,""):n!==!1&&n!=null&&typeof n!="function"&&typeof n!="symbol"?t.setAttribute(s,n):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":n!=null&&typeof n!="function"&&typeof n!="symbol"&&!isNaN(n)&&1<=n?t.setAttribute(s,n):t.removeAttribute(s);break;case"rowSpan":case"start":n==null||typeof n=="function"||typeof n=="symbol"||isNaN(n)?t.removeAttribute(s):t.setAttribute(s,n);break;case"popover":je("beforetoggle",t),je("toggle",t),Gh(t,"popover",n);break;case"xlinkActuate":_i(t,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":_i(t,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":_i(t,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":_i(t,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":_i(t,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":_i(t,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":_i(t,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":_i(t,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":_i(t,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":Gh(t,"is",n);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=yM.get(s)||s,Gh(t,s,n))}}function fx(t,e,s,n,i,r){switch(s){case"style":oE(t,n,r);break;case"dangerouslySetInnerHTML":if(n!=null){if(typeof n!="object"||!("__html"in n))throw Error(X(61));if(s=n.__html,s!=null){if(i.children!=null)throw Error(X(60));t.innerHTML=s}}break;case"children":typeof n=="string"?Il(t,n):(typeof n=="number"||typeof n=="bigint")&&Il(t,""+n);break;case"onScroll":n!=null&&je("scroll",t);break;case"onScrollEnd":n!=null&&je("scrollend",t);break;case"onClick":n!=null&&(t.onclick=Ii);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!tE.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(i=s.endsWith("Capture"),e=s.slice(2,i?s.length-7:void 0),r=t[Us]||null,r=r!=null?r[s]:null,typeof r=="function"&&t.removeEventListener(e,r,i),typeof n=="function")){typeof r!="function"&&r!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(e,n,i);break e}s in t?t[s]=n:n===!0?t.setAttribute(s,""):Gh(t,s,n)}}}function gs(t,e,s){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":je("error",t),je("load",t);var n=!1,i=!1,r;for(r in s)if(s.hasOwnProperty(r)){var a=s[r];if(a!=null)switch(r){case"src":n=!0;break;case"srcSet":i=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(X(137,e));default:Ze(t,e,r,a,s,null)}}i&&Ze(t,e,"srcSet",s.srcSet,s,null),n&&Ze(t,e,"src",s.src,s,null);return;case"input":je("invalid",t);var l=r=a=i=null,c=null,u=null;for(n in s)if(s.hasOwnProperty(n)){var d=s[n];if(d!=null)switch(n){case"name":i=d;break;case"type":a=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":r=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(d!=null)throw Error(X(137,e));break;default:Ze(t,e,n,d,s,null)}}iE(t,r,l,c,u,a,i,!1);return;case"select":je("invalid",t),n=a=r=null;for(i in s)if(s.hasOwnProperty(i)&&(l=s[i],l!=null))switch(i){case"value":r=l;break;case"defaultValue":a=l;break;case"multiple":n=l;default:Ze(t,e,i,l,s,null)}e=r,s=a,t.multiple=!!n,e!=null?ml(t,!!n,e,!1):s!=null&&ml(t,!!n,s,!0);return;case"textarea":je("invalid",t),r=i=n=null;for(a in s)if(s.hasOwnProperty(a)&&(l=s[a],l!=null))switch(a){case"value":n=l;break;case"defaultValue":i=l;break;case"children":r=l;break;case"dangerouslySetInnerHTML":if(l!=null)throw Error(X(91));break;default:Ze(t,e,a,l,s,null)}aE(t,n,i,r);return;case"option":for(c in s)if(s.hasOwnProperty(c)&&(n=s[c],n!=null))switch(c){case"selected":t.selected=n&&typeof n!="function"&&typeof n!="symbol";break;default:Ze(t,e,c,n,s,null)}return;case"dialog":je("beforetoggle",t),je("toggle",t),je("cancel",t),je("close",t);break;case"iframe":case"object":je("load",t);break;case"video":case"audio":for(n=0;n<Vu.length;n++)je(Vu[n],t);break;case"image":je("error",t),je("load",t);break;case"details":je("toggle",t);break;case"embed":case"source":case"link":je("error",t),je("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in s)if(s.hasOwnProperty(u)&&(n=s[u],n!=null))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(X(137,e));default:Ze(t,e,u,n,s,null)}return;default:if(Yb(e)){for(d in s)s.hasOwnProperty(d)&&(n=s[d],n!==void 0&&fx(t,e,d,n,s,void 0));return}}for(l in s)s.hasOwnProperty(l)&&(n=s[l],n!=null&&Ze(t,e,l,n,s,null))}function KD(t,e,s,n){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,r=null,a=null,l=null,c=null,u=null,d=null;for(m in s){var h=s[m];if(s.hasOwnProperty(m)&&h!=null)switch(m){case"checked":break;case"value":break;case"defaultValue":c=h;default:n.hasOwnProperty(m)||Ze(t,e,m,null,n,h)}}for(var f in n){var m=n[f];if(h=s[f],n.hasOwnProperty(f)&&(m!=null||h!=null))switch(f){case"type":r=m;break;case"name":i=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":a=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(m!=null)throw Error(X(137,e));break;default:m!==h&&Ze(t,e,f,m,n,h)}}Vg(t,a,l,c,u,d,r,i);return;case"select":m=a=l=f=null;for(r in s)if(c=s[r],s.hasOwnProperty(r)&&c!=null)switch(r){case"value":break;case"multiple":m=c;default:n.hasOwnProperty(r)||Ze(t,e,r,null,n,c)}for(i in n)if(r=n[i],c=s[i],n.hasOwnProperty(i)&&(r!=null||c!=null))switch(i){case"value":f=r;break;case"defaultValue":l=r;break;case"multiple":a=r;default:r!==c&&Ze(t,e,i,r,n,c)}e=l,s=a,n=m,f!=null?ml(t,!!s,f,!1):!!n!=!!s&&(e!=null?ml(t,!!s,e,!0):ml(t,!!s,s?[]:"",!1));return;case"textarea":m=f=null;for(l in s)if(i=s[l],s.hasOwnProperty(l)&&i!=null&&!n.hasOwnProperty(l))switch(l){case"value":break;case"children":break;default:Ze(t,e,l,null,n,i)}for(a in n)if(i=n[a],r=s[a],n.hasOwnProperty(a)&&(i!=null||r!=null))switch(a){case"value":f=i;break;case"defaultValue":m=i;break;case"children":break;case"dangerouslySetInnerHTML":if(i!=null)throw Error(X(91));break;default:i!==r&&Ze(t,e,a,i,n,r)}rE(t,f,m);return;case"option":for(var b in s)if(f=s[b],s.hasOwnProperty(b)&&f!=null&&!n.hasOwnProperty(b))switch(b){case"selected":t.selected=!1;break;default:Ze(t,e,b,null,n,f)}for(c in n)if(f=n[c],m=s[c],n.hasOwnProperty(c)&&f!==m&&(f!=null||m!=null))switch(c){case"selected":t.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:Ze(t,e,c,f,n,m)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var x in s)f=s[x],s.hasOwnProperty(x)&&f!=null&&!n.hasOwnProperty(x)&&Ze(t,e,x,null,n,f);for(u in n)if(f=n[u],m=s[u],n.hasOwnProperty(u)&&f!==m&&(f!=null||m!=null))switch(u){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(X(137,e));break;default:Ze(t,e,u,f,n,m)}return;default:if(Yb(e)){for(var v in s)f=s[v],s.hasOwnProperty(v)&&f!==void 0&&!n.hasOwnProperty(v)&&fx(t,e,v,void 0,n,f);for(d in n)f=n[d],m=s[d],!n.hasOwnProperty(d)||f===m||f===void 0&&m===void 0||fx(t,e,d,f,n,m);return}}for(var g in s)f=s[g],s.hasOwnProperty(g)&&f!=null&&!n.hasOwnProperty(g)&&Ze(t,e,g,null,n,f);for(h in n)f=n[h],m=s[h],!n.hasOwnProperty(h)||f===m||f==null&&m==null||Ze(t,e,h,f,n,m)}function Aw(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function WD(){if(typeof performance.getEntriesByType=="function"){for(var t=0,e=0,s=performance.getEntriesByType("resource"),n=0;n<s.length;n++){var i=s[n],r=i.transferSize,a=i.initiatorType,l=i.duration;if(r&&l&&Aw(a)){for(a=0,l=i.responseEnd,n+=1;n<s.length;n++){var c=s[n],u=c.startTime;if(u>l)break;var d=c.transferSize,h=c.initiatorType;d&&Aw(h)&&(c=c.responseEnd,a+=d*(c<l?1:(l-u)/(c-u)))}if(--n,e+=8*(r+a)/(i.duration/1e3),t++,10<t)break}}if(0<t)return e/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var mx=null,px=null;function Uf(t){return t.nodeType===9?t:t.ownerDocument}function jw(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function dA(t,e){if(t===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&e==="foreignObject"?0:t}function gx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $0=null;function YD(){var t=window.event;return t&&t.type==="popstate"?t===$0?!1:($0=t,!0):($0=null,!1)}var hA=typeof setTimeout=="function"?setTimeout:void 0,XD=typeof clearTimeout=="function"?clearTimeout:void 0,Cw=typeof Promise=="function"?Promise:void 0,QD=typeof queueMicrotask=="function"?queueMicrotask:typeof Cw<"u"?function(t){return Cw.resolve(null).then(t).catch(JD)}:hA;function JD(t){setTimeout(function(){throw t})}function wa(t){return t==="head"}function Rw(t,e){var s=e,n=0;do{var i=s.nextSibling;if(t.removeChild(s),i&&i.nodeType===8)if(s=i.data,s==="/$"||s==="/&"){if(n===0){t.removeChild(i),Fl(e);return}n--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")n++;else if(s==="html")pu(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,pu(s);for(var r=s.firstChild;r;){var a=r.nextSibling,l=r.nodeName;r[kd]||l==="SCRIPT"||l==="STYLE"||l==="LINK"&&r.rel.toLowerCase()==="stylesheet"||s.removeChild(r),r=a}}else s==="body"&&pu(t.ownerDocument.body);s=i}while(s);Fl(e)}function Iw(t,e){var s=t;t=0;do{var n=s.nextSibling;if(s.nodeType===1?e?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(e?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),n&&n.nodeType===8)if(s=n.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=n}while(s)}function xx(t){var e=t.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var s=e;switch(e=e.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":xx(s),Wb(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function ZD(t,e,s,n){for(;t.nodeType===1;){var i=s;if(t.nodeName.toLowerCase()!==e.toLowerCase()){if(!n&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(n){if(!t[kd])switch(e){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(r=t.getAttribute("rel"),r==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(r!==i.rel||t.getAttribute("href")!==(i.href==null||i.href===""?null:i.href)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin)||t.getAttribute("title")!==(i.title==null?null:i.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(r=t.getAttribute("src"),(r!==(i.src==null?null:i.src)||t.getAttribute("type")!==(i.type==null?null:i.type)||t.getAttribute("crossorigin")!==(i.crossOrigin==null?null:i.crossOrigin))&&r&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(e==="input"&&t.type==="hidden"){var r=i.name==null?null:""+i.name;if(i.type==="hidden"&&t.getAttribute("name")===r)return t}else return t;if(t=_n(t.nextSibling),t===null)break}return null}function e4(t,e,s){if(e==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=_n(t.nextSibling),t===null))return null;return t}function fA(t,e){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!e||(t=_n(t.nextSibling),t===null))return null;return t}function bx(t){return t.data==="$?"||t.data==="$~"}function vx(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function t4(t,e){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=e;else if(t.data!=="$?"||s.readyState!=="loading")e();else{var n=function(){e(),s.removeEventListener("DOMContentLoaded",n)};s.addEventListener("DOMContentLoaded",n),t._reactRetry=n}}function _n(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return t}var yx=null;function Ow(t){t=t.nextSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(e===0)return _n(t.nextSibling);e--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||e++}t=t.nextSibling}return null}function Mw(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(e===0)return t;e--}else s!=="/$"&&s!=="/&"||e++}t=t.previousSibling}return null}function mA(t,e,s){switch(e=Uf(s),t){case"html":if(t=e.documentElement,!t)throw Error(X(452));return t;case"head":if(t=e.head,!t)throw Error(X(453));return t;case"body":if(t=e.body,!t)throw Error(X(454));return t;default:throw Error(X(451))}}function pu(t){for(var e=t.attributes;e.length;)t.removeAttributeNode(e[0]);Wb(t)}var En=new Map,Dw=new Set;function $f(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var or=$e.d;$e.d={f:s4,r:n4,D:i4,C:r4,L:a4,m:o4,X:c4,S:l4,M:u4};function s4(){var t=or.f(),e=lp();return t||e}function n4(t){var e=ic(t);e!==null&&e.tag===5&&e.type==="form"?o2(e):or.r(t)}var lc=typeof document>"u"?null:document;function pA(t,e,s){var n=lc;if(n&&typeof e=="string"&&e){var i=pn(e);i='link[rel="'+t+'"][href="'+i+'"]',typeof s=="string"&&(i+='[crossorigin="'+s+'"]'),Dw.has(i)||(Dw.add(i),t={rel:t,crossOrigin:s,href:e},n.querySelector(i)===null&&(e=n.createElement("link"),gs(e,"link",t),is(e),n.head.appendChild(e)))}}function i4(t){or.D(t),pA("dns-prefetch",t,null)}function r4(t,e){or.C(t,e),pA("preconnect",t,e)}function a4(t,e,s){or.L(t,e,s);var n=lc;if(n&&t&&e){var i='link[rel="preload"][as="'+pn(e)+'"]';e==="image"&&s&&s.imageSrcSet?(i+='[imagesrcset="'+pn(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(i+='[imagesizes="'+pn(s.imageSizes)+'"]')):i+='[href="'+pn(t)+'"]';var r=i;switch(e){case"style":r=Bl(t);break;case"script":r=cc(t)}En.has(r)||(t=gt({rel:"preload",href:e==="image"&&s&&s.imageSrcSet?void 0:t,as:e},s),En.set(r,t),n.querySelector(i)!==null||e==="style"&&n.querySelector(jd(r))||e==="script"&&n.querySelector(Cd(r))||(e=n.createElement("link"),gs(e,"link",t),is(e),n.head.appendChild(e)))}}function o4(t,e){or.m(t,e);var s=lc;if(s&&t){var n=e&&typeof e.as=="string"?e.as:"script",i='link[rel="modulepreload"][as="'+pn(n)+'"][href="'+pn(t)+'"]',r=i;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":r=cc(t)}if(!En.has(r)&&(t=gt({rel:"modulepreload",href:t},e),En.set(r,t),s.querySelector(i)===null)){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(Cd(r)))return}n=s.createElement("link"),gs(n,"link",t),is(n),s.head.appendChild(n)}}}function l4(t,e,s){or.S(t,e,s);var n=lc;if(n&&t){var i=fl(n).hoistableStyles,r=Bl(t);e=e||"default";var a=i.get(r);if(!a){var l={loading:0,preload:null};if(a=n.querySelector(jd(r)))l.loading=5;else{t=gt({rel:"stylesheet",href:t,"data-precedence":e},s),(s=En.get(r))&&Ov(t,s);var c=a=n.createElement("link");is(c),gs(c,"link",t),c._p=new Promise(function(u,d){c.onload=u,c.onerror=d}),c.addEventListener("load",function(){l.loading|=1}),c.addEventListener("error",function(){l.loading|=2}),l.loading|=4,tf(a,e,n)}a={type:"stylesheet",instance:a,count:1,state:l},i.set(r,a)}}}function c4(t,e){or.X(t,e);var s=lc;if(s&&t){var n=fl(s).hoistableScripts,i=cc(t),r=n.get(i);r||(r=s.querySelector(Cd(i)),r||(t=gt({src:t,async:!0},e),(e=En.get(i))&&Mv(t,e),r=s.createElement("script"),is(r),gs(r,"link",t),s.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(i,r))}}function u4(t,e){or.M(t,e);var s=lc;if(s&&t){var n=fl(s).hoistableScripts,i=cc(t),r=n.get(i);r||(r=s.querySelector(Cd(i)),r||(t=gt({src:t,async:!0,type:"module"},e),(e=En.get(i))&&Mv(t,e),r=s.createElement("script"),is(r),gs(r,"link",t),s.head.appendChild(r)),r={type:"script",instance:r,count:1,state:null},n.set(i,r))}}function Lw(t,e,s,n){var i=(i=Fr.current)?$f(i):null;if(!i)throw Error(X(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(e=Bl(s.href),s=fl(i).hoistableStyles,n=s.get(e),n||(n={type:"style",instance:null,count:0,state:null},s.set(e,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=Bl(s.href);var r=fl(i).hoistableStyles,a=r.get(t);if(a||(i=i.ownerDocument||i,a={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},r.set(t,a),(r=i.querySelector(jd(t)))&&!r._p&&(a.instance=r,a.state.loading=5),En.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},En.set(t,s),r||d4(i,t,s,a.state))),e&&n===null)throw Error(X(528,""));return a}if(e&&n!==null)throw Error(X(529,""));return null;case"script":return e=s.async,s=s.src,typeof s=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=cc(s),s=fl(i).hoistableScripts,n=s.get(e),n||(n={type:"script",instance:null,count:0,state:null},s.set(e,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(X(444,t))}}function Bl(t){return'href="'+pn(t)+'"'}function jd(t){return'link[rel="stylesheet"]['+t+"]"}function gA(t){return gt({},t,{"data-precedence":t.precedence,precedence:null})}function d4(t,e,s,n){t.querySelector('link[rel="preload"][as="style"]['+e+"]")?n.loading=1:(e=t.createElement("link"),n.preload=e,e.addEventListener("load",function(){return n.loading|=1}),e.addEventListener("error",function(){return n.loading|=2}),gs(e,"link",s),is(e),t.head.appendChild(e))}function cc(t){return'[src="'+pn(t)+'"]'}function Cd(t){return"script[async]"+t}function Pw(t,e,s){if(e.count++,e.instance===null)switch(e.type){case"style":var n=t.querySelector('style[data-href~="'+pn(s.href)+'"]');if(n)return e.instance=n,is(n),n;var i=gt({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return n=(t.ownerDocument||t).createElement("style"),is(n),gs(n,"style",i),tf(n,s.precedence,t),e.instance=n;case"stylesheet":i=Bl(s.href);var r=t.querySelector(jd(i));if(r)return e.state.loading|=4,e.instance=r,is(r),r;n=gA(s),(i=En.get(i))&&Ov(n,i),r=(t.ownerDocument||t).createElement("link"),is(r);var a=r;return a._p=new Promise(function(l,c){a.onload=l,a.onerror=c}),gs(r,"link",n),e.state.loading|=4,tf(r,s.precedence,t),e.instance=r;case"script":return r=cc(s.src),(i=t.querySelector(Cd(r)))?(e.instance=i,is(i),i):(n=s,(i=En.get(r))&&(n=gt({},s),Mv(n,i)),t=t.ownerDocument||t,i=t.createElement("script"),is(i),gs(i,"link",n),t.head.appendChild(i),e.instance=i);case"void":return null;default:throw Error(X(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(n=e.instance,e.state.loading|=4,tf(n,s.precedence,t));return e.instance}function tf(t,e,s){for(var n=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=n.length?n[n.length-1]:null,r=i,a=0;a<n.length;a++){var l=n[a];if(l.dataset.precedence===e)r=l;else if(r!==i)break}r?r.parentNode.insertBefore(t,r.nextSibling):(e=s.nodeType===9?s.head:s,e.insertBefore(t,e.firstChild))}function Ov(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.title==null&&(t.title=e.title)}function Mv(t,e){t.crossOrigin==null&&(t.crossOrigin=e.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=e.referrerPolicy),t.integrity==null&&(t.integrity=e.integrity)}var sf=null;function Vw(t,e,s){if(sf===null){var n=new Map,i=sf=new Map;i.set(s,n)}else i=sf,n=i.get(s),n||(n=new Map,i.set(s,n));if(n.has(t))return n;for(n.set(t,null),s=s.getElementsByTagName(t),i=0;i<s.length;i++){var r=s[i];if(!(r[kd]||r[hs]||t==="link"&&r.getAttribute("rel")==="stylesheet")&&r.namespaceURI!=="http://www.w3.org/2000/svg"){var a=r.getAttribute(e)||"";a=t+a;var l=n.get(a);l?l.push(r):n.set(a,[r])}}return n}function Bw(t,e,s){t=t.ownerDocument||t,t.head.insertBefore(s,e==="title"?t.querySelector("head > title"):null)}function h4(t,e,s){if(s===1||e.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return t=e.disabled,typeof e.precedence=="string"&&t==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function xA(t){return!(t.type==="stylesheet"&&!(t.state.loading&3))}function f4(t,e,s,n){if(s.type==="stylesheet"&&(typeof n.media!="string"||matchMedia(n.media).matches!==!1)&&!(s.state.loading&4)){if(s.instance===null){var i=Bl(n.href),r=e.querySelector(jd(i));if(r){e=r._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(t.count++,t=Hf.bind(t),e.then(t,t)),s.state.loading|=4,s.instance=r,is(r);return}r=e.ownerDocument||e,n=gA(n),(i=En.get(i))&&Ov(n,i),r=r.createElement("link"),is(r);var a=r;a._p=new Promise(function(l,c){a.onload=l,a.onerror=c}),gs(r,"link",n),s.instance=r}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,e),(e=s.state.preload)&&!(s.state.loading&3)&&(t.count++,s=Hf.bind(t),e.addEventListener("load",s),e.addEventListener("error",s))}}var H0=0;function m4(t,e){return t.stylesheets&&t.count===0&&nf(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var n=setTimeout(function(){if(t.stylesheets&&nf(t,t.stylesheets),t.unsuspend){var r=t.unsuspend;t.unsuspend=null,r()}},6e4+e);0<t.imgBytes&&H0===0&&(H0=62500*WD());var i=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&nf(t,t.stylesheets),t.unsuspend)){var r=t.unsuspend;t.unsuspend=null,r()}},(t.imgBytes>H0?50:800)+e);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(n),clearTimeout(i)}}:null}function Hf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)nf(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Gf=null;function nf(t,e){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Gf=new Map,e.forEach(p4,t),Gf=null,Hf.call(t))}function p4(t,e){if(!(e.state.loading&4)){var s=Gf.get(t);if(s)var n=s.get(null);else{s=new Map,Gf.set(t,s);for(var i=t.querySelectorAll("link[data-precedence],style[data-precedence]"),r=0;r<i.length;r++){var a=i[r];(a.nodeName==="LINK"||a.getAttribute("media")!=="not all")&&(s.set(a.dataset.precedence,a),n=a)}n&&s.set(null,n)}i=e.instance,a=i.getAttribute("data-precedence"),r=s.get(a)||n,r===n&&s.set(null,i),s.set(a,i),this.count++,n=Hf.bind(this),i.addEventListener("load",n),i.addEventListener("error",n),r?r.parentNode.insertBefore(i,r.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(i,t.firstChild)),e.state.loading|=4}}var Fu={$$typeof:Ri,Provider:null,Consumer:null,_currentValue:Wa,_currentValue2:Wa,_threadCount:0};function g4(t,e,s,n,i,r,a,l,c){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=h0(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=h0(0),this.hiddenUpdates=h0(null),this.identifierPrefix=n,this.onUncaughtError=i,this.onCaughtError=r,this.onRecoverableError=a,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=c,this.incompleteTransitions=new Map}function bA(t,e,s,n,i,r,a,l,c,u,d,h){return t=new g4(t,e,s,a,c,u,d,h,l),e=1,r===!0&&(e|=24),r=Ys(3,null,null,e),t.current=r,r.stateNode=t,e=av(),e.refCount++,t.pooledCache=e,e.refCount++,r.memoizedState={element:n,isDehydrated:s,cache:e},cv(r),t}function vA(t){return t?(t=Jo,t):Jo}function yA(t,e,s,n,i,r){i=vA(i),n.context===null?n.context=i:n.pendingContext=i,n=$r(e),n.payload={element:s},r=r===void 0?null:r,r!==null&&(n.callback=r),s=Hr(t,n,e),s!==null&&(Vs(s,t,e),ou(s,t,e))}function Fw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<e?s:e}}function Dv(t,e){Fw(t,e),(t=t.alternate)&&Fw(t,e)}function _A(t){if(t.tag===13||t.tag===31){var e=No(t,67108864);e!==null&&Vs(e,t,67108864),Dv(t,67108864)}}function Uw(t){if(t.tag===13||t.tag===31){var e=rn();e=qb(e);var s=No(t,e);s!==null&&Vs(s,t,e),Dv(t,e)}}var zf=!0;function x4(t,e,s,n){var i=be.T;be.T=null;var r=$e.p;try{$e.p=2,Lv(t,e,s,n)}finally{$e.p=r,be.T=i}}function b4(t,e,s,n){var i=be.T;be.T=null;var r=$e.p;try{$e.p=8,Lv(t,e,s,n)}finally{$e.p=r,be.T=i}}function Lv(t,e,s,n){if(zf){var i=_x(n);if(i===null)U0(t,e,n,qf,s),$w(t,n);else if(y4(i,t,e,s,n))n.stopPropagation();else if($w(t,n),e&4&&-1<v4.indexOf(t)){for(;i!==null;){var r=ic(i);if(r!==null)switch(r.tag){case 3:if(r=r.stateNode,r.current.memoizedState.isDehydrated){var a=Da(r.pendingLanes);if(a!==0){var l=r;for(l.pendingLanes|=2,l.entangledLanes|=2;a;){var c=1<<31-nn(a);l.entanglements[1]|=c,a&=~c}mi(r),!(Ue&6)&&(Df=tn()+500,Ad(0))}}break;case 31:case 13:l=No(r,2),l!==null&&Vs(l,r,2),lp(),Dv(r,2)}if(r=_x(n),r===null&&U0(t,e,n,qf,s),r===i)break;i=r}i!==null&&n.stopPropagation()}else U0(t,e,n,null,s)}}function _x(t){return t=Xb(t),Pv(t)}var qf=null;function Pv(t){if(qf=null,t=qo(t),t!==null){var e=vd(t);if(e===null)t=null;else{var s=e.tag;if(s===13){if(t=UT(e),t!==null)return t;t=null}else if(s===31){if(t=$T(e),t!==null)return t;t=null}else if(s===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null)}}return qf=t,null}function wA(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(iM()){case qT:return 2;case KT:return 8;case _f:case rM:return 32;case WT:return 268435456;default:return 32}default:return 32}}var wx=!1,qr=null,Kr=null,Wr=null,Uu=new Map,$u=new Map,Tr=[],v4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $w(t,e){switch(t){case"focusin":case"focusout":qr=null;break;case"dragenter":case"dragleave":Kr=null;break;case"mouseover":case"mouseout":Wr=null;break;case"pointerover":case"pointerout":Uu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":$u.delete(e.pointerId)}}function Uc(t,e,s,n,i,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:s,eventSystemFlags:n,nativeEvent:r,targetContainers:[i]},e!==null&&(e=ic(e),e!==null&&_A(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function y4(t,e,s,n,i){switch(e){case"focusin":return qr=Uc(qr,t,e,s,n,i),!0;case"dragenter":return Kr=Uc(Kr,t,e,s,n,i),!0;case"mouseover":return Wr=Uc(Wr,t,e,s,n,i),!0;case"pointerover":var r=i.pointerId;return Uu.set(r,Uc(Uu.get(r)||null,t,e,s,n,i)),!0;case"gotpointercapture":return r=i.pointerId,$u.set(r,Uc($u.get(r)||null,t,e,s,n,i)),!0}return!1}function kA(t){var e=qo(t.target);if(e!==null){var s=vd(e);if(s!==null){if(e=s.tag,e===13){if(e=UT(s),e!==null){t.blockedOn=e,T1(t.priority,function(){Uw(s)});return}}else if(e===31){if(e=$T(s),e!==null){t.blockedOn=e,T1(t.priority,function(){Uw(s)});return}}else if(e===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function rf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var s=_x(t.nativeEvent);if(s===null){s=t.nativeEvent;var n=new s.constructor(s.type,s);Fg=n,s.target.dispatchEvent(n),Fg=null}else return e=ic(s),e!==null&&_A(e),t.blockedOn=s,!1;e.shift()}return!0}function Hw(t,e,s){rf(t)&&s.delete(e)}function _4(){wx=!1,qr!==null&&rf(qr)&&(qr=null),Kr!==null&&rf(Kr)&&(Kr=null),Wr!==null&&rf(Wr)&&(Wr=null),Uu.forEach(Hw),$u.forEach(Hw)}function Th(t,e){t.blockedOn===e&&(t.blockedOn=null,wx||(wx=!0,Jt.unstable_scheduleCallback(Jt.unstable_NormalPriority,_4)))}var Eh=null;function Gw(t){Eh!==t&&(Eh=t,Jt.unstable_scheduleCallback(Jt.unstable_NormalPriority,function(){Eh===t&&(Eh=null);for(var e=0;e<t.length;e+=3){var s=t[e],n=t[e+1],i=t[e+2];if(typeof n!="function"){if(Pv(n||s)===null)continue;break}var r=ic(s);r!==null&&(t.splice(e,3),e-=3,sx(r,{pending:!0,data:i,method:s.method,action:n},n,i))}}))}function Fl(t){function e(c){return Th(c,t)}qr!==null&&Th(qr,t),Kr!==null&&Th(Kr,t),Wr!==null&&Th(Wr,t),Uu.forEach(e),$u.forEach(e);for(var s=0;s<Tr.length;s++){var n=Tr[s];n.blockedOn===t&&(n.blockedOn=null)}for(;0<Tr.length&&(s=Tr[0],s.blockedOn===null);)kA(s),s.blockedOn===null&&Tr.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(n=0;n<s.length;n+=3){var i=s[n],r=s[n+1],a=i[Us]||null;if(typeof r=="function")a||Gw(s);else if(a){var l=null;if(r&&r.hasAttribute("formAction")){if(i=r,a=r[Us]||null)l=a.formAction;else if(Pv(i)!==null)continue}else l=a.action;typeof l=="function"?s[n+1]=l:(s.splice(n,3),n-=3),Gw(s)}}}function NA(){function t(r){r.canIntercept&&r.info==="react-transition"&&r.intercept({handler:function(){return new Promise(function(a){return i=a})},focusReset:"manual",scroll:"manual"})}function e(){i!==null&&(i(),i=null),n||setTimeout(s,20)}function s(){if(!n&&!navigation.transition){var r=navigation.currentEntry;r&&r.url!=null&&navigation.navigate(r.url,{state:r.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var n=!1,i=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(s,100),function(){n=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),i!==null&&(i(),i=null)}}}function Vv(t){this._internalRoot=t}dp.prototype.render=Vv.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(X(409));var s=e.current,n=rn();yA(s,n,t,e,null,null)};dp.prototype.unmount=Vv.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;yA(t.current,2,null,t,null,null),lp(),e[nc]=null}};function dp(t){this._internalRoot=t}dp.prototype.unstable_scheduleHydration=function(t){if(t){var e=ZT();t={blockedOn:null,target:t,priority:e};for(var s=0;s<Tr.length&&e!==0&&e<Tr[s].priority;s++);Tr.splice(s,0,t),s===0&&kA(t)}};var zw=BT.version;if(zw!=="19.2.3")throw Error(X(527,zw,"19.2.3"));$e.findDOMNode=function(t){var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(X(188)):(t=Object.keys(t).join(","),Error(X(268,t)));return t=QO(e),t=t!==null?HT(t):null,t=t===null?null:t.stateNode,t};var w4={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:be,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ah=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ah.isDisabled&&Ah.supportsFiber)try{yd=Ah.inject(w4),sn=Ah}catch{}}Wm.createRoot=function(t,e){if(!FT(t))throw Error(X(299));var s=!1,n="",i=p2,r=g2,a=x2;return e!=null&&(e.unstable_strictMode===!0&&(s=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onUncaughtError!==void 0&&(i=e.onUncaughtError),e.onCaughtError!==void 0&&(r=e.onCaughtError),e.onRecoverableError!==void 0&&(a=e.onRecoverableError)),e=bA(t,1,!1,null,null,s,n,null,i,r,a,NA),t[nc]=e.current,Iv(t),new Vv(e)};Wm.hydrateRoot=function(t,e,s){if(!FT(t))throw Error(X(299));var n=!1,i="",r=p2,a=g2,l=x2,c=null;return s!=null&&(s.unstable_strictMode===!0&&(n=!0),s.identifierPrefix!==void 0&&(i=s.identifierPrefix),s.onUncaughtError!==void 0&&(r=s.onUncaughtError),s.onCaughtError!==void 0&&(a=s.onCaughtError),s.onRecoverableError!==void 0&&(l=s.onRecoverableError),s.formState!==void 0&&(c=s.formState)),e=bA(t,1,!0,e,s??null,n,i,c,r,a,l,NA),e.context=vA(null),s=e.current,n=rn(),n=qb(n),i=$r(n),i.callback=null,Hr(s,i,n),s=n,e.current.lanes=s,wd(e,s),mi(e),t[nc]=e.current,Iv(t),new dp(e)};Wm.version="19.2.3";function SA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(SA)}catch(t){console.error(t)}}SA(),IT.exports=Wm;var k4=IT.exports;const N4=wT(k4);/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Hu(){return Hu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Hu.apply(this,arguments)}var Lr;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Lr||(Lr={}));const qw="popstate";function S4(t){t===void 0&&(t={});function e(n,i){let{pathname:r,search:a,hash:l}=n.location;return kx("",{pathname:r,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function s(n,i){return typeof i=="string"?i:TA(i)}return E4(e,s,null,t)}function zt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Bv(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function T4(){return Math.random().toString(36).substr(2,8)}function Kw(t,e){return{usr:t.state,key:t.key,idx:e}}function kx(t,e,s,n){return s===void 0&&(s=null),Hu({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?uc(e):e,{state:s,key:e&&e.key||n||T4()})}function TA(t){let{pathname:e="/",search:s="",hash:n=""}=t;return s&&s!=="?"&&(e+=s.charAt(0)==="?"?s:"?"+s),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function uc(t){let e={};if(t){let s=t.indexOf("#");s>=0&&(e.hash=t.substr(s),t=t.substr(0,s));let n=t.indexOf("?");n>=0&&(e.search=t.substr(n),t=t.substr(0,n)),t&&(e.pathname=t)}return e}function E4(t,e,s,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:r=!1}=n,a=i.history,l=Lr.Pop,c=null,u=d();u==null&&(u=0,a.replaceState(Hu({},a.state,{idx:u}),""));function d(){return(a.state||{idx:null}).idx}function h(){l=Lr.Pop;let v=d(),g=v==null?null:v-u;u=v,c&&c({action:l,location:x.location,delta:g})}function f(v,g){l=Lr.Push;let p=kx(x.location,v,g);u=d()+1;let y=Kw(p,u),k=x.createHref(p);try{a.pushState(y,"",k)}catch(w){if(w instanceof DOMException&&w.name==="DataCloneError")throw w;i.location.assign(k)}r&&c&&c({action:l,location:x.location,delta:1})}function m(v,g){l=Lr.Replace;let p=kx(x.location,v,g);u=d();let y=Kw(p,u),k=x.createHref(p);a.replaceState(y,"",k),r&&c&&c({action:l,location:x.location,delta:0})}function b(v){let g=i.location.origin!=="null"?i.location.origin:i.location.href,p=typeof v=="string"?v:TA(v);return p=p.replace(/ $/,"%20"),zt(g,"No window.location.(origin|href) available to create URL for href: "+p),new URL(p,g)}let x={get action(){return l},get location(){return t(i,a)},listen(v){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(qw,h),c=v,()=>{i.removeEventListener(qw,h),c=null}},createHref(v){return e(i,v)},createURL:b,encodeLocation(v){let g=b(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:m,go(v){return a.go(v)}};return x}var Ww;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ww||(Ww={}));function A4(t,e,s){return s===void 0&&(s="/"),j4(t,e,s)}function j4(t,e,s,n){let i=typeof e=="string"?uc(e):e,r=jA(i.pathname||"/",s);if(r==null)return null;let a=EA(t);C4(a);let l=null;for(let c=0;l==null&&c<a.length;++c){let u=$4(r);l=B4(a[c],u)}return l}function EA(t,e,s,n){e===void 0&&(e=[]),s===void 0&&(s=[]),n===void 0&&(n="");let i=(r,a,l)=>{let c={relativePath:l===void 0?r.path||"":l,caseSensitive:r.caseSensitive===!0,childrenIndex:a,route:r};c.relativePath.startsWith("/")&&(zt(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let u=Za([n,c.relativePath]),d=s.concat(c);r.children&&r.children.length>0&&(zt(r.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),EA(r.children,e,d,u)),!(r.path==null&&!r.index)&&e.push({path:u,score:P4(u,r.index),routesMeta:d})};return t.forEach((r,a)=>{var l;if(r.path===""||!((l=r.path)!=null&&l.includes("?")))i(r,a);else for(let c of AA(r.path))i(r,a,c)}),e}function AA(t){let e=t.split("/");if(e.length===0)return[];let[s,...n]=e,i=s.endsWith("?"),r=s.replace(/\?$/,"");if(n.length===0)return i?[r,""]:[r];let a=AA(n.join("/")),l=[];return l.push(...a.map(c=>c===""?r:[r,c].join("/"))),i&&l.push(...a),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function C4(t){t.sort((e,s)=>e.score!==s.score?s.score-e.score:V4(e.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}const R4=/^:[\w-]+$/,I4=3,O4=2,M4=1,D4=10,L4=-2,Yw=t=>t==="*";function P4(t,e){let s=t.split("/"),n=s.length;return s.some(Yw)&&(n+=L4),e&&(n+=O4),s.filter(i=>!Yw(i)).reduce((i,r)=>i+(R4.test(r)?I4:r===""?M4:D4),n)}function V4(t,e){return t.length===e.length&&t.slice(0,-1).every((n,i)=>n===e[i])?t[t.length-1]-e[e.length-1]:0}function B4(t,e,s){let{routesMeta:n}=t,i={},r="/",a=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,d=r==="/"?e:e.slice(r.length)||"/",h=F4({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},d),f=c.route;if(!h)return null;Object.assign(i,h.params),a.push({params:i,pathname:Za([r,h.pathname]),pathnameBase:K4(Za([r,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(r=Za([r,h.pathnameBase]))}return a}function F4(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,n]=U4(t.path,t.caseSensitive,t.end),i=e.match(s);if(!i)return null;let r=i[0],a=r.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((u,d,h)=>{let{paramName:f,isOptional:m}=d;if(f==="*"){let x=l[h]||"";a=r.slice(0,r.length-x.length).replace(/(.)\/+$/,"$1")}const b=l[h];return m&&!b?u[f]=void 0:u[f]=(b||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:a,pattern:t}}function U4(t,e,s){e===void 0&&(e=!1),s===void 0&&(s=!0),Bv(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let n=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function $4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Bv(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function jA(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,n=t.charAt(s);return n&&n!=="/"?null:t.slice(s)||"/"}const H4=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,G4=t=>H4.test(t);function z4(t,e){e===void 0&&(e="/");let{pathname:s,search:n="",hash:i=""}=typeof t=="string"?uc(t):t,r;if(s)if(G4(s))r=s;else{if(s.includes("//")){let a=s;s=s.replace(/\/\/+/g,"/"),Bv(!1,"Pathnames cannot have embedded double slashes - normalizing "+(a+" -> "+s))}s.startsWith("/")?r=Xw(s.substring(1),"/"):r=Xw(s,e)}else r=e;return{pathname:r,search:W4(n),hash:Y4(i)}}function Xw(t,e){let s=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?s.length>1&&s.pop():i!=="."&&s.push(i)}),s.length>1?s.join("/"):"/"}function G0(t,e,s,n){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+s+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function q4(t){return t.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function CA(t,e){let s=q4(t);return e?s.map((n,i)=>i===s.length-1?n.pathname:n.pathnameBase):s.map(n=>n.pathnameBase)}function RA(t,e,s,n){n===void 0&&(n=!1);let i;typeof t=="string"?i=uc(t):(i=Hu({},t),zt(!i.pathname||!i.pathname.includes("?"),G0("?","pathname","search",i)),zt(!i.pathname||!i.pathname.includes("#"),G0("#","pathname","hash",i)),zt(!i.search||!i.search.includes("#"),G0("#","search","hash",i)));let r=t===""||i.pathname==="",a=r?"/":i.pathname,l;if(a==null)l=s;else{let h=e.length-1;if(!n&&a.startsWith("..")){let f=a.split("/");for(;f[0]==="..";)f.shift(),h-=1;i.pathname=f.join("/")}l=h>=0?e[h]:"/"}let c=z4(i,l),u=a&&a!=="/"&&a.endsWith("/"),d=(r||a===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(u||d)&&(c.pathname+="/"),c}const Za=t=>t.join("/").replace(/\/\/+/g,"/"),K4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),W4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Y4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function X4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const IA=["post","put","patch","delete"];new Set(IA);const Q4=["get",...IA];new Set(Q4);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Gu(){return Gu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},Gu.apply(this,arguments)}const Fv=N.createContext(null),J4=N.createContext(null),Rd=N.createContext(null),hp=N.createContext(null),ka=N.createContext({outlet:null,matches:[],isDataRoute:!1}),OA=N.createContext(null);function Id(){return N.useContext(hp)!=null}function fp(){return Id()||zt(!1),N.useContext(hp).location}function MA(t){N.useContext(Rd).static||N.useLayoutEffect(t)}function dc(){let{isDataRoute:t}=N.useContext(ka);return t?d3():Z4()}function Z4(){Id()||zt(!1);let t=N.useContext(Fv),{basename:e,future:s,navigator:n}=N.useContext(Rd),{matches:i}=N.useContext(ka),{pathname:r}=fp(),a=JSON.stringify(CA(i,s.v7_relativeSplatPath)),l=N.useRef(!1);return MA(()=>{l.current=!0}),N.useCallback(function(u,d){if(d===void 0&&(d={}),!l.current)return;if(typeof u=="number"){n.go(u);return}let h=RA(u,JSON.parse(a),r,d.relative==="path");t==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Za([e,h.pathname])),(d.replace?n.replace:n.push)(h,d.state,d)},[e,n,a,r,t])}function DA(){let{matches:t}=N.useContext(ka),e=t[t.length-1];return e?e.params:{}}function e3(t,e){return t3(t,e)}function t3(t,e,s,n){Id()||zt(!1);let{navigator:i}=N.useContext(Rd),{matches:r}=N.useContext(ka),a=r[r.length-1],l=a?a.params:{};a&&a.pathname;let c=a?a.pathnameBase:"/";a&&a.route;let u=fp(),d;if(e){var h;let v=typeof e=="string"?uc(e):e;c==="/"||(h=v.pathname)!=null&&h.startsWith(c)||zt(!1),d=v}else d=u;let f=d.pathname||"/",m=f;if(c!=="/"){let v=c.replace(/^\//,"").split("/");m="/"+f.replace(/^\//,"").split("/").slice(v.length).join("/")}let b=A4(t,{pathname:m}),x=a3(b&&b.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:Za([c,i.encodeLocation?i.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:Za([c,i.encodeLocation?i.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),r,s,n);return e&&x?N.createElement(hp.Provider,{value:{location:Gu({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:Lr.Pop}},x):x}function s3(){let t=u3(),e=X4(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return N.createElement(N.Fragment,null,N.createElement("h2",null,"Unexpected Application Error!"),N.createElement("h3",{style:{fontStyle:"italic"}},e),s?N.createElement("pre",{style:i},s):null,null)}const n3=N.createElement(s3,null);class i3 extends N.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,s){return s.location!==e.location||s.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:s.error,location:s.location,revalidation:e.revalidation||s.revalidation}}componentDidCatch(e,s){console.error("React Router caught the following error during render",e,s)}render(){return this.state.error!==void 0?N.createElement(ka.Provider,{value:this.props.routeContext},N.createElement(OA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function r3(t){let{routeContext:e,match:s,children:n}=t,i=N.useContext(Fv);return i&&i.static&&i.staticContext&&(s.route.errorElement||s.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=s.route.id),N.createElement(ka.Provider,{value:e},n)}function a3(t,e,s,n){var i;if(e===void 0&&(e=[]),s===void 0&&(s=null),n===void 0&&(n=null),t==null){var r;if(!s)return null;if(s.errors)t=s.matches;else if((r=n)!=null&&r.v7_partialHydration&&e.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let a=t,l=(i=s)==null?void 0:i.errors;if(l!=null){let d=a.findIndex(h=>h.route.id&&(l==null?void 0:l[h.route.id])!==void 0);d>=0||zt(!1),a=a.slice(0,Math.min(a.length,d+1))}let c=!1,u=-1;if(s&&n&&n.v7_partialHydration)for(let d=0;d<a.length;d++){let h=a[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(u=d),h.route.id){let{loaderData:f,errors:m}=s,b=h.route.loader&&f[h.route.id]===void 0&&(!m||m[h.route.id]===void 0);if(h.route.lazy||b){c=!0,u>=0?a=a.slice(0,u+1):a=[a[0]];break}}}return a.reduceRight((d,h,f)=>{let m,b=!1,x=null,v=null;s&&(m=l&&h.route.id?l[h.route.id]:void 0,x=h.route.errorElement||n3,c&&(u<0&&f===0?(h3("route-fallback"),b=!0,v=null):u===f&&(b=!0,v=h.route.hydrateFallbackElement||null)));let g=e.concat(a.slice(0,f+1)),p=()=>{let y;return m?y=x:b?y=v:h.route.Component?y=N.createElement(h.route.Component,null):h.route.element?y=h.route.element:y=d,N.createElement(r3,{match:h,routeContext:{outlet:d,matches:g,isDataRoute:s!=null},children:y})};return s&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?N.createElement(i3,{location:s.location,revalidation:s.revalidation,component:x,error:m,children:p(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):p()},null)}var LA=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(LA||{}),PA=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(PA||{});function o3(t){let e=N.useContext(Fv);return e||zt(!1),e}function l3(t){let e=N.useContext(J4);return e||zt(!1),e}function c3(t){let e=N.useContext(ka);return e||zt(!1),e}function VA(t){let e=c3(),s=e.matches[e.matches.length-1];return s.route.id||zt(!1),s.route.id}function u3(){var t;let e=N.useContext(OA),s=l3(),n=VA();return e!==void 0?e:(t=s.errors)==null?void 0:t[n]}function d3(){let{router:t}=o3(LA.UseNavigateStable),e=VA(PA.UseNavigateStable),s=N.useRef(!1);return MA(()=>{s.current=!0}),N.useCallback(function(i,r){r===void 0&&(r={}),s.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Gu({fromRouteId:e},r)))},[t,e])}const Qw={};function h3(t,e,s){Qw[t]||(Qw[t]=!0)}function f3(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function m3(t){let{to:e,replace:s,state:n,relative:i}=t;Id()||zt(!1);let{future:r,static:a}=N.useContext(Rd),{matches:l}=N.useContext(ka),{pathname:c}=fp(),u=dc(),d=RA(e,CA(l,r.v7_relativeSplatPath),c,i==="path"),h=JSON.stringify(d);return N.useEffect(()=>u(JSON.parse(h),{replace:s,state:n,relative:i}),[u,h,i,s,n]),null}function Jc(t){zt(!1)}function p3(t){let{basename:e="/",children:s=null,location:n,navigationType:i=Lr.Pop,navigator:r,static:a=!1,future:l}=t;Id()&&zt(!1);let c=e.replace(/^\/*/,"/"),u=N.useMemo(()=>({basename:c,navigator:r,static:a,future:Gu({v7_relativeSplatPath:!1},l)}),[c,l,r,a]);typeof n=="string"&&(n=uc(n));let{pathname:d="/",search:h="",hash:f="",state:m=null,key:b="default"}=n,x=N.useMemo(()=>{let v=jA(d,c);return v==null?null:{location:{pathname:v,search:h,hash:f,state:m,key:b},navigationType:i}},[c,d,h,f,m,b,i]);return x==null?null:N.createElement(Rd.Provider,{value:u},N.createElement(hp.Provider,{children:s,value:x}))}function g3(t){let{children:e,location:s}=t;return e3(Nx(e),s)}new Promise(()=>{});function Nx(t,e){e===void 0&&(e=[]);let s=[];return N.Children.forEach(t,(n,i)=>{if(!N.isValidElement(n))return;let r=[...e,i];if(n.type===N.Fragment){s.push.apply(s,Nx(n.props.children,r));return}n.type!==Jc&&zt(!1),!n.props.index||!n.props.children||zt(!1);let a={id:n.props.id||r.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(a.children=Nx(n.props.children,r)),s.push(a)}),s}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Sx(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,s)=>{let n=t[s];return e.concat(Array.isArray(n)?n.map(i=>[s,i]):[[s,n]])},[]))}function x3(t,e){let s=Sx(t);return e&&e.forEach((n,i)=>{s.has(i)||e.getAll(i).forEach(r=>{s.append(i,r)})}),s}const b3="6";try{window.__reactRouterVersion=b3}catch{}const v3="startTransition",Jw=zO[v3];function y3(t){let{basename:e,children:s,future:n,window:i}=t,r=N.useRef();r.current==null&&(r.current=S4({window:i,v5Compat:!0}));let a=r.current,[l,c]=N.useState({action:a.action,location:a.location}),{v7_startTransition:u}=n||{},d=N.useCallback(h=>{u&&Jw?Jw(()=>c(h)):c(h)},[c,u]);return N.useLayoutEffect(()=>a.listen(d),[a,d]),N.useEffect(()=>f3(n),[n]),N.createElement(p3,{basename:e,children:s,location:l.location,navigationType:l.action,navigator:a,future:n})}var Zw;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Zw||(Zw={}));var ek;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(ek||(ek={}));function _3(t){let e=N.useRef(Sx(t)),s=N.useRef(!1),n=fp(),i=N.useMemo(()=>x3(n.search,s.current?null:e.current),[n.search]),r=dc(),a=N.useCallback((l,c)=>{const u=Sx(typeof l=="function"?l(i):l);s.current=!0,r("?"+u,c)},[r,i]);return[i,a]}const BA=N.createContext({setFullWidth:()=>{},setHideHeader:()=>{}}),FA=()=>N.useContext(BA),w3=({children:t})=>{const[,e]=N.useState(!1),[,s]=N.useState(!1);return o.jsx(BA.Provider,{value:{setFullWidth:e,setHideHeader:s},children:t})},k3=()=>{};var tk={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UA={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const te=function(t,e){if(!t)throw hc(e)},hc=function(t){return new Error("Firebase Database ("+UA.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $A=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):(i&64512)===55296&&n+1<t.length&&(t.charCodeAt(n+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++n)&1023),e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},N3=function(t){const e=[];let s=0,n=0;for(;s<t.length;){const i=t[s++];if(i<128)e[n++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[s++];e[n++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[s++],a=t[s++],l=t[s++],c=((i&7)<<18|(r&63)<<12|(a&63)<<6|l&63)-65536;e[n++]=String.fromCharCode(55296+(c>>10)),e[n++]=String.fromCharCode(56320+(c&1023))}else{const r=t[s++],a=t[s++];e[n++]=String.fromCharCode((i&15)<<12|(r&63)<<6|a&63)}}return e.join("")},Uv={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<t.length;i+=3){const r=t[i],a=i+1<t.length,l=a?t[i+1]:0,c=i+2<t.length,u=c?t[i+2]:0,d=r>>2,h=(r&3)<<4|l>>4;let f=(l&15)<<2|u>>6,m=u&63;c||(m=64,a||(f=64)),n.push(s[d],s[h],s[f],s[m])}return n.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray($A(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):N3(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const s=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<t.length;){const r=s[t.charAt(i++)],l=i<t.length?s[t.charAt(i)]:0;++i;const u=i<t.length?s[t.charAt(i)]:64;++i;const h=i<t.length?s[t.charAt(i)]:64;if(++i,r==null||l==null||u==null||h==null)throw new S3;const f=r<<2|l>>4;if(n.push(f),u!==64){const m=l<<4&240|u>>2;if(n.push(m),h!==64){const b=u<<6&192|h;n.push(b)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class S3 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const HA=function(t){const e=$A(t);return Uv.encodeByteArray(e,!0)},Kf=function(t){return HA(t).replace(/\./g,"")},Wf=function(t){try{return Uv.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T3(t){return GA(void 0,t)}function GA(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const s=e;return new Date(s.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const s in e)!e.hasOwnProperty(s)||!E3(s)||(t[s]=GA(t[s],e[s]));return t}function E3(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A3(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j3=()=>A3().__FIREBASE_DEFAULTS__,C3=()=>{if(typeof process>"u"||typeof tk>"u")return;const t=tk.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},R3=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Wf(t[1]);return e&&JSON.parse(e)},$v=()=>{try{return k3()||j3()||C3()||R3()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},zA=t=>{var e,s;return(s=(e=$v())===null||e===void 0?void 0:e.emulatorHosts)===null||s===void 0?void 0:s[t]},I3=t=>{const e=zA(t);if(!e)return;const s=e.lastIndexOf(":");if(s<=0||s+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const n=parseInt(e.substring(s+1),10);return e[0]==="["?[e.substring(1,s-1),n]:[e.substring(0,s),n]},qA=()=>{var t;return(t=$v())===null||t===void 0?void 0:t.config},KA=t=>{var e;return(e=$v())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,s)=>{this.resolve=e,this.reject=s})}wrapCallback(e){return(s,n)=>{s?this.reject(s):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(s):e(s,n))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function WA(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O3(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},n=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Kf(JSON.stringify(s)),Kf(JSON.stringify(a)),""].join(".")}const gu={};function M3(){const t={prod:[],emulator:[]};for(const e of Object.keys(gu))gu[e]?t.emulator.push(e):t.prod.push(e);return t}function D3(t){let e=document.getElementById(t),s=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),s=!0),{created:s,element:e}}let sk=!1;function YA(t,e){if(typeof window>"u"||typeof document>"u"||!fc(window.location.host)||gu[t]===e||gu[t]||sk)return;gu[t]=e;function s(f){return`__firebase__banner__${f}`}const n="__firebase__banner",r=M3().prod.length>0;function a(){const f=document.getElementById(n);f&&f.remove()}function l(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function c(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function u(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{sk=!0,a()},f}function d(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=D3(n),m=s("text"),b=document.getElementById(m)||document.createElement("span"),x=s("learnmore"),v=document.getElementById(x)||document.createElement("a"),g=s("preprendIcon"),p=document.getElementById(g)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const y=f.element;l(y),d(v,x);const k=u();c(p,g),y.append(p,b,v,k),document.body.appendChild(y)}r?(b.innerText="Preview backend disconnected.",p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Es(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Hv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Es())}function L3(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function P3(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function XA(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function V3(){const t=Es();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function B3(){return UA.NODE_ADMIN===!0}function F3(){try{return typeof indexedDB=="object"}catch{return!1}}function U3(){return new Promise((t,e)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),s||self.indexedDB.deleteDatabase(n),t(!0)},i.onupgradeneeded=()=>{s=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(s){e(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $3="FirebaseError";class Na extends Error{constructor(e,s,n){super(s),this.code=e,this.customData=n,this.name=$3,Object.setPrototypeOf(this,Na.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Od.prototype.create)}}class Od{constructor(e,s,n){this.service=e,this.serviceName=s,this.errors=n}create(e,...s){const n=s[0]||{},i=`${this.service}/${e}`,r=this.errors[e],a=r?H3(r,n):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Na(i,l,n)}}function H3(t,e){return t.replace(G3,(s,n)=>{const i=e[n];return i!=null?String(i):`<${n}?>`})}const G3=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zu(t){return JSON.parse(t)}function Qt(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QA=function(t){let e={},s={},n={},i="";try{const r=t.split(".");e=zu(Wf(r[0])||""),s=zu(Wf(r[1])||""),i=r[2],n=s.d||{},delete s.d}catch{}return{header:e,claims:s,data:n,signature:i}},z3=function(t){const e=QA(t),s=e.claims;return!!s&&typeof s=="object"&&s.hasOwnProperty("iat")},q3=function(t){const e=QA(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function uo(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Yf(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Xf(t,e,s){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=e.call(s,t[i],i,t));return n}function ho(t,e){if(t===e)return!0;const s=Object.keys(t),n=Object.keys(e);for(const i of s){if(!n.includes(i))return!1;const r=t[i],a=e[i];if(nk(r)&&nk(a)){if(!ho(r,a))return!1}else if(r!==a)return!1}for(const i of n)if(!s.includes(i))return!1;return!0}function nk(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(t){const e=[];for(const[s,n]of Object.entries(t))Array.isArray(n)?n.forEach(i=>{e.push(encodeURIComponent(s)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Zc(t){const e={};return t.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[i,r]=n.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function eu(t){const e=t.indexOf("?");if(!e)return"";const s=t.indexOf("#",e);return t.substring(e,s>0?s:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K3{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,s){s||(s=0);const n=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)n[h]=e.charCodeAt(s)<<24|e.charCodeAt(s+1)<<16|e.charCodeAt(s+2)<<8|e.charCodeAt(s+3),s+=4;else for(let h=0;h<16;h++)n[h]=e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3],s+=4;for(let h=16;h<80;h++){const f=n[h-3]^n[h-8]^n[h-14]^n[h-16];n[h]=(f<<1|f>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4],u,d;for(let h=0;h<80;h++){h<40?h<20?(u=l^r&(a^l),d=1518500249):(u=r^a^l,d=1859775393):h<60?(u=r&a|l&(r|a),d=2400959708):(u=r^a^l,d=3395469782);const f=(i<<5|i>>>27)+u+c+d+n[h]&4294967295;c=l,l=a,a=(r<<30|r>>>2)&4294967295,r=i,i=f}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,s){if(e==null)return;s===void 0&&(s=e.length);const n=s-this.blockSize;let i=0;const r=this.buf_;let a=this.inbuf_;for(;i<s;){if(a===0)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<s;)if(r[a]=e.charCodeAt(i),++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}else for(;i<s;)if(r[a]=e[i],++a,++i,a===this.blockSize){this.compress_(r),a=0;break}}this.inbuf_=a,this.total_+=s}digest(){const e=[];let s=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=s&255,s/=256;this.compress_(this.buf_);let n=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[i]>>r&255,++n;return e}}function W3(t,e){const s=new Y3(t,e);return s.subscribe.bind(s)}class Y3{constructor(e,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(s=>{s.next(e)})}error(e){this.forEachObserver(s=>{s.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,s,n){let i;if(e===void 0&&s===void 0&&n===void 0)throw new Error("Missing Observer.");X3(e,["next","error","complete"])?i=e:i={next:e,error:s,complete:n},i.next===void 0&&(i.next=z0),i.error===void 0&&(i.error=z0),i.complete===void 0&&(i.complete=z0);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,e)}sendOne(e,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{s(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function X3(t,e){if(typeof t!="object"||t===null)return!1;for(const s of e)if(s in t&&typeof t[s]=="function")return!0;return!1}function z0(){}function Ul(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3=function(t){const e=[];let s=0;for(let n=0;n<t.length;n++){let i=t.charCodeAt(n);if(i>=55296&&i<=56319){const r=i-55296;n++,te(n<t.length,"Surrogate pair missing trail surrogate.");const a=t.charCodeAt(n)-56320;i=65536+(r<<10)+a}i<128?e[s++]=i:i<2048?(e[s++]=i>>6|192,e[s++]=i&63|128):i<65536?(e[s++]=i>>12|224,e[s++]=i>>6&63|128,e[s++]=i&63|128):(e[s++]=i>>18|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128,e[s++]=i&63|128)}return e},mp=function(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);n<128?e++:n<2048?e+=2:n>=55296&&n<=56319?(e+=4,s++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(t){return t&&t._delegate?t._delegate:t}class fo{constructor(e,s,n){this.name=e,this.instanceFactory=s,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Va="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J3{constructor(e,s){this.name=e,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const s=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(s)){const n=new Ln;if(this.instancesDeferred.set(s,n),this.isInitialized(s)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:s});i&&n.resolve(i)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(e){var s;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(s=e==null?void 0:e.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eL(e))try{this.getOrInitializeService({instanceIdentifier:Va})}catch{}for(const[s,n]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(s);try{const r=this.getOrInitializeService({instanceIdentifier:i});n.resolve(r)}catch{}}}}clearInstance(e=Va){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...e.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Va){return this.instances.has(e)}getOptions(e=Va){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:s={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:s});for(const[r,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);n===l&&a.resolve(i)}return i}onInit(e,s){var n;const i=this.normalizeInstanceIdentifier(s),r=(n=this.onInitCallbacks.get(i))!==null&&n!==void 0?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const a=this.instances.get(i);return a&&e(a,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,s){const n=this.onInitCallbacks.get(s);if(n)for(const i of n)try{i(e,s)}catch{}}getOrInitializeService({instanceIdentifier:e,options:s={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Z3(e),options:s}),this.instances.set(e,n),this.instancesOptions.set(e,s),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Va){return this.component?this.component.multipleInstances?e:Va:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Z3(t){return t===Va?void 0:t}function eL(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tL{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const s=this.getProvider(e.name);if(s.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);s.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const s=new J3(e,this);return this.providers.set(e,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var et;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(et||(et={}));const sL={debug:et.DEBUG,verbose:et.VERBOSE,info:et.INFO,warn:et.WARN,error:et.ERROR,silent:et.SILENT},nL=et.INFO,iL={[et.DEBUG]:"log",[et.VERBOSE]:"log",[et.INFO]:"info",[et.WARN]:"warn",[et.ERROR]:"error"},rL=(t,e,...s)=>{if(e<t.logLevel)return;const n=new Date().toISOString(),i=iL[e];if(i)console[i](`[${n}]  ${t.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Gv{constructor(e){this.name=e,this._logLevel=nL,this._logHandler=rL,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in et))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?sL[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,et.DEBUG,...e),this._logHandler(this,et.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,et.VERBOSE,...e),this._logHandler(this,et.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,et.INFO,...e),this._logHandler(this,et.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,et.WARN,...e),this._logHandler(this,et.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,et.ERROR,...e),this._logHandler(this,et.ERROR,...e)}}const aL=(t,e)=>e.some(s=>t instanceof s);let ik,rk;function oL(){return ik||(ik=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function lL(){return rk||(rk=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const JA=new WeakMap,Tx=new WeakMap,ZA=new WeakMap,q0=new WeakMap,zv=new WeakMap;function cL(t){const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",a)},r=()=>{s(Yr(t.result)),i()},a=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",a)});return e.then(s=>{s instanceof IDBCursor&&JA.set(s,t)}).catch(()=>{}),zv.set(e,t),e}function uL(t){if(Tx.has(t))return;const e=new Promise((s,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",a),t.removeEventListener("abort",a)},r=()=>{s(),i()},a=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",a),t.addEventListener("abort",a)});Tx.set(t,e)}let Ex={get(t,e,s){if(t instanceof IDBTransaction){if(e==="done")return Tx.get(t);if(e==="objectStoreNames")return t.objectStoreNames||ZA.get(t);if(e==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Yr(t[e])},set(t,e,s){return t[e]=s,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function dL(t){Ex=t(Ex)}function hL(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...s){const n=t.call(K0(this),e,...s);return ZA.set(n,e.sort?e.sort():[e]),Yr(n)}:lL().includes(t)?function(...e){return t.apply(K0(this),e),Yr(JA.get(this))}:function(...e){return Yr(t.apply(K0(this),e))}}function fL(t){return typeof t=="function"?hL(t):(t instanceof IDBTransaction&&uL(t),aL(t,oL())?new Proxy(t,Ex):t)}function Yr(t){if(t instanceof IDBRequest)return cL(t);if(q0.has(t))return q0.get(t);const e=fL(t);return e!==t&&(q0.set(t,e),zv.set(e,t)),e}const K0=t=>zv.get(t);function mL(t,e,{blocked:s,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(t,e),l=Yr(a);return n&&a.addEventListener("upgradeneeded",c=>{n(Yr(a.result),c.oldVersion,c.newVersion,Yr(a.transaction),c)}),s&&a.addEventListener("blocked",c=>s(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const pL=["get","getKey","getAll","getAllKeys","count"],gL=["put","add","delete","clear"],W0=new Map;function ak(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(W0.get(e))return W0.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,i=gL.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!(i||pL.includes(s)))return;const r=async function(a,...l){const c=this.transaction(a,i?"readwrite":"readonly");let u=c.store;return n&&(u=u.index(l.shift())),(await Promise.all([u[s](...l),i&&c.done]))[0]};return W0.set(e,r),r}dL(t=>({...t,get:(e,s,n)=>ak(e,s)||t.get(e,s,n),has:(e,s)=>!!ak(e,s)||t.has(e,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xL{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(bL(s)){const n=s.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(s=>s).join(" ")}}function bL(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ax="@firebase/app",ok="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qi=new Gv("@firebase/app"),vL="@firebase/app-compat",yL="@firebase/analytics-compat",_L="@firebase/analytics",wL="@firebase/app-check-compat",kL="@firebase/app-check",NL="@firebase/auth",SL="@firebase/auth-compat",TL="@firebase/database",EL="@firebase/data-connect",AL="@firebase/database-compat",jL="@firebase/functions",CL="@firebase/functions-compat",RL="@firebase/installations",IL="@firebase/installations-compat",OL="@firebase/messaging",ML="@firebase/messaging-compat",DL="@firebase/performance",LL="@firebase/performance-compat",PL="@firebase/remote-config",VL="@firebase/remote-config-compat",BL="@firebase/storage",FL="@firebase/storage-compat",UL="@firebase/firestore",$L="@firebase/ai",HL="@firebase/firestore-compat",GL="firebase",zL="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jx="[DEFAULT]",qL={[Ax]:"fire-core",[vL]:"fire-core-compat",[_L]:"fire-analytics",[yL]:"fire-analytics-compat",[kL]:"fire-app-check",[wL]:"fire-app-check-compat",[NL]:"fire-auth",[SL]:"fire-auth-compat",[TL]:"fire-rtdb",[EL]:"fire-data-connect",[AL]:"fire-rtdb-compat",[jL]:"fire-fn",[CL]:"fire-fn-compat",[RL]:"fire-iid",[IL]:"fire-iid-compat",[OL]:"fire-fcm",[ML]:"fire-fcm-compat",[DL]:"fire-perf",[LL]:"fire-perf-compat",[PL]:"fire-rc",[VL]:"fire-rc-compat",[BL]:"fire-gcs",[FL]:"fire-gcs-compat",[UL]:"fire-fst",[HL]:"fire-fst-compat",[$L]:"fire-vertex","fire-js":"fire-js",[GL]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qf=new Map,KL=new Map,Cx=new Map;function lk(t,e){try{t.container.addComponent(e)}catch(s){Qi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,s)}}function $l(t){const e=t.name;if(Cx.has(e))return Qi.debug(`There were multiple attempts to register component ${e}.`),!1;Cx.set(e,t);for(const s of Qf.values())lk(s,t);for(const s of KL.values())lk(s,t);return!0}function qv(t,e){const s=t.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),t.container.getProvider(e)}function Xs(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WL={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Xr=new Od("app","Firebase",WL);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YL{constructor(e,s,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new fo("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Xr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pc=zL;function e5(t,e={}){let s=t;typeof e!="object"&&(e={name:e});const n=Object.assign({name:jx,automaticDataCollectionEnabled:!0},e),i=n.name;if(typeof i!="string"||!i)throw Xr.create("bad-app-name",{appName:String(i)});if(s||(s=qA()),!s)throw Xr.create("no-options");const r=Qf.get(i);if(r){if(ho(s,r.options)&&ho(n,r.config))return r;throw Xr.create("duplicate-app",{appName:i})}const a=new tL(i);for(const c of Cx.values())a.addComponent(c);const l=new YL(s,n,a);return Qf.set(i,l),l}function t5(t=jx){const e=Qf.get(t);if(!e&&t===jx&&qA())return e5();if(!e)throw Xr.create("no-app",{appName:t});return e}function Qr(t,e,s){var n;let i=(n=qL[t])!==null&&n!==void 0?n:t;s&&(i+=`-${s}`);const r=i.match(/\s|\//),a=e.match(/\s|\//);if(r||a){const l=[`Unable to register library "${i}" with version "${e}":`];r&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Qi.warn(l.join(" "));return}$l(new fo(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XL="firebase-heartbeat-database",QL=1,qu="firebase-heartbeat-store";let Y0=null;function s5(){return Y0||(Y0=mL(XL,QL,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(qu)}catch(s){console.warn(s)}}}}).catch(t=>{throw Xr.create("idb-open",{originalErrorMessage:t.message})})),Y0}async function JL(t){try{const s=(await s5()).transaction(qu),n=await s.objectStore(qu).get(n5(t));return await s.done,n}catch(e){if(e instanceof Na)Qi.warn(e.message);else{const s=Xr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Qi.warn(s.message)}}}async function ck(t,e){try{const n=(await s5()).transaction(qu,"readwrite");await n.objectStore(qu).put(e,n5(t)),await n.done}catch(s){if(s instanceof Na)Qi.warn(s.message);else{const n=Xr.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Qi.warn(n.message)}}}function n5(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZL=1024,eP=30;class tP{constructor(e){this.container=e,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new nP(s),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,s;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=uk();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(a=>a.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats.length>eP){const a=iP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){Qi.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=uk(),{heartbeatsToSend:n,unsentEntries:i}=sP(this._heartbeatsCache.heartbeats),r=Kf(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=s,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(s){return Qi.warn(s),""}}}function uk(){return new Date().toISOString().substring(0,10)}function sP(t,e=ZL){const s=[];let n=t.slice();for(const i of t){const r=s.find(a=>a.agent===i.agent);if(r){if(r.dates.push(i.date),dk(s)>e){r.dates.pop();break}}else if(s.push({agent:i.agent,dates:[i.date]}),dk(s)>e){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}class nP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return F3()?U3().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await JL(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return ck(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var s;if(await this._canUseIndexedDBPromise){const i=await this.read();return ck(this.app,{lastSentHeartbeatDate:(s=e.lastSentHeartbeatDate)!==null&&s!==void 0?s:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function dk(t){return Kf(JSON.stringify({version:2,heartbeats:t})).length}function iP(t){if(t.length===0)return-1;let e=0,s=t[0].date;for(let n=1;n<t.length;n++)t[n].date<s&&(s=t[n].date,e=n);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rP(t){$l(new fo("platform-logger",e=>new xL(e),"PRIVATE")),$l(new fo("heartbeat",e=>new tP(e),"PRIVATE")),Qr(Ax,ok,t),Qr(Ax,ok,"esm2017"),Qr("fire-js","")}rP("");function Kv(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(s[n[i]]=t[n[i]]);return s}function Jn(t,e,s,n){var i=arguments.length,r=i<3?e:n,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(t,e,s,n);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(r=(i<3?a(r):i>3?a(e,s,r):a(e,s))||r);return i>3&&r&&Object.defineProperty(e,s,r),r}function Lt(t,e,s,n){function i(r){return r instanceof s?r:new s(function(a){a(r)})}return new(s||(s=Promise))(function(r,a){function l(d){try{u(n.next(d))}catch(h){a(h)}}function c(d){try{u(n.throw(d))}catch(h){a(h)}}function u(d){d.done?r(d.value):i(d.value).then(l,c)}u((n=n.apply(t,e||[])).next())})}function i5(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const aP=i5,r5=new Od("auth","Firebase",i5());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf=new Gv("@firebase/auth");function oP(t,...e){Jf.logLevel<=et.WARN&&Jf.warn(`Auth (${pc}): ${t}`,...e)}function af(t,...e){Jf.logLevel<=et.ERROR&&Jf.error(`Auth (${pc}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(t,...e){throw Wv(t,...e)}function ri(t,...e){return Wv(t,...e)}function a5(t,e,s){const n=Object.assign(Object.assign({},aP()),{[e]:s});return new Od("auth","Firebase",n).create(e,{appName:t.name})}function ai(t){return a5(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Wv(t,...e){if(typeof t!="string"){const s=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=t.name),t._errorFactory.create(s,...n)}return r5.create(t,...e)}function pe(t,e,...s){if(!t)throw Wv(e,...s)}function Mi(t){const e="INTERNAL ASSERTION FAILED: "+t;throw af(e),new Error(e)}function Ji(t,e){t||Mi(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rx(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function lP(){return hk()==="http:"||hk()==="https:"}function hk(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lP()||P3()||"connection"in navigator)?navigator.onLine:!0}function uP(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Md{constructor(e,s){this.shortDelay=e,this.longDelay=s,Ji(s>e,"Short delay should be less than long delay!"),this.isMobile=Hv()||XA()}get(){return cP()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yv(t,e){Ji(t.emulator,"Emulator should always be set here");const{url:s}=t.emulator;return e?`${s}${e.startsWith("/")?e.slice(1):e}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o5{static initialize(e,s,n){this.fetchImpl=e,s&&(this.headersImpl=s),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Mi("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Mi("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Mi("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hP=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],fP=new Md(3e4,6e4);function lr(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function cr(t,e,s,n,i={}){return l5(t,i,async()=>{let r={},a={};n&&(e==="GET"?a=n:r={body:JSON.stringify(n)});const l=mc(Object.assign({key:t.config.apiKey},a)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:c},r);return L3()||(u.referrerPolicy="no-referrer"),t.emulatorConfig&&fc(t.emulatorConfig.host)&&(u.credentials="include"),o5.fetch()(await c5(t,t.config.apiHost,s,l),u)})}async function l5(t,e,s){t._canInitEmulator=!1;const n=Object.assign(Object.assign({},dP),e);try{const i=new pP(t),r=await Promise.race([s(),i.promise]);i.clearNetworkTimeout();const a=await r.json();if("needConfirmation"in a)throw jh(t,"account-exists-with-different-credential",a);if(r.ok&&!("errorMessage"in a))return a;{const l=r.ok?a.errorMessage:a.error.message,[c,u]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw jh(t,"credential-already-in-use",a);if(c==="EMAIL_EXISTS")throw jh(t,"email-already-in-use",a);if(c==="USER_DISABLED")throw jh(t,"user-disabled",a);const d=n[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw a5(t,d,u);qn(t,d)}}catch(i){if(i instanceof Na)throw i;qn(t,"network-request-failed",{message:String(i)})}}async function Dd(t,e,s,n,i={}){const r=await cr(t,e,s,n,i);return"mfaPendingCredential"in r&&qn(t,"multi-factor-auth-required",{_serverResponse:r}),r}async function c5(t,e,s,n){const i=`${e}${s}?${n}`,r=t,a=r.config.emulator?Yv(t.config,i):`${t.config.apiScheme}://${i}`;return hP.includes(s)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(a).toString():a}function mP(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class pP{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((s,n)=>{this.timer=setTimeout(()=>n(ri(this.auth,"network-request-failed")),fP.get())})}}function jh(t,e,s){const n={appName:t.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const i=ri(t,e,n);return i.customData._tokenResponse=s,i}function fk(t){return t!==void 0&&t.enterprise!==void 0}class gP{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===e)return mP(s.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function xP(t,e){return cr(t,"GET","/v2/recaptchaConfig",lr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bP(t,e){return cr(t,"POST","/v1/accounts:delete",e)}async function Zf(t,e){return cr(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xu(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function vP(t,e=!1){const s=Kt(t),n=await s.getIdToken(e),i=Xv(n);pe(i&&i.exp&&i.auth_time&&i.iat,s.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,a=r==null?void 0:r.sign_in_provider;return{claims:i,token:n,authTime:xu(X0(i.auth_time)),issuedAtTime:xu(X0(i.iat)),expirationTime:xu(X0(i.exp)),signInProvider:a||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function X0(t){return Number(t)*1e3}function Xv(t){const[e,s,n]=t.split(".");if(e===void 0||s===void 0||n===void 0)return af("JWT malformed, contained fewer than 3 sections"),null;try{const i=Wf(s);return i?JSON.parse(i):(af("Failed to decode base64 JWT payload"),null)}catch(i){return af("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function mk(t){const e=Xv(t);return pe(e,"internal-error"),pe(typeof e.exp<"u","internal-error"),pe(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ku(t,e,s=!1){if(s)return e;try{return await e}catch(n){throw n instanceof Na&&yP(n)&&t.auth.currentUser===t&&await t.auth.signOut(),n}}function yP({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var s;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const s=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{constructor(e,s){this.createdAt=e,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=xu(this.lastLoginAt),this.creationTime=xu(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wu(t){var e;const s=t.auth,n=await t.getIdToken(),i=await Ku(t,Zf(s,{idToken:n}));pe(i==null?void 0:i.users.length,s,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const a=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?u5(r.providerUserInfo):[],l=kP(t.providerData,a),c=t.isAnonymous,u=!(t.email&&r.passwordHash)&&!(l!=null&&l.length),d=c?u:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new Ix(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(t,h)}async function wP(t){const e=Kt(t);await Wu(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function kP(t,e){return[...t.filter(n=>!e.some(i=>i.providerId===n.providerId)),...e]}function u5(t){return t.map(e=>{var{providerId:s}=e,n=Kv(e,["providerId"]);return{providerId:s,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NP(t,e){const s=await l5(t,{},async()=>{const n=mc({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,a=await c5(t,i,"/v1/token",`key=${r}`),l=await t._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const c={method:"POST",headers:l,body:n};return t.emulatorConfig&&fc(t.emulatorConfig.host)&&(c.credentials="include"),o5.fetch()(a,c)});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function SP(t,e){return cr(t,"POST","/v2/accounts:revokeToken",lr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){pe(e.idToken,"internal-error"),pe(typeof e.idToken<"u","internal-error"),pe(typeof e.refreshToken<"u","internal-error");const s="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):mk(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,s)}updateFromIdToken(e){pe(e.length!==0,"internal-error");const s=mk(e);this.updateTokensAndExpiration(e,null,s)}async getToken(e,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(pe(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,s){const{accessToken:n,refreshToken:i,expiresIn:r}=await NP(e,s);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,s,n){this.refreshToken=s||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,s){const{refreshToken:n,accessToken:i,expirationTime:r}=s,a=new yl;return n&&(pe(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),i&&(pe(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),r&&(pe(typeof r=="number","internal-error",{appName:e}),a.expirationTime=r),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new yl,this.toJSON())}_performRefresh(){return Mi("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gr(t,e){pe(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Vn{constructor(e){var{uid:s,auth:n,stsTokenManager:i}=e,r=Kv(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _P(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Ix(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const s=await Ku(this,this.stsTokenManager.getToken(this.auth,e));return pe(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(e){return vP(this,e)}reload(){return wP(this)}_assign(e){this!==e&&(pe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(s=>Object.assign({},s)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const s=new Vn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(e){pe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,s=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),s&&await Wu(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Xs(this.auth.app))return Promise.reject(ai(this.auth));const e=await this.getIdToken();return await Ku(this,bP(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,s){var n,i,r,a,l,c,u,d;const h=(n=s.displayName)!==null&&n!==void 0?n:void 0,f=(i=s.email)!==null&&i!==void 0?i:void 0,m=(r=s.phoneNumber)!==null&&r!==void 0?r:void 0,b=(a=s.photoURL)!==null&&a!==void 0?a:void 0,x=(l=s.tenantId)!==null&&l!==void 0?l:void 0,v=(c=s._redirectEventId)!==null&&c!==void 0?c:void 0,g=(u=s.createdAt)!==null&&u!==void 0?u:void 0,p=(d=s.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:y,emailVerified:k,isAnonymous:w,providerData:S,stsTokenManager:_}=s;pe(y&&_,e,"internal-error");const T=yl.fromJSON(this.name,_);pe(typeof y=="string",e,"internal-error"),gr(h,e.name),gr(f,e.name),pe(typeof k=="boolean",e,"internal-error"),pe(typeof w=="boolean",e,"internal-error"),gr(m,e.name),gr(b,e.name),gr(x,e.name),gr(v,e.name),gr(g,e.name),gr(p,e.name);const E=new Vn({uid:y,auth:e,email:f,emailVerified:k,displayName:h,isAnonymous:w,photoURL:b,phoneNumber:m,tenantId:x,stsTokenManager:T,createdAt:g,lastLoginAt:p});return S&&Array.isArray(S)&&(E.providerData=S.map(A=>Object.assign({},A))),v&&(E._redirectEventId=v),E}static async _fromIdTokenResponse(e,s,n=!1){const i=new yl;i.updateFromServerResponse(s);const r=new Vn({uid:s.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Wu(r),r}static async _fromGetAccountInfoResponse(e,s,n){const i=s.users[0];pe(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?u5(i.providerUserInfo):[],a=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),l=new yl;l.updateFromIdToken(n);const c=new Vn({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:a}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new Ix(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(c,u),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk=new Map;function Di(t){Ji(t instanceof Function,"Expected a class definition");let e=pk.get(t);return e?(Ji(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,pk.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d5{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,s){this.storage[e]=s}async _get(e){const s=this.storage[e];return s===void 0?null:s}async _remove(e){delete this.storage[e]}_addListener(e,s){}_removeListener(e,s){}}d5.type="NONE";const gk=d5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(t,e,s){return`firebase:${t}:${e}:${s}`}class _l{constructor(e,s,n){this.persistence=e,this.auth=s,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=of(this.userKey,i.apiKey,r),this.fullPersistenceKey=of("persistence",i.apiKey,r),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const s=await Zf(this.auth,{idToken:e}).catch(()=>{});return s?Vn._fromGetAccountInfoResponse(this.auth,s,e):null}return Vn._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,s,n="authUser"){if(!s.length)return new _l(Di(gk),e,n);const i=(await Promise.all(s.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let r=i[0]||Di(gk);const a=of(n,e.config.apiKey,e.name);let l=null;for(const u of s)try{const d=await u._get(a);if(d){let h;if(typeof d=="string"){const f=await Zf(e,{idToken:d}).catch(()=>{});if(!f)break;h=await Vn._fromGetAccountInfoResponse(e,f,d)}else h=Vn._fromJSON(e,d);u!==r&&(l=h),r=u;break}}catch{}const c=i.filter(u=>u._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new _l(r,e,n):(r=c[0],l&&await r._set(a,l.toJSON()),await Promise.all(s.map(async u=>{if(u!==r)try{await u._remove(a)}catch{}})),new _l(r,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xk(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(p5(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(h5(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(x5(e))return"Blackberry";if(b5(e))return"Webos";if(f5(e))return"Safari";if((e.includes("chrome/")||m5(e))&&!e.includes("edge/"))return"Chrome";if(g5(e))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(s);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function h5(t=Es()){return/firefox\//i.test(t)}function f5(t=Es()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function m5(t=Es()){return/crios\//i.test(t)}function p5(t=Es()){return/iemobile/i.test(t)}function g5(t=Es()){return/android/i.test(t)}function x5(t=Es()){return/blackberry/i.test(t)}function b5(t=Es()){return/webos/i.test(t)}function Qv(t=Es()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function TP(t=Es()){var e;return Qv(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function EP(){return V3()&&document.documentMode===10}function v5(t=Es()){return Qv(t)||g5(t)||b5(t)||x5(t)||/windows phone/i.test(t)||p5(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y5(t,e=[]){let s;switch(t){case"Browser":s=xk(Es());break;case"Worker":s=`${xk(Es())}-${t}`;break;default:s=t}const n=e.length?e.join(","):"FirebaseCore-web";return`${s}/JsCore/${pc}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AP{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,s){const n=r=>new Promise((a,l)=>{try{const c=e(r);a(c)}catch(c){l(c)}});n.onAbort=s,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const s=[];try{for(const n of this.queue)await n(e),n.onAbort&&s.push(n.onAbort)}catch(n){s.reverse();for(const i of s)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jP(t,e={}){return cr(t,"GET","/v2/passwordPolicy",lr(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CP=6;class RP{constructor(e){var s,n,i,r;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=a.minPasswordLength)!==null&&s!==void 0?s:CP,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var s,n,i,r,a,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(s=c.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(n=c.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(a=c.containsNumericCharacter)!==null&&a!==void 0?a:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,s){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(s.meetsMinPasswordLength=e.length>=n),i&&(s.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let n;for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(s,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,s,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IP{constructor(e,s,n,i){this.app=e,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new bk(this),this.idTokenSubscription=new bk(this),this.beforeStateQueue=new AP(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=r5,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(e,s){return s&&(this._popupRedirectResolver=Di(s)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await _l.create(this,e),(n=this._resolvePersistenceManagerAvailable)===null||n===void 0||n.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((r=this.currentUser)===null||r===void 0?void 0:r.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const s=await Zf(this,{idToken:e}),n=await Vn._fromGetAccountInfoResponse(this,s,e);await this.directlySetCurrentUser(n)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var s;if(Xs(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(l,l))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,l=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!a||a===l)&&(c!=null&&c.user)&&(i=c.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return pe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(e){try{await Wu(e)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=uP()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Xs(this.app))return Promise.reject(ai(this));const s=e?Kt(e):null;return s&&pe(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(e,s=!1){if(!this._deleted)return e&&pe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Xs(this.app)?Promise.reject(ai(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Xs(this.app)?Promise.reject(ai(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Di(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await jP(this),s=new RP(e);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Od("auth","Firebase",e())}onAuthStateChanged(e,s,n){return this.registerStateListener(this.authStateSubscription,e,s,n)}beforeAuthStateChanged(e,s){return this.beforeStateQueue.pushCallback(e,s)}onIdTokenChanged(e,s,n){return this.registerStateListener(this.idTokenSubscription,e,s,n)}authStateReady(){return new Promise((e,s)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},s)}})}async revokeAccessToken(e){if(this.currentUser){const s=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:s};this.tenantId!=null&&(n.tenantId=this.tenantId),await SP(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,s){const n=await this.getOrInitRedirectPersistenceManager(s);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const s=e&&Di(e)||this._popupRedirectResolver;pe(s,this,"argument-error"),this.redirectPersistenceManager=await _l.create(this,[Di(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var s,n;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(s=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,s,n,i){if(this._deleted)return()=>{};const r=typeof s=="function"?s:s.next.bind(s);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(pe(l,this,"internal-error"),l.then(()=>{a||r(this.currentUser)}),typeof s=="function"){const c=e.addObserver(s,n,i);return()=>{a=!0,c()}}else{const c=e.addObserver(s);return()=>{a=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return pe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=y5(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(s["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(s["X-Firebase-AppCheck"]=i),s}async _getAppCheckToken(){var e;if(Xs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return s!=null&&s.error&&oP(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function ur(t){return Kt(t)}class bk{constructor(e){this.auth=e,this.observer=null,this.addObserver=W3(s=>this.observer=s)}get next(){return pe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pp={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function OP(t){pp=t}function _5(t){return pp.loadJS(t)}function MP(){return pp.recaptchaEnterpriseScript}function DP(){return pp.gapiScript}function LP(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class PP{constructor(){this.enterprise=new VP}ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}class VP{ready(e){e()}execute(e,s){return Promise.resolve("token")}render(e,s){return""}}const BP="recaptcha-enterprise",w5="NO_RECAPTCHA";class FP{constructor(e){this.type=BP,this.auth=ur(e)}async verify(e="verify",s=!1){async function n(r){if(!s){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(a,l)=>{xP(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const u=new gP(c);return r.tenantId==null?r._agentRecaptchaConfig=u:r._tenantRecaptchaConfigs[r.tenantId]=u,a(u.siteKey)}}).catch(c=>{l(c)})})}function i(r,a,l){const c=window.grecaptcha;fk(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(u=>{a(u)}).catch(()=>{a(w5)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new PP().execute("siteKey",{action:"verify"}):new Promise((r,a)=>{n(this.auth).then(l=>{if(!s&&fk(window.grecaptcha))i(l,r,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let c=MP();c.length!==0&&(c+=l),_5(c).then(()=>{i(l,r,a)}).catch(u=>{a(u)})}}).catch(l=>{a(l)})})}}async function vk(t,e,s,n=!1,i=!1){const r=new FP(t);let a;if(i)a=w5;else try{a=await r.verify(s)}catch{a=await r.verify(s,!0)}const l=Object.assign({},e);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in l){const c=l.phoneEnrollmentInfo.phoneNumber,u=l.phoneEnrollmentInfo.recaptchaToken;Object.assign(l,{phoneEnrollmentInfo:{phoneNumber:c,recaptchaToken:u,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in l){const c=l.phoneSignInInfo.recaptchaToken;Object.assign(l,{phoneSignInInfo:{recaptchaToken:c,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return l}return n?Object.assign(l,{captchaResp:a}):Object.assign(l,{captchaResponse:a}),Object.assign(l,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(l,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),l}async function em(t,e,s,n,i){var r;if(!((r=t._getRecaptchaConfig())===null||r===void 0)&&r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await vk(t,e,s,s==="getOobCode");return n(t,a)}else return n(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const l=await vk(t,e,s,s==="getOobCode");return n(t,l)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UP(t,e){const s=qv(t,"auth");if(s.isInitialized()){const i=s.getImmediate(),r=s.getOptions();if(ho(r,e??{}))return i;qn(i,"already-initialized")}return s.initialize({options:e})}function $P(t,e){const s=(e==null?void 0:e.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Di);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function HP(t,e,s){const n=ur(t);pe(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const i=!1,r=k5(e),{host:a,port:l}=GP(e),c=l===null?"":`:${l}`,u={url:`${r}//${a}${c}/`},d=Object.freeze({host:a,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){pe(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),pe(ho(u,n.config.emulator)&&ho(d,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=u,n.emulatorConfig=d,n.settings.appVerificationDisabledForTesting=!0,fc(a)?(WA(`${r}//${a}${c}`),YA("Auth",!0)):zP()}function k5(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function GP(t){const e=k5(t),s=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){const r=i[1];return{host:r,port:yk(n.substr(r.length+1))}}else{const[r,a]=n.split(":");return{host:r,port:yk(a)}}}function yk(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function zP(){function t(){const e=document.createElement("p"),s=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e,s){this.providerId=e,this.signInMethod=s}toJSON(){return Mi("not implemented")}_getIdTokenResponse(e){return Mi("not implemented")}_linkToIdToken(e,s){return Mi("not implemented")}_getReauthenticationResolver(e){return Mi("not implemented")}}async function qP(t,e){return cr(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KP(t,e){return Dd(t,"POST","/v1/accounts:signInWithPassword",lr(t,e))}async function WP(t,e){return cr(t,"POST","/v1/accounts:sendOobCode",lr(t,e))}async function YP(t,e){return WP(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XP(t,e){return Dd(t,"POST","/v1/accounts:signInWithEmailLink",lr(t,e))}async function QP(t,e){return Dd(t,"POST","/v1/accounts:signInWithEmailLink",lr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu extends Jv{constructor(e,s,n,i=null){super("password",n),this._email=e,this._password=s,this._tenantId=i}static _fromEmailAndPassword(e,s){return new Yu(e,s,"password")}static _fromEmailAndCode(e,s,n=null){return new Yu(e,s,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return em(e,s,"signInWithPassword",KP);case"emailLink":return XP(e,{email:this._email,oobCode:this._password});default:qn(e,"internal-error")}}async _linkToIdToken(e,s){switch(this.signInMethod){case"password":const n={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return em(e,n,"signUpPassword",qP);case"emailLink":return QP(e,{idToken:s,email:this._email,oobCode:this._password});default:qn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wl(t,e){return Dd(t,"POST","/v1/accounts:signInWithIdp",lr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JP="http://localhost";class mo extends Jv{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const s=new mo(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(s.idToken=e.idToken),e.accessToken&&(s.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(s.nonce=e.nonce),e.pendingToken&&(s.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(s.accessToken=e.oauthToken,s.secret=e.oauthTokenSecret):qn("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const s=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:i}=s,r=Kv(s,["providerId","signInMethod"]);if(!n||!i)return null;const a=new mo(n,i);return a.idToken=r.idToken||void 0,a.accessToken=r.accessToken||void 0,a.secret=r.secret,a.nonce=r.nonce,a.pendingToken=r.pendingToken||null,a}_getIdTokenResponse(e){const s=this.buildRequest();return wl(e,s)}_linkToIdToken(e,s){const n=this.buildRequest();return n.idToken=s,wl(e,n)}_getReauthenticationResolver(e){const s=this.buildRequest();return s.autoCreate=!1,wl(e,s)}buildRequest(){const e={requestUri:JP,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),e.postBody=mc(s)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZP(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function e6(t){const e=Zc(eu(t)).link,s=e?Zc(eu(e)).deep_link_id:null,n=Zc(eu(t)).deep_link_id;return(n?Zc(eu(n)).link:null)||n||s||e||t}class Zv{constructor(e){var s,n,i,r,a,l;const c=Zc(eu(e)),u=(s=c.apiKey)!==null&&s!==void 0?s:null,d=(n=c.oobCode)!==null&&n!==void 0?n:null,h=ZP((i=c.mode)!==null&&i!==void 0?i:null);pe(u&&d&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=d,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(a=c.lang)!==null&&a!==void 0?a:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const s=e6(e);try{return new Zv(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(){this.providerId=To.PROVIDER_ID}static credential(e,s){return Yu._fromEmailAndPassword(e,s)}static credentialWithLink(e,s){const n=Zv.parseLink(s);return pe(n,"argument-error"),Yu._fromEmailAndCode(e,n.code,n.tenantId)}}To.PROVIDER_ID="password";To.EMAIL_PASSWORD_SIGN_IN_METHOD="password";To.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N5{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ld extends N5{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Er extends Ld{constructor(){super("facebook.com")}static credential(e){return mo._fromParams({providerId:Er.PROVIDER_ID,signInMethod:Er.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Er.credentialFromTaggedObject(e)}static credentialFromError(e){return Er.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Er.credential(e.oauthAccessToken)}catch{return null}}}Er.FACEBOOK_SIGN_IN_METHOD="facebook.com";Er.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar extends Ld{constructor(){super("google.com"),this.addScope("profile")}static credential(e,s){return mo._fromParams({providerId:Ar.PROVIDER_ID,signInMethod:Ar.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:s})}static credentialFromResult(e){return Ar.credentialFromTaggedObject(e)}static credentialFromError(e){return Ar.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:s,oauthAccessToken:n}=e;if(!s&&!n)return null;try{return Ar.credential(s,n)}catch{return null}}}Ar.GOOGLE_SIGN_IN_METHOD="google.com";Ar.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jr extends Ld{constructor(){super("github.com")}static credential(e){return mo._fromParams({providerId:jr.PROVIDER_ID,signInMethod:jr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return jr.credentialFromTaggedObject(e)}static credentialFromError(e){return jr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return jr.credential(e.oauthAccessToken)}catch{return null}}}jr.GITHUB_SIGN_IN_METHOD="github.com";jr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cr extends Ld{constructor(){super("twitter.com")}static credential(e,s){return mo._fromParams({providerId:Cr.PROVIDER_ID,signInMethod:Cr.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:s})}static credentialFromResult(e){return Cr.credentialFromTaggedObject(e)}static credentialFromError(e){return Cr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:s,oauthTokenSecret:n}=e;if(!s||!n)return null;try{return Cr.credential(s,n)}catch{return null}}}Cr.TWITTER_SIGN_IN_METHOD="twitter.com";Cr.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function S5(t,e){return Dd(t,"POST","/v1/accounts:signUp",lr(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,s,n,i=!1){const r=await Vn._fromIdTokenResponse(e,n,i),a=_k(n);return new Zi({user:r,providerId:a,_tokenResponse:n,operationType:s})}static async _forOperation(e,s,n){await e._updateTokensIfNecessary(n,!0);const i=_k(n);return new Zi({user:e,providerId:i,_tokenResponse:n,operationType:s})}}function _k(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function t6(t){var e;if(Xs(t.app))return Promise.reject(ai(t));const s=ur(t);if(await s._initializationPromise,!((e=s.currentUser)===null||e===void 0)&&e.isAnonymous)return new Zi({user:s.currentUser,providerId:null,operationType:"signIn"});const n=await S5(s,{returnSecureToken:!0}),i=await Zi._fromIdTokenResponse(s,"signIn",n,!0);return await s._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tm extends Na{constructor(e,s,n,i){var r;super(s.code,s.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,tm.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:s.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,s,n,i){return new tm(e,s,n,i)}}function T5(t,e,s,n){return(e==="reauthenticate"?s._getReauthenticationResolver(t):s._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?tm._fromErrorAndOperation(t,r,e,n):r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s6(t){return new Set(t.map(({providerId:e})=>e).filter(e=>!!e))}async function E5(t,e,s=!1){const n=await Ku(t,e._linkToIdToken(t.auth,await t.getIdToken()),s);return Zi._forOperation(t,"link",n)}async function n6(t,e,s){await Wu(e);const n=s6(e.providerData);pe(n.has(s)===t,e.auth,"provider-already-linked")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i6(t,e,s=!1){const{auth:n}=t;if(Xs(n.app))return Promise.reject(ai(n));const i="reauthenticate";try{const r=await Ku(t,T5(n,i,e,t),s);pe(r.idToken,n,"internal-error");const a=Xv(r.idToken);pe(a,n,"internal-error");const{sub:l}=a;return pe(t.uid===l,n,"user-mismatch"),Zi._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&qn(n,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function A5(t,e,s=!1){if(Xs(t.app))return Promise.reject(ai(t));const n="signIn",i=await T5(t,n,e),r=await Zi._fromIdTokenResponse(t,n,i);return s||await t._updateCurrentUser(r.user),r}async function r6(t,e){return A5(ur(t),e)}async function a6(t,e){const s=Kt(t);return await n6(!1,s,e.providerId),E5(s,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5(t){const e=ur(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function o6(t,e,s){const n=ur(t);await em(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",YP)}async function l6(t,e,s){if(Xs(t.app))return Promise.reject(ai(t));const n=ur(t),a=await em(n,{returnSecureToken:!0,email:e,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",S5).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&j5(t),c}),l=await Zi._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(l.user),l}function c6(t,e,s){return Xs(t.app)?Promise.reject(ai(t)):r6(Kt(t),To.credential(e,s)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&j5(t),n})}function u6(t,e,s,n){return Kt(t).onIdTokenChanged(e,s,n)}function d6(t,e,s){return Kt(t).beforeAuthStateChanged(e,s)}function h6(t,e,s,n){return Kt(t).onAuthStateChanged(e,s,n)}function f6(t){return Kt(t).signOut()}const sm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C5{constructor(e,s){this.storageRetriever=e,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(sm,"1"),this.storage.removeItem(sm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,s){return this.storage.setItem(e,JSON.stringify(s)),Promise.resolve()}_get(e){const s=this.storage.getItem(e);return Promise.resolve(s?JSON.parse(s):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m6=1e3,p6=10;class R5 extends C5{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,s)=>this.onStorageEvent(e,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=v5(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const s of Object.keys(this.listeners)){const n=this.storage.getItem(s),i=this.localCache[s];n!==i&&e(s,i,n)}}onStorageEvent(e,s=!1){if(!e.key){this.forAllChangedKeys((a,l,c)=>{this.notifyListeners(a,c)});return}const n=e.key;s?this.detachListener():this.stopPolling();const i=()=>{const a=this.storage.getItem(n);!s&&this.localCache[n]===a||this.notifyListeners(n,a)},r=this.storage.getItem(n);EP()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,p6):i()}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,s,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:s,newValue:n}),!0)})},m6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,s){await super._set(e,s),this.localCache[e]=JSON.stringify(s)}async _get(e){const s=await super._get(e);return this.localCache[e]=JSON.stringify(s),s}async _remove(e){await super._remove(e),delete this.localCache[e]}}R5.type="LOCAL";const g6=R5;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I5 extends C5{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,s){}_removeListener(e,s){}}I5.type="SESSION";const O5=I5;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function x6(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const s=this.receivers.find(i=>i.isListeningto(e));if(s)return s;const n=new gp(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const s=e,{eventId:n,eventType:i,data:r}=s.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;s.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const l=Array.from(a).map(async u=>u(s.origin,r)),c=await x6(l);s.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:c})}_subscribe(e,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(s)}_unsubscribe(e,s){this.handlersMap[e]&&s&&this.handlersMap[e].delete(s),(!s||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gp.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ey(t="",e=10){let s="";for(let n=0;n<e;n++)s+=Math.floor(Math.random()*10);return t+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b6{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,s,n=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,a;return new Promise((l,c)=>{const u=ey("",20);i.port1.start();const d=setTimeout(()=>{c(new Error("unsupported_event"))},n);a={messageChannel:i,onMessage(h){const f=h;if(f.data.eventId===u)switch(f.data.status){case"ack":clearTimeout(d),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(f.data.response);break;default:clearTimeout(d),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:u,data:s},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oi(){return window}function v6(t){oi().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M5(){return typeof oi().WorkerGlobalScope<"u"&&typeof oi().importScripts=="function"}async function y6(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function _6(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function w6(){return M5()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D5="firebaseLocalStorageDb",k6=1,nm="firebaseLocalStorage",L5="fbase_key";class Pd{constructor(e){this.request=e}toPromise(){return new Promise((e,s)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function xp(t,e){return t.transaction([nm],e?"readwrite":"readonly").objectStore(nm)}function N6(){const t=indexedDB.deleteDatabase(D5);return new Pd(t).toPromise()}function Ox(){const t=indexedDB.open(D5,k6);return new Promise((e,s)=>{t.addEventListener("error",()=>{s(t.error)}),t.addEventListener("upgradeneeded",()=>{const n=t.result;try{n.createObjectStore(nm,{keyPath:L5})}catch(i){s(i)}}),t.addEventListener("success",async()=>{const n=t.result;n.objectStoreNames.contains(nm)?e(n):(n.close(),await N6(),e(await Ox()))})})}async function wk(t,e,s){const n=xp(t,!0).put({[L5]:e,value:s});return new Pd(n).toPromise()}async function S6(t,e){const s=xp(t,!1).get(e),n=await new Pd(s).toPromise();return n===void 0?null:n.value}function kk(t,e){const s=xp(t,!0).delete(e);return new Pd(s).toPromise()}const T6=800,E6=3;class P5{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Ox(),this.db)}async _withRetries(e){let s=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(s++>E6)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return M5()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gp._getInstance(w6()),this.receiver._subscribe("keyChanged",async(e,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(e,s)=>["keyChanged"])}async initializeSender(){var e,s;if(this.activeServiceWorker=await y6(),!this.activeServiceWorker)return;this.sender=new b6(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((s=n[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||_6()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ox();return await wk(e,sm,"1"),await kk(e,sm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,s){return this._withPendingWrite(async()=>(await this._withRetries(n=>wk(n,e,s)),this.localCache[e]=s,this.notifyServiceWorker(e)))}async _get(e){const s=await this._withRetries(n=>S6(n,e));return this.localCache[e]=s,s}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(s=>kk(s,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=xp(i,!1).getAll();return new Pd(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const s=[],n=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),s.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!n.has(i)&&(this.notifyListeners(i,null),s.push(i));return s}notifyListeners(e,s){this.localCache[e]=s;const n=this.listeners[e];if(n)for(const i of Array.from(n))i(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),T6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(s)}_removeListener(e,s){this.listeners[e]&&(this.listeners[e].delete(s),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}P5.type="LOCAL";const A6=P5;new Md(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j6(t,e){return e?Di(e):(pe(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ty extends Jv{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wl(e,this._buildIdpRequest())}_linkToIdToken(e,s){return wl(e,this._buildIdpRequest(s))}_getReauthenticationResolver(e){return wl(e,this._buildIdpRequest())}_buildIdpRequest(e){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(s.idToken=e),s}}function C6(t){return A5(t.auth,new ty(t),t.bypassAuthState)}function R6(t){const{auth:e,user:s}=t;return pe(s,e,"internal-error"),i6(s,new ty(t),t.bypassAuthState)}async function I6(t){const{auth:e,user:s}=t;return pe(s,e,"internal-error"),E5(s,new ty(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V5{constructor(e,s,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(e,s)=>{this.pendingPromise={resolve:e,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:s,sessionId:n,postBody:i,tenantId:r,error:a,type:l}=e;if(a){this.reject(a);return}const c={auth:this.auth,requestUri:s,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return C6;case"linkViaPopup":case"linkViaRedirect":return I6;case"reauthViaPopup":case"reauthViaRedirect":return R6;default:qn(this.auth,"internal-error")}}resolve(e){Ji(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ji(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O6=new Md(2e3,1e4);class sl extends V5{constructor(e,s,n,i,r){super(e,s,i,r),this.provider=n,this.authWindow=null,this.pollId=null,sl.currentPopupAction&&sl.currentPopupAction.cancel(),sl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return pe(e,this.auth,"internal-error"),e}async onExecution(){Ji(this.filter.length===1,"Popup operations only handle one event");const e=ey();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(ri(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(ri(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,sl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var s,n;if(!((n=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ri(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,O6.get())};e()}}sl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M6="pendingRedirect",lf=new Map;class D6 extends V5{constructor(e,s,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,n),this.eventId=null}async execute(){let e=lf.get(this.auth._key());if(!e){try{const n=await L6(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(s){e=()=>Promise.reject(s)}lf.set(this.auth._key(),e)}return this.bypassAuthState||lf.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const s=await this.auth._redirectUserForId(e.eventId);if(s)return this.user=s,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function L6(t,e){const s=B6(e),n=V6(t);if(!await n._isAvailable())return!1;const i=await n._get(s)==="true";return await n._remove(s),i}function P6(t,e){lf.set(t._key(),e)}function V6(t){return Di(t._redirectPersistence)}function B6(t){return of(M6,t.config.apiKey,t.name)}async function F6(t,e,s=!1){if(Xs(t.app))return Promise.reject(ai(t));const n=ur(t),i=j6(n,e),a=await new D6(n,i,s).execute();return a&&!s&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U6=10*60*1e3;class $6{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let s=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(s=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!H6(e)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=e,s=!0)),s}sendToConsumer(e,s){var n;if(e.error&&!B5(e)){const i=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";s.onError(ri(this.auth,i))}else s.onAuthEvent(e)}isEventForConsumer(e,s){const n=s.eventId===null||!!e.eventId&&e.eventId===s.eventId;return s.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=U6&&this.cachedEventUids.clear(),this.cachedEventUids.has(Nk(e))}saveEventToCache(e){this.cachedEventUids.add(Nk(e)),this.lastProcessedEventTime=Date.now()}}function Nk(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function B5({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function H6(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return B5(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G6(t,e={}){return cr(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z6=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,q6=/^https?/;async function K6(t){if(t.config.emulator)return;const{authorizedDomains:e}=await G6(t);for(const s of e)try{if(W6(s))return}catch{}qn(t,"unauthorized-domain")}function W6(t){const e=Rx(),{protocol:s,hostname:n}=new URL(e);if(t.startsWith("chrome-extension://")){const a=new URL(t);return a.hostname===""&&n===""?s==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):s==="chrome-extension:"&&a.hostname===n}if(!q6.test(s))return!1;if(z6.test(t))return n===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y6=new Md(3e4,6e4);function Sk(){const t=oi().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let s=0;s<t.CP.length;s++)t.CP[s]=null}}function X6(t){return new Promise((e,s)=>{var n,i,r;function a(){Sk(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Sk(),s(ri(t,"network-request-failed"))},timeout:Y6.get()})}if(!((i=(n=oi().gapi)===null||n===void 0?void 0:n.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=oi().gapi)===null||r===void 0)&&r.load)a();else{const l=LP("iframefcb");return oi()[l]=()=>{gapi.load?a():s(ri(t,"network-request-failed"))},_5(`${DP()}?onload=${l}`).catch(c=>s(c))}}).catch(e=>{throw cf=null,e})}let cf=null;function Q6(t){return cf=cf||X6(t),cf}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J6=new Md(5e3,15e3),Z6="__/auth/iframe",e8="emulator/auth/iframe",t8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},s8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function n8(t){const e=t.config;pe(e.authDomain,t,"auth-domain-config-required");const s=e.emulator?Yv(e,e8):`https://${t.config.authDomain}/${Z6}`,n={apiKey:e.apiKey,appName:t.name,v:pc},i=s8.get(t.config.apiHost);i&&(n.eid=i);const r=t._getFrameworks();return r.length&&(n.fw=r.join(",")),`${s}?${mc(n).slice(1)}`}async function i8(t){const e=await Q6(t),s=oi().gapi;return pe(s,t,"internal-error"),e.open({where:document.body,url:n8(t),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:t8,dontclear:!0},n=>new Promise(async(i,r)=>{await n.restyle({setHideOnLeave:!1});const a=ri(t,"network-request-failed"),l=oi().setTimeout(()=>{r(a)},J6.get());function c(){oi().clearTimeout(l),i(n)}n.ping(c).then(c,()=>{r(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},a8=500,o8=600,l8="_blank",c8="http://localhost";class Tk{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function u8(t,e,s,n=a8,i=o8){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let l="";const c=Object.assign(Object.assign({},r8),{width:n.toString(),height:i.toString(),top:r,left:a}),u=Es().toLowerCase();s&&(l=m5(u)?l8:s),h5(u)&&(e=e||c8,c.scrollbars="yes");const d=Object.entries(c).reduce((f,[m,b])=>`${f}${m}=${b},`,"");if(TP(u)&&l!=="_self")return d8(e||"",l),new Tk(null);const h=window.open(e||"",l,d);pe(h,t,"popup-blocked");try{h.focus()}catch{}return new Tk(h)}function d8(t,e){const s=document.createElement("a");s.href=t,s.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h8="__/auth/handler",f8="emulator/auth/handler",m8=encodeURIComponent("fac");async function Ek(t,e,s,n,i,r){pe(t.config.authDomain,t,"auth-domain-config-required"),pe(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:s,redirectUrl:n,v:pc,eventId:i};if(e instanceof N5){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",Yf(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries({}))a[d]=h}if(e instanceof Ld){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(a.scopes=d.join(","))}t.tenantId&&(a.tid=t.tenantId);const l=a;for(const d of Object.keys(l))l[d]===void 0&&delete l[d];const c=await t._getAppCheckToken(),u=c?`#${m8}=${encodeURIComponent(c)}`:"";return`${p8(t)}?${mc(l).slice(1)}${u}`}function p8({config:t}){return t.emulator?Yv(t,f8):`https://${t.authDomain}/${h8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0="webStorageSupport";class g8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=O5,this._completeRedirectFn=F6,this._overrideRedirectResult=P6}async _openPopup(e,s,n,i){var r;Ji((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const a=await Ek(e,s,n,Rx(),i);return u8(e,a,ey())}async _openRedirect(e,s,n,i){await this._originValidation(e);const r=await Ek(e,s,n,Rx(),i);return v6(r),new Promise(()=>{})}_initialize(e){const s=e._key();if(this.eventManagers[s]){const{manager:i,promise:r}=this.eventManagers[s];return i?Promise.resolve(i):(Ji(r,"If manager is not set, promise should be"),r)}const n=this.initAndGetManager(e);return this.eventManagers[s]={promise:n},n.catch(()=>{delete this.eventManagers[s]}),n}async initAndGetManager(e){const s=await i8(e),n=new $6(e);return s.register("authEvent",i=>(pe(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:n.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=s,n}_isIframeWebStorageSupported(e,s){this.iframes[e._key()].send(Q0,{type:Q0},i=>{var r;const a=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[Q0];a!==void 0&&s(!!a),qn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const s=e._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=K6(e)),this.originValidationPromises[s]}get _shouldInitProactively(){return v5()||f5()||Qv()}}const x8=g8;var Ak="@firebase/auth",jk="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const s=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,s),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const s=this.internalListeners.get(e);s&&(this.internalListeners.delete(e),s(),this.updateProactiveRefresh())}assertAuthConfigured(){pe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v8(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function y8(t){$l(new fo("auth",(e,{options:s})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=n.options;pe(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const c={apiKey:a,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:y5(t)},u=new IP(n,i,r,c);return $P(u,s),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,s,n)=>{e.getProvider("auth-internal").initialize()})),$l(new fo("auth-internal",e=>{const s=ur(e.getProvider("auth").getImmediate());return(n=>new b8(n))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),Qr(Ak,jk,v8(t)),Qr(Ak,jk,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _8=5*60,w8=KA("authIdTokenMaxAge")||_8;let Ck=null;const k8=t=>async e=>{const s=e&&await e.getIdTokenResult(),n=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(n&&n>w8)return;const i=s==null?void 0:s.token;Ck!==i&&(Ck=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function N8(t=t5()){const e=qv(t,"auth");if(e.isInitialized())return e.getImmediate();const s=UP(t,{popupRedirectResolver:x8,persistence:[A6,g6,O5]}),n=KA("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(n,location.origin);if(location.origin===r.origin){const a=k8(r.toString());d6(s,a,()=>a(s.currentUser)),u6(s,l=>a(l))}}const i=zA("auth");return i&&HP(s,`http://${i}`),s}function S8(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}OP({loadJS(t){return new Promise((e,s)=>{const n=document.createElement("script");n.setAttribute("src",t),n.onload=e,n.onerror=i=>{const r=ri("internal-error");r.customData=i,s(r)},n.type="text/javascript",n.charset="UTF-8",S8().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});y8("Browser");var Rk={};const Ik="@firebase/database",Ok="1.0.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let F5="";function T8(t){F5=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E8{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,s){s==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Qt(s))}get(e){const s=this.domStorage_.getItem(this.prefixedName_(e));return s==null?null:zu(s)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A8{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,s){s==null?delete this.cache_[e]:this.cache_[e]=s}get(e){return Qn(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U5=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new E8(e)}}catch{}return new A8},Ha=U5("localStorage"),j8=U5("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kl=new Gv("@firebase/database"),$5=function(){let t=1;return function(){return t++}}(),H5=function(t){const e=Q3(t),s=new K3;s.update(e);const n=s.digest();return Uv.encodeByteArray(n)},Vd=function(...t){let e="";for(let s=0;s<t.length;s++){const n=t[s];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=Vd.apply(null,n):typeof n=="object"?e+=Qt(n):e+=n,e+=" "}return e};let bu=null,Mk=!0;const C8=function(t,e){te(!0,"Can't turn on custom loggers persistently."),kl.logLevel=et.VERBOSE,bu=kl.log.bind(kl)},rs=function(...t){if(Mk===!0&&(Mk=!1,bu===null&&j8.get("logging_enabled")===!0&&C8()),bu){const e=Vd.apply(null,t);bu(e)}},Bd=function(t){return function(...e){rs(t,...e)}},Mx=function(...t){const e="FIREBASE INTERNAL ERROR: "+Vd(...t);kl.error(e)},er=function(...t){const e=`FIREBASE FATAL ERROR: ${Vd(...t)}`;throw kl.error(e),new Error(e)},Ts=function(...t){const e="FIREBASE WARNING: "+Vd(...t);kl.warn(e)},R8=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bp=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},I8=function(t){if(document.readyState==="complete")t();else{let e=!1;const s=function(){if(!document.body){setTimeout(s,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",s,!1),window.addEventListener("load",s,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&s()}),window.attachEvent("onload",s))}},Hl="[MIN_NAME]",po="[MAX_NAME]",Eo=function(t,e){if(t===e)return 0;if(t===Hl||e===po)return-1;if(e===Hl||t===po)return 1;{const s=Dk(t),n=Dk(e);return s!==null?n!==null?s-n===0?t.length-e.length:s-n:-1:n!==null?1:t<e?-1:1}},O8=function(t,e){return t===e?0:t<e?-1:1},$c=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Qt(e))},sy=function(t){if(typeof t!="object"||t===null)return Qt(t);const e=[];for(const n in t)e.push(n);e.sort();let s="{";for(let n=0;n<e.length;n++)n!==0&&(s+=","),s+=Qt(e[n]),s+=":",s+=sy(t[e[n]]);return s+="}",s},G5=function(t,e){const s=t.length;if(s<=e)return[t];const n=[];for(let i=0;i<s;i+=e)i+e>s?n.push(t.substring(i,s)):n.push(t.substring(i,i+e));return n};function ls(t,e){for(const s in t)t.hasOwnProperty(s)&&e(s,t[s])}const z5=function(t){te(!bp(t),"Invalid JSON number");const e=11,s=52,n=(1<<e-1)-1;let i,r,a,l,c;t===0?(r=0,a=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-n)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),n),r=l+n,a=Math.round(t*Math.pow(2,s-l)-Math.pow(2,s))):(r=0,a=Math.round(t/Math.pow(2,1-n-s))));const u=[];for(c=s;c;c-=1)u.push(a%2?1:0),a=Math.floor(a/2);for(c=e;c;c-=1)u.push(r%2?1:0),r=Math.floor(r/2);u.push(i?1:0),u.reverse();const d=u.join("");let h="";for(c=0;c<64;c+=8){let f=parseInt(d.substr(c,8),2).toString(16);f.length===1&&(f="0"+f),h=h+f}return h.toLowerCase()},M8=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},D8=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function L8(t,e){let s="Unknown Error";t==="too_big"?s="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?s="Client doesn't have permission to access the desired data.":t==="unavailable"&&(s="The service is unavailable");const n=new Error(t+" at "+e._path.toString()+": "+s);return n.code=t.toUpperCase(),n}const P8=new RegExp("^-?(0*)\\d{1,10}$"),V8=-2147483648,B8=2147483647,Dk=function(t){if(P8.test(t)){const e=Number(t);if(e>=V8&&e<=B8)return e}return null},gc=function(t){try{t()}catch(e){setTimeout(()=>{const s=e.stack||"";throw Ts("Exception was thrown by user callback.",s),e},Math.floor(0))}},F8=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},vu=function(t,e){const s=setTimeout(t,e);return typeof s=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(s):typeof s=="object"&&s.unref&&s.unref(),s};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U8{constructor(e,s){this.appCheckProvider=s,this.appName=e.name,Xs(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=s==null?void 0:s.getImmediate({optional:!0}),this.appCheck||s==null||s.get().then(n=>this.appCheck=n)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((s,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(s,n):s(null)},0)})}addTokenChangeListener(e){var s;(s=this.appCheckProvider)===null||s===void 0||s.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){Ts(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $8{constructor(e,s,n){this.appName_=e,this.firebaseOptions_=s,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(s=>s&&s.code==="auth/token-not-initialized"?(rs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(s)):new Promise((s,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(s,n):s(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(s=>s.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(s=>s.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Ts(e)}}class uf{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}uf.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ny="5",q5="v",K5="s",W5="r",Y5="f",X5=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Q5="ls",J5="p",Dx="ac",Z5="websocket",ej="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tj{constructor(e,s,n,i,r=!1,a="",l=!1,c=!1,u=null){this.secure=s,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ha.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ha.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",s=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${s}`}}function H8(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function sj(t,e,s){te(typeof e=="string","typeof type must == string"),te(typeof s=="object","typeof params must == object");let n;if(e===Z5)n=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===ej)n=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);H8(t)&&(s.ns=t.namespace);const i=[];return ls(s,(r,a)=>{i.push(r+"="+a)}),n+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G8{constructor(){this.counters_={}}incrementCounter(e,s=1){Qn(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=s}get(){return T3(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J0={},Z0={};function iy(t){const e=t.toString();return J0[e]||(J0[e]=new G8),J0[e]}function z8(t,e){const s=t.toString();return Z0[s]||(Z0[s]=e()),Z0[s]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q8{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,s){this.closeAfterResponse=e,this.onClose=s,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,s){for(this.pendingResponses[e]=s;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<n.length;++i)n[i]&&gc(()=>{this.onMessage_(n[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk="start",K8="close",W8="pLPCommand",Y8="pRTLPCB",nj="id",ij="pw",rj="ser",X8="cb",Q8="seg",J8="ts",Z8="d",eV="dframe",aj=1870,oj=30,tV=aj-oj,sV=25e3,nV=3e4;class nl{constructor(e,s,n,i,r,a,l){this.connId=e,this.repoInfo=s,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Bd(e),this.stats_=iy(s),this.urlFn=c=>(this.appCheckToken&&(c[Dx]=this.appCheckToken),sj(s,ej,c))}open(e,s){this.curSegmentNum=0,this.onDisconnect_=s,this.myPacketOrderer=new q8(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(nV)),I8(()=>{if(this.isClosed_)return;this.scriptTagHolder=new ry((...r)=>{const[a,l,c,u,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===Lk)this.id=l,this.password=c;else if(a===K8)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...r)=>{const[a,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const n={};n[Lk]="t",n[rj]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[X8]=this.scriptTagHolder.uniqueCallbackIdentifier),n[q5]=ny,this.transportSessionId&&(n[K5]=this.transportSessionId),this.lastSessionId&&(n[Q5]=this.lastSessionId),this.applicationId&&(n[J5]=this.applicationId),this.appCheckToken&&(n[Dx]=this.appCheckToken),typeof location<"u"&&location.hostname&&X5.test(location.hostname)&&(n[W5]=Y5);const i=this.urlFn(n);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){nl.forceAllow_=!0}static forceDisallow(){nl.forceDisallow_=!0}static isAvailable(){return nl.forceAllow_?!0:!nl.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!M8()&&!D8()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const s=Qt(e);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const n=HA(s),i=G5(n,tV);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,s){this.myDisconnFrame=document.createElement("iframe");const n={};n[eV]="t",n[nj]=e,n[ij]=s,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const s=Qt(e).length;this.bytesReceived+=s,this.stats_.incrementCounter("bytes_received",s)}}class ry{constructor(e,s,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=$5(),window[W8+this.uniqueCallbackIdentifier]=e,window[Y8+this.uniqueCallbackIdentifier]=s,this.myIFrame=ry.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){rs("frame writing exception"),l.stack&&rs(l.stack),rs(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||rs("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,s){for(this.myID=e,this.myPW=s,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[nj]=this.myID,e[ij]=this.myPW,e[rj]=this.currentSerial;let s=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+oj+n.length<=aj;){const a=this.pendingSegs.shift();n=n+"&"+Q8+i+"="+a.seg+"&"+J8+i+"="+a.ts+"&"+Z8+i+"="+a.d,i++}return s=s+n,this.addLongPollTag_(s,this.currentSerial),!0}else return!1}enqueueSegment(e,s,n){this.pendingSegs.push({seg:e,ts:s,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,s){this.outstandingRequests.add(s);const n=()=>{this.outstandingRequests.delete(s),this.newRequest_()},i=setTimeout(n,Math.floor(sV)),r=()=>{clearTimeout(i),n()};this.addTag(e,r)}addTag(e,s){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const i=n.readyState;(!i||i==="loaded"||i==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),s())},n.onerror=()=>{rs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iV=16384,rV=45e3;let im=null;typeof MozWebSocket<"u"?im=MozWebSocket:typeof WebSocket<"u"&&(im=WebSocket);class Pn{constructor(e,s,n,i,r,a,l){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Bd(this.connId),this.stats_=iy(s),this.connURL=Pn.connectionURL_(s,a,l,i,n),this.nodeAdmin=s.nodeAdmin}static connectionURL_(e,s,n,i,r){const a={};return a[q5]=ny,typeof location<"u"&&location.hostname&&X5.test(location.hostname)&&(a[W5]=Y5),s&&(a[K5]=s),n&&(a[Q5]=n),i&&(a[Dx]=i),r&&(a[J5]=r),sj(e,Z5,a)}open(e,s){this.onDisconnect=s,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ha.set("previous_websocket_failure",!0);try{let n;B3(),this.mySock=new im(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const i=n.message||n.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Pn.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(s);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&im!==null&&!Pn.forceDisallow_}static previouslyFailed(){return Ha.isInMemoryStorage||Ha.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ha.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const s=this.frames.join("");this.frames=null;const n=zu(s);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(te(this.frames===null,"We already have a frame buffer"),e.length<=6){const s=Number(e);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const s=e.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{const n=this.extractFrameCount_(s);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const s=Qt(e);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);const n=G5(s,iV);n.length>1&&this.sendString_(String(n.length));for(let i=0;i<n.length;i++)this.sendString_(n[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(rV))}sendString_(e){try{this.mySock.send(e)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pn.responsesRequiredToBeHealthy=2;Pn.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu{static get ALL_TRANSPORTS(){return[nl,Pn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const s=Pn&&Pn.isAvailable();let n=s&&!Pn.previouslyFailed();if(e.webSocketOnly&&(s||Ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Pn];else{const i=this.transports_=[];for(const r of Xu.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Xu.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Xu.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aV=6e4,oV=5e3,lV=10*1024,cV=100*1024,eg="t",Pk="d",uV="s",Vk="r",dV="e",Bk="o",Fk="a",Uk="n",$k="p",hV="h";class fV{constructor(e,s,n,i,r,a,l,c,u,d){this.id=e,this.repoInfo_=s,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Bd("c:"+this.id+":"),this.transportManager_=new Xu(s),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(s,n)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=vu(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>cV?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>lV?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return s=>{e===this.conn_?this.onConnectionLost_(s):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return s=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(s):e===this.secondaryConn_?this.onSecondaryMessageReceived_(s):this.log_("message on old connection"))}}sendRequest(e){const s={t:"d",d:e};this.sendData_(s)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(eg in e){const s=e[eg];s===Fk?this.upgradeIfSecondaryHealthy_():s===Vk?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):s===Bk&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const s=$c("t",e),n=$c("d",e);if(s==="c")this.onSecondaryControl_(n);else if(s==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+s)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$k,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fk,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Uk,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const s=$c("t",e),n=$c("d",e);s==="c"?this.onControl_(n):s==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const s=$c(eg,e);if(Pk in e){const n=e[Pk];if(s===hV){const i=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(s===Uk){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else s===uV?this.onConnectionShutdown_(n):s===Vk?this.onReset_(n):s===dV?Mx("Server Error: "+n):s===Bk?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Mx("Unknown control packet command: "+s)}}onHandshake_(e){const s=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,s),ny!==n&&Ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const s=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(s,n),vu(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(aV))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,s){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(s,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):vu(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(oV))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$k,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ha.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{put(e,s,n,i){}merge(e,s,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,s,n){}onDisconnectMerge(e,s,n){}onDisconnectCancel(e,s){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(e){this.allowedEvents_=e,this.listeners_={},te(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...s){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let i=0;i<n.length;i++)n[i].callback.apply(n[i].context,s)}}on(e,s,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:s,context:n});const i=this.getInitialEvent(e);i&&s.apply(n,i)}off(e,s,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===s&&(!n||n===i[r].context)){i.splice(r,1);return}}validateEventType_(e){te(this.allowedEvents_.find(s=>s===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm extends cj{static getInstance(){return new rm}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Hv()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return te(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hk=32,Gk=768;class Je{constructor(e,s){if(s===void 0){this.pieces_=e.split("/");let n=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=s}toString(){let e="";for(let s=this.pieceNum_;s<this.pieces_.length;s++)this.pieces_[s]!==""&&(e+="/"+this.pieces_[s]);return e||"/"}}function Be(){return new Je("")}function Ne(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function oa(t){return t.pieces_.length-t.pieceNum_}function at(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new Je(t.pieces_,e)}function ay(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function mV(t){let e="";for(let s=t.pieceNum_;s<t.pieces_.length;s++)t.pieces_[s]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[s])));return e||"/"}function Qu(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function uj(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let s=t.pieceNum_;s<t.pieces_.length-1;s++)e.push(t.pieces_[s]);return new Je(e,0)}function Nt(t,e){const s=[];for(let n=t.pieceNum_;n<t.pieces_.length;n++)s.push(t.pieces_[n]);if(e instanceof Je)for(let n=e.pieceNum_;n<e.pieces_.length;n++)s.push(e.pieces_[n]);else{const n=e.split("/");for(let i=0;i<n.length;i++)n[i].length>0&&s.push(n[i])}return new Je(s,0)}function Te(t){return t.pieceNum_>=t.pieces_.length}function ks(t,e){const s=Ne(t),n=Ne(e);if(s===null)return e;if(s===n)return ks(at(t),at(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function pV(t,e){const s=Qu(t,0),n=Qu(e,0);for(let i=0;i<s.length&&i<n.length;i++){const r=Eo(s[i],n[i]);if(r!==0)return r}return s.length===n.length?0:s.length<n.length?-1:1}function oy(t,e){if(oa(t)!==oa(e))return!1;for(let s=t.pieceNum_,n=e.pieceNum_;s<=t.pieces_.length;s++,n++)if(t.pieces_[s]!==e.pieces_[n])return!1;return!0}function bn(t,e){let s=t.pieceNum_,n=e.pieceNum_;if(oa(t)>oa(e))return!1;for(;s<t.pieces_.length;){if(t.pieces_[s]!==e.pieces_[n])return!1;++s,++n}return!0}class gV{constructor(e,s){this.errorPrefix_=s,this.parts_=Qu(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=mp(this.parts_[n]);dj(this)}}function xV(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=mp(e),dj(t)}function bV(t){const e=t.parts_.pop();t.byteLength_-=mp(e),t.parts_.length>0&&(t.byteLength_-=1)}function dj(t){if(t.byteLength_>Gk)throw new Error(t.errorPrefix_+"has a key path longer than "+Gk+" bytes ("+t.byteLength_+").");if(t.parts_.length>Hk)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Hk+") or object contains a cycle "+Ba(t))}function Ba(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ly extends cj{static getInstance(){return new ly}constructor(){super(["visible"]);let e,s;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(s="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(s="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(s="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(s="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,s&&document.addEventListener(s,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}getInitialEvent(e){return te(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hc=1e3,vV=60*5*1e3,zk=30*1e3,yV=1.3,_V=3e4,wV="server_kill",qk=3;class $i extends lj{constructor(e,s,n,i,r,a,l,c){if(super(),this.repoInfo_=e,this.applicationId_=s,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=$i.nextPersistentConnectionId_++,this.log_=Bd("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Hc,this.maxReconnectDelay_=vV,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");ly.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&rm.getInstance().on("online",this.onOnline_,this)}sendRequest(e,s,n){const i=++this.requestNumber_,r={r:i,a:e,b:s};this.log_(Qt(r)),te(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();const s=new Ln,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),s.promise}listen(e,s,n,i){this.initConnection_();const r=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+r),this.listens.has(a)||this.listens.set(a,new Map),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),te(!this.listens.get(a).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:s,query:e,tag:n};this.listens.get(a).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const s=this.outstandingGets_[e];this.sendRequest("g",s.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(n)})}sendListen_(e){const s=e.query,n=s._path.toString(),i=s._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n},a="q";e.tag&&(r.q=s._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(a,r,l=>{const c=l.d,u=l.s;$i.warnOnListenWarnings_(c,s),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(n,i),e.onComplete&&e.onComplete(u,c))})}static warnOnListenWarnings_(e,s){if(e&&typeof e=="object"&&Qn(e,"w")){const n=uo(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const i='".indexOn": "'+s._queryParams.getIndex().toString()+'"',r=s._path.toString();Ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||q3(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=zk)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,s=z3(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(s,n,i=>{const r=i.s,a=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const s=e.s,n=e.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,n)})}unlisten(e,s){const n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),te(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,s)}sendUnlisten_(e,s,n,i){this.log_("Unlisten on "+e+" for "+s);const r={p:e},a="n";i&&(r.q=n,r.t=i),this.sendRequest(a,r)}onDisconnectPut(e,s,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,s,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:s,onComplete:n})}onDisconnectMerge(e,s,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,s,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:s,onComplete:n})}onDisconnectCancel(e,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(e,s,n,i){const r={p:s,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,a=>{i&&setTimeout(()=>{i(a.s,a.d)},Math.floor(0))})}put(e,s,n,i){this.putInternal("p",e,s,n,i)}merge(e,s,n,i){this.putInternal("m",e,s,n,i)}putInternal(e,s,n,i,r){this.initConnection_();const a={p:s,d:n};r!==void 0&&(a.h=r),this.outstandingPuts_.push({action:e,request:a,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(e){const s=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(s,n,r=>{this.log_(s+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const s={c:e};this.log_("reportStats",s),this.sendRequest("s",s,n=>{if(n.s!=="ok"){const r=n.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Qt(e));const s=e.r,n=this.requestCBHash_[s];n&&(delete this.requestCBHash_[s],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,s){this.log_("handleServerMessage",e,s),e==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):e==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):e==="c"?this.onListenRevoked_(s.p,s.q):e==="ac"?this.onAuthRevoked_(s.s,s.d):e==="apc"?this.onAppCheckRevoked_(s.s,s.d):e==="sd"?this.onSecurityDebugPacket_(s):Mx("Unrecognized action received from server: "+Qt(e)+`
Are you using the latest client?`)}onReady_(e,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){te(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>_V&&(this.reconnectDelay_=Hc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let s=Math.max(0,this.reconnectDelay_-e);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*yV)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+$i.nextConnectionId_++,r=this.lastSessionId;let a=!1,l=null;const c=function(){l?l.close():(a=!0,n())},u=function(h){te(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,f]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?rs("getToken() completed but was canceled"):(rs("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=f&&f.token,l=new fV(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,s,n,m=>{Ts(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(wV)},r))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&Ts(h),c())}}}interrupt(e){rs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){rs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Yf(this.interruptReasons_)&&(this.reconnectDelay_=Hc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const s=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const s=this.outstandingPuts_[e];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,s){let n;s?n=s.map(r=>sy(r)).join("$"):n="default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,s){const n=new Je(e).toString();let i;if(this.listens.has(n)){const r=this.listens.get(n);i=r.get(s),r.delete(s),r.size===0&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,s){rs("Auth token revoked: "+e+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=qk&&(this.reconnectDelay_=zk,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,s){rs("App check token revoked: "+e+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=qk&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const s of e.values())this.sendListen_(s);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let s="js";e["sdk."+s+"."+F5.replace(/\./g,"-")]=1,Hv()?e["framework.cordova"]=1:XA()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=rm.getInstance().currentlyOnline();return Yf(this.interruptReasons_)&&e}}$i.nextPersistentConnectionId_=0;$i.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ee{constructor(e,s){this.name=e,this.node=s}static Wrap(e,s){return new Ee(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,s){const n=new Ee(Hl,e),i=new Ee(Hl,s);return this.compare(n,i)!==0}minPost(){return Ee.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ch;class hj extends vp{static get __EMPTY_NODE(){return Ch}static set __EMPTY_NODE(e){Ch=e}compare(e,s){return Eo(e.name,s.name)}isDefinedOn(e){throw hc("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,s){return!1}minPost(){return Ee.MIN}maxPost(){return new Ee(po,Ch)}makePost(e,s){return te(typeof e=="string","KeyIndex indexValue must always be a string."),new Ee(e,Ch)}toString(){return".key"}}const Nl=new hj;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rh{constructor(e,s,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=s?n(e.key,s):1,i&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),s;if(this.resultGenerator_?s=this.resultGenerator_(e.key,e.value):s={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return s}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ns{constructor(e,s,n,i,r){this.key=e,this.value=s,this.color=n??ns.RED,this.left=i??Ls.EMPTY_NODE,this.right=r??Ls.EMPTY_NODE}copy(e,s,n,i,r){return new ns(e??this.key,s??this.value,n??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,s,n){let i=this;const r=n(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,s,n),null):r===0?i=i.copy(null,s,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,s,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ls.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,s){let n,i;if(n=this,s(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,s),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),s(e,n.key)===0){if(n.right.isEmpty())return Ls.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,s))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ns.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ns.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,s)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ns.RED=!0;ns.BLACK=!1;class kV{copy(e,s,n,i,r){return this}insert(e,s,n){return new ns(e,s,null)}remove(e,s){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ls{constructor(e,s=Ls.EMPTY_NODE){this.comparator_=e,this.root_=s}insert(e,s){return new Ls(this.comparator_,this.root_.insert(e,s,this.comparator_).copy(null,null,ns.BLACK,null,null))}remove(e){return new Ls(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ns.BLACK,null,null))}get(e){let s,n=this.root_;for(;!n.isEmpty();){if(s=this.comparator_(e,n.key),s===0)return n.value;s<0?n=n.left:s>0&&(n=n.right)}return null}getPredecessorKey(e){let s,n=this.root_,i=null;for(;!n.isEmpty();)if(s=this.comparator_(e,n.key),s===0){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else s<0?n=n.left:s>0&&(i=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Rh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,s){return new Rh(this.root_,e,this.comparator_,!1,s)}getReverseIteratorFrom(e,s){return new Rh(this.root_,e,this.comparator_,!0,s)}getReverseIterator(e){return new Rh(this.root_,null,this.comparator_,!0,e)}}Ls.EMPTY_NODE=new kV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NV(t,e){return Eo(t.name,e.name)}function cy(t,e){return Eo(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lx;function SV(t){Lx=t}const fj=function(t){return typeof t=="number"?"number:"+z5(t):"string:"+t},mj=function(t){if(t.isLeafNode()){const e=t.val();te(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Qn(e,".sv"),"Priority must be a string or number.")}else te(t===Lx||t.isEmpty(),"priority of unexpected type.");te(t===Lx||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kk;class ts{static set __childrenNodeConstructor(e){Kk=e}static get __childrenNodeConstructor(){return Kk}constructor(e,s=ts.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=s,this.lazyHash_=null,te(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),mj(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ts(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ts.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Te(e)?this:Ne(e)===".priority"?this.priorityNode_:ts.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,s){return null}updateImmediateChild(e,s){return e===".priority"?this.updatePriority(s):s.isEmpty()&&e!==".priority"?this:ts.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,s).updatePriority(this.priorityNode_)}updateChild(e,s){const n=Ne(e);return n===null?s:s.isEmpty()&&n!==".priority"?this:(te(n!==".priority"||oa(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,ts.__childrenNodeConstructor.EMPTY_NODE.updateChild(at(e),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,s){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+fj(this.priorityNode_.val())+":");const s=typeof this.value_;e+=s+":",s==="number"?e+=z5(this.value_):e+=this.value_,this.lazyHash_=H5(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ts.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ts.__childrenNodeConstructor?-1:(te(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const s=typeof e.value_,n=typeof this.value_,i=ts.VALUE_TYPE_ORDER.indexOf(s),r=ts.VALUE_TYPE_ORDER.indexOf(n);return te(i>=0,"Unknown leaf type: "+s),te(r>=0,"Unknown leaf type: "+n),i===r?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const s=e;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}ts.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pj,gj;function TV(t){pj=t}function EV(t){gj=t}class AV extends vp{compare(e,s){const n=e.node.getPriority(),i=s.node.getPriority(),r=n.compareTo(i);return r===0?Eo(e.name,s.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,s){return!e.getPriority().equals(s.getPriority())}minPost(){return Ee.MIN}maxPost(){return new Ee(po,new ts("[PRIORITY-POST]",gj))}makePost(e,s){const n=pj(e);return new Ee(s,new ts("[PRIORITY-POST]",n))}toString(){return".priority"}}const yt=new AV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=Math.log(2);class CV{constructor(e){const s=r=>parseInt(Math.log(r)/jV,10),n=r=>parseInt(Array(r+1).join("1"),2);this.count=s(e+1),this.current_=this.count-1;const i=n(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const am=function(t,e,s,n){t.sort(e);const i=function(c,u){const d=u-c;let h,f;if(d===0)return null;if(d===1)return h=t[c],f=s?s(h):h,new ns(f,h.node,ns.BLACK,null,null);{const m=parseInt(d/2,10)+c,b=i(c,m),x=i(m+1,u);return h=t[m],f=s?s(h):h,new ns(f,h.node,ns.BLACK,b,x)}},r=function(c){let u=null,d=null,h=t.length;const f=function(b,x){const v=h-b,g=h;h-=b;const p=i(v+1,g),y=t[v],k=s?s(y):y;m(new ns(k,y.node,x,null,p))},m=function(b){u?(u.left=b,u=b):(d=b,u=b)};for(let b=0;b<c.count;++b){const x=c.nextBitIsOne(),v=Math.pow(2,c.count-(b+1));x?f(v,ns.BLACK):(f(v,ns.BLACK),f(v,ns.RED))}return d},a=new CV(t.length),l=r(a);return new Ls(n||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tg;const Lo={};class Li{static get Default(){return te(Lo&&yt,"ChildrenNode.ts has not been loaded"),tg=tg||new Li({".priority":Lo},{".priority":yt}),tg}constructor(e,s){this.indexes_=e,this.indexSet_=s}get(e){const s=uo(this.indexes_,e);if(!s)throw new Error("No index defined for "+e);return s instanceof Ls?s:null}hasIndex(e){return Qn(this.indexSet_,e.toString())}addIndex(e,s){te(e!==Nl,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let i=!1;const r=s.getIterator(Ee.Wrap);let a=r.getNext();for(;a;)i=i||e.isDefinedOn(a.node),n.push(a),a=r.getNext();let l;i?l=am(n,e.getCompare()):l=Lo;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const d=Object.assign({},this.indexes_);return d[c]=l,new Li(d,u)}addToIndexes(e,s){const n=Xf(this.indexes_,(i,r)=>{const a=uo(this.indexSet_,r);if(te(a,"Missing index implementation for "+r),i===Lo)if(a.isDefinedOn(e.node)){const l=[],c=s.getIterator(Ee.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&l.push(u),u=c.getNext();return l.push(e),am(l,a.getCompare())}else return Lo;else{const l=s.get(e.name);let c=i;return l&&(c=c.remove(new Ee(e.name,l))),c.insert(e,e.node)}});return new Li(n,this.indexSet_)}removeFromIndexes(e,s){const n=Xf(this.indexes_,i=>{if(i===Lo)return i;{const r=s.get(e.name);return r?i.remove(new Ee(e.name,r)):i}});return new Li(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc;class ge{static get EMPTY_NODE(){return Gc||(Gc=new ge(new Ls(cy),null,Li.Default))}constructor(e,s,n){this.children_=e,this.priorityNode_=s,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&mj(this.priorityNode_),this.children_.isEmpty()&&te(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Gc}updatePriority(e){return this.children_.isEmpty()?this:new ge(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const s=this.children_.get(e);return s===null?Gc:s}}getChild(e){const s=Ne(e);return s===null?this:this.getImmediateChild(s).getChild(at(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,s){if(te(s,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(s);{const n=new Ee(e,s);let i,r;s.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,s),r=this.indexMap_.addToIndexes(n,this.children_));const a=i.isEmpty()?Gc:this.priorityNode_;return new ge(i,a,r)}}updateChild(e,s){const n=Ne(e);if(n===null)return s;{te(Ne(e)!==".priority"||oa(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(n).updateChild(at(e),s);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const s={};let n=0,i=0,r=!0;if(this.forEachChild(yt,(a,l)=>{s[a]=l.val(e),n++,r&&ge.INTEGER_REGEXP_.test(a)?i=Math.max(i,Number(a)):r=!1}),!e&&r&&i<2*n){const a=[];for(const l in s)a[l]=s[l];return a}else return e&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+fj(this.getPriority().val())+":"),this.forEachChild(yt,(s,n)=>{const i=n.hash();i!==""&&(e+=":"+s+":"+i)}),this.lazyHash_=e===""?"":H5(e)}return this.lazyHash_}getPredecessorChildName(e,s,n){const i=this.resolveIndex_(n);if(i){const r=i.getPredecessorKey(new Ee(e,s));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const s=this.resolveIndex_(e);if(s){const n=s.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const s=this.getFirstChildName(e);return s?new Ee(s,this.children_.get(s)):null}getLastChildName(e){const s=this.resolveIndex_(e);if(s){const n=s.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const s=this.getLastChildName(e);return s?new Ee(s,this.children_.get(s)):null}forEachChild(e,s){const n=this.resolveIndex_(e);return n?n.inorderTraversal(i=>s(i.name,i.node)):this.children_.inorderTraversal(s)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,s){const n=this.resolveIndex_(s);if(n)return n.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ee.Wrap);let r=i.peek();for(;r!=null&&s.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,s){const n=this.resolveIndex_(s);if(n)return n.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ee.Wrap);let r=i.peek();for(;r!=null&&s.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Fd?-1:0}withIndex(e){if(e===Nl||this.indexMap_.hasIndex(e))return this;{const s=this.indexMap_.addIndex(e,this.children_);return new ge(this.children_,this.priorityNode_,s)}}isIndexed(e){return e===Nl||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const s=e;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){const n=this.getIterator(yt),i=s.getIterator(yt);let r=n.getNext(),a=i.getNext();for(;r&&a;){if(r.name!==a.name||!r.node.equals(a.node))return!1;r=n.getNext(),a=i.getNext()}return r===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Nl?null:this.indexMap_.get(e.toString())}}ge.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class RV extends ge{constructor(){super(new Ls(cy),ge.EMPTY_NODE,Li.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ge.EMPTY_NODE}isEmpty(){return!1}}const Fd=new RV;Object.defineProperties(Ee,{MIN:{value:new Ee(Hl,ge.EMPTY_NODE)},MAX:{value:new Ee(po,Fd)}});hj.__EMPTY_NODE=ge.EMPTY_NODE;ts.__childrenNodeConstructor=ge;SV(Fd);EV(Fd);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IV=!0;function kt(t,e=null){if(t===null)return ge.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),te(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const s=t;return new ts(s,kt(e))}if(!(t instanceof Array)&&IV){const s=[];let n=!1;if(ls(t,(a,l)=>{if(a.substring(0,1)!=="."){const c=kt(l);c.isEmpty()||(n=n||!c.getPriority().isEmpty(),s.push(new Ee(a,c)))}}),s.length===0)return ge.EMPTY_NODE;const r=am(s,NV,a=>a.name,cy);if(n){const a=am(s,yt.getCompare());return new ge(r,kt(e),new Li({".priority":a},{".priority":yt}))}else return new ge(r,kt(e),Li.Default)}else{let s=ge.EMPTY_NODE;return ls(t,(n,i)=>{if(Qn(t,n)&&n.substring(0,1)!=="."){const r=kt(i);(r.isLeafNode()||!r.isEmpty())&&(s=s.updateImmediateChild(n,r))}}),s.updatePriority(kt(e))}}TV(kt);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OV extends vp{constructor(e){super(),this.indexPath_=e,te(!Te(e)&&Ne(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,s){const n=this.extractChild(e.node),i=this.extractChild(s.node),r=n.compareTo(i);return r===0?Eo(e.name,s.name):r}makePost(e,s){const n=kt(e),i=ge.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ee(s,i)}maxPost(){const e=ge.EMPTY_NODE.updateChild(this.indexPath_,Fd);return new Ee(po,e)}toString(){return Qu(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MV extends vp{compare(e,s){const n=e.node.compareTo(s.node);return n===0?Eo(e.name,s.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,s){return!e.equals(s)}minPost(){return Ee.MIN}maxPost(){return Ee.MAX}makePost(e,s){const n=kt(e);return new Ee(s,n)}toString(){return".value"}}const DV=new MV;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xj(t){return{type:"value",snapshotNode:t}}function Gl(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Ju(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Zu(t,e,s){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:s}}function LV(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e){this.index_=e}updateChild(e,s,n,i,r,a){te(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(s);return l.getChild(i).equals(n.getChild(i))&&l.isEmpty()===n.isEmpty()||(a!=null&&(n.isEmpty()?e.hasChild(s)?a.trackChildChange(Ju(s,l)):te(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(Gl(s,n)):a.trackChildChange(Zu(s,n,l))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(s,n).withIndex(this.index_)}updateFullNode(e,s,n){return n!=null&&(e.isLeafNode()||e.forEachChild(yt,(i,r)=>{s.hasChild(i)||n.trackChildChange(Ju(i,r))}),s.isLeafNode()||s.forEachChild(yt,(i,r)=>{if(e.hasChild(i)){const a=e.getImmediateChild(i);a.equals(r)||n.trackChildChange(Zu(i,r,a))}else n.trackChildChange(Gl(i,r))})),s.withIndex(this.index_)}updatePriority(e,s){return e.isEmpty()?ge.EMPTY_NODE:e.updatePriority(s)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e){this.indexedFilter_=new uy(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ed.getStartPost_(e),this.endPost_=ed.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const s=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return s&&n}updateChild(e,s,n,i,r,a){return this.matches(new Ee(s,n))||(n=ge.EMPTY_NODE),this.indexedFilter_.updateChild(e,s,n,i,r,a)}updateFullNode(e,s,n){s.isLeafNode()&&(s=ge.EMPTY_NODE);let i=s.withIndex(this.index_);i=i.updatePriority(ge.EMPTY_NODE);const r=this;return s.forEachChild(yt,(a,l)=>{r.matches(new Ee(a,l))||(i=i.updateImmediateChild(a,ge.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,s){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const s=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),s)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const s=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),s)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PV{constructor(e){this.withinDirectionalStart=s=>this.reverse_?this.withinEndPost(s):this.withinStartPost(s),this.withinDirectionalEnd=s=>this.reverse_?this.withinStartPost(s):this.withinEndPost(s),this.withinStartPost=s=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),s);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=s=>{const n=this.index_.compare(s,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new ed(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,s,n,i,r,a){return this.rangedFilter_.matches(new Ee(s,n))||(n=ge.EMPTY_NODE),e.getImmediateChild(s).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,s,n,i,r,a):this.fullLimitUpdateChild_(e,s,n,r,a)}updateFullNode(e,s,n){let i;if(s.isLeafNode()||s.isEmpty())i=ge.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<s.numChildren()&&s.isIndexed(this.index_)){i=ge.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=s.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=s.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;r.hasNext()&&a<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),a++;else break;else continue}}else{i=s.withIndex(this.index_),i=i.updatePriority(ge.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let a=0;for(;r.hasNext();){const l=r.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:i=i.updateImmediateChild(l.name,ge.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,s){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,s,n,i,r){let a;if(this.reverse_){const h=this.index_.getCompare();a=(f,m)=>h(m,f)}else a=this.index_.getCompare();const l=e;te(l.numChildren()===this.limit_,"");const c=new Ee(s,n),u=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(l.hasChild(s)){const h=l.getImmediateChild(s);let f=i.getChildAfterChild(this.index_,u,this.reverse_);for(;f!=null&&(f.name===s||l.hasChild(f.name));)f=i.getChildAfterChild(this.index_,f,this.reverse_);const m=f==null?1:a(f,c);if(d&&!n.isEmpty()&&m>=0)return r!=null&&r.trackChildChange(Zu(s,n,h)),l.updateImmediateChild(s,n);{r!=null&&r.trackChildChange(Ju(s,h));const x=l.updateImmediateChild(s,ge.EMPTY_NODE);return f!=null&&this.rangedFilter_.matches(f)?(r!=null&&r.trackChildChange(Gl(f.name,f.node)),x.updateImmediateChild(f.name,f.node)):x}}else return n.isEmpty()?e:d&&a(u,c)>=0?(r!=null&&(r.trackChildChange(Ju(u.name,u.node)),r.trackChildChange(Gl(s,n))),l.updateImmediateChild(s,n).updateImmediateChild(u.name,ge.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=yt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return te(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return te(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Hl}hasEnd(){return this.endSet_}getIndexEndValue(){return te(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return te(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:po}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return te(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===yt}copy(){const e=new dy;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function VV(t){return t.loadsAllData()?new uy(t.getIndex()):t.hasLimit()?new PV(t):new ed(t)}function BV(t,e){const s=t.copy();return s.limitSet_=!0,s.limit_=e,s.viewFrom_="r",s}function Wk(t){const e={};if(t.isDefault())return e;let s;if(t.index_===yt?s="$priority":t.index_===DV?s="$value":t.index_===Nl?s="$key":(te(t.index_ instanceof OV,"Unrecognized index type!"),s=t.index_.toString()),e.orderBy=Qt(s),t.startSet_){const n=t.startAfterSet_?"startAfter":"startAt";e[n]=Qt(t.indexStartValue_),t.startNameSet_&&(e[n]+=","+Qt(t.indexStartName_))}if(t.endSet_){const n=t.endBeforeSet_?"endBefore":"endAt";e[n]=Qt(t.indexEndValue_),t.endNameSet_&&(e[n]+=","+Qt(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function Yk(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let s=t.viewFrom_;s===""&&(t.isViewFromLeft()?s="l":s="r"),e.vf=s}return t.index_!==yt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class om extends lj{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,s){return s!==void 0?"tag$"+s:(te(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,s,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=s,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=Bd("p:rest:"),this.listens_={}}listen(e,s,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const a=om.getListenId_(e,n),l={};this.listens_[a]=l;const c=Wk(e._queryParams);this.restRequest_(r+".json",c,(u,d)=>{let h=d;if(u===404&&(h=null,u=null),u===null&&this.onDataUpdate_(r,h,!1,n),uo(this.listens_,a)===l){let f;u?u===401?f="permission_denied":f="rest_error:"+u:f="ok",i(f,null)}})}unlisten(e,s){const n=om.getListenId_(e,s);delete this.listens_[n]}get(e){const s=Wk(e._queryParams),n=e._path.toString(),i=new Ln;return this.restRequest_(n+".json",s,(r,a)=>{let l=a;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(n,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,s={},n){return s.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(s.auth=i.accessToken),r&&r.token&&(s.ac=r.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+mc(s);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(n&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=zu(l.responseText)}catch{Ts("Failed to parse JSON response for "+a+": "+l.responseText)}n(null,c)}else l.status!==401&&l.status!==404&&Ts("Got unsuccessful REST response for "+a+" Status: "+l.status),n(l.status);n=null}},l.open("GET",a,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FV{constructor(){this.rootNode_=ge.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,s){this.rootNode_=this.rootNode_.updateChild(e,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lm(){return{value:null,children:new Map}}function xc(t,e,s){if(Te(e))t.value=s,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,s);else{const n=Ne(e);t.children.has(n)||t.children.set(n,lm());const i=t.children.get(n);e=at(e),xc(i,e,s)}}function Px(t,e){if(Te(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const s=t.value;return t.value=null,s.forEachChild(yt,(n,i)=>{xc(t,new Je(n),i)}),Px(t,e)}}else if(t.children.size>0){const s=Ne(e);return e=at(e),t.children.has(s)&&Px(t.children.get(s),e)&&t.children.delete(s),t.children.size===0}else return!0}function Vx(t,e,s){t.value!==null?s(e,t.value):UV(t,(n,i)=>{const r=new Je(e.toString()+"/"+n);Vx(i,r,s)})}function UV(t,e){t.children.forEach((s,n)=>{e(n,s)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $V{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),s=Object.assign({},e);return this.last_&&ls(this.last_,(n,i)=>{s[n]=s[n]-i}),this.last_=e,s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk=10*1e3,HV=30*1e3,GV=5*60*1e3;class zV{constructor(e,s){this.server_=s,this.statsToReport_={},this.statsListener_=new $V(e);const n=Xk+(HV-Xk)*Math.random();vu(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),s={};let n=!1;ls(e,(i,r)=>{r>0&&Qn(this.statsToReport_,i)&&(s[i]=r,n=!0)}),n&&this.server_.reportStats(s),vu(this.reportStats_.bind(this),Math.floor(Math.random()*2*GV))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Bn;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Bn||(Bn={}));function hy(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function fy(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function my(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cm{constructor(e,s,n){this.path=e,this.affectedTree=s,this.revert=n,this.type=Bn.ACK_USER_WRITE,this.source=hy()}operationForChild(e){if(Te(this.path)){if(this.affectedTree.value!=null)return te(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const s=this.affectedTree.subtree(new Je(e));return new cm(Be(),s,this.revert)}}else return te(Ne(this.path)===e,"operationForChild called for unrelated child."),new cm(at(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class td{constructor(e,s){this.source=e,this.path=s,this.type=Bn.LISTEN_COMPLETE}operationForChild(e){return Te(this.path)?new td(this.source,Be()):new td(this.source,at(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class go{constructor(e,s,n){this.source=e,this.path=s,this.snap=n,this.type=Bn.OVERWRITE}operationForChild(e){return Te(this.path)?new go(this.source,Be(),this.snap.getImmediateChild(e)):new go(this.source,at(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let py=class Bx{constructor(e,s,n){this.source=e,this.path=s,this.children=n,this.type=Bn.MERGE}operationForChild(e){if(Te(this.path)){const s=this.children.subtree(new Je(e));return s.isEmpty()?null:s.value?new go(this.source,Be(),s.value):new Bx(this.source,Be(),s)}else return te(Ne(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Bx(this.source,at(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class la{constructor(e,s,n){this.node_=e,this.fullyInitialized_=s,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Te(e))return this.isFullyInitialized()&&!this.filtered_;const s=Ne(e);return this.isCompleteForChild(s)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qV{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function KV(t,e,s,n){const i=[],r=[];return e.forEach(a=>{a.type==="child_changed"&&t.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&r.push(LV(a.childName,a.snapshotNode))}),zc(t,i,"child_removed",e,n,s),zc(t,i,"child_added",e,n,s),zc(t,i,"child_moved",r,n,s),zc(t,i,"child_changed",e,n,s),zc(t,i,"value",e,n,s),i}function zc(t,e,s,n,i,r){const a=n.filter(l=>l.type===s);a.sort((l,c)=>YV(t,l,c)),a.forEach(l=>{const c=WV(t,l,r);i.forEach(u=>{u.respondsTo(l.type)&&e.push(u.createEvent(c,t.query_))})})}function WV(t,e,s){return e.type==="value"||e.type==="child_removed"||(e.prevName=s.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function YV(t,e,s){if(e.childName==null||s.childName==null)throw hc("Should only compare child_ events.");const n=new Ee(e.childName,e.snapshotNode),i=new Ee(s.childName,s.snapshotNode);return t.index_.compare(n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yp(t,e){return{eventCache:t,serverCache:e}}function yu(t,e,s,n){return yp(new la(e,s,n),t.serverCache)}function bj(t,e,s,n){return yp(t.eventCache,new la(e,s,n))}function um(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function xo(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sg;const XV=()=>(sg||(sg=new Ls(O8)),sg);class ct{static fromObject(e){let s=new ct(null);return ls(e,(n,i)=>{s=s.set(new Je(n),i)}),s}constructor(e,s=XV()){this.value=e,this.children=s}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,s){if(this.value!=null&&s(this.value))return{path:Be(),value:this.value};if(Te(e))return null;{const n=Ne(e),i=this.children.get(n);if(i!==null){const r=i.findRootMostMatchingPathAndValue(at(e),s);return r!=null?{path:Nt(new Je(n),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Te(e))return this;{const s=Ne(e),n=this.children.get(s);return n!==null?n.subtree(at(e)):new ct(null)}}set(e,s){if(Te(e))return new ct(s,this.children);{const n=Ne(e),r=(this.children.get(n)||new ct(null)).set(at(e),s),a=this.children.insert(n,r);return new ct(this.value,a)}}remove(e){if(Te(e))return this.children.isEmpty()?new ct(null):new ct(null,this.children);{const s=Ne(e),n=this.children.get(s);if(n){const i=n.remove(at(e));let r;return i.isEmpty()?r=this.children.remove(s):r=this.children.insert(s,i),this.value===null&&r.isEmpty()?new ct(null):new ct(this.value,r)}else return this}}get(e){if(Te(e))return this.value;{const s=Ne(e),n=this.children.get(s);return n?n.get(at(e)):null}}setTree(e,s){if(Te(e))return s;{const n=Ne(e),r=(this.children.get(n)||new ct(null)).setTree(at(e),s);let a;return r.isEmpty()?a=this.children.remove(n):a=this.children.insert(n,r),new ct(this.value,a)}}fold(e){return this.fold_(Be(),e)}fold_(e,s){const n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(Nt(e,i),s)}),s(e,this.value,n)}findOnPath(e,s){return this.findOnPath_(e,Be(),s)}findOnPath_(e,s,n){const i=this.value?n(s,this.value):!1;if(i)return i;if(Te(e))return null;{const r=Ne(e),a=this.children.get(r);return a?a.findOnPath_(at(e),Nt(s,r),n):null}}foreachOnPath(e,s){return this.foreachOnPath_(e,Be(),s)}foreachOnPath_(e,s,n){if(Te(e))return this;{this.value&&n(s,this.value);const i=Ne(e),r=this.children.get(i);return r?r.foreachOnPath_(at(e),Nt(s,i),n):new ct(null)}}foreach(e){this.foreach_(Be(),e)}foreach_(e,s){this.children.inorderTraversal((n,i)=>{i.foreach_(Nt(e,n),s)}),this.value&&s(e,this.value)}foreachChild(e){this.children.inorderTraversal((s,n)=>{n.value&&e(s,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $n{constructor(e){this.writeTree_=e}static empty(){return new $n(new ct(null))}}function _u(t,e,s){if(Te(e))return new $n(new ct(s));{const n=t.writeTree_.findRootMostValueAndPath(e);if(n!=null){const i=n.path;let r=n.value;const a=ks(i,e);return r=r.updateChild(a,s),new $n(t.writeTree_.set(i,r))}else{const i=new ct(s),r=t.writeTree_.setTree(e,i);return new $n(r)}}}function Fx(t,e,s){let n=t;return ls(s,(i,r)=>{n=_u(n,Nt(e,i),r)}),n}function Qk(t,e){if(Te(e))return $n.empty();{const s=t.writeTree_.setTree(e,new ct(null));return new $n(s)}}function Ux(t,e){return Ao(t,e)!=null}function Ao(t,e){const s=t.writeTree_.findRootMostValueAndPath(e);return s!=null?t.writeTree_.get(s.path).getChild(ks(s.path,e)):null}function Jk(t){const e=[],s=t.writeTree_.value;return s!=null?s.isLeafNode()||s.forEachChild(yt,(n,i)=>{e.push(new Ee(n,i))}):t.writeTree_.children.inorderTraversal((n,i)=>{i.value!=null&&e.push(new Ee(n,i.value))}),e}function Jr(t,e){if(Te(e))return t;{const s=Ao(t,e);return s!=null?new $n(new ct(s)):new $n(t.writeTree_.subtree(e))}}function $x(t){return t.writeTree_.isEmpty()}function zl(t,e){return vj(Be(),t.writeTree_,e)}function vj(t,e,s){if(e.value!=null)return s.updateChild(t,e.value);{let n=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(te(r.value!==null,"Priority writes must always be leaf nodes"),n=r.value):s=vj(Nt(t,i),r,s)}),!s.getChild(t).isEmpty()&&n!==null&&(s=s.updateChild(Nt(t,".priority"),n)),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _p(t,e){return kj(e,t)}function QV(t,e,s,n,i){te(n>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:s,writeId:n,visible:i}),i&&(t.visibleWrites=_u(t.visibleWrites,e,s)),t.lastWriteId=n}function JV(t,e,s,n){te(n>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:s,writeId:n,visible:!0}),t.visibleWrites=Fx(t.visibleWrites,e,s),t.lastWriteId=n}function ZV(t,e){for(let s=0;s<t.allWrites.length;s++){const n=t.allWrites[s];if(n.writeId===e)return n}return null}function eB(t,e){const s=t.allWrites.findIndex(l=>l.writeId===e);te(s>=0,"removeWrite called with nonexistent writeId.");const n=t.allWrites[s];t.allWrites.splice(s,1);let i=n.visible,r=!1,a=t.allWrites.length-1;for(;i&&a>=0;){const l=t.allWrites[a];l.visible&&(a>=s&&tB(l,n.path)?i=!1:bn(n.path,l.path)&&(r=!0)),a--}if(i){if(r)return sB(t),!0;if(n.snap)t.visibleWrites=Qk(t.visibleWrites,n.path);else{const l=n.children;ls(l,c=>{t.visibleWrites=Qk(t.visibleWrites,Nt(n.path,c))})}return!0}else return!1}function tB(t,e){if(t.snap)return bn(t.path,e);for(const s in t.children)if(t.children.hasOwnProperty(s)&&bn(Nt(t.path,s),e))return!0;return!1}function sB(t){t.visibleWrites=yj(t.allWrites,nB,Be()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function nB(t){return t.visible}function yj(t,e,s){let n=$n.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const a=r.path;let l;if(r.snap)bn(s,a)?(l=ks(s,a),n=_u(n,l,r.snap)):bn(a,s)&&(l=ks(a,s),n=_u(n,Be(),r.snap.getChild(l)));else if(r.children){if(bn(s,a))l=ks(s,a),n=Fx(n,l,r.children);else if(bn(a,s))if(l=ks(a,s),Te(l))n=Fx(n,Be(),r.children);else{const c=uo(r.children,Ne(l));if(c){const u=c.getChild(at(l));n=_u(n,Be(),u)}}}else throw hc("WriteRecord should have .snap or .children")}}return n}function _j(t,e,s,n,i){if(!n&&!i){const r=Ao(t.visibleWrites,e);if(r!=null)return r;{const a=Jr(t.visibleWrites,e);if($x(a))return s;if(s==null&&!Ux(a,Be()))return null;{const l=s||ge.EMPTY_NODE;return zl(a,l)}}}else{const r=Jr(t.visibleWrites,e);if(!i&&$x(r))return s;if(!i&&s==null&&!Ux(r,Be()))return null;{const a=function(u){return(u.visible||i)&&(!n||!~n.indexOf(u.writeId))&&(bn(u.path,e)||bn(e,u.path))},l=yj(t.allWrites,a,e),c=s||ge.EMPTY_NODE;return zl(l,c)}}}function iB(t,e,s){let n=ge.EMPTY_NODE;const i=Ao(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(yt,(r,a)=>{n=n.updateImmediateChild(r,a)}),n;if(s){const r=Jr(t.visibleWrites,e);return s.forEachChild(yt,(a,l)=>{const c=zl(Jr(r,new Je(a)),l);n=n.updateImmediateChild(a,c)}),Jk(r).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}else{const r=Jr(t.visibleWrites,e);return Jk(r).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}}function rB(t,e,s,n,i){te(n||i,"Either existingEventSnap or existingServerSnap must exist");const r=Nt(e,s);if(Ux(t.visibleWrites,r))return null;{const a=Jr(t.visibleWrites,r);return $x(a)?i.getChild(s):zl(a,i.getChild(s))}}function aB(t,e,s,n){const i=Nt(e,s),r=Ao(t.visibleWrites,i);if(r!=null)return r;if(n.isCompleteForChild(s)){const a=Jr(t.visibleWrites,i);return zl(a,n.getNode().getImmediateChild(s))}else return null}function oB(t,e){return Ao(t.visibleWrites,e)}function lB(t,e,s,n,i,r,a){let l;const c=Jr(t.visibleWrites,e),u=Ao(c,Be());if(u!=null)l=u;else if(s!=null)l=zl(c,s);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const d=[],h=a.getCompare(),f=r?l.getReverseIteratorFrom(n,a):l.getIteratorFrom(n,a);let m=f.getNext();for(;m&&d.length<i;)h(m,n)!==0&&d.push(m),m=f.getNext();return d}else return[]}function cB(){return{visibleWrites:$n.empty(),allWrites:[],lastWriteId:-1}}function dm(t,e,s,n){return _j(t.writeTree,t.treePath,e,s,n)}function gy(t,e){return iB(t.writeTree,t.treePath,e)}function Zk(t,e,s,n){return rB(t.writeTree,t.treePath,e,s,n)}function hm(t,e){return oB(t.writeTree,Nt(t.treePath,e))}function uB(t,e,s,n,i,r){return lB(t.writeTree,t.treePath,e,s,n,i,r)}function xy(t,e,s){return aB(t.writeTree,t.treePath,e,s)}function wj(t,e){return kj(Nt(t.treePath,e),t.writeTree)}function kj(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dB{constructor(){this.changeMap=new Map}trackChildChange(e){const s=e.type,n=e.childName;te(s==="child_added"||s==="child_changed"||s==="child_removed","Only child changes supported for tracking"),te(n!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(n);if(i){const r=i.type;if(s==="child_added"&&r==="child_removed")this.changeMap.set(n,Zu(n,e.snapshotNode,i.snapshotNode));else if(s==="child_removed"&&r==="child_added")this.changeMap.delete(n);else if(s==="child_removed"&&r==="child_changed")this.changeMap.set(n,Ju(n,i.oldSnap));else if(s==="child_changed"&&r==="child_added")this.changeMap.set(n,Gl(n,e.snapshotNode));else if(s==="child_changed"&&r==="child_changed")this.changeMap.set(n,Zu(n,e.snapshotNode,i.oldSnap));else throw hc("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hB{getCompleteChild(e){return null}getChildAfterChild(e,s,n){return null}}const Nj=new hB;class by{constructor(e,s,n=null){this.writes_=e,this.viewCache_=s,this.optCompleteServerCache_=n}getCompleteChild(e){const s=this.viewCache_.eventCache;if(s.isCompleteForChild(e))return s.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new la(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return xy(this.writes_,e,n)}}getChildAfterChild(e,s,n){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:xo(this.viewCache_),r=uB(this.writes_,i,s,1,n,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fB(t){return{filter:t}}function mB(t,e){te(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),te(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function pB(t,e,s,n,i){const r=new dB;let a,l;if(s.type===Bn.OVERWRITE){const u=s;u.source.fromUser?a=Hx(t,e,u.path,u.snap,n,i,r):(te(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered()&&!Te(u.path),a=fm(t,e,u.path,u.snap,n,i,l,r))}else if(s.type===Bn.MERGE){const u=s;u.source.fromUser?a=xB(t,e,u.path,u.children,n,i,r):(te(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered(),a=Gx(t,e,u.path,u.children,n,i,l,r))}else if(s.type===Bn.ACK_USER_WRITE){const u=s;u.revert?a=yB(t,e,u.path,n,i,r):a=bB(t,e,u.path,u.affectedTree,n,i,r)}else if(s.type===Bn.LISTEN_COMPLETE)a=vB(t,e,s.path,n,r);else throw hc("Unknown operation type: "+s.type);const c=r.getChanges();return gB(e,a,c),{viewCache:a,changes:c}}function gB(t,e,s){const n=e.eventCache;if(n.isFullyInitialized()){const i=n.getNode().isLeafNode()||n.getNode().isEmpty(),r=um(t);(s.length>0||!t.eventCache.isFullyInitialized()||i&&!n.getNode().equals(r)||!n.getNode().getPriority().equals(r.getPriority()))&&s.push(xj(um(e)))}}function Sj(t,e,s,n,i,r){const a=e.eventCache;if(hm(n,s)!=null)return e;{let l,c;if(Te(s))if(te(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=xo(e),d=u instanceof ge?u:ge.EMPTY_NODE,h=gy(n,d);l=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const u=dm(n,xo(e));l=t.filter.updateFullNode(e.eventCache.getNode(),u,r)}else{const u=Ne(s);if(u===".priority"){te(oa(s)===1,"Can't have a priority with additional path components");const d=a.getNode();c=e.serverCache.getNode();const h=Zk(n,s,d,c);h!=null?l=t.filter.updatePriority(d,h):l=a.getNode()}else{const d=at(s);let h;if(a.isCompleteForChild(u)){c=e.serverCache.getNode();const f=Zk(n,s,a.getNode(),c);f!=null?h=a.getNode().getImmediateChild(u).updateChild(d,f):h=a.getNode().getImmediateChild(u)}else h=xy(n,u,e.serverCache);h!=null?l=t.filter.updateChild(a.getNode(),u,h,d,i,r):l=a.getNode()}}return yu(e,l,a.isFullyInitialized()||Te(s),t.filter.filtersNodes())}}function fm(t,e,s,n,i,r,a,l){const c=e.serverCache;let u;const d=a?t.filter:t.filter.getIndexedFilter();if(Te(s))u=d.updateFullNode(c.getNode(),n,null);else if(d.filtersNodes()&&!c.isFiltered()){const m=c.getNode().updateChild(s,n);u=d.updateFullNode(c.getNode(),m,null)}else{const m=Ne(s);if(!c.isCompleteForPath(s)&&oa(s)>1)return e;const b=at(s),v=c.getNode().getImmediateChild(m).updateChild(b,n);m===".priority"?u=d.updatePriority(c.getNode(),v):u=d.updateChild(c.getNode(),m,v,b,Nj,null)}const h=bj(e,u,c.isFullyInitialized()||Te(s),d.filtersNodes()),f=new by(i,h,r);return Sj(t,h,s,i,f,l)}function Hx(t,e,s,n,i,r,a){const l=e.eventCache;let c,u;const d=new by(i,e,r);if(Te(s))u=t.filter.updateFullNode(e.eventCache.getNode(),n,a),c=yu(e,u,!0,t.filter.filtersNodes());else{const h=Ne(s);if(h===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),n),c=yu(e,u,l.isFullyInitialized(),l.isFiltered());else{const f=at(s),m=l.getNode().getImmediateChild(h);let b;if(Te(f))b=n;else{const x=d.getCompleteChild(h);x!=null?ay(f)===".priority"&&x.getChild(uj(f)).isEmpty()?b=x:b=x.updateChild(f,n):b=ge.EMPTY_NODE}if(m.equals(b))c=e;else{const x=t.filter.updateChild(l.getNode(),h,b,f,d,a);c=yu(e,x,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function eN(t,e){return t.eventCache.isCompleteForChild(e)}function xB(t,e,s,n,i,r,a){let l=e;return n.foreach((c,u)=>{const d=Nt(s,c);eN(e,Ne(d))&&(l=Hx(t,l,d,u,i,r,a))}),n.foreach((c,u)=>{const d=Nt(s,c);eN(e,Ne(d))||(l=Hx(t,l,d,u,i,r,a))}),l}function tN(t,e,s){return s.foreach((n,i)=>{e=e.updateChild(n,i)}),e}function Gx(t,e,s,n,i,r,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Te(s)?u=n:u=new ct(null).setTree(s,n);const d=e.serverCache.getNode();return u.children.inorderTraversal((h,f)=>{if(d.hasChild(h)){const m=e.serverCache.getNode().getImmediateChild(h),b=tN(t,m,f);c=fm(t,c,new Je(h),b,i,r,a,l)}}),u.children.inorderTraversal((h,f)=>{const m=!e.serverCache.isCompleteForChild(h)&&f.value===null;if(!d.hasChild(h)&&!m){const b=e.serverCache.getNode().getImmediateChild(h),x=tN(t,b,f);c=fm(t,c,new Je(h),x,i,r,a,l)}}),c}function bB(t,e,s,n,i,r,a){if(hm(i,s)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(n.value!=null){if(Te(s)&&c.isFullyInitialized()||c.isCompleteForPath(s))return fm(t,e,s,c.getNode().getChild(s),i,r,l,a);if(Te(s)){let u=new ct(null);return c.getNode().forEachChild(Nl,(d,h)=>{u=u.set(new Je(d),h)}),Gx(t,e,s,u,i,r,l,a)}else return e}else{let u=new ct(null);return n.foreach((d,h)=>{const f=Nt(s,d);c.isCompleteForPath(f)&&(u=u.set(d,c.getNode().getChild(f)))}),Gx(t,e,s,u,i,r,l,a)}}function vB(t,e,s,n,i){const r=e.serverCache,a=bj(e,r.getNode(),r.isFullyInitialized()||Te(s),r.isFiltered());return Sj(t,a,s,n,Nj,i)}function yB(t,e,s,n,i,r){let a;if(hm(n,s)!=null)return e;{const l=new by(n,e,i),c=e.eventCache.getNode();let u;if(Te(s)||Ne(s)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=dm(n,xo(e));else{const h=e.serverCache.getNode();te(h instanceof ge,"serverChildren would be complete if leaf node"),d=gy(n,h)}d=d,u=t.filter.updateFullNode(c,d,r)}else{const d=Ne(s);let h=xy(n,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?u=t.filter.updateChild(c,d,h,at(s),l,r):e.eventCache.getNode().hasChild(d)?u=t.filter.updateChild(c,d,ge.EMPTY_NODE,at(s),l,r):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=dm(n,xo(e)),a.isLeafNode()&&(u=t.filter.updateFullNode(u,a,r)))}return a=e.serverCache.isFullyInitialized()||hm(n,Be())!=null,yu(e,u,a,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _B{constructor(e,s){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new uy(n.getIndex()),r=VV(n);this.processor_=fB(r);const a=s.serverCache,l=s.eventCache,c=i.updateFullNode(ge.EMPTY_NODE,a.getNode(),null),u=r.updateFullNode(ge.EMPTY_NODE,l.getNode(),null),d=new la(c,a.isFullyInitialized(),i.filtersNodes()),h=new la(u,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=yp(h,d),this.eventGenerator_=new qV(this.query_)}get query(){return this.query_}}function wB(t){return t.viewCache_.serverCache.getNode()}function kB(t){return um(t.viewCache_)}function NB(t,e){const s=xo(t.viewCache_);return s&&(t.query._queryParams.loadsAllData()||!Te(e)&&!s.getImmediateChild(Ne(e)).isEmpty())?s.getChild(e):null}function sN(t){return t.eventRegistrations_.length===0}function SB(t,e){t.eventRegistrations_.push(e)}function nN(t,e,s){const n=[];if(s){te(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const a=r.createCancelEvent(s,i);a&&n.push(a)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const a=t.eventRegistrations_[r];if(!a.matches(e))i.push(a);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return n}function iN(t,e,s,n){e.type===Bn.MERGE&&e.source.queryId!==null&&(te(xo(t.viewCache_),"We should always have a full cache before handling merges"),te(um(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=pB(t.processor_,i,e,s,n);return mB(t.processor_,r.viewCache),te(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Tj(t,r.changes,r.viewCache.eventCache.getNode(),null)}function TB(t,e){const s=t.viewCache_.eventCache,n=[];return s.getNode().isLeafNode()||s.getNode().forEachChild(yt,(r,a)=>{n.push(Gl(r,a))}),s.isFullyInitialized()&&n.push(xj(s.getNode())),Tj(t,n,s.getNode(),e)}function Tj(t,e,s,n){const i=n?[n]:t.eventRegistrations_;return KV(t.eventGenerator_,e,s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mm;class Ej{constructor(){this.views=new Map}}function EB(t){te(!mm,"__referenceConstructor has already been defined"),mm=t}function AB(){return te(mm,"Reference.ts has not been loaded"),mm}function jB(t){return t.views.size===0}function vy(t,e,s,n){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return te(r!=null,"SyncTree gave us an op for an invalid query."),iN(r,e,s,n)}else{let r=[];for(const a of t.views.values())r=r.concat(iN(a,e,s,n));return r}}function Aj(t,e,s,n,i){const r=e._queryIdentifier,a=t.views.get(r);if(!a){let l=dm(s,i?n:null),c=!1;l?c=!0:n instanceof ge?(l=gy(s,n),c=!1):(l=ge.EMPTY_NODE,c=!1);const u=yp(new la(l,c,!1),new la(n,i,!1));return new _B(e,u)}return a}function CB(t,e,s,n,i,r){const a=Aj(t,e,n,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,a),SB(a,s),TB(a,s)}function RB(t,e,s,n){const i=e._queryIdentifier,r=[];let a=[];const l=ca(t);if(i==="default")for(const[c,u]of t.views.entries())a=a.concat(nN(u,s,n)),sN(u)&&(t.views.delete(c),u.query._queryParams.loadsAllData()||r.push(u.query));else{const c=t.views.get(i);c&&(a=a.concat(nN(c,s,n)),sN(c)&&(t.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!ca(t)&&r.push(new(AB())(e._repo,e._path)),{removed:r,events:a}}function jj(t){const e=[];for(const s of t.views.values())s.query._queryParams.loadsAllData()||e.push(s);return e}function Zr(t,e){let s=null;for(const n of t.views.values())s=s||NB(n,e);return s}function Cj(t,e){if(e._queryParams.loadsAllData())return wp(t);{const n=e._queryIdentifier;return t.views.get(n)}}function Rj(t,e){return Cj(t,e)!=null}function ca(t){return wp(t)!=null}function wp(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pm;function IB(t){te(!pm,"__referenceConstructor has already been defined"),pm=t}function OB(){return te(pm,"Reference.ts has not been loaded"),pm}let MB=1;class rN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_=cB(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function yy(t,e,s,n,i){return QV(t.pendingWriteTree_,e,s,n,i),i?bc(t,new go(hy(),e,s)):[]}function DB(t,e,s,n){JV(t.pendingWriteTree_,e,s,n);const i=ct.fromObject(s);return bc(t,new py(hy(),e,i))}function Pr(t,e,s=!1){const n=ZV(t.pendingWriteTree_,e);if(eB(t.pendingWriteTree_,e)){let r=new ct(null);return n.snap!=null?r=r.set(Be(),!0):ls(n.children,a=>{r=r.set(new Je(a),!0)}),bc(t,new cm(n.path,r,s))}else return[]}function Ud(t,e,s){return bc(t,new go(fy(),e,s))}function LB(t,e,s){const n=ct.fromObject(s);return bc(t,new py(fy(),e,n))}function PB(t,e){return bc(t,new td(fy(),e))}function VB(t,e,s){const n=_y(t,s);if(n){const i=wy(n),r=i.path,a=i.queryId,l=ks(r,e),c=new td(my(a),l);return ky(t,r,c)}else return[]}function gm(t,e,s,n,i=!1){const r=e._path,a=t.syncPointTree_.get(r);let l=[];if(a&&(e._queryIdentifier==="default"||Rj(a,e))){const c=RB(a,e,s,n);jB(a)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const u=c.removed;if(l=c.events,!i){const d=u.findIndex(f=>f._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(f,m)=>ca(m));if(d&&!h){const f=t.syncPointTree_.subtree(r);if(!f.isEmpty()){const m=UB(f);for(let b=0;b<m.length;++b){const x=m[b],v=x.query,g=Dj(t,x);t.listenProvider_.startListening(wu(v),sd(t,v),g.hashFn,g.onComplete)}}}!h&&u.length>0&&!n&&(d?t.listenProvider_.stopListening(wu(e),null):u.forEach(f=>{const m=t.queryToTagMap.get(Np(f));t.listenProvider_.stopListening(wu(f),m)}))}$B(t,u)}return l}function Ij(t,e,s,n){const i=_y(t,n);if(i!=null){const r=wy(i),a=r.path,l=r.queryId,c=ks(a,e),u=new go(my(l),c,s);return ky(t,a,u)}else return[]}function BB(t,e,s,n){const i=_y(t,n);if(i){const r=wy(i),a=r.path,l=r.queryId,c=ks(a,e),u=ct.fromObject(s),d=new py(my(l),c,u);return ky(t,a,d)}else return[]}function zx(t,e,s,n=!1){const i=e._path;let r=null,a=!1;t.syncPointTree_.foreachOnPath(i,(f,m)=>{const b=ks(f,i);r=r||Zr(m,b),a=a||ca(m)});let l=t.syncPointTree_.get(i);l?(a=a||ca(l),r=r||Zr(l,Be())):(l=new Ej,t.syncPointTree_=t.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=ge.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((m,b)=>{const x=Zr(b,Be());x&&(r=r.updateImmediateChild(m,x))}));const u=Rj(l,e);if(!u&&!e._queryParams.loadsAllData()){const f=Np(e);te(!t.queryToTagMap.has(f),"View does not exist, but we have a tag");const m=HB();t.queryToTagMap.set(f,m),t.tagToQueryMap.set(m,f)}const d=_p(t.pendingWriteTree_,i);let h=CB(l,e,s,d,r,c);if(!u&&!a&&!n){const f=Cj(l,e);h=h.concat(GB(t,e,f))}return h}function kp(t,e,s){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(a,l)=>{const c=ks(a,e),u=Zr(l,c);if(u)return u});return _j(i,e,r,s,!0)}function FB(t,e){const s=e._path;let n=null;t.syncPointTree_.foreachOnPath(s,(u,d)=>{const h=ks(u,s);n=n||Zr(d,h)});let i=t.syncPointTree_.get(s);i?n=n||Zr(i,Be()):(i=new Ej,t.syncPointTree_=t.syncPointTree_.set(s,i));const r=n!=null,a=r?new la(n,!0,!1):null,l=_p(t.pendingWriteTree_,e._path),c=Aj(i,e,l,r?a.getNode():ge.EMPTY_NODE,r);return kB(c)}function bc(t,e){return Oj(e,t.syncPointTree_,null,_p(t.pendingWriteTree_,Be()))}function Oj(t,e,s,n){if(Te(t.path))return Mj(t,e,s,n);{const i=e.get(Be());s==null&&i!=null&&(s=Zr(i,Be()));let r=[];const a=Ne(t.path),l=t.operationForChild(a),c=e.children.get(a);if(c&&l){const u=s?s.getImmediateChild(a):null,d=wj(n,a);r=r.concat(Oj(l,c,u,d))}return i&&(r=r.concat(vy(i,t,n,s))),r}}function Mj(t,e,s,n){const i=e.get(Be());s==null&&i!=null&&(s=Zr(i,Be()));let r=[];return e.children.inorderTraversal((a,l)=>{const c=s?s.getImmediateChild(a):null,u=wj(n,a),d=t.operationForChild(a);d&&(r=r.concat(Mj(d,l,c,u)))}),i&&(r=r.concat(vy(i,t,n,s))),r}function Dj(t,e){const s=e.query,n=sd(t,s);return{hashFn:()=>(wB(e)||ge.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return n?VB(t,s._path,n):PB(t,s._path);{const r=L8(i,s);return gm(t,s,null,r)}}}}function sd(t,e){const s=Np(e);return t.queryToTagMap.get(s)}function Np(t){return t._path.toString()+"$"+t._queryIdentifier}function _y(t,e){return t.tagToQueryMap.get(e)}function wy(t){const e=t.indexOf("$");return te(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new Je(t.substr(0,e))}}function ky(t,e,s){const n=t.syncPointTree_.get(e);te(n,"Missing sync point for query tag that we're tracking");const i=_p(t.pendingWriteTree_,e);return vy(n,s,i,null)}function UB(t){return t.fold((e,s,n)=>{if(s&&ca(s))return[wp(s)];{let i=[];return s&&(i=jj(s)),ls(n,(r,a)=>{i=i.concat(a)}),i}})}function wu(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(OB())(t._repo,t._path):t}function $B(t,e){for(let s=0;s<e.length;++s){const n=e[s];if(!n._queryParams.loadsAllData()){const i=Np(n),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function HB(){return MB++}function GB(t,e,s){const n=e._path,i=sd(t,e),r=Dj(t,s),a=t.listenProvider_.startListening(wu(e),i,r.hashFn,r.onComplete),l=t.syncPointTree_.subtree(n);if(i)te(!ca(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((u,d,h)=>{if(!Te(u)&&d&&ca(d))return[wp(d).query];{let f=[];return d&&(f=f.concat(jj(d).map(m=>m.query))),ls(h,(m,b)=>{f=f.concat(b)}),f}});for(let u=0;u<c.length;++u){const d=c[u];t.listenProvider_.stopListening(wu(d),sd(t,d))}}return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ny{constructor(e){this.node_=e}getImmediateChild(e){const s=this.node_.getImmediateChild(e);return new Ny(s)}node(){return this.node_}}class Sy{constructor(e,s){this.syncTree_=e,this.path_=s}getImmediateChild(e){const s=Nt(this.path_,e);return new Sy(this.syncTree_,s)}node(){return kp(this.syncTree_,this.path_)}}const zB=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},aN=function(t,e,s){if(!t||typeof t!="object")return t;if(te(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return qB(t[".sv"],e,s);if(typeof t[".sv"]=="object")return KB(t[".sv"],e);te(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},qB=function(t,e,s){switch(t){case"timestamp":return s.timestamp;default:te(!1,"Unexpected server value: "+t)}},KB=function(t,e,s){t.hasOwnProperty("increment")||te(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const n=t.increment;typeof n!="number"&&te(!1,"Unexpected increment value: "+n);const i=e.node();if(te(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return n;const a=i.getValue();return typeof a!="number"?n:a+n},Lj=function(t,e,s,n){return Ey(e,new Sy(s,t),n)},Ty=function(t,e,s){return Ey(t,new Ny(e),s)};function Ey(t,e,s){const n=t.getPriority().val(),i=aN(n,e.getImmediateChild(".priority"),s);let r;if(t.isLeafNode()){const a=t,l=aN(a.getValue(),e,s);return l!==a.getValue()||i!==a.getPriority().val()?new ts(l,kt(i)):t}else{const a=t;return r=a,i!==a.getPriority().val()&&(r=r.updatePriority(new ts(i))),a.forEachChild(yt,(l,c)=>{const u=Ey(c,e.getImmediateChild(l),s);u!==c&&(r=r.updateImmediateChild(l,u))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e="",s=null,n={children:{},childCount:0}){this.name=e,this.parent=s,this.node=n}}function Sp(t,e){let s=e instanceof Je?e:new Je(e),n=t,i=Ne(s);for(;i!==null;){const r=uo(n.node.children,i)||{children:{},childCount:0};n=new Ay(i,n,r),s=at(s),i=Ne(s)}return n}function jo(t){return t.node.value}function jy(t,e){t.node.value=e,qx(t)}function Pj(t){return t.node.childCount>0}function WB(t){return jo(t)===void 0&&!Pj(t)}function Tp(t,e){ls(t.node.children,(s,n)=>{e(new Ay(s,t,n))})}function Vj(t,e,s,n){s&&e(t),Tp(t,i=>{Vj(i,e,!0)})}function YB(t,e,s){let n=t.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function $d(t){return new Je(t.parent===null?t.name:$d(t.parent)+"/"+t.name)}function qx(t){t.parent!==null&&XB(t.parent,t.name,t)}function XB(t,e,s){const n=WB(s),i=Qn(t.node.children,e);n&&i?(delete t.node.children[e],t.node.childCount--,qx(t)):!n&&!i&&(t.node.children[e]=s.node,t.node.childCount++,qx(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QB=/[\[\].#$\/\u0000-\u001F\u007F]/,JB=/[\[\].#$\u0000-\u001F\u007F]/,ng=10*1024*1024,Cy=function(t){return typeof t=="string"&&t.length!==0&&!QB.test(t)},Bj=function(t){return typeof t=="string"&&t.length!==0&&!JB.test(t)},ZB=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Bj(t)},Ry=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!bp(t)||t&&typeof t=="object"&&Qn(t,".sv")},xm=function(t,e,s,n){n&&e===void 0||Hd(Ul(t,"value"),e,s)},Hd=function(t,e,s){const n=s instanceof Je?new gV(s,t):s;if(e===void 0)throw new Error(t+"contains undefined "+Ba(n));if(typeof e=="function")throw new Error(t+"contains a function "+Ba(n)+" with contents = "+e.toString());if(bp(e))throw new Error(t+"contains "+e.toString()+" "+Ba(n));if(typeof e=="string"&&e.length>ng/3&&mp(e)>ng)throw new Error(t+"contains a string greater than "+ng+" utf8 bytes "+Ba(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(ls(e,(a,l)=>{if(a===".value")i=!0;else if(a!==".priority"&&a!==".sv"&&(r=!0,!Cy(a)))throw new Error(t+" contains an invalid key ("+a+") "+Ba(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xV(n,a),Hd(t,l,n),bV(n)}),i&&r)throw new Error(t+' contains ".value" child '+Ba(n)+" in addition to actual children.")}},eF=function(t,e){let s,n;for(s=0;s<e.length;s++){n=e[s];const r=Qu(n);for(let a=0;a<r.length;a++)if(!(r[a]===".priority"&&a===r.length-1)){if(!Cy(r[a]))throw new Error(t+"contains an invalid key ("+r[a]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(pV);let i=null;for(s=0;s<e.length;s++){if(n=e[s],i!==null&&bn(i,n))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+n.toString());i=n}},Fj=function(t,e,s,n){const i=Ul(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];ls(e,(a,l)=>{const c=new Je(a);if(Hd(i,l,Nt(s,c)),ay(c)===".priority"&&!Ry(l))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),eF(i,r)},tF=function(t,e,s){if(bp(e))throw new Error(Ul(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ry(e))throw new Error(Ul(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Uj=function(t,e,s,n){if(!Bj(s))throw new Error(Ul(t,e)+'was an invalid path = "'+s+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},sF=function(t,e,s,n){s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),Uj(t,e,s)},Vr=function(t,e){if(Ne(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},nF=function(t,e){const s=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Cy(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||s.length!==0&&!ZB(s))throw new Error(Ul(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iF{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Ep(t,e){let s=null;for(let n=0;n<e.length;n++){const i=e[n],r=i.getPath();s!==null&&!oy(r,s.path)&&(t.eventLists_.push(s),s=null),s===null&&(s={events:[],path:r}),s.events.push(i)}s&&t.eventLists_.push(s)}function $j(t,e,s){Ep(t,s),Hj(t,n=>oy(n,e))}function cn(t,e,s){Ep(t,s),Hj(t,n=>bn(n,e)||bn(e,n))}function Hj(t,e){t.recursionDepth_++;let s=!0;for(let n=0;n<t.eventLists_.length;n++){const i=t.eventLists_[n];if(i){const r=i.path;e(r)?(rF(t.eventLists_[n]),t.eventLists_[n]=null):s=!1}}s&&(t.eventLists_=[]),t.recursionDepth_--}function rF(t){for(let e=0;e<t.events.length;e++){const s=t.events[e];if(s!==null){t.events[e]=null;const n=s.getEventRunner();bu&&rs("event: "+s.toString()),gc(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aF="repo_interrupt",oF=25;class lF{constructor(e,s,n,i){this.repoInfo_=e,this.forceRestClient_=s,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new iF,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=lm(),this.transactionQueueTree_=new Ay,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function cF(t,e,s){if(t.stats_=iy(t.repoInfo_),t.forceRestClient_||F8())t.server_=new om(t.repoInfo_,(n,i,r,a)=>{oN(t,n,i,r,a)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>lN(t,!0),0);else{if(typeof s<"u"&&s!==null){if(typeof s!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Qt(s)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}t.persistentConnection_=new $i(t.repoInfo_,e,(n,i,r,a)=>{oN(t,n,i,r,a)},n=>{lN(t,n)},n=>{uF(t,n)},t.authTokenProvider_,t.appCheckProvider_,s),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(n=>{t.server_.refreshAuthToken(n)}),t.appCheckProvider_.addTokenChangeListener(n=>{t.server_.refreshAppCheckToken(n.token)}),t.statsReporter_=z8(t.repoInfo_,()=>new zV(t.stats_,t.server_)),t.infoData_=new FV,t.infoSyncTree_=new rN({startListening:(n,i,r,a)=>{let l=[];const c=t.infoData_.getNode(n._path);return c.isEmpty()||(l=Ud(t.infoSyncTree_,n._path,c),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),Iy(t,"connected",!1),t.serverSyncTree_=new rN({startListening:(n,i,r,a)=>(t.server_.listen(n,r,i,(l,c)=>{const u=a(l,c);cn(t.eventQueue_,n._path,u)}),[]),stopListening:(n,i)=>{t.server_.unlisten(n,i)}})}function Gj(t){const s=t.infoData_.getNode(new Je(".info/serverTimeOffset")).val()||0;return new Date().getTime()+s}function Gd(t){return zB({timestamp:Gj(t)})}function oN(t,e,s,n,i){t.dataUpdateCount++;const r=new Je(e);s=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,s):s;let a=[];if(i)if(n){const c=Xf(s,u=>kt(u));a=BB(t.serverSyncTree_,r,c,i)}else{const c=kt(s);a=Ij(t.serverSyncTree_,r,c,i)}else if(n){const c=Xf(s,u=>kt(u));a=LB(t.serverSyncTree_,r,c)}else{const c=kt(s);a=Ud(t.serverSyncTree_,r,c)}let l=r;a.length>0&&(l=ql(t,r)),cn(t.eventQueue_,l,a)}function lN(t,e){Iy(t,"connected",e),e===!1&&mF(t)}function uF(t,e){ls(e,(s,n)=>{Iy(t,s,n)})}function Iy(t,e,s){const n=new Je("/.info/"+e),i=kt(s);t.infoData_.updateSnapshot(n,i);const r=Ud(t.infoSyncTree_,n,i);cn(t.eventQueue_,n,r)}function Ap(t){return t.nextWriteId_++}function dF(t,e,s){const n=FB(t.serverSyncTree_,e);return n!=null?Promise.resolve(n):t.server_.get(e).then(i=>{const r=kt(i).withIndex(e._queryParams.getIndex());zx(t.serverSyncTree_,e,s,!0);let a;if(e._queryParams.loadsAllData())a=Ud(t.serverSyncTree_,e._path,r);else{const l=sd(t.serverSyncTree_,e);a=Ij(t.serverSyncTree_,e._path,r,l)}return cn(t.eventQueue_,e._path,a),gm(t.serverSyncTree_,e,s,null,!0),r},i=>(vc(t,"get for query "+Qt(e)+" failed: "+i),Promise.reject(new Error(i))))}function hF(t,e,s,n,i){vc(t,"set",{path:e.toString(),value:s,priority:n});const r=Gd(t),a=kt(s,n),l=kp(t.serverSyncTree_,e),c=Ty(a,l,r),u=Ap(t),d=yy(t.serverSyncTree_,e,c,u,!0);Ep(t.eventQueue_,d),t.server_.put(e.toString(),a.val(!0),(f,m)=>{const b=f==="ok";b||Ts("set at "+e+" failed: "+f);const x=Pr(t.serverSyncTree_,u,!b);cn(t.eventQueue_,e,x),ua(t,i,f,m)});const h=My(t,e);ql(t,h),cn(t.eventQueue_,h,[])}function fF(t,e,s,n){vc(t,"update",{path:e.toString(),value:s});let i=!0;const r=Gd(t),a={};if(ls(s,(l,c)=>{i=!1,a[l]=Lj(Nt(e,l),kt(c),t.serverSyncTree_,r)}),i)rs("update() called with empty data.  Don't do anything."),ua(t,n,"ok",void 0);else{const l=Ap(t),c=DB(t.serverSyncTree_,e,a,l);Ep(t.eventQueue_,c),t.server_.merge(e.toString(),s,(u,d)=>{const h=u==="ok";h||Ts("update at "+e+" failed: "+u);const f=Pr(t.serverSyncTree_,l,!h),m=f.length>0?ql(t,e):e;cn(t.eventQueue_,m,f),ua(t,n,u,d)}),ls(s,u=>{const d=My(t,Nt(e,u));ql(t,d)}),cn(t.eventQueue_,e,[])}}function mF(t){vc(t,"onDisconnectEvents");const e=Gd(t),s=lm();Vx(t.onDisconnect_,Be(),(i,r)=>{const a=Lj(i,r,t.serverSyncTree_,e);xc(s,i,a)});let n=[];Vx(s,Be(),(i,r)=>{n=n.concat(Ud(t.serverSyncTree_,i,r));const a=My(t,i);ql(t,a)}),t.onDisconnect_=lm(),cn(t.eventQueue_,Be(),n)}function pF(t,e,s){t.server_.onDisconnectCancel(e.toString(),(n,i)=>{n==="ok"&&Px(t.onDisconnect_,e),ua(t,s,n,i)})}function cN(t,e,s,n){const i=kt(s);t.server_.onDisconnectPut(e.toString(),i.val(!0),(r,a)=>{r==="ok"&&xc(t.onDisconnect_,e,i),ua(t,n,r,a)})}function gF(t,e,s,n,i){const r=kt(s,n);t.server_.onDisconnectPut(e.toString(),r.val(!0),(a,l)=>{a==="ok"&&xc(t.onDisconnect_,e,r),ua(t,i,a,l)})}function xF(t,e,s,n){if(Yf(s)){rs("onDisconnect().update() called with empty data.  Don't do anything."),ua(t,n,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),s,(i,r)=>{i==="ok"&&ls(s,(a,l)=>{const c=kt(l);xc(t.onDisconnect_,Nt(e,a),c)}),ua(t,n,i,r)})}function bF(t,e,s){let n;Ne(e._path)===".info"?n=zx(t.infoSyncTree_,e,s):n=zx(t.serverSyncTree_,e,s),$j(t.eventQueue_,e._path,n)}function uN(t,e,s){let n;Ne(e._path)===".info"?n=gm(t.infoSyncTree_,e,s):n=gm(t.serverSyncTree_,e,s),$j(t.eventQueue_,e._path,n)}function vF(t){t.persistentConnection_&&t.persistentConnection_.interrupt(aF)}function vc(t,...e){let s="";t.persistentConnection_&&(s=t.persistentConnection_.id+":"),rs(s,...e)}function ua(t,e,s,n){e&&gc(()=>{if(s==="ok")e(null);else{const i=(s||"error").toUpperCase();let r=i;n&&(r+=": "+n);const a=new Error(r);a.code=i,e(a)}})}function yF(t,e,s,n,i,r){vc(t,"transaction on "+e);const a={path:e,update:s,onComplete:n,status:null,order:$5(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=Oy(t,e,void 0);a.currentInputSnapshot=l;const c=a.update(l.val());if(c===void 0)a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot);else{Hd("transaction failed: Data returned ",c,a.path),a.status=0;const u=Sp(t.transactionQueueTree_,e),d=jo(u)||[];d.push(a),jy(u,d);let h;typeof c=="object"&&c!==null&&Qn(c,".priority")?(h=uo(c,".priority"),te(Ry(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(kp(t.serverSyncTree_,e)||ge.EMPTY_NODE).getPriority().val();const f=Gd(t),m=kt(c,h),b=Ty(m,l,f);a.currentOutputSnapshotRaw=m,a.currentOutputSnapshotResolved=b,a.currentWriteId=Ap(t);const x=yy(t.serverSyncTree_,e,b,a.currentWriteId,a.applyLocally);cn(t.eventQueue_,e,x),jp(t,t.transactionQueueTree_)}}function Oy(t,e,s){return kp(t.serverSyncTree_,e,s)||ge.EMPTY_NODE}function jp(t,e=t.transactionQueueTree_){if(e||Cp(t,e),jo(e)){const s=qj(t,e);te(s.length>0,"Sending zero length transaction queue"),s.every(i=>i.status===0)&&_F(t,$d(e),s)}else Pj(e)&&Tp(e,s=>{jp(t,s)})}function _F(t,e,s){const n=s.map(u=>u.currentWriteId),i=Oy(t,e,n);let r=i;const a=i.hash();for(let u=0;u<s.length;u++){const d=s[u];te(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=ks(e,d.path);r=r.updateChild(h,d.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;t.server_.put(c.toString(),l,u=>{vc(t,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){const h=[];for(let f=0;f<s.length;f++)s[f].status=2,d=d.concat(Pr(t.serverSyncTree_,s[f].currentWriteId)),s[f].onComplete&&h.push(()=>s[f].onComplete(null,!0,s[f].currentOutputSnapshotResolved)),s[f].unwatcher();Cp(t,Sp(t.transactionQueueTree_,e)),jp(t,t.transactionQueueTree_),cn(t.eventQueue_,e,d);for(let f=0;f<h.length;f++)gc(h[f])}else{if(u==="datastale")for(let h=0;h<s.length;h++)s[h].status===3?s[h].status=4:s[h].status=0;else{Ts("transaction at "+c.toString()+" failed: "+u);for(let h=0;h<s.length;h++)s[h].status=4,s[h].abortReason=u}ql(t,e)}},a)}function ql(t,e){const s=zj(t,e),n=$d(s),i=qj(t,s);return wF(t,i,n),n}function wF(t,e,s){if(e.length===0)return;const n=[];let i=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],u=ks(s,c.path);let d=!1,h;if(te(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,i=i.concat(Pr(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=oF)d=!0,h="maxretry",i=i.concat(Pr(t.serverSyncTree_,c.currentWriteId,!0));else{const f=Oy(t,c.path,a);c.currentInputSnapshot=f;const m=e[l].update(f.val());if(m!==void 0){Hd("transaction failed: Data returned ",m,c.path);let b=kt(m);typeof m=="object"&&m!=null&&Qn(m,".priority")||(b=b.updatePriority(f.getPriority()));const v=c.currentWriteId,g=Gd(t),p=Ty(b,f,g);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=p,c.currentWriteId=Ap(t),a.splice(a.indexOf(v),1),i=i.concat(yy(t.serverSyncTree_,c.path,p,c.currentWriteId,c.applyLocally)),i=i.concat(Pr(t.serverSyncTree_,v,!0))}else d=!0,h="nodata",i=i.concat(Pr(t.serverSyncTree_,c.currentWriteId,!0))}cn(t.eventQueue_,s,i),i=[],d&&(e[l].status=2,function(f){setTimeout(f,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?n.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):n.push(()=>e[l].onComplete(new Error(h),!1,null))))}Cp(t,t.transactionQueueTree_);for(let l=0;l<n.length;l++)gc(n[l]);jp(t,t.transactionQueueTree_)}function zj(t,e){let s,n=t.transactionQueueTree_;for(s=Ne(e);s!==null&&jo(n)===void 0;)n=Sp(n,s),e=at(e),s=Ne(e);return n}function qj(t,e){const s=[];return Kj(t,e,s),s.sort((n,i)=>n.order-i.order),s}function Kj(t,e,s){const n=jo(e);if(n)for(let i=0;i<n.length;i++)s.push(n[i]);Tp(e,i=>{Kj(t,i,s)})}function Cp(t,e){const s=jo(e);if(s){let n=0;for(let i=0;i<s.length;i++)s[i].status!==2&&(s[n]=s[i],n++);s.length=n,jy(e,s.length>0?s:void 0)}Tp(e,n=>{Cp(t,n)})}function My(t,e){const s=$d(zj(t,e)),n=Sp(t.transactionQueueTree_,e);return YB(n,i=>{ig(t,i)}),ig(t,n),Vj(n,i=>{ig(t,i)}),s}function ig(t,e){const s=jo(e);if(s){const n=[];let i=[],r=-1;for(let a=0;a<s.length;a++)s[a].status===3||(s[a].status===1?(te(r===a-1,"All SENT items should be at beginning of queue."),r=a,s[a].status=3,s[a].abortReason="set"):(te(s[a].status===0,"Unexpected transaction status in abort"),s[a].unwatcher(),i=i.concat(Pr(t.serverSyncTree_,s[a].currentWriteId,!0)),s[a].onComplete&&n.push(s[a].onComplete.bind(null,new Error("set"),!1,null))));r===-1?jy(e,void 0):s.length=r+1,cn(t.eventQueue_,$d(e),i);for(let a=0;a<n.length;a++)gc(n[a])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kF(t){let e="";const s=t.split("/");for(let n=0;n<s.length;n++)if(s[n].length>0){let i=s[n];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function NF(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const s of t.split("&")){if(s.length===0)continue;const n=s.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):Ts(`Invalid query segment '${s}' in query '${t}'`)}return e}const dN=function(t,e){const s=SF(t),n=s.namespace;s.domain==="firebase.com"&&er(s.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&s.domain!=="localhost"&&er("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),s.secure||R8();const i=s.scheme==="ws"||s.scheme==="wss";return{repoInfo:new tj(s.host,s.secure,n,i,e,"",n!==s.subdomain),path:new Je(s.pathString)}},SF=function(t){let e="",s="",n="",i="",r="",a=!0,l="https",c=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(l=t.substring(0,u-1),t=t.substring(u+2));let d=t.indexOf("/");d===-1&&(d=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(d,h)),d<h&&(i=kF(t.substring(d,h)));const f=NF(t.substring(Math.min(t.length,h)));u=e.indexOf(":"),u>=0?(a=l==="https"||l==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;const m=e.slice(0,u);if(m.toLowerCase()==="localhost")s="localhost";else if(m.split(".").length<=2)s=m;else{const b=e.indexOf(".");n=e.substring(0,b).toLowerCase(),s=e.substring(b+1),r=n}"ns"in f&&(r=f.ns)}return{host:e,port:c,domain:s,subdomain:n,secure:a,scheme:l,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hN="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",TF=function(){let t=0;const e=[];return function(s){const n=s===t;t=s;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=hN.charAt(s%64),s=Math.floor(s/64);te(s===0,"Cannot push at time == 0");let a=r.join("");if(n){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)a+=hN.charAt(e[i]);return te(a.length===20,"nextPushId: Length should be 20."),a}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EF{constructor(e,s,n,i){this.eventType=e,this.eventRegistration=s,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Qt(this.snapshot.exportVal())}}class AF{constructor(e,s,n){this.eventRegistration=e,this.error=s,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(e,s){this.snapshotCallback=e,this.cancelCallback=s}onValue(e,s){this.snapshotCallback.call(null,e,s)}onCancel(e){return te(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(e,s){this._repo=e,this._path=s}cancel(){const e=new Ln;return pF(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Vr("OnDisconnect.remove",this._path);const e=new Ln;return cN(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Vr("OnDisconnect.set",this._path),xm("OnDisconnect.set",e,this._path,!1);const s=new Ln;return cN(this._repo,this._path,e,s.wrapCallback(()=>{})),s.promise}setWithPriority(e,s){Vr("OnDisconnect.setWithPriority",this._path),xm("OnDisconnect.setWithPriority",e,this._path,!1),tF("OnDisconnect.setWithPriority",s);const n=new Ln;return gF(this._repo,this._path,e,s,n.wrapCallback(()=>{})),n.promise}update(e){Vr("OnDisconnect.update",this._path),Fj("OnDisconnect.update",e,this._path);const s=new Ln;return xF(this._repo,this._path,e,s.wrapCallback(()=>{})),s.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,s,n,i){this._repo=e,this._path=s,this._queryParams=n,this._orderByCalled=i}get key(){return Te(this._path)?null:ay(this._path)}get ref(){return new pi(this._repo,this._path)}get _queryIdentifier(){const e=Yk(this._queryParams),s=sy(e);return s==="{}"?"default":s}get _queryObject(){return Yk(this._queryParams)}isEqual(e){if(e=Kt(e),!(e instanceof Rp))return!1;const s=this._repo===e._repo,n=oy(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return s&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+mV(this._path)}}class pi extends Rp{constructor(e,s){super(e,s,new dy,!1)}get parent(){const e=uj(this._path);return e===null?null:new pi(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Kl{constructor(e,s,n){this._node=e,this.ref=s,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const s=new Je(e),n=nd(this.ref,e);return new Kl(this._node.getChild(s),n,yt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,i)=>e(new Kl(i,nd(this.ref,n),yt)))}hasChild(e){const s=new Je(e);return!this._node.getChild(s).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function z(t,e){return t=Kt(t),t._checkNotDeleted("ref"),e!==void 0?nd(t._root,e):t._root}function nd(t,e){return t=Kt(t),Ne(t._path)===null?sF("child","path",e):Uj("child","path",e),new pi(t._repo,Nt(t._path,e))}function fN(t){return t=Kt(t),new jF(t._repo,t._path)}function Dy(t,e){t=Kt(t),Vr("push",t._path),xm("push",e,t._path,!0);const s=Gj(t._repo),n=TF(s),i=nd(t,n),r=nd(t,n);let a;return e!=null?a=da(r,e).then(()=>r):a=Promise.resolve(r),i.then=a.then.bind(a),i.catch=a.then.bind(a,void 0),i}function mN(t){return Vr("remove",t._path),da(t,null)}function da(t,e){t=Kt(t),Vr("set",t._path),xm("set",e,t._path,!1);const s=new Ln;return hF(t._repo,t._path,e,null,s.wrapCallback(()=>{})),s.promise}function oe(t,e){Fj("update",e,t._path);const s=new Ln;return fF(t._repo,t._path,e,s.wrapCallback(()=>{})),s.promise}function ve(t){t=Kt(t);const e=new Wj(()=>{}),s=new Ip(e);return dF(t._repo,t,s).then(n=>new Kl(n,new pi(t._repo,t._path),t._queryParams.getIndex()))}class Ip{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,s){const n=s._queryParams.getIndex();return new EF("value",this,new Kl(e.snapshotNode,new pi(s._repo,s._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,s){return this.callbackContext.hasCancelCallback?new AF(this,e,s):null}matches(e){return e instanceof Ip?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function CF(t,e,s,n,i){let r;if(typeof n=="object"&&(r=void 0,i=n),typeof n=="function"&&(r=n),i&&i.onlyOnce){const c=s,u=(d,h)=>{uN(t._repo,t,l),c(d,h)};u.userCallback=s.userCallback,u.context=s.context,s=u}const a=new Wj(s,r||void 0),l=new Ip(a);return bF(t._repo,t,l),()=>uN(t._repo,t,l)}function tt(t,e,s,n){return CF(t,"value",e,s,n)}class RF{}class IF extends RF{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Rp(e._repo,e._path,BV(e._queryParams,this._limit),e._orderByCalled)}}function OF(t){if(Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new IF(t)}function MF(t,...e){let s=Kt(t);for(const n of e)s=n._apply(s);return s}EB(pi);IB(pi);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DF="FIREBASE_DATABASE_EMULATOR_HOST",Kx={};let LF=!1;function PF(t,e,s,n){const i=e.lastIndexOf(":"),r=e.substring(0,i),a=fc(r);t.repoInfo_=new tj(e,a,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,s),n&&(t.authTokenProvider_=n)}function VF(t,e,s,n,i){let r=n||t.options.databaseURL;r===void 0&&(t.options.projectId||er("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),rs("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let a=dN(r,i),l=a.repoInfo,c;typeof process<"u"&&Rk&&(c=Rk[DF]),c?(r=`http://${c}?ns=${l.namespace}`,a=dN(r,i),l=a.repoInfo):a.repoInfo.secure;const u=new $8(t.name,t.options,e);nF("Invalid Firebase Database URL",a),Te(a.path)||er("Database URL must point to the root of a Firebase Database (not including a child path).");const d=FF(l,t,u,new U8(t,s));return new UF(d,t)}function BF(t,e){const s=Kx[e];(!s||s[t.key]!==t)&&er(`Database ${e}(${t.repoInfo_}) has already been deleted.`),vF(t),delete s[t.key]}function FF(t,e,s,n){let i=Kx[e.name];i||(i={},Kx[e.name]=i);let r=i[t.toURLString()];return r&&er("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new lF(t,LF,s,n),i[t.toURLString()]=r,r}class UF{constructor(e,s){this._repoInternal=e,this.app=s,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(cF(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pi(this._repo,Be())),this._rootInternal}_delete(){return this._rootInternal!==null&&(BF(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&er("Cannot call "+e+" on a deleted database.")}}function $F(t=t5(),e){const s=qv(t,"database").getImmediate({identifier:e});if(!s._instanceStarted){const n=I3("database");n&&HF(s,...n)}return s}function HF(t,e,s,n={}){t=Kt(t),t._checkNotDeleted("useEmulator");const i=`${e}:${s}`,r=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&ho(n,r.repoInfo_.emulatorOptions))return;er("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let a;if(r.repoInfo_.nodeAdmin)n.mockUserToken&&er('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new uf(uf.OWNER);else if(n.mockUserToken){const l=typeof n.mockUserToken=="string"?n.mockUserToken:O3(n.mockUserToken,t.app.options.projectId);a=new uf(l)}fc(e)&&(WA(e),YA("Database",!0)),PF(r,i,n,a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GF(t){T8(pc),$l(new fo("database",(e,{instanceIdentifier:s})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return VF(n,i,r,s)},"PUBLIC").setMultipleInstances(!0)),Qr(Ik,Ok,t),Qr(Ik,Ok,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zF={".sv":"timestamp"};function qF(){return zF}function Yj(t){return{".sv":{increment:t}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KF{constructor(e,s){this.committed=e,this.snapshot=s}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function Pe(t,e,s){var n;if(t=Kt(t),Vr("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";const i=(n=void 0)!==null&&n!==void 0?n:!0,r=new Ln,a=(c,u,d)=>{let h=null;c?r.reject(c):(h=new Kl(d,new pi(t._repo,t._path),yt),r.resolve(new KF(u,h)))},l=tt(t,()=>{});return yF(t._repo,t._path,e,a,l,i),r.promise}$i.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};$i.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};GF();var WF="firebase",YF="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qr(WF,YF,"app");const XF={apiKey:"AIzaSyBU11CvtAaUkADomFxcMuN6fH9ipx-VtAs",authDomain:"eiriksbok-simuleringfeudal.firebaseapp.com",databaseURL:"https://eiriksbok-simuleringfeudal-default-rtdb.europe-west1.firebasedatabase.app",projectId:"eiriksbok-simuleringfeudal",storageBucket:"eiriksbok-simuleringfeudal.firebasestorage.app",messagingSenderId:"772081963542",appId:"1:772081963542:web:05edb87535f629fd36db37",measurementId:"G-NDR8LNVQNX"},Xj=e5(XF,"simulationApp"),q=$F(Xj),Po=N8(Xj),Qj=N.createContext(void 0),QF=({children:t})=>{const[e,s]=N.useState(null),[n,i]=N.useState(null),[r,a]=N.useState(!0),[l,c]=N.useState(null),[u,d]=N.useState(!0);N.useEffect(()=>{const v=h6(Po,async g=>{if(g){s(g),d(g.isAnonymous);const p=z(q,`simulation_accounts/${g.uid}`),y=tt(p,async k=>{if(k.exists())i(k.val()),a(!1);else{const w={uid:g.uid,displayName:g.displayName||`Eventyrer_${g.uid.slice(0,4)}`,globalXp:0,globalLevel:1,totalGoldEarned:0,unlockedAchievements:[],characterHistory:[],lastActive:Date.now()};await da(p,w),i(w),a(!1)}});return()=>y()}else{d(!0);try{await t6(Po)}catch(p){console.error("Auth failed:",p),a(!1)}}});return()=>v()},[]);const h=async(v,g)=>{c(null);try{await c6(Po,v,g)}catch(p){throw c(p.message),p}},f=async v=>{const g=v.trim().toLowerCase();if(!g||g.length<3)return!1;const p=z(q,`simulation_reserved_names/${g}`);return!(await ve(p)).exists()},m=async(v,g,p)=>{c(null);const y=p.trim(),k=y.toLowerCase();try{if(!await f(y))throw new Error("Navnet er allerede tatt.");if(e&&e.isAnonymous){const S=To.credential(v,g);await a6(e,S);const _={};_[`simulation_accounts/${e.uid}/displayName`]=y,_[`simulation_reserved_names/${k}`]=e.uid,await oe(z(q),_)}else{const S=await l6(Po,v,g),_={};_[`simulation_reserved_names/${k}`]=S.user.uid;const T={uid:S.user.uid,displayName:y,globalXp:0,globalLevel:1,totalGoldEarned:0,unlockedAchievements:[],characterHistory:[],lastActive:Date.now()};_[`simulation_accounts/${S.user.uid}`]=T,await oe(z(q),_)}}catch(w){throw c(w.message),w}},b=async()=>{await f6(Po)},x=async v=>{try{await o6(Po,v)}catch(g){throw c(g.message),g}};return o.jsx(Qj.Provider,{value:{user:e,account:n,loading:r,isAnonymous:u,error:l,login:h,register:m,logout:b,resetPassword:x,checkNameAvailability:f},children:t})},yc=()=>{const t=N.useContext(Qj);if(!t)throw new Error("useSimulationAuth must be used within a SimulationAuthProvider");return t},Jj="15.1.22",pN=(t,e,s)=>({endTime:e,insertTime:s,type:"exponentialRampToValue",value:t}),gN=(t,e,s)=>({endTime:e,insertTime:s,type:"linearRampToValue",value:t}),Wx=(t,e)=>({startTime:e,type:"setValue",value:t}),Zj=(t,e,s)=>({duration:s,startTime:e,type:"setValueCurve",values:t}),eC=(t,e,{startTime:s,target:n,timeConstant:i})=>n+(e-n)*Math.exp((s-t)/i),il=t=>t.type==="exponentialRampToValue",bm=t=>t.type==="linearRampToValue",wr=t=>il(t)||bm(t),Ly=t=>t.type==="setValue",Ai=t=>t.type==="setValueCurve",vm=(t,e,s,n)=>{const i=t[e];return i===void 0?n:wr(i)||Ly(i)?i.value:Ai(i)?i.values[i.values.length-1]:eC(s,vm(t,e-1,i.startTime,n),i)},xN=(t,e,s,n,i)=>s===void 0?[n.insertTime,i]:wr(s)?[s.endTime,s.value]:Ly(s)?[s.startTime,s.value]:Ai(s)?[s.startTime+s.duration,s.values[s.values.length-1]]:[s.startTime,vm(t,e-1,s.startTime,i)],Yx=t=>t.type==="cancelAndHold",Xx=t=>t.type==="cancelScheduledValues",xr=t=>Yx(t)||Xx(t)?t.cancelTime:il(t)||bm(t)?t.endTime:t.startTime,bN=(t,e,s,{endTime:n,value:i})=>s===i?i:0<s&&0<i||s<0&&i<0?s*(i/s)**((t-e)/(n-e)):0,vN=(t,e,s,{endTime:n,value:i})=>s+(t-e)/(n-e)*(i-s),JF=(t,e)=>{const s=Math.floor(e),n=Math.ceil(e);return s===n?t[s]:(1-(e-s))*t[s]+(1-(n-e))*t[n]},ZF=(t,{duration:e,startTime:s,values:n})=>{const i=(t-s)/e*(n.length-1);return JF(n,i)},Ih=t=>t.type==="setTarget";class eU{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(e){const s=xr(e);if(Yx(e)||Xx(e)){const n=this._automationEvents.findIndex(r=>Xx(e)&&Ai(r)?r.startTime+r.duration>=s:xr(r)>=s),i=this._automationEvents[n];if(n!==-1&&(this._automationEvents=this._automationEvents.slice(0,n)),Yx(e)){const r=this._automationEvents[this._automationEvents.length-1];if(i!==void 0&&wr(i)){if(r!==void 0&&Ih(r))throw new Error("The internal list is malformed.");const a=r===void 0?i.insertTime:Ai(r)?r.startTime+r.duration:xr(r),l=r===void 0?this._defaultValue:Ai(r)?r.values[r.values.length-1]:r.value,c=il(i)?bN(s,a,l,i):vN(s,a,l,i),u=il(i)?pN(c,s,this._currenTime):gN(c,s,this._currenTime);this._automationEvents.push(u)}if(r!==void 0&&Ih(r)&&this._automationEvents.push(Wx(this.getValue(s),s)),r!==void 0&&Ai(r)&&r.startTime+r.duration>s){const a=s-r.startTime,l=(r.values.length-1)/r.duration,c=Math.max(2,1+Math.ceil(a*l)),u=a/(c-1)*l,d=r.values.slice(0,c);if(u<1)for(let h=1;h<c;h+=1){const f=u*h%1;d[h]=r.values[h-1]*(1-f)+r.values[h]*f}this._automationEvents[this._automationEvents.length-1]=Zj(d,r.startTime,a)}}}else{const n=this._automationEvents.findIndex(a=>xr(a)>s),i=n===-1?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(i!==void 0&&Ai(i)&&xr(i)+i.duration>s)return!1;const r=il(e)?pN(e.value,e.endTime,this._currenTime):bm(e)?gN(e.value,s,this._currenTime):e;if(n===-1)this._automationEvents.push(r);else{if(Ai(e)&&s+e.duration>xr(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,r)}}return!0}flush(e){const s=this._automationEvents.findIndex(n=>xr(n)>e);if(s>1){const n=this._automationEvents.slice(s-1),i=n[0];Ih(i)&&n.unshift(Wx(vm(this._automationEvents,s-2,i.startTime,this._defaultValue),i.startTime)),this._automationEvents=n}}getValue(e){if(this._automationEvents.length===0)return this._defaultValue;const s=this._automationEvents.findIndex(a=>xr(a)>e),n=this._automationEvents[s],i=(s===-1?this._automationEvents.length:s)-1,r=this._automationEvents[i];if(r!==void 0&&Ih(r)&&(n===void 0||!wr(n)||n.insertTime>e))return eC(e,vm(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(r!==void 0&&Ly(r)&&(n===void 0||!wr(n)))return r.value;if(r!==void 0&&Ai(r)&&(n===void 0||!wr(n)||r.startTime+r.duration>e))return e<r.startTime+r.duration?ZF(e,r):r.values[r.values.length-1];if(r!==void 0&&wr(r)&&(n===void 0||!wr(n)))return r.value;if(n!==void 0&&il(n)){const[a,l]=xN(this._automationEvents,i,r,n,this._defaultValue);return bN(e,a,l,n)}if(n!==void 0&&bm(n)){const[a,l]=xN(this._automationEvents,i,r,n,this._defaultValue);return vN(e,a,l,n)}return this._defaultValue}}const tU=t=>({cancelTime:t,type:"cancelAndHold"}),sU=t=>({cancelTime:t,type:"cancelScheduledValues"}),nU=(t,e)=>({endTime:e,type:"exponentialRampToValue",value:t}),iU=(t,e)=>({endTime:e,type:"linearRampToValue",value:t}),rU=(t,e,s)=>({startTime:e,target:t,timeConstant:s,type:"setTarget"}),aU=()=>new DOMException("","AbortError"),oU=t=>(e,s,[n,i,r],a)=>{t(e[i],[s,n,r],l=>l[0]===s&&l[1]===n,a)},lU=t=>(e,s,n)=>{const i=[];for(let r=0;r<n.numberOfInputs;r+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:s})},cU=t=>(e,s)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:s})},Wl=new WeakSet,tC=new WeakMap,Py=new WeakMap,sC=new WeakMap,Vy=new WeakMap,Op=new WeakMap,nC=new WeakMap,Qx=new WeakMap,Jx=new WeakMap,Zx=new WeakMap,iC={construct(){return iC}},uU=t=>{try{const e=new Proxy(t,iC);new e}catch{return!1}return!0},yN=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,_N=(t,e)=>{const s=[];let n=t.replace(/^[\s]+/,""),i=n.match(yN);for(;i!==null;){const r=i[1].slice(1,-1),a=i[0].replace(/([\s]+)?;?$/,"").replace(r,new URL(r,e).toString());s.push(a),n=n.slice(i[0].length).replace(/^[\s]+/,""),i=n.match(yN)}return[s.join(";"),n]},wN=t=>{if(t!==void 0&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},kN=t=>{if(!uU(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(t.prototype===null||typeof t.prototype!="object")throw new TypeError("The given value for processorCtor should have a prototype.")},dU=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>{let m=0;return(b,x,v={credentials:"omit"})=>{const g=d.get(b);if(g!==void 0&&g.has(x))return Promise.resolve();const p=u.get(b);if(p!==void 0){const w=p.get(x);if(w!==void 0)return w}const y=r(b),k=y.audioWorklet===void 0?i(x).then(([w,S])=>{const[_,T]=_N(w,S),E=`${_};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${T}
})})(window,'_AWGS')`;return s(E)}).then(()=>{const w=f._AWGS.pop();if(w===void 0)throw new SyntaxError;n(y.currentTime,y.sampleRate,()=>w(class{},void 0,(S,_)=>{if(S.trim()==="")throw e();const T=Jx.get(y);if(T!==void 0){if(T.has(S))throw e();kN(_),wN(_.parameterDescriptors),T.set(S,_)}else kN(_),wN(_.parameterDescriptors),Jx.set(y,new Map([[S,_]]))},y.sampleRate,void 0,void 0))}):Promise.all([i(x),Promise.resolve(t(h,h))]).then(([[w,S],_])=>{const T=m+1;m=T;const[E,A]=_N(w,S),G=`${E};((AudioWorkletProcessor,registerProcessor)=>{${A}
})(${_?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${_?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${_?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${T}',class extends AudioWorkletProcessor{process(){return !1}})`,L=new Blob([G],{type:"application/javascript; charset=utf-8"}),M=URL.createObjectURL(L);return y.audioWorklet.addModule(M,v).then(()=>{if(l(y))return y;const D=a(y);return D.audioWorklet.addModule(M,v).then(()=>D)}).then(D=>{if(c===null)throw new SyntaxError;try{new c(D,`__sac${T}`)}catch{throw new SyntaxError}}).finally(()=>URL.revokeObjectURL(M))});return p===void 0?u.set(b,new Map([[x,k]])):p.set(x,k),k.then(()=>{const w=d.get(b);w===void 0?d.set(b,new Set([x])):w.add(x)}).finally(()=>{const w=u.get(b);w!==void 0&&w.delete(x)}),k}},Kn=(t,e)=>{const s=t.get(e);if(s===void 0)throw new Error("A value with the given key could not be found.");return s},Mp=(t,e)=>{const s=Array.from(t).filter(e);if(s.length>1)throw Error("More than one element was found.");if(s.length===0)throw Error("No element was found.");const[n]=s;return t.delete(n),n},rC=(t,e,s,n)=>{const i=Kn(t,e),r=Mp(i,a=>a[0]===s&&a[1]===n);return i.size===0&&t.delete(e),r},zd=t=>Kn(nC,t),Yl=t=>{if(Wl.has(t))throw new Error("The AudioNode is already stored.");Wl.add(t),zd(t).forEach(e=>e(!0))},aC=t=>"port"in t,qd=t=>{if(!Wl.has(t))throw new Error("The AudioNode is not stored.");Wl.delete(t),zd(t).forEach(e=>e(!1))},eb=(t,e)=>{!aC(t)&&e.every(s=>s.size===0)&&qd(t)},hU=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>{const m=new WeakMap;return(b,x,v,g,p)=>{const{activeInputs:y,passiveInputs:k}=r(x),{outputs:w}=r(b),S=l(b),_=T=>{const E=c(x),A=c(b);if(T){const j=rC(k,b,v,g);t(y,b,j,!1),!p&&!h(b)&&s(A,E,v,g),f(x)&&Yl(x)}else{const j=n(y,b,v,g);e(k,g,j,!1),!p&&!h(b)&&i(A,E,v,g);const O=a(x);if(O===0)d(x)&&eb(x,y);else{const H=m.get(x);H!==void 0&&clearTimeout(H),m.set(x,setTimeout(()=>{d(x)&&eb(x,y)},O*1e3))}}};return u(w,[x,v,g],T=>T[0]===x&&T[1]===v&&T[2]===g,!0)?(S.add(_),d(b)?t(y,b,[v,g,_],!0):e(k,g,[b,v,_],!0),!0):!1}},fU=t=>(e,s,[n,i,r],a)=>{const l=e.get(n);l===void 0?e.set(n,new Set([[i,s,r]])):t(l,[i,s,r],c=>c[0]===i&&c[1]===s,a)},mU=t=>(e,s)=>{const n=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.connect(n).connect(e.destination);const i=()=>{s.removeEventListener("ended",i),s.disconnect(n),n.disconnect()};s.addEventListener("ended",i)},pU=t=>(e,s)=>{t(e).add(s)},gU={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},xU=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...gU,...c},h=n(u,d),f=r(u)?e():null;super(l,!1,h,f),this._nativeAnalyserNode=h}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(l){this._nativeAnalyserNode.fftSize=l}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(l){const c=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=l,!(l>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=c,s()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(l){const c=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=l,!(this._nativeAnalyserNode.maxDecibels>l))throw this._nativeAnalyserNode.minDecibels=c,s()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(l){this._nativeAnalyserNode.smoothingTimeConstant=l}getByteFrequencyData(l){this._nativeAnalyserNode.getByteFrequencyData(l)}getByteTimeDomainData(l){this._nativeAnalyserNode.getByteTimeDomainData(l)}getFloatFrequencyData(l){this._nativeAnalyserNode.getFloatFrequencyData(l)}getFloatTimeDomainData(l){this._nativeAnalyserNode.getFloatTimeDomainData(l)}},vs=(t,e)=>t.context===e,bU=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,fftSize:l.fftSize,maxDecibels:l.maxDecibels,minDecibels:l.minDecibels,smoothingTimeConstant:l.smoothingTimeConstant};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},ym=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},gi=()=>new DOMException("","IndexSizeError"),By=t=>{t.getChannelData=(e=>s=>{try{return e.call(t,s)}catch(n){throw n.code===12?gi():n}})(t.getChannelData)},vU={numberOfChannels:1},yU=(t,e,s,n,i,r,a,l)=>{let c=null;return class oC{constructor(d){if(i===null)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:h,numberOfChannels:f,sampleRate:m}={...vU,...d};c===null&&(c=new i(1,1,44100));const b=n!==null&&e(r,r)?new n({length:h,numberOfChannels:f,sampleRate:m}):c.createBuffer(f,h,m);if(b.numberOfChannels===0)throw s();return typeof b.copyFromChannel!="function"?(a(b),By(b)):e(ym,()=>ym(b))||l(b),t.add(b),b}static[Symbol.hasInstance](d){return d!==null&&typeof d=="object"&&Object.getPrototypeOf(d)===oC.prototype||t.has(d)}}},Ds=-34028234663852886e22,_s=-Ds,Hi=t=>Wl.has(t),_U={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},wU=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={..._U,...d},m=i(h,f),b=a(h),x=b?e():null;super(u,!1,m,x),this._audioBufferSourceNodeRenderer=x,this._isBufferNullified=!1,this._isBufferSet=f.buffer!==null,this._nativeAudioBufferSourceNode=m,this._onended=null,this._playbackRate=s(this,b,m.playbackRate,_s,Ds)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(u){if(this._nativeAudioBufferSourceNode.buffer=u,u!==null){if(this._isBufferSet)throw n();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(u){this._nativeAudioBufferSourceNode.loop=u}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(u){this._nativeAudioBufferSourceNode.loopEnd=u}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(u){this._nativeAudioBufferSourceNode.loopStart=u}get onended(){return this._onended}set onended(u){const d=typeof u=="function"?l(this,u):null;this._nativeAudioBufferSourceNode.onended=d;const h=this._nativeAudioBufferSourceNode.onended;this._onended=h!==null&&h===d?u:h}get playbackRate(){return this._playbackRate}start(u=0,d=0,h){if(this._nativeAudioBufferSourceNode.start(u,d,h),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.start=h===void 0?[u,d]:[u,d,h]),this.context.state!=="closed"){Yl(this);const f=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",f),Hi(this)&&qd(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",f)}}stop(u=0){this._nativeAudioBufferSourceNode.stop(u),this._audioBufferSourceNodeRenderer!==null&&(this._audioBufferSourceNodeRenderer.stop=u)}},kU=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null;const c=async(u,d)=>{let h=s(u);const f=vs(h,d);if(!f){const m={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value};h=e(d,m),a!==null&&h.start(...a),l!==null&&h.stop(l)}return r.set(d,h),f?await t(d,u.playbackRate,h.playbackRate):await n(d,u.playbackRate,h.playbackRate),await i(u,d,h),h};return{set start(u){a=u},set stop(u){l=u},render(u,d){const h=r.get(d);return h!==void 0?Promise.resolve(h):c(u,d)}}},NU=t=>"playbackRate"in t,SU=t=>"frequency"in t&&"gain"in t,TU=t=>"offset"in t,EU=t=>!("frequency"in t)&&"gain"in t,AU=t=>"detune"in t&&"frequency"in t&&!("gain"in t),jU=t=>"pan"in t,Ns=t=>Kn(tC,t),Kd=t=>Kn(sC,t),tb=(t,e)=>{const{activeInputs:s}=Ns(t);s.forEach(i=>i.forEach(([r])=>{e.includes(t)||tb(r,[...e,t])}));const n=NU(t)?[t.playbackRate]:aC(t)?Array.from(t.parameters.values()):SU(t)?[t.Q,t.detune,t.frequency,t.gain]:TU(t)?[t.offset]:EU(t)?[t.gain]:AU(t)?[t.detune,t.frequency]:jU(t)?[t.pan]:[];for(const i of n){const r=Kd(i);r!==void 0&&r.activeInputs.forEach(([a])=>tb(a,e))}Hi(t)&&qd(t)},lC=t=>{tb(t.destination,[])},CU=t=>t===void 0||typeof t=="number"||typeof t=="string"&&(t==="balanced"||t==="interactive"||t==="playback"),RU=(t,e,s,n,i,r,a,l,c)=>class extends t{constructor(d={}){if(c===null)throw new Error("Missing the native AudioContext constructor.");let h;try{h=new c(d)}catch(b){throw b.code===12&&b.message==="sampleRate is not in range"?s():b}if(h===null)throw n();if(!CU(d.latencyHint))throw new TypeError(`The provided value '${d.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(d.sampleRate!==void 0&&h.sampleRate!==d.sampleRate)throw s();super(h,2);const{latencyHint:f}=d,{sampleRate:m}=h;if(this._baseLatency=typeof h.baseLatency=="number"?h.baseLatency:f==="balanced"?512/m:f==="interactive"||f===void 0?256/m:f==="playback"?1024/m:Math.max(2,Math.min(128,Math.round(f*m/128)))*128/m,this._nativeAudioContext=h,c.name==="webkitAudioContext"?(this._nativeGainNode=h.createGain(),this._nativeOscillatorNode=h.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(h.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,h.state==="running"){this._state="suspended";const b=()=>{this._state==="suspended"&&(this._state=null),h.removeEventListener("statechange",b)};h.addEventListener("statechange",b)}}get baseLatency(){return this._baseLatency}get state(){return this._state!==null?this._state:this._nativeAudioContext.state}close(){return this.state==="closed"?this._nativeAudioContext.close().then(()=>{throw e()}):(this._state==="suspended"&&(this._state=null),this._nativeAudioContext.close().then(()=>{this._nativeGainNode!==null&&this._nativeOscillatorNode!==null&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),lC(this)}))}createMediaElementSource(d){return new i(this,{mediaElement:d})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(d){return new a(this,{mediaStream:d})}createMediaStreamTrackSource(d){return new l(this,{mediaStreamTrack:d})}resume(){return this._state==="suspended"?new Promise((d,h)=>{const f=()=>{this._nativeAudioContext.removeEventListener("statechange",f),this._nativeAudioContext.state==="running"?d():this.resume().then(d,h)};this._nativeAudioContext.addEventListener("statechange",f)}):this._nativeAudioContext.resume().catch(d=>{throw d===void 0||d.code===15?e():d})}suspend(){return this._nativeAudioContext.suspend().catch(d=>{throw d===void 0?e():d})}},IU=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f=a(h),m=i(h,d,f),b=f?e(l):null;super(u,!1,m,b),this._isNodeOfNativeOfflineAudioContext=f,this._nativeAudioDestinationNode=m}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(u){if(this._isNodeOfNativeOfflineAudioContext)throw n();if(u>this._nativeAudioDestinationNode.maxChannelCount)throw s();this._nativeAudioDestinationNode.channelCount=u}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(u){if(this._isNodeOfNativeOfflineAudioContext)throw n();this._nativeAudioDestinationNode.channelCountMode=u}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},OU=t=>{const e=new WeakMap,s=async(n,i)=>{const r=i.destination;return e.set(i,r),await t(n,i,r),r};return{render(n,i){const r=e.get(i);return r!==void 0?Promise.resolve(r):s(n,i)}}},MU=(t,e,s,n,i,r,a,l)=>(c,u)=>{const d=u.listener,h=()=>{const w=new Float32Array(1),S=e(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),_=a(u);let T=!1,E=[0,0,-1,0,1,0],A=[0,0,0];const j=()=>{if(T)return;T=!0;const L=n(u,256,9,0);L.onaudioprocess=({inputBuffer:M})=>{const D=[r(M,w,0),r(M,w,1),r(M,w,2),r(M,w,3),r(M,w,4),r(M,w,5)];D.some((F,U)=>F!==E[U])&&(d.setOrientation(...D),E=D);const I=[r(M,w,6),r(M,w,7),r(M,w,8)];I.some((F,U)=>F!==A[U])&&(d.setPosition(...I),A=I)},S.connect(L)},O=L=>M=>{M!==E[L]&&(E[L]=M,d.setOrientation(...E))},H=L=>M=>{M!==A[L]&&(A[L]=M,d.setPosition(...A))},G=(L,M,D)=>{const I=s(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:M});I.connect(S,0,L),I.start(),Object.defineProperty(I.offset,"defaultValue",{get(){return M}});const F=t({context:c},_,I.offset,_s,Ds);return l(F,"value",U=>()=>U.call(F),U=>R=>{try{U.call(F,R)}catch(C){if(C.code!==9)throw C}j(),_&&D(R)}),F.cancelAndHoldAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.cancelAndHoldAtTime),F.cancelScheduledValues=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.cancelScheduledValues),F.exponentialRampToValueAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.exponentialRampToValueAtTime),F.linearRampToValueAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.linearRampToValueAtTime),F.setTargetAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.setTargetAtTime),F.setValueAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.setValueAtTime),F.setValueCurveAtTime=(U=>_?()=>{throw i()}:(...R)=>{const C=U.apply(F,R);return j(),C})(F.setValueCurveAtTime),F};return{forwardX:G(0,0,O(0)),forwardY:G(1,0,O(1)),forwardZ:G(2,-1,O(2)),positionX:G(6,0,H(0)),positionY:G(7,0,H(1)),positionZ:G(8,0,H(2)),upX:G(3,0,O(3)),upY:G(4,1,O(4)),upZ:G(5,0,O(5))}},{forwardX:f,forwardY:m,forwardZ:b,positionX:x,positionY:v,positionZ:g,upX:p,upY:y,upZ:k}=d.forwardX===void 0?h():d;return{get forwardX(){return f},get forwardY(){return m},get forwardZ(){return b},get positionX(){return x},get positionY(){return v},get positionZ(){return g},get upX(){return p},get upY(){return y},get upZ(){return k}}},_m=t=>"context"in t,Wd=t=>_m(t[0]),Co=(t,e,s,n)=>{for(const i of t)if(s(i)){if(n)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},NN=(t,e,[s,n],i)=>{Co(t,[e,s,n],r=>r[0]===e&&r[1]===s,i)},SN=(t,[e,s,n],i)=>{const r=t.get(e);r===void 0?t.set(e,new Set([[s,n]])):Co(r,[s,n],a=>a[0]===s,i)},_c=t=>"inputs"in t,wm=(t,e,s,n)=>{if(_c(e)){const i=e.inputs[n];return t.connect(i,s,0),[i,s,0]}return t.connect(e,s,n),[e,s,n]},cC=(t,e,s)=>{for(const n of t)if(n[0]===e&&n[1]===s)return t.delete(n),n;return null},DU=(t,e,s)=>Mp(t,n=>n[0]===e&&n[1]===s),uC=(t,e)=>{if(!zd(t).delete(e))throw new Error("Missing the expected event listener.")},dC=(t,e,s)=>{const n=Kn(t,e),i=Mp(n,r=>r[0]===s);return n.size===0&&t.delete(e),i},km=(t,e,s,n)=>{_c(e)?t.disconnect(e.inputs[n],s,0):t.disconnect(e,s,n)},pt=t=>Kn(Py,t),id=t=>Kn(Vy,t),bo=t=>Qx.has(t),df=t=>!Wl.has(t),TN=(t,e)=>new Promise(s=>{if(e!==null)s(!0);else{const n=t.createScriptProcessor(256,1,1),i=t.createGain(),r=t.createBuffer(1,2,44100),a=r.getChannelData(0);a[0]=1,a[1]=1;const l=t.createBufferSource();l.buffer=r,l.loop=!0,l.connect(n).connect(t.destination),l.connect(i),l.disconnect(i),n.onaudioprocess=c=>{const u=c.inputBuffer.getChannelData(0);Array.prototype.some.call(u,d=>d===1)?s(!0):s(!1),l.stop(),n.onaudioprocess=null,l.disconnect(n),n.disconnect(t.destination)},l.start()}}),rg=(t,e)=>{const s=new Map;for(const n of t)for(const i of n){const r=s.get(i);s.set(i,r===void 0?1:r+1)}s.forEach((n,i)=>e(i,n))},Nm=t=>"context"in t,LU=t=>{const e=new Map;t.connect=(s=>(n,i=0,r=0)=>{const a=Nm(n)?s(n,i,r):s(n,i),l=e.get(n);return l===void 0?e.set(n,[{input:r,output:i}]):l.every(c=>c.input!==r||c.output!==i)&&l.push({input:r,output:i}),a})(t.connect.bind(t)),t.disconnect=(s=>(n,i,r)=>{if(s.apply(t),n===void 0)e.clear();else if(typeof n=="number")for(const[a,l]of e){const c=l.filter(u=>u.output!==n);c.length===0?e.delete(a):e.set(a,c)}else if(e.has(n))if(i===void 0)e.delete(n);else{const a=e.get(n);if(a!==void 0){const l=a.filter(c=>c.output!==i&&(c.input!==r||r===void 0));l.length===0?e.delete(n):e.set(n,l)}}for(const[a,l]of e)l.forEach(c=>{Nm(a)?t.connect(a,c.output,c.input):t.connect(a,c.output)})})(t.disconnect)},PU=(t,e,s,n)=>{const{activeInputs:i,passiveInputs:r}=Kd(e),{outputs:a}=Ns(t),l=zd(t),c=u=>{const d=pt(t),h=id(e);if(u){const f=dC(r,t,s);NN(i,t,f,!1),!n&&!bo(t)&&d.connect(h,s)}else{const f=DU(i,t,s);SN(r,f,!1),!n&&!bo(t)&&d.disconnect(h,s)}};return Co(a,[e,s],u=>u[0]===e&&u[1]===s,!0)?(l.add(c),Hi(t)?NN(i,t,[s,c],!0):SN(r,[t,s,c],!0),!0):!1},VU=(t,e,s,n)=>{const{activeInputs:i,passiveInputs:r}=Ns(e),a=cC(i[n],t,s);return a===null?[rC(r,t,s,n)[2],!1]:[a[2],!0]},BU=(t,e,s)=>{const{activeInputs:n,passiveInputs:i}=Kd(e),r=cC(n,t,s);return r===null?[dC(i,t,s)[1],!1]:[r[2],!0]},Fy=(t,e,s,n,i)=>{const[r,a]=VU(t,s,n,i);if(r!==null&&(uC(t,r),a&&!e&&!bo(t)&&km(pt(t),pt(s),n,i)),Hi(s)){const{activeInputs:l}=Ns(s);eb(s,l)}},Uy=(t,e,s,n)=>{const[i,r]=BU(t,s,n);i!==null&&(uC(t,i),r&&!e&&!bo(t)&&pt(t).disconnect(id(s),n))},FU=(t,e)=>{const s=Ns(t),n=[];for(const i of s.outputs)Wd(i)?Fy(t,e,...i):Uy(t,e,...i),n.push(i[0]);return s.outputs.clear(),n},UU=(t,e,s)=>{const n=Ns(t),i=[];for(const r of n.outputs)r[1]===s&&(Wd(r)?Fy(t,e,...r):Uy(t,e,...r),i.push(r[0]),n.outputs.delete(r));return i},$U=(t,e,s,n,i)=>{const r=Ns(t);return Array.from(r.outputs).filter(a=>a[0]===s&&(n===void 0||a[1]===n)&&(i===void 0||a[2]===i)).map(a=>(Wd(a)?Fy(t,e,...a):Uy(t,e,...a),r.outputs.delete(a),a[0]))},HU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,x)=>class extends u{constructor(g,p,y,k){super(y),this._context=g,this._nativeAudioNode=y;const w=d(g);h(w)&&s(TN,()=>TN(w,x))!==!0&&LU(y),Py.set(this,y),nC.set(this,new Set),g.state!=="closed"&&p&&Yl(this),t(this,k,y)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(g){this._nativeAudioNode.channelCount=g}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(g){this._nativeAudioNode.channelCountMode=g}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(g){this._nativeAudioNode.channelInterpretation=g}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(g,p=0,y=0){if(p<0||p>=this._nativeAudioNode.numberOfOutputs)throw i();const k=d(this._context),w=b(k);if(f(g)||m(g))throw r();if(_m(g)){const T=pt(g);try{const A=wm(this._nativeAudioNode,T,p,y),j=df(this);(w||j)&&this._nativeAudioNode.disconnect(...A),this.context.state!=="closed"&&!j&&df(g)&&Yl(g)}catch(A){throw A.code===12?r():A}if(e(this,g,p,y,w)){const A=c([this],g);rg(A,n(w))}return g}const S=id(g);if(S.name==="playbackRate"&&S.maxValue===1024)throw a();try{this._nativeAudioNode.connect(S,p),(w||df(this))&&this._nativeAudioNode.disconnect(S,p)}catch(T){throw T.code===12?r():T}if(PU(this,g,p,w)){const T=c([this],g);rg(T,n(w))}}disconnect(g,p,y){let k;const w=d(this._context),S=b(w);if(g===void 0)k=FU(this,S);else if(typeof g=="number"){if(g<0||g>=this.numberOfOutputs)throw i();k=UU(this,S,g)}else{if(p!==void 0&&(p<0||p>=this.numberOfOutputs)||_m(g)&&y!==void 0&&(y<0||y>=g.numberOfInputs))throw i();if(k=$U(this,S,g,p,y),k.length===0)throw r()}for(const _ of k){const T=c([this],_);rg(T,l)}}},GU=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>(m,b,x,v=null,g=null)=>{const p=x.value,y=new eU(p),k=b?n(y):null,w={get defaultValue(){return p},get maxValue(){return v===null?x.maxValue:v},get minValue(){return g===null?x.minValue:g},get value(){return x.value},set value(S){x.value=S,w.setValueAtTime(S,m.context.currentTime)},cancelAndHoldAtTime(S){if(typeof x.cancelAndHoldAtTime=="function")k===null&&y.flush(m.context.currentTime),y.add(i(S)),x.cancelAndHoldAtTime(S);else{const _=Array.from(y).pop();k===null&&y.flush(m.context.currentTime),y.add(i(S));const T=Array.from(y).pop();x.cancelScheduledValues(S),_!==T&&T!==void 0&&(T.type==="exponentialRampToValue"?x.exponentialRampToValueAtTime(T.value,T.endTime):T.type==="linearRampToValue"?x.linearRampToValueAtTime(T.value,T.endTime):T.type==="setValue"?x.setValueAtTime(T.value,T.startTime):T.type==="setValueCurve"&&x.setValueCurveAtTime(T.values,T.startTime,T.duration))}return w},cancelScheduledValues(S){return k===null&&y.flush(m.context.currentTime),y.add(r(S)),x.cancelScheduledValues(S),w},exponentialRampToValueAtTime(S,_){if(S===0)throw new RangeError;if(!Number.isFinite(_)||_<0)throw new RangeError;const T=m.context.currentTime;return k===null&&y.flush(T),Array.from(y).length===0&&(y.add(u(p,T)),x.setValueAtTime(p,T)),y.add(a(S,_)),x.exponentialRampToValueAtTime(S,_),w},linearRampToValueAtTime(S,_){const T=m.context.currentTime;return k===null&&y.flush(T),Array.from(y).length===0&&(y.add(u(p,T)),x.setValueAtTime(p,T)),y.add(l(S,_)),x.linearRampToValueAtTime(S,_),w},setTargetAtTime(S,_,T){return k===null&&y.flush(m.context.currentTime),y.add(c(S,_,T)),x.setTargetAtTime(S,_,T),w},setValueAtTime(S,_){return k===null&&y.flush(m.context.currentTime),y.add(u(S,_)),x.setValueAtTime(S,_),w},setValueCurveAtTime(S,_,T){const E=S instanceof Float32Array?S:new Float32Array(S);if(h!==null&&h.name==="webkitAudioContext"){const A=_+T,j=m.context.sampleRate,O=Math.ceil(_*j),H=Math.floor(A*j),G=H-O,L=new Float32Array(G);for(let D=0;D<G;D+=1){const I=(E.length-1)/T*((O+D)/j-_),F=Math.floor(I),U=Math.ceil(I);L[D]=F===U?E[F]:(1-(I-F))*E[F]+(1-(U-I))*E[U]}k===null&&y.flush(m.context.currentTime),y.add(d(L,_,T)),x.setValueCurveAtTime(L,_,T);const M=H/j;M<A&&f(w,L[L.length-1],M),f(w,E[E.length-1],A)}else k===null&&y.flush(m.context.currentTime),y.add(d(E,_,T)),x.setValueCurveAtTime(E,_,T);return w}};return s.set(w,x),e.set(w,m),t(w,k),w},zU=t=>({replay(e){for(const s of t)if(s.type==="exponentialRampToValue"){const{endTime:n,value:i}=s;e.exponentialRampToValueAtTime(i,n)}else if(s.type==="linearRampToValue"){const{endTime:n,value:i}=s;e.linearRampToValueAtTime(i,n)}else if(s.type==="setTarget"){const{startTime:n,target:i,timeConstant:r}=s;e.setTargetAtTime(i,n,r)}else if(s.type==="setValue"){const{startTime:n,value:i}=s;e.setValueAtTime(i,n)}else if(s.type==="setValueCurve"){const{duration:n,startTime:i,values:r}=s;e.setValueCurveAtTime(r,i,n)}else throw new Error("Can't apply an unknown automation.")}});class hC{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,s=null){return this._map.forEach((n,i)=>e.call(s,n,i,this))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const qU={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},KU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m)=>class extends e{constructor(x,v,g){var p;const y=l(x),k=c(y),w=d({...qU,...g});f(w);const S=Jx.get(y),_=S==null?void 0:S.get(v),T=k||y.state!=="closed"?y:(p=a(y))!==null&&p!==void 0?p:y,E=i(T,k?null:x.baseLatency,u,v,_,w),A=k?n(v,w,_):null;super(x,!0,E,A);const j=[];E.parameters.forEach((H,G)=>{const L=s(this,k,H);j.push([G,L])}),this._nativeAudioWorkletNode=E,this._onprocessorerror=null,this._parameters=new hC(j),k&&t(y,this);const{activeInputs:O}=r(this);h(E,O)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(x){const v=typeof x=="function"?m(this,x):null;this._nativeAudioWorkletNode.onprocessorerror=v;const g=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=g!==null&&g===v?x:g}get parameters(){return this._parameters===null?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function Sm(t,e,s,n,i){if(typeof t.copyFromChannel=="function")e[s].byteLength===0&&(e[s]=new Float32Array(128)),t.copyFromChannel(e[s],n,i);else{const r=t.getChannelData(n);if(e[s].byteLength===0)e[s]=r.slice(i,i+128);else{const a=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[s].set(a)}}}const fC=(t,e,s,n,i)=>{typeof t.copyToChannel=="function"?e[s].byteLength!==0&&t.copyToChannel(e[s],n,i):e[s].byteLength!==0&&t.getChannelData(n).set(e[s],i)},Tm=(t,e)=>{const s=[];for(let n=0;n<t;n+=1){const i=[],r=typeof e=="number"?e:e[n];for(let a=0;a<r;a+=1)i.push(new Float32Array(128));s.push(i)}return s},WU=(t,e)=>{const s=Kn(Zx,t),n=pt(e);return Kn(s,n)},YU=async(t,e,s,n,i,r,a)=>{const l=e===null?Math.ceil(t.context.length/128)*128:e.length,c=n.channelCount*n.numberOfInputs,u=i.reduce((v,g)=>v+g,0),d=u===0?null:s.createBuffer(u,l,s.sampleRate);if(r===void 0)throw new Error("Missing the processor constructor.");const h=Ns(t),f=await WU(s,t),m=Tm(n.numberOfInputs,n.channelCount),b=Tm(n.numberOfOutputs,i),x=Array.from(t.parameters.keys()).reduce((v,g)=>({...v,[g]:new Float32Array(128)}),{});for(let v=0;v<l;v+=128){if(n.numberOfInputs>0&&e!==null)for(let g=0;g<n.numberOfInputs;g+=1)for(let p=0;p<n.channelCount;p+=1)Sm(e,m[g],p,p,v);r.parameterDescriptors!==void 0&&e!==null&&r.parameterDescriptors.forEach(({name:g},p)=>{Sm(e,x,g,c+p,v)});for(let g=0;g<n.numberOfInputs;g+=1)for(let p=0;p<i[g];p+=1)b[g][p].byteLength===0&&(b[g][p]=new Float32Array(128));try{const g=m.map((y,k)=>h.activeInputs[k].size===0?[]:y),p=a(v/s.sampleRate,s.sampleRate,()=>f.process(g,b,x));if(d!==null)for(let y=0,k=0;y<n.numberOfOutputs;y+=1){for(let w=0;w<i[y];w+=1)fC(d,b[y],w,k+w,v);k+=i[y]}if(!p)break}catch(g){t.dispatchEvent(new ErrorEvent("processorerror",{colno:g.colno,filename:g.filename,lineno:g.lineno,message:g.message}));break}}return d},XU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,x)=>(v,g,p)=>{const y=new WeakMap;let k=null;const w=async(S,_)=>{let T=d(S),E=null;const A=vs(T,_),j=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(h===null){const O=j.reduce((M,D)=>M+D,0),H=i(_,{channelCount:Math.max(1,O),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,O)}),G=[];for(let M=0;M<S.numberOfOutputs;M+=1)G.push(n(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:j[M]}));const L=a(_,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1});L.connect=e.bind(null,G),L.disconnect=c.bind(null,G),E=[H,G,L]}else A||(T=new h(_,v));if(y.set(_,E===null?T:E[2]),E!==null){if(k===null){if(p===void 0)throw new Error("Missing the processor constructor.");if(f===null)throw new Error("Missing the native OfflineAudioContext constructor.");const D=S.channelCount*S.numberOfInputs,I=p.parameterDescriptors===void 0?0:p.parameterDescriptors.length,F=D+I;k=YU(S,F===0?null:await(async()=>{const R=new f(F,Math.ceil(S.context.length/128)*128,_.sampleRate),C=[],$=[];for(let W=0;W<g.numberOfInputs;W+=1)C.push(a(R,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),$.push(i(R,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const V=await Promise.all(Array.from(S.parameters.values()).map(async W=>{const J=r(R,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:W.value});return await m(R,W,J.offset),J})),P=n(R,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,D+I)});for(let W=0;W<g.numberOfInputs;W+=1){C[W].connect($[W]);for(let J=0;J<g.channelCount;J+=1)$[W].connect(P,J,W*g.channelCount+J)}for(const[W,J]of V.entries())J.connect(P,0,D+W),J.start(0);return P.connect(R.destination),await Promise.all(C.map(W=>b(S,R,W))),x(R)})(),_,g,j,p,u)}const O=await k,H=s(_,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[G,L,M]=E;O!==null&&(H.buffer=O,H.start(0)),H.connect(G);for(let D=0,I=0;D<S.numberOfOutputs;D+=1){const F=L[D];for(let U=0;U<j[D];U+=1)G.connect(F,I+U,U);I+=j[D]}return M}if(A)for(const[O,H]of S.parameters.entries())await t(_,H,T.parameters.get(O));else for(const[O,H]of S.parameters.entries())await m(_,H,T.parameters.get(O));return await b(S,_,T),T};return{render(S,_){l(_,S);const T=y.get(_);return T!==void 0?Promise.resolve(T):w(S,_)}}},QU=(t,e,s,n,i,r,a,l,c,u,d,h,f,m,b,x,v,g,p,y)=>class extends b{constructor(w,S){super(w,S),this._nativeContext=w,this._audioWorklet=t===void 0?void 0:{addModule:(_,T)=>t(this,_,T)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(w,S,_){return new s({length:S,numberOfChannels:w,sampleRate:_})}createBufferSource(){return new n(this)}createChannelMerger(w=6){return new r(this,{numberOfInputs:w})}createChannelSplitter(w=6){return new a(this,{numberOfOutputs:w})}createConstantSource(){return new l(this)}createConvolver(){return new c(this)}createDelay(w=1){return new d(this,{maxDelayTime:w})}createDynamicsCompressor(){return new h(this)}createGain(){return new f(this)}createIIRFilter(w,S){return new m(this,{feedback:S,feedforward:w})}createOscillator(){return new x(this)}createPanner(){return new v(this)}createPeriodicWave(w,S,_={disableNormalization:!1}){return new g(this,{..._,imag:S,real:w})}createStereoPanner(){return new p(this)}createWaveShaper(){return new y(this)}decodeAudioData(w,S,_){return u(this._nativeContext,w).then(T=>(typeof S=="function"&&S(T),T),T=>{throw typeof _=="function"&&_(T),T})}},JU={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ZU=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={...JU,...d},m=i(h,f),b=a(h),x=b?s():null;super(u,!1,m,x),this._Q=e(this,b,m.Q,_s,Ds),this._detune=e(this,b,m.detune,1200*Math.log2(_s),-1200*Math.log2(_s)),this._frequency=e(this,b,m.frequency,u.sampleRate/2,0),this._gain=e(this,b,m.gain,40*Math.log10(_s),Ds),this._nativeBiquadFilterNode=m,l(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(u){this._nativeBiquadFilterNode.type=u}getFrequencyResponse(u,d,h){try{this._nativeBiquadFilterNode.getFrequencyResponse(u,d,h)}catch(f){throw f.code===11?n():f}if(u.length!==d.length||d.length!==h.length)throw n()}},e9=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(c,h)}return r.set(c,u),d?(await t(c,l.Q,u.Q),await t(c,l.detune,u.detune),await t(c,l.frequency,u.frequency),await t(c,l.gain,u.gain)):(await n(c,l.Q,u.Q),await n(c,l.detune,u.detune),await n(c,l.frequency,u.frequency),await n(c,l.gain,u.gain)),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},t9=(t,e)=>(s,n)=>{const i=e.get(s);if(i!==void 0)return i;const r=t.get(s);if(r!==void 0)return r;try{const a=n();return a instanceof Promise?(t.set(s,a),a.catch(()=>!1).then(l=>(t.delete(s),e.set(s,l),l))):(e.set(s,a),a)}catch{return e.set(s,!1),!1}},s9={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},n9=(t,e,s,n,i)=>class extends t{constructor(a,l){const c=n(a),u={...s9,...l},d=s(c,u),h=i(c)?e():null;super(a,!1,d,h)}},i9=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfInputs:l.numberOfInputs};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},r9={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},a9=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d=r({...r9,...c}),h=s(u,d),f=i(u)?e():null;super(l,!1,h,f)}},o9=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,numberOfOutputs:l.numberOfOutputs};l=t(a,u)}return n.set(a,l),await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},l9=t=>(e,s,n)=>t(s,e,n),c9=t=>(e,s,n=0,i=0)=>{const r=e[n];if(r===void 0)throw t();return Nm(s)?r.connect(s,0,i):r.connect(s,0)},u9=t=>(e,s)=>{const n=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(s),n.start(),()=>{n.stop(),n.disconnect(s)}},d9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},h9=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...d9,...u},f=n(d,h),m=r(d),b=m?s():null;super(c,!1,f,b),this._constantSourceNodeRenderer=b,this._nativeConstantSourceNode=f,this._offset=e(this,m,f.offset,_s,Ds),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeConstantSourceNode.onended=u;const d=this._nativeConstantSourceNode.onended;this._onended=d!==null&&d===u?c:d}start(c=0){if(this._nativeConstantSourceNode.start(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.start=c),this.context.state!=="closed"){Yl(this);const u=()=>{this._nativeConstantSourceNode.removeEventListener("ended",u),Hi(this)&&qd(this)};this._nativeConstantSourceNode.addEventListener("ended",u)}}stop(c=0){this._nativeConstantSourceNode.stop(c),this._constantSourceNodeRenderer!==null&&(this._constantSourceNodeRenderer.stop=c)}},f9=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null;const c=async(u,d)=>{let h=s(u);const f=vs(h,d);if(!f){const m={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value};h=e(d,m),a!==null&&h.start(a),l!==null&&h.stop(l)}return r.set(d,h),f?await t(d,u.offset,h.offset):await n(d,u.offset,h.offset),await i(u,d,h),h};return{set start(u){a=u},set stop(u){l=u},render(u,d){const h=r.get(d);return h!==void 0?Promise.resolve(h):c(u,d)}}},m9=t=>e=>(t[0]=e,t[0]),p9={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},g9=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d={...p9,...c},h=s(u,d),m=i(u)?e():null;super(l,!1,h,m),this._isBufferNullified=!1,this._nativeConvolverNode=h,d.buffer!==null&&r(this,d.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(l){if(this._nativeConvolverNode.buffer=l,l===null&&this._nativeConvolverNode.buffer!==null){const c=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=c.createBuffer(1,1,c.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,this._nativeConvolverNode.buffer===null?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(l){this._nativeConvolverNode.normalize=l}},x9=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,disableNormalization:!l.normalize};l=t(a,u)}return n.set(a,l),_c(l)?await s(r,a,l.inputs[0]):await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},b9=(t,e)=>(s,n,i)=>{if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(s,n,i)}catch(r){throw r.name==="SyntaxError"?t():r}},v9=()=>new DOMException("","DataCloneError"),EN=t=>{const{port1:e,port2:s}=new MessageChannel;return new Promise(n=>{const i=()=>{s.onmessage=null,e.close(),s.close(),n()};s.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}})},y9=(t,e,s,n,i,r,a,l,c,u,d)=>(h,f)=>{const m=a(h)?h:r(h);if(i.has(f)){const b=s();return Promise.reject(b)}try{i.add(f)}catch{}return e(c,()=>c(m))?m.decodeAudioData(f).then(b=>(EN(f).catch(()=>{}),e(l,()=>l(b))||d(b),t.add(b),b)):new Promise((b,x)=>{const v=async()=>{try{await EN(f)}catch{}},g=p=>{x(p),v()};try{m.decodeAudioData(f,p=>{typeof p.copyFromChannel!="function"&&(u(p),By(p)),t.add(p),v().then(()=>b(p))},p=>{g(p===null?n():p)})}catch(p){g(p)}})},_9=(t,e,s,n,i,r,a,l)=>(c,u)=>{const d=e.get(c);if(d===void 0)throw new Error("Missing the expected cycle count.");const h=r(c.context),f=l(h);if(d===u){if(e.delete(c),!f&&a(c)){const m=n(c),{outputs:b}=s(c);for(const x of b)if(Wd(x)){const v=n(x[0]);t(m,v,x[1],x[2])}else{const v=i(x[0]);m.connect(v,x[1])}}}else e.set(c,d-u)},w9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},k9=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...w9,...u},f=n(d,h),m=r(d),b=m?s(h.maxDelayTime):null;super(c,!1,f,b),this._delayTime=e(this,m,f.delayTime),a(this,h.maxDelayTime)}get delayTime(){return this._delayTime}},N9=(t,e,s,n,i)=>r=>{const a=new WeakMap,l=async(c,u)=>{let d=s(c);const h=vs(d,u);if(!h){const f={channelCount:d.channelCount,channelCountMode:d.channelCountMode,channelInterpretation:d.channelInterpretation,delayTime:d.delayTime.value,maxDelayTime:r};d=e(u,f)}return a.set(u,d),h?await t(u,c.delayTime,d.delayTime):await n(u,c.delayTime,d.delayTime),await i(c,u,d),d};return{render(c,u){const d=a.get(u);return d!==void 0?Promise.resolve(d):l(c,u)}}},S9=t=>(e,s,n,i)=>t(e[i],r=>r[0]===s&&r[1]===n),T9=t=>(e,s)=>{t(e).delete(s)},E9=t=>"delayTime"in t,A9=(t,e,s)=>function n(i,r){const a=_m(r)?r:s(t,r);if(E9(a))return[];if(i[0]===a)return[i];if(i.includes(a))return[];const{outputs:l}=e(a);return Array.from(l).map(c=>n([...i,a],c[0])).reduce((c,u)=>c.concat(u),[])},Oh=(t,e,s)=>{const n=e[s];if(n===void 0)throw t();return n},j9=t=>(e,s=void 0,n=void 0,i=0)=>s===void 0?e.forEach(r=>r.disconnect()):typeof s=="number"?Oh(t,e,s).disconnect():Nm(s)?n===void 0?e.forEach(r=>r.disconnect(s)):i===void 0?Oh(t,e,n).disconnect(s,0):Oh(t,e,n).disconnect(s,0,i):n===void 0?e.forEach(r=>r.disconnect(s)):Oh(t,e,n).disconnect(s,0),C9={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},R9=(t,e,s,n,i,r,a,l)=>class extends t{constructor(u,d){const h=r(u),f={...C9,...d},m=n(h,f),b=a(h),x=b?s():null;super(u,!1,m,x),this._attack=e(this,b,m.attack),this._knee=e(this,b,m.knee),this._nativeDynamicsCompressorNode=m,this._ratio=e(this,b,m.ratio),this._release=e(this,b,m.release),this._threshold=e(this,b,m.threshold),l(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(u){const d=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=u,u>2)throw this._nativeDynamicsCompressorNode.channelCount=d,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(u){const d=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=u,u==="max")throw this._nativeDynamicsCompressorNode.channelCountMode=d,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return typeof this._nativeDynamicsCompressorNode.reduction.value=="number"?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},I9=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(c,h)}return r.set(c,u),d?(await t(c,l.attack,u.attack),await t(c,l.knee,u.knee),await t(c,l.ratio,u.ratio),await t(c,l.release,u.release),await t(c,l.threshold,u.threshold)):(await n(c,l.attack,u.attack),await n(c,l.knee,u.knee),await n(c,l.ratio,u.ratio),await n(c,l.release,u.release),await n(c,l.threshold,u.threshold)),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},O9=()=>new DOMException("","EncodingError"),M9=t=>e=>new Promise((s,n)=>{if(t===null){n(new SyntaxError);return}const i=t.document.head;if(i===null)n(new SyntaxError);else{const r=t.document.createElement("script"),a=new Blob([e],{type:"application/javascript"}),l=URL.createObjectURL(a),c=t.onerror,u=()=>{t.onerror=c,URL.revokeObjectURL(l)};t.onerror=(d,h,f,m,b)=>{if(h===l||h===t.location.href&&f===1&&m===1)return u(),n(b),!1;if(c!==null)return c(d,h,f,m,b)},r.onerror=()=>{u(),n(new SyntaxError)},r.onload=()=>{u(),s()},r.src=l,r.type="module",i.appendChild(r)}}),D9=t=>class{constructor(s){this._nativeEventTarget=s,this._listeners=new WeakMap}addEventListener(s,n,i){if(n!==null){let r=this._listeners.get(n);r===void 0&&(r=t(this,n),typeof n=="function"&&this._listeners.set(n,r)),this._nativeEventTarget.addEventListener(s,r,i)}}dispatchEvent(s){return this._nativeEventTarget.dispatchEvent(s)}removeEventListener(s,n,i){const r=n===null?void 0:this._listeners.get(n);this._nativeEventTarget.removeEventListener(s,r===void 0?null:r,i)}},L9=t=>(e,s,n)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*s)}},currentTime:{configurable:!0,get(){return e}}});try{return n()}finally{t!==null&&(delete t.currentFrame,delete t.currentTime)}},P9=t=>async e=>{try{const s=await fetch(e);if(s.ok)return[await s.text(),s.url]}catch{}throw t()},V9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},B9=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...V9,...c},h=n(u,d),f=r(u),m=f?s():null;super(l,!1,h,m),this._gain=e(this,f,h.gain,_s,Ds)}get gain(){return this._gain}},F9=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(c,h)}return r.set(c,u),d?await t(c,l.gain,u.gain):await n(c,l.gain,u.gain),await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},U9=(t,e)=>s=>e(t,s),$9=t=>e=>{const s=t(e);if(s.renderer===null)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return s.renderer},H9=t=>e=>{var s;return(s=t.get(e))!==null&&s!==void 0?s:0},G9=t=>e=>{const s=t(e);if(s.renderer===null)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return s.renderer},z9=t=>e=>t.get(e),os=()=>new DOMException("","InvalidStateError"),q9=t=>e=>{const s=t.get(e);if(s===void 0)throw os();return s},K9=(t,e)=>s=>{let n=t.get(s);if(n!==void 0)return n;if(e===null)throw new Error("Missing the native OfflineAudioContext constructor.");return n=new e(1,1,44100),t.set(s,n),n},W9=t=>e=>{const s=t.get(e);if(s===void 0)throw new Error("The context has no set of AudioWorkletNodes.");return s},Dp=()=>new DOMException("","InvalidAccessError"),Y9=t=>{t.getFrequencyResponse=(e=>(s,n,i)=>{if(s.length!==n.length||n.length!==i.length)throw Dp();return e.call(t,s,n,i)})(t.getFrequencyResponse)},X9={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},Q9=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=n(l),d=i(u),h={...X9,...c},f=e(u,d?null:l.baseLatency,h),m=d?s(h.feedback,h.feedforward):null;super(l,!1,f,m),Y9(f),this._nativeIIRFilterNode=f,r(this,1)}getFrequencyResponse(l,c,u){return this._nativeIIRFilterNode.getFrequencyResponse(l,c,u)}},mC=(t,e,s,n,i,r,a,l,c,u,d)=>{const h=u.length;let f=l;for(let m=0;m<h;m+=1){let b=s[0]*u[m];for(let x=1;x<i;x+=1){const v=f-x&c-1;b+=s[x]*r[v],b-=t[x]*a[v]}for(let x=i;x<n;x+=1)b+=s[x]*r[f-x&c-1];for(let x=i;x<e;x+=1)b-=t[x]*a[f-x&c-1];r[f]=u[m],a[f]=b,f=f+1&c-1,d[m]=b}return f},J9=(t,e,s,n)=>{const i=s instanceof Float64Array?s:new Float64Array(s),r=n instanceof Float64Array?n:new Float64Array(n),a=i.length,l=r.length,c=Math.min(a,l);if(i[0]!==1){for(let b=0;b<a;b+=1)r[b]/=i[0];for(let b=1;b<l;b+=1)i[b]/=i[0]}const u=32,d=new Float32Array(u),h=new Float32Array(u),f=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),m=t.numberOfChannels;for(let b=0;b<m;b+=1){const x=t.getChannelData(b),v=f.getChannelData(b);d.fill(0),h.fill(0),mC(i,a,r,l,c,d,h,0,u,x,v)}return f},Z9=(t,e,s,n,i)=>(r,a)=>{const l=new WeakMap;let c=null;const u=async(d,h)=>{let f=null,m=e(d);const b=vs(m,h);if(h.createIIRFilter===void 0?f=t(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):b||(m=h.createIIRFilter(a,r)),l.set(h,f===null?m:f),f!==null){if(c===null){if(s===null)throw new Error("Missing the native OfflineAudioContext constructor.");const v=new s(d.context.destination.channelCount,d.context.length,h.sampleRate);c=(async()=>{await n(d,v,v.destination);const g=await i(v);return J9(g,h,r,a)})()}const x=await c;return f.buffer=x,f.start(0),f}return await n(d,h,m),m};return{render(d,h){const f=l.get(h);return f!==void 0?Promise.resolve(f):u(d,h)}}},e$=(t,e,s,n,i,r)=>a=>(l,c)=>{const u=t.get(l);if(u===void 0){if(!a&&r(l)){const d=n(l),{outputs:h}=s(l);for(const f of h)if(Wd(f)){const m=n(f[0]);e(d,m,f[1],f[2])}else{const m=i(f[0]);d.disconnect(m,f[1])}}t.set(l,c)}else t.set(l,u+c)},t$=(t,e)=>s=>{const n=t.get(s);return e(n)||e(s)},s$=(t,e)=>s=>t.has(s)||e(s),n$=(t,e)=>s=>t.has(s)||e(s),i$=(t,e)=>s=>{const n=t.get(s);return e(n)||e(s)},r$=t=>e=>t!==null&&e instanceof t,a$=t=>e=>t!==null&&typeof t.AudioNode=="function"&&e instanceof t.AudioNode,o$=t=>e=>t!==null&&typeof t.AudioParam=="function"&&e instanceof t.AudioParam,l$=(t,e)=>s=>t(s)||e(s),c$=t=>e=>t!==null&&e instanceof t,u$=t=>t!==null&&t.isSecureContext,d$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r),c=e(l,a);if(n(l))throw TypeError();super(r,!0,c,null),this._nativeMediaElementAudioSourceNode=c}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},h$={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},f$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r);if(n(l))throw new TypeError;const c={...h$,...a},u=e(l,c);super(r,!1,u,null),this._nativeMediaStreamAudioDestinationNode=u}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},m$=(t,e,s,n)=>class extends t{constructor(r,a){const l=s(r),c=e(l,a);if(n(l))throw new TypeError;super(r,!0,c,null),this._nativeMediaStreamAudioSourceNode=c}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},p$=(t,e,s)=>class extends t{constructor(i,r){const a=s(i),l=e(a,r);super(i,!0,l,null)}},g$=(t,e,s,n,i,r)=>class extends s{constructor(l,c){super(l),this._nativeContext=l,Op.set(this,l),n(l)&&i.set(l,new Set),this._destination=new t(this,c),this._listener=e(this,l),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(l){const c=typeof l=="function"?r(this,l):null;this._nativeContext.onstatechange=c;const u=this._nativeContext.onstatechange;this._onstatechange=u!==null&&u===c?l:u}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},rd=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const s=t.decodeAudioData(e.buffer,()=>{});return s===void 0?!1:(s.catch(()=>{}),!0)}catch{}return!1},x$=(t,e)=>(s,n,i)=>{const r=new Set;return s.connect=(a=>(l,c=0,u=0)=>{const d=r.size===0;if(e(l))return a.call(s,l,c,u),t(r,[l,c,u],h=>h[0]===l&&h[1]===c&&h[2]===u,!0),d&&n(),l;a.call(s,l,c),t(r,[l,c],h=>h[0]===l&&h[1]===c,!0),d&&n()})(s.connect),s.disconnect=(a=>(l,c,u)=>{const d=r.size>0;if(l===void 0)a.apply(s),r.clear();else if(typeof l=="number"){a.call(s,l);for(const f of r)f[1]===l&&r.delete(f)}else{e(l)?a.call(s,l,c,u):a.call(s,l,c);for(const f of r)f[0]===l&&(c===void 0||f[1]===c)&&(u===void 0||f[2]===u)&&r.delete(f)}const h=r.size===0;d&&h&&i()})(s.disconnect),s},vt=(t,e,s)=>{const n=e[s];n!==void 0&&n!==t[s]&&(t[s]=n)},Zt=(t,e)=>{vt(t,e,"channelCount"),vt(t,e,"channelCountMode"),vt(t,e,"channelInterpretation")},AN=t=>typeof t.getFloatTimeDomainData=="function",b$=t=>{t.getFloatTimeDomainData=e=>{const s=new Uint8Array(e.length);t.getByteTimeDomainData(s);const n=Math.max(s.length,t.fftSize);for(let i=0;i<n;i+=1)e[i]=(s[i]-128)*.0078125;return e}},v$=(t,e)=>(s,n)=>{const i=s.createAnalyser();if(Zt(i,n),!(n.maxDecibels>n.minDecibels))throw e();return vt(i,n,"fftSize"),vt(i,n,"maxDecibels"),vt(i,n,"minDecibels"),vt(i,n,"smoothingTimeConstant"),t(AN,()=>AN(i))||b$(i),i},y$=t=>t===null?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,It=(t,e,s)=>{const n=e[s];n!==void 0&&n!==t[s].value&&(t[s].value=n)},_$=t=>{t.start=(e=>{let s=!1;return(n=0,i=0,r)=>{if(s)throw os();e.call(t,n,i,r),s=!0}})(t.start)},$y=t=>{t.start=(e=>(s=0,n=0,i)=>{if(typeof i=="number"&&i<0||n<0||s<0)throw new RangeError("The parameters can't be negative.");e.call(t,s,n,i)})(t.start)},Hy=t=>{t.stop=(e=>(s=0)=>{if(s<0)throw new RangeError("The parameter can't be negative.");e.call(t,s)})(t.stop)},w$=(t,e,s,n,i,r,a,l,c,u,d)=>(h,f)=>{const m=h.createBufferSource();return Zt(m,f),It(m,f,"playbackRate"),vt(m,f,"buffer"),vt(m,f,"loop"),vt(m,f,"loopEnd"),vt(m,f,"loopStart"),e(s,()=>s(h))||_$(m),e(n,()=>n(h))||c(m),e(i,()=>i(h))||u(m,h),e(r,()=>r(h))||$y(m),e(a,()=>a(h))||d(m,h),e(l,()=>l(h))||Hy(m),t(h,m),m},k$=t=>t===null?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,N$=(t,e)=>(s,n,i)=>{const r=s.destination;if(r.channelCount!==n)try{r.channelCount=n}catch{}i&&r.channelCountMode!=="explicit"&&(r.channelCountMode="explicit"),r.maxChannelCount===0&&Object.defineProperty(r,"maxChannelCount",{value:n});const a=t(s,{channelCount:n,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(a,"channelCount",l=>()=>l.call(a),l=>c=>{l.call(a,c);try{r.channelCount=c}catch(u){if(c>r.maxChannelCount)throw u}}),e(a,"channelCountMode",l=>()=>l.call(a),l=>c=>{l.call(a,c),r.channelCountMode=c}),e(a,"channelInterpretation",l=>()=>l.call(a),l=>c=>{l.call(a,c),r.channelInterpretation=c}),Object.defineProperty(a,"maxChannelCount",{get:()=>r.maxChannelCount}),a.connect(r),a},S$=t=>t===null?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,T$=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},E$=(t,e,s,n,i)=>(r,a,l,c,u,d)=>{if(l!==null)try{const h=new l(r,c,d),f=new Map;let m=null;if(Object.defineProperties(h,{channelCount:{get:()=>d.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>m,set:b=>{typeof m=="function"&&h.removeEventListener("processorerror",m),m=typeof b=="function"?b:null,typeof m=="function"&&h.addEventListener("processorerror",m)}}}),h.addEventListener=(b=>(...x)=>{if(x[0]==="processorerror"){const v=typeof x[1]=="function"?x[1]:typeof x[1]=="object"&&x[1]!==null&&typeof x[1].handleEvent=="function"?x[1].handleEvent:null;if(v!==null){const g=f.get(x[1]);g!==void 0?x[1]=g:(x[1]=p=>{p.type==="error"?(Object.defineProperties(p,{type:{value:"processorerror"}}),v(p)):v(new ErrorEvent(x[0],{...p}))},f.set(v,x[1]))}}return b.call(h,"error",x[1],x[2]),b.call(h,...x)})(h.addEventListener),h.removeEventListener=(b=>(...x)=>{if(x[0]==="processorerror"){const v=f.get(x[1]);v!==void 0&&(f.delete(x[1]),x[1]=v)}return b.call(h,"error",x[1],x[2]),b.call(h,x[0],x[1],x[2])})(h.removeEventListener),d.numberOfOutputs!==0){const b=s(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return h.connect(b).connect(r.destination),i(h,()=>b.disconnect(),()=>b.connect(r.destination))}return h}catch(h){throw h.code===11?n():h}if(u===void 0)throw n();return T$(d),e(r,a,u,d)},pC=(t,e)=>t===null?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),A$=t=>new Promise((e,s)=>{const{port1:n,port2:i}=new MessageChannel;n.onmessage=({data:r})=>{n.close(),i.close(),e(r)},n.onmessageerror=({data:r})=>{n.close(),i.close(),s(r)},i.postMessage(t)}),j$=async(t,e)=>{const s=await A$(e);return new t(s)},C$=(t,e,s,n)=>{let i=Zx.get(t);i===void 0&&(i=new WeakMap,Zx.set(t,i));const r=j$(s,n);return i.set(e,r),r},R$=(t,e,s,n,i,r,a,l,c,u,d,h,f)=>(m,b,x,v)=>{if(v.numberOfInputs===0&&v.numberOfOutputs===0)throw c();const g=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(g.some(se=>se<1))throw c();if(g.length!==v.numberOfOutputs)throw e();if(v.channelCountMode!=="explicit")throw c();const p=v.channelCount*v.numberOfInputs,y=g.reduce((se,le)=>se+le,0),k=x.parameterDescriptors===void 0?0:x.parameterDescriptors.length;if(p+k>6||y>6)throw c();const w=new MessageChannel,S=[],_=[];for(let se=0;se<v.numberOfInputs;se+=1)S.push(a(m,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),_.push(i(m,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const T=[];if(x.parameterDescriptors!==void 0)for(const{defaultValue:se,maxValue:le,minValue:ke,name:we}of x.parameterDescriptors){const Q=r(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:v.parameterData[we]!==void 0?v.parameterData[we]:se===void 0?0:se});Object.defineProperties(Q.offset,{defaultValue:{get:()=>se===void 0?0:se},maxValue:{get:()=>le===void 0?_s:le},minValue:{get:()=>ke===void 0?Ds:ke}}),T.push(Q)}const E=n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,p+k)}),A=pC(b,m.sampleRate),j=l(m,A,p+k,Math.max(1,y)),O=i(m,{channelCount:Math.max(1,y),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,y)}),H=[];for(let se=0;se<v.numberOfOutputs;se+=1)H.push(n(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:g[se]}));for(let se=0;se<v.numberOfInputs;se+=1){S[se].connect(_[se]);for(let le=0;le<v.channelCount;le+=1)_[se].connect(E,le,se*v.channelCount+le)}const G=new hC(x.parameterDescriptors===void 0?[]:x.parameterDescriptors.map(({name:se},le)=>{const ke=T[le];return ke.connect(E,0,p+le),ke.start(0),[se,ke.offset]}));E.connect(j);let L=v.channelInterpretation,M=null;const D=v.numberOfOutputs===0?[j]:H,I={get bufferSize(){return A},get channelCount(){return v.channelCount},set channelCount(se){throw s()},get channelCountMode(){return v.channelCountMode},set channelCountMode(se){throw s()},get channelInterpretation(){return L},set channelInterpretation(se){for(const le of S)le.channelInterpretation=se;L=se},get context(){return j.context},get inputs(){return S},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return M},set onprocessorerror(se){typeof M=="function"&&I.removeEventListener("processorerror",M),M=typeof se=="function"?se:null,typeof M=="function"&&I.addEventListener("processorerror",M)},get parameters(){return G},get port(){return w.port2},addEventListener(...se){return j.addEventListener(se[0],se[1],se[2])},connect:t.bind(null,D),disconnect:u.bind(null,D),dispatchEvent(...se){return j.dispatchEvent(se[0])},removeEventListener(...se){return j.removeEventListener(se[0],se[1],se[2])}},F=new Map;w.port1.addEventListener=(se=>(...le)=>{if(le[0]==="message"){const ke=typeof le[1]=="function"?le[1]:typeof le[1]=="object"&&le[1]!==null&&typeof le[1].handleEvent=="function"?le[1].handleEvent:null;if(ke!==null){const we=F.get(le[1]);we!==void 0?le[1]=we:(le[1]=Q=>{d(m.currentTime,m.sampleRate,()=>ke(Q))},F.set(ke,le[1]))}}return se.call(w.port1,le[0],le[1],le[2])})(w.port1.addEventListener),w.port1.removeEventListener=(se=>(...le)=>{if(le[0]==="message"){const ke=F.get(le[1]);ke!==void 0&&(F.delete(le[1]),le[1]=ke)}return se.call(w.port1,le[0],le[1],le[2])})(w.port1.removeEventListener);let U=null;Object.defineProperty(w.port1,"onmessage",{get:()=>U,set:se=>{typeof U=="function"&&w.port1.removeEventListener("message",U),U=typeof se=="function"?se:null,typeof U=="function"&&(w.port1.addEventListener("message",U),w.port1.start())}}),x.prototype.port=w.port1;let R=null;C$(m,I,x,v).then(se=>R=se);const $=Tm(v.numberOfInputs,v.channelCount),V=Tm(v.numberOfOutputs,g),P=x.parameterDescriptors===void 0?[]:x.parameterDescriptors.reduce((se,{name:le})=>({...se,[le]:new Float32Array(128)}),{});let W=!0;const J=()=>{v.numberOfOutputs>0&&j.disconnect(O);for(let se=0,le=0;se<v.numberOfOutputs;se+=1){const ke=H[se];for(let we=0;we<g[se];we+=1)O.disconnect(ke,le+we,we);le+=g[se]}},Y=new Map;j.onaudioprocess=({inputBuffer:se,outputBuffer:le})=>{if(R!==null){const ke=h(I);for(let we=0;we<A;we+=128){for(let Q=0;Q<v.numberOfInputs;Q+=1)for(let Z=0;Z<v.channelCount;Z+=1)Sm(se,$[Q],Z,Z,we);x.parameterDescriptors!==void 0&&x.parameterDescriptors.forEach(({name:Q},Z)=>{Sm(se,P,Q,p+Z,we)});for(let Q=0;Q<v.numberOfInputs;Q+=1)for(let Z=0;Z<g[Q];Z+=1)V[Q][Z].byteLength===0&&(V[Q][Z]=new Float32Array(128));try{const Q=$.map((B,ae)=>{if(ke[ae].size>0)return Y.set(ae,A/128),B;const Ae=Y.get(ae);return Ae===void 0?[]:(B.every(Et=>Et.every(Mt=>Mt===0))&&(Ae===1?Y.delete(ae):Y.set(ae,Ae-1)),B)});W=d(m.currentTime+we/m.sampleRate,m.sampleRate,()=>R.process(Q,V,P));for(let B=0,ae=0;B<v.numberOfOutputs;B+=1){for(let K=0;K<g[B];K+=1)fC(le,V[B],K,ae+K,we);ae+=g[B]}}catch(Q){W=!1,I.dispatchEvent(new ErrorEvent("processorerror",{colno:Q.colno,filename:Q.filename,lineno:Q.lineno,message:Q.message}))}if(!W){for(let Q=0;Q<v.numberOfInputs;Q+=1){S[Q].disconnect(_[Q]);for(let Z=0;Z<v.channelCount;Z+=1)_[we].disconnect(E,Z,Q*v.channelCount+Z)}if(x.parameterDescriptors!==void 0){const Q=x.parameterDescriptors.length;for(let Z=0;Z<Q;Z+=1){const B=T[Z];B.disconnect(E,0,p+Z),B.stop()}}E.disconnect(j),j.onaudioprocess=null,he?J():ne();break}}}};let he=!1;const fe=a(m,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ce=()=>j.connect(fe).connect(m.destination),ne=()=>{j.disconnect(fe),fe.disconnect()},Le=()=>{if(W){ne(),v.numberOfOutputs>0&&j.connect(O);for(let se=0,le=0;se<v.numberOfOutputs;se+=1){const ke=H[se];for(let we=0;we<g[se];we+=1)O.connect(ke,le+we,we);le+=g[se]}}he=!0},lt=()=>{W&&(ce(),J()),he=!1};return ce(),f(I,Le,lt)},gC=(t,e)=>{const s=t.createBiquadFilter();return Zt(s,e),It(s,e,"Q"),It(s,e,"detune"),It(s,e,"frequency"),It(s,e,"gain"),vt(s,e,"type"),s},I$=(t,e)=>(s,n)=>{const i=s.createChannelMerger(n.numberOfInputs);return t!==null&&t.name==="webkitAudioContext"&&e(s,i),Zt(i,n),i},O$=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:s=>{if(s!==e)throw os()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:s=>{if(s!=="explicit")throw os()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:s=>{if(s!=="discrete")throw os()}})},Yd=(t,e)=>{const s=t.createChannelSplitter(e.numberOfOutputs);return Zt(s,e),O$(s),s},M$=(t,e,s,n,i)=>(r,a)=>{if(r.createConstantSource===void 0)return s(r,a);const l=r.createConstantSource();return Zt(l,a),It(l,a,"offset"),e(n,()=>n(r))||$y(l),e(i,()=>i(r))||Hy(l),t(r,l),l},wc=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),D$=(t,e,s,n)=>(i,{offset:r,...a})=>{const l=i.createBuffer(1,2,44100),c=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),u=s(i,{...a,gain:r}),d=l.getChannelData(0);d[0]=1,d[1]=1,c.buffer=l,c.loop=!0;const h={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(b){u.channelCount=b},get channelCountMode(){return u.channelCountMode},set channelCountMode(b){u.channelCountMode=b},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(b){u.channelInterpretation=b},get context(){return u.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get offset(){return u.gain},get onended(){return c.onended},set onended(b){c.onended=b},addEventListener(...b){return c.addEventListener(b[0],b[1],b[2])},dispatchEvent(...b){return c.dispatchEvent(b[0])},removeEventListener(...b){return c.removeEventListener(b[0],b[1],b[2])},start(b=0){c.start.call(c,b)},stop(b=0){c.stop.call(c,b)}},f=()=>c.connect(u),m=()=>c.disconnect(u);return t(i,c),n(wc(h,u),f,m)},L$=(t,e)=>(s,n)=>{const i=s.createConvolver();if(Zt(i,n),n.disableNormalization===i.normalize&&(i.normalize=!n.disableNormalization),vt(i,n,"buffer"),n.channelCount>2||(e(i,"channelCount",r=>()=>r.call(i),r=>a=>{if(a>2)throw t();return r.call(i,a)}),n.channelCountMode==="max"))throw t();return e(i,"channelCountMode",r=>()=>r.call(i),r=>a=>{if(a==="max")throw t();return r.call(i,a)}),i},xC=(t,e)=>{const s=t.createDelay(e.maxDelayTime);return Zt(s,e),It(s,e,"delayTime"),s},P$=t=>(e,s)=>{const n=e.createDynamicsCompressor();if(Zt(n,s),s.channelCount>2||s.channelCountMode==="max")throw t();return It(n,s,"attack"),It(n,s,"knee"),It(n,s,"ratio"),It(n,s,"release"),It(n,s,"threshold"),n},$s=(t,e)=>{const s=t.createGain();return Zt(s,e),It(s,e,"gain"),s},V$=t=>(e,s,n)=>{if(e.createIIRFilter===void 0)return t(e,s,n);const i=e.createIIRFilter(n.feedforward,n.feedback);return Zt(i,n),i};function B$(t,e){const s=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/s,(t[1]*e[0]-t[0]*e[1])/s]}function F$(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function jN(t,e){let s=[0,0];for(let n=t.length-1;n>=0;n-=1)s=F$(s,e),s[0]+=t[n];return s}const U$=(t,e,s,n)=>(i,r,{channelCount:a,channelCountMode:l,channelInterpretation:c,feedback:u,feedforward:d})=>{const h=pC(r,i.sampleRate),f=u instanceof Float64Array?u:new Float64Array(u),m=d instanceof Float64Array?d:new Float64Array(d),b=f.length,x=m.length,v=Math.min(b,x);if(b===0||b>20)throw n();if(f[0]===0)throw e();if(x===0||x>20)throw n();if(m[0]===0)throw e();if(f[0]!==1){for(let T=0;T<x;T+=1)m[T]/=f[0];for(let T=1;T<b;T+=1)f[T]/=f[0]}const g=s(i,h,a,a);g.channelCount=a,g.channelCountMode=l,g.channelInterpretation=c;const p=32,y=[],k=[],w=[];for(let T=0;T<a;T+=1){y.push(0);const E=new Float32Array(p),A=new Float32Array(p);E.fill(0),A.fill(0),k.push(E),w.push(A)}g.onaudioprocess=T=>{const E=T.inputBuffer,A=T.outputBuffer,j=E.numberOfChannels;for(let O=0;O<j;O+=1){const H=E.getChannelData(O),G=A.getChannelData(O);y[O]=mC(f,b,m,x,v,k[O],w[O],y[O],p,H,G)}};const S=i.sampleRate/2;return wc({get bufferSize(){return h},get channelCount(){return g.channelCount},set channelCount(T){g.channelCount=T},get channelCountMode(){return g.channelCountMode},set channelCountMode(T){g.channelCountMode=T},get channelInterpretation(){return g.channelInterpretation},set channelInterpretation(T){g.channelInterpretation=T},get context(){return g.context},get inputs(){return[g]},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},addEventListener(...T){return g.addEventListener(T[0],T[1],T[2])},dispatchEvent(...T){return g.dispatchEvent(T[0])},getFrequencyResponse(T,E,A){if(T.length!==E.length||E.length!==A.length)throw t();const j=T.length;for(let O=0;O<j;O+=1){const H=-Math.PI*(T[O]/S),G=[Math.cos(H),Math.sin(H)],L=jN(m,G),M=jN(f,G),D=B$(L,M);E[O]=Math.sqrt(D[0]*D[0]+D[1]*D[1]),A[O]=Math.atan2(D[1],D[0])}},removeEventListener(...T){return g.removeEventListener(T[0],T[1],T[2])}},g)},$$=(t,e)=>t.createMediaElementSource(e.mediaElement),H$=(t,e)=>{const s=t.createMediaStreamDestination();return Zt(s,e),s.numberOfOutputs===1&&Object.defineProperty(s,"numberOfOutputs",{get:()=>0}),s},G$=(t,{mediaStream:e})=>{const s=e.getAudioTracks();s.sort((r,a)=>r.id<a.id?-1:r.id>a.id?1:0);const n=s.slice(0,1),i=t.createMediaStreamSource(new MediaStream(n));return Object.defineProperty(i,"mediaStream",{value:e}),i},z$=(t,e)=>(s,{mediaStreamTrack:n})=>{if(typeof s.createMediaStreamTrackSource=="function")return s.createMediaStreamTrackSource(n);const i=new MediaStream([n]),r=s.createMediaStreamSource(i);if(n.kind!=="audio")throw t();if(e(s))throw new TypeError;return r},q$=t=>t===null?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,K$=(t,e,s,n,i,r)=>(a,l)=>{const c=a.createOscillator();return Zt(c,l),It(c,l,"detune"),It(c,l,"frequency"),l.periodicWave!==void 0?c.setPeriodicWave(l.periodicWave):vt(c,l,"type"),e(s,()=>s(a))||$y(c),e(n,()=>n(a))||r(c,a),e(i,()=>i(a))||Hy(c),t(a,c),c},W$=t=>(e,s)=>{const n=e.createPanner();return n.orientationX===void 0?t(e,s):(Zt(n,s),It(n,s,"orientationX"),It(n,s,"orientationY"),It(n,s,"orientationZ"),It(n,s,"positionX"),It(n,s,"positionY"),It(n,s,"positionZ"),vt(n,s,"coneInnerAngle"),vt(n,s,"coneOuterAngle"),vt(n,s,"coneOuterGain"),vt(n,s,"distanceModel"),vt(n,s,"maxDistance"),vt(n,s,"panningModel"),vt(n,s,"refDistance"),vt(n,s,"rolloffFactor"),n)},Y$=(t,e,s,n,i,r,a,l,c,u)=>(d,{coneInnerAngle:h,coneOuterAngle:f,coneOuterGain:m,distanceModel:b,maxDistance:x,orientationX:v,orientationY:g,orientationZ:p,panningModel:y,positionX:k,positionY:w,positionZ:S,refDistance:_,rolloffFactor:T,...E})=>{const A=d.createPanner();if(E.channelCount>2||E.channelCountMode==="max")throw a();Zt(A,E);const j={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},O=s(d,{...j,channelInterpretation:"speakers",numberOfInputs:6}),H=n(d,{...E,gain:1}),G=n(d,{...j,gain:1}),L=n(d,{...j,gain:0}),M=n(d,{...j,gain:0}),D=n(d,{...j,gain:0}),I=n(d,{...j,gain:0}),F=n(d,{...j,gain:0}),U=i(d,256,6,1),R=r(d,{...j,curve:new Float32Array([1,1]),oversample:"none"});let C=[v,g,p],$=[k,w,S];const V=new Float32Array(1);U.onaudioprocess=({inputBuffer:Y})=>{const he=[c(Y,V,0),c(Y,V,1),c(Y,V,2)];he.some((ce,ne)=>ce!==C[ne])&&(A.setOrientation(...he),C=he);const fe=[c(Y,V,3),c(Y,V,4),c(Y,V,5)];fe.some((ce,ne)=>ce!==$[ne])&&(A.setPosition(...fe),$=fe)},Object.defineProperty(L.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(F.gain,"defaultValue",{get:()=>0});const P={get bufferSize(){},get channelCount(){return A.channelCount},set channelCount(Y){if(Y>2)throw a();H.channelCount=Y,A.channelCount=Y},get channelCountMode(){return A.channelCountMode},set channelCountMode(Y){if(Y==="max")throw a();H.channelCountMode=Y,A.channelCountMode=Y},get channelInterpretation(){return A.channelInterpretation},set channelInterpretation(Y){H.channelInterpretation=Y,A.channelInterpretation=Y},get coneInnerAngle(){return A.coneInnerAngle},set coneInnerAngle(Y){A.coneInnerAngle=Y},get coneOuterAngle(){return A.coneOuterAngle},set coneOuterAngle(Y){A.coneOuterAngle=Y},get coneOuterGain(){return A.coneOuterGain},set coneOuterGain(Y){if(Y<0||Y>1)throw e();A.coneOuterGain=Y},get context(){return A.context},get distanceModel(){return A.distanceModel},set distanceModel(Y){A.distanceModel=Y},get inputs(){return[H]},get maxDistance(){return A.maxDistance},set maxDistance(Y){if(Y<0)throw new RangeError;A.maxDistance=Y},get numberOfInputs(){return A.numberOfInputs},get numberOfOutputs(){return A.numberOfOutputs},get orientationX(){return G.gain},get orientationY(){return L.gain},get orientationZ(){return M.gain},get panningModel(){return A.panningModel},set panningModel(Y){A.panningModel=Y},get positionX(){return D.gain},get positionY(){return I.gain},get positionZ(){return F.gain},get refDistance(){return A.refDistance},set refDistance(Y){if(Y<0)throw new RangeError;A.refDistance=Y},get rolloffFactor(){return A.rolloffFactor},set rolloffFactor(Y){if(Y<0)throw new RangeError;A.rolloffFactor=Y},addEventListener(...Y){return H.addEventListener(Y[0],Y[1],Y[2])},dispatchEvent(...Y){return H.dispatchEvent(Y[0])},removeEventListener(...Y){return H.removeEventListener(Y[0],Y[1],Y[2])}};h!==P.coneInnerAngle&&(P.coneInnerAngle=h),f!==P.coneOuterAngle&&(P.coneOuterAngle=f),m!==P.coneOuterGain&&(P.coneOuterGain=m),b!==P.distanceModel&&(P.distanceModel=b),x!==P.maxDistance&&(P.maxDistance=x),v!==P.orientationX.value&&(P.orientationX.value=v),g!==P.orientationY.value&&(P.orientationY.value=g),p!==P.orientationZ.value&&(P.orientationZ.value=p),y!==P.panningModel&&(P.panningModel=y),k!==P.positionX.value&&(P.positionX.value=k),w!==P.positionY.value&&(P.positionY.value=w),S!==P.positionZ.value&&(P.positionZ.value=S),_!==P.refDistance&&(P.refDistance=_),T!==P.rolloffFactor&&(P.rolloffFactor=T),(C[0]!==1||C[1]!==0||C[2]!==0)&&A.setOrientation(...C),($[0]!==0||$[1]!==0||$[2]!==0)&&A.setPosition(...$);const W=()=>{H.connect(A),t(H,R,0,0),R.connect(G).connect(O,0,0),R.connect(L).connect(O,0,1),R.connect(M).connect(O,0,2),R.connect(D).connect(O,0,3),R.connect(I).connect(O,0,4),R.connect(F).connect(O,0,5),O.connect(U).connect(d.destination)},J=()=>{H.disconnect(A),l(H,R,0,0),R.disconnect(G),G.disconnect(O),R.disconnect(L),L.disconnect(O),R.disconnect(M),M.disconnect(O),R.disconnect(D),D.disconnect(O),R.disconnect(I),I.disconnect(O),R.disconnect(F),F.disconnect(O),O.disconnect(U),U.disconnect(d.destination)};return u(wc(P,A),W,J)},X$=t=>(e,{disableNormalization:s,imag:n,real:i})=>{const r=n instanceof Float32Array?n:new Float32Array(n),a=i instanceof Float32Array?i:new Float32Array(i),l=e.createPeriodicWave(a,r,{disableNormalization:s});if(Array.from(n).length<2)throw t();return l},Xd=(t,e,s,n)=>t.createScriptProcessor(e,s,n),Q$=(t,e)=>(s,n)=>{const i=n.channelCountMode;if(i==="clamped-max")throw e();if(s.createStereoPanner===void 0)return t(s,n);const r=s.createStereoPanner();return Zt(r,n),It(r,n,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:a=>{if(a!==i)throw e()}}),r},J$=(t,e,s,n,i,r)=>{const l=new Float32Array([1,1]),c=Math.PI/2,u={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},d={...u,oversample:"none"},h=(b,x,v,g)=>{const p=new Float32Array(16385),y=new Float32Array(16385);for(let E=0;E<16385;E+=1){const A=E/16384*c;p[E]=Math.cos(A),y[E]=Math.sin(A)}const k=s(b,{...u,gain:0}),w=n(b,{...d,curve:p}),S=n(b,{...d,curve:l}),_=s(b,{...u,gain:0}),T=n(b,{...d,curve:y});return{connectGraph(){x.connect(k),x.connect(S.inputs===void 0?S:S.inputs[0]),x.connect(_),S.connect(v),v.connect(w.inputs===void 0?w:w.inputs[0]),v.connect(T.inputs===void 0?T:T.inputs[0]),w.connect(k.gain),T.connect(_.gain),k.connect(g,0,0),_.connect(g,0,1)},disconnectGraph(){x.disconnect(k),x.disconnect(S.inputs===void 0?S:S.inputs[0]),x.disconnect(_),S.disconnect(v),v.disconnect(w.inputs===void 0?w:w.inputs[0]),v.disconnect(T.inputs===void 0?T:T.inputs[0]),w.disconnect(k.gain),T.disconnect(_.gain),k.disconnect(g,0,0),_.disconnect(g,0,1)}}},f=(b,x,v,g)=>{const p=new Float32Array(16385),y=new Float32Array(16385),k=new Float32Array(16385),w=new Float32Array(16385),S=Math.floor(16385/2);for(let D=0;D<16385;D+=1)if(D>S){const I=(D-S)/(16384-S)*c;p[D]=Math.cos(I),y[D]=Math.sin(I),k[D]=0,w[D]=1}else{const I=D/(16384-S)*c;p[D]=1,y[D]=0,k[D]=Math.cos(I),w[D]=Math.sin(I)}const _=e(b,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),T=s(b,{...u,gain:0}),E=n(b,{...d,curve:p}),A=s(b,{...u,gain:0}),j=n(b,{...d,curve:y}),O=n(b,{...d,curve:l}),H=s(b,{...u,gain:0}),G=n(b,{...d,curve:k}),L=s(b,{...u,gain:0}),M=n(b,{...d,curve:w});return{connectGraph(){x.connect(_),x.connect(O.inputs===void 0?O:O.inputs[0]),_.connect(T,0),_.connect(A,0),_.connect(H,1),_.connect(L,1),O.connect(v),v.connect(E.inputs===void 0?E:E.inputs[0]),v.connect(j.inputs===void 0?j:j.inputs[0]),v.connect(G.inputs===void 0?G:G.inputs[0]),v.connect(M.inputs===void 0?M:M.inputs[0]),E.connect(T.gain),j.connect(A.gain),G.connect(H.gain),M.connect(L.gain),T.connect(g,0,0),H.connect(g,0,0),A.connect(g,0,1),L.connect(g,0,1)},disconnectGraph(){x.disconnect(_),x.disconnect(O.inputs===void 0?O:O.inputs[0]),_.disconnect(T,0),_.disconnect(A,0),_.disconnect(H,1),_.disconnect(L,1),O.disconnect(v),v.disconnect(E.inputs===void 0?E:E.inputs[0]),v.disconnect(j.inputs===void 0?j:j.inputs[0]),v.disconnect(G.inputs===void 0?G:G.inputs[0]),v.disconnect(M.inputs===void 0?M:M.inputs[0]),E.disconnect(T.gain),j.disconnect(A.gain),G.disconnect(H.gain),M.disconnect(L.gain),T.disconnect(g,0,0),H.disconnect(g,0,0),A.disconnect(g,0,1),L.disconnect(g,0,1)}}},m=(b,x,v,g,p)=>{if(x===1)return h(b,v,g,p);if(x===2)return f(b,v,g,p);throw i()};return(b,{channelCount:x,channelCountMode:v,pan:g,...p})=>{if(v==="max")throw i();const y=t(b,{...p,channelCount:1,channelCountMode:v,numberOfInputs:2}),k=s(b,{...p,channelCount:x,channelCountMode:v,gain:1}),w=s(b,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:g});let{connectGraph:S,disconnectGraph:_}=m(b,x,k,w,y);Object.defineProperty(w.gain,"defaultValue",{get:()=>0}),Object.defineProperty(w.gain,"maxValue",{get:()=>1}),Object.defineProperty(w.gain,"minValue",{get:()=>-1});const T={get bufferSize(){},get channelCount(){return k.channelCount},set channelCount(O){k.channelCount!==O&&(E&&_(),{connectGraph:S,disconnectGraph:_}=m(b,O,k,w,y),E&&S()),k.channelCount=O},get channelCountMode(){return k.channelCountMode},set channelCountMode(O){if(O==="clamped-max"||O==="max")throw i();k.channelCountMode=O},get channelInterpretation(){return k.channelInterpretation},set channelInterpretation(O){k.channelInterpretation=O},get context(){return k.context},get inputs(){return[k]},get numberOfInputs(){return k.numberOfInputs},get numberOfOutputs(){return k.numberOfOutputs},get pan(){return w.gain},addEventListener(...O){return k.addEventListener(O[0],O[1],O[2])},dispatchEvent(...O){return k.dispatchEvent(O[0])},removeEventListener(...O){return k.removeEventListener(O[0],O[1],O[2])}};let E=!1;const A=()=>{S(),E=!0},j=()=>{_(),E=!1};return r(wc(T,y),A,j)}},Z$=(t,e,s,n,i,r,a)=>(l,c)=>{const u=l.createWaveShaper();if(r!==null&&r.name==="webkitAudioContext"&&l.createGain().gain.automationRate===void 0)return s(l,c);Zt(u,c);const d=c.curve===null||c.curve instanceof Float32Array?c.curve:new Float32Array(c.curve);if(d!==null&&d.length<2)throw e();vt(u,{curve:d},"curve"),vt(u,c,"oversample");let h=null,f=!1;return a(u,"curve",x=>()=>x.call(u),x=>v=>(x.call(u,v),f&&(n(v)&&h===null?h=t(l,u):!n(v)&&h!==null&&(h(),h=null)),v)),i(u,()=>{f=!0,n(u.curve)&&(h=t(l,u))},()=>{f=!1,h!==null&&(h(),h=null)})},eH=(t,e,s,n,i)=>(r,{curve:a,oversample:l,...c})=>{const u=r.createWaveShaper(),d=r.createWaveShaper();Zt(u,c),Zt(d,c);const h=s(r,{...c,gain:1}),f=s(r,{...c,gain:-1}),m=s(r,{...c,gain:1}),b=s(r,{...c,gain:-1});let x=null,v=!1,g=null;const p={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(w){h.channelCount=w,f.channelCount=w,u.channelCount=w,m.channelCount=w,d.channelCount=w,b.channelCount=w},get channelCountMode(){return u.channelCountMode},set channelCountMode(w){h.channelCountMode=w,f.channelCountMode=w,u.channelCountMode=w,m.channelCountMode=w,d.channelCountMode=w,b.channelCountMode=w},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(w){h.channelInterpretation=w,f.channelInterpretation=w,u.channelInterpretation=w,m.channelInterpretation=w,d.channelInterpretation=w,b.channelInterpretation=w},get context(){return u.context},get curve(){return g},set curve(w){if(w!==null&&w.length<2)throw e();if(w===null)u.curve=w,d.curve=w;else{const S=w.length,_=new Float32Array(S+2-S%2),T=new Float32Array(S+2-S%2);_[0]=w[0],T[0]=-w[S-1];const E=Math.ceil((S+1)/2),A=(S+1)/2-1;for(let j=1;j<E;j+=1){const O=j/E*A,H=Math.floor(O),G=Math.ceil(O);_[j]=H===G?w[H]:(1-(O-H))*w[H]+(1-(G-O))*w[G],T[j]=H===G?-w[S-1-H]:-((1-(O-H))*w[S-1-H])-(1-(G-O))*w[S-1-G]}_[E]=S%2===1?w[E-1]:(w[E-2]+w[E-1])/2,u.curve=_,d.curve=T}g=w,v&&(n(g)&&x===null?x=t(r,h):x!==null&&(x(),x=null))},get inputs(){return[h]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get oversample(){return u.oversample},set oversample(w){u.oversample=w,d.oversample=w},addEventListener(...w){return h.addEventListener(w[0],w[1],w[2])},dispatchEvent(...w){return h.dispatchEvent(w[0])},removeEventListener(...w){return h.removeEventListener(w[0],w[1],w[2])}};a!==null&&(p.curve=a instanceof Float32Array?a:new Float32Array(a)),l!==p.oversample&&(p.oversample=l);const y=()=>{h.connect(u).connect(m),h.connect(f).connect(d).connect(b).connect(m),v=!0,n(g)&&(x=t(r,h))},k=()=>{h.disconnect(u),u.disconnect(m),h.disconnect(f),f.disconnect(d),d.disconnect(b),b.disconnect(m),v=!1,x!==null&&(x(),x=null)};return i(wc(p,m),y,k)},js=()=>new DOMException("","NotSupportedError"),tH={numberOfChannels:1},sH=(t,e,s,n,i)=>class extends t{constructor(a,l,c){let u;if(typeof a=="number"&&l!==void 0&&c!==void 0)u={length:l,numberOfChannels:a,sampleRate:c};else if(typeof a=="object")u=a;else throw new Error("The given parameters are not valid.");const{length:d,numberOfChannels:h,sampleRate:f}={...tH,...u},m=n(h,d,f);e(rd,()=>rd(m))||m.addEventListener("statechange",(()=>{let b=0;const x=v=>{this._state==="running"&&(b>0?(m.removeEventListener("statechange",x),v.stopImmediatePropagation(),this._waitForThePromiseToSettle(v)):b+=1)};return x})()),super(m,h),this._length=d,this._nativeOfflineAudioContext=m,this._state=null}get length(){return this._nativeOfflineAudioContext.length===void 0?this._length:this._nativeOfflineAudioContext.length}get state(){return this._state===null?this._nativeOfflineAudioContext.state:this._state}startRendering(){return this._state==="running"?Promise.reject(s()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally(()=>{this._state=null,lC(this)}))}_waitForThePromiseToSettle(a){this._state===null?this._nativeOfflineAudioContext.dispatchEvent(a):setTimeout(()=>this._waitForThePromiseToSettle(a))}},nH={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},iH=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...nH,...u},f=s(d,h),m=r(d),b=m?n():null,x=c.sampleRate/2;super(c,!1,f,b),this._detune=e(this,m,f.detune,153600,-153600),this._frequency=e(this,m,f.frequency,x,-x),this._nativeOscillatorNode=f,this._onended=null,this._oscillatorNodeRenderer=b,this._oscillatorNodeRenderer!==null&&h.periodicWave!==void 0&&(this._oscillatorNodeRenderer.periodicWave=h.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(c){const u=typeof c=="function"?a(this,c):null;this._nativeOscillatorNode.onended=u;const d=this._nativeOscillatorNode.onended;this._onended=d!==null&&d===u?c:d}get type(){return this._nativeOscillatorNode.type}set type(c){this._nativeOscillatorNode.type=c,this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(c){this._nativeOscillatorNode.setPeriodicWave(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.periodicWave=c)}start(c=0){if(this._nativeOscillatorNode.start(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.start=c),this.context.state!=="closed"){Yl(this);const u=()=>{this._nativeOscillatorNode.removeEventListener("ended",u),Hi(this)&&qd(this)};this._nativeOscillatorNode.addEventListener("ended",u)}}stop(c=0){this._nativeOscillatorNode.stop(c),this._oscillatorNodeRenderer!==null&&(this._oscillatorNodeRenderer.stop=c)}},rH=(t,e,s,n,i)=>()=>{const r=new WeakMap;let a=null,l=null,c=null;const u=async(d,h)=>{let f=s(d);const m=vs(f,h);if(!m){const b={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:a===null?void 0:a,type:f.type};f=e(h,b),l!==null&&f.start(l),c!==null&&f.stop(c)}return r.set(h,f),m?(await t(h,d.detune,f.detune),await t(h,d.frequency,f.frequency)):(await n(h,d.detune,f.detune),await n(h,d.frequency,f.frequency)),await i(d,h,f),f};return{set periodicWave(d){a=d},set start(d){l=d},set stop(d){c=d},render(d,h){const f=r.get(h);return f!==void 0?Promise.resolve(f):u(d,h)}}},aH={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},oH=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...aH,...u},f=s(d,h),m=r(d),b=m?n():null;super(c,!1,f,b),this._nativePannerNode=f,this._orientationX=e(this,m,f.orientationX,_s,Ds),this._orientationY=e(this,m,f.orientationY,_s,Ds),this._orientationZ=e(this,m,f.orientationZ,_s,Ds),this._positionX=e(this,m,f.positionX,_s,Ds),this._positionY=e(this,m,f.positionY,_s,Ds),this._positionZ=e(this,m,f.positionZ,_s,Ds),a(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(c){this._nativePannerNode.coneInnerAngle=c}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(c){this._nativePannerNode.coneOuterAngle=c}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(c){this._nativePannerNode.coneOuterGain=c}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(c){this._nativePannerNode.distanceModel=c}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(c){this._nativePannerNode.maxDistance=c}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(c){this._nativePannerNode.panningModel=c}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(c){this._nativePannerNode.refDistance=c}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(c){this._nativePannerNode.rolloffFactor=c}},lH=(t,e,s,n,i,r,a,l,c,u)=>()=>{const d=new WeakMap;let h=null;const f=async(m,b)=>{let x=null,v=r(m);const g={channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation},p={...g,coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,panningModel:v.panningModel,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor},y=vs(v,b);if("bufferSize"in v)x=n(b,{...g,gain:1});else if(!y){const k={...p,orientationX:v.orientationX.value,orientationY:v.orientationY.value,orientationZ:v.orientationZ.value,positionX:v.positionX.value,positionY:v.positionY.value,positionZ:v.positionZ.value};v=i(b,k)}if(d.set(b,x===null?v:x),x!==null){if(h===null){if(a===null)throw new Error("Missing the native OfflineAudioContext constructor.");const j=new a(6,m.context.length,b.sampleRate),O=e(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});O.connect(j.destination),h=(async()=>{const H=await Promise.all([m.orientationX,m.orientationY,m.orientationZ,m.positionX,m.positionY,m.positionZ].map(async(G,L)=>{const M=s(j,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:L===0?1:0});return await l(j,G,M.offset),M}));for(let G=0;G<6;G+=1)H[G].connect(O,0,G),H[G].start(0);return u(j)})()}const k=await h,w=n(b,{...g,gain:1});await c(m,b,w);const S=[];for(let j=0;j<k.numberOfChannels;j+=1)S.push(k.getChannelData(j));let _=[S[0][0],S[1][0],S[2][0]],T=[S[3][0],S[4][0],S[5][0]],E=n(b,{...g,gain:1}),A=i(b,{...p,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:T[0],positionY:T[1],positionZ:T[2]});w.connect(E).connect(A.inputs[0]),A.connect(x);for(let j=128;j<k.length;j+=128){const O=[S[0][j],S[1][j],S[2][j]],H=[S[3][j],S[4][j],S[5][j]];if(O.some((G,L)=>G!==_[L])||H.some((G,L)=>G!==T[L])){_=O,T=H;const G=j/b.sampleRate;E.gain.setValueAtTime(0,G),E=n(b,{...g,gain:0}),A=i(b,{...p,orientationX:_[0],orientationY:_[1],orientationZ:_[2],positionX:T[0],positionY:T[1],positionZ:T[2]}),E.gain.setValueAtTime(1,G),w.connect(E).connect(A.inputs[0]),A.connect(x)}}return x}return y?(await t(b,m.orientationX,v.orientationX),await t(b,m.orientationY,v.orientationY),await t(b,m.orientationZ,v.orientationZ),await t(b,m.positionX,v.positionX),await t(b,m.positionY,v.positionY),await t(b,m.positionZ,v.positionZ)):(await l(b,m.orientationX,v.orientationX),await l(b,m.orientationY,v.orientationY),await l(b,m.orientationZ,v.orientationZ),await l(b,m.positionX,v.positionX),await l(b,m.positionY,v.positionY),await l(b,m.positionZ,v.positionZ)),_c(v)?await c(m,b,v.inputs[0]):await c(m,b,v),v};return{render(m,b){const x=d.get(b);return x!==void 0?Promise.resolve(x):f(m,b)}}},cH={disableNormalization:!1},uH=(t,e,s,n)=>class bC{constructor(r,a){const l=e(r),c=n({...cH,...a}),u=t(l,c);return s.add(u),u}static[Symbol.hasInstance](r){return r!==null&&typeof r=="object"&&Object.getPrototypeOf(r)===bC.prototype||s.has(r)}},dH=(t,e)=>(s,n,i)=>(t(n).replay(i),e(n,s,i)),hH=(t,e,s)=>async(n,i,r)=>{const a=t(n);await Promise.all(a.activeInputs.map((l,c)=>Array.from(l).map(async([u,d])=>{const f=await e(u).render(u,i),m=n.context.destination;!s(u)&&(n!==m||!s(n))&&f.connect(r,d,c)})).reduce((l,c)=>[...l,...c],[]))},fH=(t,e,s)=>async(n,i,r)=>{const a=e(n);await Promise.all(Array.from(a.activeInputs).map(async([l,c])=>{const d=await t(l).render(l,i);s(l)||d.connect(r,c)}))},mH=(t,e,s,n)=>i=>t(rd,()=>rd(i))?Promise.resolve(t(n,n)).then(r=>{if(!r){const a=s(i,512,0,1);i.oncomplete=()=>{a.onaudioprocess=null,a.disconnect()},a.onaudioprocess=()=>i.currentTime,a.connect(i.destination)}return i.startRendering()}):new Promise(r=>{const a=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=l=>{a.disconnect(),r(l.renderedBuffer)},a.connect(i.destination),i.startRendering()}),pH=t=>(e,s)=>{t.set(e,s)},gH=t=>(e,s)=>t.set(e,s),xH=(t,e,s,n,i,r,a,l)=>(c,u)=>s(c).render(c,u).then(()=>Promise.all(Array.from(n(u)).map(d=>s(d).render(d,u)))).then(()=>i(u)).then(d=>(typeof d.copyFromChannel!="function"?(a(d),By(d)):e(r,()=>r(d))||l(d),t.add(d),d)),bH={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},vH=(t,e,s,n,i,r)=>class extends t{constructor(l,c){const u=i(l),d={...bH,...c},h=s(u,d),f=r(u),m=f?n():null;super(l,!1,h,m),this._pan=e(this,f,h.pan)}get pan(){return this._pan}},yH=(t,e,s,n,i)=>()=>{const r=new WeakMap,a=async(l,c)=>{let u=s(l);const d=vs(u,c);if(!d){const h={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(c,h)}return r.set(c,u),d?await t(c,l.pan,u.pan):await n(c,l.pan,u.pan),_c(u)?await i(l,c,u.inputs[0]):await i(l,c,u),u};return{render(l,c){const u=r.get(c);return u!==void 0?Promise.resolve(u):a(l,c)}}},_H=t=>()=>{if(t===null)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},wH=(t,e)=>async()=>{if(t===null)return!0;if(e===null)return!1;const s=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),n=new e(1,128,44100),i=URL.createObjectURL(s);let r=!1,a=!1;try{await n.audioWorklet.addModule(i);const l=new t(n,"a",{numberOfOutputs:0}),c=n.createOscillator();l.port.onmessage=()=>r=!0,l.onprocessorerror=()=>a=!0,c.connect(l),c.start(0),await n.startRendering(),await new Promise(u=>setTimeout(u))}catch{}finally{URL.revokeObjectURL(i)}return r&&!a},kH=(t,e)=>()=>{if(e===null)return Promise.resolve(!1);const s=new e(1,1,44100),n=t(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise(i=>{s.oncomplete=()=>{n.disconnect(),i(s.currentTime!==0)},s.startRendering()})},NH=()=>new DOMException("","UnknownError"),SH={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},TH=(t,e,s,n,i,r,a)=>class extends t{constructor(c,u){const d=i(c),h={...SH,...u},f=s(d,h),b=r(d)?n():null;super(c,!0,f,b),this._isCurveNullified=!1,this._nativeWaveShaperNode=f,a(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(c){if(c===null)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(c.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=c}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(c){this._nativeWaveShaperNode.oversample=c}},EH=(t,e,s)=>()=>{const n=new WeakMap,i=async(r,a)=>{let l=e(r);if(!vs(l,a)){const u={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,curve:l.curve,oversample:l.oversample};l=t(a,u)}return n.set(a,l),_c(l)?await s(r,a,l.inputs[0]):await s(r,a,l),l};return{render(r,a){const l=n.get(a);return l!==void 0?Promise.resolve(l):i(r,a)}}},AH=()=>typeof window>"u"?null:window,jH=(t,e)=>s=>{s.copyFromChannel=(n,i,r=0)=>{const a=t(r),l=t(i);if(l>=s.numberOfChannels)throw e();const c=s.length,u=s.getChannelData(l),d=n.length;for(let h=a<0?-a:0;h+a<c&&h<d;h+=1)n[h]=u[h+a]},s.copyToChannel=(n,i,r=0)=>{const a=t(r),l=t(i);if(l>=s.numberOfChannels)throw e();const c=s.length,u=s.getChannelData(l),d=n.length;for(let h=a<0?-a:0;h+a<c&&h<d;h+=1)u[h+a]=n[h]}},CH=t=>e=>{e.copyFromChannel=(s=>(n,i,r=0)=>{const a=t(r),l=t(i);if(a<e.length)return s.call(e,n,l,a)})(e.copyFromChannel),e.copyToChannel=(s=>(n,i,r=0)=>{const a=t(r),l=t(i);if(a<e.length)return s.call(e,n,l,a)})(e.copyToChannel)},RH=t=>(e,s)=>{const n=s.createBuffer(1,1,44100);e.buffer===null&&(e.buffer=n),t(e,"buffer",i=>()=>{const r=i.call(e);return r===n?null:r},i=>r=>i.call(e,r===null?n:r))},IH=(t,e)=>(s,n)=>{n.channelCount=1,n.channelCountMode="explicit",Object.defineProperty(n,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(n,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=s.createBufferSource();e(n,()=>{const l=n.numberOfInputs;for(let c=0;c<l;c+=1)i.connect(n,0,c)},()=>i.disconnect(n))},vC=(t,e,s)=>t.copyFromChannel===void 0?t.getChannelData(s)[0]:(t.copyFromChannel(e,s),e[0]),yC=t=>{if(t===null)return!1;const e=t.length;return e%2!==0?t[Math.floor(e/2)]!==0:t[e/2-1]+t[e/2]!==0},Qd=(t,e,s,n)=>{let i=t;for(;!i.hasOwnProperty(e);)i=Object.getPrototypeOf(i);const{get:r,set:a}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:s(r),set:n(a)})},OH=t=>({...t,outputChannelCount:t.outputChannelCount!==void 0?t.outputChannelCount:t.numberOfInputs===1&&t.numberOfOutputs===1?[t.channelCount]:Array.from({length:t.numberOfOutputs},()=>1)}),MH=t=>({...t,channelCount:t.numberOfOutputs}),DH=t=>{const{imag:e,real:s}=t;return e===void 0?s===void 0?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(s,()=>0),real:s}:s===void 0?{...t,imag:e,real:Array.from(e,()=>0)}:{...t,imag:e,real:s}},_C=(t,e,s)=>{try{t.setValueAtTime(e,s)}catch(n){if(n.code!==9)throw n;_C(t,e,s+1e-7)}},LH=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},PH=t=>{const e=t.createBufferSource(),s=t.createBuffer(1,1,44100);e.buffer=s;try{e.start(0,1)}catch{return!1}return!0},VH=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},Gy=t=>{const e=t.createOscillator();try{e.start(-1)}catch(s){return s instanceof RangeError}return!1},wC=t=>{const e=t.createBuffer(1,1,44100),s=t.createBufferSource();s.buffer=e,s.start(),s.stop();try{return s.stop(),!0}catch{return!1}},zy=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(s){return s instanceof RangeError}return!1},BH=t=>{const{port1:e,port2:s}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),s.close()}},FH=t=>{t.start=(e=>(s=0,n=0,i)=>{const r=t.buffer,a=r===null?n:Math.min(r.duration,n);r!==null&&a>r.duration-.5/t.context.sampleRate?e.call(t,s,0,0):e.call(t,s,a,i)})(t.start)},kC=(t,e)=>{const s=e.createGain();t.connect(s);const n=(i=>()=>{i.call(t,s),t.removeEventListener("ended",n)})(t.disconnect);t.addEventListener("ended",n),wc(t,s),t.stop=(i=>{let r=!1;return(a=0)=>{if(r)try{i.call(t,a)}catch{s.gain.setValueAtTime(0,a)}else i.call(t,a),r=!0}})(t.stop)},kc=(t,e)=>s=>{const n={value:t};return Object.defineProperties(s,{currentTarget:n,target:n}),typeof e=="function"?e.call(t,s):e.handleEvent.call(t,s)},UH=oU(Co),$H=fU(Co),HH=S9(Mp),NC=new WeakMap,GH=H9(NC),Zn=t9(new Map,new WeakMap),ui=AH(),SC=v$(Zn,gi),qy=$9(Ns),xs=hH(Ns,qy,bo),zH=bU(SC,pt,xs),dt=q9(Op),dr=q$(ui),nt=c$(dr),TC=new WeakMap,EC=D9(kc),Jd=k$(ui),Ky=r$(Jd),Wy=a$(ui),AC=o$(ui),ad=S$(ui),Vt=HU(lU(tC),hU(UH,$H,wm,HH,km,Ns,GH,zd,pt,Co,Hi,bo,df),Zn,e$(Qx,km,Ns,pt,id,Hi),gi,Dp,js,_9(wm,Qx,Ns,pt,id,dt,Hi,nt),A9(TC,Ns,Kn),EC,dt,Ky,Wy,AC,nt,ad),qH=xU(Vt,zH,gi,SC,dt,nt),Yy=new WeakSet,CN=y$(ui),jC=m9(new Uint32Array(1)),Xy=jH(jC,gi),Qy=CH(jC),CC=yU(Yy,Zn,js,CN,dr,_H(CN),Xy,Qy),Lp=mU($s),RC=fH(qy,Kd,bo),xi=l9(RC),Nc=w$(Lp,Zn,LH,PH,VH,Gy,wC,zy,FH,RH(Qd),kC),bi=dH(G9(Kd),RC),KH=kU(xi,Nc,pt,bi,xs),ei=GU(cU(sC),TC,Vy,zU,tU,sU,nU,iU,rU,Wx,Zj,Jd,_C),WH=wU(Vt,KH,ei,os,Nc,dt,nt,kc),YH=IU(Vt,OU,gi,os,N$($s,Qd),dt,nt,xs),XH=e9(xi,gC,pt,bi,xs),Ro=gH(NC),QH=ZU(Vt,ei,XH,Dp,gC,dt,nt,Ro),Sa=x$(Co,Wy),JH=IH(os,Sa),Ta=I$(Jd,JH),ZH=i9(Ta,pt,xs),eG=n9(Vt,ZH,Ta,dt,nt),tG=o9(Yd,pt,xs),sG=a9(Vt,tG,Yd,dt,nt,MH),nG=D$(Lp,Nc,$s,Sa),Sc=M$(Lp,Zn,nG,Gy,zy),iG=f9(xi,Sc,pt,bi,xs),rG=h9(Vt,ei,iG,Sc,dt,nt,kc),IC=L$(js,Qd),aG=x9(IC,pt,xs),oG=g9(Vt,aG,IC,dt,nt,Ro),lG=N9(xi,xC,pt,bi,xs),cG=k9(Vt,ei,lG,xC,dt,nt,Ro),OC=P$(js),uG=I9(xi,OC,pt,bi,xs),dG=R9(Vt,ei,uG,OC,js,dt,nt,Ro),hG=F9(xi,$s,pt,bi,xs),fG=B9(Vt,ei,hG,$s,dt,nt),mG=U$(Dp,os,Xd,js),Pp=mH(Zn,$s,Xd,kH($s,dr)),pG=Z9(Nc,pt,dr,xs,Pp),gG=V$(mG),xG=Q9(Vt,gG,pG,dt,nt,Ro),bG=MU(ei,Ta,Sc,Xd,js,vC,nt,Qd),MC=new WeakMap,vG=g$(YH,bG,EC,nt,MC,kc),DC=K$(Lp,Zn,Gy,wC,zy,kC),yG=rH(xi,DC,pt,bi,xs),_G=iH(Vt,ei,DC,yG,dt,nt,kc),LC=u9(Nc),wG=eH(LC,os,$s,yC,Sa),Vp=Z$(LC,os,wG,yC,Sa,Jd,Qd),kG=Y$(wm,os,Ta,$s,Xd,Vp,js,km,vC,Sa),PC=W$(kG),NG=lH(xi,Ta,Sc,$s,PC,pt,dr,bi,xs,Pp),SG=oH(Vt,ei,PC,NG,dt,nt,Ro),TG=X$(gi),EG=uH(TG,dt,new WeakSet,DH),AG=J$(Ta,Yd,$s,Vp,js,Sa),VC=Q$(AG,js),jG=yH(xi,VC,pt,bi,xs),CG=vH(Vt,ei,VC,jG,dt,nt),RG=EH(Vp,pt,xs),IG=TH(Vt,os,Vp,RG,dt,nt,Ro),BC=u$(ui),Jy=L9(ui),FC=new WeakMap,OG=K9(FC,dr),MG=BC?dU(Zn,js,M9(ui),Jy,P9(aU),dt,OG,nt,ad,new WeakMap,new WeakMap,wH(ad,dr),ui):void 0,DG=l$(Ky,nt),LG=y9(Yy,Zn,v9,O9,new WeakSet,dt,DG,ym,rd,Xy,Qy),UC=QU(MG,qH,CC,WH,QH,eG,sG,rG,oG,LG,cG,dG,fG,xG,vG,_G,SG,EG,CG,IG),PG=d$(Vt,$$,dt,nt),VG=f$(Vt,H$,dt,nt),BG=m$(Vt,G$,dt,nt),FG=z$(os,nt),UG=p$(Vt,FG,dt),$G=RU(UC,os,js,NH,PG,VG,BG,UG,Jd),Zy=W9(MC),HG=pU(Zy),$C=c9(gi),GG=T9(Zy),HC=j9(gi),GC=new WeakMap,zG=U9(GC,Kn),qG=R$($C,gi,os,Ta,Yd,Sc,$s,Xd,js,HC,Jy,zG,Sa),KG=E$(os,qG,$s,js,Sa),WG=XU(xi,$C,Nc,Ta,Yd,Sc,$s,GG,HC,Jy,pt,ad,dr,bi,xs,Pp),YG=z9(FC),XG=pH(GC),RN=BC?KU(HG,Vt,ei,WG,KG,Ns,YG,dt,nt,ad,OH,XG,BH,kc):void 0,QG=b9(js,dr),JG=xH(Yy,Zn,qy,Zy,Pp,ym,Xy,Qy),ZG=sH(UC,Zn,os,QG,JG),ez=t$(Op,Ky),tz=s$(Py,Wy),sz=n$(Vy,AC),nz=i$(Op,nt);function wn(t){return t===void 0}function Oe(t){return t!==void 0}function iz(t){return typeof t=="function"}function tr(t){return typeof t=="number"}function eo(t){return Object.prototype.toString.call(t)==="[object Object]"&&t.constructor===Object}function rz(t){return typeof t=="boolean"}function an(t){return Array.isArray(t)}function sr(t){return typeof t=="string"}function Mh(t){return sr(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function me(t,e){if(!t)throw new Error(e)}function Js(t,e,s=1/0){if(!(e<=t&&t<=s))throw new RangeError(`Value must be within [${e}, ${s}], got: ${t}`)}function zC(t){!t.isOffline&&t.state!=="running"&&Bp('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let qC=!1,IN=!1;function ON(t){qC=t}function az(t){wn(t)&&qC&&!IN&&(IN=!0,Bp("Events scheduled inside of scheduled callbacks should use the passed in scheduling time. See https://github.com/Tonejs/Tone.js/wiki/Accurate-Timing"))}let KC=console;function oz(...t){KC.log(...t)}function Bp(...t){KC.warn(...t)}function lz(t){return new $G(t)}function cz(t,e,s){return new ZG(t,e,s)}const Ws=typeof self=="object"?self:null,uz=Ws&&(Ws.hasOwnProperty("AudioContext")||Ws.hasOwnProperty("webkitAudioContext"));function dz(t,e,s){return me(Oe(RN),"AudioWorkletNode only works in a secure context (https or localhost)"),new(t instanceof(Ws==null?void 0:Ws.BaseAudioContext)?Ws==null?void 0:Ws.AudioWorkletNode:RN)(t,e,s)}class hz{constructor(e,s,n,i){this._callback=e,this._type=s,this._minimumUpdateInterval=Math.max(128/(i||44100),.001),this.updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`
			// the initial timeout time
			let timeoutTime =  ${(this._updateInterval*1e3).toFixed(1)};
			// onmessage callback
			self.onmessage = function(msg){
				timeoutTime = parseInt(msg.data);
			};
			// the tick function which posts a message
			// and schedules a new tick
			function tick(){
				setTimeout(tick, timeoutTime);
				self.postMessage('tick');
			}
			// call tick initially
			tick();
			`],{type:"text/javascript"}),s=URL.createObjectURL(e),n=new Worker(s);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout(()=>{this._createTimeout(),this._callback()},this._updateInterval*1e3)}_createClock(){if(this._type==="worker")try{this._createWorker()}catch{this._type="timeout",this._createClock()}else this._type==="timeout"&&this._createTimeout()}_disposeClock(){this._timeout&&clearTimeout(this._timeout),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){var s;this._updateInterval=Math.max(e,this._minimumUpdateInterval),this._type==="worker"&&((s=this._worker)===null||s===void 0||s.postMessage(this._updateInterval*1e3))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function vo(t){return sz(t)}function ea(t){return tz(t)}function hf(t){return nz(t)}function Ho(t){return ez(t)}function fz(t){return t instanceof CC}function mz(t,e){return t==="value"||vo(e)||ea(e)||fz(e)}function to(t,...e){if(!e.length)return t;const s=e.shift();if(eo(t)&&eo(s))for(const n in s)mz(n,s[n])?t[n]=s[n]:eo(s[n])?(t[n]||Object.assign(t,{[n]:{}}),to(t[n],s[n])):Object.assign(t,{[n]:s[n]});return to(t,...e)}function pz(t,e){return t.length===e.length&&t.every((s,n)=>e[n]===s)}function ue(t,e,s=[],n){const i={},r=Array.from(e);if(eo(r[0])&&n&&!Reflect.has(r[0],n)&&(Object.keys(r[0]).some(l=>Reflect.has(t,l))||(to(i,{[n]:r[0]}),s.splice(s.indexOf(n),1),r.shift())),r.length===1&&eo(r[0]))to(i,r[0]);else for(let a=0;a<s.length;a++)Oe(r[a])&&(i[s[a]]=r[a]);return to(t,i)}function gz(t){return t.constructor.getDefaults()}function Sl(t,e){return wn(t)?e:t}function Zs(t,e){return e.forEach(s=>{Reflect.has(t,s)&&delete t[s]}),t}/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2024 Yotam Mann
 */class hr{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Ws&&this.toString()===Ws.TONE_DEBUG_CLASS)&&oz(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}hr.version=Jj;const e_=1e-6;function Xl(t,e){return t>e+e_}function sb(t,e){return Xl(t,e)||Dn(t,e)}function Em(t,e){return t+e_<e}function Dn(t,e){return Math.abs(t-e)<e_}function xz(t,e,s){return Math.max(Math.min(t,s),e)}class kn extends hr{constructor(){super(),this.name="Timeline",this._timeline=[];const e=ue(kn.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(me(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const s=this._timeline[this.length-1];me(sb(e.time,s.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const s=this._search(e.time);this._timeline.splice(s+1,0,e)}if(this.length>this.memory){const s=this.length-this.memory;this._timeline.splice(0,s)}return this}remove(e){const s=this._timeline.indexOf(e);return s!==-1&&this._timeline.splice(s,1),this}get(e,s="time"){const n=this._search(e,s);return n!==-1?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,s="time"){const n=this._search(e,s);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const s=this._timeline.length;if(s>0&&this._timeline[s-1].time<e)return this._timeline[s-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let s=this._search(e);if(s>=0)if(Dn(this._timeline[s].time,e)){for(let n=s;n>=0&&Dn(this._timeline[n].time,e);n--)s=n;this._timeline=this._timeline.slice(0,s)}else this._timeline=this._timeline.slice(0,s+1);else this._timeline=[]}else this._timeline.length===1&&sb(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const s=this._search(e);return s>=0&&(this._timeline=this._timeline.slice(s+1)),this}previousEvent(e){const s=this._timeline.indexOf(e);return s>0?this._timeline[s-1]:null}_search(e,s="time"){if(this._timeline.length===0)return-1;let n=0;const i=this._timeline.length;let r=i;if(i>0&&this._timeline[i-1][s]<=e)return i-1;for(;n<r;){let a=Math.floor(n+(r-n)/2);const l=this._timeline[a],c=this._timeline[a+1];if(Dn(l[s],e)){for(let u=a;u<this._timeline.length;u++){const d=this._timeline[u];if(Dn(d[s],e))a=u;else break}return a}else{if(Em(l[s],e)&&Xl(c[s],e))return a;Xl(l[s],e)?r=a:n=a+1}}return-1}_iterate(e,s=0,n=this._timeline.length-1){this._timeline.slice(s,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,s){const n=this._search(e);return n!==-1&&this._iterate(s,0,n),this}forEachAfter(e,s){const n=this._search(e);return this._iterate(s,n+1),this}forEachBetween(e,s,n){let i=this._search(e),r=this._search(s);return i!==-1&&r!==-1?(this._timeline[i].time!==e&&(i+=1),this._timeline[r].time===s&&(r-=1),this._iterate(n,i,r)):i===-1&&this._iterate(n,0,r),this}forEachFrom(e,s){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(s,n+1),this}forEachAtTime(e,s){const n=this._search(e);if(n!==-1&&Dn(this._timeline[n].time,e)){let i=n;for(let r=n;r>=0&&Dn(this._timeline[r].time,e);r--)i=r;this._iterate(r=>{s(r)},i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const WC=[];function Fp(t){WC.push(t)}function bz(t){WC.forEach(e=>e(t))}const YC=[];function Up(t){YC.push(t)}function vz(t){YC.forEach(e=>e(t))}class Zd extends hr{constructor(){super(...arguments),this.name="Emitter"}on(e,s){return e.split(/\W+/).forEach(i=>{wn(this._events)&&(this._events={}),this._events.hasOwnProperty(i)||(this._events[i]=[]),this._events[i].push(s)}),this}once(e,s){const n=(...i)=>{s(...i),this.off(e,n)};return this.on(e,n),this}off(e,s){return e.split(/\W+/).forEach(i=>{if(wn(this._events)&&(this._events={}),this._events.hasOwnProperty(i))if(wn(s))this._events[i]=[];else{const r=this._events[i];for(let a=r.length-1;a>=0;a--)r[a]===s&&r.splice(a,1)}}),this}emit(e,...s){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let i=0,r=n.length;i<r;i++)n[i].apply(this,s)}return this}static mixin(e){["on","once","off","emit"].forEach(s=>{const n=Object.getOwnPropertyDescriptor(Zd.prototype,s);Object.defineProperty(e.prototype,s,n)})}dispose(){return super.dispose(),this._events=void 0,this}}class XC extends Zd{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class eh extends XC{constructor(){var e,s;super(),this.name="Context",this._constants=new Map,this._timeouts=new kn,this._timeoutIds=0,this._initialized=!1,this._closeStarted=!1,this.isOffline=!1,this._workletPromise=null;const n=ue(eh.getDefaults(),arguments,["context"]);n.context?(this._context=n.context,this._latencyHint=((e=arguments[0])===null||e===void 0?void 0:e.latencyHint)||""):(this._context=lz({latencyHint:n.latencyHint}),this._latencyHint=n.latencyHint),this._ticker=new hz(this.emit.bind(this,"tick"),n.clockSource,n.updateInterval,this._context.sampleRate),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this[!((s=arguments[0])===null||s===void 0)&&s.hasOwnProperty("updateInterval")?"_lookAhead":"lookAhead"]=n.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(bz(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,s,n){return this._context.createBuffer(e,s,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,s){return this._context.createIIRFilter(e,s)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,s,n){return this._context.createPeriodicWave(e,s,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){return me(Ho(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}createMediaElementSource(e){return me(Ho(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}createMediaStreamDestination(){return me(Ho(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){me(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){me(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){me(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){me(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,s){return dz(this.rawContext,e,s)}addAudioWorkletModule(e){return Lt(this,void 0,void 0,function*(){me(Oe(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletPromise||(this._workletPromise=this.rawContext.audioWorklet.addModule(e)),yield this._workletPromise})}workletsAreReady(){return Lt(this,void 0,void 0,function*(){(yield this._workletPromise)?this._workletPromise:Promise.resolve()})}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get lookAhead(){return this._lookAhead}set lookAhead(e){this._lookAhead=e,this.updateInterval=e?e/2:.01}get latencyHint(){return this._latencyHint}get rawContext(){return this._context}now(){return this._context.currentTime+this._lookAhead}immediate(){return this._context.currentTime}resume(){return Ho(this._context)?this._context.resume():Promise.resolve()}close(){return Lt(this,void 0,void 0,function*(){Ho(this._context)&&this.state!=="closed"&&!this._closeStarted&&(this._closeStarted=!0,yield this._context.close()),this._initialized&&vz(this)})}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const s=this._context.createBuffer(1,128,this._context.sampleRate),n=s.getChannelData(0);for(let r=0;r<n.length;r++)n[r]=e;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=s,i.loop=!0,i.start(0),this._constants.set(e,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map(e=>this._constants[e].disconnect()),this.close(),this}_timeoutLoop(){const e=this.now();this._timeouts.forEachBefore(e,s=>{s.callback(),this._timeouts.remove(s)})}setTimeout(e,s){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+s}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach(s=>{s.id===e&&this._timeouts.remove(s)}),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,s){const n=++this._timeoutIds,i=()=>{const r=this.now();this._timeouts.add({callback:()=>{e(),i()},id:n,time:r+s})};return i(),n}}class yz extends XC{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,s,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,s){return{}}createPanner(){return{}}createPeriodicWave(e,s,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,s){return{}}get rawContext(){return{}}addAudioWorkletModule(e){return Lt(this,void 0,void 0,function*(){return Promise.resolve()})}resume(){return Promise.resolve()}setTimeout(e,s){return 0}clearTimeout(e){return this}setInterval(e,s){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}}function He(t,e){an(e)?e.forEach(s=>He(t,s)):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function t_(t,e){an(e)?e.forEach(s=>t_(t,s)):Object.defineProperty(t,e,{writable:!0})}const Qe=()=>{};class rt extends hr{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Qe;const e=ue(rt.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,sr(e.url)?this.load(e.url).catch(e.onerror):e.url&&this.set(e.url)}static getDefaults(){return{onerror:Qe,onload:Qe,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Fn().sampleRate}set(e){return e instanceof rt?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return Lt(this,void 0,void 0,function*(){const s=rt.load(e).then(n=>{this.set(n),this.onload(this)});rt.downloads.push(s);try{yield s}finally{const n=rt.downloads.indexOf(s);rt.downloads.splice(n,1)}return this})}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const s=an(e)&&e[0].length>0,n=s?e.length:1,i=s?e[0].length:e.length,r=Fn(),a=r.createBuffer(n,i,r.sampleRate),l=!s&&n===1?[e]:e;for(let c=0;c<n;c++)a.copyToChannel(l[c],c);return this._buffer=a,this}toMono(e){if(tr(e))this.fromArray(this.toArray(e));else{let s=new Float32Array(this.length);const n=this.numberOfChannels;for(let i=0;i<n;i++){const r=this.toArray(i);for(let a=0;a<r.length;a++)s[a]+=r[a]}s=s.map(i=>i/n),this.fromArray(s)}return this}toArray(e){if(tr(e))return this.getChannelData(e);if(this.numberOfChannels===1)return this.toArray(0);{const s=[];for(let n=0;n<this.numberOfChannels;n++)s[n]=this.getChannelData(n);return s}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,s=this.duration){me(this.loaded,"Buffer is not loaded");const n=Math.floor(e*this.sampleRate),i=Math.floor(s*this.sampleRate);me(n<i,"The start time must be less than the end time");const r=i-n,a=Fn().createBuffer(this.numberOfChannels,r,this.sampleRate);for(let l=0;l<this.numberOfChannels;l++)a.copyToChannel(this.getChannelData(l).subarray(n,i),l);return new rt(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return new rt().fromArray(e)}static fromUrl(e){return Lt(this,void 0,void 0,function*(){return yield new rt().load(e)})}static load(e){return Lt(this,void 0,void 0,function*(){const s=rt.baseUrl===""||rt.baseUrl.endsWith("/")?rt.baseUrl:rt.baseUrl+"/",n=yield fetch(s+e);if(!n.ok)throw new Error(`could not load url: ${e}`);const i=yield n.arrayBuffer();return yield Fn().decodeAudioData(i)})}static supportsType(e){const s=e.split("."),n=s[s.length-1];return document.createElement("audio").canPlayType("audio/"+n)!==""}static loaded(){return Lt(this,void 0,void 0,function*(){for(yield Promise.resolve();rt.downloads.length;)yield rt.downloads[0]})}}rt.baseUrl="";rt.downloads=[];class $p extends eh{constructor(){super({clockSource:"offline",context:hf(arguments[0])?arguments[0]:cz(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:hf(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=hf(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return Lt(this,void 0,void 0,function*(){let s=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,s++;const n=Math.floor(this.sampleRate/128);e&&s%n===0&&(yield new Promise(i=>setTimeout(i,1)))}})}render(){return Lt(this,arguments,void 0,function*(e=!0){yield this.workletsAreReady(),yield this._renderClock(e);const s=yield this._context.startRendering();return new rt(s)})}close(){return Promise.resolve()}}const QC=new yz;let Ga=QC;function Fn(){return Ga===QC&&uz&&_z(new eh),Ga}function _z(t,e=!1){e&&Ga.dispose(),Ho(t)?Ga=new eh(t):hf(t)?Ga=new $p(t):Ga=t}function wz(){return Ga.resume()}if(Ws&&!Ws.TONE_SILENCE_LOGGING){const e=` * Tone.js v${Jj} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function kz(t){return Math.pow(10,t/20)}function Nz(t){return 20*(Math.log(t)/Math.LN10)}function JC(t){return Math.pow(2,t/12)}let Hp=440;function Sz(){return Hp}function Tz(t){Hp=t}function za(t){return Math.round(ZC(t))}function ZC(t){return 69+12*Math.log2(t/Hp)}function eR(t){return Hp*Math.pow(2,(t-69)/12)}class s_ extends hr{constructor(e,s,n){super(),this.defaultUnits="s",this._val=s,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,s)=>{const n=parseInt(e,10),i=s==="."?1.5:1;return n===1?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const s=parseInt(e,10);return this._beatsToUnits(8/(Math.floor(s)*3))},regexp:/^(\d+)t$/i},tr:{method:(e,s,n)=>{let i=0;return e&&e!=="0"&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(i+=this._beatsToUnits(parseFloat(s))),n&&n!=="0"&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof s_&&this.fromType(this._val),wn(this._val))return this._noArg();if(sr(this._val)&&wn(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(eo(this._val)){let e=0;for(const s in this._val)if(Oe(this._val[s])){const n=this._val[s],i=new this.constructor(this.context,s).valueOf()*n;e+=i}return e}if(Oe(this._units)){const e=this._expressions[this._units],s=this._val.toString().trim().match(e.regexp);return s?e.method.apply(this,s.slice(1)):e.method.call(this,this._val)}else return sr(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return this.toSeconds()*1e3}}class Un extends s_{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const s=new Un(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(s))},regexp:/^@(.+)/}})}quantize(e,s=1){const n=new this.constructor(this.context,e).valueOf(),i=this.valueOf(),l=Math.round(i/n)*n-i;return i+l*s}toNotation(){const e=this.toSeconds(),s=["1m"];for(let r=1;r<9;r++){const a=Math.pow(2,r);s.push(a+"n."),s.push(a+"n"),s.push(a+"t")}s.push("0");let n=s[0],i=new Un(this.context,s[0]).toSeconds();return s.forEach(r=>{const a=new Un(this.context,r).toSeconds();Math.abs(a-e)<Math.abs(i-e)&&(n=r,i=a)}),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let s=this.valueOf()/e;s=parseFloat(s.toFixed(4));const n=Math.floor(s/this._getTimeSignature());let i=s%1*4;s=Math.floor(s)%this._getTimeSignature();const r=i.toString();return r.length>3&&(i=parseFloat(parseFloat(r).toFixed(3))),[n,s,i].join(":")}toTicks(){const e=this._beatsToUnits(1);return this.valueOf()/e*this._getPPQ()}toSeconds(){return this.valueOf()}toMidi(){return za(this.toFrequency())}_now(){return this.context.now()}}class en extends Un{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Sz()}static set A4(e){Tz(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return this.defaultUnits==="midi"?e:en.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|##|x|bb|###|#x|x#|bbb)?)(-?[0-9]+)/i,method(e,s){const i=Ez[e.toLowerCase()]+(parseInt(s,10)+1)*12;return this.defaultUnits==="midi"?i:en.mtof(i)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,s,n){let i=1;return e&&e!=="0"&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),s&&s!=="0"&&(i*=this._beatsToUnits(parseFloat(s))),n&&n!=="0"&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(e){return new en(this.context,this.valueOf()*JC(e))}harmonize(e){return e.map(s=>this.transpose(s))}toMidi(){return za(this.valueOf())}toNote(){const e=this.toFrequency(),s=Math.log2(e/en.A4);let n=Math.round(12*s)+57;const i=Math.floor(n/12);return i<0&&(n+=-12*i),Az[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),s=this.valueOf()/e;return Math.floor(s*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(e*60/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return eR(e)}static ftom(e){return za(e)}}const Ez={cbbb:-3,cbb:-2,cb:-1,c:0,"c#":1,cx:2,"c##":2,"c###":3,"cx#":3,"c#x":3,dbbb:-1,dbb:0,db:1,d:2,"d#":3,dx:4,"d##":4,"d###":5,"dx#":5,"d#x":5,ebbb:1,ebb:2,eb:3,e:4,"e#":5,ex:6,"e##":6,"e###":7,"ex#":7,"e#x":7,fbbb:2,fbb:3,fb:4,f:5,"f#":6,fx:7,"f##":7,"f###":8,"fx#":8,"f#x":8,gbbb:4,gbb:5,gb:6,g:7,"g#":8,gx:9,"g##":9,"g###":10,"gx#":10,"g#x":10,abbb:6,abb:7,ab:8,a:9,"a#":10,ax:11,"a##":11,"a###":12,"ax#":12,"a#x":12,bbbb:8,bbb:9,bb:10,b:11,"b#":12,bx:13,"b##":13,"b###":14,"bx#":14,"b#x":14},Az=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class ku extends Un{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Bs extends hr{constructor(){super();const e=ue(Bs.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Fn()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return az(e),new Un(this.context,e).toSeconds()}toFrequency(e){return new en(this.context,e).toFrequency()}toTicks(e){return new ku(this.context,e).toTicks()}_getPartialProperties(e){const s=this.get();return Object.keys(s).forEach(n=>{wn(e[n])&&delete s[n]}),s}get(){const e=gz(this);return Object.keys(e).forEach(s=>{if(Reflect.has(this,s)){const n=this[s];Oe(n)&&Oe(n.value)&&Oe(n.setValueAtTime)?e[s]=n.value:n instanceof Bs?e[s]=n._getPartialProperties(e[s]):an(n)||tr(n)||sr(n)||rz(n)?e[s]=n:delete e[s]}}),e}set(e){return Object.keys(e).forEach(s=>{Reflect.has(this,s)&&Oe(this[s])&&(this[s]&&Oe(this[s].value)&&Oe(this[s].setValueAtTime)?this[s].value!==e[s]&&(this[s].value=e[s]):this[s]instanceof Bs?this[s].set(e[s]):this[s]=e[s])}),this}}class n_ extends kn{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const s=this.get(e);return s!==null?s.state:this._initial}setStateAtTime(e,s,n){return Js(s,0),this.add(Object.assign({},n,{state:e,time:s})),this}getLastState(e,s){const n=this._search(s);for(let i=n;i>=0;i--){const r=this._timeline[i];if(r.state===e)return r}}getNextState(e,s){const n=this._search(s);if(n!==-1)for(let i=n;i<this._timeline.length;i++){const r=this._timeline[i];if(r.state===e)return r}}}class Re extends Bs{constructor(){const e=ue(Re.getDefaults(),arguments,["param","units","convert"]);for(super(e),this.name="Param",this.overridden=!1,this._minOutput=1e-7,me(Oe(e.param)&&(vo(e.param)||e.param instanceof Re),"param must be an AudioParam");!vo(e.param);)e.param=e.param._param;this._swappable=Oe(e.swappable)?e.swappable:!1,this._swappable?(this.input=this.context.createGain(),this._param=e.param,this.input.connect(this._param)):this._param=this.input=e.param,this._events=new kn(1e3),this._initialValue=this._param.defaultValue,this.units=e.units,this.convert=e.convert,this._minValue=e.minValue,this._maxValue=e.maxValue,Oe(e.value)&&e.value!==this._toType(this._initialValue)&&this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Bs.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Oe(this._minValue)?this._minValue:this.units==="time"||this.units==="frequency"||this.units==="normalRange"||this.units==="positive"||this.units==="transportTime"||this.units==="ticks"||this.units==="bpm"||this.units==="hertz"||this.units==="samples"?0:this.units==="audioRange"?-1:this.units==="decibels"?-1/0:this._param.minValue}get maxValue(){return Oe(this._maxValue)?this._maxValue:this.units==="normalRange"||this.units==="audioRange"?1:this._param.maxValue}_is(e,s){return this.units===s}_assertRange(e){return Oe(this.maxValue)&&Oe(this.minValue)&&Js(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?kz(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}_toType(e){return this.convert&&this.units==="decibels"?Nz(e):e}setValueAtTime(e,s){const n=this.toSeconds(s),i=this._fromType(e);return me(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(e){const s=Math.max(this.toSeconds(e),0),n=this._events.getAfter(s),i=this._events.get(s);let r=this._initialValue;if(i===null)r=this._initialValue;else if(i.type==="setTargetAtTime"&&(n===null||n.type==="setValueAtTime")){const a=this._events.getBefore(i.time);let l;a===null?l=this._initialValue:l=a.value,i.type==="setTargetAtTime"&&(r=this._exponentialApproach(i.time,l,i.value,i.constant,s))}else if(n===null)r=i.value;else if(n.type==="linearRampToValueAtTime"||n.type==="exponentialRampToValueAtTime"){let a=i.value;if(i.type==="setTargetAtTime"){const l=this._events.getBefore(i.time);l===null?a=this._initialValue:a=l.value}n.type==="linearRampToValueAtTime"?r=this._linearInterpolate(i.time,a,n.time,n.value,s):r=this._exponentialInterpolate(i.time,a,n.time,n.value,s)}else r=i.value;return this._toType(r)}setRampPoint(e){e=this.toSeconds(e);let s=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),this._fromType(s)===0&&(s=this._toType(this._minOutput)),this.setValueAtTime(s,e),this}linearRampToValueAtTime(e,s){const n=this._fromType(e),i=this.toSeconds(s);return me(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(e,s){let n=this._fromType(e);n=Dn(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(s);return me(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(s)),this}linearRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(s)),this}targetRampTo(e,s,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,s),this}exponentialApproachValueAtTime(e,s,n){s=this.toSeconds(s),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,s,i),this.cancelAndHoldAtTime(s+n*.9),this.linearRampToValueAtTime(e,s+n),this}setTargetAtTime(e,s,n){const i=this._fromType(e);me(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const r=this.toSeconds(s);return this._assertRange(i),me(isFinite(i)&&isFinite(r),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(s)}`),this._events.add({constant:n,time:r,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",e,r,n),this._param.setTargetAtTime(i,r,n),this}setValueCurveAtTime(e,s,n,i=1){n=this.toSeconds(n),s=this.toSeconds(s);const r=this._fromType(e[0])*i;this.setValueAtTime(this._toType(r),s);const a=n/(e.length-1);for(let l=1;l<e.length;l++){const c=this._fromType(e[l])*i;this.linearRampToValueAtTime(this._toType(c),s+l*a)}return this}cancelScheduledValues(e){const s=this.toSeconds(e);return me(isFinite(s),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(s),this._param.cancelScheduledValues(s),this.log(this.units,"cancelScheduledValues",s),this}cancelAndHoldAtTime(e){const s=this.toSeconds(e),n=this._fromType(this.getValueAtTime(s));me(isFinite(s),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",s,"value="+n);const i=this._events.get(s),r=this._events.getAfter(s);return i&&Dn(i.time,s)?r?(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time)):(this._param.cancelAndHoldAtTime(s),this._events.cancel(s+this.sampleTime)):r&&(this._param.cancelScheduledValues(r.time),this._events.cancel(r.time),r.type==="linearRampToValueAtTime"?this.linearRampToValueAtTime(this._toType(n),s):r.type==="exponentialRampToValueAtTime"&&this.exponentialRampToValueAtTime(this._toType(n),s)),this._events.add({time:s,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,s),this}rampTo(e,s=.1,n){return this.units==="frequency"||this.units==="bpm"||this.units==="decibels"?this.exponentialRampTo(e,s,n):this.linearRampTo(e,s,n),this}apply(e){const s=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(s),s);const n=this._events.get(s);if(n&&n.type==="setTargetAtTime"){const i=this._events.getAfter(n.time),r=i?i.time:s+2,a=(r-s)/10;for(let l=s;l<r;l+=a)e.linearRampToValueAtTime(this.getValueAtTime(l),l)}return this._events.forEachAfter(this.context.currentTime,i=>{i.type==="cancelScheduledValues"?e.cancelScheduledValues(i.time):i.type==="setTargetAtTime"?e.setTargetAtTime(i.value,i.time,i.constant):e[i.type](i.value,i.time)}),this}setParam(e){me(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const s=this.input;return s.disconnect(this._param),this.apply(e),this._param=e,s.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,s,n,i,r){return n+(s-n)*Math.exp(-(r-e)/i)}_linearInterpolate(e,s,n,i,r){return s+(i-s)*((r-e)/(n-e))}_exponentialInterpolate(e,s,n,i,r){return s*Math.pow(i/s,(r-e)/(n-e))}}class de extends Bs{constructor(){super(...arguments),this._internalChannels=[]}get numberOfInputs(){return Oe(this.input)?vo(this.input)||this.input instanceof Re?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Oe(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Oe(e)&&(e instanceof de||ea(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach(n=>{n.channelCount=e.channelCount,n.channelCountMode=e.channelCountMode,n.channelInterpretation=e.channelInterpretation})}_getChannelProperties(){const e=this._getInternalNodes();me(e.length>0,"ToneAudioNode does not have any internal nodes");const s=e[0];return{channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const s=this._getChannelProperties();this._setChannelProperties(Object.assign(s,{channelInterpretation:e}))}connect(e,s=0,n=0){return nr(this,e,s,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Bp("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,s=0,n=0){return tR(this,e,s,n),this}chain(...e){return od(this,...e),this}fan(...e){return e.forEach(s=>this.connect(s)),this}dispose(){return super.dispose(),Oe(this.input)&&(this.input instanceof de?this.input.dispose():ea(this.input)&&this.input.disconnect()),Oe(this.output)&&(this.output instanceof de?this.output.dispose():ea(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function od(...t){const e=t.shift();t.reduce((s,n)=>(s instanceof de?s.connect(n):ea(s)&&nr(s,n),n),e)}function nr(t,e,s=0,n=0){for(me(Oe(t),"Cannot connect from undefined node"),me(Oe(e),"Cannot connect to undefined node"),(e instanceof de||ea(e))&&me(e.numberOfInputs>0,"Cannot connect to node with no inputs"),me(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof de||e instanceof Re;)Oe(e.input)&&(e=e.input);for(;t instanceof de;)Oe(t.output)&&(t=t.output);vo(e)?t.connect(e,s):t.connect(e,s,n)}function tR(t,e,s=0,n=0){if(Oe(e))for(;e instanceof de;)e=e.input;for(;!ea(t);)Oe(t.output)&&(t=t.output);vo(e)?t.disconnect(e,s):ea(e)?t.disconnect(e,s,n):t.disconnect()}class Ke extends de{constructor(){const e=ue(Ke.getDefaults(),arguments,["gain","units"]);super(e),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode,this.gain=new Re({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),He(this,"gain")}static getDefaults(){return Object.assign(de.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ql extends de{constructor(e){super(e),this.onended=Qe,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Ke({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(s){const n=this.toSeconds(s);return this._startTime!==-1&&n>=this._startTime&&(this._stopTime===-1||n<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(de.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Qe})}_startGain(e,s=1){me(this._startTime===-1,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),this._curve==="linear"?this._gainNode.gain.linearRampToValueAtTime(s,e+n):this._gainNode.gain.exponentialApproachValueAtTime(s,e,n)):this._gainNode.gain.setValueAtTime(s,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){me(this._startTime!==-1,"'start' must be called before 'stop'"),this.cancelStop();const s=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+s,this._stopTime=Math.max(this._stopTime,this.now()),s>0?this._curve==="linear"?this._gainNode.gain.linearRampTo(0,s,e):this._gainNode.gain.targetRampTo(0,s,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout(()=>{const n=this._curve==="exponential"?s*2:0;this._stopSource(this.now()+n),this._onended()},this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Qe&&(this.onended(this),this.onended=Qe,!this.context.isOffline)){const e=()=>this.dispose();typeof requestIdleCallback<"u"?requestIdleCallback(e):setTimeout(e,10)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),me(this._startTime!==-1,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.dispose(),this.onended=Qe,this}}class i_ extends Ql{constructor(){const e=ue(i_.getDefaults(),arguments,["offset"]);super(e),this.name="ToneConstantSource",this._source=this.context.createConstantSource(),nr(this._source,this._gainNode),this.offset=new Re({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ql.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._source.start(s),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class ze extends de{constructor(){const e=ue(ze.getDefaults(),arguments,["value","units"]);super(e),this.name="Signal",this.override=!0,this.output=this._constantSource=new i_({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(de.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,s=0,n=0){return Gp(this,e,s,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,s){return this._param.setValueAtTime(e,s),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,s){return this._param.linearRampToValueAtTime(e,s),this}exponentialRampToValueAtTime(e,s){return this._param.exponentialRampToValueAtTime(e,s),this}exponentialRampTo(e,s,n){return this._param.exponentialRampTo(e,s,n),this}linearRampTo(e,s,n){return this._param.linearRampTo(e,s,n),this}targetRampTo(e,s,n){return this._param.targetRampTo(e,s,n),this}exponentialApproachValueAtTime(e,s,n){return this._param.exponentialApproachValueAtTime(e,s,n),this}setTargetAtTime(e,s,n){return this._param.setTargetAtTime(e,s,n),this}setValueCurveAtTime(e,s,n,i){return this._param.setValueCurveAtTime(e,s,n,i),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,s,n){return this._param.rampTo(e,s,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function Gp(t,e,s,n){(e instanceof Re||vo(e)||e instanceof ze&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof ze&&(e.overridden=!0)),nr(t,e,s,n)}class r_ extends Re{constructor(){const e=ue(r_.getDefaults(),arguments,["value"]);super(e),this.name="TickParam",this._events=new kn(1/0),this._multiplier=1,this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(Re.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,s,n){s=this.toSeconds(s),this.setRampPoint(s);const i=this._fromType(e),r=this._events.get(s),a=Math.round(Math.max(1/n,1));for(let l=0;l<=a;l++){const c=n*l+s,u=this._exponentialApproach(r.time,r.value,i,n,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}setValueAtTime(e,s){const n=this.toSeconds(s);super.setValueAtTime(e,s);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,s){const n=this.toSeconds(s);super.linearRampToValueAtTime(e,s);const i=this._events.get(n),r=this._events.previousEvent(i),a=this._getTicksUntilEvent(r,n);return i.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,s){s=this.toSeconds(s);const n=this._fromType(e),i=this._events.get(s),r=Math.round(Math.max((s-i.time)*10,1)),a=(s-i.time)/r;for(let l=0;l<=r;l++){const c=a*l+i.time,u=this._exponentialInterpolate(i.time,i.value,s,n,c);this.linearRampToValueAtTime(this._toType(u),c)}return this}_getTicksUntilEvent(e,s){if(e===null)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(wn(e.ticks)){const a=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(a,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let i=this._fromType(this.getValueAtTime(s));const r=this._events.get(s);return r&&r.time===s&&r.type==="setValueAtTime"&&(i=this._fromType(this.getValueAtTime(s-this.sampleTime))),.5*(s-e.time)*(n+i)+e.ticks}getTicksAtTime(e){const s=this.toSeconds(e),n=this._events.get(s);return Math.max(this._getTicksUntilEvent(n,s),0)}getDurationOfTicks(e,s){const n=this.toSeconds(s),i=this.getTicksAtTime(s);return this.getTimeOfTick(i+e)-n}getTimeOfTick(e){const s=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(s&&s.ticks===e)return s.time;if(s&&n&&n.type==="linearRampToValueAtTime"&&s.value!==n.value){const i=this._fromType(this.getValueAtTime(s.time)),a=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-s.time),l=Math.sqrt(Math.pow(i,2)-2*a*(s.ticks-e)),c=(-i+l)/a,u=(-i-l)/a;return(c>0?c:u)+s.time}else return s?s.value===0?1/0:s.time+(e-s.ticks)/s.value:e/this._initialValue}ticksToTime(e,s){return this.getDurationOfTicks(e,s)}timeToTicks(e,s){const n=this.toSeconds(s),i=this.toSeconds(e),r=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-r}_fromType(e){return this.units==="bpm"&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return this.units==="bpm"&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const s=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(s,0)}}class a_ extends ze{constructor(){const e=ue(a_.getDefaults(),arguments,["value"]);super(e),this.name="TickSignal",this.input=this._param=new r_({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(ze.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,s){return this._param.ticksToTime(e,s)}timeToTicks(e,s){return this._param.timeToTicks(e,s)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,s){return this._param.getDurationOfTicks(e,s)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class o_ extends Bs{constructor(){const e=ue(o_.getDefaults(),arguments,["frequency"]);super(e),this.name="TickSource",this._state=new n_,this._tickOffset=new kn,this._ticksAtTime=new kn,this._secondsAtTime=new kn,this.frequency=new a_({context:this.context,units:e.units,value:e.frequency}),He(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Bs.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,s){const n=this.toSeconds(e);return this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),Oe(s)&&this.setTicksAtTime(s,n),this._ticksAtTime.cancel(n),this._secondsAtTime.cancel(n)),this}stop(e){const s=this.toSeconds(e);if(this._state.getValueAtTime(s)==="stopped"){const n=this._state.get(s);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(s),this._state.setStateAtTime("stopped",s),this.setTicksAtTime(0,s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}pause(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&(this._state.setStateAtTime("paused",s),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s)),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this._ticksAtTime.cancel(e),this._secondsAtTime.cancel(e),this}getTicksAtTime(e){const s=this.toSeconds(e),n=this._state.getLastState("stopped",s),i=this._ticksAtTime.get(s),r={state:"paused",time:s};this._state.add(r);let a=i||n,l=i?i.ticks:0,c=null;return this._state.forEachBetween(a.time,s+this.sampleTime,u=>{let d=a.time;const h=this._tickOffset.get(u.time);h&&h.time>=a.time&&(l=h.ticks,d=h.time),a.state==="started"&&u.state!=="started"&&(l+=this.frequency.getTicksAtTime(u.time)-this.frequency.getTicksAtTime(d),u.time!==r.time&&(c={state:u.state,time:u.time,ticks:l})),a=u}),this._state.remove(r),c&&this._ticksAtTime.add(c),l}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const s=this.now(),n=this.frequency.timeToTicks(e,s);this.setTicksAtTime(n,s)}getSecondsAtTime(e){e=this.toSeconds(e);const s=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);const i=this._secondsAtTime.get(e);let r=i||s,a=i?i.seconds:0,l=null;return this._state.forEachBetween(r.time,e+this.sampleTime,c=>{let u=r.time;const d=this._tickOffset.get(c.time);d&&d.time>=r.time&&(a=d.seconds,u=d.time),r.state==="started"&&c.state!=="started"&&(a+=c.time-u,c.time!==n.time&&(l={state:c.state,time:c.time,seconds:a})),r=c}),this._state.remove(n),l&&this._secondsAtTime.add(l),a}setTicksAtTime(e,s){return s=this.toSeconds(s),this._tickOffset.cancel(s),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,s),ticks:e,time:s}),this._ticksAtTime.cancel(s),this._secondsAtTime.cancel(s),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,s=this.now()){const n=this._tickOffset.get(s),i=this._state.get(s),r=Math.max(n.time,i.time),a=this.frequency.getTicksAtTime(r)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,s,n){let i=this._state.get(e);this._state.forEachBetween(e,s,a=>{i&&i.state==="started"&&a.state!=="started"&&this.forEachTickBetween(Math.max(i.time,e),a.time-this.sampleTime,n),i=a});let r=null;if(i&&i.state==="started"){const a=Math.max(i.time,e),l=this.frequency.getTicksAtTime(a),c=this.frequency.getTicksAtTime(i.time),u=l-c;let d=Math.ceil(u)-u;d=Dn(d,1)?0:d;let h=this.frequency.getTimeOfTick(l+d);for(;h<s;){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(f){r=f;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(r)throw r;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this._ticksAtTime.dispose(),this._secondsAtTime.dispose(),this.frequency.dispose(),this}}let sR=class nR extends Bs{constructor(){const e=ue(nR.getDefaults(),arguments,["callback","frequency"]);super(e),this.name="Clock",this.callback=Qe,this._lastUpdate=0,this._state=new n_("stopped"),this._boundLoop=this._loop.bind(this),this.callback=e.callback,this._tickSource=new o_({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,He(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Bs.getDefaults(),{callback:Qe,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,s){zC(this.context);const n=this.toSeconds(e);return this.log("start",n),this._state.getValueAtTime(n)!=="started"&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,s),n<this._lastUpdate&&this.emit("start",n,s)),this}stop(e){const s=this.toSeconds(e);return this.log("stop",s),this._state.cancel(s),this._state.setStateAtTime("stopped",s),this._tickSource.stop(s),s<this._lastUpdate&&this.emit("stop",s),this}pause(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)==="started"&&(this._state.setStateAtTime("paused",s),this._tickSource.pause(s),s<this._lastUpdate&&this.emit("pause",s)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,s){return this._tickSource.setTicksAtTime(e,s),this}getTimeOfTick(e,s=this.now()){return this._tickSource.getTimeOfTick(e,s)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,s){const n=this.toSeconds(s),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+e,n)}_loop(){const e=this._lastUpdate,s=this.now();this._lastUpdate=s,this.log("loop",e,s),e!==s&&(this._state.forEachBetween(e,s,n=>{switch(n.state){case"started":const i=this._tickSource.getTicksAtTime(n.time);this.emit("start",n.time,i);break;case"stopped":n.time!==0&&this.emit("stop",n.time);break;case"paused":this.emit("pause",n.time);break}}),this._tickSource.forEachTickBetween(e,s,(n,i)=>{this.callback(n,i)}))}getStateAtTime(e){const s=this.toSeconds(e);return this._state.getValueAtTime(s)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}};Zd.mixin(sR);class Gi extends de{constructor(){const e=ue(Gi.getDefaults(),arguments,["volume"]);super(e),this.name="Volume",this.input=this.output=new Ke({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,He(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class l_ extends de{constructor(){const e=ue(l_.getDefaults(),arguments);super(e),this.name="Destination",this.input=new Gi({context:this.context}),this.output=new Ke({context:this.context}),this.volume=this.input.volume,od(this.input,this.output,this.context.rawContext.destination),this.mute=e.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),od(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}Fp(t=>{t.destination=new l_({context:t})});Up(t=>{t.destination.dispose()});class jz extends de{constructor(){super(...arguments),this.name="Listener",this.positionX=new Re({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Re({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Re({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Re({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Re({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Re({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Re({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Re({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Re({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(de.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}Fp(t=>{t.listener=new jz({context:t})});Up(t=>{t.listener.dispose()});class c_ extends hr{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=ue(c_.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach(s=>{this._loadingCount++;const n=e.urls[s];this.add(s,n,this._bufferLoaded.bind(this,e.onload),e.onerror)})}static getDefaults(){return{baseUrl:"",onerror:Qe,onload:Qe,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return me(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,this._loadingCount===0&&e&&e()}get loaded(){return Array.from(this._buffers).every(([e,s])=>s.loaded)}add(e,s,n=Qe,i=Qe){return sr(s)?(this.baseUrl&&s.trim().substring(0,11).toLowerCase()==="data:audio/"&&(this.baseUrl=""),this._buffers.set(e.toString(),new rt(this.baseUrl+s,n,i))):this._buffers.set(e.toString(),new rt(s,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this}}class Am extends en{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(e){return za(super._frequencyToUnits(e))}_ticksToUnits(e){return za(super._ticksToUnits(e))}_beatsToUnits(e){return za(super._beatsToUnits(e))}_secondsToUnits(e){return za(super._secondsToUnits(e))}toMidi(){return this.valueOf()}toFrequency(){return eR(this.toMidi())}transpose(e){return new Am(this.context,this.toMidi()+e)}}class rl extends ku{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Cz extends Bs{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new kn,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,s){return this._events.add({callback:e,time:this.toSeconds(s)}),this._events.length===1&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;this._events.forEachBefore(e+this.anticipation,s=>{e-s.time<=this.expiration&&s.callback(),this._events.remove(s)}),this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}Fp(t=>{t.draw=new Cz({context:t})});Up(t=>{t.draw.dispose()});class Rz extends hr{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){me(Oe(e.time),"Events must have a time property"),me(Oe(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let s=new Iz(e.time,e.time+e.duration,e);for(this._root===null?this._root=s:this._root.insert(s),this._length++;s!==null;)s.updateHeight(),s.updateMax(),this._rebalance(s),s=s.parent;return this}remove(e){if(this._root!==null){const s=[];this._root.search(e.time,s);for(const n of s)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,s=>this.remove(s)),this}_setRoot(e){this._root=e,this._root!==null&&(this._root.parent=null)}_replaceNodeInParent(e,s){e.parent!==null?(e.isLeftChild()?e.parent.left=s:e.parent.right=s,this._rebalance(e.parent)):this._setRoot(s)}_removeNode(e){if(e.left===null&&e.right===null)this._replaceNodeInParent(e,null);else if(e.right===null)this._replaceNodeInParent(e,e.left);else if(e.left===null)this._replaceNodeInParent(e,e.right);else{const s=e.getBalance();let n,i=null;if(s>0)if(e.left.right===null)n=e.left,n.right=e.right,i=n;else{for(n=e.left.right;n.right!==null;)n=n.right;n.parent&&(n.parent.right=n.left,i=n.parent,n.left=e.left,n.right=e.right)}else if(e.right.left===null)n=e.right,n.left=e.left,i=n;else{for(n=e.right.left;n.left!==null;)n=n.left;n.parent&&(n.parent.left=n.right,i=n.parent,n.left=e.left,n.right=e.right)}e.parent!==null?e.isLeftChild()?e.parent.left=n:e.parent.right=n:this._setRoot(n),i&&this._rebalance(i)}e.dispose()}_rotateLeft(e){const s=e.parent,n=e.isLeftChild(),i=e.right;i&&(e.right=i.left,i.left=e),s!==null?n?s.left=i:s.right=i:this._setRoot(i)}_rotateRight(e){const s=e.parent,n=e.isLeftChild(),i=e.left;i&&(e.left=i.right,i.right=e),s!==null?n?s.left=i:s.right=i:this._setRoot(i)}_rebalance(e){const s=e.getBalance();s>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):s<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(this._root!==null){const s=[];if(this._root.search(e,s),s.length>0){let n=s[0];for(let i=1;i<s.length;i++)s[i].low>n.low&&(n=s[i]);return n.event}}return null}forEach(e){if(this._root!==null){const s=[];this._root.traverse(n=>s.push(n)),s.forEach(n=>{n.event&&e(n.event)})}return this}forEachAtTime(e,s){if(this._root!==null){const n=[];this._root.search(e,n),n.forEach(i=>{i.event&&s(i.event)})}return this}forEachFrom(e,s){if(this._root!==null){const n=[];this._root.searchAfter(e,n),n.forEach(i=>{i.event&&s(i.event)})}return this}dispose(){return super.dispose(),this._root!==null&&this._root.traverse(e=>e.dispose()),this._root=null,this}}class Iz{constructor(e,s,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=s,this.max=this.high}insert(e){e.low<=this.low?this.left===null?this.left=e:this.left.insert(e):this.right===null?this.right=e:this.right.insert(e)}search(e,s){e>this.max||(this.left!==null&&this.left.search(e,s),this.low<=e&&this.high>e&&s.push(this),!(this.low>e)&&this.right!==null&&this.right.search(e,s))}searchAfter(e,s){this.low>=e&&(s.push(this),this.left!==null&&this.left.searchAfter(e,s)),this.right!==null&&this.right.searchAfter(e,s)}traverse(e){e(this),this.left!==null&&this.left.traverse(e),this.right!==null&&this.right.traverse(e)}updateHeight(){this.left!==null&&this.right!==null?this.height=Math.max(this.left.height,this.right.height)+1:this.right!==null?this.height=this.right.height+1:this.left!==null?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,this.left!==null&&(this.max=Math.max(this.max,this.left.max)),this.right!==null&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return this.left!==null&&this.right!==null?e=this.left.height-this.right.height:this.left!==null?e=this.left.height+1:this.right!==null&&(e=-(this.right.height+1)),e}isLeftChild(){return this.parent!==null&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,e!==null&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Oz extends hr{constructor(e){super(),this.name="TimelineValue",this._timeline=new kn({memory:10}),this._initialValue=e}set(e,s){return this._timeline.add({value:e,time:s}),this}get(e){const s=this._timeline.get(e);return s?s.value:this._initialValue}}class di extends de{constructor(){super(ue(di.getDefaults(),arguments,["context"]))}connect(e,s=0,n=0){return Gp(this,e,s,n),this}}class Tc extends di{constructor(){const e=ue(Tc.getDefaults(),arguments,["mapping","length"]);super(e),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper,an(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):iz(e.mapping)&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(ze.getDefaults(),{length:1024})}setMap(e,s=1024){const n=new Float32Array(s);for(let i=0,r=s;i<r;i++){const a=i/(r-1)*2-1;n[i]=e(a,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){const s=["none","2x","4x"].some(n=>n.includes(e));me(s,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class zp extends di{constructor(){const e=ue(zp.getDefaults(),arguments,["value"]);super(e),this.name="Pow",this._exponentScaler=this.input=this.output=new Tc({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(di.getDefaults(),{value:1})}_expFunc(e){return s=>Math.pow(Math.abs(s),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class ha{constructor(e,s){this.id=ha._eventId++,this._remainderTime=0;const n=Object.assign(ha.getDefaults(),s);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=Math.floor(n.time),this._remainderTime=n.time-this.time}static getDefaults(){return{callback:Qe,once:!1,time:0}}get floatTime(){return this.time+this._remainderTime}invoke(e){if(this.callback){const s=this.transport.bpm.getDurationOfTicks(1,e);this.callback(e+this._remainderTime*s),this._once&&this.transport.clear(this.id)}}dispose(){return this.callback=void 0,this}}ha._eventId=0;class u_ extends ha{constructor(e,s){super(e,s),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(u_.getDefaults(),s);this.duration=n.duration,this._interval=n.interval,this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.transport.on("ticks",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},ha.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvent(){return Em(this._nextTick,this.floatTime+this.duration)?this.transport.scheduleOnce(this.invoke.bind(this),new rl(this.context,this._nextTick).toSeconds()):-1}_createEvents(e){Em(this._nextTick+this._interval,this.floatTime+this.duration)&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new rl(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.floatTime;const s=this.transport.getTicksAtTime(e);Xl(s,this.time)&&(this._nextTick=this.floatTime+Math.ceil((s-this.floatTime)/this._interval)*this._interval),this._currentId=this._createEvent(),this._nextTick+=this._interval,this._nextId=this._createEvent()}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this.transport.off("ticks",this._boundRestart),this}}class qp extends Bs{constructor(){const e=ue(qp.getDefaults(),arguments);super(e),this.name="Transport",this._loop=new Oz(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new kn,this._repeatedEvents=new Rz,this._syncedSignals=[],this._swingAmount=0,this._ppq=e.ppq,this._clock=new sR({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=e.ppq,this.bpm.setValueAtTime(e.bpm,0),He(this,"bpm"),this._timeSignature=e.timeSignature,this._swingTicks=e.ppq/2}static getDefaults(){return Object.assign(Bs.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,s){if(this._loop.get(e)&&s>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),s=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&s%this._ppq!==0&&s%(this._swingTicks*2)!==0){const n=s%(this._swingTicks*2)/(this._swingTicks*2),i=Math.sin(n*Math.PI)*this._swingAmount;e+=new rl(this.context,this._swingTicks*2/3).toSeconds()*i}ON(!0),this._timeline.forEachAtTime(s,n=>n.invoke(e)),ON(!1)}schedule(e,s){const n=new ha(this,{callback:e,time:new ku(this.context,s).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,s,n,i=1/0){const r=new u_(this,{callback:e,duration:new Un(this.context,i).toTicks(),interval:new Un(this.context,s).toTicks(),time:new ku(this.context,n).toTicks()});return this._addEvent(r,this._repeatedEvents)}scheduleOnce(e,s){const n=new ha(this,{callback:e,once:!0,time:new ku(this.context,s).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const s=this._scheduledEvents[e.toString()];s.timeline.remove(s.event),s.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,s){return this._scheduledEvents[e.id.toString()]={event:e,timeline:s},s.add(e),e.id}cancel(e=0){const s=this.toTicks(e);return this._timeline.forEachFrom(s,n=>this.clear(n.id)),this._repeatedEvents.forEachFrom(s,n=>this.clear(n.id)),this}_bindClockEvents(){this._clock.on("start",(e,s)=>{s=new rl(this.context,s).toSeconds(),this.emit("start",e,s)}),this._clock.on("stop",e=>{this.emit("stop",e)}),this._clock.on("pause",e=>{this.emit("pause",e)})}get state(){return this._clock.getStateAtTime(this.now())}start(e,s){this.context.resume();let n;return Oe(s)&&(n=this.toTicks(s)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),this._clock.getStateAtTime(e)!=="started"?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){an(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new Un(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new Un(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new rl(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),s=this._clock.getTicksAtTime(e);return new rl(this.context,s).toBarsBeatsSixteenths()}set position(e){const s=this.toTicks(e);this.ticks=s}get seconds(){return this._clock.seconds}set seconds(e){const s=this.now(),n=this._clock.frequency.timeToTicks(e,s);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}else return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const s=this.now();if(this.state==="started"){const n=this._clock.getTicksAtTime(s),i=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,s),r=s+i;this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this.emit("ticks",s),this._clock.setTicksAtTime(e,s)}}getTicksAtTime(e){return this._clock.getTicksAtTime(e)}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),this.state!=="started")return 0;{const s=this.now(),n=this.getTicksAtTime(s),i=e-n%e;return this._clock.nextTickTime(i,s)}}syncSignal(e,s){const n=this.now();let i=this.bpm,r=1/(60/i.getValueAtTime(n)/this.PPQ),a=[];if(e.units==="time"){const c=.015625/r,u=new Ke(c),d=new zp(-1),h=new Ke(c);i.chain(u,d,h),i=h,r=1/r,a=[u,d,h]}s||(e.getValueAtTime(n)!==0?s=e.getValueAtTime(n)/r:s=0);const l=new Ke(s);return i.connect(l),l.connect(e._param),a.push(l),this._syncedSignals.push({initial:e.value,nodes:a,signal:e}),e.value=0,this}unsyncSignal(e){for(let s=this._syncedSignals.length-1;s>=0;s--){const n=this._syncedSignals[s];n.signal===e&&(n.nodes.forEach(i=>i.dispose()),n.signal.value=n.initial,this._syncedSignals.splice(s,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),t_(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}Zd.mixin(qp);Fp(t=>{t.transport=new qp({context:t})});Up(t=>{t.transport.dispose()});class es extends de{constructor(e){super(e),this.input=void 0,this._state=new n_("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Qe,this._syncedStop=Qe,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Gi({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,He(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,onstop:Qe,volume:0})}get state(){return this._synced?this.context.transport.state==="started"?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,s,n){let i=wn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(i=this._clampToCurrentTime(i),!this._synced&&this._state.getValueAtTime(i)==="started")me(Xl(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,s,n);else if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const r=this._state.get(i);r&&(r.offset=this.toSeconds(Sl(s,0)),r.duration=n?this.toSeconds(n):void 0);const a=this.context.transport.schedule(l=>{this._start(l,s,n)},i);this._scheduled.push(a),this.context.transport.state==="started"&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else zC(this.context),this._start(i,s,n);return this}stop(e){let s=wn(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),this._state.getValueAtTime(s)==="started"||Oe(this._state.getNextState("started",s))){if(this.log("stop",s),!this._synced)this._stop(s);else{const n=this.context.transport.schedule(this._stop.bind(this),s);this._scheduled.push(n)}this._state.cancel(s),this._state.setStateAtTime("stopped",s)}return this}restart(e,s,n){return e=this.toSeconds(e),this._state.getValueAtTime(e)==="started"&&(this._state.cancel(e),this._restart(e,s,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,s)=>{if(Xl(s,0)){const n=this._state.get(s);if(n&&n.state==="started"&&n.time!==s){const i=s-this.toSeconds(n.time);let r;n.duration&&(r=this.toSeconds(n.duration)-i),this._start(e,this.toSeconds(n.offset)+i,r)}}},this._syncedStop=e=>{const s=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));this._state.getValueAtTime(s)==="started"&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach(e=>this.context.transport.clear(e)),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Qe,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class th extends Ql{constructor(){const e=ue(th.getDefaults(),arguments,["url","onload"]);super(e),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1,nr(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Re({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new rt(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ql.getDefaults(),{url:new rt,loop:!1,loopEnd:0,loopStart:0,onload:Qe,onerror:Qe,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,s,n,i=1){me(this.buffer.loaded,"buffer is either not set or not loaded");const r=this.toSeconds(e);this._startGain(r,i),this.loop?s=Sl(s,this.loopStart):s=Sl(s,0);let a=Math.max(this.toSeconds(s),0);if(this.loop){const l=this.toSeconds(this.loopEnd)||this.buffer.duration,c=this.toSeconds(this.loopStart),u=l-c;sb(a,l)&&(a=(a-c)%u+c),Dn(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Em(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(r,a)),Oe(n)){let l=this.toSeconds(n);l=Math.max(l,0),this.stop(r+l)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class fa extends es{constructor(){const e=ue(fa.getDefaults(),arguments,["type"]);super(e),this.name="Noise",this._source=null,this._playbackRate=e.playbackRate,this.type=e.type,this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut}static getDefaults(){return Object.assign(es.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(e){if(me(e in MN,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,this.state==="started")){const s=this.now();this._stop(s),this._start(s)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}_start(e){const s=MN[this._type];this._source=new th({url:s,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(s.duration-.001))}_stop(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(e){this._stop(e),this._start(e)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const Vo=44100*5,ag=2,Si={brown:null,pink:null,white:null},MN={get brown(){if(!Si.brown){const t=[];for(let e=0;e<ag;e++){const s=new Float32Array(Vo);t[e]=s;let n=0;for(let i=0;i<Vo;i++){const r=Math.random()*2-1;s[i]=(n+.02*r)/1.02,n=s[i],s[i]*=3.5}}Si.brown=new rt().fromArray(t)}return Si.brown},get pink(){if(!Si.pink){const t=[];for(let e=0;e<ag;e++){const s=new Float32Array(Vo);t[e]=s;let n,i,r,a,l,c,u;n=i=r=a=l=c=u=0;for(let d=0;d<Vo;d++){const h=Math.random()*2-1;n=.99886*n+h*.0555179,i=.99332*i+h*.0750759,r=.969*r+h*.153852,a=.8665*a+h*.3104856,l=.55*l+h*.5329522,c=-.7616*c-h*.016898,s[d]=n+i+r+a+l+c+u+h*.5362,s[d]*=.11,u=h*.115926}}Si.pink=new rt().fromArray(t)}return Si.pink},get white(){if(!Si.white){const t=[];for(let e=0;e<ag;e++){const s=new Float32Array(Vo);t[e]=s;for(let n=0;n<Vo;n++)s[n]=Math.random()*2-1}Si.white=new rt().fromArray(t)}return Si.white}};function Io(t,e){return Lt(this,void 0,void 0,function*(){const s=e/t.context.sampleRate,n=new $p(1,s,t.context.sampleRate);return new t.constructor(Object.assign(t.get(),{frequency:2/s,detune:0,context:n})).toDestination().start(0),(yield n.render()).getChannelData(0)})}class d_ extends Ql{constructor(){const e=ue(d_.getDefaults(),arguments,["frequency","type"]);super(e),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator],nr(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new Re({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new Re({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),He(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ql.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const s=this.toSeconds(e);return this.log("start",s),this._startGain(s),this._oscillator.start(s),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),this.state==="started"&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class Ot extends es{constructor(){const e=ue(Ot.getDefaults(),arguments,["frequency","type"]);super(e),this.name="Oscillator",this._oscillator=null,this.frequency=new ze({context:this.context,units:"frequency",value:e.frequency}),He(this,"frequency"),this.detune=new ze({context:this.context,units:"cents",value:e.detune}),He(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&e.type!=="custom"&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const s=this.toSeconds(e),n=new d_({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(s)}_stop(e){const s=this.toSeconds(e);this._oscillator&&this._oscillator.stop(s)}_restart(e){const s=this.toSeconds(e);return this.log("restart",s),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(s),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if(this._type==="custom")return Ot._periodicWaveCache.find(s=>s.phase===this._phase&&pz(s.partials,this._partials));{const e=Ot._periodicWaveCache.find(s=>s.type===this._type&&s.phase===this._phase);return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const s=["sine","square","sawtooth","triangle"].indexOf(e)!==-1;if(this._phase===0&&s)this._wave=void 0,this._partialCount=0,this._oscillator!==null&&(this._oscillator.type=e);else{const n=this._getCachedPeriodicWave();if(Oe(n)){const{partials:i,wave:r}=n;this._wave=r,this._partials=i,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave)}else{const[i,r]=this._getRealImaginary(e,this._phase),a=this.context.createPeriodicWave(i,r);this._wave=a,this._oscillator!==null&&this._oscillator.setPeriodicWave(this._wave),Ot._periodicWaveCache.push({imag:r,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:i,type:this._type,wave:this._wave}),Ot._periodicWaveCache.length>100&&Ot._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&this._type!=="custom"&&e!=="custom"?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Js(e,0);let s=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(s=n[1]),this._type!=="custom")e===0?this.type=s:this.type=s+e.toString();else{const i=new Float32Array(e);this._partials.forEach((r,a)=>i[a]=r),this._partials=Array.from(i),this.type=this._type}}_getRealImaginary(e,s){let i=2048;const r=new Float32Array(i),a=new Float32Array(i);let l=1;if(e==="custom"){if(l=this._partials.length+1,this._partialCount=this._partials.length,i=l,this._partials.length===0)return[r,a]}else{const c=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);c?(l=parseInt(c[2],10)+1,this._partialCount=parseInt(c[2],10),e=c[1],l=Math.max(l,2),i=l):this._partialCount=0,this._partials=[]}for(let c=1;c<i;++c){const u=2/(c*Math.PI);let d;switch(e){case"sine":d=c<=l?1:0,this._partials[c-1]=d;break;case"square":d=c&1?2*u:0,this._partials[c-1]=d;break;case"sawtooth":d=u*(c&1?1:-1),this._partials[c-1]=d;break;case"triangle":c&1?d=2*(u*u)*(c-1>>1&1?-1:1):d=0,this._partials[c-1]=d;break;case"custom":d=this._partials[c-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}d!==0?(r[c]=-d*Math.sin(s*c),a[c]=d*Math.cos(s*c)):(r[c]=0,a[c]=0)}return[r,a]}_inverseFFT(e,s,n){let i=0;const r=e.length;for(let a=0;a<r;a++)i+=e[a]*Math.cos(a*n)+s[a]*Math.sin(a*n);return i}getInitialValue(){const[e,s]=this._getRealImaginary(this._type,0);let n=0;const i=Math.PI*2,r=32;for(let a=0;a<r;a++)n=Math.max(this._inverseFFT(e,s,a/r*i),n);return xz(-this._inverseFFT(e,s,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this._oscillator!==null&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}Ot._periodicWaveCache=[];class iR extends di{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Tc({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class ir extends ze{constructor(){const e=ue(ir.getDefaults(),arguments,["value"]);super(e),this.name="Multiply",this.override=!1,this._mult=this.input=this.output=new Ke({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(ze.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Kp extends es{constructor(){const e=ue(Kp.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="AMOscillator",this._modulationScale=new iR({context:this.context}),this._modulationNode=new Ke({context:this.context}),this._carrier=new Ot({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new Ot({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ir({context:this.context,units:"positive",value:e.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),He(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ot.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){this._modulator.restart(e),this._carrier.restart(e)}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Wp extends es{constructor(){const e=ue(Wp.getDefaults(),arguments,["frequency","type","modulationType"]);super(e),this.name="FMOscillator",this._modulationNode=new Ke({context:this.context,gain:0}),this._carrier=new Ot({context:this.context,detune:e.detune,frequency:0,onstop:()=>this.onstop(this),phase:e.phase,type:e.type}),this.detune=this._carrier.detune,this.frequency=new ze({context:this.context,units:"frequency",value:e.frequency}),this._modulator=new Ot({context:this.context,phase:e.phase,type:e.modulationType}),this.harmonicity=new ir({context:this.context,units:"positive",value:e.harmonicity}),this.modulationIndex=new ir({context:this.context,units:"positive",value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),He(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(Ot.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(e){this._modulator.start(e),this._carrier.start(e)}_stop(e){this._modulator.stop(e),this._carrier.stop(e)}_restart(e){return this._modulator.restart(e),this._carrier.restart(e),this}get type(){return this._carrier.type}set type(e){this._carrier.type=e}get baseType(){return this._carrier.baseType}set baseType(e){this._carrier.baseType=e}get partialCount(){return this._carrier.partialCount}set partialCount(e){this._carrier.partialCount=e}get modulationType(){return this._modulator.type}set modulationType(e){this._modulator.type=e}get phase(){return this._carrier.phase}set phase(e){this._carrier.phase=e,this._modulator.phase=e}get partials(){return this._carrier.partials}set partials(e){this._carrier.partials=e}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class sh extends es{constructor(){const e=ue(sh.getDefaults(),arguments,["frequency","width"]);super(e),this.name="PulseOscillator",this._widthGate=new Ke({context:this.context,gain:0}),this._thresh=new Tc({context:this.context,mapping:s=>s<=0?-1:1}),this.width=new ze({context:this.context,units:"audioRange",value:e.width}),this._triangle=new Ot({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),He(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}_stop(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}_restart(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}get phase(){return this._triangle.phase}set phase(e){this._triangle.phase=e}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(e){this._triangle.type=e}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class Yp extends es{constructor(){const e=ue(Yp.getDefaults(),arguments,["frequency","type","spread"]);super(e),this.name="FatOscillator",this._oscillators=[],this.frequency=new ze({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ze({context:this.context,units:"cents",value:e.detune}),this._spread=e.spread,this._type=e.type,this._phase=e.phase,this._partials=e.partials,this._partialCount=e.partialCount,this.count=e.count,He(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ot.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(e){e=this.toSeconds(e),this._forEach(s=>s.start(e))}_stop(e){e=this.toSeconds(e),this._forEach(s=>s.stop(e))}_restart(e){this._forEach(s=>s.restart(e))}_forEach(e){for(let s=0;s<this._oscillators.length;s++)e(this._oscillators[s],s)}get type(){return this._type}set type(e){this._type=e,this._forEach(s=>s.type=e)}get spread(){return this._spread}set spread(e){if(this._spread=e,this._oscillators.length>1){const s=-e/2,n=e/(this._oscillators.length-1);this._forEach((i,r)=>i.detune.value=s+n*r)}}get count(){return this._oscillators.length}set count(e){if(Js(e,1),this._oscillators.length!==e){this._forEach(s=>s.dispose()),this._oscillators=[];for(let s=0;s<e;s++){const n=new Ot({context:this.context,volume:-6-e*1.1,type:this._type,phase:this._phase+s/e*360,partialCount:this._partialCount,onstop:s===0?()=>this.onstop(this):Qe});this.type==="custom"&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[s]=n}this.spread=this._spread,this.state==="started"&&this._forEach(s=>s.start())}}get phase(){return this._phase}set phase(e){this._phase=e,this._forEach((s,n)=>s.phase=this._phase+n/this.count*360)}get baseType(){return this._oscillators[0].baseType}set baseType(e){this._forEach(s=>s.baseType=e),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach(s=>s.partials=e))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(e){this._partialCount=e,this._forEach(s=>s.partialCount=e),this._type=this._oscillators[0].type}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach(e=>e.dispose()),this}}class Xp extends es{constructor(){const e=ue(Xp.getDefaults(),arguments,["frequency","modulationFrequency"]);super(e),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new ir({context:this.context,value:2}),this._pulse=new sh({context:this.context,frequency:e.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new Ot({context:this.context,detune:e.detune,frequency:e.frequency,onstop:()=>this.onstop(this),phase:e.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),He(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(es.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}_stop(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}_restart(e){this._modulator.restart(e),this._pulse.restart(e)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(e){this._modulator.phase=e}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const DN={am:Kp,fat:Yp,fm:Wp,oscillator:Ot,pulse:sh,pwm:Xp};class ma extends es{constructor(){const e=ue(ma.getDefaults(),arguments,["frequency","type"]);super(e),this.name="OmniOscillator",this.frequency=new ze({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ze({context:this.context,units:"cents",value:e.detune}),He(this,["frequency","detune"]),this.set(e)}static getDefaults(){return Object.assign(Ot.getDefaults(),Wp.getDefaults(),Kp.getDefaults(),Yp.getDefaults(),sh.getDefaults(),Xp.getDefaults())}_start(e){this._oscillator.start(e)}_stop(e){this._oscillator.stop(e)}_restart(e){return this._oscillator.restart(e),this}get type(){let e="";return["am","fm","fat"].some(s=>this._sourceType===s)&&(e=this._sourceType),e+this._oscillator.type}set type(e){e.substr(0,2)==="fm"?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,2)==="am"?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):e.substr(0,3)==="fat"?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):e==="pwm"?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):e==="pulse"?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}get partials(){return this._oscillator.partials}set partials(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partials=e)}get partialCount(){return this._oscillator.partialCount}set partialCount(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&(this._oscillator.partialCount=e)}set(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),super.set(e),this}_createNewOscillator(e){if(e!==this._sourceType){this._sourceType=e;const s=DN[e],n=this.now();if(this._oscillator){const i=this._oscillator;i.stop(n),this.context.setTimeout(()=>i.dispose(),this.blockTime)}this._oscillator=new s({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),this.state==="started"&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e}get sourceType(){return this._sourceType}set sourceType(e){let s="sine";this._oscillator.type!=="pwm"&&this._oscillator.type!=="pulse"&&(s=this._oscillator.type),e==="fm"?this.type="fm"+s:e==="am"?this.type="am"+s:e==="fat"?this.type="fat"+s:e==="oscillator"?this.type=s:e==="pulse"?this.type="pulse":e==="pwm"&&(this.type="pwm")}_getOscType(e,s){return e instanceof DN[s]}get baseType(){return this._oscillator.baseType}set baseType(e){!this._getOscType(this._oscillator,"pulse")&&!this._getOscType(this._oscillator,"pwm")&&e!=="pulse"&&e!=="pwm"&&(this._oscillator.baseType=e)}get width(){if(this._getOscType(this._oscillator,"pulse"))return this._oscillator.width}get count(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.count}set count(e){this._getOscType(this._oscillator,"fat")&&tr(e)&&(this._oscillator.count=e)}get spread(){if(this._getOscType(this._oscillator,"fat"))return this._oscillator.spread}set spread(e){this._getOscType(this._oscillator,"fat")&&tr(e)&&(this._oscillator.spread=e)}get modulationType(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.modulationType}set modulationType(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&sr(e)&&(this._oscillator.modulationType=e)}get modulationIndex(){if(this._getOscType(this._oscillator,"fm"))return this._oscillator.modulationIndex}get harmonicity(){if(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))return this._oscillator.harmonicity}get modulationFrequency(){if(this._getOscType(this._oscillator,"pwm"))return this._oscillator.modulationFrequency}asArray(){return Lt(this,arguments,void 0,function*(e=1024){return Io(this,e)})}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class h_ extends ze{constructor(){super(ue(h_.getDefaults(),arguments,["value"])),this.override=!1,this.name="Add",this._sum=new Ke({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,od(this._constantSource,this._sum)}static getDefaults(){return Object.assign(ze.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}let rR=class aR extends di{constructor(){const e=ue(aR.getDefaults(),arguments,["min","max"]);super(e),this.name="Scale",this._mult=this.input=new ir({context:this.context,value:e.max-e.min}),this._add=this.output=new h_({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(di.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}};class f_ extends di{constructor(){super(ue(f_.getDefaults(),arguments)),this.name="Zero",this._gain=new Ke({context:this.context}),this.output=this._gain,this.input=void 0,nr(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),tR(this.context.getConstant(0),this._gain),this}}class Tl extends de{constructor(){const e=ue(Tl.getDefaults(),arguments,["frequency","min","max"]);super(e),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Re.prototype._fromType,this._toType=Re.prototype._toType,this._is=Re.prototype._is,this._clampValue=Re.prototype._clampValue,this._oscillator=new Ot(e),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Ke({context:this.context,gain:e.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new ze({context:this.context,units:"audioRange",value:0}),this._zeros=new f_({context:this.context}),this._a2g=new iR({context:this.context}),this._scaler=this.output=new rR({context:this.context,max:e.max,min:e.min}),this.units=e.units,this.min=e.min,this.max=e.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),He(this,["amplitude","frequency"]),this.phase=e.phase}static getDefaults(){return Object.assign(Ot.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const s=this.min,n=this.max;this._units=e,this.min=s,this.max=n}get state(){return this._oscillator.state}connect(e,s,n){return(e instanceof Re||e instanceof ze)&&(this.convert=e.convert,this.units=e.units),Gp(this,e,s,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function oR(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(r){Js(r,t,e),s.set(this,r)}})}}function fr(t,e=1/0){const s=new WeakMap;return function(n,i){Reflect.defineProperty(n,i,{configurable:!0,enumerable:!0,get:function(){return s.get(this)},set:function(r){Js(this.toSeconds(r),t,e),s.set(this,r)}})}}class Qp extends es{constructor(){const e=ue(Qp.getDefaults(),arguments,["url","onload"]);super(e),this.name="Player",this._activeSources=new Set,this._buffer=new rt({onload:this._onload.bind(this,e.onload),onerror:e.onerror,reverse:e.reverse,url:e.url}),this.autostart=e.autostart,this._loop=e.loop,this._loopStart=e.loopStart,this._loopEnd=e.loopEnd,this._playbackRate=e.playbackRate,this.fadeIn=e.fadeIn,this.fadeOut=e.fadeOut}static getDefaults(){return Object.assign(es.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Qe,onerror:Qe,playbackRate:1,reverse:!1})}load(e){return Lt(this,void 0,void 0,function*(){return yield this._buffer.load(e),this._onload(),this})}_onload(e=Qe){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),this._activeSources.size===0&&!this._synced&&this._state.getValueAtTime(this.now())==="started"&&(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,s,n){return super.start(e,s,n),this}_start(e,s,n){this._loop?s=Sl(s,this._loopStart):s=Sl(s,0);const i=this.toSeconds(s),r=n;n=Sl(n,Math.max(this._buffer.duration-i,0));let a=this.toSeconds(n);a=a/this._playbackRate,e=this.toSeconds(e);const l=new th({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);!this._loop&&!this._synced&&(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(l),this._loop&&wn(r)?l.start(e,i):l.start(e,i,a-this.toSeconds(this.fadeOut))}_stop(e){const s=this.toSeconds(e);this._activeSources.forEach(n=>n.stop(s))}restart(e,s,n){return super.restart(e,s,n),this}_restart(e,s,n){var i;(i=[...this._activeSources].pop())===null||i===void 0||i.stop(e),this._start(e,s,n)}seek(e,s){const n=this.toSeconds(s);if(this._state.getValueAtTime(n)==="started"){const i=this.toSeconds(e);this._stop(n),this._start(n,i)}return this}setLoopPoints(e,s){return this.loopStart=e,this.loopEnd=s,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Js(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopStart=e})}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Js(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach(s=>{s.loopEnd=e})}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach(s=>{s.loop=e}),e)){const s=this._state.getNextState("stopped",this.now());s&&this._state.cancel(s.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const s=this.now(),n=this._state.getNextState("stopped",s);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach(i=>i.cancelStop())),this._activeSources.forEach(i=>{i.playbackRate.setValueAtTime(e,s)})}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach(e=>e.dispose()),this._activeSources.clear(),this._buffer.dispose(),this}}Jn([fr(0)],Qp.prototype,"fadeIn",void 0);Jn([fr(0)],Qp.prototype,"fadeOut",void 0);class Mz extends di{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Tc({context:this.context,mapping:e=>Math.abs(e)*2-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Hs extends de{constructor(){const e=ue(Hs.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="Envelope",this._sig=new ze({context:this.context,value:0}),this.output=this._sig,this.input=void 0,this.attack=e.attack,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.attackCurve=e.attackCurve,this.releaseCurve=e.releaseCurve,this.decayCurve=e.decayCurve}static getDefaults(){return Object.assign(de.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,s){if(sr(e))return e;{let n;for(n in Dh)if(Dh[n][s]===e)return n;return e}}_setCurve(e,s,n){if(sr(n)&&Reflect.has(Dh,n)){const i=Dh[n];eo(i)?e!=="_decayCurve"&&(this[e]=i[s]):this[e]=i}else if(an(n)&&e!=="_decayCurve")this[e]=n;else throw new Error("Envelope: invalid curve: "+n)}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._getCurve(this._decayCurve,"Out")}set decayCurve(e){this._setCurve("_decayCurve","Out",e)}triggerAttack(e,s=1){this.log("triggerAttack",e,s),e=this.toSeconds(e);let i=this.toSeconds(this.attack);const r=this.toSeconds(this.decay),a=this.getValueAtTime(e);if(a>0){const l=1/i;i=(1-a)/l}if(i<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(s,e);else if(this._attackCurve==="linear")this._sig.linearRampTo(s,i,e);else if(this._attackCurve==="exponential")this._sig.targetRampTo(s,i,e);else{this._sig.cancelAndHoldAtTime(e);let l=this._attackCurve;for(let c=1;c<l.length;c++)if(l[c-1]<=a&&a<=l[c]){l=this._attackCurve.slice(c),l[0]=a;break}this._sig.setValueCurveAtTime(l,e,i,s)}if(r&&this.sustain<1){const l=s*this.sustain,c=e+i;this.log("decay",c),this._decayCurve==="linear"?this._sig.linearRampToValueAtTime(l,r+c):this._sig.exponentialApproachValueAtTime(l,c,r)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const s=this.getValueAtTime(e);if(s>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):this._releaseCurve==="linear"?this._sig.linearRampTo(0,n,e):this._releaseCurve==="exponential"?this._sig.targetRampTo(0,n,e):(me(an(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,s))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,s,n=1){return s=this.toSeconds(s),this.triggerAttack(s,n),this.triggerRelease(s+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,s=0,n=0){return Gp(this,e,s,n),this}asArray(){return Lt(this,arguments,void 0,function*(e=1024){const s=e/this.context.sampleRate,n=new $p(1,s,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),r=i+this.toSeconds(this.release),a=r*.1,l=r+a,c=new this.constructor(Object.assign(this.get(),{attack:s*this.toSeconds(this.attack)/l,decay:s*this.toSeconds(this.decay)/l,release:s*this.toSeconds(this.release)/l,context:n}));return c._sig.toDestination(),c.triggerAttackRelease(s*(i+a)/l,0),(yield n.render()).getChannelData(0)})}dispose(){return super.dispose(),this._sig.dispose(),this}}Jn([fr(0)],Hs.prototype,"attack",void 0);Jn([fr(0)],Hs.prototype,"decay",void 0);Jn([oR(0,1)],Hs.prototype,"sustain",void 0);Jn([fr(0)],Hs.prototype,"release",void 0);const Dh=(()=>{let e,s;const n=[];for(e=0;e<128;e++)n[e]=Math.sin(e/127*(Math.PI/2));const i=[],r=6.4;for(e=0;e<127;e++){s=e/127;const f=Math.sin(s*(Math.PI*2)*r-Math.PI/2)+1;i[e]=f/10+s*.83}i[127]=1;const a=[],l=5;for(e=0;e<128;e++)a[e]=Math.ceil(e/127*l)/l;const c=[];for(e=0;e<128;e++)s=e/127,c[e]=.5*(1-Math.cos(Math.PI*s));const u=[];for(e=0;e<128;e++){s=e/127;const f=Math.pow(s,3)*4+.2,m=Math.cos(f*Math.PI*2*s);u[e]=Math.abs(m*(1-s))}function d(f){const m=new Array(f.length);for(let b=0;b<f.length;b++)m[b]=1-f[b];return m}function h(f){return f.slice(0).reverse()}return{bounce:{In:d(u),Out:u},cosine:{In:n,Out:h(n)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:d(i)},sine:{In:c,Out:d(c)},step:{In:a,Out:d(a)}}})();class hi extends de{constructor(){const e=ue(hi.getDefaults(),arguments);super(e),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease,this._syncedRelease=s=>this._original_triggerRelease(s),this._volume=this.output=new Gi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,He(this,"volume")}static getDefaults(){return Object.assign(de.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,s){const n=this["_original_"+e]=this[e];this[e]=(...i)=>{const r=i[s],a=this.context.transport.schedule(l=>{i[s]=l,n.apply(this,i)},r);this._scheduledEvents.push(a)}}unsync(){return this._scheduledEvents.forEach(e=>this.context.transport.clear(e)),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease,this.context.transport.off("stop",this._syncedRelease),this.context.transport.off("pause",this._syncedRelease),this.context.transport.off("loopEnd",this._syncedRelease)),this}triggerAttackRelease(e,s,n,i){const r=this.toSeconds(n),a=this.toSeconds(s);return this.triggerAttack(e,r,i),this.triggerRelease(r+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Wn extends hi{constructor(){const e=ue(Wn.getDefaults(),arguments);super(e),this.portamento=e.portamento,this.onsilence=e.onsilence}static getDefaults(){return Object.assign(hi.getDefaults(),{detune:0,onsilence:Qe,portamento:0})}triggerAttack(e,s,n=1){this.log("triggerAttack",e,s,n);const i=this.toSeconds(s);return this._triggerEnvelopeAttack(i,n),this.setNote(e,i),this}triggerRelease(e){this.log("triggerRelease",e);const s=this.toSeconds(e);return this._triggerEnvelopeRelease(s),this}setNote(e,s){const n=this.toSeconds(s),i=e instanceof en?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const r=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,r,n)}else this.frequency.setValueAtTime(i,n);return this}}Jn([fr(0)],Wn.prototype,"portamento",void 0);class nh extends Hs{constructor(){super(ue(nh.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Ke({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class pa extends Wn{constructor(){const e=ue(pa.getDefaults(),arguments);super(e),this.name="Synth",this.oscillator=new ma(Object.assign({context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)},e.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new nh(Object.assign({context:this.context},e.envelope)),this.oscillator.chain(this.envelope,this.output),He(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Wn.getDefaults(),{envelope:Object.assign(Zs(Hs.getDefaults(),Object.keys(de.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Zs(ma.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(e,s){if(this.envelope.triggerAttack(e,s),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class jm extends Wn{constructor(){const e=ue(jm.getDefaults(),arguments);super(e),this.name="ModulationSynth",this._carrier=new pa({context:this.context,oscillator:e.oscillator,envelope:e.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new pa({context:this.context,oscillator:e.modulation,envelope:e.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new ze({context:this.context,units:"frequency"}),this.detune=new ze({context:this.context,value:e.detune,units:"cents"}),this.harmonicity=new ir({context:this.context,value:e.harmonicity,minValue:0}),this._modulationNode=new Ke({context:this.context,gain:0}),He(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(Wn.getDefaults(),{harmonicity:3,oscillator:Object.assign(Zs(ma.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(Zs(Hs.getDefaults(),Object.keys(de.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(Zs(ma.getDefaults(),[...Object.keys(es.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(Zs(Hs.getDefaults(),Object.keys(de.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(e,s){this._carrier._triggerEnvelopeAttack(e,s),this._modulator._triggerEnvelopeAttack(e,s)}_triggerEnvelopeRelease(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class Cm extends de{constructor(){const e=ue(Cm.getDefaults(),arguments,["frequency","type"]);super(e),this.name="BiquadFilter",this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new Re({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new Re({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new Re({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new Re({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(de.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){me(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const s=new Float32Array(e);for(let a=0;a<e;a++){const c=Math.pow(a/e,2)*19980+20;s[a]=c}const n=new Float32Array(e),i=new Float32Array(e),r=this.context.createBiquadFilter();return r.type=this.type,r.Q.value=this.Q.value,r.frequency.value=this.frequency.value,r.gain.value=this.gain.value,r.getFrequencyResponse(s,n,i),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Pi extends de{constructor(){const e=ue(Pi.getDefaults(),arguments,["frequency","type","rolloff"]);super(e),this.name="Filter",this.input=new Ke({context:this.context}),this.output=new Ke({context:this.context}),this._filters=[],this._filters=[],this.Q=new ze({context:this.context,units:"positive",value:e.Q}),this.frequency=new ze({context:this.context,units:"frequency",value:e.frequency}),this.detune=new ze({context:this.context,units:"cents",value:e.detune}),this.gain=new ze({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,He(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(de.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){me(["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e)!==-1,`Invalid filter type: ${e}`),this._type=e,this._filters.forEach(n=>n.type=e)}get rolloff(){return this._rolloff}set rolloff(e){const s=tr(e)?e:parseInt(e,10),n=[-12,-24,-48,-96];let i=n.indexOf(s);me(i!==-1,`rolloff can only be ${n.join(", ")}`),i+=1,this._rolloff=s,this.input.disconnect(),this._filters.forEach(r=>r.disconnect()),this._filters=new Array(i);for(let r=0;r<i;r++){const a=new Cm({context:this.context});a.type=this._type,this.frequency.connect(a.frequency),this.detune.connect(a.detune),this.Q.connect(a.Q),this.gain.connect(a.gain),this._filters[r]=a}this._internalChannels=this._filters,od(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const s=new Cm({context:this.context,frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map(()=>1);return this._filters.forEach(()=>{s.getFrequencyResponse(e).forEach((r,a)=>n[a]*=r)}),s.dispose(),n}dispose(){return super.dispose(),this._filters.forEach(e=>{e.dispose()}),t_(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class Rm extends Hs{constructor(){const e=ue(Rm.getDefaults(),arguments,["attack","decay","sustain","release"]);super(e),this.name="FrequencyEnvelope",this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new zp({context:this.context,value:e.exponent}),this._scale=this.output=new rR({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Hs.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const s=this.toFrequency(e);Js(s,0),this._baseFrequency=s,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class m_ extends Wn{constructor(){const e=ue(m_.getDefaults(),arguments);super(e),this.name="MonoSynth",this.oscillator=new ma(Object.assign(e.oscillator,{context:this.context,detune:e.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new Pi(Object.assign(e.filter,{context:this.context})),this.filterEnvelope=new Rm(Object.assign(e.filterEnvelope,{context:this.context})),this.envelope=new nh(Object.assign(e.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),He(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(Wn.getDefaults(),{envelope:Object.assign(Zs(Hs.getDefaults(),Object.keys(de.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(Zs(Pi.getDefaults(),Object.keys(de.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(Zs(Rm.getDefaults(),Object.keys(de.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(Zs(ma.getDefaults(),Object.keys(es.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(e,s=1){if(this.envelope.triggerAttack(e,s),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),this.envelope.sustain===0){const n=this.toSeconds(this.envelope.attack),i=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+i)}}_triggerEnvelopeRelease(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}getLevelAtTime(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class p_ extends jm{constructor(){const e=ue(p_.getDefaults(),arguments);super(e),this.name="FMSynth",this.modulationIndex=new ir({context:this.context,value:e.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(jm.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}class ih extends pa{constructor(){const e=ue(ih.getDefaults(),arguments);super(e),this.name="MembraneSynth",this.portamento=0,this.pitchDecay=e.pitchDecay,this.octaves=e.octaves,He(this,["oscillator","envelope"])}static getDefaults(){return to(Wn.getDefaults(),pa.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(e,s){const n=this.toSeconds(s),i=this.toFrequency(e instanceof en?e.toFrequency():e),r=i*this.octaves;return this.oscillator.frequency.setValueAtTime(r,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Jn([oR(0)],ih.prototype,"octaves",void 0);Jn([fr(0)],ih.prototype,"pitchDecay",void 0);class Im extends hi{constructor(){const e=ue(Im.getDefaults(),arguments);super(e),this.name="NoiseSynth",this.noise=new fa(Object.assign({context:this.context},e.noise)),this.envelope=new nh(Object.assign({context:this.context},e.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(hi.getDefaults(),{envelope:Object.assign(Zs(Hs.getDefaults(),Object.keys(de.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(Zs(fa.getDefaults(),Object.keys(es.getDefaults())),{type:"white"})})}triggerAttack(e,s=1){return e=this.toSeconds(e),this.envelope.triggerAttack(e,s),this.noise.start(e),this.envelope.sustain===0&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(e,s,n=1){return s=this.toSeconds(s),e=this.toSeconds(e),this.triggerAttack(s,n),this.triggerRelease(s+e),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const lR=new Set;function g_(t){lR.add(t)}function cR(t,e){const s=`registerProcessor("${t}", ${e})`;lR.add(s)}const Dz=`
	/**
	 * The base AudioWorkletProcessor for use in Tone.js. Works with the {@link ToneAudioWorklet}. 
	 */
	class ToneAudioWorkletProcessor extends AudioWorkletProcessor {

		constructor(options) {
			
			super(options);
			/**
			 * If the processor was disposed or not. Keep alive until it's disposed.
			 */
			this.disposed = false;
		   	/** 
			 * The number of samples in the processing block
			 */
			this.blockSize = 128;
			/**
			 * the sample rate
			 */
			this.sampleRate = sampleRate;

			this.port.onmessage = (event) => {
				// when it receives a dispose 
				if (event.data === "dispose") {
					this.disposed = true;
				}
			};
		}
	}
`;g_(Dz);const Lz=`
	/**
	 * Abstract class for a single input/output processor. 
	 * has a 'generate' function which processes one sample at a time
	 */
	class SingleIOProcessor extends ToneAudioWorkletProcessor {

		constructor(options) {
			super(Object.assign(options, {
				numberOfInputs: 1,
				numberOfOutputs: 1
			}));
			/**
			 * Holds the name of the parameter and a single value of that
			 * parameter at the current sample
			 * @type { [name: string]: number }
			 */
			this.params = {}
		}

		/**
		 * Generate an output sample from the input sample and parameters
		 * @abstract
		 * @param input number
		 * @param channel number
		 * @param parameters { [name: string]: number }
		 * @returns number
		 */
		generate(){}

		/**
		 * Update the private params object with the 
		 * values of the parameters at the given index
		 * @param parameters { [name: string]: Float32Array },
		 * @param index number
		 */
		updateParams(parameters, index) {
			for (const paramName in parameters) {
				const param = parameters[paramName];
				if (param.length > 1) {
					this.params[paramName] = parameters[paramName][index];
				} else {
					this.params[paramName] = parameters[paramName][0];
				}
			}
		}

		/**
		 * Process a single frame of the audio
		 * @param inputs Float32Array[][]
		 * @param outputs Float32Array[][]
		 */
		process(inputs, outputs, parameters) {
			const input = inputs[0];
			const output = outputs[0];
			// get the parameter values
			const channelCount = Math.max(input && input.length || 0, output.length);
			for (let sample = 0; sample < this.blockSize; sample++) {
				this.updateParams(parameters, sample);
				for (let channel = 0; channel < channelCount; channel++) {
					const inputSample = input && input.length ? input[channel][sample] : 0;
					output[channel][sample] = this.generate(inputSample, channel, this.params);
				}
			}
			return !this.disposed;
		}
	};
`;g_(Lz);const Pz=`
	/**
	 * A multichannel buffer for use within an AudioWorkletProcessor as a delay line
	 */
	class DelayLine {
		
		constructor(size, channels) {
			this.buffer = [];
			this.writeHead = []
			this.size = size;

			// create the empty channels
			for (let i = 0; i < channels; i++) {
				this.buffer[i] = new Float32Array(this.size);
				this.writeHead[i] = 0;
			}
		}

		/**
		 * Push a value onto the end
		 * @param channel number
		 * @param value number
		 */
		push(channel, value) {
			this.writeHead[channel] += 1;
			if (this.writeHead[channel] > this.size) {
				this.writeHead[channel] = 0;
			}
			this.buffer[channel][this.writeHead[channel]] = value;
		}

		/**
		 * Get the recorded value of the channel given the delay
		 * @param channel number
		 * @param delay number delay samples
		 */
		get(channel, delay) {
			let readHead = this.writeHead[channel] - Math.floor(delay);
			if (readHead < 0) {
				readHead += this.size;
			}
			return this.buffer[channel][readHead];
		}
	}
`;g_(Pz);const Vz="feedback-comb-filter",Bz=`
	class FeedbackCombFilterWorklet extends SingleIOProcessor {

		constructor(options) {
			super(options);
			this.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);
		}

		static get parameterDescriptors() {
			return [{
				name: "delayTime",
				defaultValue: 0.1,
				minValue: 0,
				maxValue: 1,
				automationRate: "k-rate"
			}, {
				name: "feedback",
				defaultValue: 0.5,
				minValue: 0,
				maxValue: 0.9999,
				automationRate: "k-rate"
			}];
		}

		generate(input, channel, parameters) {
			const delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);
			this.delayLine.push(channel, input + delayedSample * parameters.feedback);
			return delayedSample;
		}
	}
`;cR(Vz,Bz);class Om extends hi{constructor(){const e=ue(Om.getDefaults(),arguments,["voice","options"]);super(e),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0,this._syncedRelease=i=>this.releaseAll(i),me(!tr(e.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const s=e.voice.getDefaults();this.options=Object.assign(s,e.options),this.voice=e.voice,this.maxPolyphony=e.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(hi.getDefaults(),{maxPolyphony:32,options:{},voice:pa})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(e){this._availableVoices.push(e);const s=this._activeVoices.findIndex(n=>n.voice===e);this._activeVoices.splice(s,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return me(e instanceof Wn,"Voice must extend Monophonic class"),e.connect(this.output),this._voices.push(e),e}else Bp("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(this._averageActiveVoices*.95,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const e=this._availableVoices.shift(),s=this._voices.indexOf(e);this._voices.splice(s,1),this.context.isOffline||e.dispose()}}_triggerAttack(e,s,n){e.forEach(i=>{const r=new Am(this.context,i).toMidi(),a=this._getNextAvailableVoice();a&&(a.triggerAttack(i,s,n),this._activeVoices.push({midi:r,voice:a,released:!1}),this.log("triggerAttack",i,s))})}_triggerRelease(e,s){e.forEach(n=>{const i=new Am(this.context,n).toMidi(),r=this._activeVoices.find(({midi:a,released:l})=>a===i&&!l);r&&(r.voice.triggerRelease(s),r.released=!0,this.log("triggerRelease",n,s))})}_scheduleEvent(e,s,n,i){me(!this.disposed,"Synth was already disposed"),n<=this.now()?e==="attack"?this._triggerAttack(s,n,i):this._triggerRelease(s,n):this.context.setTimeout(()=>{this.disposed||this._scheduleEvent(e,s,n,i)},n-this.now())}triggerAttack(e,s,n){Array.isArray(e)||(e=[e]);const i=this.toSeconds(s);return this._scheduleEvent("attack",e,i,n),this}triggerRelease(e,s){Array.isArray(e)||(e=[e]);const n=this.toSeconds(s);return this._scheduleEvent("release",e,n),this}triggerAttackRelease(e,s,n,i){const r=this.toSeconds(n);if(this.triggerAttack(e,r,i),an(s)){me(an(e),"If the duration is an array, the notes must also be an array"),e=e;for(let a=0;a<e.length;a++){const l=s[Math.min(a,s.length-1)],c=this.toSeconds(l);me(c>0,"The duration must be greater than 0"),this.triggerRelease(e[a],r+c)}}else{const a=this.toSeconds(s);me(a>0,"The duration must be greater than 0"),this.triggerRelease(e,r+a)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1),this.context.transport.on("stop",this._syncedRelease),this.context.transport.on("pause",this._syncedRelease),this.context.transport.on("loopEnd",this._syncedRelease)),this}set(e){const s=Zs(e,["onsilence","context"]);return this.options=to(this.options,s),this._voices.forEach(n=>n.set(s)),this._dummyVoice.set(s),this}get(){return this._dummyVoice.get()}releaseAll(e){const s=this.toSeconds(e);return this._activeVoices.forEach(({voice:n})=>{n.triggerRelease(s)}),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach(e=>e.dispose()),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class Jp extends hi{constructor(){const e=ue(Jp.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");super(e),this.name="Sampler",this._activeSources=new Map;const s={};Object.keys(e.urls).forEach(n=>{const i=parseInt(n,10);if(me(Mh(n)||tr(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),Mh(n)){const r=new en(this.context,n).toMidi();s[r]=e.urls[n]}else tr(i)&&isFinite(i)&&(s[i]=e.urls[i])}),this._buffers=new c_({urls:s,onload:e.onload,baseUrl:e.baseUrl,onerror:e.onerror}),this.attack=e.attack,this.release=e.release,this.curve=e.curve,this._buffers.loaded&&Promise.resolve().then(e.onload)}static getDefaults(){return Object.assign(hi.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Qe,onerror:Qe,release:.1,urls:{}})}_findClosest(e){let n=0;for(;n<96;){if(this._buffers.has(e+n))return-n;if(this._buffers.has(e-n))return n;n++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,s,n=1){return this.log("triggerAttack",e,s,n),Array.isArray(e)||(e=[e]),e.forEach(i=>{const r=ZC(new en(this.context,i).toFrequency()),a=Math.round(r),l=r-a,c=this._findClosest(a),u=a-c,d=this._buffers.get(u),h=JC(c+l),f=new th({url:d,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:h}).connect(this.output);f.start(s,0,d.duration/h,n),an(this._activeSources.get(a))||this._activeSources.set(a,[]),this._activeSources.get(a).push(f),f.onended=()=>{if(this._activeSources&&this._activeSources.has(a)){const m=this._activeSources.get(a),b=m.indexOf(f);b!==-1&&m.splice(b,1)}}}),this}triggerRelease(e,s){return this.log("triggerRelease",e,s),Array.isArray(e)||(e=[e]),e.forEach(n=>{const i=new en(this.context,n).toMidi();if(this._activeSources.has(i)&&this._activeSources.get(i).length){const r=this._activeSources.get(i);s=this.toSeconds(s),r.forEach(a=>{a.stop(s)}),this._activeSources.set(i,[])}}),this}releaseAll(e){const s=this.toSeconds(e);return this._activeSources.forEach(n=>{for(;n.length;)n.shift().stop(s)}),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,s,n,i=1){const r=this.toSeconds(n);return this.triggerAttack(e,r,i),an(s)?(me(an(e),"notes must be an array when duration is array"),e.forEach((a,l)=>{const c=s[Math.min(l,s.length-1)];this.triggerRelease(a,r+this.toSeconds(c))})):this.triggerRelease(e,r+this.toSeconds(s)),this}add(e,s,n){if(me(Mh(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Mh(e)){const i=new en(this.context,e).toMidi();this._buffers.add(i,s,n)}else this._buffers.add(e,s,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach(e=>{e.forEach(s=>s.dispose())}),this._activeSources.clear(),this}}Jn([fr(0)],Jp.prototype,"attack",void 0);Jn([fr(0)],Jp.prototype,"release",void 0);class x_ extends de{constructor(){const e=ue(x_.getDefaults(),arguments,["fade"]);super(e),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Mz({context:this.context}),this.a=new Ke({context:this.context,gain:0}),this.b=new Ke({context:this.context,gain:0}),this.output=new Ke({context:this.context}),this._internalChannels=[this.a,this.b],this.fade=new ze({context:this.context,units:"normalRange",value:e.fade}),He(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",nr(this._split,this.a.gain,0),nr(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(de.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Mm extends de{constructor(e){super(e),this.name="Effect",this._dryWet=new x_({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Ke({context:this.context}),this.effectReturn=new Ke({context:this.context}),this.input=new Ke({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(e.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],He(this,"wet")}static getDefaults(){return Object.assign(de.getDefaults(),{wet:1})}connectEffect(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class LN extends Mm{constructor(e){super(e),this.name="LFOEffect",this._lfo=new Tl({context:this.context,frequency:e.frequency,amplitude:e.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=e.type,He(this,["frequency","depth"])}static getDefaults(){return Object.assign(Mm.getDefaults(),{frequency:1,type:"sine",depth:1})}start(e){return this._lfo.start(e),this}stop(e){return this._lfo.stop(e),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(e){this._lfo.type=e}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class b_ extends LN{constructor(){const e=ue(b_.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);super(e),this.name="AutoFilter",this.filter=new Pi(Object.assign(e.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=e.octaves,this.baseFrequency=e.baseFrequency}static getDefaults(){return Object.assign(LN.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}dispose(){return super.dispose(),this.filter.dispose(),this}}class v_ extends de{constructor(){const e=ue(v_.getDefaults(),arguments,["pan"]);super(e),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner,this.pan=new Re({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",He(this,"pan")}static getDefaults(){return Object.assign(de.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}const Fz="bit-crusher",Uz=`
	class BitCrusherWorklet extends SingleIOProcessor {

		static get parameterDescriptors() {
			return [{
				name: "bits",
				defaultValue: 12,
				minValue: 1,
				maxValue: 16,
				automationRate: 'k-rate'
			}];
		}

		generate(input, _channel, parameters) {
			const step = Math.pow(0.5, parameters.bits - 1);
			const val = step * Math.floor(input / step + 0.5);
			return val;
		}
	}
`;cR(Fz,Uz);class y_ extends de{constructor(){const e=ue(y_.getDefaults(),arguments,["channels"]);super(e),this.name="Merge",this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(de.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class __ extends Mm{constructor(){const e=ue(__.getDefaults(),arguments,["decay"]);super(e),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const s=this.toSeconds(e.decay);Js(s,.001),this._decay=s;const n=this.toSeconds(e.preDelay);Js(n,0),this._preDelay=n,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Mm.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(e){e=this.toSeconds(e),Js(e,.001),this._decay=e,this.generate()}get preDelay(){return this._preDelay}set preDelay(e){e=this.toSeconds(e),Js(e,0),this._preDelay=e,this.generate()}generate(){return Lt(this,void 0,void 0,function*(){const e=this.ready,s=new $p(2,this._decay+this._preDelay,this.context.sampleRate),n=new fa({context:s}),i=new fa({context:s}),r=new y_({context:s});n.connect(r,0,0),i.connect(r,0,1);const a=new Ke({context:s}).toDestination();r.connect(a),n.start(0),i.start(0),a.gain.setValueAtTime(0,0),a.gain.setValueAtTime(1,this._preDelay),a.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const l=s.render();return this.ready=l.then(Qe),yield e,this._convolver.buffer=(yield l).get(),this})}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Bt extends de{constructor(){const e=ue(Bt.getDefaults(),arguments,["solo"]);super(e),this.name="Solo",this.input=this.output=new Ke({context:this.context}),Bt._allSolos.has(this.context)||Bt._allSolos.set(this.context,new Set),Bt._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(de.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),Bt._allSolos.get(this.context).forEach(s=>s._updateSolo())}get muted(){return this.input.gain.value===0}_addSolo(){Bt._soloed.has(this.context)||Bt._soloed.set(this.context,new Set),Bt._soloed.get(this.context).add(this)}_removeSolo(){Bt._soloed.has(this.context)&&Bt._soloed.get(this.context).delete(this)}_isSoloed(){return Bt._soloed.has(this.context)&&Bt._soloed.get(this.context).has(this)}_noSolos(){return!Bt._soloed.has(this.context)||Bt._soloed.has(this.context)&&Bt._soloed.get(this.context).size===0}_updateSolo(){this._isSoloed()?this.input.gain.value=1:this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Bt._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Bt._allSolos=new Map;Bt._soloed=new Map;class w_ extends de{constructor(){const e=ue(w_.getDefaults(),arguments,["pan","volume"]);super(e),this.name="PanVol",this._panner=this.input=new v_({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Gi({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,He(this,["pan","volume"])}static getDefaults(){return Object.assign(de.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class al extends de{constructor(){const e=ue(al.getDefaults(),arguments,["volume","pan"]);super(e),this.name="Channel",this._solo=this.input=new Bt({solo:e.solo,context:this.context}),this._panVol=this.output=new w_({context:this.context,pan:e.pan,volume:e.volume,mute:e.mute,channelCount:e.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),He(this,["pan","volume"])}static getDefaults(){return Object.assign(de.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(e){return al.buses.has(e)||al.buses.set(e,new Ke({context:this.context})),al.buses.get(e)}send(e,s=0){const n=this._getBus(e),i=new Ke({context:this.context,units:"decibels",gain:s});return this.connect(i),i.connect(n),i}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}al.buses=new Map;class k_ extends de{constructor(){const e=ue(k_.getDefaults(),arguments,["threshold","ratio"]);super(e),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor,this.threshold=new Re({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:e.threshold}),this.attack=new Re({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:e.attack}),this.release=new Re({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:e.release}),this.knee=new Re({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:e.knee}),this.ratio=new Re({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:e.ratio}),He(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(de.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class N_ extends de{constructor(){const e=ue(N_.getDefaults(),arguments,["threshold"]);super(e),this.name="Limiter",this._compressor=this.input=this.output=new k_({context:this.context,ratio:20,attack:.003,release:.01,threshold:e.threshold}),this.threshold=this._compressor.threshold,He(this,"threshold")}static getDefaults(){return Object.assign(de.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}Fn().transport;const PN=Fn().destination;Fn().destination;Fn().listener;Fn().draw;const VN=Fn(),uR=[{id:"Ashes of the Keep.mp3",title:"Festningens Aske",mood:"Dark"},{id:"Banner at the Old Stone Keep.mp3",title:"Gamle Steiner",mood:"Epic"},{id:"Banner at the Old Stone Keep (1).mp3",title:"Steinhallens Hymne",mood:"Epic"},{id:"Burning Banners Over Stone.mp3",title:"Brennende Bannere",mood:"Dark"},{id:"Candlelit Keep.mp3",title:"Lys i Hallen",mood:"Calm"},{id:"Candlelit Keep (1).mp3",title:"Nattens Vakt",mood:"Calm"},{id:"Crown of Quiet Rooms.mp3",title:"Stillhetens Krone",mood:"Mysterious"},{id:"Crown of Quiet Rooms (1).mp3",title:"Kongens Tvil",mood:"Mysterious"}],Ua=class Ua{constructor(){Ie(this,"clickSynth",null);Ie(this,"hoverSynth",null);Ie(this,"successSynth",null);Ie(this,"errorSynth",null);Ie(this,"crunchSynth",null);Ie(this,"jumpSynth",null);Ie(this,"reverb",null);Ie(this,"windNodes",null);Ie(this,"seaNodes",null);Ie(this,"limiter",null);Ie(this,"masterGain",null);Ie(this,"isInitialized",!1)}static getInstance(){return Ua.instance||(Ua.instance=new Ua),Ua.instance}async init(){if(this.isInitialized)return;this.limiter=new N_(-2).toDestination(),this.masterGain=new Ke(1).connect(this.limiter),this.reverb=new __({decay:2.5,preDelay:.1,wet:.3}).connect(this.masterGain),await this.reverb.generate(),this.clickSynth=new ih({pitchDecay:.008,octaves:2,oscillator:{type:"sine"},envelope:{attack:.001,decay:.2,sustain:0,release:.1}}).connect(this.masterGain),this.hoverSynth=new Im({noise:{type:"pink"},envelope:{attack:.005,decay:.02,sustain:0}});const e=new Pi(6e3,"highpass").connect(this.masterGain);this.hoverSynth.connect(e),this.hoverSynth.volume.value=-12,this.successSynth=new Om(p_,{harmonicity:3,modulationIndex:3.5,oscillator:{type:"square"},envelope:{attack:.1,decay:2,sustain:.1,release:2},modulation:{type:"sine"},modulationEnvelope:{attack:.5,decay:0,sustain:1,release:.5}}).connect(this.reverb),this.successSynth.volume.value=-6,this.errorSynth=new m_({oscillator:{type:"sawtooth"},filter:{Q:5,type:"lowpass",rolloff:-24},envelope:{attack:.01,decay:.2,sustain:.4,release:2},filterEnvelope:{attack:.01,decay:.2,sustain:.8,release:2,baseFrequency:200,octaves:4,exponent:2}}).connect(this.masterGain);const s=new Pi(800,"lowpass").connect(this.masterGain);this.crunchSynth=new Im({noise:{type:"brown"},envelope:{attack:.02,decay:.15,sustain:0}}).connect(s),this.crunchSynth.volume.value=-2,this.jumpSynth=new pa({oscillator:{type:"triangle"},envelope:{attack:.05,decay:.2,sustain:.1,release:1}}).connect(this.reverb),this.initAmbience(),this.isInitialized=!0,console.log(" Procedural Sound Engine Initialized (v2 - Reverb Active)")}initAmbience(){if(!this.masterGain)return;const e=new fa("pink").start(),s=new b_({frequency:.1,baseFrequency:200,octaves:2.6,depth:1,type:"sine"}).start(),n=new Gi(-20).connect(this.masterGain);e.connect(s),s.connect(n),this.windNodes={noise:e,filter:s,lfo:new Tl(.1,100,400).start(),vol:n},e.disconnect(),s.disconnect();const i=new Pi(400,"bandpass"),r=new Tl(.1,200,600).start();r.connect(i.frequency);const a=new Gi(-999).connect(this.masterGain);e.connect(i).connect(a),this.windNodes={noise:e,filter:i,lfo:r,vol:a};const l=new fa("brown").start(),c=new Pi(500,"lowpass"),u=new Tl(.05,300,900).start();u.connect(c.frequency);const d=new Gi(-999).connect(this.masterGain);l.connect(c).connect(d),this.seaNodes={noise:l,filter:c,lfo:u,vol:d}}playHumanized(e,s,n){if(!this.isInitialized)return;const i=.9+Math.random()*.2;if("detune"in e&&e.detune instanceof ze){const r=Math.random()*10-5;e.detune.value=r}e instanceof Om||s?e.triggerAttackRelease(s,n,void 0,i):e.triggerAttackRelease(n,void 0,i)}playClick(){this.isInitialized&&this.playHumanized(this.clickSynth,"C1","16n")}playHover(){this.isInitialized&&this.playHumanized(this.hoverSynth,void 0,"64n")}playSuccess(){if(!this.isInitialized)return;const e=["C4","E4","G4","B4","D5"];this.playHumanized(this.successSynth,e,"1m")}playError(){this.isInitialized&&this.playHumanized(this.errorSynth,"A1","8n")}playCrunch(){this.isInitialized&&this.playHumanized(this.crunchSynth,void 0,"16n")}playJump(){this.isInitialized&&(this.jumpSynth.triggerAttack("C2"),this.jumpSynth.frequency.rampTo("G2",.1),this.jumpSynth.triggerRelease("+0.2"))}playHeartbeat(){this.isInitialized&&this.playHumanized(this.clickSynth,"A0","8n")}playCoin(){this.isInitialized&&this.playHumanized(this.successSynth,["B5","E6"],"32n")}playConfirm(){this.isInitialized&&this.playHumanized(this.successSynth,["C4","G4"],"16n")}setAmbience(e){if(!this.isInitialized||!this.windNodes||!this.seaNodes)return;const s=2;e==="wind"?(this.windNodes.vol.volume.rampTo(-20,s),this.seaNodes.vol.volume.rampTo(-999,s)):e==="sea"?(this.windNodes.vol.volume.rampTo(-999,s),this.seaNodes.vol.volume.rampTo(-20,s)):(this.windNodes.vol.volume.rampTo(-999,s),this.seaNodes.vol.volume.rampTo(-999,s))}setVolume(e){this.masterGain&&this.masterGain.gain.rampTo(e,.1)}};Ie(Ua,"instance");let nb=Ua;const zs=nb.getInstance(),$a=class $a{constructor(){Ie(this,"sfxVolume",.5);Ie(this,"musicVolume",.3);Ie(this,"currentMusic",null);Ie(this,"currentMusicKey",null);Ie(this,"playlist",[]);Ie(this,"playlistIndex",0);Ie(this,"isPlaylistActive",!1);Ie(this,"ignoredTracks",new Set);Ie(this,"isMuffledState",!1);Ie(this,"activeFades",new Map);Ie(this,"audioContextResumed",!1);const e=localStorage.getItem("sim_sfx_volume"),s=localStorage.getItem("sim_music_volume"),n=localStorage.getItem("sim_music_muffled"),i=localStorage.getItem("sim_music_ignored");if(e&&(this.sfxVolume=parseFloat(e)),s&&(this.musicVolume=parseFloat(s)),n&&(this.isMuffledState=n==="true"),i)try{this.ignoredTracks=new Set(JSON.parse(i))}catch(r){console.error("Failed to parse ignored tracks",r)}this.playlist=uR.map(r=>r.id),this.shufflePlaylist(),typeof document<"u"&&document.addEventListener("visibilitychange",()=>{document.hidden?(PN.mute=!0,this.currentMusic&&(this.currentMusic.muted=!0)):(PN.mute=!1,this.currentMusic&&(this.currentMusic.muted=!1))})}shufflePlaylist(){this.playlist=this.playlist.sort(()=>Math.random()-.5)}static getInstance(){return $a.instance||($a.instance=new $a),$a.instance}async resume(){if(!(this.audioContextResumed&&VN.state==="running"))try{await wz(),await zs.init(),zs.setVolume(this.sfxVolume),this.audioContextResumed=!0,console.log(" Audio Engine Resumed")}catch(e){console.warn("Audio Resume Failed (Autoplay blocked?)",e)}}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("sim_sfx_volume",this.sfxVolume.toString()),this.audioContextResumed&&zs.setVolume(this.sfxVolume)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),localStorage.setItem("sim_music_volume",this.musicVolume.toString()),this.currentMusic&&(this.currentMusic.volume=this.musicVolume)}setMuffled(e){this.isMuffledState=e,localStorage.setItem("sim_music_muffled",e.toString())}playSfx(e){if(!this.audioContextResumed||VN.state!=="running")return;const s=e.toLowerCase();s.includes("click")?zs.playClick():s.includes("hover")||s.includes("toggle")?zs.playHover():s.includes("success")||s.includes("level")?zs.playSuccess():s.includes("error")||s.includes("fail")?zs.playError():s.includes("coin")||s.includes("cash")||s.includes("money")?zs.playCoin():s.includes("confirm")?zs.playConfirm():s.includes("eat")||s.includes("consume")?zs.playCrunch():s.includes("jump")?zs.playJump():s.includes("heartbeat")?zs.playHeartbeat():zs.playClick()}startPlaylist(){this.isPlaylistActive&&this.currentMusic||(this.isPlaylistActive=!0,this.currentMusic||this.playNextInPlaylist())}playNextInPlaylist(){if(!this.isPlaylistActive)return;let e=0;for(;e<this.playlist.length;){this.playlistIndex=(this.playlistIndex+1)%this.playlist.length;const s=this.playlist[this.playlistIndex];if(!this.ignoredTracks.has(s)){this.playMusic(s,2e3,!1);return}e++}this.playMusic(this.playlist[0],2e3,!1)}playPreviousInPlaylist(){if(!this.isPlaylistActive)return;let e=0;for(;e<this.playlist.length;){this.playlistIndex=(this.playlistIndex-1+this.playlist.length)%this.playlist.length;const s=this.playlist[this.playlistIndex];if(!this.ignoredTracks.has(s)){this.playMusic(s,2e3,!1);return}e++}this.playMusic(this.playlist[0],2e3,!1)}playMusic(e,s=1e3,n=!0){n&&(this.isPlaylistActive=!1);const a=`/Simulation_StandAlone_Pro//sounds/music/${e.includes(".")?e:`${e}.mp3`}`.replace("//","/"),l=new Audio(a);l.loop=!this.isPlaylistActive,l.volume=0,this.currentMusic&&this.fadeOut(this.currentMusic,s),this.currentMusic=l,this.currentMusicKey=e,l.play().then(()=>{this.fadeIn(l,this.musicVolume,s)}).catch(c=>{console.warn(`Failed to play music: ${e}`,c),this.isPlaylistActive&&setTimeout(()=>this.playNextInPlaylist(),2e3)}),this.isPlaylistActive&&(l.onended=()=>this.playNextInPlaylist())}stopMusic(e=1e3){this.isPlaylistActive=!1,this.currentMusic&&(this.fadeOut(this.currentMusic,e),this.currentMusic=null,this.currentMusicKey=null)}fadeOut(e,s){this.activeFades.has(e)&&(clearInterval(this.activeFades.get(e)),this.activeFades.delete(e));const n=e.volume,i=20,r=setInterval(()=>{e.volume>.01?e.volume=Math.max(0,e.volume-n/i):(e.pause(),clearInterval(r),this.activeFades.delete(e))},s/i);this.activeFades.set(e,r)}fadeIn(e,s,n){this.activeFades.has(e)&&(clearInterval(this.activeFades.get(e)),this.activeFades.delete(e));const i=20,r=setInterval(()=>{e.volume<s?e.volume=Math.min(s,e.volume+s/i):(clearInterval(r),this.activeFades.delete(e))},n/i);this.activeFades.set(e,r)}getSfxVolume(){return this.sfxVolume}getMusicVolume(){return this.musicVolume}isMuffled(){return this.isMuffledState}getCurrentTrackId(){return this.currentMusicKey}toggleIgnoreTrack(e){this.ignoredTracks.has(e)?this.ignoredTracks.delete(e):this.ignoredTracks.add(e),localStorage.setItem("sim_music_ignored",JSON.stringify(Array.from(this.ignoredTracks)))}isIgnored(e){return this.ignoredTracks.has(e)}};Ie($a,"instance");let ib=$a;const jt=ib.getInstance(),El=Object.freeze(Object.defineProperty({__proto__:null,audioManager:jt},Symbol.toStringTag,{value:"Module"})),dR=N.createContext(void 0),$z=({children:t})=>{const[e,s]=N.useState(jt.getSfxVolume()),[n,i]=N.useState(jt.getMusicVolume()),[r,a]=N.useState(jt.isMuffled()),[l,c]=N.useState(jt.getCurrentTrackId()),[u,d]=N.useState(0);N.useEffect(()=>{const _=setInterval(()=>{const T=jt.getCurrentTrackId();T!==l&&c(T)},1e3);return()=>clearInterval(_)},[l]);const h=N.useCallback(_=>{jt.setSfxVolume(_),s(_)},[]),f=N.useCallback(_=>{jt.setMusicVolume(_),i(_)},[]),m=N.useCallback(_=>{jt.setMuffled(_),a(_)},[]),b=N.useCallback(_=>{jt.playSfx(_)},[]),x=N.useCallback(_=>{jt.playMusic(_),c(_)},[]),v=N.useCallback(()=>{jt.stopMusic(),c(null)},[]),g=N.useCallback(()=>{jt.startPlaylist(),c(jt.getCurrentTrackId())},[]),p=N.useCallback(()=>{jt.playNextInPlaylist(),c(jt.getCurrentTrackId())},[]),y=N.useCallback(()=>{jt.playPreviousInPlaylist(),c(jt.getCurrentTrackId())},[]),k=N.useCallback(_=>{jt.toggleIgnoreTrack(_),d(T=>T+1)},[]),w=N.useCallback(_=>jt.isIgnored(_),[u]),S=N.useCallback(()=>{jt.resume()},[]);return o.jsx(dR.Provider,{value:{playSfx:b,playMusic:x,startPlaylist:g,stopMusic:v,playNext:p,playPrevious:y,toggleIgnoreTrack:k,isIgnored:w,currentTrackId:l,playlist:uR,sfxVolume:e,setSfxVolume:h,musicVolume:n,setMusicVolume:f,isMuffled:r,setMuffled:m,resume:S},children:t})},S_=()=>{const t=N.useContext(dR);if(!t)throw new Error("useAudio must be used within a SimulationAudioProvider");return t},hR=N.createContext(void 0),Hz=({children:t})=>{const{pin:e,tab:s}=DA(),n=M=>{if(!M)return"MAP";const D=M.toUpperCase();return D==="ACTIVITY"||D==="LOG"?"ACTIVITY":D},i=M=>M.toLowerCase(),[r,a]=N.useState(()=>n(s)),[l,c]=N.useState("global"),[u,d]=N.useState(null),[h,f]=N.useState(!1),[m,b]=N.useState(!1),[x,v]=N.useState(null),[g,p]=N.useState(null),[y,k]=N.useState(null),[w,S]=N.useState(null),[_,T]=N.useState(null),[E,A]=N.useState([]),[j,O]=N.useState(null),H=M=>{A(D=>[...D,M])};Se.useEffect(()=>{if(E.length>0&&!j){const M=E[0];O(M),A(D=>D.slice(1)),setTimeout(()=>{O(null)},6e3)}},[E,j]);const G=M=>{a(M);const D=i(M),I=`/Simulation_StandAlone_Pro/play/${e}/${D}`;window.history.replaceState({...window.history.state,idx:window.history.length},"",I)},L=M=>{f(M),M?G("MARKET"):r==="MARKET"&&G("MAP")};return o.jsx(hR.Provider,{value:{activeTab:r,setActiveTab:G,viewMode:l,setViewMode:c,viewingRegionId:u,setViewingRegionId:d,isMarketOpen:h,setMarketOpen:L,isMusicWindowOpen:m,setMusicWindowOpen:b,activeMinigame:x,setActiveMinigame:v,activeMinigameMethod:g,setActiveMinigameMethod:p,activeMinigameAction:y,setActiveMinigameAction:k,actionLoading:w,setActionLoading:S,productionContext:_,setProductionContext:T,showAchievement:H,currentAchievement:j},children:t})},yo=()=>{const t=N.useContext(hR);if(!t)throw new Error("useSimulation must be used within a SimulationProvider");return t},Gz="modulepreload",zz=function(t){return"/Simulation_StandAlone_Pro/"+t},BN={},Tt=function(e,s,n){let i=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(s.map(c=>{if(c=zz(c),c in BN)return;BN[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":Gz,u||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),u)return new Promise((f,m)=>{h.addEventListener("load",f),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return i.then(a=>{for(const l of a||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},re={MARKET:{SELL_RATIO:.8,PRICE_IMPACT_BUY:.005,PRICE_IMPACT_SELL:.005,MIN_PRICE_MULTIPLIER:.2,MAX_PRICE_MULTIPLIER:5,VISCOSITY:100},CONTRIBUTION_VALUES:{gold:1,wood:.5,stone:1,iron_ore:1,iron_ingot:5,plank:2,grain:.1,flour:.5,bread:1,meat:1,honey:1,cloth:1,wool:.5,flax:.2,linen_canvas:3,tar:2,fish_raw:.5,silk:5,spice:10,default:.1},CAREERS:{SOLDIER:{COST:200,LEVEL_REQ:3},MERCHANT:{COST:500,LEVEL_REQ:3}},TAX:{PEASANT_RATE_DEFAULT:.15,PEASANT_RATE_CUT:.07,ROYAL_RATE:.2,LOYALTY_PENALTY_PEASANT:10,LOYALTY_PENALTY_BARON:5},GATHERING:{NO_TOOL_PENALTY:.75},YIELD:{WORK_GRAIN:10,CHOP_WOOD:6,MINE_ORE:5,QUARRY_STONE:8,FORAGE_BREAD:1,PLOW_BONUS:4,SUMMER_WOOD_BONUS:2},DURABILITY:{MAX:100,LOSS_WORK:5,LOSS_COMBAT_WEAPON:10,LOSS_COMBAT_ARMOR:15,REPAIR_AMOUNT:30},MINIGAME:{BASE_MULTIPLIER:.5,PERFORMANCE_WEIGHT:1,CRAFTING_WEIGHT:1.5,THRESHOLD_GREAT:.8},RELIGION:{PRAY_MIN:1,PRAY_MAX:5,XP_PRAY:2},COMBAT:{RAID_LOOT_FACTOR:.4,DEFEND_GOLD_BASE:20,XP_WIN:20,XP_LOSS:0},LUCKY_DROP:{CHANCE:.05,MULTIPLIER:2},PASSIVE_INCOME:{COW:2,ACCOUNTING_BOOKS:5,CARAVAN:10},SKILLS:{GATHERING_BONUS:.1,REFINING_BONUS:.1,CRAFTING_XP:25,REFINING_XP:10},COUP:{BASE_BRIBE_COST:500,HONEYMOON_DURATION:6e5,VACANCY_DURATION:3e5,RESTORE_ORDER_COST:600,LEGITIMACY_SHIELD_MULT:2,KING_VOTE_WEIGHT:15,PEASANT_VOTE_WEIGHT:1},CARAVAN:{LEVELS:[{level:1,name:"Hndkjre",capacity:5,speed:1,cost:0,durability:100},{level:2,name:"Enkel vogn",capacity:15,speed:1.2,cost:300,durability:150},{level:3,name:"Overbygd kjerre",capacity:40,speed:1.5,cost:800,durability:200},{level:4,name:"Jernkledd konvoi",capacity:100,speed:1.8,cost:2e3,durability:300},{level:5,name:"Storkjpmannens vogn",capacity:250,speed:2.2,cost:5e3,durability:500}],UPGRADES:{SILK_CHESTS:{id:"silk_chests",name:"Silkeforede kister",cost:150,benefit:"Beskytter luksusvarer"},HEAVY_AXLES:{id:"heavy_axles",name:"Forsterkede akslinger",cost:250,benefit:"+10% fart med full last"},GUARD_POST:{id:"guard_post",name:"Vaktpost",cost:400,benefit:"Reduserer bandittfare"}}}},rh={WORK:{xp:5},CHOP:{xp:5},FORAGE:{xp:2}},Dm=[0,100,300,700,1500,3e3,6e3],Nn={Spring:{label:"Vr",yieldMod:1,staminaMod:1,color:"#4ade80"},Summer:{label:"Sommer",yieldMod:1.2,staminaMod:1,color:"#fbbf24"},Autumn:{label:"Hst",yieldMod:1.5,staminaMod:1,color:"#f97316"},Winter:{label:"Vinter",yieldMod:.2,staminaMod:1.5,color:"#38bdf8"}},Vi={Clear:{label:"Klart Vr",desc:"Ideelle forhold for alt arbeid.",mod:1,icon:"",speedMod:1,staminaMod:1},Rain:{label:"Regn",desc:"Glatte forhold. Minispill gr litt fortere.",mod:.9,icon:"",speedMod:1.2,staminaMod:1},Storm:{label:"Storm",desc:"Farlig vr. Hy stamina-kostnad og lavt utbytte!",mod:.5,icon:"",speedMod:1.5,staminaMod:2},Fog:{label:"Tke",desc:"Drlig sikt. Vanskeligere  treffe blinker.",mod:.8,icon:"",speedMod:.8,staminaMod:1}},Ec={WORK:{bread:1,stamina:10},CHOP:{bread:1,stamina:15},FORAGE:{stamina:40},MINE:{bread:1,stamina:25},RAID:{bread:3,stamina:40},TAX:{stamina:20},TAX_PEASANTS:{stamina:25},TAX_ROYAL:{stamina:30},MILL:{grain:10},SMELT:{iron_ore:5,wood:2},SAWMILL:{wood:5},BAKERY:{flour:5},REFINE:{},CRAFT:{},QUARRY:{bread:1,stamina:20},REPAIR:{stamina:15},HUNT:{stamina:30},GATHER_WOOL:{stamina:15},GATHER_HONEY:{stamina:20},PRAY:{stamina:15},FEAST:{bread:30,gold:100,stamina:10},CONTRIBUTE:{stamina:10},CONSTRUCT:{stamina:20},SLEEP:{stamina:0},EAT:{bread:1,stamina:0},PLANT:{grain:5,stamina:25},HARVEST:{stamina:15},BAKE:{},WEAVE:{},MIX:{},DEFEND:{stamina:30},EXPLORE:{stamina:25},PATROL:{stamina:10},MAINTAIN_CROP:{stamina:5},MOUNT_HORSE:{stamina:5},BUY_HORSE_COSMETIC:{stamina:0},SELECT_HORSE_COSMETIC:{stamina:0},LOAD_CARAVAN:{stamina:5},UNLOAD_CARAVAN:{stamina:5},UPGRADE_CARAVAN:{stamina:0},TRAVEL_START:{stamina:20,bread:1}},rb={great_forge:{material:"iron_ingot",goldCost:20,staminaCost:15,slots:["MAIN_HAND","OFF_HAND","HEAD","BODY","FEET","AXE","PICKAXE","SCYTHE","HAMMER","BOW","TRAP","CHISEL"]},weavery:{material:"cloth",goldCost:10,staminaCost:10,slots:["BODY","FEET","HEAD"]},sawmill:{material:"plank",goldCost:5,staminaCost:10,slots:["OFF_HAND","MAIN_HAND"]}},Jl={GOLD:"",GRAIN:"",WOOD:"",IRON_ORE:"",STONE:"",PLANK:"",IRON_INGOT:"",BREAD:"",SWORDS:"",ARMOR:"",CLOTH:"",WOOL:"",MEAT:"",HONEY:"",GLASS:"",FLOUR:"",EGG:"",OMELETTE:"",MANPOWER:"",FAVOR:"",FLAX:"",LINEN_CANVAS:"",TAR:"",FISH_RAW:"",SILK:"",SPICE:""},Ge={gold:{label:"Gull",icon:""},grain:{label:"Korn",icon:"",isCommodity:!0},flour:{label:"Mel",icon:"",isCommodity:!0},bread:{label:"Brd",icon:""},wood:{label:"Ved",icon:"",isCommodity:!0},plank:{label:"Planker",icon:"",isCommodity:!0},iron_ore:{label:"Jernmalm",icon:"",isCommodity:!0},iron_ingot:{label:"Jernbarre",icon:"",isCommodity:!0},stone:{label:"Stein",icon:"",isCommodity:!0},siege_sword:{label:"Beleiringsvpen",icon:""},siege_armor:{label:"Beleiringsrustning",icon:""},favor:{label:"Gunst",icon:""},honey:{label:"Honning",icon:"",isCommodity:!0},meat:{label:"Kjtt",icon:"",isCommodity:!0},wool:{label:"Ull",icon:"",isCommodity:!0},cloth:{label:"Stoff",icon:"",isCommodity:!0},glass:{label:"Glass",icon:"",isCommodity:!0},egg:{label:"Egg",icon:"",isCommodity:!0},omelette:{label:"Omelett",icon:""},minor_stamina_potion:{label:"Liten Stamina-brygg",icon:""},herbal_balm:{label:"Urtebalsam",icon:""},focus_brew:{label:"Fokus-brygg",icon:""},strength_tincture:{label:"Styrke-tinktur",icon:""},masters_draught:{label:"Mester-drikk",icon:""},elixir_of_life:{label:"Livseliksir",icon:""},flax:{label:"Lin",icon:"",isCommodity:!0},linen_canvas:{label:"Seilduk",icon:"",isCommodity:!0},tar:{label:"Tjre",icon:"",isCommodity:!0},fish_raw:{label:"R fisk",icon:"",isCommodity:!0},fish_cooked:{label:"Stekt fisk",icon:""},silk:{label:"Silke",icon:"",isCommodity:!0},spice:{label:"Krydder",icon:"",isCommodity:!0},cannonball:{label:"Kanonkuler",icon:"",isCommodity:!0}},ms={KING:{gold:1e3,grain:500,flour:200,bread:50,wood:200,plank:50,iron_ore:0,iron_ingot:20,stone:100,siege_sword:50,siege_armor:20,favor:0,wool:50,cloth:20,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:20,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},BARON:{gold:300,grain:100,flour:50,bread:20,wood:50,plank:20,iron_ore:0,iron_ingot:10,stone:20,siege_sword:10,siege_armor:10,favor:0,wool:20,cloth:5,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:10,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},PEASANT:{gold:20,grain:30,flour:5,bread:10,wood:0,plank:0,iron_ore:0,iron_ingot:0,stone:0,siege_sword:0,siege_armor:0,favor:0,wool:10,cloth:0,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:0,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},SOLDIER:{gold:50,grain:10,flour:10,bread:10,wood:0,plank:0,iron_ore:0,iron_ingot:0,stone:0,siege_sword:5,siege_armor:2,favor:0,wool:0,cloth:0,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:10,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0},MERCHANT:{gold:500,grain:50,flour:50,bread:20,wood:50,plank:20,iron_ore:0,iron_ingot:5,stone:50,siege_sword:5,siege_armor:2,favor:0,wool:20,cloth:10,honey:0,meat:0,glass:0,manpower:0,egg:0,omelette:0,flax:0,linen_canvas:0,tar:0,fish_raw:0,fish_cooked:0,silk:0,spice:0,cannonball:5,minor_stamina_potion:0,herbal_balm:0,focus_brew:0,strength_tincture:0,masters_draught:0,elixir_of_life:0}},T_={PEASANT:[{id:"iron_plow",name:"Jernplog",description:"ker kornhst med +5.",cost:{gold:50,wood:10},benefit:"YIELD_GRAIN"},{id:"fence",name:"Solid Gjerde",description:"Beskytter mot smtyveri.",cost:{wood:50},benefit:"DEFENSE_REGION"},{id:"cow",name:"Melkeku",description:"Gir passivt 2 gull per minutt (simulert via actions).",cost:{gold:80},benefit:"PASSIVE_GOLD"},{id:"roof",name:"Tett Tak",description:"Bedre hvile. Mer utholdenhet.",cost:{wood:20,gold:10},benefit:"STAMINA_REGEN"}],BARON:[{id:"stone_keep",name:"Steintrn",description:"Gjr raiding av deg mye vanskeligere.",cost:{gold:200,wood:100},benefit:"FORTRESS"},{id:"armory",name:"Vpenkammer",description:"Dobbelt s effektiv rekruttering.",cost:{gold:150},benefit:"DRAFT_BONUS"},{id:"stables",name:"Staller",description:"Raskere raids.",cost:{gold:100,wood:50},benefit:"RAID_SPEED"}],KING:[{id:"cathedral",name:"Katedral",description:"ker din legitimitet og skattevilje.",cost:{gold:500,stone:200},benefit:"ROYAL_AUTHORITY"},{id:"royal_guard",name:"Kongelig Garde",description:"Uovervinnelig defensiv styrke.",cost:{gold:400,iron:100},benefit:"ELITE_DEFENSE"}],SOLDIER:[{id:"knight_armor",name:"Ridderrustning",description:"Du tar mindre skade og ser tffere ut.",cost:{gold:100,swords:5},benefit:"ARMOR"},{id:"warhorse",name:"Stridshest",description:"Gjr deg til en Ridder. 2x XP fra kamp.",cost:{gold:200,grain:100},benefit:"KNIGHT"}],MERCHANT:[{id:"trade_license",name:"Handelsbrev",description:"Bedre salgspriser p markedet.",cost:{gold:150},benefit:"MARKET_BONUS"},{id:"accounting_books",name:"Regnskapsbker",description:"Gir passivt 5 gull per minutt.",cost:{gold:200,wood:20},benefit:"PASSIVE_GOLD_HIGH"},{id:"caravan",name:"Karavane",description:"Tjen penger p handel med utlandet.",cost:{gold:300,wood:50},benefit:"CARAVAN"}]},An={PEASANT:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:0,xp:0,maxXp:100},STEWARDSHIP:{level:0,xp:0,maxXp:100},COMBAT:{level:0,xp:0,maxXp:100},TRADING:{level:0,xp:0,maxXp:100},THEOLOGY:{level:0,xp:0,maxXp:100}},BARON:{FARMING:{level:3,xp:0,maxXp:300},WOODCUTTING:{level:3,xp:0,maxXp:300},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:5,xp:0,maxXp:1e3},COMBAT:{level:3,xp:0,maxXp:300},TRADING:{level:3,xp:0,maxXp:300},THEOLOGY:{level:1,xp:0,maxXp:100}},KING:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:10,xp:0,maxXp:5e3},COMBAT:{level:5,xp:0,maxXp:1500},TRADING:{level:5,xp:0,maxXp:1500},THEOLOGY:{level:5,xp:0,maxXp:1500}},SOLDIER:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:0,xp:0,maxXp:100},COMBAT:{level:5,xp:0,maxXp:1500},TRADING:{level:0,xp:0,maxXp:100},THEOLOGY:{level:0,xp:0,maxXp:100}},MERCHANT:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:0,xp:0,maxXp:100},CRAFTING:{level:2,xp:0,maxXp:200},STEWARDSHIP:{level:1,xp:0,maxXp:100},COMBAT:{level:0,xp:0,maxXp:100},TRADING:{level:5,xp:0,maxXp:1500},THEOLOGY:{level:0,xp:0,maxXp:100}}},qz={FARMING:{label:"Jordbruk",description:"Dyrking av mark, hsting av avlinger og husdyrhold.",color:"#10b981",bonuses:{2:"10% raskere hsting.",5:"Avlinger gir 20% mer utbytte.",10:"Mesterbonde: Lser opp avanserte avlinger."}},WOODCUTTING:{label:"Vedhogging",description:"Kunsten  felle trr og bearbeide tmmer.",color:"#8b5cf6",bonuses:{3:"15% raskere tmmerhogst.",7:"Sjanse for  finne sjelden kvae.",12:"Skovens vokter: kt utbytte fra alle trr."}},MINING:{label:"Gruvedrift",description:"Uthenting av malm og edle metaller fra fjellet.",color:"#f59e0b",bonuses:{4:"Bedre verktyeffektivitet i gruver.",8:"Lser opp utvinning av edelstener.",15:"Fjellkonge: Maksimalt utbytte fra dype rer."}},CRAFTING:{label:"Hndverk",description:"Smiing, snekring og tilvirking av avansert utstyr.",color:"#3b82f6",bonuses:{2:"Mindre materialsvinn ved refining.",5:"Bedre sjanse for hyere kvalitet.",10:"Stormester: Kan smie legendarisk utstyr."}},STEWARDSHIP:{label:"Godsforvaltning",description:"Administrasjon av land, folk og ressurser.",color:"#ec4899",bonuses:{5:"Redusert skattetrykk fra overordnede.",10:"kt passiv inntekt fra oppgraderinger.",20:"Rikets forvalter: Maksimal konomisk innsikt."}},COMBAT:{label:"Kamp",description:"Ferdighet i sverd, bue og forsvar av riket.",color:"#ef4444",bonuses:{3:"kt angrepskraft (+10%).",6:"Bedre forsvarsevne i beleiringer.",12:"Krigsherre: Fryktinngytende p slagmarken."}},TRADING:{label:"Handel",description:"Kjp, salg og markedsspekulering.",color:"#facc15",bonuses:{2:"Lavere gebyrer p markedet.",5:"Bedre priser ved handel med NPCs.",10:"Handelsfyrste: Kontroll over handelsruter."}},THEOLOGY:{label:"Teologi",description:"Tro, bnn og forstelse av det guddommelige.",color:"#6366f1",bonuses:{5:"Bnner gir mer stamina.",10:"Guddommelig beskyttelse mot ulykker.",15:"Helgen: Utstrler en aura av ro og verdighet."}}},ab={PEASANT:{},BARON:{MAIN_HAND:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:5,stats:{attack:10}},BODY:{id:"fine_clothes",name:"Fie Klr",icon:"",type:"BODY",durability:50,maxDurability:50,level:5,stats:{defense:2,speedBonus:1.1}}},KING:{MAIN_HAND:{id:"royal_scepter",name:"Kongens Septer",icon:"",type:"MAIN_HAND",durability:200,maxDurability:200,level:10,stats:{luckBonus:.2}},HEAD:{id:"crown",name:"Krone",icon:"",type:"HEAD",durability:100,maxDurability:100,level:10,stats:{luckBonus:.1}}},SOLDIER:{MAIN_HAND:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:3,stats:{attack:8}},OFF_HAND:{id:"wooden_shield",name:"Treskjold",icon:"",type:"OFF_HAND",durability:50,maxDurability:50,level:2,stats:{defense:5}},BODY:{id:"leather_armor",name:"Lrrustning",icon:"",type:"BODY",durability:80,maxDurability:80,level:2,stats:{defense:5}}},MERCHANT:{MAIN_HAND:{id:"walking_stick",name:"Vandrestav",icon:"",type:"MAIN_HAND",durability:50,maxDurability:50,level:2,stats:{speedBonus:1.05}},TRINKET:{id:"abacus",name:"Kuleramme",icon:"",type:"TRINKET",durability:100,maxDurability:100,level:3,stats:{yieldBonus:2}}}},qe={tools:{id:"tools",name:"Verkty",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:1,description:"Grunnleggende verkty."},weapon:{id:"weapon",name:"Enkelt Sverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:1,description:"Et enkelt sverd."},armor:{id:"armor",name:"Enkel Rustning",icon:"",type:"BODY",durability:100,maxDurability:100,level:1,description:"Beskyttende rustning."},stone_axe:{id:"stone_axe",name:"Steinks",icon:"",type:"AXE",durability:30,maxDurability:30,level:1,description:"Primitiv ks hugget fra mrke fjell. Sagnet sier at de frste fedrene brukte slike til  bane vei gjennom de tette skogene fr sivilisasjonens inntog. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["CHOP"],nextTierId:"iron_axe"},stone_pickaxe:{id:"stone_pickaxe",name:"Steinhakke",icon:"",type:"PICKAXE",durability:30,maxDurability:30,level:1,description:"En enkel hakke i flint og tre. Brukt i generasjoner av de som sker fjellets hemmeligheter. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["MINE"],nextTierId:"iron_pickaxe"},rusty_axe:{id:"rusty_axe",name:"Rusten ks",icon:"",type:"AXE",durability:50,maxDurability:50,level:1,description:"Et glemt relikvie fra en svunnen tid, n bare en skygge av sin fordums prakt. Slv og uplitelig.",stats:{yieldBonus:0},relevantActions:["CHOP"],nextTierId:"stone_axe"},iron_axe:{id:"iron_axe",name:"Jernks",icon:"",type:"AXE",durability:100,maxDurability:100,level:3,description:"Smid i landsbyens esse under fullmnen. Jernet synger nr det treffer treverket. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["CHOP"],nextTierId:"steel_axe"},iron_pickaxe:{id:"iron_pickaxe",name:"Jernhakke",icon:"",type:"PICKAXE",durability:100,maxDurability:100,level:3,description:"Tung og balansert. Laget for  trenge dypt inn i rikets rike rer. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["MINE"],nextTierId:"steel_pickaxe"},stone_chisel:{id:"stone_chisel",name:"Steinmeisel",icon:"",type:"CHISEL",durability:30,maxDurability:30,level:1,description:"En enkel meisel av herdet stein. Perfekt for  forme steinblokker. +1 Utbytte.",stats:{yieldBonus:1},relevantActions:["QUARRY"],nextTierId:"iron_chisel"},iron_chisel:{id:"iron_chisel",name:"Jernmeisel",icon:"",type:"CHISEL",durability:80,maxDurability:80,level:3,description:"Smid i landsbyens esse. Gjr steinhugging til en lek. +3 Utbytte.",stats:{yieldBonus:3},relevantActions:["QUARRY"],nextTierId:"steel_chisel"},royal_scepter:{id:"royal_scepter",name:"Kongens Septer",icon:"",type:"MAIN_HAND",durability:200,maxDurability:200,level:10,description:"Et symbol p guddommelig rett og folkets vilje. Det glitrer med en makt som kan bye selve skjebnen. +20% Flaks.",stats:{luckBonus:.2}},steel_axe:{id:"steel_axe",name:"Stlks",icon:"",type:"AXE",durability:200,maxDurability:200,level:8,description:"Mesterlig stl. +8 Utbytte, 20% raskere arbeid.",stats:{yieldBonus:8,speedBonus:1.2},relevantActions:["CHOP"]},steel_hja:{id:"steel_hja",name:"Stlhj",icon:"",type:"SCYTHE",durability:120,maxDurability:120,level:4,description:"Sylskarp hj. +5 Utbytte, 10% raskere hsting.",stats:{yieldBonus:5,speedBonus:1.1},relevantActions:["WORK","HST"]},stone_sickle:{id:"stone_sickle",name:"Steinsigd",icon:"",type:"SCYTHE",durability:40,maxDurability:40,level:1,description:"Enkel sigd for jordbruk. +1 Utbytte ved kornhsting.",stats:{yieldBonus:1},relevantActions:["WORK"]},blacksmith_hammer:{id:"blacksmith_hammer",name:"Smedhammer",icon:"",type:"HAMMER",durability:200,maxDurability:200,level:5,description:"Mesterverkty. 20% raskere smiing.",stats:{speedBonus:1.2},relevantActions:["CRAFT","REFINE","SMELT"]},shears:{id:"shears",name:"Saks",icon:"",type:"MAIN_HAND",durability:50,maxDurability:50,level:1,description:"Brukt til  klippe sauer. Helt ndvendig for ull-produksjon.",stats:{yieldBonus:2},relevantActions:["GATHER_WOOL"]},iron_sword:{id:"iron_sword",name:"Jernsverd",icon:"",type:"MAIN_HAND",durability:100,maxDurability:100,level:5,description:"Standard sverd. +10 Angrepskraft.",stats:{attack:10},relevantActions:["DEFEND","PATROL","EXPLORE","HUNT"],nextTierId:"steel_sword"},steel_sword:{id:"steel_sword",name:"Stlsverd",icon:"",type:"MAIN_HAND",durability:250,maxDurability:250,level:10,description:"Ddelig stl. +25 Angrep, 10% raskere hugg.",stats:{attack:25,speedBonus:1.1},relevantActions:["DEFEND","PATROL","EXPLORE","HUNT"]},tunic:{id:"tunic",name:"Slitt Tunika",icon:"",type:"BODY",durability:20,maxDurability:20,level:1,description:"Gammel og hullete. Minimal beskyttelse.",stats:{defense:1},relevantActions:["DEFEND","PATROL"],nextTierId:"leather_armor"},leather_armor:{id:"leather_armor",name:"Lrrustning",icon:"",type:"BODY",durability:80,maxDurability:80,level:3,description:"Herdet skinn. +5 Forsvar.",stats:{defense:5},relevantActions:["DEFEND","PATROL"],nextTierId:"iron_armor"},whetstone:{id:"whetstone",name:"Bryne",icon:"",type:"OFF_HAND",durability:100,maxDurability:100,level:1,description:"Bruk bryne for  holde verkty skarpe. Gir +1 i utbytte p de fleste sanke-oppgaver.",stats:{yieldBonus:1},relevantActions:["CHOP","MINE","QUARRY","WORK","GATHER_WOOL"]},hunting_bow:{id:"hunting_bow",name:"Jaktbue",icon:"",type:"BOW",durability:80,maxDurability:80,level:1,description:"En stdig bue av barlind. +2 Utbytte.",stats:{yieldBonus:2},relevantActions:["HUNT"],nextTierId:"longbow"},longbow:{id:"longbow",name:"Langbue",icon:"",type:"BOW",durability:150,maxDurability:150,level:5,description:"En mektig langbue som krever styrke  spenne. +5 Utbytte, 10% raskere.",stats:{yieldBonus:5,speedBonus:1.1},relevantActions:["HUNT"]},hunting_trap:{id:"hunting_trap",name:"Jaktfelle",icon:"",type:"TRAP",durability:30,maxDurability:30,level:1,description:"En enkel snarefangst-felle. +1 Utbytte ved smviltjakt.",stats:{yieldBonus:1},relevantActions:["HUNT","FORAGE"]},omelette:{id:"omelette",name:"Omelett",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:'En nringsrik frokost. Gir buff: "Lett til beins" (20% mindre stamina kostnad i 15 min).',stats:{},relevantActions:["CONSUME"]},bread:{id:"bread",name:"Brd",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"Ferskt brd fra bakeriet. Gjenoppretter +20 Stamina.",stats:{},relevantActions:["CONSUME"]},minor_stamina_potion:{id:"minor_stamina_potion",name:"Liten Stamina-brygg",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"Gjenoppretter 30 Stamina umiddelbart.",stats:{},relevantActions:["CONSUME"]},herbal_balm:{id:"herbal_balm",name:"Urtebalsam",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:1,description:"ker sankehastighet med 15% i 10 minutter.",stats:{},relevantActions:["CONSUME"]},focus_brew:{id:"focus_brew",name:"Fokus-brygg",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:2,description:"Reduserer stamina-kostnad med 20% i 15 minutter.",stats:{},relevantActions:["CONSUME"]},strength_tincture:{id:"strength_tincture",name:"Styrke-tinktur",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:2,description:"ker angrepskraft med 10 i 10 minutter.",stats:{},relevantActions:["CONSUME"]},masters_draught:{id:"masters_draught",name:"Mester-drikk",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:3,description:"Mesterens hemmelighet. Gir +50% utbytte i 20 minutter.",stats:{},relevantActions:["CONSUME"]},elixir_of_life:{id:"elixir_of_life",name:"Livseliksir",icon:"",type:"CONSUMABLE",durability:1,maxDurability:1,level:3,description:"En legendarisk eliksir. Gjenoppretter 100 Stamina og 50 HP.",stats:{},relevantActions:["CONSUME"]}},E_={grain:{label:"Kornker",seed:"grain",yieldResource:"grain",duration:3*60*1e3,minYield:12,maxYield:20,xp:20},flax:{label:"Lin-ker",seed:"flax",yieldResource:"flax",duration:5*60*1e3,minYield:8,maxYield:15,xp:35}},Fs={farm_house:{id:"farm_house",name:"Grdshuset",icon:"",locationId:"peasant_farm",description:"Ditt personlige hjem. Oppgraderinger gir bedre hvile og mer matlagingsplass.",levels:{1:{requirements:{},unlocks:["SLEEP","EAT"],bonus:"Base hvile"},2:{requirements:{wood:65,gold:130},unlocks:["FARM_UPGRADE"],bonus:"+20% Stamina fra peisen"},3:{requirements:{plank:26,stone:65,gold:390},unlocks:["FARM_UPGRADE_MASTER"],bonus:"+30% Stamina fra senga"},4:{requirements:{plank:65,stone:130,gold:780},unlocks:["FARM_UPGRADE_ELITE"],bonus:"+50% Stamina fra hvile"},5:{requirements:{plank:130,stone:260,gold:1300,iron_ingot:26},unlocks:["FARM_UPGRADE_GODLY"],bonus:"Restaurerer all Stamina ved hvile"}}},sawmill:{id:"sawmill",name:"Sagbruk",icon:"",locationId:"village",description:"Gjr det mulig  foredle Ved til Tmmer.",levels:{1:{requirements:{},unlocks:["REFINE_PLANK_BASIC","hunting_bow"],bonus:"Base produksjon"},2:{requirements:{wood:130,stone:65,gold:130},unlocks:["REFINE_PLANK_FAST"],bonus:"+10% Woodcutting XP"},3:{requirements:{plank:65,stone:195,gold:390},unlocks:["REFINE_PLANK_MASTER","longbow"],bonus:"Lser opp Tier 3 verkty og Langbue"}}},windmill:{id:"windmill",name:"Vindmlle",icon:"",locationId:"village",description:"Gjr det mulig  foredle Korn til Mel mer effektivt.",levels:{1:{requirements:{},unlocks:["REFINE_FLOUR_BASIC"],bonus:"Base produksjon"},2:{requirements:{plank:39,stone:65,gold:195},unlocks:["REFINE_FLOUR_FAST"],bonus:"+10% Farming XP"},3:{requirements:{plank:130,stone:260,gold:650},unlocks:["REFINE_FLOUR_AUTO"],bonus:"Sjanse for dobbel avling"}}},smeltery:{id:"smeltery",name:"Smeltehytte",icon:"",locationId:"village",description:"Gjr det mulig  smelte Jernmalm til Jernbarrer.",levels:{1:{requirements:{},unlocks:["REFINE_IRON_BASIC"],bonus:"Base produksjon"},2:{requirements:{stone:195,wood:130,gold:260},unlocks:["REFINE_IRON_FAST"],bonus:"+10% Mining XP"},3:{requirements:{stone:390,plank:65,gold:780},unlocks:["REFINE_STEEL","glass"],bonus:"Lser opp Stl og Glass"}}},great_forge:{id:"great_forge",name:"Storsmie",icon:"",locationId:"village",description:"Gjr det mulig  lage avanserte verkty og vpen.",levels:{1:{requirements:{},unlocks:["stone_axe","stone_pickaxe","stone_sickle","whetstone","hunting_trap"],bonus:"Base produksjon"},2:{requirements:{iron_ingot:26,plank:39,gold:390},unlocks:["iron_axe","iron_pickaxe","iron_sword","leather_armor","shears","siege_swords","siege_armor"],bonus:"+10% Crafting XP"},3:{requirements:{iron_ingot:130,plank:130,gold:1300},unlocks:["steel_axe","steel_sword","blacksmith_hammer","repair_advanced"],bonus:"Lser opp Mester-utstyr"}}},bakery:{id:"bakery",name:"Bakeri",icon:"",locationId:"village",description:"Gjr det mulig  bake Brd fra Mel.",levels:{1:{requirements:{},unlocks:["CRAFT_BREAD","CRAFT_omelette"],bonus:"Base produksjon"},2:{requirements:{stone:65,plank:26,gold:130},unlocks:["CRAFT_PIE"],bonus:"Bedre stamina fra mat"},3:{requirements:{stone:195,plank:65,gold:520},unlocks:["CRAFT_FEAST"],bonus:"Lser opp Gildemltid"}}},tavern:{id:"tavern",name:"Vertshuset",icon:"",locationId:"village",description:"Et sted for hvile og rykter. ker stamina-regenerering.",levels:{1:{requirements:{},unlocks:["ENTER_TAVERN","REST_BASIC","BUY_MEAL","OPEN_DICE_GAME","OPEN_RESOURCE_GAME","CHAT_LOCAL"],bonus:"Standard hvile"},2:{requirements:{wood:130,stone:65,gold:325},unlocks:["REST_COMFY"],bonus:"Dobbel stamina-regen"},3:{requirements:{plank:65,stone:195,gold:975},unlocks:["REST_ROYAL"],bonus:"Gjenoppretter all stamina raskt"}}},weavery:{id:"weavery",name:"Veveri",icon:"",locationId:"village",description:"Foredler Ull til Stoff for videre salg eller klr.",levels:{1:{requirements:{},unlocks:["REFINE_CLOTH_BASIC"],bonus:"Base produksjon"},2:{requirements:{plank:52,stone:39,gold:195},unlocks:["REFINE_CLOTH_FAST"],bonus:"+10% Trading XP"},3:{requirements:{plank:130,stone:130,gold:520},unlocks:["REFINE_CLOTH_MASTER"],bonus:"Lser opp Silke-produksjon"}}},well:{id:"well",name:"Bybrnn",icon:"",locationId:"village",description:"Gir tilgang til ferskvann for baking og hygiene.",levels:{1:{requirements:{},unlocks:["GATHER_WATER"],bonus:"Basiskilde"},2:{requirements:{stone:65,gold:65},unlocks:["GATHER_WATER_FAST"],bonus:"Bedre vanntilgang"},3:{requirements:{stone:195,gold:260},unlocks:["GATHER_WATER_MASTER"],bonus:"Hellig kilde: +5 Stamina ved drikking"}}},apothecary:{id:"apothecary",name:"Apoteker",icon:"",locationId:"village",description:"Fremstiller medisin og salver.",levels:{1:{requirements:{},unlocks:["REFINE_minor_stamina_potion","REFINE_herbal_balm"],bonus:"Basis urter"},2:{requirements:{wood:130,stone:65,gold:325},unlocks:["REFINE_focus_brew","REFINE_strength_tincture"],bonus:"Gift og Tinkturer"},3:{requirements:{plank:130,glass:65,gold:1300},unlocks:["REFINE_masters_draught","REFINE_elixir_of_life"],bonus:"Mesterverk & Eliksirer"}}},watchtower:{id:"watchtower",name:"Vaktrn",icon:"",locationId:"village",description:"Bedre oversikt og forsvar av landsbyen.",levels:{1:{requirements:{},unlocks:["PATROL"],bonus:"+5 Forsvar"},2:{requirements:{stone:130,plank:65,gold:260},unlocks:["SCOUT"],bonus:"+15 Forsvar"},3:{requirements:{stone:390,plank:130,gold:1040},unlocks:["VOLLEY"],bonus:"Bueskytter-sttte i kamp"}}},stables:{id:"stables",name:"Stall",icon:"",locationId:"village",description:"Muliggjr raskere reise og kavaleri.",levels:{1:{requirements:{},unlocks:["MOUNT_HORSE"],bonus:"Transport"},2:{requirements:{plank:65,wood:65,gold:195},unlocks:["BREED_WARHORSE"],bonus:"Stridshester"},3:{requirements:{plank:195,iron_ingot:26,gold:520},unlocks:["KNIGHT_TRAINING"],bonus:"Riddere"}}},manor_ost:{id:"manor_ost",name:"Slott st",icon:"",locationId:"castle",description:"Setet til den stlige herre. Krever enorme ressurser  bygge.",levels:{1:{requirements:{stone:500,plank:300,iron_ingot:50,gold:1e3},unlocks:["BARON_STATUS"],bonus:"Krav p regionen"}}},manor_vest:{id:"manor_vest",name:"Slott Vest",icon:"",locationId:"castle",description:"Setet til den vestlige herre. Krever enorme ressurser  bygge.",levels:{1:{requirements:{stone:500,plank:300,iron_ingot:50,gold:1e3},unlocks:["BARON_STATUS"],bonus:"Krav p regionen"}}},throne_room:{id:"throne_room",name:"Slottet",icon:"",locationId:"castle",description:"Kongens stol. Den frste Baronen som fullfrer denne blir Konge.",levels:{1:{requirements:{stone:2e3,plank:1e3,iron_ingot:200,gold:5e3},unlocks:["KING_STATUS"],bonus:"Krav p riket"}}},wharf:{id:"wharf",name:"Havnekaia",icon:"",locationId:"dock_hub",description:"Sentrum for maritim handel. Oppgraderinger lser opp flere maritime ressurser og bedre bter.",levels:{1:{requirements:{},unlocks:["OPEN_SHIPYARD","START_SAILING"],bonus:"Grunnleggende sjfart"},2:{requirements:{plank:100,tar:50,gold:5e3},unlocks:["OPEN_WHARF_UPGRADE_MASTER"],bonus:"+20% Fiske-utbytte"},3:{requirements:{plank:250,linen_canvas:100,iron_ingot:100,gold:15e3},unlocks:["OPEN_OCEAN_SAILING"],bonus:"Lser opp Havseilas"}}}},ga={plank:{label:"Planker",icon:"",input:{wood:5},outputResource:"plank",outputAmount:1,buildingId:"sawmill",stamina:10,xp:5,skill:"WOODCUTTING"},flour:{label:"Fint Mel",icon:"",input:{grain:20},outputResource:"flour",outputAmount:10,buildingId:"windmill",stamina:15,xp:8,skill:"FARMING",duration:12e4},iron_ingot:{label:"Jernbarre",icon:"",input:{iron_ore:5,wood:2},outputResource:"iron_ingot",outputAmount:1,buildingId:"smeltery",stamina:20,xp:12,skill:"CRAFTING"},bread:{label:"Bondebrd",icon:"",input:{flour:2},outputResource:"bread",outputAmount:5,buildingId:"bakery",stamina:5,xp:3,skill:"CRAFTING"},pie:{label:"Kjttpai",icon:"",input:{flour:4,meat:2},outputResource:"bread",outputAmount:15,buildingId:"bakery",stamina:15,xp:10,skill:"CRAFTING"},mead:{label:"Mjd",icon:"",input:{honey:5},outputResource:"stamina",outputAmount:20,buildingId:"tavern",stamina:5,xp:5,skill:"CRAFTING"},cloth:{label:"Lin-stoff",icon:"",input:{wool:5},outputResource:"cloth",outputAmount:1,buildingId:"weavery",stamina:15,xp:10,skill:"CRAFTING"},glass:{label:"Glass",icon:"",input:{stone:10,wood:5},outputResource:"glass",outputAmount:1,buildingId:"smeltery",requiredLevel:3,stamina:25,xp:15,skill:"CRAFTING"},minor_stamina_potion:{label:"Liten Stamina-brygg",icon:"",input:{honey:2,glass:1},outputResource:"minor_stamina_potion",outputAmount:1,buildingId:"apothecary",requiredLevel:1,stamina:20,xp:15,skill:"CRAFTING",duration:3e4},herbal_balm:{label:"Urtebalsam",icon:"",input:{wood:5,honey:3},outputResource:"herbal_balm",outputAmount:1,buildingId:"apothecary",requiredLevel:1,stamina:20,xp:15,skill:"CRAFTING",duration:45e3},focus_brew:{label:"Fokus-brygg",icon:"",input:{honey:5,glass:1,grain:10},outputResource:"focus_brew",outputAmount:1,buildingId:"apothecary",requiredLevel:2,stamina:30,xp:30,skill:"CRAFTING",duration:6e4},strength_tincture:{label:"Styrke-tinktur",icon:"",input:{iron_ore:5,honey:5,glass:1},outputResource:"strength_tincture",outputAmount:1,buildingId:"apothecary",requiredLevel:2,stamina:40,xp:40,skill:"CRAFTING",duration:9e4},masters_draught:{label:"Mester-drikk",icon:"",input:{gold:100,honey:10,glass:2},outputResource:"masters_draught",outputAmount:1,buildingId:"apothecary",requiredLevel:3,stamina:60,xp:100,skill:"CRAFTING",duration:18e4},elixir_of_life:{label:"Livseliksir",icon:"",input:{gold:250,honey:20,glass:5},outputResource:"elixir_of_life",outputAmount:1,buildingId:"apothecary",requiredLevel:3,stamina:100,xp:250,skill:"CRAFTING",duration:3e5},linen_canvas:{label:"Seilduk",icon:"",input:{flax:5},outputResource:"linen_canvas",outputAmount:1,buildingId:"weavery",stamina:15,xp:20,skill:"CRAFTING"},tar:{label:"Tjre",icon:"",input:{wood:5},outputResource:"tar",outputAmount:1,buildingId:"smeltery",stamina:20,xp:10,skill:"CRAFTING"},fish_cooked:{label:"Stekt Fisk",icon:"",input:{fish_raw:1},outputResource:"fish_cooked",outputAmount:1,buildingId:"bakery",stamina:10,xp:5,skill:"CRAFTING"}},Sn={stone_axe:{label:"Steinks",icon:"",input:{stone:13,wood:7,gold:7},outputItemId:"stone_axe",buildingId:"great_forge",level:1,stamina:15,xp:10,description:"Et enkelt redskap for tmmerhogst.",skill:"CRAFTING"},stone_pickaxe:{label:"Steinhakke",icon:"",input:{stone:13,wood:7,gold:7},outputItemId:"stone_pickaxe",buildingId:"great_forge",level:1,stamina:15,xp:10,description:"En primitiv hakke for gruvearbeid.",skill:"CRAFTING"},stone_sickle:{label:"Steinsigd",icon:"",input:{stone:7,wood:7,gold:13},outputItemId:"stone_sickle",buildingId:"great_forge",level:1,stamina:10,xp:5,description:"Enkel sigd for kornhsting.",skill:"CRAFTING"},whetstone:{label:"Bryne",icon:"",input:{stone:20,gold:26},outputItemId:"whetstone",buildingId:"great_forge",level:1,stamina:10,xp:5,description:"Brukt for  slipe verkty og ke utbyttet.",skill:"CRAFTING"},stone_chisel:{label:"Steinmeisel",icon:"",input:{stone:13,gold:13},outputItemId:"stone_chisel",buildingId:"great_forge",level:1,stamina:10,xp:8,description:"Ndvendig for  hugge stein i steinhuggeriet.",skill:"CRAFTING"},iron_chisel:{label:"Jernmeisel",icon:"",input:{iron_ingot:7,gold:104},outputItemId:"iron_chisel",buildingId:"great_forge",level:2,stamina:20,xp:15,description:"Effektiv mesiel for steinhugging.",skill:"CRAFTING"},iron_axe:{label:"Jernks",icon:"",input:{iron_ingot:7,plank:3,gold:65},outputItemId:"iron_axe",buildingId:"great_forge",level:2,stamina:25,xp:20,description:"Et solid verkty av jern.",skill:"CRAFTING"},iron_pickaxe:{label:"Jernhakke",icon:"",input:{iron_ingot:7,plank:3,gold:65},outputItemId:"iron_pickaxe",buildingId:"great_forge",level:2,stamina:25,xp:20,description:"Effektiv hakke for dypere graving.",skill:"CRAFTING"},iron_sword:{label:"Jernsverd",icon:"",input:{iron_ingot:13,plank:3,gold:130},outputItemId:"iron_sword",buildingId:"great_forge",level:2,stamina:40,xp:35,description:"Et skarpt sverd for krigere.",skill:"CRAFTING"},leather_armor:{label:"Lrrustning",icon:"",input:{cloth:13,gold:195},outputItemId:"leather_armor",buildingId:"great_forge",level:2,stamina:30,xp:25,description:"God beskyttelse for en reisende.",skill:"CRAFTING"},shears:{label:"Saks",icon:"",input:{iron_ingot:7,gold:130},outputItemId:"shears",buildingId:"great_forge",level:2,stamina:20,xp:15,description:"Ndvendig for  klippe sauer og f ull.",skill:"CRAFTING"},siege_swords:{label:"Beleiringsvpen (x10)",icon:"",input:{iron_ingot:7,plank:7,gold:65},outputItemId:"siege_sword",outputAmount:10,buildingId:"great_forge",level:2,stamina:40,xp:30,description:"En kasse med vpen til garnisonen.",skill:"CRAFTING"},siege_armor:{label:"Beleiringsrustning (x10)",icon:"",input:{iron_ingot:7,cloth:7,gold:65},outputItemId:"siege_armor",outputAmount:10,buildingId:"great_forge",level:2,stamina:40,xp:30,description:"En kasse med rustninger til garnisonen.",skill:"CRAFTING"},steel_axe:{label:"Stlks",icon:"",input:{iron_ingot:26,plank:13,gold:325},outputItemId:"steel_axe",buildingId:"great_forge",level:3,stamina:50,xp:50,description:"Mesterlig utformet ks av herdet stl.",skill:"CRAFTING"},steel_sword:{label:"Stlsverd",icon:"",input:{iron_ingot:39,plank:7,gold:650},outputItemId:"steel_sword",buildingId:"great_forge",level:3,stamina:80,xp:100,description:"Det ultimate vpenet for en herre.",skill:"CRAFTING"},blacksmith_hammer:{label:"Smedhammer",icon:"",input:{iron_ingot:20,plank:7,gold:260},outputItemId:"blacksmith_hammer",buildingId:"great_forge",level:3,stamina:40,xp:50,description:"Mesterverkty for en ekte smed.",skill:"CRAFTING"},omelette:{label:"Omelett",icon:"",input:{egg:3},outputItemId:"omelette",buildingId:"bakery",level:1,stamina:10,xp:8,description:"En mettende frokost. Gir energi-buff.",skill:"CRAFTING"},hunting_trap:{label:"Jaktfelle",icon:"",input:{wood:13,iron_ingot:3,gold:39},outputItemId:"hunting_trap",buildingId:"great_forge",level:1,stamina:20,xp:15,description:"En enkel snare for smvilt.",skill:"CRAFTING"},hunting_bow:{label:"Jaktbue",icon:"",input:{plank:7,cloth:7,gold:65},outputItemId:"hunting_bow",buildingId:"sawmill",level:1,stamina:25,xp:20,description:"En stdig bue for jakt.",skill:"CRAFTING"},longbow:{label:"Langbue",icon:"",input:{plank:20,cloth:13,iron_ingot:1,gold:325},outputItemId:"longbow",buildingId:"sawmill",level:3,stamina:40,xp:45,description:"En kraftig bue med lang rekkevidde.",skill:"CRAFTING"},cannonball:{label:"Kanonkuler (x5)",icon:"",input:{stone:5,iron_ingot:1,gold:10},outputItemId:"cannonball",outputAmount:5,buildingId:"great_forge",level:2,stamina:30,xp:25,description:"Tunge kuler for skipsartilleri.",skill:"CRAFTING"}},ld={KING:{label:"Konge",description:"Styrer riket, krever skatt og dmmer i store saker."},BARON:{label:"Baron",description:"Styrer en region, krever inn skatt fra bnder, og beskytter mot krig."},PEASANT:{label:"Bonde",description:"Produserer mat og ressurser. Betaler skatt."},SOLDIER:{label:"Soldat",description:"Beskytter riket og deltar i raids."},MERCHANT:{label:"Kjpmann",description:"Tjener penger p handel og markedsspekulasjon."}},bt={grain:{price:.5,stock:800,basePrice:.5,baseStock:800,demand:1},flour:{price:1.75,stock:300,basePrice:1.75,baseStock:300,demand:1},bread:{price:1.2,stock:300,basePrice:1.2,baseStock:300,demand:1},wood:{price:1.25,stock:800,basePrice:1.25,baseStock:800,demand:1},plank:{price:11.25,stock:300,basePrice:11.25,baseStock:300,demand:1},iron_ore:{price:2.5,stock:800,basePrice:2.5,baseStock:800,demand:1},iron_ingot:{price:25,stock:300,basePrice:25,baseStock:300,demand:1},stone:{price:1.25,stock:800,basePrice:1.25,baseStock:800,demand:1},wool:{price:.5,stock:800,basePrice:.5,baseStock:800,demand:1},cloth:{price:10,stock:300,basePrice:10,baseStock:300,demand:1},honey:{price:1,stock:300,basePrice:1,baseStock:300,demand:1},meat:{price:1.5,stock:300,basePrice:1.5,baseStock:300,demand:1},siege_sword:{price:40,stock:100,basePrice:40,baseStock:100,demand:1},siege_armor:{price:40,stock:100,basePrice:40,baseStock:100,demand:1},flax:{price:10,stock:0,basePrice:1,baseStock:800,demand:1},linen_canvas:{price:125,stock:0,basePrice:12.5,baseStock:300,demand:1},tar:{price:162.5,stock:0,basePrice:16.25,baseStock:300,demand:1},fish_raw:{price:20,stock:0,basePrice:2,baseStock:800,demand:1},silk:{price:500,stock:0,basePrice:50,baseStock:50,demand:1},spice:{price:750,stock:0,basePrice:75,baseStock:50,demand:1}},Kz=[{type:"RAID",title:"Vikinger p horisonten!",description:"Et vikingskip er sett nr kysten. Forsvar jordene fr de stjeler kornet!",locationId:"fields"},{type:"RAID",title:"Bandittleir funnet",description:"Banditter har sltt seg ned i skogen. De stjeler ved hver time!",locationId:"forest"},{type:"QUEST",title:"Den Hellige Gral?",description:"Rykter sier en eremitt ved klosteret har funnet noe verdifullt.",locationId:"village"},{type:"QUEST",title:"Markedsdag i nabolaget",description:"En sjelden mulighet for god handel p grensen.",locationId:"marketplace"}],Wz=[{id:"tax_cut",label:"Skattekutt",description:"Alle skatter halveres i 10 minutter. Lojaliteten stiger."},{id:"peace",label:"Fredsavtale",description:"Ingen raids tillatt de neste 10 minuttene."},{id:"salt_tax",label:"Saltskatt",description:"ker kornprisene, men reduserer lojalitet."},{id:"conscription",label:"Verneplikt",description:"Soldater koster mindre  verve, men bnder jobber 20% tregere."}],ob={skins:[{id:"brown",label:"Rust",color:"#8B4513",price:0},{id:"white",label:"Pearl",color:"#E2E8F0",price:1e3},{id:"black",label:"Void",color:"#1A202C",price:2500},{id:"golden",label:"Gold",color:"#F6E05E",price:5e3},{id:"chestnut",label:"Red",color:"#7C2D12",price:750},{id:"grey",label:"Mist",color:"#94A3B8",price:1200}]},Zp={standard:{id:"standard",name:"Snekke",description:"En enkel, men plitelig bt for kystfiske og korte turer.",baseSpeed:5,baseHp:100,cargoSlots:2,maxCannons:0,cost:{plank:50,tar:20}},sloop:{id:"sloop",name:"Slupp",description:"En rask seilbt som balanserer fart og lastekapasitet. Perfekt for handel.",baseSpeed:10,baseHp:250,cargoSlots:4,maxCannons:2,cost:{plank:200,iron_ingot:50,linen_canvas:40,tar:50}},cog:{id:"cog",name:"Kogg",description:"Et tungt handelsskip med bredt skrog. Tler mye juling.",baseSpeed:6,baseHp:600,cargoSlots:8,maxCannons:4,cost:{plank:500,iron_ingot:100,linen_canvas:80,tar:100}},galleon:{id:"galleon",name:"Gallion",description:"Havets ubestridte hersker. En flytende festning.",baseSpeed:8,baseHp:1500,cargoSlots:12,maxCannons:12,cost:{plank:1e3,iron_ingot:300,linen_canvas:150,gold:5e3,silk:50}}},A_={sails:{id:"sails",name:"Seilduk",description:"Forbedret seilduk fanger vinden bedre og ker farten.",levels:[{level:1,cost:{linen_canvas:10},effect:"+10% Fart"},{level:2,cost:{linen_canvas:25,silk:5},effect:"+20% Fart"},{level:3,cost:{linen_canvas:50,silk:20},effect:"+35% Fart"}]},hull:{id:"hull",name:"Skrogforsterkning",description:"Ekstra lag med eik og jernbeslag gir bten mer helse.",levels:[{level:1,cost:{plank:20,tar:5},effect:"+50 HP"},{level:2,cost:{plank:50,iron_ingot:10},effect:"+150 HP"},{level:3,cost:{plank:100,iron_ingot:30},effect:"+350 HP"}]},cannons:{id:"cannons",name:"Kanonbatteri",description:"Bedre kanoner ker skaden og rekkevidden.",levels:[{level:1,cost:{iron_ingot:20,plank:10},effect:"+20 Skade"},{level:2,cost:{iron_ingot:50,plank:25},effect:"+50 Skade"},{level:3,cost:{iron_ingot:100,gold:500},effect:"+100 Skade"}]},nets:{id:"nets",name:"Fiskenot",description:"Strre og sterkere garn ker fangsten per kast.",levels:[{level:1,cost:{linen_canvas:15},effect:"+20% Fangst"},{level:2,cost:{linen_canvas:40},effect:"+50% Fangst"},{level:3,cost:{linen_canvas:80,silk:5},effect:"+100% Fangst"}]}},Nu={colors:[{id:"classic_brown",name:"Valntt",hex:"#4b2c20",cost:{}},{id:"royal_red",name:"Kongelig Rd",hex:"#7f1d1d",cost:{gold:100}},{id:"deep_blue",name:"Havdyp Bl",hex:"#1e3a8a",cost:{gold:250}},{id:"midnight_black",name:"Svartedauden",hex:"#0f172a",cost:{gold:500}},{id:"gold_leaf",name:"Bladgull",hex:"#fbbf24",cost:{gold:2e3}}],flags:[{id:"none",name:"Ingen",cost:{}},{id:"pirate",name:"Sjrver",cost:{gold:150}},{id:"merchant",name:"Handelslaug",cost:{gold:300}},{id:"royal",name:"Kongens Vakt",cost:{gold:1e3}}]},FN=Object.freeze(Object.defineProperty({__proto__:null,ACTION_COSTS:Ec,ACTION_ICONS:Jl,BOAT_MODELS:Zp,BOAT_UPGRADES:A_,COSMETIC_UNLOCKS:Nu,CRAFTING_RECIPES:Sn,CROP_DATA:E_,GAME_BALANCE:re,HORSE_COSMETICS:ob,INITIAL_EQUIPMENT:ab,INITIAL_MARKET:bt,INITIAL_RESOURCES:ms,INITIAL_SKILLS:An,ITEM_TEMPLATES:qe,LAW_TEMPLATES:Wz,LEVEL_XP:Dm,REFINERY_RECIPES:ga,REPAIR_CONFIG:rb,RESOURCE_DETAILS:Ge,REWARDS:rh,ROLE_DEFINITIONS:ld,SEASONS:Nn,SKILL_DETAILS:qz,UPGRADES_LIST:T_,VILLAGE_BUILDINGS:Fs,WEATHER:Vi,WORLD_EVENT_TEMPLATES:Kz},Symbol.toStringTag,{value:"Module"})),Yz=t=>{const e=Object.keys(t),s=[...e].sort(()=>Math.random()-.5),n={...t};if(e.length===0)return n;const r=s.shift();r&&(n[r]={...n[r],role:"KING",resources:JSON.parse(JSON.stringify(ms.KING)),regionId:"capital",status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:100,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:50,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Kongens Verkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Kongens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Kongens Rustning",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}});const l=Math.min(2,s.length);for(let m=0;m<l;m++){const b=s.shift();if(b){const x=m===0?"region_ost":"region_vest";n[b]={...n[b],role:"BARON",resources:JSON.parse(JSON.stringify(ms.BARON)),regionId:x,status:{hp:100,stamina:100,morale:100,legitimacy:80,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:40,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Baronens Verkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Baronens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Baronens Rustning",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}}}}let c=0;const u=()=>{const m=c%2===0?"region_ost":"region_vest";return c++,m},d=s.length;let h=0,f=0;d>=4?(h=Math.max(1,Math.floor(d/6)),f=Math.max(1,Math.floor(d/5))):d>0&&d<4&&(h=0,f=0);for(let m=0;m<h;m++){const b=s.shift();b&&(n[b]={...n[b],role:"MERCHANT",resources:JSON.parse(JSON.stringify(ms.MERCHANT)),regionId:u(),status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:30,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:30,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Hndverkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Kort sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Kjpmannskappe",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}})}for(let m=0;m<f;m++){const b=s.shift();b&&(n[b]={...n[b],role:"SOLDIER",resources:JSON.parse(JSON.stringify(ms.SOLDIER)),regionId:u(),status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:20,contribution:0},equipment:{MAIN_HAND:{id:"tools",name:"Feltverkty",icon:"",type:"MAIN_HAND",level:1,durability:100,maxDurability:100},OFF_HAND:{id:"weapon",name:"Soldatens Sverd",icon:"",type:"OFF_HAND",level:1,durability:100,maxDurability:100},BODY:{id:"armor",name:"Brynjekofte",icon:"",type:"BODY",level:1,durability:100,maxDurability:100}}})}for(;s.length>0;){const m=s.shift();m&&(n[m]={...n[m],role:"PEASANT",resources:JSON.parse(JSON.stringify(ms.PEASANT)),regionId:u(),status:{hp:100,stamina:100,morale:80,legitimacy:100,authority:10,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:10,contribution:0},equipment:{}})}return n},Xz=(t,e)=>{const s={...t},n=[];return Object.values(s).forEach(i=>{if(i.role==="PEASANT"){const a=Math.ceil((i.resources.grain||0)*.15),l=Math.ceil((i.resources.gold||0)*(15/100));if(a>0||l>0){const c=Object.values(s).find(u=>u.role==="BARON"&&(u.regionId===i.regionId||i.regionId==="test_region"&&u.regionId==="test_region"));c&&(i.resources.grain=Math.max(0,i.resources.grain-a),i.resources.gold=Math.max(0,i.resources.gold-l),s[c.id].resources.grain+=a,s[c.id].resources.gold+=l,n.push(`${i.name} betalte ${a} korn og ${l} gull i skatt til ${c.name}`))}}}),Object.values(s).forEach(i=>{if(i.role==="BARON"){const r=Math.ceil((i.resources.grain||0)*(e/100)),a=Math.ceil((i.resources.gold||0)*(e/100));if(r>0||a>0){const l=Object.values(s).find(c=>c.role==="KING");l&&(i.resources.grain=Math.max(0,i.resources.grain-r),i.resources.gold=Math.max(0,i.resources.gold-a),s[l.id].resources.grain+=r,s[l.id].resources.gold+=a,n.push(`${i.name} betalte ${r} korn og ${a} gull i skatt til Kongen`))}}}),Object.values(s).forEach(i=>{if(i.role==="MERCHANT"||i.role==="SOLDIER"){const r=i.role==="MERCHANT"?e/50:e/100,a=Math.ceil((i.resources.gold||0)*r);if(a>0){const l=Object.values(s).find(c=>c.role==="KING");l&&(i.resources.gold=Math.max(0,i.resources.gold-a),s[l.id].resources.gold+=a,n.push(`${i.name} (${i.role}) betalte ${a} gull i skatt til Kongen`))}}}),{updatedPlayers:s,results:n}},Qz=(t,e)=>{if(!t||Object.keys(t).length===0)return null;const s=re.CONTRIBUTION_VALUES,n=Object.entries(t).map(([a,l])=>{let c=0;return Object.entries(l.resources||{}).forEach(([u,d])=>{c+=d*(s[u]||.1)}),{pid:a,score:c,name:l.name}});n.sort((a,l)=>l.score-a.score);const i=n[0];if(!i)return null;const r=e==="throne_room"?"KING":"BARON";return{winningPlayerId:i.pid,role:r}},Jz=(t,e)=>({pin:t,name:e,status:"PLAYING",settings:"feudal_europe",hostName:"Host",isPublic:!0,market:JSON.parse(JSON.stringify(bt)),world:{year:1100,season:"Spring",weather:"Clear",gameTick:0,lastTickAt:Date.now(),taxRateDetails:{kingTax:20},settlement:{buildings:Object.entries(Fs).reduce((s,[n])=>({...s,[n]:{id:n,level:0,progress:{},target:200,contributions:{}}}),{})}},markets:{capital:{...bt},region_vest:{...bt},region_ost:{...bt}},players:{},public_profiles:{},messages:[],regions:{region_vest:{id:"region_vest",name:"Baroniet Vest",taxRate:10,defenseLevel:50,rulerName:"Ingen"},region_ost:{id:"region_ost",name:"Baroniet st",taxRate:10,defenseLevel:50,rulerName:"Ingen"}},diplomacy:{},worldEvents:{}}),Lm=async(t,e)=>{var i,r;if(!t||!e)return;const s=z(q,`simulation_server_metadata/${t}`);if(e.isPublic===!1){await da(s,null);return}const n={pin:t,lastUpdated:Date.now()};e.name&&(n.name=e.name),e.status&&(n.status=e.status),e.players&&(n.playerCount=Object.keys(e.players).length),e.playerCount!==void 0&&(n.playerCount=e.playerCount),(i=e.world)!=null&&i.year&&(n.worldYear=e.world.year),(r=e.world)!=null&&r.season&&(n.season=e.world.season),e.hostName&&(n.hostName=e.hostName),e.isPublic!==void 0&&(n.isPublic=e.isPublic),await oe(s,n)},lb=30,Zz=21,e7=120,fR=480,t7=["Spring","Summer","Autumn","Winter"],s7=t=>t%lb,xa=t=>s7(t)<Zz?"DAY":"NIGHT",n7=(t,e=0)=>{let s=t;if(e>0){const l=(Date.now()-e)/6e4;s+=Math.min(1,Math.max(0,l))}const i=s%lb/lb*24,r=(6+Math.floor(i))%24,a=Math.floor(i%1*60);return`${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},i7=t=>{const e=Math.floor(t%fR/e7);return t7[e]||"Spring"},r7=(t,e=1)=>e+Math.floor(t/fR),ta=t=>!t||!t.id?null:qe[t.id]?t.id:Object.keys(qe).sort((n,i)=>i.length-n.length).find(n=>t.id.startsWith(n+"_"))||null,mR=(t,e)=>{if(!e)return;const n=(Array.isArray(e)?e:Object.values(e)).filter(i=>{if(!i)return!1;const r=ta(i),a=r?qe[r]:null,l=i.relevantActions||(a==null?void 0:a.relevantActions);return l==null?void 0:l.includes(t)}).filter(i=>!!i);if(n.length!==0)return n.sort((i,r)=>{var f,m;const a=ta(i),l=ta(r),c=i.stats||(a?(f=qe[a])==null?void 0:f.stats:{}),u=r.stats||(l?(m=qe[l])==null?void 0:m.stats:{}),d=(c==null?void 0:c.yieldBonus)||0;return((u==null?void 0:u.yieldBonus)||0)-d})[0]},wt=async(t,e)=>{const s=z(q,`simulation_rooms/${t}/messages`),n={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,content:e,timestamp:Date.now(),type:"SYSTEM"};try{const i=z(q,`simulation_archives/${t}/full_log`);Dy(i,n)}catch(i){console.error("Critical: Archive log failed:",i)}await Pe(s,i=>{let r=[];return Array.isArray(i)?r=i:i&&typeof i=="object"&&(r=Object.values(i)),r.push(n),r.length>50&&(r=r.sort((a,l)=>a.timestamp-l.timestamp).slice(r.length-50)),r})},vi=(t,e,s,n={})=>{var b,x;let i=0,r=!1;t.equipment&&Object.keys(t.equipment).forEach(g=>{var w,S;const p=t.equipment[g];if(!p)return;let y=p.relevantActions;if(!y&&p.id){const _=ta(p);_&&(y=(w=qe[_])==null?void 0:w.relevantActions)}if(!n.actionType||(y==null?void 0:y.includes(n.actionType))){const _=p.stats||(ta(p)?(S=qe[ta(p)])==null?void 0:S.stats:void 0);_!=null&&_.yieldBonus&&(i+=_.yieldBonus),(g==="AXE"||g==="PICKAXE"||g==="SCYTHE"||g==="MAIN_HAND"||g==="OFF_HAND"||g==="BOW"||g==="TRAP"||g==="CHISEL")&&(r=!0)}});let a=e+i;const l=((b=t.skills)==null?void 0:b[s])||{level:0},c=n.isRefining?re.SKILLS.REFINING_BONUS:re.SKILLS.GATHERING_BONUS,u=1+l.level*c;a*=u;const d=n.actionType==="FORAGE"||n.actionType==="GATHER_HONEY";if(!n.isRefining&&!r&&!d){if(n.requiresTool)return 0;const v=(x=re.GATHERING)==null?void 0:x.NO_TOOL_PENALTY;a*=1-v}let h=1;n.regionId&&(n.actionType==="MINE"&&(n.regionId==="region_vest"?h=1.2:n.regionId==="region_ost"&&(h=.8)),n.actionType==="CHOP"&&(n.regionId==="region_vest"?h=.8:n.regionId==="region_ost"&&(h=1.2)));let f=1;if(t.activeBuffs&&t.activeBuffs.length>0){const v=Date.now(),g=t.activeBuffs.find(p=>p.type==="YIELD_BONUS"&&p.expiresAt>v);g&&(f+=g.value)}const m=(n.season||1)*(n.weather||1)*(n.law||1)*(n.upgrades||1)*h*f;if(a=Math.floor(a*m),n.performance!==void 0){const v=re.MINIGAME.BASE_MULTIPLIER+n.performance*re.MINIGAME.PERFORMANCE_WEIGHT;a=Math.ceil(a*v)}return Math.max(0,a)},On=(t,e,s,n,i=0)=>{const r=Nn[e],a=Vi[s],l=(r==null?void 0:r.staminaMod)||1,c=(a==null?void 0:a.staminaMod)||1,d=xa(i)==="NIGHT"?1.2:1;let f=t*l*c*d;if(n&&n.length>0){const m=Date.now(),b=n.find(x=>x.type==="STAMINA_SAVE"&&x.expiresAt>m);b&&(f*=1-b.value)}return Math.ceil(f)},Hn=(t,e,s,n=1)=>{if(!t||!e||!s)return;const i=s.replace(/\./g,"_"),r=z(q,`simulation_rooms/${t}/stats/${e}`);oe(r,{[i]:Yj(n)}).catch(a=>console.error("Failed to log systemic stat:",a))},a7=async(t,e,s)=>{const{resource:n,type:i,amount:r}=s,a=Math.max(1,Math.floor(r||1)),l=z(q,`simulation_rooms/${t}/players/${e}`),c=await ve(l);if(!c.exists())return{success:!1,error:"Player not found"};const u=c.val(),d=u.regionId||"capital";if((i==="BUY"||i==="MARKET_BUY")&&s.target==="CARAVAN"){const x=u.caravan||{level:1,inventory:{}},v=re.CARAVAN.LEVELS.find(p=>p.level===x.level)||re.CARAVAN.LEVELS[0],g=Object.values(x.inventory||{}).reduce((p,y)=>p+(y||0),0);if(g+a>v.capacity)return{success:!1,error:`Ikke nok plass i karavanen! (${g}/${v.capacity})`}}const h=z(q,`simulation_rooms/${t}/markets/${d}/${n}`);let f={success:!1,amount:0};if(await Pe(h,x=>{if(!x){const v=bt[n];if(!v)return;x=JSON.parse(JSON.stringify(v))}if(i==="BUY"||i==="MARKET_BUY"){if(x.stock<a)return;f.price=x.price,f.cost=x.price*a,f.amount=a,x.stock-=a;const v=re.MARKET.PRICE_IMPACT_BUY;x.price=x.price*Math.pow(1+v,a),f.success=!0}else if(i==="SELL"||i==="MARKET_SELL"){f.price=x.price;const v=x.price*re.MARKET.SELL_RATIO;f.revenue=v*a,f.amount=a,x.stock+=a;const g=re.MARKET.PRICE_IMPACT_SELL;x.price=x.price*Math.pow(1-g,a),f.success=!0}return x}),!f.success)return{success:!1,error:"Handel feilet (Vare mangler, utsolgt eller for lite p lager)"};let m=!1,b="";return await Pe(l,x=>{var p,y;if(!x)return;x.resources||(x.resources={});const v=s.target||"BACKPACK",g=s.source||"BACKPACK";if(i==="BUY"||i==="MARKET_BUY"){const k=f.cost||0;if((x.resources.gold||0)<k)return;x.resources.gold=(x.resources.gold||0)-k,v==="CARAVAN"?(x.caravan||(x.caravan={level:1,inventory:{},durability:100,upgrades:[]}),x.caravan.inventory||(x.caravan.inventory={}),x.caravan.inventory[n]=(x.caravan.inventory[n]||0)+a):x.resources[n]=(x.resources[n]||0)+a;const w=Ge[n];b=`Kjpte ${a} ${w?w.label:n} for ${k.toFixed(1)}g`,m=!0}else if(i==="SELL"||i==="MARKET_SELL"){const k=f.revenue||0;if(g==="CARAVAN"){if((((y=(p=x==null?void 0:x.caravan)==null?void 0:p.inventory)==null?void 0:y[n])||0)<a)return;x.caravan.inventory[n]-=a}else{if((x.resources[n]||0)<a)return;x.resources[n]-=a}x.resources.gold=(x.resources.gold||0)+k;const w=Ge[n];b=`Solgte ${a} ${w?w.label:n} for ${k.toFixed(1)}g`,m=!0}return x}),m?(wt(t,`[${new Date().toLocaleTimeString()}] ${u.name}: ${b}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:b,utbytte:i==="BUY"||i==="MARKET_BUY"?[{resource:n,amount:a}]:[{resource:"gold",amount:f.revenue}],xp:[],durability:[]}}):{success:!1,error:"Transaksjon avbrutt (Mangler ressurser eller gull)"}},o7=async(t,e,s)=>{var g;const{buildingId:n,resource:i,amount:r}=s,a=z(q,`simulation_rooms/${t}/world/settlement/buildings/${n}`),l=z(q,`simulation_rooms/${t}/players/${e}`),c=await ve(l);if(!c.exists())return{success:!1,error:"Player missing"};const u=c.val();if((((g=u.resources)==null?void 0:g[i])||0)<r)return{success:!1,error:"Not enough resources"};let d=!1,h=0,f="",m=!1,b=0,x="Ukjent feil i transaksjon";if(await Pe(a,p=>{var I,F,U,R;p||(p={id:n,level:0,progress:{},contributions:{}});const y=Fs[n];if(!y){x=`Systemfeil: BuildingDef mangler for ID: ${n}`;return}f=(y==null?void 0:y.name)||n;const k=Number(p.level??0),w=p.progress&&Object.keys(p.progress).length>0,S=p.contributions&&Object.keys(p.contributions).length>0,_=!((I=y.levels)!=null&&I[k+1]);let T=!1;_&&(w||S)&&(console.log(`[Auto-Repair] Building ${n} is stuck at Level ${k}. Resetting to 0 to enable completion.`),p.level=0,T=!0);const E=Number(p.level??0),A=E+1,j=(F=y==null?void 0:y.levels)==null?void 0:F[A];if(!j)return x=`Bygget er ferdig (Level ${E}). Ingen flere oppgraderinger tilgjengelig.`,T?p:void 0;const O=((U=j.requirements)==null?void 0:U[i])||0,H=((R=p.progress)==null?void 0:R[i])||0,G=O-H;let L=!0;if(Object.entries(j.requirements).forEach(([C,$])=>{(p.progress[C]||0)<$&&(L=!1)}),G<=0&&!L)return x=`Fullt lager for ${i}. (Krav: ${O}, Har: ${H}, Niv: ${E}->${A})`,T?p:void 0;h=Math.min(r,G),p.progress||(p.progress={}),p.progress[i]=H+h,p.contributions||(p.contributions={}),p.contributions[e]||(p.contributions[e]={name:u.name,resources:{}});const M=p.contributions[e].resources;M[i]=(M[i]||0)+h;let D=!0;if(Object.entries(j.requirements).forEach(([C,$])=>{(p.progress[C]||0)<$&&(D=!1)}),D){p.level=A,p.progress={};const C=j.unlocks||[];if(C.includes("BARON_STATUS")||C.includes("KING_STATUS")){const $=Qz(p.contributions,n);$&&(p.pendingWinnerId=$.winningPlayerId,p.pendingRole=$.role)}p.contributions={},m=!0,b=A}return d=!0,Hn(t,"contributions",i,h),p}),!d)return{success:!1,error:`${x}`};if(m){const y=(await ve(a)).val();if(y.pendingWinnerId){const k=y.pendingWinnerId,w=y.pendingRole,S=z(q,`simulation_rooms/${t}/players/${k}`),T=(await ve(S)).val(),E=z(q,`simulation_rooms/${t}`),A={};if(A[`players/${k}/role`]=w,A[`public_profiles/${k}/role`]=w,w==="BARON"){const O=n==="manor_ost"?"region_ost":"region_vest";A[`players/${k}/regionId`]=O,A[`public_profiles/${k}/regionId`]=O,A[`regions/${O}/rulerId`]=k,A[`regions/${O}/rulerName`]=T.name}else if(w==="KING"){A[`players/${k}/regionId`]="capital",A[`public_profiles/${k}/regionId`]="capital",A["regions/capital/rulerId"]=k,A["regions/capital/rulerName"]=T.name;const O=await ve(z(q,`simulation_rooms/${t}/regions`));if(O.exists()){const G=O.val();Object.entries(G).forEach(([L,M])=>{M.rulerId===k&&L!=="capital"&&(A[`regions/${L}/rulerId`]=null,A[`regions/${L}/rulerName`]="VAKANT")})}const H=await ve(z(q,`simulation_rooms/${t}/players`));if(H.exists()){const G=H.val();Object.entries(G).forEach(([L,M])=>{M.role==="KING"&&L!==k&&(A[`players/${L}/role`]="PEASANT",A[`public_profiles/${L}/role`]="PEASANT",M.status&&(A[`players/${L}/status/legitimacy`]=0))})}}await oe(E,A);const j=` ${T.name} har fullfrt ${f} og er n utnevnt til ${w==="BARON"?"Baron":"Konge"}!`;wt(t,j),await oe(a,{pendingWinnerId:null,pendingRole:null})}}let v=`Bidro med ${h} ${i} til ${f}`;return m&&(v+=`  ${f} ndde niv ${b}!`),await Pe(l,p=>{var y;if(p)return((y=p.resources)==null?void 0:y[i])>=h&&(p.resources[i]-=h),p}),wt(t,`[${new Date().toLocaleTimeString()}] ${u.name}: ${v}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:v,utbytte:[{resource:i,amount:-h}],xp:[],durability:[]}}},l7=async(t,e,s)=>{const n=z(q,`simulation_rooms/${t}/players/${e}`),i=await ve(n);if(!i.exists())return{success:!1,error:"Spiller finnes ikke"};const r=i.val(),a=s.type||"TAX",l=r.role==="KING"||a==="TAX_ROYAL",c=s.taxRate!==void 0?s.taxRate:10,u=c/100,d=z(q,`simulation_rooms/${t}/players`),h=await ve(d);if(!h.exists())return{success:!1,error:"Ingen spillere i rommet"};const f=h.val();let m=0,b=0,x=0;const v=(r.regionId||"").trim().toLowerCase(),g=Object.entries(f).map(async([O,H])=>{if(O===e)return;const G=(H.regionId||"").trim().toLowerCase();if(!(l?H.role==="BARON":H.role==="PEASANT"&&(G===v||G.includes(v)||v.includes(G))))return;const M=z(q,`simulation_rooms/${t}/players/${O}`);let D={goldFloat:0,grainFloat:0};await Pe(M,I=>{var $,V,P;if(!I)return;I.resources||(I.resources={gold:0,grain:0});const F=Number(I.resources.gold??I.gold??I.wealth??(($=I.stats)==null?void 0:$.gold)??((P=(V=I.inventory)==null?void 0:V.find(W=>W.id==="gold"))==null?void 0:P.amount)??0),U=Number(I.resources.grain??0),R=F*u,C=U*u;if(R>0){const W=Math.floor(R);I.resources.gold!==void 0?I.resources.gold-=W:I.gold!==void 0&&(I.gold-=W),D.goldFloat=R}if(C>0){const W=Math.floor(C);I.resources.grain-=W,D.grainFloat=C}return I}),(D.goldFloat>0||D.grainFloat>0)&&(x++,m+=D.goldFloat,b+=D.grainFloat)});await Promise.all(g);const p=Math.floor(m),y=Math.floor(b);await Pe(n,O=>{if(!O)return;O.resources||(O.resources={gold:0,grain:0}),O.resources.gold=(O.resources.gold||0)+p,O.resources.grain=(O.resources.grain||0)+y;const H=Math.max(0,5+Math.floor((c-10)/2));return O.status.legitimacy=Math.max(0,(O.status.legitimacy||100)-H),O});const k=Date.now(),w=z(q,`simulation_rooms/${t}/world`),_=(await ve(w)).val()||{year:1,season:"Spring"},T=_.year||1,E=_.season||"Spring",A={year:T,season:E,amountGold:p,amountGrain:y,rate:c,timestamp:k};if(l){const O={};O.lastRoyalTaxCollection={year:T,season:E},_.taxRateDetails?O["taxRateDetails/kingTax"]=c:O.taxRateDetails={kingTax:c},await oe(w,O);const H=z(q,`simulation_rooms/${t}/world/royalTaxHistory`),G=await ve(H),L=G.exists()?G.val():[];L.push(A),L.length>10&&L.shift(),await da(H,L)}else{const O=z(q,`simulation_rooms/${t}/regions/${r.regionId}`),H={};H.taxRate=c,H.lastTaxCollection={year:T,season:E},await oe(O,H);const G=z(q,`simulation_rooms/${t}/regions/${r.regionId}/taxHistory`),L=await ve(G),M=L.exists()?L.val():[];M.push(A),M.length>10&&M.shift(),await da(G,M)}const j=l?`Kongelig Skatt (${c}%): ${p}g og ${y} korn fra ${x} baroner.`:`Skatteinnkreving (${c}%): ${p}g og ${y} korn fra ${x} bnder.`;return wt(t,`[${new Date().toLocaleTimeString()}] ${r.name}: ${j}`),{success:!0,data:{success:!0,timestamp:k,message:j,utbytte:[{resource:"gold",amount:p},{resource:"grain",amount:y}],xp:[],durability:[]}}},Qte=async(t,e,s)=>{const n=z(q,`simulation_rooms/${t}/players/${e}`),i=await ve(n);if(!i.exists())return{success:!1,error:"Fant ikke spilleren."};const r=i.val();if(r.role!=="PEASANT")return{success:!1,error:"Du har alt en karriere."};if(s!=="SOLDIER"&&s!=="MERCHANT")return{success:!1,error:"Ugyldig karrierevalg."};const a=re.CAREERS[s];if(r.stats.level<a.LEVEL_REQ)return{success:!1,error:`Du m vre level ${a.LEVEL_REQ} for  bli ${s==="SOLDIER"?"Soldat":"Kjpmann"}.`};if((r.resources.gold||0)<a.COST)return{success:!1,error:`Du mangler ${a.COST-(r.resources.gold||0)} gull.`};let l=!1;return await Pe(n,c=>{if(c&&!(c.resources.gold<a.COST))return c.resources.gold-=a.COST,c.role=s,l=!0,c}),l?(wt(t,`[KARRIERE] ${r.name} er n en ${s}!`),{success:!0,message:`Gratulerer! Du er n en ${s==="SOLDIER"?"Soldat":"Kjpmann"}.`}):{success:!1,error:"Transaksjon feilet."}},c7=async(t,e)=>{Hn(t,"coups","start",1);const s=z(q,`simulation_rooms/${t}/regions/${e}`),i=(await ve(s)).val(),r=i.rulerId,a=i.rulerName;if(r){const c=z(q,`simulation_rooms/${t}/players/${r}`);await Pe(c,u=>{if(u)return u.role="PEASANT",u.status&&(u.status.legitimacy=0),u}),await oe(z(q,`simulation_rooms/${t}/public_profiles/${r}`),{role:"PEASANT"})}const l=await pR(t,e,i);wt(t,` REVOLUSJON i ${i.name}! ${a} er styrtet. ${l} skyggelfter ble automatisk talt opp!`)},u7=async(t,e)=>{if(!e||e==="capital")return;const s=z(q,`simulation_rooms/${t}/regions/${e}`),i=(await ve(s)).val();if(!i)return;await pR(t,e,i)>-1?wt(t,` SUKSESSJON: Baroniet ${i.name} er ledig etter eierens kroning. Et nytt valg er i gang!`):wt(t,` SUKSESSJON: Baroniet ${i.name} er ledig og kan n kreves.`)};async function pR(t,e,s){var f,m;const n={},i=((f=s.coup)==null?void 0:f.contributions)||{},r=((m=s.coup)==null?void 0:m.preVotes)||{};if(Object.entries(i).sort((b,x)=>x[1].amount-b[1].amount).slice(0,3).forEach(([b,x])=>{n[b]={id:b,name:x.name,votes:0,weightedVotes:0,contribution:x.amount}}),Object.keys(n).length===0)return await oe(z(q,`simulation_rooms/${t}/regions/${e}`),{rulerId:null,rulerName:"VAKANT",activeElection:null,"coup/bribeProgress":0,"coup/preVotes":null}),-1;const a=Date.now(),l={startedAt:a,expiresAt:a+re.COUP.VACANCY_DURATION,candidates:n,votes:{}};let c=0;const u=z(q,`simulation_rooms/${t}/players`),h=(await ve(u)).val()||{};return Object.entries(r).forEach(([b,x])=>{if(n[x]){const v=h[b];if(v){let g=re.COUP.PEASANT_VOTE_WEIGHT;v.role==="KING"&&(g=re.COUP.KING_VOTE_WEIGHT),l.votes[b]={candidateId:x,weight:g},n[x].votes+=1,n[x].weightedVotes+=g,c++}}}),await oe(z(q,`simulation_rooms/${t}/regions/${e}`),{rulerId:null,rulerName:"VAKANT",activeElection:l,"coup/bribeProgress":0,"coup/preVotes":null}),c}const Jte=async(t,e,s)=>{var y,k;const{regionId:n,amount:i}=s,r=z(q,`simulation_rooms/${t}/regions/${n}`),a=z(q,`simulation_rooms/${t}/players/${e}`),l=await ve(a);if(!l.exists())return{success:!1,error:"Fant ikke spilleren."};const c=l.val();if((((y=c.resources)==null?void 0:y.gold)||0)<i)return{success:!1,error:"Du har ikke nok gull."};const d=(await ve(r)).val();if(!d)return{success:!1,error:"Region finnes ikke."};const h=((k=d.coup)==null?void 0:k.lastRulerChange)||0,f=Date.now();if(f-h<re.COUP.HONEYMOON_DURATION&&c.role!=="KING")return{success:!1,error:`Regionen er for stabil. Prv igjen om ${Math.ceil((re.COUP.HONEYMOON_DURATION-(f-h))/6e4)} minutter.`};if(d.activeElection)return{success:!1,error:"Et valg pgr allerede."};let m=0,b=!1;if(await Pe(r,w=>{w||(w={id:n,name:n==="capital"?"Kongeriket":n==="region_vest"?"Baroniet Vest":"Baroniet st",rulerName:"Ingen",coup:{lastRulerChange:0,bribeProgress:0,contributions:{}}}),w.coup||(w.coup={lastRulerChange:0,bribeProgress:0,contributions:{}}),w.garrison||(w.garrison={swords:0,armor:0,morale:100}),w.fortification||(w.fortification={hp:1e3,maxHp:1e3,level:1});const S=w.coup.bribeProgress||0,_=i/re.COUP.BASE_BRIBE_COST*10;return e===d.rulerId?w.coup.bribeProgress=Math.max(0,S-_):(w.coup.bribeProgress=Math.min(100,S+_),w.coup.challengerId=e,w.coup.challengerName=c.name),w.coup.contributions||(w.coup.contributions={}),w.coup.contributions[e]||(w.coup.contributions[e]={name:c.name,amount:0}),w.coup.contributions[e].amount+=i,m=w.coup.bribeProgress,b=!0,w}),!b)return{success:!1,error:"Transaksjon feilet (Region oppdatert)."};await Pe(a,w=>{if(w)return w.resources.gold=(w.resources.gold||0)-i,w});const x=z(q,`simulation_rooms/${t}/players`),v=await ve(x);let g={};v.exists()&&(g=v.val());let p=d.rulerId;if(!p&&Object.keys(g).length>0){if(n==="capital"){const w=Object.values(g).find(S=>S.role==="KING");w&&(p=w.id)}else{const w=Object.values(g).find(S=>S.role==="BARON"&&S.regionId===n);w&&(p=w.id)}p&&await oe(r,{rulerId:p})}if(p){const w=z(q,`simulation_rooms/${t}/players/${p}`),S=Math.floor(i/100);if(await Pe(w,_=>{if(_)return _.status&&(_.status.legitimacy=Math.max(0,(_.status.legitimacy||0)-S)),_}),Object.keys(g).length>0){const _=Object.keys(g).filter(T=>g[T].regionId===n&&T!==e&&(g[T].role==="PEASANT"||g[T].role==="SOLDIER"));if(_.length>0){const T=Math.floor(i/_.length);T>0&&await Promise.all(_.map(E=>{const A=z(q,`simulation_rooms/${t}/players/${E}/resources`);return oe(A,{gold:Yj(T)})})),wt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g. ${_.length} innbyggere fikk ${T}g hver! (Opprr: ${m.toFixed(0)}%)`)}else wt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g til saken, men fant ingen trengende i ${d.name}. (Opprr: ${m.toFixed(0)}%)`)}else wt(t,`[FOLKEGAVE] ${c.name} donerte ${i}g. (Opprr: ${m.toFixed(0)}%)`);return m>=100&&await c7(t,n),{success:!0,message:`Besteikkelse gjennomfrt! Opprr: ${m.toFixed(1)}%`}}return{success:!0,message:"Besteikkelse registrert."}},Zte=async(t,e,s,n)=>{const i=z(q,`simulation_rooms/${t}/regions/${s}`);let r=!1;return await Pe(i,a=>{if(a)return a.coup||(a.coup={bribeProgress:0,contributions:{},preVotes:{}}),a.coup.preVotes||(a.coup.preVotes={}),a.coup.preVotes[e]=n,r=!0,a}),r?{success:!0,message:"Skyggelfte avgitt!"}:{success:!1,error:"Kunne ikke avgi lfte."}},ese=async(t,e,s)=>{const n=z(q,`simulation_rooms/${t}/regions/${s}`),i=z(q,`simulation_rooms/${t}/players/${e}`),r=re.COUP.RESTORE_ORDER_COST,a=await ve(i);if(!a.exists())return{success:!1,error:"Spiller mangler"};const l=a.val();if(l.resources.gold<r)return{success:!1,error:`Trenger ${r}g for  gjenopprette ro.`};let c=!1;return await Pe(n,u=>{if(!(!u||u.rulerId!==e)&&u.coup)return u.coup.bribeProgress=Math.max(0,(u.coup.bribeProgress||0)-25),c=!0,u}),c?(await Pe(i,u=>{if(u)return u.resources.gold-=r,u.status.legitimacy=Math.min(100,(u.status.legitimacy||0)+10),u}),wt(t,` ${l.name} har gjenopprettet ro i ${s} ved  dele ut midler til vaktene.`),{success:!0,message:"Ro gjenopprettet (-25% opprr)"}):{success:!1,error:"Kunne ikke gjenopprette ro."}},tse=async(t,e,s)=>{const{regionId:n,candidateId:i}=s,r=z(q,`simulation_rooms/${t}/regions/${n}`),a=z(q,`simulation_rooms/${t}/players/${e}`),l=await ve(a);if(!l.exists())return{success:!1};const c=l.val();let u=re.COUP.PEASANT_VOTE_WEIGHT;c.role==="KING"&&(u=re.COUP.KING_VOTE_WEIGHT);let d=!1;return await Pe(r,h=>{if(!h||!h.activeElection||Date.now()>h.activeElection.expiresAt)return;h.activeElection.votes||(h.activeElection.votes={});const f=h.activeElection.votes[e];if(f){const b=h.activeElection.candidates[f.candidateId];b&&(b.votes=Math.max(0,(b.votes||0)-1),b.weightedVotes=Math.max(0,(b.weightedVotes||0)-f.weight))}h.activeElection.votes[e]={candidateId:i,weight:u};const m=h.activeElection.candidates[i];return m&&(m.votes=(m.votes||0)+1,m.weightedVotes=(m.weightedVotes||0)+u),d=!0,h}),{success:d}},d7=async(t,e,s)=>{const{newRate:n}=s,i=z(q,`simulation_rooms/${t}/players/${e}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Spiller mangler"};const a=r.val(),l=a.regionId||"capital",c=z(q,`simulation_rooms/${t}/regions/${l}`),u=Math.max(0,Math.min(20,n));await oe(c,{taxRate:u});const d=`Skatteniv i ${l} satt til ${u}%.`;return wt(t,`[${new Date().toLocaleTimeString()}] ${a.name}: ${d}`),{success:!0,data:{message:d}}},sse=async(t,e)=>{const s=z(q,`simulation_rooms/${t}/regions/${e}`),i=(await ve(s)).val(),r=(i==null?void 0:i.name)||e;let a=null;if(await Pe(s,l=>{if(!l||!l.activeElection||Date.now()<l.activeElection.expiresAt)return;const c=Object.values(l.activeElection.candidates);if(c.length===0)return l.rulerId=null,l.rulerName="Ingen Hersker",l.activeElection=null,l;const u=c.sort((d,h)=>h.weightedVotes-d.weightedVotes)[0];return a={winnerId:u.id,winnerName:u.name},l.rulerId=u.id,l.rulerName=u.name,l.activeElection=null,l.coup||(l.coup={lastRulerChange:Date.now(),bribeProgress:0,contributions:{}}),l.coup.lastRulerChange=Date.now(),l.coup.bribeProgress=0,l.coup.contributions={},l}),a){Hn(t,"coups","success",1);const l=a.winnerId,c=z(q,`simulation_rooms/${t}/players/${l}`),d=(await ve(c)).val(),h=z(q,`simulation_rooms/${t}`),f=e==="capital",m=f?"KING":"BARON",b=f?"Konge":"Baron",x={};return x[`players/${l}/role`]=m,x[`players/${l}/regionId`]=e,x[`public_profiles/${l}/role`]=m,x[`public_profiles/${l}/regionId`]=e,await oe(h,x),wt(t,` KRONING: ${d.name} har vunnet valget og er n ${b} av ${r}!`),{success:!0}}return{success:!1}},h7=async(t,e,s)=>{const n=z(q,`simulation_rooms/${t}/players/${e}`);let i=!1;return await Pe(n,r=>{if(r)return r.resources||(r.resources={}),r.resources.gold=(r.resources.gold||0)+s,i=!0,r}),i&&wt(t,` ADMIN: Gitt ${s}g til en spiller.`),{success:i}},f7=async(t,e,s,n)=>{const i=z(q,`simulation_rooms/${t}/players/${e}`),r=qe[s];if(!r)return{success:!1,error:"Invalid Item ID"};let a=!1;return await Pe(i,l=>{if(l){l.inventory||(l.inventory=[]);for(let c=0;c<n;c++){const u=JSON.parse(JSON.stringify(r));u.instanceId=`${s}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,l.inventory.push(u)}return a=!0,l}}),a&&wt(t,` ADMIN: Gitt ${n}x ${r.name} til en spiller.`),{success:a}},m7=async(t,e,s,n)=>{const i=z(q,`simulation_rooms/${t}/players/${e}`);let r=!1;return await Pe(i,a=>{if(a)return a.resources||(a.resources={}),a.resources[s]=(a.resources[s]||0)+n,a.resources[s]<0&&(a.resources[s]=0),r=!0,a}),r&&wt(t,` ADMIN: Gitt ${n}x ${s} til en spiller.`),{success:r}},p7=async(t,e,s,n)=>{var d;const i=z(q,`simulation_rooms/${t}/players/${e}`),r=z(q,`simulation_rooms/${t}/channels/${n}/messages`),a=await ve(i);if(!a.exists())return{success:!1,error:"Spiller mangler"};const l=a.val();let c=0;if(l.role!=="KING"&&(n==="global"?c=2:n!==l.regionId&&n!=="diplomacy"&&n.includes(e)&&n.length>20&&(c=5)),(((d=l.resources)==null?void 0:d.gold)||0)<c)return{success:!1,error:`Trenger ${c}g for  sende denne meldingen.`};let u=!1;if(c>0?await Pe(i,h=>{if(h&&!((h.resources.gold||0)<c))return h.resources.gold-=c,u=!0,h}):u=!0,!u)return{success:!1,error:"Har ikke rd."};try{const h=Dy(r);return await oe(h,{id:h.key,senderId:e,senderName:l.name,senderRole:l.role,content:s.trim(),timestamp:qF(),isPremiere:c>0}),{success:!0}}catch(h){return console.error("Chat Send Error:",h),{success:!1,error:`Kunne ikke sende melding: ${h.message||"Ukjent feil"}`}}},g7=async(t,e,s)=>{const{targetRegionId:n}=s,i=z(q,`simulation_rooms/${t}/players/${e}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Spiller finnes ikke"};const a=r.val();if(a.regionId===n)return{success:!1,error:"Du er allerede i denne regionen."};const l=Ec.TRAVEL_START;return(a.status.stamina||0)<(l==null?void 0:l.stamina)?{success:!1,error:"For sliten for reise."}:(a.resources.bread||0)<(l==null?void 0:l.bread)?{success:!1,error:"Trenger mer niste (brd) for reisen."}:(await Pe(i,c=>{if(c)return c.status.stamina-=l==null?void 0:l.stamina,c.resources.bread-=l==null?void 0:l.bread,c}),wt(t,`[VEIEN] ${a.name} har lagt ut p reise mot ${n}...`),{success:!0,data:{success:!0,message:"Reisen har begynt!",utbytte:[],xp:[],durability:[]}})},x7=async(t,e,s)=>{const{targetRegionId:n,finalDurability:i}=s,r=z(q,`simulation_rooms/${t}/players/${e}`),a=await ve(r);if(!a.exists())return{success:!1,error:"Spiller finnes ikke"};const l=a.val();let c=0;await Pe(r,d=>{if(d)return d.regionId=n,typeof i=="number"&&(d.caravan||(d.caravan={level:1,inventory:{},durability:100,upgrades:[]}),d.caravan.durability=Math.max(0,i),c=d.caravan.durability),d}),await oe(z(q,`simulation_rooms/${t}/public_profiles/${e}`),{regionId:n});const u=n==="capital"?"Hovedstaden":n==="region_vest"?"Vestfjella":"stlandet";return wt(t,`[VEIEN] ${l.name} har ankommet ${u}. (Slitasje: ${Math.round(c)})`),{success:!0,data:{success:!0,message:`Ankommet ${u}!`,utbytte:[],xp:[{skill:"TRADING",amount:25}],durability:[]}}},ba=t=>{if(!t.basePrice||!t.baseStock)return t.price;const e=Math.max(1,t.stock),s=t.baseStock/e;let n=Math.pow(s,1.25);return n=Math.min(10,Math.max(.2,n)),t.basePrice*n},UN=(t,e,s)=>{let n=0;const i={...t},r=s?-1:1;for(let a=0;a<e;a++){const l=ba(i);if(n+=s?l:l*re.MARKET.SELL_RATIO,i.stock+=r,i.stock<0)break}return n},b7=t=>{var f;const{actor:e,room:s,action:n,localResult:i}=t,{resource:r}=n,a=e.regionId||"capital";let l=((f=s.markets)==null?void 0:f[a])||s.market;const c=["iron","swords","armor"];let u=!1;if(c.forEach(m=>{l[m]&&(delete l[m],u=!0)}),Object.keys(bt).forEach(m=>{l[m]||(l[m]=JSON.parse(JSON.stringify(bt[m])),u=!0)}),u&&s.markets&&(s.markets[a]=l),!l)return i.success=!1,i.message="Markedet er ikke tilgjengelig.",!1;if(!l[r])return i.success=!1,i.message="Markedet tilbyr ikke denne varen her.",!1;const d=l[r];if(!d)return i.success=!1,i.message="Varen finnes ikke p dette markedet.",!1;const h=ba(d);return d.stock<=0?(i.success=!1,i.message="Varen er utsolgt.",!1):(e.resources.gold||0)<h?(i.success=!1,i.message=`Du har ikke nok gull. Trenger ${h.toFixed(2)}g`,!1):(e.resources.gold=(e.resources.gold||0)-h,e.resources[r]=(e.resources[r]||0)+1,d.stock-=1,d.price=ba(d),i.message=`Kjpte 1 ${r} for ${h.toFixed(2)}g`,i.utbytte.push({resource:r,amount:1}),!0)},v7=t=>{var f;const{actor:e,room:s,action:n,localResult:i}=t,{resource:r}=n,a=e.regionId||"capital";let l=((f=s.markets)==null?void 0:f[a])||s.market;if(!l){s.markets||(s.markets={});const m=JSON.parse(JSON.stringify(bt)),x={region_vest:{discount:["iron_ore","stone","swords"],premium:["grain","bread","cloth"]},region_ost:{discount:["grain","bread","wool","meat"],premium:["iron_ore","tools","wood"]},capital:{discount:["luxury_goods","glass"],premium:["raw_materials","wood","stone"]}}[a]||{discount:[],premium:[]};Object.keys(m).forEach(v=>{x.discount.includes(v)&&(m[v].price*=.6,m[v].stock*=1.5),x.premium.includes(v)&&(m[v].price*=1.4,m[v].stock*=.7),m[v].price*=.9+Math.random()*.2}),l=m,s.markets[a]=l}if(!l)return i.success=!1,i.message="Markedet er ikke tilgjengelig.",!1;if(!l[r]||!l[r])return i.success=!1,i.message="Markedet tar ikke imot denne varen her.",!1;const c=e.resources[r]||0;if(typeof c!="number"||c<1)return i.success=!1,i.message=`Du har ingen ${r}  selge.`,!1;const u=l[r];if(!u)return i.success=!1,i.message="Markedet tar ikke imot denne varen.",!1;const h=ba(u)*re.MARKET.SELL_RATIO;return e.resources[r]-=1,e.resources.gold=(e.resources.gold||0)+h,u.stock+=1,u.price=ba(u),i.message=`Solgte 1 ${r} for ${h.toFixed(2)}g`,!0},y7=t=>{var b,x;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,{resource:a,targetRegionId:l,action:c}=n,u=e.regionId||"capital",d=((b=s.markets)==null?void 0:b[u])||s.market,h=(x=s.markets)==null?void 0:x[l];if(!d||!h||!d[a]||!h[a])return i.success=!1,i.message="Ugyldig handelsrute eller vare.",!1;const f=d[a],m=h[a];if(!f||!m)return i.success=!1,i.message="Varen handles ikke p disse markedene.",!1;if(c==="IMPORT"){const g=UN(m,5,!0);if((e.resources.gold||0)<g)return i.success=!1,i.message=`Ikke nok gull. Trenger ${g.toFixed(2)}g for 5stk.`,!1;for(let p=0;p<5;p++)m.stock-=1,m.price=ba(m);e.resources.gold-=g,e.resources[a]=(e.resources[a]||0)+5,i.message=`Bulk-Import: 5 ${a} fra ${l} for ${g.toFixed(2)}g`}else{if((e.resources[a]||0)<5)return i.success=!1,i.message=`Mangler 5 ${a} for eksport.`,!1;const g=UN(m,5,!1);for(let p=0;p<5;p++)m.stock+=1,m.price=ba(m);e.resources[a]-=5,e.resources.gold+=g,i.message=`Bulk-Eksport: 5 ${a} til ${l} for ${g.toFixed(2)}g`}return r("TRADING",25),!0},_7=t=>{t&&Object.keys(t).forEach(e=>{const s=t[e];if(!(!s||!s.baseStock)&&s.stock>s.baseStock*.1){const n=s.stock*.003;s.stock=Math.max(0,s.stock-n),s.price=ba(s)}})},gR=(t,e,s,n)=>{N.useEffect(()=>{if(!t||e==="LOBBY")return;const i=setInterval(async()=>{const r=Date.now(),a=(s==null?void 0:s.lastTickAt)||0;if(!(r-a<1e3))if(r-a>=6e4){const l=z(q,`simulation_rooms/${t}/world`);try{let c=null;await Pe(l,u=>{if(!u)return;const d=u.lastTickAt||0;if(Date.now()-d>=6e4){const h=(u.gameTick||0)+1;if(u.gameTick=h,u.lastTickAt=Date.now(),u.season=i7(h),u.year=r7(h,1100),h%10===0){const f=z(q,`simulation_rooms/${t}/markets`);ve(f).then(m=>{if(m.exists()){const b=m.val();Object.keys(b).forEach(x=>{_7(b[x])}),oe(f,b)}})}return c={...u},u}else return}),c&&Lm(t,{world:c,pin:t,playerCount:n})}catch{}}else s!=null&&s.lastTickAt||oe(z(q,`simulation_rooms/${t}/world`),{lastTickAt:Date.now()})},5e3);return()=>clearInterval(i)},[t,e,s==null?void 0:s.lastTickAt,s==null?void 0:s.gameTick,n]),N.useEffect(()=>{if(!t||n===void 0)return;const i=setTimeout(()=>{Lm(t,{playerCount:n})},2e3);return()=>clearTimeout(i)},[t,n])},w7=t=>{const[e,s]=N.useState(null);N.useEffect(()=>{if(!t){s(null);return}const i=`simulation_rooms/${t}`,r=tt(z(q,`${i}/status`),m=>{s(b=>{const x=m.val()||"LOBBY";return b?{...b,status:x}:{pin:t,status:x,markets:{},market:bt,players:{},messages:[],regions:{},worldEvents:{}}})}),a=tt(z(q,`${i}/world`),m=>{s(b=>{const x=m.val();return b?{...b,world:x}:{pin:t,world:x,markets:{},market:bt,players:{},messages:[],regions:{},worldEvents:{}}})}),l=tt(z(q,`${i}/markets`),m=>{s(b=>{const x=m.val()||{};return b?{...b,markets:x}:{pin:t,markets:x,market:bt,players:{},messages:[],regions:{},worldEvents:{}}})}),c=tt(z(q,`${i}/messages`),m=>{s(b=>{const x=m.val()||[];return b?{...b,messages:x}:{pin:t,messages:x,markets:{},market:bt,players:{},regions:{},worldEvents:{}}})}),u=tt(z(q,`${i}/players`),m=>{s(b=>{const x=m.val()||{};return b?{...b,players:x}:{pin:t,players:x,markets:{},market:bt,messages:[],regions:{},worldEvents:{}}})}),d=tt(z(q,`${i}/worldEvents`),m=>{s(b=>{const x=m.val()||{};return b?{...b,worldEvents:x}:{pin:t,worldEvents:x,markets:{},market:bt,players:{},messages:[],regions:{}}})}),h=tt(z(q,`${i}/activeVote`),m=>{s(b=>{const x=m.val();return b?{...b,activeVote:x}:{pin:t,activeVote:x,markets:{},market:bt,players:{},messages:[],regions:{},worldEvents:{}}})}),f=tt(z(q,`${i}/regions`),m=>{s(b=>{const x=m.val()||{};return b?{...b,regions:x}:{pin:t,regions:x,markets:{},market:bt,players:{},messages:[],worldEvents:{}}})});return ve(z(q,i)).then(m=>{if(m.exists()){const b=m.val();s(x=>({...x,pin:b.pin,status:b.status,settings:b.settings,hostName:b.hostName,isPublic:b.isPublic??!0,world:b.world,markets:b.markets||{},market:b.market||bt,players:(x==null?void 0:x.players)||b.players||{},messages:(x==null?void 0:x.messages)||b.messages||[],regions:b.regions||{},diplomacy:b.diplomacy||{},worldEvents:b.worldEvents||{}}))}}),()=>{r(),a(),l(),c(),u(),d(),h(),f()}},[t]);const n=N.useMemo(()=>{if(!(e!=null&&e.players))return 0;const i=Date.now();return Object.values(e.players).filter(r=>r.online&&i-(r.lastActive||0)<6e4).length},[e==null?void 0:e.players]);return{roomData:e,setRoomData:s,onlineCount:n}},j_=N.createContext({});function C_(t){const e=N.useRef(null);return e.current===null&&(e.current=t()),e.current}const R_=typeof window<"u",xR=R_?N.useLayoutEffect:N.useEffect,e0=N.createContext(null);function I_(t,e){t.indexOf(e)===-1&&t.push(e)}function O_(t,e){const s=t.indexOf(e);s>-1&&t.splice(s,1)}const rr=(t,e,s)=>s>e?e:s<t?t:s;let M_=()=>{};const ar={},bR=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function vR(t){return typeof t=="object"&&t!==null}const yR=t=>/^0[^.\s]+$/u.test(t);function D_(t){let e;return()=>(e===void 0&&(e=t()),e)}const Tn=t=>t,k7=(t,e)=>s=>e(t(s)),ah=(...t)=>t.reduce(k7),cd=(t,e,s)=>{const n=e-t;return n===0?1:(s-t)/n};class L_{constructor(){this.subscriptions=[]}add(e){return I_(this.subscriptions,e),()=>O_(this.subscriptions,e)}notify(e,s,n){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,s,n);else for(let r=0;r<i;r++){const a=this.subscriptions[r];a&&a(e,s,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const li=t=>t*1e3,vn=t=>t/1e3;function _R(t,e){return e?t*(1e3/e):0}const wR=(t,e,s)=>(((1-3*s+3*e)*t+(3*s-6*e))*t+3*e)*t,N7=1e-7,S7=12;function T7(t,e,s,n,i){let r,a,l=0;do a=e+(s-e)/2,r=wR(a,n,i)-t,r>0?s=a:e=a;while(Math.abs(r)>N7&&++l<S7);return a}function oh(t,e,s,n){if(t===e&&s===n)return Tn;const i=r=>T7(r,0,1,t,s);return r=>r===0||r===1?r:wR(i(r),e,n)}const kR=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,NR=t=>e=>1-t(1-e),SR=oh(.33,1.53,.69,.99),P_=NR(SR),TR=kR(P_),ER=t=>(t*=2)<1?.5*P_(t):.5*(2-Math.pow(2,-10*(t-1))),V_=t=>1-Math.sin(Math.acos(t)),AR=NR(V_),jR=kR(V_),E7=oh(.42,0,1,1),A7=oh(0,0,.58,1),CR=oh(.42,0,.58,1),j7=t=>Array.isArray(t)&&typeof t[0]!="number",RR=t=>Array.isArray(t)&&typeof t[0]=="number",C7={linear:Tn,easeIn:E7,easeInOut:CR,easeOut:A7,circIn:V_,circInOut:jR,circOut:AR,backIn:P_,backInOut:TR,backOut:SR,anticipate:ER},R7=t=>typeof t=="string",$N=t=>{if(RR(t)){M_(t.length===4);const[e,s,n,i]=t;return oh(e,s,n,i)}else if(R7(t))return C7[t];return t},Lh=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function I7(t,e){let s=new Set,n=new Set,i=!1,r=!1;const a=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(d){a.has(d)&&(u.schedule(d),t()),d(l)}const u={schedule:(d,h=!1,f=!1)=>{const b=f&&i?s:n;return h&&a.add(d),b.has(d)||b.add(d),d},cancel:d=>{n.delete(d),a.delete(d)},process:d=>{if(l=d,i){r=!0;return}i=!0,[s,n]=[n,s],s.forEach(c),s.clear(),i=!1,r&&(r=!1,u.process(d))}};return u}const O7=40;function IR(t,e){let s=!1,n=!0;const i={delta:0,timestamp:0,isProcessing:!1},r=()=>s=!0,a=Lh.reduce((y,k)=>(y[k]=I7(r),y),{}),{setup:l,read:c,resolveKeyframes:u,preUpdate:d,update:h,preRender:f,render:m,postRender:b}=a,x=()=>{const y=ar.useManualTiming?i.timestamp:performance.now();s=!1,ar.useManualTiming||(i.delta=n?1e3/60:Math.max(Math.min(y-i.timestamp,O7),1)),i.timestamp=y,i.isProcessing=!0,l.process(i),c.process(i),u.process(i),d.process(i),h.process(i),f.process(i),m.process(i),b.process(i),i.isProcessing=!1,s&&e&&(n=!1,t(x))},v=()=>{s=!0,n=!0,i.isProcessing||t(x)};return{schedule:Lh.reduce((y,k)=>{const w=a[k];return y[k]=(S,_=!1,T=!1)=>(s||v(),w.schedule(S,_,T)),y},{}),cancel:y=>{for(let k=0;k<Lh.length;k++)a[Lh[k]].cancel(y)},state:i,steps:a}}const{schedule:_t,cancel:va,state:us,steps:og}=IR(typeof requestAnimationFrame<"u"?requestAnimationFrame:Tn,!0);let ff;function M7(){ff=void 0}const Ps={now:()=>(ff===void 0&&Ps.set(us.isProcessing||ar.useManualTiming?us.timestamp:performance.now()),ff),set:t=>{ff=t,queueMicrotask(M7)}},OR=t=>e=>typeof e=="string"&&e.startsWith(t),MR=OR("--"),D7=OR("var(--"),B_=t=>D7(t)?L7.test(t.split("/*")[0].trim()):!1,L7=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Ac={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},ud={...Ac,transform:t=>rr(0,1,t)},Ph={...Ac,default:1},Su=t=>Math.round(t*1e5)/1e5,F_=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function P7(t){return t==null}const V7=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,U_=(t,e)=>s=>!!(typeof s=="string"&&V7.test(s)&&s.startsWith(t)||e&&!P7(s)&&Object.prototype.hasOwnProperty.call(s,e)),DR=(t,e,s)=>n=>{if(typeof n!="string")return n;const[i,r,a,l]=n.match(F_);return{[t]:parseFloat(i),[e]:parseFloat(r),[s]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},B7=t=>rr(0,255,t),lg={...Ac,transform:t=>Math.round(B7(t))},qa={test:U_("rgb","red"),parse:DR("red","green","blue"),transform:({red:t,green:e,blue:s,alpha:n=1})=>"rgba("+lg.transform(t)+", "+lg.transform(e)+", "+lg.transform(s)+", "+Su(ud.transform(n))+")"};function F7(t){let e="",s="",n="",i="";return t.length>5?(e=t.substring(1,3),s=t.substring(3,5),n=t.substring(5,7),i=t.substring(7,9)):(e=t.substring(1,2),s=t.substring(2,3),n=t.substring(3,4),i=t.substring(4,5),e+=e,s+=s,n+=n,i+=i),{red:parseInt(e,16),green:parseInt(s,16),blue:parseInt(n,16),alpha:i?parseInt(i,16)/255:1}}const cb={test:U_("#"),parse:F7,transform:qa.transform},lh=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),vr=lh("deg"),ci=lh("%"),xe=lh("px"),U7=lh("vh"),$7=lh("vw"),HN={...ci,parse:t=>ci.parse(t)/100,transform:t=>ci.transform(t*100)},ol={test:U_("hsl","hue"),parse:DR("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:s,alpha:n=1})=>"hsla("+Math.round(t)+", "+ci.transform(Su(e))+", "+ci.transform(Su(s))+", "+Su(ud.transform(n))+")"},Ft={test:t=>qa.test(t)||cb.test(t)||ol.test(t),parse:t=>qa.test(t)?qa.parse(t):ol.test(t)?ol.parse(t):cb.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?qa.transform(t):ol.transform(t),getAnimatableNone:t=>{const e=Ft.parse(t);return e.alpha=0,Ft.transform(e)}},H7=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function G7(t){var e,s;return isNaN(t)&&typeof t=="string"&&(((e=t.match(F_))==null?void 0:e.length)||0)+(((s=t.match(H7))==null?void 0:s.length)||0)>0}const LR="number",PR="color",z7="var",q7="var(",GN="${}",K7=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function dd(t){const e=t.toString(),s=[],n={color:[],number:[],var:[]},i=[];let r=0;const l=e.replace(K7,c=>(Ft.test(c)?(n.color.push(r),i.push(PR),s.push(Ft.parse(c))):c.startsWith(q7)?(n.var.push(r),i.push(z7),s.push(c)):(n.number.push(r),i.push(LR),s.push(parseFloat(c))),++r,GN)).split(GN);return{values:s,split:l,indexes:n,types:i}}function VR(t){return dd(t).values}function BR(t){const{split:e,types:s}=dd(t),n=e.length;return i=>{let r="";for(let a=0;a<n;a++)if(r+=e[a],i[a]!==void 0){const l=s[a];l===LR?r+=Su(i[a]):l===PR?r+=Ft.transform(i[a]):r+=i[a]}return r}}const W7=t=>typeof t=="number"?0:Ft.test(t)?Ft.getAnimatableNone(t):t;function Y7(t){const e=VR(t);return BR(t)(e.map(W7))}const ya={test:G7,parse:VR,createTransformer:BR,getAnimatableNone:Y7};function cg(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}function X7({hue:t,saturation:e,lightness:s,alpha:n}){t/=360,e/=100,s/=100;let i=0,r=0,a=0;if(!e)i=r=a=s;else{const l=s<.5?s*(1+e):s+e-s*e,c=2*s-l;i=cg(c,l,t+1/3),r=cg(c,l,t),a=cg(c,l,t-1/3)}return{red:Math.round(i*255),green:Math.round(r*255),blue:Math.round(a*255),alpha:n}}function Pm(t,e){return s=>s>0?e:t}const St=(t,e,s)=>t+(e-t)*s,ug=(t,e,s)=>{const n=t*t,i=s*(e*e-n)+n;return i<0?0:Math.sqrt(i)},Q7=[cb,qa,ol],J7=t=>Q7.find(e=>e.test(t));function zN(t){const e=J7(t);if(!e)return!1;let s=e.parse(t);return e===ol&&(s=X7(s)),s}const qN=(t,e)=>{const s=zN(t),n=zN(e);if(!s||!n)return Pm(t,e);const i={...s};return r=>(i.red=ug(s.red,n.red,r),i.green=ug(s.green,n.green,r),i.blue=ug(s.blue,n.blue,r),i.alpha=St(s.alpha,n.alpha,r),qa.transform(i))},ub=new Set(["none","hidden"]);function Z7(t,e){return ub.has(t)?s=>s<=0?t:e:s=>s>=1?e:t}function eq(t,e){return s=>St(t,e,s)}function $_(t){return typeof t=="number"?eq:typeof t=="string"?B_(t)?Pm:Ft.test(t)?qN:nq:Array.isArray(t)?FR:typeof t=="object"?Ft.test(t)?qN:tq:Pm}function FR(t,e){const s=[...t],n=s.length,i=t.map((r,a)=>$_(r)(r,e[a]));return r=>{for(let a=0;a<n;a++)s[a]=i[a](r);return s}}function tq(t,e){const s={...t,...e},n={};for(const i in s)t[i]!==void 0&&e[i]!==void 0&&(n[i]=$_(t[i])(t[i],e[i]));return i=>{for(const r in n)s[r]=n[r](i);return s}}function sq(t,e){const s=[],n={color:0,var:0,number:0};for(let i=0;i<e.values.length;i++){const r=e.types[i],a=t.indexes[r][n[r]],l=t.values[a]??0;s[i]=l,n[r]++}return s}const nq=(t,e)=>{const s=ya.createTransformer(e),n=dd(t),i=dd(e);return n.indexes.var.length===i.indexes.var.length&&n.indexes.color.length===i.indexes.color.length&&n.indexes.number.length>=i.indexes.number.length?ub.has(t)&&!i.values.length||ub.has(e)&&!n.values.length?Z7(t,e):ah(FR(sq(n,i),i.values),s):Pm(t,e)};function UR(t,e,s){return typeof t=="number"&&typeof e=="number"&&typeof s=="number"?St(t,e,s):$_(t)(t,e)}const iq=t=>{const e=({timestamp:s})=>t(s);return{start:(s=!0)=>_t.update(e,s),stop:()=>va(e),now:()=>us.isProcessing?us.timestamp:Ps.now()}},$R=(t,e,s=10)=>{let n="";const i=Math.max(Math.round(e/s),2);for(let r=0;r<i;r++)n+=Math.round(t(r/(i-1))*1e4)/1e4+", ";return`linear(${n.substring(0,n.length-2)})`},Vm=2e4;function H_(t){let e=0;const s=50;let n=t.next(e);for(;!n.done&&e<Vm;)e+=s,n=t.next(e);return e>=Vm?1/0:e}function rq(t,e=100,s){const n=s({...t,keyframes:[0,e]}),i=Math.min(H_(n),Vm);return{type:"keyframes",ease:r=>n.next(i*r).value/e,duration:vn(i)}}const aq=5;function HR(t,e,s){const n=Math.max(e-aq,0);return _R(s-t(n),e-n)}const Ct={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dg=.001;function oq({duration:t=Ct.duration,bounce:e=Ct.bounce,velocity:s=Ct.velocity,mass:n=Ct.mass}){let i,r,a=1-e;a=rr(Ct.minDamping,Ct.maxDamping,a),t=rr(Ct.minDuration,Ct.maxDuration,vn(t)),a<1?(i=u=>{const d=u*a,h=d*t,f=d-s,m=db(u,a),b=Math.exp(-h);return dg-f/m*b},r=u=>{const h=u*a*t,f=h*s+s,m=Math.pow(a,2)*Math.pow(u,2)*t,b=Math.exp(-h),x=db(Math.pow(u,2),a);return(-i(u)+dg>0?-1:1)*((f-m)*b)/x}):(i=u=>{const d=Math.exp(-u*t),h=(u-s)*t+1;return-dg+d*h},r=u=>{const d=Math.exp(-u*t),h=(s-u)*(t*t);return d*h});const l=5/t,c=cq(i,r,l);if(t=li(t),isNaN(c))return{stiffness:Ct.stiffness,damping:Ct.damping,duration:t};{const u=Math.pow(c,2)*n;return{stiffness:u,damping:a*2*Math.sqrt(n*u),duration:t}}}const lq=12;function cq(t,e,s){let n=s;for(let i=1;i<lq;i++)n=n-t(n)/e(n);return n}function db(t,e){return t*Math.sqrt(1-e*e)}const uq=["duration","bounce"],dq=["stiffness","damping","mass"];function KN(t,e){return e.some(s=>t[s]!==void 0)}function hq(t){let e={velocity:Ct.velocity,stiffness:Ct.stiffness,damping:Ct.damping,mass:Ct.mass,isResolvedFromDuration:!1,...t};if(!KN(t,dq)&&KN(t,uq))if(t.visualDuration){const s=t.visualDuration,n=2*Math.PI/(s*1.2),i=n*n,r=2*rr(.05,1,1-(t.bounce||0))*Math.sqrt(i);e={...e,mass:Ct.mass,stiffness:i,damping:r}}else{const s=oq(t);e={...e,...s,mass:Ct.mass},e.isResolvedFromDuration=!0}return e}function Bm(t=Ct.visualDuration,e=Ct.bounce){const s=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:n,restDelta:i}=s;const r=s.keyframes[0],a=s.keyframes[s.keyframes.length-1],l={done:!1,value:r},{stiffness:c,damping:u,mass:d,duration:h,velocity:f,isResolvedFromDuration:m}=hq({...s,velocity:-vn(s.velocity||0)}),b=f||0,x=u/(2*Math.sqrt(c*d)),v=a-r,g=vn(Math.sqrt(c/d)),p=Math.abs(v)<5;n||(n=p?Ct.restSpeed.granular:Ct.restSpeed.default),i||(i=p?Ct.restDelta.granular:Ct.restDelta.default);let y;if(x<1){const w=db(g,x);y=S=>{const _=Math.exp(-x*g*S);return a-_*((b+x*g*v)/w*Math.sin(w*S)+v*Math.cos(w*S))}}else if(x===1)y=w=>a-Math.exp(-g*w)*(v+(b+g*v)*w);else{const w=g*Math.sqrt(x*x-1);y=S=>{const _=Math.exp(-x*g*S),T=Math.min(w*S,300);return a-_*((b+x*g*v)*Math.sinh(T)+w*v*Math.cosh(T))/w}}const k={calculatedDuration:m&&h||null,next:w=>{const S=y(w);if(m)l.done=w>=h;else{let _=w===0?b:0;x<1&&(_=w===0?li(b):HR(y,w,S));const T=Math.abs(_)<=n,E=Math.abs(a-S)<=i;l.done=T&&E}return l.value=l.done?a:S,l},toString:()=>{const w=Math.min(H_(k),Vm),S=$R(_=>k.next(w*_).value,w,30);return w+"ms "+S},toTransition:()=>{}};return k}Bm.applyToOptions=t=>{const e=rq(t,100,Bm);return t.ease=e.ease,t.duration=li(e.duration),t.type="keyframes",t};function hb({keyframes:t,velocity:e=0,power:s=.8,timeConstant:n=325,bounceDamping:i=10,bounceStiffness:r=500,modifyTarget:a,min:l,max:c,restDelta:u=.5,restSpeed:d}){const h=t[0],f={done:!1,value:h},m=T=>l!==void 0&&T<l||c!==void 0&&T>c,b=T=>l===void 0?c:c===void 0||Math.abs(l-T)<Math.abs(c-T)?l:c;let x=s*e;const v=h+x,g=a===void 0?v:a(v);g!==v&&(x=g-h);const p=T=>-x*Math.exp(-T/n),y=T=>g+p(T),k=T=>{const E=p(T),A=y(T);f.done=Math.abs(E)<=u,f.value=f.done?g:A};let w,S;const _=T=>{m(f.value)&&(w=T,S=Bm({keyframes:[f.value,b(f.value)],velocity:HR(y,T,f.value),damping:i,stiffness:r,restDelta:u,restSpeed:d}))};return _(0),{calculatedDuration:null,next:T=>{let E=!1;return!S&&w===void 0&&(E=!0,k(T),_(T)),w!==void 0&&T>=w?S.next(T-w):(!E&&k(T),f)}}}function fq(t,e,s){const n=[],i=s||ar.mix||UR,r=t.length-1;for(let a=0;a<r;a++){let l=i(t[a],t[a+1]);if(e){const c=Array.isArray(e)?e[a]||Tn:e;l=ah(c,l)}n.push(l)}return n}function mq(t,e,{clamp:s=!0,ease:n,mixer:i}={}){const r=t.length;if(M_(r===e.length),r===1)return()=>e[0];if(r===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[r-1]&&(t=[...t].reverse(),e=[...e].reverse());const l=fq(e,n,i),c=l.length,u=d=>{if(a&&d<t[0])return e[0];let h=0;if(c>1)for(;h<t.length-2&&!(d<t[h+1]);h++);const f=cd(t[h],t[h+1],d);return l[h](f)};return s?d=>u(rr(t[0],t[r-1],d)):u}function pq(t,e){const s=t[t.length-1];for(let n=1;n<=e;n++){const i=cd(0,e,n);t.push(St(s,1,i))}}function gq(t){const e=[0];return pq(e,t.length-1),e}function xq(t,e){return t.map(s=>s*e)}function bq(t,e){return t.map(()=>e||CR).splice(0,t.length-1)}function Tu({duration:t=300,keyframes:e,times:s,ease:n="easeInOut"}){const i=j7(n)?n.map($N):$N(n),r={done:!1,value:e[0]},a=xq(s&&s.length===e.length?s:gq(e),t),l=mq(a,e,{ease:Array.isArray(i)?i:bq(e,i)});return{calculatedDuration:t,next:c=>(r.value=l(c),r.done=c>=t,r)}}const vq=t=>t!==null;function G_(t,{repeat:e,repeatType:s="loop"},n,i=1){const r=t.filter(vq),l=i<0||e&&s!=="loop"&&e%2===1?0:r.length-1;return!l||n===void 0?r[l]:n}const yq={decay:hb,inertia:hb,tween:Tu,keyframes:Tu,spring:Bm};function GR(t){typeof t.type=="string"&&(t.type=yq[t.type])}class z_{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,s){return this.finished.then(e,s)}}const _q=t=>t/100;class q_ extends z_{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var n,i;const{motionValue:s}=this.options;s&&s.updatedAt!==Ps.now()&&this.tick(Ps.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(i=(n=this.options).onStop)==null||i.call(n))},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;GR(e);const{type:s=Tu,repeat:n=0,repeatDelay:i=0,repeatType:r,velocity:a=0}=e;let{keyframes:l}=e;const c=s||Tu;c!==Tu&&typeof l[0]!="number"&&(this.mixKeyframes=ah(_q,UR(l[0],l[1])),l=[0,100]);const u=c({...e,keyframes:l});r==="mirror"&&(this.mirroredGenerator=c({...e,keyframes:[...l].reverse(),velocity:-a})),u.calculatedDuration===null&&(u.calculatedDuration=H_(u));const{calculatedDuration:d}=u;this.calculatedDuration=d,this.resolvedDuration=d+i,this.totalDuration=this.resolvedDuration*(n+1)-i,this.generator=u}updateTime(e){const s=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=s}tick(e,s=!1){const{generator:n,totalDuration:i,mixKeyframes:r,mirroredGenerator:a,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return n.next(0);const{delay:u=0,keyframes:d,repeat:h,repeatType:f,repeatDelay:m,type:b,onUpdate:x,finalKeyframe:v}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-i/this.speed,this.startTime)),s?this.currentTime=e:this.updateTime(e);const g=this.currentTime-u*(this.playbackSpeed>=0?1:-1),p=this.playbackSpeed>=0?g<0:g>i;this.currentTime=Math.max(g,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=i);let y=this.currentTime,k=n;if(h){const T=Math.min(this.currentTime,i)/l;let E=Math.floor(T),A=T%1;!A&&T>=1&&(A=1),A===1&&E--,E=Math.min(E,h+1),!!(E%2)&&(f==="reverse"?(A=1-A,m&&(A-=m/l)):f==="mirror"&&(k=a)),y=rr(0,1,A)*l}const w=p?{done:!1,value:d[0]}:k.next(y);r&&(w.value=r(w.value));let{done:S}=w;!p&&c!==null&&(S=this.playbackSpeed>=0?this.currentTime>=i:this.currentTime<=0);const _=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&S);return _&&b!==hb&&(w.value=G_(d,this.options,v,this.speed)),x&&x(w.value),_&&this.finish(),w}then(e,s){return this.finished.then(e,s)}get duration(){return vn(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+vn(e)}get time(){return vn(this.currentTime)}set time(e){var s;e=li(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),(s=this.driver)==null||s.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Ps.now());const s=this.playbackSpeed!==e;this.playbackSpeed=e,s&&(this.time=vn(this.currentTime))}play(){var i,r;if(this.isStopped)return;const{driver:e=iq,startTime:s}=this.options;this.driver||(this.driver=e(a=>this.tick(a))),(r=(i=this.options).onPlay)==null||r.call(i);const n=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=n):this.holdTime!==null?this.startTime=n-this.holdTime:this.startTime||(this.startTime=s??n),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Ps.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var e,s;this.notifyFinished(),this.teardown(),this.state="finished",(s=(e=this.options).onComplete)==null||s.call(e)}cancel(){var e,s;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(s=(e=this.options).onCancel)==null||s.call(e)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){var s;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(s=this.driver)==null||s.stop(),e.observe(this)}}function wq(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Ka=t=>t*180/Math.PI,fb=t=>{const e=Ka(Math.atan2(t[1],t[0]));return mb(e)},kq={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:fb,rotateZ:fb,skewX:t=>Ka(Math.atan(t[1])),skewY:t=>Ka(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},mb=t=>(t=t%360,t<0&&(t+=360),t),WN=fb,YN=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),XN=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),Nq={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:YN,scaleY:XN,scale:t=>(YN(t)+XN(t))/2,rotateX:t=>mb(Ka(Math.atan2(t[6],t[5]))),rotateY:t=>mb(Ka(Math.atan2(-t[2],t[0]))),rotateZ:WN,rotate:WN,skewX:t=>Ka(Math.atan(t[4])),skewY:t=>Ka(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function pb(t){return t.includes("scale")?1:0}function gb(t,e){if(!t||t==="none")return pb(e);const s=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let n,i;if(s)n=Nq,i=s;else{const l=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);n=kq,i=l}if(!i)return pb(e);const r=n[e],a=i[1].split(",").map(Tq);return typeof r=="function"?r(a):a[r]}const Sq=(t,e)=>{const{transform:s="none"}=getComputedStyle(t);return gb(s,e)};function Tq(t){return parseFloat(t.trim())}const jc=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Cc=new Set(jc),QN=t=>t===Ac||t===xe,Eq=new Set(["x","y","z"]),Aq=jc.filter(t=>!Eq.has(t));function jq(t){const e=[];return Aq.forEach(s=>{const n=t.getValue(s);n!==void 0&&(e.push([s,n.get()]),n.set(s.startsWith("scale")?1:0))}),e}const so={width:({x:t},{paddingLeft:e="0",paddingRight:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),height:({y:t},{paddingTop:e="0",paddingBottom:s="0"})=>t.max-t.min-parseFloat(e)-parseFloat(s),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>gb(e,"x"),y:(t,{transform:e})=>gb(e,"y")};so.translateX=so.x;so.translateY=so.y;const no=new Set;let xb=!1,bb=!1,vb=!1;function zR(){if(bb){const t=Array.from(no).filter(n=>n.needsMeasurement),e=new Set(t.map(n=>n.element)),s=new Map;e.forEach(n=>{const i=jq(n);i.length&&(s.set(n,i),n.render())}),t.forEach(n=>n.measureInitialState()),e.forEach(n=>{n.render();const i=s.get(n);i&&i.forEach(([r,a])=>{var l;(l=n.getValue(r))==null||l.set(a)})}),t.forEach(n=>n.measureEndState()),t.forEach(n=>{n.suspendedScrollY!==void 0&&window.scrollTo(0,n.suspendedScrollY)})}bb=!1,xb=!1,no.forEach(t=>t.complete(vb)),no.clear()}function qR(){no.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(bb=!0)})}function Cq(){vb=!0,qR(),zR(),vb=!1}class K_{constructor(e,s,n,i,r,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=s,this.name=n,this.motionValue=i,this.element=r,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(no.add(this),xb||(xb=!0,_t.read(qR),_t.resolveKeyframes(zR))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:s,element:n,motionValue:i}=this;if(e[0]===null){const r=i==null?void 0:i.get(),a=e[e.length-1];if(r!==void 0)e[0]=r;else if(n&&s){const l=n.readValue(s,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),i&&r===void 0&&i.set(e[0])}wq(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),no.delete(this)}cancel(){this.state==="scheduled"&&(no.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Rq=t=>t.startsWith("--");function Iq(t,e,s){Rq(e)?t.style.setProperty(e,s):t.style[e]=s}const Oq=D_(()=>window.ScrollTimeline!==void 0),Mq={};function Dq(t,e){const s=D_(t);return()=>Mq[e]??s()}const KR=Dq(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),tu=([t,e,s,n])=>`cubic-bezier(${t}, ${e}, ${s}, ${n})`,JN={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:tu([0,.65,.55,1]),circOut:tu([.55,0,1,.45]),backIn:tu([.31,.01,.66,-.59]),backOut:tu([.33,1.53,.69,.99])};function WR(t,e){if(t)return typeof t=="function"?KR()?$R(t,e):"ease-out":RR(t)?tu(t):Array.isArray(t)?t.map(s=>WR(s,e)||JN.easeOut):JN[t]}function Lq(t,e,s,{delay:n=0,duration:i=300,repeat:r=0,repeatType:a="loop",ease:l="easeOut",times:c}={},u=void 0){const d={[e]:s};c&&(d.offset=c);const h=WR(l,i);Array.isArray(h)&&(d.easing=h);const f={delay:n,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:r+1,direction:a==="reverse"?"alternate":"normal"};return u&&(f.pseudoElement=u),t.animate(d,f)}function YR(t){return typeof t=="function"&&"applyToOptions"in t}function Pq({type:t,...e}){return YR(t)&&KR()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class Vq extends z_{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:s,name:n,keyframes:i,pseudoElement:r,allowFlatten:a=!1,finalKeyframe:l,onComplete:c}=e;this.isPseudoElement=!!r,this.allowFlatten=a,this.options=e,M_(typeof e.type!="string");const u=Pq(e);this.animation=Lq(s,n,i,u,r),u.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const d=G_(i,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(d):Iq(s,n,d),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var e,s;(s=(e=this.animation).finish)==null||s.call(e)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var e,s;this.isPseudoElement||(s=(e=this.animation).commitStyles)==null||s.call(e)}get duration(){var s,n;const e=((n=(s=this.animation.effect)==null?void 0:s.getComputedTiming)==null?void 0:n.call(s).duration)||0;return vn(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+vn(e)}get time(){return vn(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=li(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:s}){var n;return this.allowFlatten&&((n=this.animation.effect)==null||n.updateTiming({easing:"linear"})),this.animation.onfinish=null,e&&Oq()?(this.animation.timeline=e,Tn):s(this)}}const XR={anticipate:ER,backInOut:TR,circInOut:jR};function Bq(t){return t in XR}function Fq(t){typeof t.ease=="string"&&Bq(t.ease)&&(t.ease=XR[t.ease])}const ZN=10;class Uq extends Vq{constructor(e){Fq(e),GR(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:s,onUpdate:n,onComplete:i,element:r,...a}=this.options;if(!s)return;if(e!==void 0){s.set(e);return}const l=new q_({...a,autoplay:!1}),c=li(this.finishedTime??this.time);s.setWithVelocity(l.sample(c-ZN).value,l.sample(c).value,ZN),l.stop()}}const eS=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(ya.test(t)||t==="0")&&!t.startsWith("url("));function $q(t){const e=t[0];if(t.length===1)return!0;for(let s=0;s<t.length;s++)if(t[s]!==e)return!0}function Hq(t,e,s,n){const i=t[0];if(i===null)return!1;if(e==="display"||e==="visibility")return!0;const r=t[t.length-1],a=eS(i,e),l=eS(r,e);return!a||!l?!1:$q(t)||(s==="spring"||YR(s))&&n}function yb(t){t.duration=0,t.type="keyframes"}const Gq=new Set(["opacity","clipPath","filter","transform"]),zq=D_(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function qq(t){var d;const{motionValue:e,name:s,repeatDelay:n,repeatType:i,damping:r,type:a}=t;if(!(((d=e==null?void 0:e.owner)==null?void 0:d.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:u}=e.owner.getProps();return zq()&&s&&Gq.has(s)&&(s!=="transform"||!u)&&!c&&!n&&i!=="mirror"&&r!==0&&a!=="inertia"}const Kq=40;class Wq extends z_{constructor({autoplay:e=!0,delay:s=0,type:n="keyframes",repeat:i=0,repeatDelay:r=0,repeatType:a="loop",keyframes:l,name:c,motionValue:u,element:d,...h}){var b;super(),this.stop=()=>{var x,v;this._animation&&(this._animation.stop(),(x=this.stopTimeline)==null||x.call(this)),(v=this.keyframeResolver)==null||v.cancel()},this.createdAt=Ps.now();const f={autoplay:e,delay:s,type:n,repeat:i,repeatDelay:r,repeatType:a,name:c,motionValue:u,element:d,...h},m=(d==null?void 0:d.KeyframeResolver)||K_;this.keyframeResolver=new m(l,(x,v,g)=>this.onKeyframesResolved(x,v,f,!g),c,u,d),(b=this.keyframeResolver)==null||b.scheduleResolve()}onKeyframesResolved(e,s,n,i){this.keyframeResolver=void 0;const{name:r,type:a,velocity:l,delay:c,isHandoff:u,onUpdate:d}=n;this.resolvedAt=Ps.now(),Hq(e,r,a,l)||((ar.instantAnimations||!c)&&(d==null||d(G_(e,n,s))),e[0]=e[e.length-1],yb(n),n.repeat=0);const f={startTime:i?this.resolvedAt?this.resolvedAt-this.createdAt>Kq?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:s,...n,keyframes:e},m=!u&&qq(f)?new Uq({...f,element:f.motionValue.owner.current}):new q_(f);m.finished.then(()=>this.notifyFinished()).catch(Tn),this.pendingTimeline&&(this.stopTimeline=m.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=m}get finished(){return this._animation?this.animation.finished:this._finished}then(e,s){return this.finished.finally(e).then(()=>{})}get animation(){var e;return this._animation||((e=this.keyframeResolver)==null||e.resume(),Cq()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var e;this._animation&&this.animation.cancel(),(e=this.keyframeResolver)==null||e.cancel()}}const Yq=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Xq(t){const e=Yq.exec(t);if(!e)return[,];const[,s,n,i]=e;return[`--${s??n}`,i]}function QR(t,e,s=1){const[n,i]=Xq(t);if(!n)return;const r=window.getComputedStyle(e).getPropertyValue(n);if(r){const a=r.trim();return bR(a)?parseFloat(a):a}return B_(i)?QR(i,e,s+1):i}function W_(t,e){return(t==null?void 0:t[e])??(t==null?void 0:t.default)??t}const JR=new Set(["width","height","top","left","right","bottom",...jc]),Qq={test:t=>t==="auto",parse:t=>t},ZR=t=>e=>e.test(t),eI=[Ac,xe,ci,vr,$7,U7,Qq],tS=t=>eI.find(ZR(t));function Jq(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||yR(t):!0}const Zq=new Set(["brightness","contrast","saturate","opacity"]);function eK(t){const[e,s]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[n]=s.match(F_)||[];if(!n)return t;const i=s.replace(n,"");let r=Zq.has(e)?1:0;return n!==s&&(r*=100),e+"("+r+i+")"}const tK=/\b([a-z-]*)\(.*?\)/gu,_b={...ya,getAnimatableNone:t=>{const e=t.match(tK);return e?e.map(eK).join(" "):t}},sS={...Ac,transform:Math.round},sK={rotate:vr,rotateX:vr,rotateY:vr,rotateZ:vr,scale:Ph,scaleX:Ph,scaleY:Ph,scaleZ:Ph,skew:vr,skewX:vr,skewY:vr,distance:xe,translateX:xe,translateY:xe,translateZ:xe,x:xe,y:xe,z:xe,perspective:xe,transformPerspective:xe,opacity:ud,originX:HN,originY:HN,originZ:xe},Y_={borderWidth:xe,borderTopWidth:xe,borderRightWidth:xe,borderBottomWidth:xe,borderLeftWidth:xe,borderRadius:xe,radius:xe,borderTopLeftRadius:xe,borderTopRightRadius:xe,borderBottomRightRadius:xe,borderBottomLeftRadius:xe,width:xe,maxWidth:xe,height:xe,maxHeight:xe,top:xe,right:xe,bottom:xe,left:xe,padding:xe,paddingTop:xe,paddingRight:xe,paddingBottom:xe,paddingLeft:xe,margin:xe,marginTop:xe,marginRight:xe,marginBottom:xe,marginLeft:xe,backgroundPositionX:xe,backgroundPositionY:xe,...sK,zIndex:sS,fillOpacity:ud,strokeOpacity:ud,numOctaves:sS},nK={...Y_,color:Ft,backgroundColor:Ft,outlineColor:Ft,fill:Ft,stroke:Ft,borderColor:Ft,borderTopColor:Ft,borderRightColor:Ft,borderBottomColor:Ft,borderLeftColor:Ft,filter:_b,WebkitFilter:_b},tI=t=>nK[t];function sI(t,e){let s=tI(t);return s!==_b&&(s=ya),s.getAnimatableNone?s.getAnimatableNone(e):void 0}const iK=new Set(["auto","none","0"]);function rK(t,e,s){let n=0,i;for(;n<t.length&&!i;){const r=t[n];typeof r=="string"&&!iK.has(r)&&dd(r).values.length&&(i=t[n]),n++}if(i&&s)for(const r of e)t[r]=sI(s,i)}class aK extends K_{constructor(e,s,n,i,r){super(e,s,n,i,r,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:s,name:n}=this;if(!s||!s.current)return;super.readKeyframes();for(let c=0;c<e.length;c++){let u=e[c];if(typeof u=="string"&&(u=u.trim(),B_(u))){const d=QR(u,s.current);d!==void 0&&(e[c]=d),c===e.length-1&&(this.finalKeyframe=u)}}if(this.resolveNoneKeyframes(),!JR.has(n)||e.length!==2)return;const[i,r]=e,a=tS(i),l=tS(r);if(a!==l)if(QN(a)&&QN(l))for(let c=0;c<e.length;c++){const u=e[c];typeof u=="string"&&(e[c]=parseFloat(u))}else so[n]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:s}=this,n=[];for(let i=0;i<e.length;i++)(e[i]===null||Jq(e[i]))&&n.push(i);n.length&&rK(e,n,s)}measureInitialState(){const{element:e,unresolvedKeyframes:s,name:n}=this;if(!e||!e.current)return;n==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=so[n](e.measureViewportBox(),window.getComputedStyle(e.current)),s[0]=this.measuredOrigin;const i=s[s.length-1];i!==void 0&&e.getValue(n,i).jump(i,!1)}measureEndState(){var l;const{element:e,name:s,unresolvedKeyframes:n}=this;if(!e||!e.current)return;const i=e.getValue(s);i&&i.jump(this.measuredOrigin,!1);const r=n.length-1,a=n[r];n[r]=so[s](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,u])=>{e.getValue(c).set(u)}),this.resolveNoneKeyframes()}}function oK(t,e,s){if(t instanceof EventTarget)return[t];if(typeof t=="string"){let n=document;const i=(s==null?void 0:s[t])??n.querySelectorAll(t);return i?Array.from(i):[]}return Array.from(t)}const nI=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function iI(t){return vR(t)&&"offsetHeight"in t}const nS=30,lK=t=>!isNaN(parseFloat(t));class cK{constructor(e,s={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{var r;const i=Ps.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&((r=this.events.change)==null||r.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=s.owner}setCurrent(e){this.current=e,this.updatedAt=Ps.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=lK(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,s){this.events[e]||(this.events[e]=new L_);const n=this.events[e].add(s);return e==="change"?()=>{n(),_t.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,s){this.passiveEffect=e,this.stopPassiveEffect=s}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,s,n){this.set(s),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,s=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var e;(e=this.events.change)==null||e.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=Ps.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>nS)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,nS);return _R(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(e){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=e(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var e,s;(e=this.dependents)==null||e.clear(),(s=this.events.destroy)==null||s.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Zl(t,e){return new cK(t,e)}const{schedule:X_}=IR(queueMicrotask,!1),In={x:!1,y:!1};function rI(){return In.x||In.y}function uK(t){return t==="x"||t==="y"?In[t]?null:(In[t]=!0,()=>{In[t]=!1}):In.x||In.y?null:(In.x=In.y=!0,()=>{In.x=In.y=!1})}function aI(t,e){const s=oK(t),n=new AbortController,i={passive:!0,...e,signal:n.signal};return[s,i,()=>n.abort()]}function iS(t){return!(t.pointerType==="touch"||rI())}function dK(t,e,s={}){const[n,i,r]=aI(t,s),a=l=>{if(!iS(l))return;const{target:c}=l,u=e(c,l);if(typeof u!="function"||!c)return;const d=h=>{iS(h)&&(u(h),c.removeEventListener("pointerleave",d))};c.addEventListener("pointerleave",d,i)};return n.forEach(l=>{l.addEventListener("pointerenter",a,i)}),r}const oI=(t,e)=>e?t===e?!0:oI(t,e.parentElement):!1,Q_=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,hK=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function fK(t){return hK.has(t.tagName)||t.tabIndex!==-1}const mf=new WeakSet;function rS(t){return e=>{e.key==="Enter"&&t(e)}}function hg(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const mK=(t,e)=>{const s=t.currentTarget;if(!s)return;const n=rS(()=>{if(mf.has(s))return;hg(s,"down");const i=rS(()=>{hg(s,"up")}),r=()=>hg(s,"cancel");s.addEventListener("keyup",i,e),s.addEventListener("blur",r,e)});s.addEventListener("keydown",n,e),s.addEventListener("blur",()=>s.removeEventListener("keydown",n),e)};function aS(t){return Q_(t)&&!rI()}function pK(t,e,s={}){const[n,i,r]=aI(t,s),a=l=>{const c=l.currentTarget;if(!aS(l))return;mf.add(c);const u=e(c,l),d=(m,b)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",f),mf.has(c)&&mf.delete(c),aS(m)&&typeof u=="function"&&u(m,{success:b})},h=m=>{d(m,c===window||c===document||s.useGlobalTarget||oI(c,m.target))},f=m=>{d(m,!1)};window.addEventListener("pointerup",h,i),window.addEventListener("pointercancel",f,i)};return n.forEach(l=>{(s.useGlobalTarget?window:l).addEventListener("pointerdown",a,i),iI(l)&&(l.addEventListener("focus",u=>mK(u,i)),!fK(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),r}function lI(t){return vR(t)&&"ownerSVGElement"in t}function gK(t){return lI(t)&&t.tagName==="svg"}const bs=t=>!!(t&&t.getVelocity),xK=[...eI,Ft,ya],bK=t=>xK.find(ZR(t)),J_=N.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function oS(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function vK(...t){return e=>{let s=!1;const n=t.map(i=>{const r=oS(i,e);return!s&&typeof r=="function"&&(s=!0),r});if(s)return()=>{for(let i=0;i<n.length;i++){const r=n[i];typeof r=="function"?r():oS(t[i],null)}}}}function yK(...t){return N.useCallback(vK(...t),t)}class _K extends N.Component{getSnapshotBeforeUpdate(e){const s=this.props.childRef.current;if(s&&e.isPresent&&!this.props.isPresent){const n=s.offsetParent,i=iI(n)&&n.offsetWidth||0,r=this.props.sizeRef.current;r.height=s.offsetHeight||0,r.width=s.offsetWidth||0,r.top=s.offsetTop,r.left=s.offsetLeft,r.right=i-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function wK({children:t,isPresent:e,anchorX:s,root:n}){const i=N.useId(),r=N.useRef(null),a=N.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=N.useContext(J_),c=yK(r,t==null?void 0:t.ref);return N.useInsertionEffect(()=>{const{width:u,height:d,top:h,left:f,right:m}=a.current;if(e||!r.current||!u||!d)return;const b=s==="left"?`left: ${f}`:`right: ${m}`;r.current.dataset.motionPopId=i;const x=document.createElement("style");l&&(x.nonce=l);const v=n??document.head;return v.appendChild(x),x.sheet&&x.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${d}px !important;
            ${b}px !important;
            top: ${h}px !important;
          }
        `),()=>{v.contains(x)&&v.removeChild(x)}},[e]),o.jsx(_K,{isPresent:e,childRef:r,sizeRef:a,children:N.cloneElement(t,{ref:c})})}const kK=({children:t,initial:e,isPresent:s,onExitComplete:n,custom:i,presenceAffectsLayout:r,mode:a,anchorX:l,root:c})=>{const u=C_(NK),d=N.useId();let h=!0,f=N.useMemo(()=>(h=!1,{id:d,initial:e,isPresent:s,custom:i,onExitComplete:m=>{u.set(m,!0);for(const b of u.values())if(!b)return;n&&n()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[s,u,n]);return r&&h&&(f={...f}),N.useMemo(()=>{u.forEach((m,b)=>u.set(b,!1))},[s]),N.useEffect(()=>{!s&&!u.size&&n&&n()},[s]),a==="popLayout"&&(t=o.jsx(wK,{isPresent:s,anchorX:l,root:c,children:t})),o.jsx(e0.Provider,{value:f,children:t})};function NK(){return new Map}function cI(t=!0){const e=N.useContext(e0);if(e===null)return[!0,null];const{isPresent:s,onExitComplete:n,register:i}=e,r=N.useId();N.useEffect(()=>{if(t)return i(r)},[t]);const a=N.useCallback(()=>t&&n&&n(r),[r,n,t]);return!s&&n?[!1,a]:[!0]}const Vh=t=>t.key||"";function lS(t){const e=[];return N.Children.forEach(t,s=>{N.isValidElement(s)&&e.push(s)}),e}const qt=({children:t,custom:e,initial:s=!0,onExitComplete:n,presenceAffectsLayout:i=!0,mode:r="sync",propagate:a=!1,anchorX:l="left",root:c})=>{const[u,d]=cI(a),h=N.useMemo(()=>lS(t),[t]),f=a&&!u?[]:h.map(Vh),m=N.useRef(!0),b=N.useRef(h),x=C_(()=>new Map),[v,g]=N.useState(h),[p,y]=N.useState(h);xR(()=>{m.current=!1,b.current=h;for(let S=0;S<p.length;S++){const _=Vh(p[S]);f.includes(_)?x.delete(_):x.get(_)!==!0&&x.set(_,!1)}},[p,f.length,f.join("-")]);const k=[];if(h!==v){let S=[...h];for(let _=0;_<p.length;_++){const T=p[_],E=Vh(T);f.includes(E)||(S.splice(_,0,T),k.push(T))}return r==="wait"&&k.length&&(S=k),y(lS(S)),g(h),null}const{forceRender:w}=N.useContext(j_);return o.jsx(o.Fragment,{children:p.map(S=>{const _=Vh(S),T=a&&!u?!1:h===p||f.includes(_),E=()=>{if(x.has(_))x.set(_,!0);else return;let A=!0;x.forEach(j=>{j||(A=!1)}),A&&(w==null||w(),y(b.current),a&&(d==null||d()),n&&n())};return o.jsx(kK,{isPresent:T,initial:!m.current||s?void 0:!1,custom:e,presenceAffectsLayout:i,mode:r,root:c,onExitComplete:T?void 0:E,anchorX:l,children:S},_)})})},uI=N.createContext({strict:!1}),cS={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ec={};for(const t in cS)ec[t]={isEnabled:e=>cS[t].some(s=>!!e[s])};function SK(t){for(const e in t)ec[e]={...ec[e],...t[e]}}const TK=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Fm(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||TK.has(t)}let dI=t=>!Fm(t);function EK(t){typeof t=="function"&&(dI=e=>e.startsWith("on")?!Fm(e):t(e))}try{EK(require("@emotion/is-prop-valid").default)}catch{}function AK(t,e,s){const n={};for(const i in t)i==="values"&&typeof t.values=="object"||(dI(i)||s===!0&&Fm(i)||!e&&!Fm(i)||t.draggable&&i.startsWith("onDrag"))&&(n[i]=t[i]);return n}const t0=N.createContext({});function s0(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function hd(t){return typeof t=="string"||Array.isArray(t)}const Z_=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],e1=["initial",...Z_];function n0(t){return s0(t.animate)||e1.some(e=>hd(t[e]))}function hI(t){return!!(n0(t)||t.variants)}function jK(t,e){if(n0(t)){const{initial:s,animate:n}=t;return{initial:s===!1||hd(s)?s:void 0,animate:hd(n)?n:void 0}}return t.inherit!==!1?e:{}}function CK(t){const{initial:e,animate:s}=jK(t,N.useContext(t0));return N.useMemo(()=>({initial:e,animate:s}),[uS(e),uS(s)])}function uS(t){return Array.isArray(t)?t.join(" "):t}function dS(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const qc={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(xe.test(t))t=parseFloat(t);else return t;const s=dS(t,e.target.x),n=dS(t,e.target.y);return`${s}% ${n}%`}},RK={correct:(t,{treeScale:e,projectionDelta:s})=>{const n=t,i=ya.parse(t);if(i.length>5)return n;const r=ya.createTransformer(t),a=typeof i[0]!="number"?1:0,l=s.x.scale*e.x,c=s.y.scale*e.y;i[0+a]/=l,i[1+a]/=c;const u=St(l,c,.5);return typeof i[2+a]=="number"&&(i[2+a]/=u),typeof i[3+a]=="number"&&(i[3+a]/=u),r(i)}},wb={borderRadius:{...qc,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:qc,borderTopRightRadius:qc,borderBottomLeftRadius:qc,borderBottomRightRadius:qc,boxShadow:RK};function fI(t,{layout:e,layoutId:s}){return Cc.has(t)||t.startsWith("origin")||(e||s!==void 0)&&(!!wb[t]||t==="opacity")}const IK={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},OK=jc.length;function MK(t,e,s){let n="",i=!0;for(let r=0;r<OK;r++){const a=jc[r],l=t[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||s){const u=nI(l,Y_[a]);if(!c){i=!1;const d=IK[a]||a;n+=`${d}(${u}) `}s&&(e[a]=u)}}return n=n.trim(),s?n=s(e,i?"":n):i&&(n="none"),n}function t1(t,e,s){const{style:n,vars:i,transformOrigin:r}=t;let a=!1,l=!1;for(const c in e){const u=e[c];if(Cc.has(c)){a=!0;continue}else if(MR(c)){i[c]=u;continue}else{const d=nI(u,Y_[c]);c.startsWith("origin")?(l=!0,r[c]=d):n[c]=d}}if(e.transform||(a||s?n.transform=MK(e,t.transform,s):n.transform&&(n.transform="none")),l){const{originX:c="50%",originY:u="50%",originZ:d=0}=r;n.transformOrigin=`${c} ${u} ${d}`}}const s1=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function mI(t,e,s){for(const n in e)!bs(e[n])&&!fI(n,s)&&(t[n]=e[n])}function DK({transformTemplate:t},e){return N.useMemo(()=>{const s=s1();return t1(s,e,t),Object.assign({},s.vars,s.style)},[e])}function LK(t,e){const s=t.style||{},n={};return mI(n,s,t),Object.assign(n,DK(t,e)),n}function PK(t,e){const s={},n=LK(t,e);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=n,s}const VK={offset:"stroke-dashoffset",array:"stroke-dasharray"},BK={offset:"strokeDashoffset",array:"strokeDasharray"};function FK(t,e,s=1,n=0,i=!0){t.pathLength=1;const r=i?VK:BK;t[r.offset]=xe.transform(-n);const a=xe.transform(e),l=xe.transform(s);t[r.array]=`${a} ${l}`}function pI(t,{attrX:e,attrY:s,attrScale:n,pathLength:i,pathSpacing:r=1,pathOffset:a=0,...l},c,u,d){if(t1(t,l,u),c){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:f}=t;h.transform&&(f.transform=h.transform,delete h.transform),(f.transform||h.transformOrigin)&&(f.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),f.transform&&(f.transformBox=(d==null?void 0:d.transformBox)??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),s!==void 0&&(h.y=s),n!==void 0&&(h.scale=n),i!==void 0&&FK(h,i,r,a,!1)}const gI=()=>({...s1(),attrs:{}}),xI=t=>typeof t=="string"&&t.toLowerCase()==="svg";function UK(t,e,s,n){const i=N.useMemo(()=>{const r=gI();return pI(r,e,xI(n),t.transformTemplate,t.style),{...r.attrs,style:{...r.style}}},[e]);if(t.style){const r={};mI(r,t.style,t),i.style={...r,...i.style}}return i}const $K=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function n1(t){return typeof t!="string"||t.includes("-")?!1:!!($K.indexOf(t)>-1||/[A-Z]/u.test(t))}function HK(t,e,s,{latestValues:n},i,r=!1){const l=(n1(t)?UK:PK)(e,n,i,t),c=AK(e,typeof t=="string",r),u=t!==N.Fragment?{...c,...l,ref:s}:{},{children:d}=e,h=N.useMemo(()=>bs(d)?d.get():d,[d]);return N.createElement(t,{...u,children:h})}function hS(t){const e=[{},{}];return t==null||t.values.forEach((s,n)=>{e[0][n]=s.get(),e[1][n]=s.getVelocity()}),e}function i1(t,e,s,n){if(typeof e=="function"){const[i,r]=hS(n);e=e(s!==void 0?s:t.custom,i,r)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[i,r]=hS(n);e=e(s!==void 0?s:t.custom,i,r)}return e}function pf(t){return bs(t)?t.get():t}function GK({scrapeMotionValuesFromProps:t,createRenderState:e},s,n,i){return{latestValues:zK(s,n,i,t),renderState:e()}}function zK(t,e,s,n){const i={},r=n(t,{});for(const f in r)i[f]=pf(r[f]);let{initial:a,animate:l}=t;const c=n0(t),u=hI(t);e&&u&&!c&&t.inherit!==!1&&(a===void 0&&(a=e.initial),l===void 0&&(l=e.animate));let d=s?s.initial===!1:!1;d=d||a===!1;const h=d?l:a;if(h&&typeof h!="boolean"&&!s0(h)){const f=Array.isArray(h)?h:[h];for(let m=0;m<f.length;m++){const b=i1(t,f[m]);if(b){const{transitionEnd:x,transition:v,...g}=b;for(const p in g){let y=g[p];if(Array.isArray(y)){const k=d?y.length-1:0;y=y[k]}y!==null&&(i[p]=y)}for(const p in x)i[p]=x[p]}}}return i}const bI=t=>(e,s)=>{const n=N.useContext(t0),i=N.useContext(e0),r=()=>GK(t,e,n,i);return s?r():C_(r)};function r1(t,e,s){var r;const{style:n}=t,i={};for(const a in n)(bs(n[a])||e.style&&bs(e.style[a])||fI(a,t)||((r=s==null?void 0:s.getValue(a))==null?void 0:r.liveStyle)!==void 0)&&(i[a]=n[a]);return i}const qK=bI({scrapeMotionValuesFromProps:r1,createRenderState:s1});function vI(t,e,s){const n=r1(t,e,s);for(const i in t)if(bs(t[i])||bs(e[i])){const r=jc.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;n[r]=t[i]}return n}const KK=bI({scrapeMotionValuesFromProps:vI,createRenderState:gI}),WK=Symbol.for("motionComponentSymbol");function ll(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function YK(t,e,s){return N.useCallback(n=>{n&&t.onMount&&t.onMount(n),e&&(n?e.mount(n):e.unmount()),s&&(typeof s=="function"?s(n):ll(s)&&(s.current=n))},[e])}const a1=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),XK="framerAppearId",yI="data-"+a1(XK),_I=N.createContext({});function QK(t,e,s,n,i){var x,v;const{visualElement:r}=N.useContext(t0),a=N.useContext(uI),l=N.useContext(e0),c=N.useContext(J_).reducedMotion,u=N.useRef(null);n=n||a.renderer,!u.current&&n&&(u.current=n(t,{visualState:e,parent:r,props:s,presenceContext:l,blockInitialAnimation:l?l.initial===!1:!1,reducedMotionConfig:c}));const d=u.current,h=N.useContext(_I);d&&!d.projection&&i&&(d.type==="html"||d.type==="svg")&&JK(u.current,s,i,h);const f=N.useRef(!1);N.useInsertionEffect(()=>{d&&f.current&&d.update(s,l)});const m=s[yI],b=N.useRef(!!m&&!((x=window.MotionHandoffIsComplete)!=null&&x.call(window,m))&&((v=window.MotionHasOptimisedAnimation)==null?void 0:v.call(window,m)));return xR(()=>{d&&(f.current=!0,window.MotionIsMounted=!0,d.updateFeatures(),d.scheduleRenderMicrotask(),b.current&&d.animationState&&d.animationState.animateChanges())}),N.useEffect(()=>{d&&(!b.current&&d.animationState&&d.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var g;(g=window.MotionHandoffMarkAsComplete)==null||g.call(window,m)}),b.current=!1),d.enteringChildren=void 0)}),d}function JK(t,e,s,n){const{layoutId:i,layout:r,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:u,layoutCrossfade:d}=e;t.projection=new s(t.latestValues,e["data-framer-portal-id"]?void 0:wI(t.parent)),t.projection.setOptions({layoutId:i,layout:r,alwaysMeasureLayout:!!a||l&&ll(l),visualElement:t,animationType:typeof r=="string"?r:"both",initialPromotionConfig:n,crossfade:d,layoutScroll:c,layoutRoot:u})}function wI(t){if(t)return t.options.allowProjection!==!1?t.projection:wI(t.parent)}function fg(t,{forwardMotionProps:e=!1}={},s,n){s&&SK(s);const i=n1(t)?KK:qK;function r(l,c){let u;const d={...N.useContext(J_),...l,layoutId:ZK(l)},{isStatic:h}=d,f=CK(l),m=i(l,h);if(!h&&R_){eW();const b=tW(d);u=b.MeasureLayout,f.visualElement=QK(t,m,d,n,b.ProjectionNode)}return o.jsxs(t0.Provider,{value:f,children:[u&&f.visualElement?o.jsx(u,{visualElement:f.visualElement,...d}):null,HK(t,l,YK(m,f.visualElement,c),m,h,e)]})}r.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=N.forwardRef(r);return a[WK]=t,a}function ZK({layoutId:t}){const e=N.useContext(j_).id;return e&&t!==void 0?e+"-"+t:t}function eW(t,e){N.useContext(uI).strict}function tW(t){const{drag:e,layout:s}=ec;if(!e&&!s)return{};const n={...e,...s};return{MeasureLayout:e!=null&&e.isEnabled(t)||s!=null&&s.isEnabled(t)?n.MeasureLayout:void 0,ProjectionNode:n.ProjectionNode}}function sW(t,e){if(typeof Proxy>"u")return fg;const s=new Map,n=(r,a)=>fg(r,a,t,e),i=(r,a)=>n(r,a);return new Proxy(i,{get:(r,a)=>a==="create"?n:(s.has(a)||s.set(a,fg(a,void 0,t,e)),s.get(a))})}function kI({top:t,left:e,right:s,bottom:n}){return{x:{min:e,max:s},y:{min:t,max:n}}}function nW({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function iW(t,e){if(!e)return t;const s=e({x:t.left,y:t.top}),n=e({x:t.right,y:t.bottom});return{top:s.y,left:s.x,bottom:n.y,right:n.x}}function mg(t){return t===void 0||t===1}function kb({scale:t,scaleX:e,scaleY:s}){return!mg(t)||!mg(e)||!mg(s)}function Fa(t){return kb(t)||NI(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function NI(t){return fS(t.x)||fS(t.y)}function fS(t){return t&&t!=="0%"}function Um(t,e,s){const n=t-s,i=e*n;return s+i}function mS(t,e,s,n,i){return i!==void 0&&(t=Um(t,i,n)),Um(t,s,n)+e}function Nb(t,e=0,s=1,n,i){t.min=mS(t.min,e,s,n,i),t.max=mS(t.max,e,s,n,i)}function SI(t,{x:e,y:s}){Nb(t.x,e.translate,e.scale,e.originPoint),Nb(t.y,s.translate,s.scale,s.originPoint)}const pS=.999999999999,gS=1.0000000000001;function rW(t,e,s,n=!1){const i=s.length;if(!i)return;e.x=e.y=1;let r,a;for(let l=0;l<i;l++){r=s[l],a=r.projectionDelta;const{visualElement:c}=r.options;c&&c.props.style&&c.props.style.display==="contents"||(n&&r.options.layoutScroll&&r.scroll&&r!==r.root&&ul(t,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,SI(t,a)),n&&Fa(r.latestValues)&&ul(t,r.latestValues))}e.x<gS&&e.x>pS&&(e.x=1),e.y<gS&&e.y>pS&&(e.y=1)}function cl(t,e){t.min=t.min+e,t.max=t.max+e}function xS(t,e,s,n,i=.5){const r=St(t.min,t.max,i);Nb(t,e,s,r,n)}function ul(t,e){xS(t.x,e.x,e.scaleX,e.scale,e.originX),xS(t.y,e.y,e.scaleY,e.scale,e.originY)}function TI(t,e){return kI(iW(t.getBoundingClientRect(),e))}function aW(t,e,s){const n=TI(t,s),{scroll:i}=e;return i&&(cl(n.x,i.offset.x),cl(n.y,i.offset.y)),n}const bS=()=>({translate:0,scale:1,origin:0,originPoint:0}),dl=()=>({x:bS(),y:bS()}),vS=()=>({min:0,max:0}),Yt=()=>({x:vS(),y:vS()}),Sb={current:null},EI={current:!1};function oW(){if(EI.current=!0,!!R_)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Sb.current=t.matches;t.addEventListener("change",e),e()}else Sb.current=!1}const lW=new WeakMap;function cW(t,e,s){for(const n in e){const i=e[n],r=s[n];if(bs(i))t.addValue(n,i);else if(bs(r))t.addValue(n,Zl(i,{owner:t}));else if(r!==i)if(t.hasValue(n)){const a=t.getValue(n);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=t.getStaticValue(n);t.addValue(n,Zl(a!==void 0?a:i,{owner:t}))}}for(const n in s)e[n]===void 0&&t.removeValue(n);return e}const yS=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class uW{scrapeMotionValuesFromProps(e,s,n){return{}}constructor({parent:e,props:s,presenceContext:n,reducedMotionConfig:i,blockInitialAnimation:r,visualState:a},l={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=K_,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=Ps.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,_t.render(this.render,!1,!0))};const{latestValues:c,renderState:u}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=s.initial?{...c}:{},this.renderState=u,this.parent=e,this.props=s,this.presenceContext=n,this.depth=e?e.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!r,this.isControllingVariants=n0(s),this.isVariantNode=hI(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:d,...h}=this.scrapeMotionValuesFromProps(s,{},this);for(const f in h){const m=h[f];c[f]!==void 0&&bs(m)&&m.set(c[f])}}mount(e){var s;this.current=e,lW.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,i)=>this.bindToMotionValue(i,n)),EI.current||oW(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Sb.current,(s=this.parent)==null||s.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var e;this.projection&&this.projection.unmount(),va(this.notifyUpdate),va(this.render),this.valueSubscriptions.forEach(s=>s()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(e=this.parent)==null||e.removeChild(this);for(const s in this.events)this.events[s].clear();for(const s in this.features){const n=this.features[s];n&&(n.unmount(),n.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,s){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const n=Cc.has(e);n&&this.onBindTransform&&this.onBindTransform();const i=s.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&_t.preRender(this.notifyUpdate),n&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,s)),this.valueSubscriptions.set(e,()=>{i(),r&&r(),s.owner&&s.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in ec){const s=ec[e];if(!s)continue;const{isEnabled:n,Feature:i}=s;if(!this.features[e]&&i&&n(this.props)&&(this.features[e]=new i(this)),this.features[e]){const r=this.features[e];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Yt()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,s){this.latestValues[e]=s}update(e,s){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let n=0;n<yS.length;n++){const i=yS[n];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const r="on"+i,a=e[r];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=cW(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(e),()=>s.variantChildren.delete(e)}addValue(e,s){const n=this.values.get(e);s!==n&&(n&&this.removeValue(e),this.bindToMotionValue(e,s),this.values.set(e,s),this.latestValues[e]=s.get())}removeValue(e){this.values.delete(e);const s=this.valueSubscriptions.get(e);s&&(s(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,s){if(this.props.values&&this.props.values[e])return this.props.values[e];let n=this.values.get(e);return n===void 0&&s!==void 0&&(n=Zl(s===null?void 0:s,{owner:this}),this.addValue(e,n)),n}readValue(e,s){let n=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return n!=null&&(typeof n=="string"&&(bR(n)||yR(n))?n=parseFloat(n):!bK(n)&&ya.test(s)&&(n=sI(e,s)),this.setBaseTarget(e,bs(n)?n.get():n)),bs(n)?n.get():n}setBaseTarget(e,s){this.baseTarget[e]=s}getBaseTarget(e){var r;const{initial:s}=this.props;let n;if(typeof s=="string"||typeof s=="object"){const a=i1(this.props,s,(r=this.presenceContext)==null?void 0:r.custom);a&&(n=a[e])}if(s&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!bs(i)?i:this.initialValues[e]!==void 0&&n===void 0?void 0:this.baseTarget[e]}on(e,s){return this.events[e]||(this.events[e]=new L_),this.events[e].add(s)}notify(e,...s){this.events[e]&&this.events[e].notify(...s)}scheduleRenderMicrotask(){X_.render(this.render)}}class AI extends uW{constructor(){super(...arguments),this.KeyframeResolver=aK}sortInstanceNodePosition(e,s){return e.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(e,s){return e.style?e.style[s]:void 0}removeValueFromRenderState(e,{vars:s,style:n}){delete s[e],delete n[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;bs(e)&&(this.childSubscription=e.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function jI(t,{style:e,vars:s},n,i){const r=t.style;let a;for(a in e)r[a]=e[a];i==null||i.applyProjectionStyles(r,n);for(a in s)r.setProperty(a,s[a])}function dW(t){return window.getComputedStyle(t)}class hW extends AI{constructor(){super(...arguments),this.type="html",this.renderInstance=jI}readValueFromInstance(e,s){var n;if(Cc.has(s))return(n=this.projection)!=null&&n.isProjecting?pb(s):Sq(e,s);{const i=dW(e),r=(MR(s)?i.getPropertyValue(s):i[s])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:s}){return TI(e,s)}build(e,s,n){t1(e,s,n.transformTemplate)}scrapeMotionValuesFromProps(e,s,n){return r1(e,s,n)}}const CI=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function fW(t,e,s,n){jI(t,e,void 0,n);for(const i in e.attrs)t.setAttribute(CI.has(i)?i:a1(i),e.attrs[i])}class mW extends AI{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Yt}getBaseTargetFromProps(e,s){return e[s]}readValueFromInstance(e,s){if(Cc.has(s)){const n=tI(s);return n&&n.default||0}return s=CI.has(s)?s:a1(s),e.getAttribute(s)}scrapeMotionValuesFromProps(e,s,n){return vI(e,s,n)}build(e,s,n){pI(e,s,this.isSVGTag,n.transformTemplate,n.style)}renderInstance(e,s,n,i){fW(e,s,n,i)}mount(e){this.isSVGTag=xI(e.tagName),super.mount(e)}}const pW=(t,e)=>n1(t)?new mW(e):new hW(e,{allowProjection:t!==N.Fragment});function Al(t,e,s){const n=t.getProps();return i1(n,e,s!==void 0?s:n.custom,t)}const Tb=t=>Array.isArray(t);function gW(t,e,s){t.hasValue(e)?t.getValue(e).set(s):t.addValue(e,Zl(s))}function xW(t){return Tb(t)?t[t.length-1]||0:t}function bW(t,e){const s=Al(t,e);let{transitionEnd:n={},transition:i={},...r}=s||{};r={...r,...n};for(const a in r){const l=xW(r[a]);gW(t,a,l)}}function vW(t){return!!(bs(t)&&t.add)}function Eb(t,e){const s=t.getValue("willChange");if(vW(s))return s.add(e);if(!s&&ar.WillChange){const n=new ar.WillChange("auto");t.addValue("willChange",n),n.add(e)}}function RI(t){return t.props[yI]}const yW=t=>t!==null;function _W(t,{repeat:e,repeatType:s="loop"},n){const i=t.filter(yW),r=e&&s!=="loop"&&e%2===1?0:i.length-1;return i[r]}const wW={type:"spring",stiffness:500,damping:25,restSpeed:10},kW=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),NW={type:"keyframes",duration:.8},SW={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},TW=(t,{keyframes:e})=>e.length>2?NW:Cc.has(t)?t.startsWith("scale")?kW(e[1]):wW:SW;function EW({when:t,delay:e,delayChildren:s,staggerChildren:n,staggerDirection:i,repeat:r,repeatType:a,repeatDelay:l,from:c,elapsed:u,...d}){return!!Object.keys(d).length}const o1=(t,e,s,n={},i,r)=>a=>{const l=W_(n,t)||{},c=l.delay||n.delay||0;let{elapsed:u=0}=n;u=u-li(c);const d={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:e.getVelocity(),...l,delay:-u,onUpdate:f=>{e.set(f),l.onUpdate&&l.onUpdate(f)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:t,motionValue:e,element:r?void 0:i};EW(l)||Object.assign(d,TW(t,d)),d.duration&&(d.duration=li(d.duration)),d.repeatDelay&&(d.repeatDelay=li(d.repeatDelay)),d.from!==void 0&&(d.keyframes[0]=d.from);let h=!1;if((d.type===!1||d.duration===0&&!d.repeatDelay)&&(yb(d),d.delay===0&&(h=!0)),(ar.instantAnimations||ar.skipAnimations)&&(h=!0,yb(d),d.delay=0),d.allowFlatten=!l.type&&!l.ease,h&&!r&&e.get()!==void 0){const f=_W(d.keyframes,l);if(f!==void 0){_t.update(()=>{d.onUpdate(f),d.onComplete()});return}}return l.isSync?new q_(d):new Wq(d)};function AW({protectedKeys:t,needsAnimating:e},s){const n=t.hasOwnProperty(s)&&e[s]!==!0;return e[s]=!1,n}function II(t,e,{delay:s=0,transitionOverride:n,type:i}={}){let{transition:r=t.getDefaultTransition(),transitionEnd:a,...l}=e;n&&(r=n);const c=[],u=i&&t.animationState&&t.animationState.getState()[i];for(const d in l){const h=t.getValue(d,t.latestValues[d]??null),f=l[d];if(f===void 0||u&&AW(u,d))continue;const m={delay:s,...W_(r||{},d)},b=h.get();if(b!==void 0&&!h.isAnimating&&!Array.isArray(f)&&f===b&&!m.velocity)continue;let x=!1;if(window.MotionHandoffAnimation){const g=RI(t);if(g){const p=window.MotionHandoffAnimation(g,d,_t);p!==null&&(m.startTime=p,x=!0)}}Eb(t,d),h.start(o1(d,h,f,t.shouldReduceMotion&&JR.has(d)?{type:!1}:m,t,x));const v=h.animation;v&&c.push(v)}return a&&Promise.all(c).then(()=>{_t.update(()=>{a&&bW(t,a)})}),c}function OI(t,e,s,n=0,i=1){const r=Array.from(t).sort((u,d)=>u.sortNodePosition(d)).indexOf(e),a=t.size,l=(a-1)*n;return typeof s=="function"?s(r,a):i===1?r*n:l-r*n}function Ab(t,e,s={}){var c;const n=Al(t,e,s.type==="exit"?(c=t.presenceContext)==null?void 0:c.custom:void 0);let{transition:i=t.getDefaultTransition()||{}}=n||{};s.transitionOverride&&(i=s.transitionOverride);const r=n?()=>Promise.all(II(t,n,s)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(u=0)=>{const{delayChildren:d=0,staggerChildren:h,staggerDirection:f}=i;return jW(t,e,u,d,h,f,s)}:()=>Promise.resolve(),{when:l}=i;if(l){const[u,d]=l==="beforeChildren"?[r,a]:[a,r];return u().then(()=>d())}else return Promise.all([r(),a(s.delay)])}function jW(t,e,s=0,n=0,i=0,r=1,a){const l=[];for(const c of t.variantChildren)c.notify("AnimationStart",e),l.push(Ab(c,e,{...a,delay:s+(typeof n=="function"?0:n)+OI(t.variantChildren,c,n,i,r)}).then(()=>c.notify("AnimationComplete",e)));return Promise.all(l)}function CW(t,e,s={}){t.notify("AnimationStart",e);let n;if(Array.isArray(e)){const i=e.map(r=>Ab(t,r,s));n=Promise.all(i)}else if(typeof e=="string")n=Ab(t,e,s);else{const i=typeof e=="function"?Al(t,e,s.custom):e;n=Promise.all(II(t,i,s))}return n.then(()=>{t.notify("AnimationComplete",e)})}function MI(t,e){if(!Array.isArray(e))return!1;const s=e.length;if(s!==t.length)return!1;for(let n=0;n<s;n++)if(e[n]!==t[n])return!1;return!0}const RW=e1.length;function DI(t){if(!t)return;if(!t.isControllingVariants){const s=t.parent?DI(t.parent)||{}:{};return t.props.initial!==void 0&&(s.initial=t.props.initial),s}const e={};for(let s=0;s<RW;s++){const n=e1[s],i=t.props[n];(hd(i)||i===!1)&&(e[n]=i)}return e}const IW=[...Z_].reverse(),OW=Z_.length;function MW(t){return e=>Promise.all(e.map(({animation:s,options:n})=>CW(t,s,n)))}function DW(t){let e=MW(t),s=_S(),n=!0;const i=c=>(u,d)=>{var f;const h=Al(t,d,c==="exit"?(f=t.presenceContext)==null?void 0:f.custom:void 0);if(h){const{transition:m,transitionEnd:b,...x}=h;u={...u,...x,...b}}return u};function r(c){e=c(t)}function a(c){const{props:u}=t,d=DI(t.parent)||{},h=[],f=new Set;let m={},b=1/0;for(let v=0;v<OW;v++){const g=IW[v],p=s[g],y=u[g]!==void 0?u[g]:d[g],k=hd(y),w=g===c?p.isActive:null;w===!1&&(b=v);let S=y===d[g]&&y!==u[g]&&k;if(S&&n&&t.manuallyAnimateOnMount&&(S=!1),p.protectedKeys={...m},!p.isActive&&w===null||!y&&!p.prevProp||s0(y)||typeof y=="boolean")continue;const _=LW(p.prevProp,y);let T=_||g===c&&p.isActive&&!S&&k||v>b&&k,E=!1;const A=Array.isArray(y)?y:[y];let j=A.reduce(i(g),{});w===!1&&(j={});const{prevResolvedValues:O={}}=p,H={...O,...j},G=D=>{T=!0,f.has(D)&&(E=!0,f.delete(D)),p.needsAnimating[D]=!0;const I=t.getValue(D);I&&(I.liveStyle=!1)};for(const D in H){const I=j[D],F=O[D];if(m.hasOwnProperty(D))continue;let U=!1;Tb(I)&&Tb(F)?U=!MI(I,F):U=I!==F,U?I!=null?G(D):f.add(D):I!==void 0&&f.has(D)?G(D):p.protectedKeys[D]=!0}p.prevProp=y,p.prevResolvedValues=j,p.isActive&&(m={...m,...j}),n&&t.blockInitialAnimation&&(T=!1);const L=S&&_;T&&(!L||E)&&h.push(...A.map(D=>{const I={type:g};if(typeof D=="string"&&n&&!L&&t.manuallyAnimateOnMount&&t.parent){const{parent:F}=t,U=Al(F,D);if(F.enteringChildren&&U){const{delayChildren:R}=U.transition||{};I.delay=OI(F.enteringChildren,t,R)}}return{animation:D,options:I}}))}if(f.size){const v={};if(typeof u.initial!="boolean"){const g=Al(t,Array.isArray(u.initial)?u.initial[0]:u.initial);g&&g.transition&&(v.transition=g.transition)}f.forEach(g=>{const p=t.getBaseTarget(g),y=t.getValue(g);y&&(y.liveStyle=!0),v[g]=p??null}),h.push({animation:v})}let x=!!h.length;return n&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(x=!1),n=!1,x?e(h):Promise.resolve()}function l(c,u){var h;if(s[c].isActive===u)return Promise.resolve();(h=t.variantChildren)==null||h.forEach(f=>{var m;return(m=f.animationState)==null?void 0:m.setActive(c,u)}),s[c].isActive=u;const d=a(c);for(const f in s)s[f].protectedKeys={};return d}return{animateChanges:a,setActive:l,setAnimateFunction:r,getState:()=>s,reset:()=>{s=_S()}}}function LW(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!MI(e,t):!1}function Ra(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function _S(){return{animate:Ra(!0),whileInView:Ra(),whileHover:Ra(),whileTap:Ra(),whileDrag:Ra(),whileFocus:Ra(),exit:Ra()}}class Ea{constructor(e){this.isMounted=!1,this.node=e}update(){}}class PW extends Ea{constructor(e){super(e),e.animationState||(e.animationState=DW(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();s0(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:s}=this.node.prevProps||{};e!==s&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)==null||e.call(this)}}let VW=0;class BW extends Ea{constructor(){super(...arguments),this.id=VW++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:s}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===n)return;const i=this.node.animationState.setActive("exit",!e);s&&!e&&i.then(()=>{s(this.id)})}mount(){const{register:e,onExitComplete:s}=this.node.presenceContext||{};s&&s(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const FW={animation:{Feature:PW},exit:{Feature:BW}};function fd(t,e,s,n={passive:!0}){return t.addEventListener(e,s,n),()=>t.removeEventListener(e,s)}function ch(t){return{point:{x:t.pageX,y:t.pageY}}}const UW=t=>e=>Q_(e)&&t(e,ch(e));function Eu(t,e,s,n){return fd(t,e,UW(s),n)}const LI=1e-4,$W=1-LI,HW=1+LI,PI=.01,GW=0-PI,zW=0+PI;function Ss(t){return t.max-t.min}function qW(t,e,s){return Math.abs(t-e)<=s}function wS(t,e,s,n=.5){t.origin=n,t.originPoint=St(e.min,e.max,t.origin),t.scale=Ss(s)/Ss(e),t.translate=St(s.min,s.max,t.origin)-t.originPoint,(t.scale>=$W&&t.scale<=HW||isNaN(t.scale))&&(t.scale=1),(t.translate>=GW&&t.translate<=zW||isNaN(t.translate))&&(t.translate=0)}function Au(t,e,s,n){wS(t.x,e.x,s.x,n?n.originX:void 0),wS(t.y,e.y,s.y,n?n.originY:void 0)}function kS(t,e,s){t.min=s.min+e.min,t.max=t.min+Ss(e)}function KW(t,e,s){kS(t.x,e.x,s.x),kS(t.y,e.y,s.y)}function NS(t,e,s){t.min=e.min-s.min,t.max=t.min+Ss(e)}function $m(t,e,s){NS(t.x,e.x,s.x),NS(t.y,e.y,s.y)}function un(t){return[t("x"),t("y")]}const VI=({current:t})=>t?t.ownerDocument.defaultView:null,SS=(t,e)=>Math.abs(t-e);function WW(t,e){const s=SS(t.x,e.x),n=SS(t.y,e.y);return Math.sqrt(s**2+n**2)}class BI{constructor(e,s,{transformPagePoint:n,contextWindow:i=window,dragSnapToOrigin:r=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=gg(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,b=WW(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!b)return;const{point:x}=f,{timestamp:v}=us;this.history.push({...x,timestamp:v});const{onStart:g,onMove:p}=this.handlers;m||(g&&g(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),p&&p(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=pg(m,this.transformPagePoint),_t.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:b,onSessionEnd:x,resumeAnimation:v}=this.handlers;if(this.dragSnapToOrigin&&v&&v(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=gg(f.type==="pointercancel"?this.lastMoveEventInfo:pg(m,this.transformPagePoint),this.history);this.startEvent&&b&&b(f,g),x&&x(f,g)},!Q_(e))return;this.dragSnapToOrigin=r,this.handlers=s,this.transformPagePoint=n,this.distanceThreshold=a,this.contextWindow=i||window;const l=ch(e),c=pg(l,this.transformPagePoint),{point:u}=c,{timestamp:d}=us;this.history=[{...u,timestamp:d}];const{onSessionStart:h}=s;h&&h(e,gg(c,this.history)),this.removeListeners=ah(Eu(this.contextWindow,"pointermove",this.handlePointerMove),Eu(this.contextWindow,"pointerup",this.handlePointerUp),Eu(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),va(this.updatePoint)}}function pg(t,e){return e?{point:e(t.point)}:t}function TS(t,e){return{x:t.x-e.x,y:t.y-e.y}}function gg({point:t},e){return{point:t,delta:TS(t,FI(e)),offset:TS(t,YW(e)),velocity:XW(e,.1)}}function YW(t){return t[0]}function FI(t){return t[t.length-1]}function XW(t,e){if(t.length<2)return{x:0,y:0};let s=t.length-1,n=null;const i=FI(t);for(;s>=0&&(n=t[s],!(i.timestamp-n.timestamp>li(e)));)s--;if(!n)return{x:0,y:0};const r=vn(i.timestamp-n.timestamp);if(r===0)return{x:0,y:0};const a={x:(i.x-n.x)/r,y:(i.y-n.y)/r};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function QW(t,{min:e,max:s},n){return e!==void 0&&t<e?t=n?St(e,t,n.min):Math.max(t,e):s!==void 0&&t>s&&(t=n?St(s,t,n.max):Math.min(t,s)),t}function ES(t,e,s){return{min:e!==void 0?t.min+e:void 0,max:s!==void 0?t.max+s-(t.max-t.min):void 0}}function JW(t,{top:e,left:s,bottom:n,right:i}){return{x:ES(t.x,s,i),y:ES(t.y,e,n)}}function AS(t,e){let s=e.min-t.min,n=e.max-t.max;return e.max-e.min<t.max-t.min&&([s,n]=[n,s]),{min:s,max:n}}function ZW(t,e){return{x:AS(t.x,e.x),y:AS(t.y,e.y)}}function eY(t,e){let s=.5;const n=Ss(t),i=Ss(e);return i>n?s=cd(e.min,e.max-n,t.min):n>i&&(s=cd(t.min,t.max-i,e.min)),rr(0,1,s)}function tY(t,e){const s={};return e.min!==void 0&&(s.min=e.min-t.min),e.max!==void 0&&(s.max=e.max-t.min),s}const jb=.35;function sY(t=jb){return t===!1?t=0:t===!0&&(t=jb),{x:jS(t,"left","right"),y:jS(t,"top","bottom")}}function jS(t,e,s){return{min:CS(t,e),max:CS(t,s)}}function CS(t,e){return typeof t=="number"?t:t[e]||0}const nY=new WeakMap;class iY{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Yt(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:s=!1,distanceThreshold:n}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const r=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(ch(h).point)},a=(h,f)=>{const{drag:m,dragPropagation:b,onDragStart:x}=this.getProps();if(m&&!b&&(this.openDragLock&&this.openDragLock(),this.openDragLock=uK(m),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=f,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),un(g=>{let p=this.getAxisMotionValue(g).get()||0;if(ci.test(p)){const{projection:y}=this.visualElement;if(y&&y.layout){const k=y.layout.layoutBox[g];k&&(p=Ss(k)*(parseFloat(p)/100))}}this.originPoint[g]=p}),x&&_t.postRender(()=>x(h,f)),Eb(this.visualElement,"transform");const{animationState:v}=this.visualElement;v&&v.setActive("whileDrag",!0)},l=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f;const{dragPropagation:m,dragDirectionLock:b,onDirectionLock:x,onDrag:v}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:g}=f;if(b&&this.currentDirection===null){this.currentDirection=rY(g),this.currentDirection!==null&&x&&x(this.currentDirection);return}this.updateAxis("x",f.point,g),this.updateAxis("y",f.point,g),this.visualElement.render(),v&&v(h,f)},c=(h,f)=>{this.latestPointerEvent=h,this.latestPanInfo=f,this.stop(h,f),this.latestPointerEvent=null,this.latestPanInfo=null},u=()=>un(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)==null?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new BI(e,{onSessionStart:r,onStart:a,onMove:l,onSessionEnd:c,resumeAnimation:u},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,distanceThreshold:n,contextWindow:VI(this.visualElement)})}stop(e,s){const n=e||this.latestPointerEvent,i=s||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!i||!n)return;const{velocity:a}=i;this.startAnimation(a);const{onDragEnd:l}=this.getProps();l&&_t.postRender(()=>l(n,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:s}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:n}=this.getProps();!n&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(e,s,n){const{drag:i}=this.getProps();if(!n||!Bh(e,i,this.currentDirection))return;const r=this.getAxisMotionValue(e);let a=this.originPoint[e]+n[e];this.constraints&&this.constraints[e]&&(a=QW(a,this.constraints[e],this.elastic[e])),r.set(a)}resolveConstraints(){var r;const{dragConstraints:e,dragElastic:s}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(r=this.visualElement.projection)==null?void 0:r.layout,i=this.constraints;e&&ll(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&n?this.constraints=JW(n.layoutBox,e):this.constraints=!1,this.elastic=sY(s),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&un(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=tY(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:s}=this.getProps();if(!e||!ll(e))return!1;const n=e.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const r=aW(n,i.root,this.visualElement.getTransformPagePoint());let a=ZW(i.layout.layoutBox,r);if(s){const l=s(nW(a));this.hasMutatedConstraints=!!l,l&&(a=kI(l))}return a}startAnimation(e){const{drag:s,dragMomentum:n,dragElastic:i,dragTransition:r,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},u=un(d=>{if(!Bh(d,s,this.currentDirection))return;let h=c&&c[d]||{};a&&(h={min:0,max:0});const f=i?200:1e6,m=i?40:1e7,b={type:"inertia",velocity:n?e[d]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...r,...h};return this.startAxisValueAnimation(d,b)});return Promise.all(u).then(l)}startAxisValueAnimation(e,s){const n=this.getAxisMotionValue(e);return Eb(this.visualElement,e),n.start(o1(e,n,0,s,this.visualElement,!1))}stopAnimation(){un(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){un(e=>{var s;return(s=this.getAxisMotionValue(e).animation)==null?void 0:s.pause()})}getAnimationState(e){var s;return(s=this.getAxisMotionValue(e).animation)==null?void 0:s.state}getAxisMotionValue(e){const s=`_drag${e.toUpperCase()}`,n=this.visualElement.getProps(),i=n[s];return i||this.visualElement.getValue(e,(n.initial?n.initial[e]:void 0)||0)}snapToCursor(e){un(s=>{const{drag:n}=this.getProps();if(!Bh(s,n,this.currentDirection))return;const{projection:i}=this.visualElement,r=this.getAxisMotionValue(s);if(i&&i.layout){const{min:a,max:l}=i.layout.layoutBox[s];r.set(e[s]-St(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:s}=this.getProps(),{projection:n}=this.visualElement;if(!ll(s)||!n||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};un(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();i[a]=eY({min:c,max:c},this.constraints[a])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",n.root&&n.root.updateScroll(),n.updateLayout(),this.resolveConstraints(),un(a=>{if(!Bh(a,e,null))return;const l=this.getAxisMotionValue(a),{min:c,max:u}=this.constraints[a];l.set(St(c,u,i[a]))})}addListeners(){if(!this.visualElement.current)return;nY.set(this.visualElement,this);const e=this.visualElement.current,s=Eu(e,"pointerdown",c=>{const{drag:u,dragListener:d=!0}=this.getProps();u&&d&&this.start(c)}),n=()=>{const{dragConstraints:c}=this.getProps();ll(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,r=i.addEventListener("measure",n);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),_t.read(n);const a=fd(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:u})=>{this.isDragging&&u&&(un(d=>{const h=this.getAxisMotionValue(d);h&&(this.originPoint[d]+=c[d].translate,h.set(h.get()+c[d].translate))}),this.visualElement.render())});return()=>{a(),s(),r(),l&&l()}}getProps(){const e=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:n=!1,dragPropagation:i=!1,dragConstraints:r=!1,dragElastic:a=jb,dragMomentum:l=!0}=e;return{...e,drag:s,dragDirectionLock:n,dragPropagation:i,dragConstraints:r,dragElastic:a,dragMomentum:l}}}function Bh(t,e,s){return(e===!0||e===t)&&(s===null||s===t)}function rY(t,e=10){let s=null;return Math.abs(t.y)>e?s="y":Math.abs(t.x)>e&&(s="x"),s}class aY extends Ea{constructor(e){super(e),this.removeGroupControls=Tn,this.removeListeners=Tn,this.controls=new iY(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Tn}unmount(){this.removeGroupControls(),this.removeListeners()}}const RS=t=>(e,s)=>{t&&_t.postRender(()=>t(e,s))};class oY extends Ea{constructor(){super(...arguments),this.removePointerDownListener=Tn}onPointerDown(e){this.session=new BI(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:VI(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:s,onPan:n,onPanEnd:i}=this.node.getProps();return{onSessionStart:RS(e),onStart:RS(s),onMove:n,onEnd:(r,a)=>{delete this.session,i&&_t.postRender(()=>i(r,a))}}}mount(){this.removePointerDownListener=Eu(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const gf={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let xg=!1;class lY extends N.Component{componentDidMount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n,layoutId:i}=this.props,{projection:r}=e;r&&(s.group&&s.group.add(r),n&&n.register&&i&&n.register(r),xg&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,onExitComplete:()=>this.safeToRemove()})),gf.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:s,visualElement:n,drag:i,isPresent:r}=this.props,{projection:a}=n;return a&&(a.isPresent=r,xg=!0,i||e.layoutDependency!==s||s===void 0||e.isPresent!==r?a.willUpdate():this.safeToRemove(),e.isPresent!==r&&(r?a.promote():a.relegate()||_t.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),X_.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:s,switchLayoutGroup:n}=this.props,{projection:i}=e;xg=!0,i&&(i.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(i),n&&n.deregister&&n.deregister(i))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function UI(t){const[e,s]=cI(),n=N.useContext(j_);return o.jsx(lY,{...t,layoutGroup:n,switchLayoutGroup:N.useContext(_I),isPresent:e,safeToRemove:s})}function cY(t,e,s){const n=bs(t)?t:Zl(t);return n.start(o1("",n,e,s)),n.animation}const uY=(t,e)=>t.depth-e.depth;class dY{constructor(){this.children=[],this.isDirty=!1}add(e){I_(this.children,e),this.isDirty=!0}remove(e){O_(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(uY),this.isDirty=!1,this.children.forEach(e)}}function hY(t,e){const s=Ps.now(),n=({timestamp:i})=>{const r=i-s;r>=e&&(va(n),t(r-e))};return _t.setup(n,!0),()=>va(n)}const $I=["TopLeft","TopRight","BottomLeft","BottomRight"],fY=$I.length,IS=t=>typeof t=="string"?parseFloat(t):t,OS=t=>typeof t=="number"||xe.test(t);function mY(t,e,s,n,i,r){i?(t.opacity=St(0,s.opacity??1,pY(n)),t.opacityExit=St(e.opacity??1,0,gY(n))):r&&(t.opacity=St(e.opacity??1,s.opacity??1,n));for(let a=0;a<fY;a++){const l=`border${$I[a]}Radius`;let c=MS(e,l),u=MS(s,l);if(c===void 0&&u===void 0)continue;c||(c=0),u||(u=0),c===0||u===0||OS(c)===OS(u)?(t[l]=Math.max(St(IS(c),IS(u),n),0),(ci.test(u)||ci.test(c))&&(t[l]+="%")):t[l]=u}(e.rotate||s.rotate)&&(t.rotate=St(e.rotate||0,s.rotate||0,n))}function MS(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const pY=HI(0,.5,AR),gY=HI(.5,.95,Tn);function HI(t,e,s){return n=>n<t?0:n>e?1:s(cd(t,e,n))}function DS(t,e){t.min=e.min,t.max=e.max}function Rn(t,e){DS(t.x,e.x),DS(t.y,e.y)}function LS(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function PS(t,e,s,n,i){return t-=e,t=Um(t,1/s,n),i!==void 0&&(t=Um(t,1/i,n)),t}function xY(t,e=0,s=1,n=.5,i,r=t,a=t){if(ci.test(e)&&(e=parseFloat(e),e=St(a.min,a.max,e/100)-a.min),typeof e!="number")return;let l=St(r.min,r.max,n);t===r&&(l-=e),t.min=PS(t.min,e,s,l,i),t.max=PS(t.max,e,s,l,i)}function VS(t,e,[s,n,i],r,a){xY(t,e[s],e[n],e[i],e.scale,r,a)}const bY=["x","scaleX","originX"],vY=["y","scaleY","originY"];function BS(t,e,s,n){VS(t.x,e,bY,s?s.x:void 0,n?n.x:void 0),VS(t.y,e,vY,s?s.y:void 0,n?n.y:void 0)}function FS(t){return t.translate===0&&t.scale===1}function GI(t){return FS(t.x)&&FS(t.y)}function US(t,e){return t.min===e.min&&t.max===e.max}function yY(t,e){return US(t.x,e.x)&&US(t.y,e.y)}function $S(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function zI(t,e){return $S(t.x,e.x)&&$S(t.y,e.y)}function HS(t){return Ss(t.x)/Ss(t.y)}function GS(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class _Y{constructor(){this.members=[]}add(e){I_(this.members,e),e.scheduleRender()}remove(e){if(O_(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(e){const s=this.members.findIndex(i=>e===i);if(s===0)return!1;let n;for(let i=s;i>=0;i--){const r=this.members[i];if(r.isPresent!==!1){n=r;break}}return n?(this.promote(n),!0):!1}promote(e,s){const n=this.lead;if(e!==n&&(this.prevLead=n,this.lead=e,e.show(),n)){n.instance&&n.scheduleRender(),e.scheduleRender(),e.resumeFrom=n,s&&(e.resumeFrom.preserveOpacity=!0),n.snapshot&&(e.snapshot=n.snapshot,e.snapshot.latestValues=n.animationValues||n.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:i}=e.options;i===!1&&n.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:s,resumingFrom:n}=e;s.onExitComplete&&s.onExitComplete(),n&&n.options.onExitComplete&&n.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function wY(t,e,s){let n="";const i=t.x.translate/e.x,r=t.y.translate/e.y,a=(s==null?void 0:s.z)||0;if((i||r||a)&&(n=`translate3d(${i}px, ${r}px, ${a}px) `),(e.x!==1||e.y!==1)&&(n+=`scale(${1/e.x}, ${1/e.y}) `),s){const{transformPerspective:u,rotate:d,rotateX:h,rotateY:f,skewX:m,skewY:b}=s;u&&(n=`perspective(${u}px) ${n}`),d&&(n+=`rotate(${d}deg) `),h&&(n+=`rotateX(${h}deg) `),f&&(n+=`rotateY(${f}deg) `),m&&(n+=`skewX(${m}deg) `),b&&(n+=`skewY(${b}deg) `)}const l=t.x.scale*e.x,c=t.y.scale*e.y;return(l!==1||c!==1)&&(n+=`scale(${l}, ${c})`),n||"none"}const bg=["","X","Y","Z"],kY=1e3;let NY=0;function vg(t,e,s,n){const{latestValues:i}=e;i[t]&&(s[t]=i[t],e.setStaticValue(t,0),n&&(n[t]=0))}function qI(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const s=RI(e);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:i,layoutId:r}=t.options;window.MotionCancelOptimisedAnimation(s,"transform",_t,!(i||r))}const{parent:n}=t;n&&!n.hasCheckedOptimisedAppear&&qI(n)}function KI({attachResizeListener:t,defaultParent:e,measureScroll:s,checkIsScrollRoot:n,resetTransform:i}){return class{constructor(a={},l=e==null?void 0:e()){this.id=NY++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(EY),this.nodes.forEach(RY),this.nodes.forEach(IY),this.nodes.forEach(AY)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new dY)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new L_),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=lI(a)&&!gK(a),this.instance=a;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),t){let d,h=0;const f=()=>this.root.updateBlockedByResize=!1;_t.read(()=>{h=window.innerWidth}),t(a,()=>{const m=window.innerWidth;m!==h&&(h=m,this.root.updateBlockedByResize=!0,d&&d(),d=hY(f,250),gf.hasAnimatedSinceResize&&(gf.hasAnimatedSinceResize=!1,this.nodes.forEach(KS)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeLayoutChanged:f,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||u.getDefaultTransition()||PY,{onLayoutAnimationStart:x,onLayoutAnimationComplete:v}=u.getProps(),g=!this.targetLayout||!zI(this.targetLayout,m),p=!h&&f;if(this.options.layoutRoot||this.resumeFrom||p||h&&(g||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const y={...W_(b,"layout"),onPlay:x,onComplete:v};(u.shouldReduceMotion||this.options.layoutRoot)&&(y.delay=0,y.type=!1),this.startAnimation(y),this.setAnimationOrigin(d,p)}else h||KS(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),va(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(OY),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&qI(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let d=0;d<this.path.length;d++){const h=this.path[d];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const u=this.getTransformTemplate();this.prevTransformTemplateValue=u?u(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(zS);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(qS);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(CY),this.nodes.forEach(SY),this.nodes.forEach(TY)):this.nodes.forEach(qS),this.clearAllSnapshots();const l=Ps.now();us.delta=rr(0,1e3/60,l-us.timestamp),us.timestamp=l,us.isProcessing=!0,og.update.process(us),og.preRender.process(us),og.render.process(us),us.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,X_.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(jY),this.sharedNodes.forEach(MY)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,_t.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){_t.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!Ss(this.snapshot.measuredBox.x)&&!Ss(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=Yt(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&this.instance){const c=n(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!GI(this.projectionDelta),c=this.getTransformTemplate(),u=c?c(this.latestValues,""):void 0,d=u!==this.prevTransformTemplateValue;a&&this.instance&&(l||Fa(this.latestValues)||d)&&(i(this.instance,u),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),VY(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var u;const{visualElement:a}=this.options;if(!a)return Yt();const l=a.measureViewportBox();if(!(((u=this.scroll)==null?void 0:u.wasRoot)||this.path.some(BY))){const{scroll:d}=this.root;d&&(cl(l.x,d.offset.x),cl(l.y,d.offset.y))}return l}removeElementScroll(a){var c;const l=Yt();if(Rn(l,a),(c=this.scroll)!=null&&c.wasRoot)return l;for(let u=0;u<this.path.length;u++){const d=this.path[u],{scroll:h,options:f}=d;d!==this.root&&h&&f.layoutScroll&&(h.wasRoot&&Rn(l,a),cl(l.x,h.offset.x),cl(l.y,h.offset.y))}return l}applyTransform(a,l=!1){const c=Yt();Rn(c,a);for(let u=0;u<this.path.length;u++){const d=this.path[u];!l&&d.options.layoutScroll&&d.scroll&&d!==d.root&&ul(c,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),Fa(d.latestValues)&&ul(c,d.latestValues)}return Fa(this.latestValues)&&ul(c,this.latestValues),c}removeTransform(a){const l=Yt();Rn(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];if(!u.instance||!Fa(u.latestValues))continue;kb(u.latestValues)&&u.updateSnapshot();const d=Yt(),h=u.measurePageBox();Rn(d,h),BS(l,u.latestValues,u.snapshot?u.snapshot.layoutBox:void 0,d)}return Fa(this.latestValues)&&BS(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==us.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var m;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(a||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:d,layoutId:h}=this.options;if(!this.layout||!(d||h))return;this.resolvedRelativeTargetAt=us.timestamp;const f=this.getClosestProjectingParent();f&&this.linkedParentVersion!==f.layoutVersion&&!f.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(f&&f.layout?this.createRelativeTarget(f,this.layout.layoutBox,f.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Yt(),this.targetWithTransforms=Yt()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),KW(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Rn(this.target,this.layout.layoutBox),SI(this.target,this.targetDelta)):Rn(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?this.createRelativeTarget(f,this.target,f.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||kb(this.parent.latestValues)||NI(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(a,l,c){this.relativeParent=a,this.linkedParentVersion=a.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Yt(),this.relativeTargetOrigin=Yt(),$m(this.relativeTargetOrigin,l,c),Rn(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var b;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||(b=this.parent)!=null&&b.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===us.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Rn(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;rW(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=Yt());const{target:m}=a;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(LS(this.prevProjectionDelta.x,this.projectionDelta.x),LS(this.prevProjectionDelta.y,this.projectionDelta.y)),Au(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==f||!GS(this.projectionDelta.x,this.prevProjectionDelta.x)||!GS(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),a){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=dl(),this.projectionDelta=dl(),this.projectionDeltaWithTransform=dl()}setAnimationOrigin(a,l=!1){const c=this.snapshot,u=c?c.latestValues:{},d={...this.latestValues},h=dl();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const f=Yt(),m=c?c.source:void 0,b=this.layout?this.layout.source:void 0,x=m!==b,v=this.getStack(),g=!v||v.members.length<=1,p=!!(x&&!g&&this.options.crossfade===!0&&!this.path.some(LY));this.animationProgress=0;let y;this.mixTargetDelta=k=>{const w=k/1e3;WS(h.x,a.x,w),WS(h.y,a.y,w),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&($m(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),DY(this.relativeTarget,this.relativeTargetOrigin,f,w),y&&yY(this.relativeTarget,y)&&(this.isProjectionDirty=!1),y||(y=Yt()),Rn(y,this.relativeTarget)),x&&(this.animationValues=d,mY(d,u,this.latestValues,w,p,g)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){var l,c,u;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(u=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||u.stop(),this.pendingAnimation&&(va(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=_t.update(()=>{gf.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=Zl(0)),this.currentAnimation=cY(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:d=>{this.mixTargetDelta(d),a.onUpdate&&a.onUpdate(d)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(kY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:u,latestValues:d}=a;if(!(!l||!c||!u)){if(this!==a&&this.layout&&u&&WI(this.options.animationType,this.layout.layoutBox,u.layoutBox)){c=this.target||Yt();const h=Ss(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const f=Ss(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+f}Rn(l,c),ul(l,d),Au(this.projectionDeltaWithTransform,this.layoutCorrected,l,d)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new _Y),this.sharedNodes.get(a).add(l);const u=l.options.initialPromotionConfig;l.promote({transition:u?u.transition:void 0,preserveFollowOpacity:u&&u.shouldPreserveFollowOpacity?u.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var l;const{layoutId:a}=this.options;return a?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:a}=this.options;return a?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const u=this.getStack();u&&u.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const u={};c.z&&vg("z",a,u,this.animationValues);for(let d=0;d<bg.length;d++)vg(`rotate${bg[d]}`,a,u,this.animationValues),vg(`skew${bg[d]}`,a,u,this.animationValues);a.render();for(const d in u)a.setStaticValue(d,u[d]),this.animationValues&&(this.animationValues[d]=u[d]);a.scheduleRender()}applyProjectionStyles(a,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=pf(l==null?void 0:l.pointerEvents)||"",a.transform=c?c(this.latestValues,""):"none";return}const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=pf(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!Fa(this.latestValues)&&(a.transform=c?c({},""):"none",this.hasProjected=!1);return}a.visibility="";const d=u.animationValues||u.latestValues;this.applyTransformsToTarget();let h=wY(this.projectionDeltaWithTransform,this.treeScale,d);c&&(h=c(d,h)),a.transform=h;const{x:f,y:m}=this.projectionDelta;a.transformOrigin=`${f.origin*100}% ${m.origin*100}% 0`,u.animationValues?a.opacity=u===this?d.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:d.opacityExit:a.opacity=u===this?d.opacity!==void 0?d.opacity:"":d.opacityExit!==void 0?d.opacityExit:0;for(const b in wb){if(d[b]===void 0)continue;const{correct:x,applyTo:v,isCSSVariable:g}=wb[b],p=h==="none"?d[b]:x(d[b],u);if(v){const y=v.length;for(let k=0;k<y;k++)a[v[k]]=p}else g?this.options.visualElement.renderState.vars[b]=p:a[b]=p}this.options.layoutId&&(a.pointerEvents=u===this?pf(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(zS),this.root.sharedNodes.clear()}}}function SY(t){t.updateLayout()}function TY(t){var s;const e=((s=t.resumeFrom)==null?void 0:s.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:n,measuredBox:i}=t.layout,{animationType:r}=t.options,a=e.source!==t.layout.source;r==="size"?un(h=>{const f=a?e.measuredBox[h]:e.layoutBox[h],m=Ss(f);f.min=n[h].min,f.max=f.min+m}):WI(r,e.layoutBox,n)&&un(h=>{const f=a?e.measuredBox[h]:e.layoutBox[h],m=Ss(n[h]);f.max=f.min+m,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[h].max=t.relativeTarget[h].min+m)});const l=dl();Au(l,n,e.layoutBox);const c=dl();a?Au(c,t.applyTransform(i,!0),e.measuredBox):Au(c,n,e.layoutBox);const u=!GI(l);let d=!1;if(!t.resumeFrom){const h=t.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:m}=h;if(f&&m){const b=Yt();$m(b,e.layoutBox,f.layoutBox);const x=Yt();$m(x,n,m.layoutBox),zI(b,x)||(d=!0),h.options.layoutRoot&&(t.relativeTarget=x,t.relativeTargetOrigin=b,t.relativeParent=h)}}}t.notifyListeners("didUpdate",{layout:n,snapshot:e,delta:c,layoutDelta:l,hasLayoutChanged:u,hasRelativeLayoutChanged:d})}else if(t.isLead()){const{onExitComplete:n}=t.options;n&&n()}t.options.transition=void 0}function EY(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function AY(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function jY(t){t.clearSnapshot()}function zS(t){t.clearMeasurements()}function qS(t){t.isLayoutDirty=!1}function CY(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function KS(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function RY(t){t.resolveTargetDelta()}function IY(t){t.calcProjection()}function OY(t){t.resetSkewAndRotation()}function MY(t){t.removeLeadSnapshot()}function WS(t,e,s){t.translate=St(e.translate,0,s),t.scale=St(e.scale,1,s),t.origin=e.origin,t.originPoint=e.originPoint}function YS(t,e,s,n){t.min=St(e.min,s.min,n),t.max=St(e.max,s.max,n)}function DY(t,e,s,n){YS(t.x,e.x,s.x,n),YS(t.y,e.y,s.y,n)}function LY(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const PY={duration:.45,ease:[.4,0,.1,1]},XS=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),QS=XS("applewebkit/")&&!XS("chrome/")?Math.round:Tn;function JS(t){t.min=QS(t.min),t.max=QS(t.max)}function VY(t){JS(t.x),JS(t.y)}function WI(t,e,s){return t==="position"||t==="preserve-aspect"&&!qW(HS(e),HS(s),.2)}function BY(t){var e;return t!==t.root&&((e=t.scroll)==null?void 0:e.wasRoot)}const FY=KI({attachResizeListener:(t,e)=>fd(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),yg={current:void 0},YI=KI({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!yg.current){const t=new FY({});t.mount(window),t.setOptions({layoutScroll:!0}),yg.current=t}return yg.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),UY={pan:{Feature:oY},drag:{Feature:aY,ProjectionNode:YI,MeasureLayout:UI}};function ZS(t,e,s){const{props:n}=t;t.animationState&&n.whileHover&&t.animationState.setActive("whileHover",s==="Start");const i="onHover"+s,r=n[i];r&&_t.postRender(()=>r(e,ch(e)))}class $Y extends Ea{mount(){const{current:e}=this.node;e&&(this.unmount=dK(e,(s,n)=>(ZS(this.node,n,"Start"),i=>ZS(this.node,i,"End"))))}unmount(){}}class HY extends Ea{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=ah(fd(this.node.current,"focus",()=>this.onFocus()),fd(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function eT(t,e,s){const{props:n}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&n.whileTap&&t.animationState.setActive("whileTap",s==="Start");const i="onTap"+(s==="End"?"":s),r=n[i];r&&_t.postRender(()=>r(e,ch(e)))}class GY extends Ea{mount(){const{current:e}=this.node;e&&(this.unmount=pK(e,(s,n)=>(eT(this.node,n,"Start"),(i,{success:r})=>eT(this.node,i,r?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const Cb=new WeakMap,_g=new WeakMap,zY=t=>{const e=Cb.get(t.target);e&&e(t)},qY=t=>{t.forEach(zY)};function KY({root:t,...e}){const s=t||document;_g.has(s)||_g.set(s,{});const n=_g.get(s),i=JSON.stringify(e);return n[i]||(n[i]=new IntersectionObserver(qY,{root:t,...e})),n[i]}function WY(t,e,s){const n=KY(e);return Cb.set(t,s),n.observe(t),()=>{Cb.delete(t),n.unobserve(t)}}const YY={some:0,all:1};class XY extends Ea{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:s,margin:n,amount:i="some",once:r}=e,a={root:s?s.current:void 0,rootMargin:n,threshold:typeof i=="number"?i:YY[i]},l=c=>{const{isIntersecting:u}=c;if(this.isInView===u||(this.isInView=u,r&&!u&&this.hasEnteredView))return;u&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",u);const{onViewportEnter:d,onViewportLeave:h}=this.node.getProps(),f=u?d:h;f&&f(c)};return WY(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:s}=this.node;["amount","margin","root"].some(QY(e,s))&&this.startObserver()}unmount(){}}function QY({viewport:t={}},{viewport:e={}}={}){return s=>t[s]!==e[s]}const JY={inView:{Feature:XY},tap:{Feature:GY},focus:{Feature:HY},hover:{Feature:$Y}},ZY={layout:{ProjectionNode:YI,MeasureLayout:UI}},eX={...FW,...JY,...UY,...ZY},ee=sW(eX,pW);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tX=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),sX=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,n)=>n?n.toUpperCase():s.toLowerCase()),tT=t=>{const e=sX(t);return e.charAt(0).toUpperCase()+e.slice(1)},XI=(...t)=>t.filter((e,s,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===s).join(" ").trim(),nX=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var iX={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rX=N.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:s=2,absoluteStrokeWidth:n,className:i="",children:r,iconNode:a,...l},c)=>N.createElement("svg",{ref:c,...iX,width:e,height:e,stroke:t,strokeWidth:n?Number(s)*24/Number(e):s,className:XI("lucide",i),...!r&&!nX(l)&&{"aria-hidden":"true"},...l},[...a.map(([u,d])=>N.createElement(u,d)),...Array.isArray(r)?r:[r]]));/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=(t,e)=>{const s=N.forwardRef(({className:n,...i},r)=>N.createElement(rX,{ref:r,iconNode:e,className:XI(`lucide-${tX(tT(t))}`,`lucide-${t}`,n),...i}));return s.displayName=tT(t),s};/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aX=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],sT=ie("activity",aX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oX=[["path",{d:"M12 6v16",key:"nqf5sj"}],["path",{d:"m19 13 2-1a9 9 0 0 1-18 0l2 1",key:"y7qv08"}],["path",{d:"M9 11h6",key:"1fldmi"}],["circle",{cx:"12",cy:"4",r:"2",key:"muu5ef"}]],i0=ie("anchor",oX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lX=[["path",{d:"M11 9a1 1 0 0 0 1-1V5.061a1 1 0 0 1 1.811-.75l6.836 6.836a1.207 1.207 0 0 1 0 1.707l-6.836 6.835a1 1 0 0 1-1.811-.75V16a1 1 0 0 0-1-1H5a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1z",key:"1232du"}]],cX=ie("arrow-big-right",lX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uX=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],io=ie("arrow-right",uX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dX=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],hX=ie("arrow-up",dX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fX=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],nT=ie("award",fX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mX=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],iT=ie("bed",mX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pX=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],QI=ie("box",pX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gX=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],xX=ie("brain",gX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bX=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],vX=ie("calendar",bX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yX=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Rc=ie("check",yX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _X=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],wX=ie("chevron-down",_X);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kX=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],JI=ie("chevron-right",kX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Rb=ie("circle-alert",NX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],TX=ie("circle-arrow-up",SX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],AX=ie("circle-check",EX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],CX=ie("circle",jX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RX=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ib=ie("clock",RX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IX=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],OX=ie("coffee",IX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MX=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],l1=ie("coins",MX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DX=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],Ic=ie("crown",DX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],PX=ie("disc",LX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VX=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],BX=ie("eye-off",VX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FX=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],UX=ie("eye",FX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $X=[["path",{d:"M6.5 12c.94-3.46 4.94-6 8.5-6 3.56 0 6.06 2.54 7 6-.94 3.47-3.44 6-7 6s-7.56-2.53-8.5-6Z",key:"15baut"}],["path",{d:"M18 12v.5",key:"18hhni"}],["path",{d:"M16 17.93a9.77 9.77 0 0 1 0-11.86",key:"16dt7o"}],["path",{d:"M7 10.67C7 8 5.58 5.97 2.73 5.5c-1 1.5-1 5 .23 6.5-1.24 1.5-1.24 5-.23 6.5C5.58 18.03 7 16 7 13.33",key:"l9di03"}],["path",{d:"M10.46 7.26C10.2 5.88 9.17 4.24 8 3h5.8a2 2 0 0 1 1.98 1.67l.23 1.4",key:"1kjonw"}],["path",{d:"m16.01 17.93-.23 1.4A2 2 0 0 1 13.8 21H9.5a5.96 5.96 0 0 0 1.49-3.98",key:"1zlm23"}]],HX=ie("fish",$X);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GX=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],ZI=ie("gift",GX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],qX=ie("globe",zX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KX=[["path",{d:"m15 12-9.373 9.373a1 1 0 0 1-3.001-3L12 9",key:"1hayfq"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172v-.344a2 2 0 0 0-.586-1.414l-1.657-1.657A6 6 0 0 0 12.516 3H9l1.243 1.243A6 6 0 0 1 12 8.485V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"15ts47"}]],tc=ie("hammer",KX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WX=[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]],c1=ie("handshake",WX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YX=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],XX=ie("heart",YX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QX=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Hm=ie("history",QX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JX=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],eO=ie("info",JX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZX=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],tO=ie("layout-grid",ZX);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],tQ=ie("leaf",eQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],rT=ie("loader-circle",sQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Oo=ie("lock",nQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],rQ=ie("log-out",iQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],oQ=ie("mail",aQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],sO=ie("map-pin",lQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],nO=ie("map",cQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],dQ=ie("menu",uQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hQ=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],md=ie("message-square",hQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fQ=[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]],mQ=ie("music",fQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pQ=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],iO=ie("navigation",pQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gQ=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],rO=ie("package",gQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xQ=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],bQ=ie("palette",xQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vQ=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Ob=ie("pause",vQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yQ=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],pd=ie("play",yQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Q=[["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"m19 8 3 8a5 5 0 0 1-6 0zV7",key:"zcdpyk"}],["path",{d:"M3 7h1a17 17 0 0 0 8-2 17 17 0 0 0 8 2h1",key:"1yorad"}],["path",{d:"m5 8 3 8a5 5 0 0 1-6 0zV7",key:"eua70x"}],["path",{d:"M7 21h10",key:"1b0cd5"}]],aO=ie("scale",_Q);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wQ=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],kQ=ie("scroll-text",wQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NQ=[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],SQ=ie("scroll",NQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TQ=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],EQ=ie("search",TQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AQ=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],oO=ie("send",AQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jQ=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],CQ=ie("settings",jQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RQ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],u1=ie("shield-alert",RQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IQ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Mb=ie("shield-check",IQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OQ=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],d1=ie("shield",OQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MQ=[["path",{d:"M17.971 4.285A2 2 0 0 1 21 6v12a2 2 0 0 1-3.029 1.715l-9.997-5.998a2 2 0 0 1-.003-3.432z",key:"15892j"}],["path",{d:"M3 20V4",key:"1ptbpl"}]],DQ=ie("skip-back",MQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LQ=[["path",{d:"M21 4v16",key:"7j8fe9"}],["path",{d:"M6.029 4.285A2 2 0 0 0 3 6v12a2 2 0 0 0 3.029 1.715l9.997-5.998a2 2 0 0 0 .003-3.432z",key:"zs4d6"}]],PQ=ie("skip-forward",LQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VQ=[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]],BQ=ie("skull",VQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FQ=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],UQ=ie("snowflake",FQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $Q=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],sa=ie("sparkles",$Q);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HQ=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],GQ=ie("star",HQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zQ=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],qQ=ie("sun",zQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KQ=[["path",{d:"m11 19-6-6",key:"s7kpr"}],["path",{d:"m5 21-2-2",key:"1kw20b"}],["path",{d:"m8 16-4 4",key:"1oqv8h"}],["path",{d:"M9.5 17.5 21 6V3h-3L6.5 14.5",key:"pkxemp"}]],Gm=ie("sword",KQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WQ=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],zm=ie("trending-up",WQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YQ=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],gd=ie("triangle-alert",YQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XQ=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],xd=ie("trophy",XQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QQ=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],JQ=ie("truck",QQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZQ=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Gn=ie("user",ZQ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eJ=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],h1=ie("users",eJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tJ=[["path",{d:"M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2",key:"cjf0a3"}],["path",{d:"M7 2v20",key:"1473qp"}],["path",{d:"M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7",key:"j28e5"}]],sJ=ie("utensils",tJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nJ=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],iJ=ie("volume-2",nJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rJ=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],aJ=ie("wand-sparkles",rJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oJ=[["path",{d:"M12.8 19.6A2 2 0 1 0 14 16H2",key:"148xed"}],["path",{d:"M17.5 8a2.5 2.5 0 1 1 2 4H2",key:"1u4tom"}],["path",{d:"M9.8 4.4A2 2 0 1 1 11 8H2",key:"75valh"}]],lO=ie("wind",oJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lJ=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Yn=ie("x",lJ);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cJ=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Db=ie("zap",cJ),uJ=({onAuth:t,adminPassword:e})=>{const[s,n]=N.useState(""),[i,r]=N.useState(!1),a=l=>{l&&l.preventDefault(),s===e?(t(),sessionStorage.setItem("admin_session","active"),r(!1)):(r(!0),n(""),navigator.vibrate&&navigator.vibrate(50))};return o.jsxs("div",{className:"fixed inset-0 bg-slate-950 flex items-center justify-center z-[100] overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,rgba(99,102,241,0.08)_0%,transparent_70%)]"}),o.jsx(ee.div,{animate:{scale:[1,1.1,1],opacity:[.3,.5,.3]},transition:{duration:8,repeat:1/0,ease:"easeInOut"},className:"absolute top-[-20%] left-[-10%] w-[60%] h-[60%] bg-indigo-600/10 blur-[150px] rounded-full"})]}),o.jsxs(ee.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},className:"w-full max-w-md p-8 relative",children:[o.jsxs("div",{className:"text-center mb-10",children:[o.jsx(ee.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:12,stiffness:200,delay:.2},className:"w-20 h-20 bg-indigo-500/10 rounded-3xl flex items-center justify-center mx-auto mb-6 border border-indigo-500/20 backdrop-blur-xl",children:o.jsx(Oo,{className:"w-10 h-10 text-indigo-400"})}),o.jsx("h2",{className:"text-3xl font-black text-white tracking-tight mb-2",children:"Begrenset tilgang"}),o.jsx("p",{className:"text-slate-400 font-medium",children:"Vennligst oppgi passord for  fortsette"})]}),o.jsxs("form",{onSubmit:a,className:"space-y-4",children:[o.jsxs("div",{className:"relative group",children:[o.jsx(ee.div,{animate:i?{x:[-10,10,-10,10,0]}:{},transition:{duration:.4},children:o.jsx("input",{autoFocus:!0,type:"password",value:s,onChange:l=>{n(l.target.value),i&&r(!1)},placeholder:"Passord...",className:`w-full bg-slate-900/50 border-2 ${i?"border-red-500/50 focus:border-red-500":"border-slate-800 focus:border-indigo-500"} rounded-2xl px-6 py-4 text-white text-lg font-medium outline-none transition-all duration-300 backdrop-blur-md placeholder:text-slate-600`})}),o.jsx(qt,{children:i&&o.jsx(ee.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"text-red-400 text-sm font-bold mt-2 ml-2",children:"Ugyldig passord. Prv igjen."})})]}),o.jsx("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl transition-all duration-300 shadow-lg shadow-indigo-600/20 active:scale-[0.98]",children:"Ls opp panel"})]}),o.jsx("div",{className:"mt-12 text-center",children:o.jsx("button",{onClick:()=>window.location.href="/",className:"text-slate-500 hover:text-slate-300 text-sm font-bold transition-colors",children:"Tilbake til forsiden"})})]})]})},dJ=({allRooms:t,isLoading:e,onCreateRoom:s,onDeleteRoom:n,onManageRoom:i,onCleanupMetadata:r,archivingStatus:a})=>o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 p-12 overflow-y-auto custom-scrollbar font-sans z-20",children:[a&&o.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-950/80 backdrop-blur-xl flex items-center justify-center p-6 text-center animate-in fade-in duration-300",children:o.jsxs("div",{className:"max-w-md bg-slate-900 border-2 border-indigo-500/30 rounded-[3rem] p-12 space-y-8 shadow-2xl scale-in-center",children:[o.jsx("div",{className:"w-20 h-20 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h2",{className:"text-3xl font-black italic text-white uppercase tracking-tighter",children:"Sikker Arkivering"}),o.jsx("p",{className:"text-indigo-400 font-bold uppercase tracking-widest text-xs animate-pulse",children:a})]}),o.jsx("p",{className:"text-slate-500 text-sm",children:"Ikke lukk vinduet mens vi sikrer karakterens ettermle..."})]})}),o.jsxs("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:[o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full"}),o.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-600/10 blur-[120px] rounded-full"})]}),o.jsxs("div",{className:"max-w-5xl mx-auto relative z-10",children:[o.jsxs("div",{className:"flex justify-between items-center mb-12",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-5xl font-black text-white px-2 tracking-tighter",children:"Simuleringshallen"}),o.jsx("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-[10px] mt-2 px-2",children:"Sentralt kontrollpanel for administratoren"})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:r,disabled:e,className:"bg-slate-800 hover:bg-rose-500/20 text-slate-400 hover:text-rose-400 border border-slate-700 hover:border-rose-500/50 px-6 py-5 rounded-2xl font-black text-xs uppercase tracking-widest transition-all",children:" Vask Serverlisten"}),o.jsx("button",{onClick:s,disabled:e,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-10 py-5 rounded-2xl font-black text-lg shadow-2xl shadow-indigo-600/30 transition-all hover:scale-105 active:scale-95",children:"+ Opprett Nytt Rike"})]})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(l=>{var c,u;return o.jsxs("div",{className:"bg-slate-900/50 backdrop-blur-xl border border-white/5 p-8 rounded-[2.5rem] group hover:border-indigo-500/50 transition-all shadow-xl flex flex-col justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsx("h2",{className:"text-2xl font-black text-white group-hover:text-indigo-400 transition-colors truncate pr-4",title:l.name||`Rike #${l.pin}`,children:l.name||`Rike #${l.pin}`}),o.jsx("span",{className:`px-2 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest ${l.status==="PLAYING"?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"} shrink-0`,children:typeof l.status=="string"?l.status:"KORRUPT"})]}),o.jsxs("div",{className:"text-[10px] font-mono text-slate-600 mb-6 uppercase tracking-widest",children:["PIN: ",o.jsx("span",{className:"text-slate-400 font-bold",children:l.pin})]}),o.jsxs("div",{className:"space-y-4 mb-8",children:[o.jsxs("div",{className:"flex items-center justify-between text-sm font-bold text-slate-500",children:[o.jsx("span",{children:"Innbyggere:"}),o.jsxs("span",{className:"text-white",children:[Object.keys(l.players||{}).length," sjeler"]})]}),o.jsxs("div",{className:"flex items-center justify-between text-sm font-bold text-slate-500",children:[o.jsx("span",{children:"rstid:"}),o.jsx("span",{className:"text-indigo-300",children:bt[(c=l.world)==null?void 0:c.season]||((u=l.world)==null?void 0:u.season)||"Ukjent"})]})]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>i(l.pin),className:"flex-1 bg-white/5 hover:bg-white/10 text-white py-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all border border-white/5",children:"Administrer "}),o.jsx("button",{onClick:()=>n(l.pin),className:"bg-rose-500/10 hover:bg-rose-500/20 text-rose-500 w-16 rounded-2xl flex items-center justify-center border border-rose-500/20 transition-all hover:scale-105 active:scale-95",title:"Slett rom",children:""})]})]},l.pin)})})]})]}),hJ=Se.memo(({pin:t,roomData:e,isLoading:s,onBack:n,onStartGame:i,onTogglePublic:r,onRepairData:a,onResetGame:l,onNextSeason:c,onChangeWeather:u,onTaxationBase:d,onRegenStamina:h,onResetUnrest:f,onKickAll:m,onSpawnEvent:b,onStartTing:x,onSpawnCharacter:v,initializeSettlement:g,onExportLog:p})=>{var S,_,T,E,A;const[y,k]=N.useState({name:"",role:"PEASANT",level:1}),w=()=>{if(!y.name){alert("Vennligst oppgi et navn.");return}v(y),k({name:"",role:"PEASANT",level:1})};return o.jsxs("aside",{className:"w-80 border-r border-white/10 bg-slate-900/50 backdrop-blur-xl flex flex-col z-20 shadow-2xl overflow-y-auto no-scrollbar",children:[o.jsxs("div",{className:"p-8 border-b border-white/5 bg-black/20",children:[o.jsx("button",{onClick:n,className:"text-indigo-400 font-black text-[10px] uppercase tracking-widest mb-4 hover:text-white transition-colors flex items-center gap-2",children:" Tilbake til oversikt"}),o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("h1",{className:"text-4xl font-mono font-black text-white",children:t}),o.jsx("span",{className:"text-[10px] font-black uppercase text-indigo-500 tracking-widest bg-indigo-500/10 px-3 py-1 rounded-full",children:"Admin"})]}),o.jsxs("p",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-6",children:[typeof e.status=="string"?e.status:"FEIL: DATA KORRUPT"," MODUS"]}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsx("button",{onClick:i,disabled:e.status==="PLAYING"||s,className:`w-full py-4 rounded-xl font-black uppercase tracking-widest text-sm transition-all shadow-lg ${e.status==="PLAYING"?"bg-emerald-600/20 text-emerald-400 cursor-default":"bg-emerald-600 hover:bg-emerald-500 text-white shadow-emerald-600/20"}`,children:e.status==="PLAYING"?" SPILL AKTIVT":" START SPILL"}),o.jsxs("button",{onClick:r,disabled:s,className:`w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all border flex items-center justify-center gap-2 ${e.isPublic?"bg-indigo-600/10 text-indigo-400 border-indigo-500/20 hover:bg-indigo-600 hover:text-white":"bg-slate-800 text-slate-500 border-white/5 hover:border-indigo-500/20"}`,children:[e.isPublic?o.jsx(qX,{size:14}):o.jsx(Oo,{size:14}),e.isPublic?"OFFENTLIG SERVER":"PRIVAT (KUN PIN)"]}),o.jsx("button",{onClick:a,disabled:s,className:"w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] bg-amber-600/10 text-amber-500 hover:bg-amber-600 hover:text-white transition-all border border-amber-500/20",children:" REPARER DATA"}),o.jsx("button",{onClick:l,disabled:s,className:"w-full py-3 rounded-xl font-black uppercase tracking-widest text-[10px] bg-rose-600/10 text-rose-500 hover:bg-rose-600 hover:text-white transition-all border border-rose-500/20",children:" NULLSTILL ALT"})]})]}),o.jsxs("div",{className:"p-8 space-y-8 flex-1 overflow-y-auto custom-scrollbar",children:[o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Verdensstyring"}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5 group",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-400 italic",children:["rstid: ",((_=Nn[(S=e.world)==null?void 0:S.season])==null?void 0:_.label)||"Ukjent"]}),o.jsx("span",{className:"text-2xl group-hover:rotate-12 transition-transform",children:{Spring:"",Summer:"",Autumn:"",Winter:""}[((T=e.world)==null?void 0:T.season)||"Spring"]})]}),o.jsx("button",{onClick:c,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-black uppercase text-[10px] transition-all",children:"Neste rstid"})]}),o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5 group",children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsxs("span",{className:"text-xs font-bold text-slate-400 italic",children:["Vr: ",((E=e.world)==null?void 0:E.weather)||"Klart"]}),o.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:""})]}),o.jsx("button",{onClick:u,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-2 rounded-lg font-black uppercase text-[10px] transition-all",children:"Endre Vr"})]})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Massehandlinger"}),o.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[o.jsx("button",{onClick:d,className:"w-full bg-amber-600/10 hover:bg-amber-600 text-amber-500 hover:text-white border border-amber-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2",children:" Skattlegg Riket"}),o.jsx("button",{onClick:h,className:"w-full bg-blue-600/10 hover:bg-blue-600 text-blue-500 hover:text-white border border-blue-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center",children:" Gjenopprett Stamina"}),o.jsx("button",{onClick:f,className:"w-full bg-indigo-600/10 hover:bg-indigo-600 text-indigo-500 hover:text-white border border-indigo-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center",children:" Nullstill Politisk Uro"}),o.jsx("button",{onClick:m,className:"w-full bg-rose-600/10 hover:bg-rose-600 text-rose-500 hover:text-white border border-rose-600/20 py-4 rounded-2xl font-black uppercase text-[10px] transition-all flex items-center justify-center gap-2 text-center mt-2",children:" Kast ut alle"})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Dataanalyse"}),o.jsx("div",{className:"grid grid-cols-1 gap-3",children:o.jsx("button",{onClick:p,disabled:s,className:"w-full bg-indigo-500 hover:bg-indigo-400 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-indigo-600/20 transition-all active:scale-95 flex items-center justify-center gap-2",children:" EKSPORTER FULL LOGG"})})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4 text-center",children:"Intervensjoner"}),o.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("button",{onClick:b,className:"bg-rose-600/80 hover:bg-rose-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-rose-600/20 transition-all active:scale-95",children:" Event"}),o.jsx("button",{onClick:x,disabled:!!e.activeVote,className:"bg-amber-600/80 hover:bg-amber-600 text-white py-4 rounded-2xl font-black uppercase text-[10px] shadow-lg shadow-amber-600/20 disabled:opacity-20 text-center transition-all active:scale-95",children:" Tinget"})]}),o.jsxs("section",{className:"bg-white/5 border border-white/5 rounded-[2.5rem] p-6 space-y-4 shadow-inner",children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-[0.2em] mb-2 px-2",children:"Legg til Karakter"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("input",{type:"text",placeholder:"Navn...",value:y.name,onChange:j=>k({...y,name:j.target.value}),className:"w-full bg-black/40 border border-white/5 rounded-xl px-4 py-3 text-xs font-bold text-white placeholder:text-slate-600 focus:border-indigo-500/50 focus:ring-0 transition-all"}),o.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[o.jsx("select",{value:y.role,onChange:j=>k({...y,role:j.target.value}),className:"bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black uppercase text-slate-400 focus:ring-0",children:Object.keys(ld).map(j=>o.jsx("option",{value:j,children:j},j))}),o.jsxs("div",{className:"flex items-center gap-2 bg-black/40 border border-white/5 rounded-xl px-3 py-2",children:[o.jsx("span",{className:"text-[8px] font-black text-slate-600",children:"LVL"}),o.jsx("input",{type:"number",value:y.level,onChange:j=>k({...y,level:parseInt(j.target.value)}),className:"w-full bg-transparent border-none p-0 text-xs font-black text-white focus:ring-0 font-mono"})]})]}),o.jsx("button",{onClick:w,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-3 rounded-xl font-black uppercase text-[10px] shadow-lg shadow-indigo-600/20 transition-all active:scale-95",children:" SKAP KARAKTER"})]})]})]})]}),o.jsxs("section",{children:[o.jsx("h3",{className:"text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-4",children:"Landsby-fokus"}),(A=e.world)!=null&&A.settlement?o.jsx("div",{className:"text-xs text-slate-500 italic",children:"Landsbyen er initialisert."}):o.jsx("button",{onClick:g,className:"w-full bg-amber-500 text-black py-4 rounded-2xl font-black uppercase text-[10px] animate-pulse",children:"Initialiser Landsby"})]})]})]})}),fJ=Se.memo(({players:t,onKick:e,onLevelChange:s,onRoleChange:n,onRegionChange:i,onControl:r,onGiveGold:a,onGiveResource:l,onGiveItem:c})=>{const[u,d]=N.useState({}),[h,f]=N.useState({}),[m,b]=N.useState({});return o.jsxs("section",{children:[o.jsx("h2",{className:"text-3xl font-black text-white px-2 mb-8 tracking-tighter",children:"Innbyggere i Riket"}),o.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[Object.values(t||{}).map(x=>{var v,g,p,y,k,w,S;return o.jsxs("div",{className:"relative bg-slate-900/80 border border-white/5 p-6 rounded-[2rem] hover:border-indigo-500/30 transition-all group",children:[o.jsx("button",{onClick:_=>{_.stopPropagation(),e(x.id,x.name)},className:"absolute top-4 right-4 w-8 h-8 rounded-full bg-rose-500/10 text-rose-500 opacity-0 group-hover:opacity-100 transition-all hover:bg-rose-500 hover:text-white flex items-center justify-center font-bold text-xs",title:"Kast ut spiller",children:""}),o.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[o.jsx("div",{className:"w-12 h-12 bg-indigo-600/20 rounded-xl flex items-center justify-center text-2xl shrink-0 group-hover:scale-110 transition-transform overflow-hidden",children:x.avatar?o.jsx("img",{src:x.avatar,alt:x.role,className:"w-full h-full object-cover"}):{KING:"",BARON:"",PEASANT:"",SOLDIER:"",MERCHANT:""}[x.role]||""}),o.jsxs("div",{className:"min-w-0 flex-1",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsx("h3",{className:"text-lg font-black text-white truncate leading-tight",children:x.name}),o.jsxs("div",{className:"flex items-center gap-1 bg-white/5 px-2 py-0.5 rounded-lg border border-white/5",children:[o.jsx("span",{className:"text-[8px] font-black text-slate-500 uppercase",children:"LVL"}),o.jsx("input",{type:"number",value:((v=x.stats)==null?void 0:v.level)||1,onChange:_=>s(x.id,parseInt(_.target.value)),className:"w-8 bg-transparent border-none p-0 text-[10px] font-black text-indigo-400 focus:ring-0 text-center font-mono"})]})]}),o.jsxs("div",{className:"flex flex-col gap-1 mt-1",children:[o.jsx("select",{value:x.role,onChange:_=>n(x.id,_.target.value),className:"bg-indigo-500/10 text-indigo-400 text-[10px] font-black uppercase tracking-widest border-none p-0 focus:ring-0 cursor-pointer hover:text-white transition-colors w-full text-left",children:Object.entries(ld).map(([_,T])=>o.jsx("option",{value:_,className:"bg-slate-900",children:T.label},_))}),o.jsxs("select",{value:x.regionId||"region_ost",onChange:_=>i(x.id,_.target.value),className:"bg-white/5 text-slate-500 text-[9px] font-bold uppercase tracking-wider border-none p-0 focus:ring-0 cursor-pointer hover:text-slate-300 transition-colors w-full text-left",children:[o.jsx("option",{value:"capital",className:"bg-slate-900",children:"Hovedstaden"}),o.jsx("option",{value:"region_ost",className:"bg-slate-900",children:"Baroniet st"}),o.jsx("option",{value:"region_vest",className:"bg-slate-900",children:"Baroniet Vest"})]})]})]})]}),x.id.startsWith("bot_")&&((g=x.status)==null?void 0:g.thought)&&o.jsxs("div",{className:"mb-4 p-3 bg-indigo-500/10 rounded-xl border border-indigo-500/20",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx("span",{className:"text-[8px] font-black text-indigo-400 uppercase tracking-widest",children:"Mental Tilstand"}),o.jsx("div",{className:"flex-1 h-[1px] bg-indigo-500/20"})]}),o.jsxs("p",{className:"text-[10px] text-white/90 font-bold leading-relaxed mb-2",children:['"',x.status.thought,'"']}),o.jsxs("div",{className:"flex justify-between items-center text-[8px] font-black uppercase tracking-tighter text-indigo-400/60",children:[o.jsxs("span",{children:["Handling: ",x.status.lastAction]}),o.jsxs("span",{children:["Tid: ",x.status.lastTick?new Date(x.status.lastTick).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"N"]})]})]}),o.jsxs("div",{className:"space-y-3 mb-6",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between text-[8px] font-black uppercase text-slate-500 mb-1",children:[o.jsx("span",{children:"Stamina"}),o.jsxs("span",{className:"text-white",children:[x.status.stamina,"%"]})]}),o.jsx("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${x.status.stamina}%`}})})]}),o.jsxs("div",{className:"flex justify-between items-center text-xs font-bold",children:[o.jsx("span",{className:"text-slate-500",children:"Gull:"}),o.jsxs("span",{className:"text-amber-500 font-black",children:[x.resources.gold,""]})]})]}),o.jsxs("div",{className:"flex flex-wrap gap-1 mb-6",children:[(p=x.upgrades)==null?void 0:p.map(_=>o.jsx("span",{className:"text-[7px] font-black bg-indigo-500/10 text-indigo-400 px-1.5 py-0.5 rounded border border-indigo-500/20 uppercase tracking-tighter",children:_},_)),(!x.upgrades||x.upgrades.length===0)&&o.jsx("span",{className:"text-[7px] font-bold text-slate-700 uppercase italic",children:"Ingen oppgraderinger"})]}),o.jsxs("button",{onClick:()=>r(x.id),className:"w-full py-4 rounded-2xl bg-indigo-600/10 hover:bg-indigo-600 text-indigo-400 hover:text-white font-black uppercase text-[10px] tracking-widest transition-all border border-indigo-500/20 flex items-center justify-center gap-2 group/btn",children:[o.jsx("span",{className:"group-hover/btn:scale-125 transition-transform",children:""}),"Styr spiller"]}),o.jsxs("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-col gap-2",children:[o.jsxs("div",{className:"flex gap-2",children:[o.jsx("input",{type:"number",placeholder:"Gull...",value:u[x.id]||"",onChange:_=>d({...u,[x.id]:parseInt(_.target.value)||0}),className:"flex-1 bg-black/40 border border-white/5 rounded-xl px-3 py-2 text-[10px] font-black text-white focus:border-indigo-500/50 transition-all font-mono"}),o.jsx("button",{onClick:()=>{const _=u[x.id]||0;_>0&&(a(x.id,_),d({...u,[x.id]:0}))},className:"bg-emerald-600/20 hover:bg-emerald-600 text-emerald-400 hover:text-white border border-emerald-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI GULL"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("select",{value:((y=m[x.id])==null?void 0:y.resourceId)||"",onChange:_=>{var T;return b({...m,[x.id]:{resourceId:_.target.value,amount:((T=m[x.id])==null?void 0:T.amount)||10}})},className:"flex-[2] bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-bold text-amber-300 focus:border-amber-500/50 transition-all cursor-pointer",children:[o.jsx("option",{value:"",children:"Velg ressurs..."}),o.jsx("optgroup",{label:"BASISVARER",className:"bg-slate-900 text-slate-500",children:["gold","grain","wood","stone","iron_ore","honey","meat","wool","egg"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=Ge[_])==null?void 0:T.icon," ",(E=Ge[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"FOREDLET",className:"bg-slate-900 text-slate-500",children:["flour","bread","plank","iron_ingot","cloth","glass","omelette"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=Ge[_])==null?void 0:T.icon," ",(E=Ge[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"MARITIMT",className:"bg-slate-900 text-slate-500",children:["flax","linen_canvas","tar","fish_raw","fish_cooked","silk","spice","cannonball"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=Ge[_])==null?void 0:T.icon," ",(E=Ge[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"KRIG",className:"bg-slate-900 text-slate-500",children:["siege_sword","siege_armor"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=Ge[_])==null?void 0:T.icon," ",(E=Ge[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"APOTEKER",className:"bg-slate-900 text-slate-500",children:["minor_stamina_potion","herbal_balm","focus_brew","strength_tincture","masters_draught","elixir_of_life"].map(_=>{var T,E;return o.jsxs("option",{value:_,className:"text-white",children:[(T=Ge[_])==null?void 0:T.icon," ",(E=Ge[_])==null?void 0:E.label]},_)})}),o.jsx("optgroup",{label:"ANNET",className:"bg-slate-900 text-slate-500",children:o.jsx("option",{value:"favor",className:"text-white",children:" Gunst"})})]}),o.jsx("input",{type:"number",placeholder:"#",value:((k=m[x.id])==null?void 0:k.amount)||10,onChange:_=>{var T;return b({...m,[x.id]:{resourceId:((T=m[x.id])==null?void 0:T.resourceId)||"",amount:parseInt(_.target.value)||1}})},className:"w-12 bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-black text-white focus:border-amber-500/50 transition-all font-mono text-center"}),o.jsx("button",{onClick:()=>{const _=m[x.id];_&&_.resourceId&&_.amount>0&&(l(x.id,_.resourceId,_.amount),b({...m,[x.id]:{resourceId:"",amount:10}}))},className:"bg-amber-600/20 hover:bg-amber-600 text-amber-400 hover:text-white border border-amber-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("select",{value:((w=h[x.id])==null?void 0:w.itemId)||"",onChange:_=>{var T;return f({...h,[x.id]:{itemId:_.target.value,amount:((T=h[x.id])==null?void 0:T.amount)||1}})},className:"flex-[2] bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-bold text-slate-300 focus:border-indigo-500/50 transition-all cursor-pointer",children:[o.jsx("option",{value:"",children:"Velg..."}),Object.values(qe).map(_=>o.jsxs("option",{value:_.id,children:[_.icon," ",_.name]},_.id))]}),o.jsx("input",{type:"number",placeholder:"#",value:((S=h[x.id])==null?void 0:S.amount)||1,onChange:_=>{var T;return f({...h,[x.id]:{itemId:((T=h[x.id])==null?void 0:T.itemId)||"",amount:parseInt(_.target.value)||1}})},className:"w-12 bg-black/40 border border-white/5 rounded-xl px-2 py-2 text-[10px] font-black text-white focus:border-indigo-500/50 transition-all font-mono text-center"}),o.jsx("button",{onClick:()=>{const _=h[x.id];_&&_.itemId&&_.amount>0&&(c(x.id,_.itemId,_.amount),f({...h,[x.id]:{itemId:"",amount:1}}))},className:"bg-indigo-600/20 hover:bg-indigo-600 text-indigo-400 hover:text-white border border-indigo-500/30 px-3 py-2 rounded-xl text-[8px] font-black uppercase transition-all",children:"GI"})]})]})]},x.id)}),Object.keys(t||{}).length===0&&o.jsxs("div",{className:"col-span-full py-20 text-center border-2 border-dashed border-white/5 rounded-[3rem]",children:[o.jsx("span",{className:"text-6xl block mb-4 opacity-20",children:""}),o.jsx("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-xs",children:"Venter p at understter skal ankomme..."})]})]})]})}),mJ=Se.memo(({roomData:t})=>{const e=s=>s?Array.isArray(s)?s:Object.values(s).sort((n,i)=>n.timestamp-i.timestamp):[];return o.jsxs("aside",{className:"w-80 border-l border-white/10 bg-slate-900/50 backdrop-blur-xl flex flex-col z-20 shadow-2xl overflow-hidden",children:[o.jsxs("div",{className:"p-8 border-b border-white/5 bg-black/20 shrink-0",children:[o.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-amber-500 mb-6 flex items-center justify-between",children:["Rikets Formue",o.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full animate-pulse shadow-[0_0_10px_rgba(245,158,11,0.5)]"})]}),o.jsxs("div",{className:"space-y-4",children:[Object.values(t.players||{}).sort((s,n)=>(n.resources.gold||0)-(s.resources.gold||0)).slice(0,5).map((s,n)=>o.jsxs("div",{className:"flex justify-between items-center group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsxs("span",{className:"text-xs font-black text-slate-600 font-mono",children:["#",n+1]}),o.jsx("span",{className:"text-sm font-bold text-white group-hover:translate-x-1 transition-transform",children:s.name})]}),o.jsxs("span",{className:"text-sm font-black text-amber-400",children:[s.resources.gold,""]})]},s.id)),Object.keys(t.players||{}).length===0&&o.jsx("p",{className:"text-[10px] text-slate-600 font-bold italic text-center py-4",children:"Ingen data tilgjengelig..."})]})]}),o.jsxs("div",{className:"p-8 border-b border-white/5 shrink-0",children:[o.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-indigo-400 mb-6",children:"Markedsanalyse"}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Object.entries(t.market||{}).slice(0,4).map(([s,n])=>{const i=Ge[s]||{label:s};return o.jsxs("div",{className:"bg-white/5 p-3 rounded-xl border border-white/5",children:[o.jsx("div",{className:"text-[8px] font-black uppercase text-slate-500 mb-1",children:i.label}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-xs font-black text-white",children:n.stock}),o.jsxs("span",{className:"text-[10px] font-mono text-emerald-400",children:[n.price.toFixed(1),"g"]})]})]},s)}),Object.entries(t.market||{}).slice(0,4).length===0&&o.jsx("div",{className:"col-span-2 text-[10px] text-slate-600 font-bold italic text-center py-4",children:"Ingen markedsdata..."})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[o.jsx("div",{className:"p-8 pb-4 shrink-0",children:o.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-rose-500 flex items-center gap-2",children:[o.jsx("span",{className:"w-2 h-2 bg-rose-600 rounded-full animate-pulse shadow-[0_0_10px_rgba(225,29,72,0.5)]"}),"Global Logg"]})}),o.jsxs("div",{className:"flex-1 overflow-y-auto px-6 space-y-3 pb-8 custom-scrollbar",children:[o.jsx(qt,{initial:!1,children:e(t.messages).slice().reverse().map((s,n)=>{const i=typeof s=="object"&&s.id||n;return o.jsx(ee.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"bg-indigo-950/20 border-l-2 border-indigo-500/50 p-4 rounded-r-2xl",children:o.jsx("p",{className:"text-[10px] font-medium leading-relaxed text-slate-400 antialiased italic font-serif opacity-80",children:typeof s=="object"?s.text||JSON.stringify(s):s})},i)})}),e(t.messages).length===0&&o.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-20 py-20",children:[o.jsx("span",{className:"text-4xl mb-4",children:""}),o.jsx("p",{className:"text-[8px] font-black uppercase tracking-[0.2em]",children:"Arkivet er tomt"})]})]})]})]})});class pJ{constructor(e){Ie(this,"genome");this.genome=e}decide(e,s){var c;const n=[],i=e.status.stamina,r=(1-i/100)*this.genome.weights.hungerThreshold*5;e.resources.bread>0&&i<80&&n.push({action:{type:"EAT"},score:r,reason:"Sulten"}),i<50&&n.push({action:{type:"SLEEP"},score:(1-i/100)*this.genome.weights.restFocus*3,reason:"Trtt"}),n.push({action:{type:"CHOP"},score:this.genome.weights.gatherWood*this.getNeedMultiplier(e,"wood"),reason:"Trengte ved"}),n.push({action:{type:"QUARRY"},score:this.genome.weights.gatherStone*this.getNeedMultiplier(e,"stone"),reason:"Trengte stein"}),n.push({action:{type:"MINE"},score:this.genome.weights.gatherIron*this.getNeedMultiplier(e,"iron_ore"),reason:"Trengte jernmalm"}),n.push({action:{type:"WORK"},score:this.genome.weights.gatherGrain*this.getNeedMultiplier(e,"grain"),reason:"Trengte korn"});const a=((c=s.markets)==null?void 0:c[e.regionId])||s.market;a&&Object.entries(e.resources).forEach(([u,d])=>{if(u==="gold")return;const h=a[u];if(h&&d>10){const f=h.price;n.push({action:{type:"SELL",itemId:u,amount:Math.floor(d/2)},score:this.genome.weights.marketAggression*(f/20)*(d/50),reason:`Selger ${u} for gull`})}}),e.resources.gold>200&&n.push({action:{type:"CONTRIBUTE_TO_UPGRADE",buildingId:"great_hall"},score:this.genome.weights.promotionFocus*(e.resources.gold/1e3),reason:"Vil bli mektigere"});const l=n.filter(u=>{const d=typeof u.action=="string"?u.action:u.action.type,h=Ec[d];if(!h)return!0;if(i<(h.stamina||0))return!1;for(const[f,m]of Object.entries(h))if(f!=="stamina"&&(e.resources[f]||0)<m)return!1;return!0});return l.length===0?{action:"IDLE",score:0,reason:"Ingenting  gjre"}:(l.sort((u,d)=>d.score-u.score),l[0])}getNeedMultiplier(e,s){const n=e.resources[s]||0;return n<5?2:n<20?1.2:n>100?.5:1}}const gJ=(t=0)=>({id:`genome_${Date.now()}_${Math.floor(Math.random()*1e3)}`,generation:t,weights:{gatherWood:Math.random()*2,gatherStone:Math.random()*2,gatherIron:Math.random()*2,gatherGrain:Math.random()*2,marketAggression:Math.random()*2,savingsFocus:Math.random()*2,upgradeFocus:Math.random()*2,hungerThreshold:.2+Math.random()*.6,restFocus:Math.random()*2,promotionFocus:Math.random()*2,contributionFocus:Math.random()*2}}),xJ=(t,e=.1)=>{const s={...t.weights};return Object.keys(s).forEach(n=>{if(Math.random()<.2){const i=(Math.random()*2-1)*e;s[n]=Math.max(0,Math.min(2,s[n]+i))}}),{...t,id:`genome_${Date.now()}_${Math.floor(Math.random()*1e3)}`,weights:s,generation:t.generation+1,parents:[t.id],fitness:void 0}},aT="eiriksbok_ai_top_genomes";class Lb{static calculateFitness(e,s){const n=(e.resources.gold||0)+Object.values(e.resources).reduce((l,c)=>l+(typeof c=="number"?c:0),0)*.5,r={PEASANT:1,SOLDIER:5,MERCHANT:10,BARON:50,KING:200}[e.role]||1,a=Math.max(1,(Date.now()-s)/6e4);return(n+r*100)/a}static saveTopGenomes(e){const s=[...e].filter(n=>n.fitness!==void 0).sort((n,i)=>(i.fitness||0)-(n.fitness||0)).slice(0,3);localStorage.setItem(aT,JSON.stringify(s))}static getTopGenomes(){const e=localStorage.getItem(aT);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}static getNextGenerationGenome(){const e=this.getTopGenomes();if(e.length===0)return gJ(0);const s=e[Math.floor(Math.random()*e.length)];return xJ(s)}}const cO={CHOP:["AXE","OFF_HAND"],MINE:["PICKAXE","OFF_HAND"],QUARRY:["CHISEL","OFF_HAND"],WORK:["SCYTHE","OFF_HAND"],RAID:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],DEFEND:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],PATROL:["MAIN_HAND","OFF_HAND","BODY"],EXPLORE:["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET"],CRAFT:["MAIN_HAND","AXE","PICKAXE","SCYTHE","HAMMER"],HUNT:["MAIN_HAND","BOW","TRAP"],FORAGE:["MAIN_HAND","TRAP"],GATHER_WOOL:["MAIN_HAND","OFF_HAND"],SAWMILL:["MAIN_HAND","OFF_HAND"],PLANT:["MAIN_HAND","OFF_HAND"],HARVEST:["SCYTHE","OFF_HAND","MAIN_HAND"]},Pb=(t,e)=>{const s=cO[e];return!s||!t.equipment?[]:s.map(n=>{var i;return(i=t.equipment)==null?void 0:i[n]}).filter(n=>{var i,r;if(!n)return!1;if((i=n.relevantActions)!=null&&i.includes(e))return!0;if(!n.relevantActions){const a=n.id.split("_").slice(0,2).join("_"),l=qe[n.id]||qe[a]||Object.values(qe).find(c=>n.id.startsWith(c.id));return(r=l==null?void 0:l.relevantActions)!=null&&r.includes(e)?!0:!l||!l.relevantActions}return!1})},Oc=(t,e)=>{const s=cO[e];return!s||!t.equipment?[]:s.filter(n=>{var r,a,l;const i=(r=t.equipment)==null?void 0:r[n];if(!i)return!1;if((a=i.relevantActions)!=null&&a.includes(e))return!0;if(!i.relevantActions){const c=i.id.split("_").slice(0,2).join("_"),u=qe[i.id]||qe[c]||Object.values(qe).find(d=>i.id.startsWith(d.id));return(l=u==null?void 0:u.relevantActions)!=null&&l.includes(e)?!0:!u||!u.relevantActions}return!1})},uO=(t,e,s="Spring",n="Clear",i=0)=>{var d;let r=typeof e=="string"?e:e.type,a=typeof e=="object"?{...e}:{};r.startsWith("REFINE_")&&!ga[r]?(a.recipeId=r.replace("REFINE_","").toLowerCase(),r="REFINE"):r.startsWith("CRAFT_")&&!Sn[r]?(a.subType=r.replace("CRAFT_","").toLowerCase(),r="CRAFT"):Sn[r]&&(a.subType=r,r="CRAFT");const l=Pb(t,r);for(const h of l)if(h.durability<=0)return{success:!1,reason:`delagt: ${h.name}`};if(r==="GATHER_WOOL"&&l.length===0)return{success:!1,reason:"Du mangler Saks"};let c={};const u=Ec[r];if(u&&(c={...u}),r==="REFINE"||r==="CRAFT"){let h;r==="REFINE"&&(h=ga[a.recipeId]),r==="CRAFT"&&(h=Sn[a.subType]),h&&(h.stamina!==void 0&&(c.stamina=h.stamina),h.input&&Object.entries(h.input).forEach(([f,m])=>{c[f]=(c[f]||0)+m}))}if(Object.keys(c).length>0){const h=Nn[s],f=Vi[n],m=(h==null?void 0:h.staminaMod)||1,b=(f==null?void 0:f.staminaMod)||1,x=xa(i)==="NIGHT",v=x?1.2:1,g=c.stamina||0;if(r==="SLEEP"&&!x)return{success:!1,reason:"Du kan bare sove nr det er natt"};if(r==="PLANT"&&s==="Winter")return{success:!1,reason:"Bakken er frossen - du kan ikke s om vinteren"};if(a.locationId==="farm_well"||a.locationId==="well_water"||r==="GATHER_WATER"){const w=a.locationId||(r==="GATHER_WATER"?"well_water":null);if(w){const S=(d=t.activeProcesses)==null?void 0:d.find(_=>_.type==="WELL"&&_.locationId===w);if(S&&S.readyAt>Date.now())return{success:!1,reason:"Brnnen fyller seg med vann..."}}}const y=Math.ceil(g*m*b*v);if((t.status.stamina||0)<y)return{success:!1,reason:`Du mangler ${Math.ceil(y-(t.status.stamina||0))} energi`};const k={bread:"brd",gold:"gull",wood:"tre",flour:"mel",grain:"korn",iron_ingot:"jernbarrer",plank:"planker",stone:"stein",meat:"kjtt",honey:"honning",wool:"ull",iron_ore:"jernmalm",cloth:"stoff",stamina:"energi"};for(const[w,S]of Object.entries(c)){if(w==="stamina")continue;const _=t.resources[w]||0;if(_<S){const T=k[w]||w;return{success:!1,reason:`Du mangler ${S-_} ${T}`}}}}return{success:!0}},dO=(t,e="Spring",s="Clear",n=0)=>{let i=typeof t=="string"?t:t.type,r=typeof t=="object"?{...t}:{};i.startsWith("REFINE_")&&!ga[i]?(r.recipeId=i.replace("REFINE_","").toLowerCase(),i="REFINE"):i.startsWith("CRAFT_")&&!Sn[i]?(r.subType=i.replace("CRAFT_","").toLowerCase(),i="CRAFT"):Sn[i]&&(r.subType=i,i="CRAFT");let a={};const l=Ec[i];if(l&&(a={...l}),i==="REFINE"||i==="CRAFT"){let d;i==="REFINE"&&(d=ga[r.recipeId]),i==="CRAFT"&&(d=Sn[r.subType]),d&&(d.stamina!==void 0&&(a.stamina=d.stamina),d.input&&Object.entries(d.input).forEach(([h,f])=>{a[h]=(a[h]||0)+f}))}if(Object.keys(a).length===0)return null;const c=[];if(a.stamina){const d=Nn[e],h=Vi[s],m=xa(n)==="NIGHT"?1.2:1,b=((d==null?void 0:d.staminaMod)||1)*((h==null?void 0:h.staminaMod)||1)*m,x=Math.ceil(a.stamina*b);let v="-";a.stamina<0&&(v="+"),c.push(`${v}${Math.abs(x)}`)}const u={bread:"",gold:"",wood:"",flour:"",grain:"",iron_ingot:"",plank:"",stone:"",meat:"",honey:"",wool:"",iron_ore:"",cloth:""};for(const[d,h]of Object.entries(a)){if(d==="stamina")continue;const f=h,m=u[d]||d;c.push(`-${f}${m}`)}return c.join(" ")},bJ=(t,e,s)=>{t.activeProcesses||(t.activeProcesses=[]),t.activeProcesses.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,type:"COOLDOWN",locationId:e,itemId:"cooldown",notified:!1,startedAt:Date.now(),readyAt:Date.now()+s,duration:s})},vJ=t=>{const{actor:e,action:s,localResult:n}=t,i=s.processId;if(!e.activeProcesses)return n.success=!1,n.message="Ingen aktive prosesser.",!1;const r=e.activeProcesses.find(l=>l.id===i);if(!r)return n.success=!1,n.message="Fant ikke avlingen (kanskje den allerede er ferdig?).",!1;if(r.type!=="CROP")return n.success=!1,n.message="Kan bare vedlikeholde avlinger.",!1;if(r.maintainCount===void 0&&(r.maintainCount=0),r.yieldBonus===void 0&&(r.yieldBonus=0),r.maintainCount>=3)return n.success=!1,n.message="Denne keren er allerede perfekt vedlikeholdt.",!1;r.maintainCount+=1,r.yieldBonus+=.05;const a=s.subType==="WEED"?"Lukte ugress":"Skremte vekk krka";return n.message=`${a}! (+5% Utbytte).`,!0},yJ=t=>{var h;const{actor:e,action:s,localResult:n,timestamp:i}=t,r=s.cropId||"grain",a=E_[r];if(!a)return n.success=!1,n.message=`Ukjent grde: ${r}`,!1;if((((h=t.room.world)==null?void 0:h.season)||"Spring")==="Winter")return n.success=!1,n.message="Du kan ikke s om vinteren - bakken er frossen.",!1;e.activeProcesses||(e.activeProcesses=[]);const c=s.locationId||"grain_fields",u=e.activeProcesses.find(f=>f.type==="CROP"&&f.locationId===c);if(u){const f=Date.now();if(u.readyAt<=f){const m=e.activeProcesses.indexOf(u);m>-1&&e.activeProcesses.splice(m,1)}else return n.success=!1,n.message="Det vokser allerede noe her.",!1}const d={id:Math.random().toString(36).substr(2,9),type:"CROP",itemId:r,locationId:c,startedAt:Date.now(),duration:a.duration,readyAt:Date.now()+a.duration,notified:!1};return e.activeProcesses.push(d),n.message=`Sdde ${a.label}. Klar om ${Math.ceil(a.duration/6e4)} min.`,!0},_J=t=>{var y,k,w;const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r,room:a}=t,l=Date.now(),c=s.locationId||"grain_fields",u=(y=e.activeProcesses)==null?void 0:y.findIndex(S=>S.locationId===c&&S.readyAt<=l);if(u===void 0||u===-1)return n.success=!1,n.message="Ingenting er klart til innhsting her.",!1;const d=e.activeProcesses[u];let h="",f=0,m="",b=0,x="FARMING";const v=E_[d.itemId],g=ga[d.itemId];if(v){m=v.label,h=v.yieldResource;const S=s.performance||.5,_=v.minYield+(v.maxYield-v.minYield)*S,T=((k=a.world)==null?void 0:k.season)||"Spring",E=Nn[T],A=1+(d.yieldBonus||0);f=Math.ceil(_*((E==null?void 0:E.yieldMod)||1)*A),b=Math.ceil(v.xp*(1+S))}else if(g){m=g.label,h=g.outputResource;const S=((w=g.output)==null?void 0:w.amount)||g.outputAmount||1,_=s.performance||.5;f=vi(e,S,"CRAFTING",{performance:_,isRefining:!0}),b=g.xp||10,x=g.skill||"CRAFTING"}else return n.success=!1,n.message="Ugyldig prosess-data.",!1;return e.activeProcesses.filter(S=>S.locationId===c&&S.readyAt<=l).forEach(S=>{const _=e.activeProcesses.indexOf(S);_>-1&&e.activeProcesses.splice(_,1)}),Oc(e,"WORK").forEach(S=>{r(S,re.DURABILITY.LOSS_WORK)}),e.resources[h]||(e.resources[h]=0),e.resources[h]+=f,n.utbytte.push({resource:h,amount:f}),n.message=`Hstet ${f} ${m}`,i(x,b),!0},wJ=t=>{var v,g,p,y,k,w,S;const{actor:e,room:s,action:n,localResult:i,trackXp:r,damageTool:a}=t,l=((v=s.world)==null?void 0:v.activeLaws)||[];Oc(e,"WORK").forEach(_=>{a(_,re.DURABILITY.LOSS_WORK)});let c=1;l.includes("conscription")&&(c=.8);const u=re.YIELD.WORK_GRAIN+((g=e.upgrades)!=null&&g.includes("iron_plow")?5:0),d=((p=s.world)==null?void 0:p.season)||"Spring",h=((y=s.world)==null?void 0:y.weather)||"Clear",f=Nn[d],m=Vi[h],b=n.performance||.5,x=vi(e,u,"FARMING",{season:(f==null?void 0:f.yieldMod)||1,weather:(m==null?void 0:m.yieldMod)||1,law:c,performance:b,actionType:"WORK",regionId:e.regionId});if(e.resources.grain=(e.resources.grain||0)+x,i.utbytte.push({resource:"grain",amount:x}),i.message=`Hstet ${x} korn`,r("FARMING",Math.ceil(rh.WORK.xp*(1+b))),Math.random()<re.LUCKY_DROP.CHANCE+(((S=(w=(k=e.equipment)==null?void 0:k.HEAD)==null?void 0:w.stats)==null?void 0:S.luckBonus)||0)){const _=Math.ceil(x*.5),T=x+_;e.resources.grain+=_,i.utbytte.push({resource:"grain",amount:_,bonus:!0}),i.message=`Innhstet ${T} korn! (inkl. ${_} flaks)`}return!0},kJ=t=>{var h,f,m,b;const{actor:e,room:s,action:n,localResult:i,trackXp:r,damageTool:a}=t,l=((h=s.world)==null?void 0:h.season)||"Spring";Oc(e,"CHOP").forEach(x=>{a(x,re.DURABILITY.LOSS_WORK)});let c=re.YIELD.CHOP_WOOD;l==="Summer"&&(c+=re.YIELD.SUMMER_WOOD_BONUS);const u=n.performance||.5,d=vi(e,c,"WOODCUTTING",{performance:u,actionType:"CHOP",regionId:e.regionId});if(e.resources.wood=(e.resources.wood||0)+d,i.utbytte.push({resource:"wood",amount:d}),i.message=`Felte ${d} ved`,r("WOODCUTTING",Math.ceil(rh.CHOP.xp*(1+u))),Math.random()<re.LUCKY_DROP.CHANCE+(((b=(m=(f=e.equipment)==null?void 0:f.HEAD)==null?void 0:m.stats)==null?void 0:b.luckBonus)||0)){const x=Math.ceil(d*.5),v=d+x;e.resources.wood+=x,i.utbytte.push({resource:"wood",amount:x,bonus:!0}),i.message=`Felte ${v} ved! (inkl. ${x} flaks)`}return!0},oT=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t,a=typeof s=="string"?s:s.type;Oc(e,a).forEach(f=>{r(f,re.DURABILITY.LOSS_WORK)});const l="MINING",c=a==="MINE"?re.YIELD.MINE_ORE:re.YIELD.QUARRY_STONE,u=a==="MINE"?"iron_ore":"stone",d=s.performance||.5,h=vi(e,c,l,{performance:d,actionType:a,regionId:e.regionId});return e.resources[u]=(e.resources[u]||0)+h,n.utbytte.push({resource:u,amount:h}),n.message=a==="MINE"?`Utvant ${h} jernmalm`:`Hogde ${h} stein`,i(l,Math.ceil(rh.WORK.xp*(1+d))),!0},NJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t;Oc(e,"FORAGE").forEach(u=>{r(u,1)});const a=re.YIELD.FORAGE_BREAD,l=s.performance||.5,c=vi(e,a,"FARMING",{performance:l,actionType:"FORAGE"});return e.resources||(e.resources={}),e.resources.bread=(e.resources.bread||0)+c,n.utbytte.push({resource:"bread",amount:c}),n.message=`Sanket ${c} ndproviant (brd/br)`,i("FARMING",Math.ceil(rh.FORAGE.xp*(1+l))),!0},SJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i,damageTool:r}=t;Oc(e,"HUNT").forEach(u=>{r(u,2)});const a=8,l=s.performance||.5,c=vi(e,a,"COMBAT",{performance:l,actionType:"HUNT"});return e.resources.meat=(e.resources.meat||0)+c,n.utbytte.push({resource:"meat",amount:c}),n.message=`Felte bytte og fikk ${c} kjtt`,i("COMBAT",Math.ceil(15*(1+l))),!0},TJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=6,a=s.performance||.5,l=vi(e,r,"FARMING",{performance:a,actionType:"GATHER_WOOL",requiresTool:!0});return l===0?(n.message="Du trenger en Saks for  klippe sauene!",!1):(e.resources.wool=(e.resources.wool||0)+l,n.utbytte.push({resource:"wool",amount:l}),n.message=`Klippet sauer og fikk ${l} ull`,i("FARMING",Math.ceil(10*(1+a))),!0)},EJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.locationId||"beehives";e.activeProcesses||(e.activeProcesses=[]);const a=e.activeProcesses.find(d=>d.type==="HIVE"&&d.locationId===r);if(a){if(a.readyAt>Date.now())return n.success=!1,n.message="Biene trenger hvile fr de kan lage mer honning.",!1;e.activeProcesses=e.activeProcesses.filter(d=>d.id!==a.id)}const l=4,c=s.performance||.5,u=vi(e,l,"FARMING",{performance:c,actionType:"GATHER_HONEY"});return e.resources.honey=(e.resources.honey||0)+u,n.utbytte.push({resource:"honey",amount:u}),n.message=`Hentet ${u} honning fra bikubene`,i("FARMING",Math.ceil(12*(1+c))),e.activeProcesses.push({id:"hive_"+Date.now(),type:"HIVE",itemId:"honey",locationId:r,startedAt:Date.now(),duration:3e5,readyAt:Date.now()+3e5,notified:!1}),!0},AJ=t=>{const{actor:e,localResult:s}=t,n=5;if((e.resources.grain||0)<n)return s.success=!1,s.message=`Mangler korn. Trenger ${n} korn for  mate hnene.`,!1;if(e.activeProcesses||(e.activeProcesses=[]),e.activeProcesses.find(l=>l.type==="COOP"&&l.locationId==="chicken_coop"&&l.readyAt>Date.now()))return s.success=!1,s.message="Hnene har allerede mat.",!1;e.resources.grain-=n,s.utbytte.push({resource:"grain",amount:-n});const r=24e4,a={id:Math.random().toString(36).substr(2,9),type:"COOP",itemId:"egg",locationId:"chicken_coop",startedAt:Date.now(),duration:r,readyAt:Date.now()+r,notified:!1};return e.activeProcesses.push(a),s.message="Matet hnene. Egg klare om 4 minutter.",!0},jJ=t=>{var l;const{actor:e,localResult:s,trackXp:n}=t,i=Date.now(),r=(l=e.activeProcesses)==null?void 0:l.findIndex(c=>c.type==="COOP"&&c.locationId==="chicken_coop"&&c.readyAt<=i);if(r===void 0||r===-1)return s.success=!1,s.message="Ingen egg  hente enn.",!1;e.activeProcesses.splice(r,1);const a=Math.floor(Math.random()*3)+3;return e.resources.egg||(e.resources.egg=0),e.resources.egg+=a,s.utbytte.push({resource:"egg",amount:a}),s.message=`Samlet ${a} egg.`,n("FARMING",15),!0},CJ=t=>{var c,u,d,h,f,m,b,x,v;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,a=n.subType,l=Sn[a];if(l){if((((h=(d=(u=(c=s.world)==null?void 0:c.settlement)==null?void 0:u.buildings)==null?void 0:d[l.buildingId])==null?void 0:h.level)||1)<l.level)return i.success=!1,i.message=`Mangler bygningsniv ${l.level} for  lage dette.`,!1;let p=!0;if(Object.entries(l.input).forEach(([y,k])=>{e.resources[y]<k&&(p=!1)}),p){Object.entries(l.input).forEach(([w,S])=>{e.resources[w]-=S});const y=l.outputItemId;if(Ge[y]||y==="omelette"){const w=l.outputAmount||1;e.resources[y]=(e.resources[y]||0)+w,i.utbytte.push({resource:y,amount:w});const S=(f=Ge[y])==null?void 0:f.label,_=(m=qe[y])==null?void 0:m.name;i.message=`Laget ${w}x ${S||_||y}!`,r("CRAFTING",25*l.level),Hn(s.pin,"crafted",y,w)}else{const w=qe[y];if(w){const S={...w,id:`${w.id}_${Date.now()}_${Math.floor(Math.random()*1e3)}`};e.inventory||(e.inventory=[]),e.inventory.push(S),i.utbytte.push({resource:y,amount:1}),i.message=`Smidde ${S.name}!`,r("CRAFTING",25*l.level),Hn(s.pin,"crafted",y,1)}}if(l.stamina){const w=((b=s.world)==null?void 0:b.season)||"Spring",S=((x=s.world)==null?void 0:x.weather)||"Clear",_=On(l.stamina,w,S,e.activeBuffs,((v=s.world)==null?void 0:v.gameTick)||0);(e.status.stamina||0)<_?(i.success=!1,i.message=`For lite stamina! Krever ${_}`):e.status.stamina-=_}}else return i.success=!1,i.message="Mangler ressurser for  smi.",!1}return!0},Bo=t=>{var c,u,d,h,f,m,b,x,v;const{actor:e,room:s,action:n,localResult:i,trackXp:r}=t,a=n.recipeId,l=ga[a];if(l){const g=((h=(d=(u=(c=s.world)==null?void 0:c.settlement)==null?void 0:u.buildings)==null?void 0:d[l.buildingId])==null?void 0:h.level)||1;if(l.requiredLevel&&g<l.requiredLevel)return i.success=!1,i.message=`Utvidelse kreves: ${l.buildingId} m vre Niv ${l.requiredLevel}.`,!1;let p=!0;Object.entries(l.input).forEach(([_,T])=>{e.resources[_]<T&&(p=!1)});const y=((f=s.world)==null?void 0:f.season)||"Spring",k=((m=s.world)==null?void 0:m.weather)||"Clear",w=l.stamina||0,S=On(w,y,k,e.activeBuffs,((b=s.world)==null?void 0:b.gameTick)||0);if((e.status.stamina||0)<S)return p=!1,i.message=`For lite stamina! Krever ${S}`,i.success=!1,!1;if(p){let _=n.performance||0;const E=Math.max(0,g-(l.requiredLevel||1))*.25,A=_*.5,j=1-Math.min(.9,E+A),O=l.duration?Math.max(l.duration*.1,l.duration*j):0;if(l.duration){e.activeProcesses||(e.activeProcesses=[]);const F=n.locationId||l.buildingId;if(e.activeProcesses.find(C=>C.locationId===F))return i.success=!1,i.message="Det pgr allerede en prosess her.",!1;Object.entries(l.input).forEach(([C,$])=>{e.resources[C]-=$}),e.status.stamina-=S;const R={id:Math.random().toString(36).substr(2,9),type:a==="flour"?"MILL":"CRAFT",itemId:a,locationId:F,startedAt:Date.now(),duration:O,readyAt:Date.now()+O,notified:!1};return e.activeProcesses.push(R),i.message=`Startet ${l.label.toLowerCase()}. Ferdig om ${Math.ceil(O/6e4)} minutter (-${S}).`,!0}Object.entries(l.input).forEach(([F,U])=>{e.resources[F]-=U}),e.status.stamina-=S,_=n.performance!==void 0?n.performance:.5;const H=((x=l.output)==null?void 0:x.amount)||l.outputAmount||1,L=1+Math.max(0,g-(l.requiredLevel||1))*.2,M=vi(e,H,"CRAFTING",{performance:_,isRefining:!0,upgrades:L}),D=e.resources[l.outputResource]||0;e.resources[l.outputResource]=D+M;const I=((v=Ge[l.outputResource])==null?void 0:v.label)||l.outputResource;i.utbytte.push({resource:l.outputResource,amount:M}),i.message=`Produserte ${M} ${I}`,r("CRAFTING",re.SKILLS.REFINING_XP),Hn(s.pin,"crafted",l.outputResource,M)}else return i.success=!1,i.message="Mangler ressurser til raffinering.",!1}return!0},RJ=t=>{var x,v;const{actor:e,action:s,localResult:n}=t,{targetSlot:i,itemUid:r,buildingId:a}=s;if(!a||!rb[a])return n.success=!1,n.message="Ugyldig reparasjonsstasjon.",!1;const l=rb[a];let c,u="gjenstanden";if(i?c=e.equipment[i]:r&&(c=(x=e.inventory)==null?void 0:x.find(g=>g.id===r)),!c)return n.success=!1,n.message="Fant ikke gjenstanden som skulle repareres.",!1;if(u=c.name,!l.slots.includes(c.type))return n.success=!1,n.message=`Denne stasjonen kan ikke reparere ${u}.`,!1;if(c.durability>=c.maxDurability)return n.success=!1,n.message=`${u} er allerede i perfekt stand.`,!1;const d=l.goldCost,h=1,f=l.material,m=(e.resources.gold||0)>=d,b=(e.resources[f]||0)>=h;if(m&&b){e.resources.gold-=d,e.resources[f]-=h;const g=re.DURABILITY.REPAIR_AMOUNT,p=c.durability;c.durability=Math.min(c.maxDurability,c.durability+g);const y=c.durability-p;n.durability.push({slot:i||c.type,item:c.name,amount:y}),n.message=`Reparerte ${c.name} (+${y} holdbarhet).`}else{n.success=!1;const g=((v=Ge[f])==null?void 0:v.label)||f;return n.message=`Mangler ${m?"":`${d} gull`}${!m&&!b?" og ":""}${b?"":`${h} ${g}`}.`,!1}return!0},IJ=t=>{const{actor:e,action:s,localResult:n}=t,{itemId:i,slot:r}=s;e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]);const a=e.inventory.findIndex(l=>l.id===i);if(a!==-1){const l=e.inventory[a],c=e.equipment[r];e.inventory.splice(a,1),e.equipment[r]=l,c&&e.inventory.push(c),n.message=`Utstyrte ${l.name}`}return!0},OJ=t=>{const{actor:e,action:s,localResult:n}=t,{slot:i}=s,r=e.equipment[i];return r&&(e.equipment[i]=null,e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]),e.inventory.push(r),n.message=`Tok av ${r.name}`),!0},MJ=t=>{const{actor:e,action:s,localResult:n}=t,{itemId:i}=s;e.inventory&&!Array.isArray(e.inventory)&&(e.inventory=Object.values(e.inventory)),e.inventory||(e.inventory=[]);const r=e.inventory.findIndex(a=>a.id===i);if(r!==-1){const a=e.inventory[r];return e.inventory.splice(r,1),n.message=`Slettet ${a.name}`,!0}return n.message="Fant ikke gjenstanden som skulle slettes.",!1},DJ=t=>{const{actor:e,room:s,action:n,localResult:i}=t;if(e.role!=="BARON")return i.success=!1,i.message="Kun Baroner kan kreve inn lokal skatt.",!1;const r=e.regionId,a=s.regions[r];if(!a)return!1;const l=s.world.season,c=s.world.year;if(a.taxHistory||(a.taxHistory=[]),a.lastTaxCollection&&a.lastTaxCollection.year===c&&a.lastTaxCollection.season===l)return i.success=!1,i.message=`Du har allerede krevd inn skatt for ${l} ${c}.`,!1;const u=n.taxRate!==void 0?n.taxRate:a.taxRate||10,d=u/100;let h=0,f=0,m=0,b=0,x=0;const v=(e.regionId||"").trim().toLowerCase();Object.values(s.players).forEach(y=>{var S,_,T;if(!y||y.id===e.id)return;const k=(y.regionId||"").trim().toLowerCase();if(y.role==="PEASANT"&&(k===v||k.includes(v)||v.includes(k))){y.resources||(y.resources={gold:0,grain:0});const E=Number(y.resources.gold??y.gold??y.wealth??((S=y.stats)==null?void 0:S.gold)??((T=(_=y.inventory)==null?void 0:_.find(H=>H.id==="gold"))==null?void 0:T.amount)??0),A=Number(y.resources.grain??0),j=E*d,O=A*d;if(j>0){const H=Math.floor(j);y.resources.gold!==void 0?y.resources.gold-=H:y.gold!==void 0&&(y.gold-=H),b+=j}if(O>0){const H=Math.floor(O);y.resources.grain-=H,x+=O}(j>0||O>0)&&m++}}),h=Math.floor(b),f=Math.floor(x),e.resources||(e.resources={gold:0,grain:0}),e.resources.gold=(e.resources.gold||0)+h,e.resources.grain=(e.resources.grain||0)+f,a.taxRate=u,a.lastTaxCollection={year:c,season:l};const g={year:c,season:l,amountGold:h,amountGrain:f,rate:u,timestamp:Date.now()};a.taxHistory.push(g),a.taxHistory.length>10&&a.taxHistory.shift();const p=Math.max(0,5+Math.floor((u-10)/2));return e.status.legitimacy=Math.max(0,(e.status.legitimacy||100)-p),h>0||f>0?(i.utbytte.push({resource:"gold",amount:h}),i.utbytte.push({resource:"grain",amount:f}),i.message=`Skatteinnkreving (${u}%): ${h}g og ${f} korn fra ${m} bnder. (-${p} Legitimet)`):i.message=`Ingen skatt  hente (sats: ${u}%). (-${p} Legitimet)`,!0},LJ=t=>{const{actor:e,localResult:s}=t;if(e.role!=="BARON"&&e.role!=="KING")return s.success=!1,!1;const n=5,i=10;if((e.resources.gold||0)>=n&&(e.resources.grain||0)>=i)e.resources.gold-=n,e.resources.grain-=i,e.resources.manpower=(e.resources.manpower||0)+10,s.utbytte.push({resource:"manpower",amount:10}),s.message="Mobiliserte tropper (+10 Manpower).";else return s.success=!1,s.message="Mangler ressurser for  mobilisere.",!1;return!0},PJ=t=>{const{actor:e,room:s,localResult:n}=t;if(e.role!=="KING")return!1;n.message="UTSTEDTE KONGELIG DEKRET: Ekstraskatt!";let i=0;return Object.values(s.players).forEach(r=>{r.role==="BARON"&&r.resources.gold>=20&&(r.resources.gold-=20,i+=20)}),e.resources.gold=(e.resources.gold||0)+i,n.utbytte.push({resource:"gold",amount:i}),!0},wg=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{buildingId:r,resource:a,amount:l}=n,c=Fs[r];if(!c)return i.success=!1,i.message=`Fant ikke bygning med ID: ${r}`,!1;const u=r==="farm_house";let d;if(u)e.buildings||(e.buildings={}),e.buildings[r]||(e.buildings[r]={level:1,progress:{}}),d=e.buildings[r];else{if(s.world||(s.world={season:"Spring",weather:"Clear",year:1066,gameTick:0,lastTickAt:Date.now(),taxRateDetails:{kingTax:.1},settlement:{buildings:{}}}),s.world.settlement||(s.world.settlement={buildings:{}}),s.world.settlement.buildings||(s.world.settlement.buildings={}),!s.world.settlement.buildings[r]){const S=["manor_ost","manor_vest","throne_room"].includes(r)?0:1;s.world.settlement.buildings[r]={id:r,level:S,progress:{},contributions:{}}}d=s.world.settlement.buildings[r]}if(d.progress||(d.progress={}),e.resources||(e.resources=JSON.parse(JSON.stringify(ms.PEASANT))),!d.level&&d.level!==0){const w=["manor_ost","manor_vest","throne_room"].includes(r);d.level=w?0:1}const h=d.level+1,f=c.levels[h];if(!f)return i.success=!1,i.message="Maksimalt niv ndd.",!1;const b=(f.requirements||{})[a]||0,x=d.progress[a]||0,v=b-x;let g=!0;if(Object.entries(f.requirements).forEach(([w,S])=>{(d.progress[w]||0)<S&&(g=!1)}),v<=0&&!g)return i.success=!1,i.message="Ressurskravet er allerede oppfylt.",!1;const p=e.resources[a]||0,y=Math.min(l,v,p);if(y<=0)return i.success=!1,i.message=`Kan ikke bidra 0 (Har: ${p}, Trenger: ${v}, Bud: ${l})`,!1;if(e.resources[a]=p-y,d.progress[a]=x+y,!u){d.contributions||(d.contributions={}),d.contributions[e.id]||(d.contributions[e.id]={name:e.name,resources:{}});const w=d.contributions[e.id].resources;w[a]=(w[a]||0)+y}i.message=`Bidro med ${y} ${a} til ${c.name}.`,i.utbytte.push({resource:a,amount:-y});let k=!0;if(Object.entries(f.requirements).forEach(([w,S])=>{(d.progress[w]||0)<S&&(k=!1)}),k){if(d.level=h,d.progress={},u||(d.contributions={}),["watchtower","manor_ost","manor_vest"].includes(c.id)){let w="capital";if(c.id==="manor_ost"&&(w="region_ost"),c.id==="manor_vest"&&(w="region_vest"),s.regions&&s.regions[w]){const S=s.regions[w].fortification||{hp:1e3,maxHp:1e3,level:1};S.maxHp+=500,S.hp+=500,S.level=Math.max(S.level,h),s.regions[w].fortification=S,i.message+="  Murene forsterket! (+500 HP)"}}i.message+=`  NYTT NIV: ${c.name} ndde Niv ${h}!`}return!0},VJ=t=>{var c;const{actor:e,room:s,action:n,localResult:i}=t,r=typeof n=="string"?n:n.type,a=n.buildingId||r.replace("UPGRADE_BUILDING_",""),l=Fs[a];if(l){s.world.settlement||(s.world.settlement={buildings:{}});const d=(((c=s.world.settlement.buildings[a])==null?void 0:c.level)||1)+1,h=l.levels[d];if(h){let f=!0;if(Object.entries(h.requirements||{}).forEach(([m,b])=>{(e.resources[m]||0)<b&&(f=!1)}),f){if(Object.entries(h.requirements||{}).forEach(([m,b])=>{e.resources[m]-=b}),s.world.settlement.buildings[a]||(s.world.settlement.buildings[a]={id:a,level:1,progress:{},contributions:{}}),s.world.settlement.buildings[a].level=d,["watchtower","manor_ost","manor_vest"].includes(a)){let m="capital";if(a==="manor_ost"&&(m="region_ost"),a==="manor_vest"&&(m="region_vest"),s.regions&&s.regions[m]){const b=s.regions[m].fortification||{hp:1e3,maxHp:1e3,level:1};b.maxHp+=500,b.hp+=500,b.level=Math.max(b.level,d),s.regions[m].fortification=b}}i.message=`Oppgraderte ${l.name} til Niv ${d}!`}else return i.success=!1,i.message="Mangler ressurser for oppgradering.",!1}}return!0},BJ=t=>{var l;const{actor:e,action:s,localResult:n}=t,i=s.upgradeId,r=e.role,a=T_[r];if(a){const c=a.find(u=>u.id===i);if(c&&!((l=e.upgrades)!=null&&l.includes(i))){let u=!0;if(Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]<h&&(u=!1)}),u)Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]-=h}),e.upgrades||(e.upgrades=[]),e.upgrades.push(i),n.message=`Oppgradering fullfrt: ${c.name}`;else return n.success=!1,n.message="Har ikke rd til oppgradering.",!1}}return!0},FJ=t=>{var c,u;const{actor:e,action:s,localResult:n}=t,i=s.targetRole;if(!i)return n.success=!1,n.message="Ingen rolle spesifisert.",!1;if(e.role===i)return n.success=!1,n.message=`Du er allerede ${i}.`,!1;if(["SOLDIER","MERCHANT","BARON","KING"].includes(i)&&i!=="BARON"&&i!=="KING"){const d=(c=e.roleStats)==null?void 0:c.PEASANT,h=(d==null?void 0:d.level)||(e.role==="PEASANT"?e.stats.level:1),f=re.CAREERS[i];if(f&&h<f.LEVEL_REQ)return n.success=!1,n.message=`Du m vre Bonde Niv ${f.LEVEL_REQ} for  bli ${i}. (N: ${h})`,!1}const a=((u=re.CAREERS[i])==null?void 0:u.COST)||0;if((e.resources.gold||0)<a)return n.success=!1,n.message=`Det koster ${a}g  bli ${i}. (Har: ${e.resources.gold}g)`,!1;e.roleStats||(e.roleStats={}),e.roleStats[e.role]={level:e.stats.level,xp:e.stats.xp,skills:JSON.parse(JSON.stringify(e.skills))},a>0&&(e.resources.gold-=a,n.utbytte.push({resource:"gold",amount:-a}));const l=e.roleStats[i];return l?(e.stats.level=l.level,e.stats.xp=l.xp,e.skills=l.skills):(e.stats.level=1,e.stats.xp=0,e.skills=JSON.parse(JSON.stringify(An[i]||An.PEASANT))),e.role=i,n.message=`Gratulerer! Du er n ${i}.`,!0},UJ=t=>{const{actor:e,action:s,localResult:n}=t,{stage:i,resources:r}=s;if(e.boat||(e.boat={stage:0,model:"standard",componentLevels:{sails:0,hull:0,cannons:0,nets:0},hullType:"standard",stamina:100,durability:100,upgrades:[],hp:100,maxHp:100,cannons:0,cannonballs:50,isDamaged:!1}),i===-1){if(!e.boat.isDamaged)return n.success=!1,n.message="Bten trenger ikke reparasjon.",!1;let l=!0;return Object.entries(r).forEach(([c,u])=>{(e.resources[c]||0)<u&&(l=!1)}),l?(Object.entries(r).forEach(([c,u])=>{e.resources[c]-=u,n.utbytte.push({resource:c,amount:-u})}),e.boat.isDamaged=!1,e.boat.hp=25,n.message="Ndreparasjon fullfrt. Skroget er tett!",!0):(n.success=!1,n.message="Du har ikke nok materialer til  reparere skroget.",!1)}if(i===-2){if(e.boat.hp>=e.boat.maxHp)return n.success=!1,n.message="Bten er allerede i topp stand.",!1;let l=!0;return Object.entries(r).forEach(([c,u])=>{(e.resources[c]||0)<u&&(l=!1)}),l?(Object.entries(r).forEach(([c,u])=>{e.resources[c]-=u,n.utbytte.push({resource:c,amount:-u})}),e.boat.hp=e.boat.maxHp,n.message="Vedlikehold utfrt. Skroget er som nytt!",!0):(n.success=!1,n.message="Mangler materialer til vedlikehold.",!1)}if(e.boat.stage>=i)return n.success=!1,n.message="Du har allerede fullfrt dette trinnet.",!1;if(i!==e.boat.stage+1)return n.success=!1,n.message="Du m fullfre forrige trinn frst.",!1;let a=!0;return Object.entries(r).forEach(([l,c])=>{(e.resources[l]||0)<c&&(a=!1)}),a?(Object.entries(r).forEach(([l,c])=>{e.resources[l]-=c,n.utbytte.push({resource:l,amount:-c})}),e.boat.stage=i,n.message=`Btbygging: Fullfrte steg ${i}!`,e.stats.xp+=100,e.skills.CRAFTING&&(e.skills.CRAFTING.xp+=50),!0):(n.success=!1,n.message="Mangler ressurser for  bygge bten.",!1)},$J=t=>{const{actor:e,action:s,localResult:n}=t,{componentId:i}=s;if(!e.boat)return n.success=!1,n.message="Du har ingen bt  oppgradere.",!1;e.boat.componentLevels||(e.boat.componentLevels={sails:0,hull:0,cannons:0,nets:0});const r=e.boat.componentLevels[i]||0,a=A_[i];if(!a)return n.success=!1,n.message="Ukjent oppgradering.",!1;const l=r,c=a.levels[l];if(!c)return n.success=!1,n.message="Maksimalt niv ndd for denne komponenten.",!1;let u=!0;return Object.entries(c.cost).forEach(([d,h])=>{(e.resources[d]||0)<h&&(u=!1)}),u?(Object.entries(c.cost).forEach(([d,h])=>{e.resources[d]-=h,n.utbytte.push({resource:d,amount:-h})}),e.boat.componentLevels[i]=r+1,i==="hull"&&(e.boat.maxHp+=50),i==="cannons"&&(e.boat.cannons+=1),n.message=`Oppgraderte ${a.name} til Niv ${c.level}!`,!0):(n.success=!1,n.message="Mangler ressurser for oppgradering.",!1)},HJ=t=>{const{actor:e,action:s,localResult:n}=t,{modelId:i}=s;if(!e.boat)return n.success=!1,n.message="Du m bygge en bt frst.",!1;const r=Zp[i];if(!r)return n.success=!1,n.message="Ukjent btmodell.",!1;if(e.boat.model===i)return n.success=!1,n.message="Du har allerede denne modellen.",!1;let a=!0;return Object.entries(r.cost).forEach(([l,c])=>{(e.resources[l]||0)<c&&(a=!1)}),a?e.boat.stage<4?(n.success=!1,n.message="Du m fullfre grunnkonstruksjonen (Steg 4) fr du kan bytte modell.",!1):(Object.entries(r.cost).forEach(([l,c])=>{e.resources[l]-=c,n.utbytte.push({resource:l,amount:-c})}),e.boat.model=i,e.boat.maxHp=r.baseHp,e.boat.hp=r.baseHp,n.message=`Kjpte ny bt: ${r.name}!`,!0):(n.success=!1,n.message=`Har ikke rd til ${r.name}.`,!1)},GJ=t=>{var h;const{actor:e,action:s,localResult:n}=t,{cosmeticType:i,id:r}=s;if(!e.boat)return!1;if(e.boat.customization||(e.boat.customization={color:"#4b2c20",flagId:"none",figurehead:"none",unlocked:[]}),(Array.isArray(e.boat.customization.unlocked)?e.boat.customization.unlocked:e.boat.customization.unlocked=[]).includes(r)){const f={...e.boat.customization};return i==="color"&&(f.color=((h=Nu.colors.find(m=>m.id===r))==null?void 0:h.hex)||"#4b2c20"),i==="flag"&&(f.flagId=r),e.boat={...e.boat,customization:f},n.message="Endret utseende.",!0}let l=null;if(i==="color"&&(l=Nu.colors.find(f=>f.id===r)),i==="flag"&&(l=Nu.flags.find(f=>f.id===r)),!l)return n.success=!1,n.message="Ukjent gjenstand.",!1;const c=l.cost||{};let u=!0;if(Object.entries(c).forEach(([f,m])=>{(e.resources[f]||0)<m&&(u=!1)}),!u)return n.success=!1,n.message="For dyrt.",!1;Object.entries(c).forEach(([f,m])=>{e.resources[f]-=m,n.utbytte.push({resource:f,amount:-m})}),e.boat.customization.unlocked.push(r);const d={...e.boat.customization};return i==="color"&&(d.color=l.hex),i==="flag"&&(d.flagId=r),e.boat={...e.boat,customization:d},n.message=`Kjpte ${l.name}!`,!0},zJ=.15,lT=15,qJ=t=>{var d,h,f;const{actor:e,room:s,localResult:n,action:i}=t,r=((d=i.payload)==null?void 0:d.targetRegionId)||e.regionId,a=r==="capital"&&e.role==="BARON";if(!r||!a&&(r==="capital"||r==="unassigned"))return n.success=!1,n.message=r==="capital"&&e.role!=="BARON"?"Bare baroner kan g til beleiring av hovedstaden.":"Du m angi en gyldig region for  starte beleiring.",!1;if(!s.regions)return console.error("CRITICAL: room.regions is undefined in handleStartSiege",s),n.success=!1,n.message="Systemfeil: Kunne ikke hente regiondata.",!1;const l=s.regions[r];if(!l)return n.success=!1,n.message="Regionen eksisterer ikke.",!1;if(l.activeSiege)return n.success=!1,n.message="Beleiring pgr allerede!",!1;if(l.rulerName===e.name)return n.success=!1,n.message="Du kan ikke beleire ditt eget slott!",!1;const c=((h=e.resources)==null?void 0:h.siege_sword)||0;if(c<500)return n.success=!1,n.message=`Du trenger minst 500 beleiringssverd i forsyninger for  starte en beleiring! (Eier: ${c})`,!1;const u=((f=l.fortification)==null?void 0:f.hp)||1e3;return l.activeSiege={phase:"BREACH",startedAt:Date.now(),lastTick:Date.now(),attackers:{[e.id]:{lane:1,hp:100,name:e.name}},defenders:{},gateHp:u,maxGateHp:u},n.message=`Beleiringen av ${l.name} har startet!`,!0},KJ=t=>{var m,b,x;const{actor:e,room:s,localResult:n,action:i}=t,r=((m=i.payload)==null?void 0:m.targetRegionId)||e.regionId;if(!r||!((b=s.regions[r])!=null&&b.activeSiege))return n.success=!1,n.message="Ingen aktiv beleiring her.",!1;const a=s.regions[r].activeSiege,l=a.attackers||{},c=a.defenders||{};if(l[e.id]||c[e.id])return n.message="Du deltar allerede.",!1;const u=e.regionId===r,d=["BARON","KING"].includes(e.role);if(!u&&!d)return n.success=!1,n.message="Bare innbyggere eller adelen kan delta i krigfring i dette omrdet.",!1;const h=((x=i.payload)==null?void 0:x.side)==="DEFENDER",f={damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0};return h?(a.defenders||(a.defenders={}),a.defenders[e.id]={lane:1,hp:100,name:e.name,stats:f},n.message="Du forsvarer murene!"):(a.attackers||(a.attackers={}),a.attackers[e.id]={lane:1,hp:100,name:e.name,stats:f},n.message="Du har sluttet deg til beleiringen!"),!0},WJ=t=>{var d,h,f,m,b,x,v,g,p,y,k,w,S,_,T,E,A,j,O,H,G,L,M,D;const{actor:e,room:s,action:n,localResult:i}=t,r=((d=n.payload)==null?void 0:d.targetRegionId)||e.regionId;if(!r||!((h=s.regions[r])!=null&&h.activeSiege))return i.success=!1,i.message="Ingen aktiv beleiring funnet i dette omrdet.",!1;const a=s.regions[r].activeSiege,l=a.attackers||{},c=a.defenders||{},u=l[e.id]||c[e.id];if(!u)return i.message="Du m vre deltaker i beleiringen (angriper eller forsvarer) for  delta i kapplpet.",!1;if(a.phase==="BREACH"){if(n.subType==="ATTACK_GATE"){const F=(((f=e.resources)==null?void 0:f.siege_sword)||0)>0,U=F?25:2;return F&&(e.resources.siege_sword-=1),a.gateHp=Math.max(0,(a.gateHp||1e3)-U),u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=U,i.message=F?` Du hugger ls p porten! (-${U} HP). Du har ${e.resources.siege_sword} beleiringssverd igjen.`:` Du slr p porten med nevene... det gjr nesten ingen skade. (-${U} HP)`,F&&i.utbytte.push({resource:"siege_sword",amount:-1}),a.gateHp<=0&&(a.phase="COURTYARD",a.gateHp=0,i.message="PORTEN ER KNUST! Storm borggrden!"),!0}if(n.subType==="SHIELD_WALL")return!0}if(a.phase==="COURTYARD"){const I=a;if(!I.bossHp){const C=(((b=(m=s.regions[r])==null?void 0:m.garrison)==null?void 0:b.armor)||0)*20,$=1e4;I.bossHp=$+C,I.maxBossHp=$+C,I.bossTargetLane=1,I.nextBossAttack=Date.now()+5e3}if(n.subType==="MOVE_LANE"){const R=(x=n.payload)==null?void 0:x.lane;R>=0&&R<=2&&(u.lane=R,i.message=`Forflyttet til bane ${R===0?"Venstre":R===1?"Midten":"Hyre"}.`)}if(n.subType==="ATTACK_BOSS"){const R=((v=e.resources)==null?void 0:v.siege_sword)||0,C=((p=(g=s.regions[r])==null?void 0:g.garrison)==null?void 0:p.swords)||0,$=!!c[e.id];let V=2,P=!1;return R>0?(V=25,e.resources.siege_sword-=1,i.utbytte.push({resource:"siege_sword",amount:-1})):$&&C>0&&(V=25,s.regions[r].garrison&&(s.regions[r].garrison.swords-=1,P=!0)),I.bossHp-=V,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=V,i.message=P?` Du bruker et sverd fra salens garnison og angriper bossen! (-${V} HP)`:V>2?` Du angriper bossen med ditt eget sverd! (-${V} HP). Du har ${e.resources.siege_sword} igjen.`:` Du slr p bossen med nevene... (-${V} HP)`,!0}const F=((k=(y=s.regions[r])==null?void 0:y.fortification)==null?void 0:k.level)||1,U=zJ+F*.05;if(Date.now()>I.nextBossAttack){const R=I.bossTargetLane,C=u.lane===R,$=Math.random()<U;if(C||$){const V=((S=(w=s.regions[r])==null?void 0:w.garrison)==null?void 0:S.swords)||0,P=Math.floor(V/10),W=lT+P,J=(C?20:0)+($?W:0),Y=!!c[e.id],he=((_=e.resources)==null?void 0:_.siege_armor)||0,fe=((E=(T=s.regions[r])==null?void 0:T.garrison)==null?void 0:E.armor)||0;let ce=0,ne=!1;he>0?(ce=Math.min(he,J),e.resources.siege_armor-=ce,i.utbytte.push({resource:"siege_armor",amount:-ce})):Y&&fe>0&&(ce=Math.min(fe,J),s.regions[r].garrison&&(s.regions[r].garrison.armor-=ce,ne=!0));const Le=J-ce;u.hp-=Le,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageTaken+=J,C&&(i.message+=ne?"  Slottets garnison-rustning beskyttet deg fra bossens slag!":ce>=20?"  Rustningen din tok sttet fra bossen!":"  AU! Bossen traff deg!"),$&&(i.message+=ne?"  Portens pilarer og garnison-rustning stoppet pilene!":ce>=lT?"  Rustningen din stoppet pilene!":`  Piler fra murene traff deg! (-${Le} HP)`),Le>0&&ce>0&&(i.message+=` (Rustningen absorberte ${ce} skade)`)}I.bossTargetLane=Math.floor(Math.random()*3),I.nextBossAttack=Date.now()+5e3}if(I.bossHp<=0){a.phase="THRONE_ROOM";const R=s.regions[r].rulerId,C=s.players[R||""],$=C&&Date.now()-(C.lastActive||0)<6e4,V={};$&&R&&C&&(V[R]={id:R,name:C.name,armor:100,progress:20,joinedAt:Date.now()}),a.throne={mode:$?"PVP":"PVE",occupation:0,plundered:!1,bossHp:$?(((A=C==null?void 0:C.status)==null?void 0:A.hp)||100)*5:5e3,maxBossHp:$?(((j=C==null?void 0:C.status)==null?void 0:j.hp)||100)*5:5e3,defendingPlayerId:R,occupiers:V},i.message="GARNISONSSJEFEN ER BESEIRET! Drene til Tronsalen sls opp!"}return!0}if(a.phase==="THRONE_ROOM"||a.phase==="THRONE"){let I=a.throne;(!I||!I.occupiers)&&(I=I||{},I.occupiers=I.occupiers||{},I.lastTick=Date.now(),a.throne=I);const F=Date.now();if(F-(I.lastTick||0)>1e3){const U=Math.floor((F-(I.lastTick||0))/1e3);I.lastTick=F;const R=Object.values(I.occupiers||{}),C=((H=(O=s.regions[r])==null?void 0:O.garrison)==null?void 0:H.armor)||0,$=Math.min(.8,C/100*.1);R.forEach(V=>{var ce;const W=V.id===s.regions[r].rulerId?1*(1-$):1;V.armor=Math.max(0,V.armor-W*U);const J=l[V.id]||c[V.id],fe=1*(1+(((ce=J==null?void 0:J.stats)==null?void 0:ce.damageDealt)||0)/200)*U;if(V.progress=Math.min(100,V.progress+fe),J&&(J.stats=J.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},J.stats.ticksOnThrone+=U),V.armor<=0)delete I.occupiers[V.id],i.message=`${V.name} falt fra tronen! (0 Beleiringsrustning)`;else if(V.progress>=100){delete s.regions[r].activeSiege;const ne=s.regions[r];V.id===ne.rulerId?i.message=` ${V.name} har knust opprret og gjenopprettet kontroll over ${ne.name}!`:(i.message=` ${V.name} har vunnet kappelpet og TATT TRONEN med makt!`,i.siegeWinnerId=V.id,i.targetRegionId=r)}})}if(n.subType==="CLAIM_THRONE"){I.occupiers||(I.occupiers={});const U=10,R=e.resources.siege_armor||0;return R<U?(i.message=`Mangler Beleiringsrustning! Du har ${R}, men trenger ${U}.`,!1):(e.resources.siege_armor=0,I.occupiers[e.id]={id:e.id,name:e.name,armor:R,progress:0,joinedAt:Date.now()},i.message=`${e.name} kastet seg inn i kampen om tronen med ${R} rustning!`,!0)}if(n.subType==="DONATE_ARMOR"){const U=(G=n.payload)==null?void 0:G.targetId,R=I.occupiers[U];if(!R)return i.message="Ugyldig ml.",!1;const C=e.resources.siege_armor||0;return C<1?(i.message="Du har ingen beleiringsrustning  gi!",!1):(e.resources.siege_armor=C-1,R.armor+=1,u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.armorDonated+=1,i.message=`Donerte rustning til ${R.name}`,!0)}if(n.subType==="SUNDER_ARMOR"){const U=(L=n.payload)==null?void 0:L.targetId,R=I.occupiers[U];if(!R)return i.success=!1,i.message="Ingen p tronen  angripe!",!1;R.armor=Math.max(0,R.armor-1),u.stats=u.stats||{damageDealt:0,damageTaken:0,armorDonated:0,ticksOnThrone:0},u.stats.damageDealt+=1;const C=U===s.regions[r].rulerId,$=((D=(M=s.regions[r])==null?void 0:M.garrison)==null?void 0:D.armor)||0;return C&&$>0?i.message=` Du angriper ${R.name}! Angrepet er mindre effektivt pga. slottets garnison-skjold.`:i.message=` Angrep ${R.name} p tronen!`,!0}return n.subType==="TICK",!0}return!1},YJ=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{resource:r,amount:a}=n,l=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(r!=="siege_sword"&&r!=="siege_armor")return i.success=!1,i.message="Ugyldig ressurs for garnisonen.",!1;if((e.resources[r]||0)<a)return i.success=!1,i.message=`Du har ikke nok ${r}.`,!1;s.regions[l].garrison||(s.regions[l].garrison={swords:0,armor:0,morale:100});const u=r==="siege_sword"?"swords":"armor";return e.resources[r]-=a,s.regions[l].garrison||(s.regions[l].garrison={swords:0,armor:0,morale:100}),s.regions[l].garrison[u]=(s.regions[l].garrison[u]||0)+a,i.utbytte.push({resource:r,amount:-a}),i.message=`Forsterket garnisonen med ${a} ${r==="siege_sword"?"vpen":"rustninger"}.`,!0},XJ=t=>{const{actor:e,room:s,action:n,localResult:i}=t,{amount:r}=n,a=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(!s.regions)return!1;const l=s.regions[a];l.fortification||(l.fortification={hp:1e3,maxHp:1e3,level:1});const c=l.fortification;if(c.hp>=c.maxHp)return i.success=!1,i.message="Murene er allerede i perfekt stand.",!1;const u=10*r,d=10*r;if((e.resources.stone||0)<u||(e.resources.wood||0)<d)return i.success=!1,i.message="Mangler stein eller ved til reparasjon.",!1;e.resources.stone=(e.resources.stone||0)-u,e.resources.wood=(e.resources.wood||0)-d;const h=50*r;return c.hp=Math.min(c.maxHp,c.hp+h),i.utbytte.push({resource:"stone",amount:-u}),i.utbytte.push({resource:"wood",amount:-d}),i.message=`Reparerte murene (+${h} HP).`,l.activeSiege&&l.activeSiege.gateHp!==void 0&&(l.activeSiege.gateHp+=h),!0},QJ=t=>{const{actor:e,room:s,localResult:n}=t,i=e.regionId==="capital"||!e.regionId?"capital":e.regionId;if(!s.regions)return!1;const r=s.regions[i];r.fortification||(r.fortification={hp:1e3,maxHp:1e3,level:1});const a=r.fortification,l=a.level||1,c=l+1,u=5e3*l,d=100*l,h=100*l;return(e.resources.gold||0)<u||(e.resources.stone||0)<d||(e.resources.wood||0)<h?(n.success=!1,n.message=`Mangler ressurser til oppgradering. Krever ${u}G, ${d} stein og ${h} ved.`,!1):(e.resources.gold-=u,e.resources.stone-=d,e.resources.wood-=h,a.level=c,a.maxHp+=500,a.hp=a.maxHp,n.utbytte.push({resource:"gold",amount:-u}),n.utbytte.push({resource:"stone",amount:-d}),n.utbytte.push({resource:"wood",amount:-h}),n.message=` Oppgradert festningsverk til niv ${c}! Murens styrke er n ${a.maxHp} HP.`,!0)},JJ=t=>{var l,c,u,d,h,f;const{actor:e,room:s,localResult:n,trackXp:i,damageTool:r}=t;if(e.role!=="BARON")return n.success=!1,!1;const a=Object.values(s.players).find(m=>m.role==="BARON"&&m.id!==e.id);if(a){if((((l=s.world)==null?void 0:l.activeLaws)||[]).includes("peace"))return n.success=!1,n.message="Fredsavtale blokkerer raid!",!1;const b=e.resources.manpower||0;let x=a.resources.manpower||0,v=Math.random()*.5+.75;if((c=a.upgrades)!=null&&c.includes("stone_keep")&&(x+=30),(u=a.upgrades)!=null&&u.includes("fence")&&(x+=10),(d=e.upgrades)!=null&&d.includes("stables")&&(v+=.1),e.activeBuffs&&e.activeBuffs.length>0){const g=Date.now(),p=e.activeBuffs.find(y=>y.type==="STRENGTH_BONUS"&&y.expiresAt>g);p&&(v+=p.value/100)}if((h=e.equipment)!=null&&h.MAIN_HAND&&r("MAIN_HAND",re.DURABILITY.LOSS_COMBAT_WEAPON),(f=e.equipment)!=null&&f.BODY&&r("BODY",re.DURABILITY.LOSS_COMBAT_ARMOR),b*v>x){const g=Math.floor((a.resources.gold||0)*re.COMBAT.RAID_LOOT_FACTOR),p=Math.floor((a.resources.grain||0)*re.COMBAT.RAID_LOOT_FACTOR);a.resources.gold=Math.max(0,(a.resources.gold||0)-g),a.resources.grain=Math.max(0,(a.resources.grain||0)-p),e.resources.gold=(e.resources.gold||0)+g,e.resources.grain=(e.resources.grain||0)+p,e.resources.manpower=Math.max(0,e.resources.manpower-5),a.resources.manpower=Math.max(0,a.resources.manpower-8),n.utbytte.push({resource:"gold",amount:g}),n.utbytte.push({resource:"grain",amount:p}),n.message=`Plyndret ${a.name} for ${g}g og ${p} korn!`,i("COMBAT",50)}else return e.resources.manpower=Math.max(0,e.resources.manpower-10),n.success=!1,n.message=`Angrepet p ${a.name} ble sltt tilbake.`,i("COMBAT",10),!1}else return n.success=!1,n.message="Fant ingen annen baron  raide.",!1;return!0},ZJ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.performance||.5,a=Math.ceil(15*r);return e.resources.gold=(e.resources.gold||0)+a,i("COMBAT",10),n.utbytte.push({resource:"gold",amount:a}),n.message="Utfrte patrulje.",!0},eZ=t=>{const{actor:e,localResult:s}=t;if(!e.boat)return s.success=!1,s.message="Du trenger en bt for  laste ammunisjon!",!1;const n=e.resources.cannonball||0;return n<=0?(s.success=!1,s.message="Du har ingen kanonkuler i ryggsekken!",!1):(e.boat.cannonballs=(e.boat.cannonballs||0)+n,e.resources.cannonball=0,s.message=`Lastet ${n} kanonkuler ombord. Btlager: ${e.boat.cannonballs} stk.`,!0)},tZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r}=s;e.caravan||(e.caravan={level:1,inventory:{},durability:100,upgrades:[]});const a=re.CARAVAN.LEVELS.find(u=>u.level===e.caravan.level);return a?(e.resources[i]||0)<r?(n.success=!1,n.message=`Du har ikke nok ${i}.`,!1):(Object.values(e.caravan.inventory).reduce((u,d)=>(u||0)+(d||0),0)||0)+r>a.capacity?(n.success=!1,n.message="Karavanen er full!",!1):(e.resources[i]-=r,e.caravan.inventory[i]=(e.caravan.inventory[i]||0)+r,n.message=`Lastet ${r} ${i} p karavanen.`,n.utbytte.push({resource:i,amount:-r}),!0):!1},sZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r}=s;return!e.caravan||!e.caravan.inventory[i]||e.caravan.inventory[i]<r?(n.success=!1,n.message="Mangelfull last i karavanen.",!1):(e.caravan.inventory[i]-=r,e.resources[i]=(e.resources[i]||0)+r,n.message=`Losset ${r} ${i} fra karavanen.`,n.utbytte.push({resource:i,amount:r}),!0)},nZ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,{upgradeType:r,upgradeId:a}=s;if(e.caravan||(e.caravan={level:1,inventory:{},durability:100,upgrades:[]}),r==="LEVEL"){const l=(e.caravan.level||1)+1,c=re.CARAVAN.LEVELS.find(u=>u.level===l);return c?(e.resources.gold||0)<c.cost?(n.success=!1,n.message=`Du mangler ${c.cost-(e.resources.gold||0)} gull for oppgraderingen.`,!1):(e.resources.gold-=c.cost,e.caravan.level=l,e.caravan.durability=c.durability,n.message=`Karavanen oppgradert til: ${c.name}!`,i("TRADING",100),!0):(n.success=!1,n.message="Karavanen er allerede p maks niv.",!1)}if(r==="MODULE"&&a){const l=re.CARAVAN.UPGRADES[a.toUpperCase()];return l?e.caravan.upgrades.includes(l.id)?(n.success=!1,n.message="Du har allerede denne oppgraderingen.",!1):(e.resources.gold||0)<l.cost?(n.success=!1,n.message="Ikke nok gull.",!1):(e.resources.gold-=l.cost,e.caravan.upgrades.push(l.id),n.message=`Kjpte modulen: ${l.name}!`,i("TRADING",50),!0):!1}return!1},iZ=t=>{const{actor:e,localResult:s}=t;if(!e.caravan)return!1;const n=re.CARAVAN.LEVELS.find(u=>u.level===e.caravan.level),i=n?n.durability:100,r=e.caravan.durability||0;if(r>=i)return s.success=!1,s.message="Karavanen er allerede i topp stand.",!1;const c=(i-r)*2;return(e.resources.gold||0)<c?(s.success=!1,s.message=`Du mangler ${c-(e.resources.gold||0)} gull. Reparasjon koster ${c}g.`,!1):(e.resources.gold-=c,e.caravan.durability=i,s.message=`Karavanen reparert for ${c}g.`,!0)},cT=t=>{var a;const{actor:e,action:s,localResult:n}=t,{finalDurability:i,targetRegionId:r}=s;return console.log("[CaravanHandler] Travel Result:",{finalDurability:i,targetRegionId:r,currentDurability:(a=e.caravan)==null?void 0:a.durability}),e.caravan?(e.caravan.durability=Math.max(0,i),e.caravan.durability<=0?(n.success=!1,n.message="Karavanen brt sammen under reisen! Du m reparere den fr du kan reise igjen.",!0):(e.regionId=r,n.message=`Ankom destinasjonen! Durability: ${Math.round(i)}%`,!0)):!1},f1={chassis_oak:{id:"chassis_oak",category:"CHASSIS",name:"Rustikk Eik",cost:0},chassis_iron:{id:"chassis_iron",category:"CHASSIS",name:"Forsterket Jern",cost:1500,reqLevel:3},chassis_gold:{id:"chassis_gold",category:"CHASSIS",name:"Gyllen Kongevogn",cost:5e3,reqLevel:5},wheels_wood:{id:"wheels_wood",category:"WHEELS",name:"Trehjul",cost:0},wheels_iron:{id:"wheels_iron",category:"WHEELS",name:"Jernbesltte",cost:150},wheels_spiked:{id:"wheels_spiked",category:"WHEELS",name:"Pigghjul",cost:500},cover_canvas:{id:"cover_canvas",category:"COVER",name:"Slitt Lerret",cost:0},cover_leather:{id:"cover_leather",category:"COVER",name:"Lr",cost:200},cover_silk:{id:"cover_silk",category:"COVER",name:"Silke med Gullkant",cost:1e3},cover_stars:{id:"cover_stars",category:"COVER",name:"Stjernehimmel",cost:2500},lantern_oil:{id:"lantern_oil",category:"LANTERNS",name:"Oljelampe",cost:0},lantern_crystal:{id:"lantern_crystal",category:"LANTERNS",name:"Bl Krystall",cost:800},lantern_fireflies:{id:"lantern_fireflies",category:"LANTERNS",name:"Ildfluer i bur",cost:300},flag_none:{id:"flag_none",category:"FLAG",name:"Ingen",cost:0},flag_region:{id:"flag_region",category:"FLAG",name:"Regionens Flagg",cost:100},flag_pirate:{id:"flag_pirate",category:"FLAG",name:"Piratflagg",cost:500},skin_ox:{id:"skin_ox",category:"SKIN",name:"Standard Okse",cost:0},skin_horse_linked:{id:"skin_horse_linked",category:"SKIN",name:"Min Hest",cost:0},skin_horse_white:{id:"skin_horse_white",category:"SKIN",name:"Hvit Hest",cost:1e3},skin_horse_mech:{id:"skin_horse_mech",category:"SKIN",name:"Mekanisk Hest",cost:5e3},companion_none:{id:"companion_none",category:"COMPANION",name:"Ingen",cost:0},companion_dog:{id:"companion_dog",category:"COMPANION",name:"Vakthund",cost:400},companion_cat:{id:"companion_cat",category:"COMPANION",name:"Katt p taket",cost:200},trail_dust:{id:"trail_dust",category:"TRAIL",name:"Stvsky",cost:0},trail_gold:{id:"trail_gold",category:"TRAIL",name:"Gullglitter",cost:2e3},trail_dark:{id:"trail_dark",category:"TRAIL",name:"Mrk Tke",cost:1500},decor_none:{id:"decor_none",category:"DECOR",name:"Ingen",cost:0},decor_shields:{id:"decor_shields",category:"DECOR",name:"Skjoldrekke",cost:600},decor_flowers:{id:"decor_flowers",category:"DECOR",name:"Blomsterkasser",cost:100}},rZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i}=s;if(!e.caravan)return!1;e.caravan.customization||(e.caravan.customization={chassis:"chassis_oak",wheels:"wheels_wood",cover:"cover_canvas",lanterns:"lantern_oil",flag:"flag_none",skin:"skin_ox",companion:"companion_none",trail:"trail_dust",decor:"decor_none",unlocked:["chassis_oak","wheels_wood","cover_canvas","lantern_oil","flag_none","skin_ox","skin_horse_linked","companion_none","trail_dust","decor_none"]});const r=f1[i];return r?e.caravan.customization.unlocked.includes(i)?(n.success=!1,n.message="Du eier allerede denne.",!1):(e.resources.gold||0)<r.cost?(n.success=!1,n.message=`Du mangler ${r.cost-(e.resources.gold||0)} gull.`,!1):r.reqLevel&&(e.caravan.level||1)<r.reqLevel?(n.success=!1,n.message=`Krever Karavan Niv ${r.reqLevel}.`,!1):(e.resources.gold-=r.cost,e.caravan.customization.unlocked.push(i),n.message=`Kjpte ${r.name}!`,!0):(n.success=!1,n.message="Ugyldig vare.",!1)},aZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i}=s,r=f1[i];if(!r||!e.caravan)return!1;if(e.caravan.customization||(e.caravan.customization={chassis:"chassis_oak",wheels:"wheels_wood",cover:"cover_canvas",lanterns:"lantern_oil",flag:"flag_none",skin:"skin_ox",companion:"companion_none",trail:"trail_dust",decor:"decor_none",unlocked:["chassis_oak","wheels_wood","cover_canvas","lantern_oil","flag_none","skin_ox","skin_horse_linked","companion_none","trail_dust","decor_none"]}),!e.caravan.customization.unlocked.includes(i))return n.success=!1,n.message="Du eier ikke denne gjenstanden.",!1;if(i==="skin_horse_linked"&&!(e.horseCustomization&&e.horseCustomization.skinId))return n.success=!1,n.message="Du trenger en hest i stallen for  bruke denne.",!1;switch(r.category){case"CHASSIS":e.caravan.customization.chassis=i;break;case"WHEELS":e.caravan.customization.wheels=i;break;case"COVER":e.caravan.customization.cover=i;break;case"LANTERNS":e.caravan.customization.lanterns=i;break;case"FLAG":e.caravan.customization.flag=i;break;case"SKIN":e.caravan.customization.skin=i;break;case"COMPANION":e.caravan.customization.companion=i;break;case"TRAIL":e.caravan.customization.trail=i;break;case"DECOR":e.caravan.customization.decor=i;break}return typeof e.caravan.inventory>"u"&&(e.caravan.inventory={}),typeof e.caravan.upgrades>"u"&&(e.caravan.upgrades=[]),n.message=`Utstyrte ${r.name}.`,!0},oZ=t=>{var d,h,f;const{actor:e,room:s,localResult:n}=t;if(!(xa(((d=s.world)==null?void 0:d.gameTick)||0)==="NIGHT"))return n.success=!1,n.message=" Du kan bare sove nr det er natt.",!1;const a=100-(e.status.stamina||0);e.status.stamina=100,e.status.hp=Math.min(100,(e.status.hp||100)+20),e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(m=>m.type!=="STAMINA_SAVE"||m.label!=="Godt utvilt");const l=((f=(h=e.buildings)==null?void 0:h.farm_house)==null?void 0:f.level)||1;let c=.5,u=3e5;return l>=3&&(c=.6),l>=4&&(c=.7,u=6e5),e.activeBuffs.push({id:"well_rested_"+Date.now(),type:"STAMINA_SAVE",value:c,label:"Godt utvilt",description:`${Math.round(c*100)}% mindre stamina-forbruk etter en god natts svn (Grd Niv ${l}).`,expiresAt:Date.now()+u}),n.message="Du sov tungt gjennom natten. Vknet opp uthvilt og full av energi!",n.utbytte.push({resource:"stamina",amount:a}),!0},Ia=t=>{var d;const{actor:e,action:s,localResult:n}=t,i=typeof s=="string"?s:s.type,r=s.locationId;let a=30,l=0,c="Hvilte.";if(i==="EAT"&&(a=40,c="Satt ved varmen og spiste."),i==="FEAST"&&(a=100,l=20,c="Holdt gjestebud!"),i==="GATHER_WATER"||r==="farm_well"||r==="well_water"){e.activeProcesses||(e.activeProcesses=[]);const h=r||(i==="GATHER_WATER"?"well_water":null);if(h){const f=e.activeProcesses.find(m=>m.type==="WELL"&&m.locationId===h);if(f){if(f.readyAt>Date.now())return n.success=!1,n.message="Brnnen er tom. Den fyller seg med vann...",!1;e.activeProcesses=e.activeProcesses.filter(m=>m.id!==f.id)}a=5,c="Drakk friskt vann fra brnnen.",e.activeProcesses.push({id:"well_"+Date.now(),type:"WELL",itemId:"water",locationId:h,startedAt:Date.now(),duration:3e5,readyAt:Date.now()+3e5,notified:!1})}}if(r==="village_square"&&(a=10,c="Hvilte p torget.",bJ(e,"REST_SQUARE",6*60*1e3)),(r==="village"||r==="tavern_bar")&&["REST_BASIC","REST_COMFY","REST_ROYAL"].includes(i)){t.room.metadata||(t.room.metadata={});const h=t.room.metadata,f=Date.now(),m=h.lastTavernRest||f,b=(f-m)/3e5;let x=h.tavernDemand||1;b>0&&(x=Math.max(1,x-b*.05));let v=150,g=30,p=0,y=null,k="Hvilte i salen";i==="REST_BASIC"?(v=150,g=30,k="Hvilte i salen"):i==="REST_COMFY"?(v=500,g=80,p=10,k="Hvilte i komfortabelt rom",y={id:"rest_comfy_"+f,type:"STAMINA_SAVE",value:.2,label:"Utvilt",description:"20% redusert stamina-forbruk i 10 min.",expiresAt:f+6e5}):i==="REST_ROYAL"&&(v=1500,g=100,p=50,k="Hvilte i Kongesuite",y={id:"rest_royal_"+f,type:"STAMINA_SAVE",value:.5,label:"Luksusliv",description:"50% redusert stamina, +1 HP/sek regenerering i 20 min.",expiresAt:f+12e5,passiveEffect:"HP_REGEN"});const w=Math.ceil(v*x);return(e.resources.gold||0)<w?(n.success=!1,n.message=`Vertshuset krever ${w}g (Ettersprsel: ${Math.round(x*100)}%). Du har ikke rd.`,!1):(e.resources.gold-=w,n.utbytte.push({resource:"gold",amount:-w}),a=g,l=p,c=`${k} (-${w}g). Fler deg bedre!`,y&&(e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(S=>S.type!=="STAMINA_SAVE"),e.activeBuffs.push(y),c+=` (Buff: ${y.label})`),h.tavernDemand=x+.1,h.lastTavernRest=f,!0)}return(d=e.upgrades)!=null&&d.includes("roof")&&(a+=20),r==="royal_chambers"&&(a=100,l=100,c="Hvilte ut i de kongelige kamrene. Fler deg som en konge igjen!",e.activeBuffs||(e.activeBuffs=[]),e.activeBuffs=e.activeBuffs.filter(h=>h.label!=="Kongelig Velvre"),e.activeBuffs.push({id:"royal_wellness_"+Date.now(),type:"STAMINA_SAVE",value:.6,label:"Kongelig Velvre",description:"Fyrstelig velvre reduserer stamina-forbruk med 60%.",expiresAt:Date.now()+6e5})),e.status.stamina=Math.min(100,(e.status.stamina||0)+a),l>0&&(e.status.hp=Math.min(100,(e.status.hp||100)+l)),n.utbytte.push({resource:"stamina",amount:a}),n.message=c,!0},lZ=t=>{const{actor:e,localResult:s,trackXp:n}=t,i=Math.floor(Math.random()*5)+1;return e.resources.favor=(e.resources.favor||0)+i,s.utbytte.push({resource:"favor",amount:i}),n("THEOLOGY",10),s.message=`Ba til gudene. (+${i} velvilje)`,!0},cZ=t=>{const{localResult:e}=t,s=["Baronen ser nervs ut i dag.","Hrte du ulvene i natt?","Prisen p korn gr opp.","Kongens soldater er p vei."];return e.message=`Sladder: "${s[Math.floor(Math.random()*s.length)]}"`,!0},uT=t=>{const{actor:e,action:s,localResult:n}=t,{amount:i,isWin:r,playerRoll:a,houseRoll:l}=s;return r?(e.resources.gold=(e.resources.gold||0)+i,n.utbytte.push({resource:"gold",amount:i}),n.message=`Vant ${i}g p terninger! (${a} mot ${l})`):(e.resources.gold=Math.max(0,(e.resources.gold||0)-i),n.message=`Tapte ${i}g p terninger. (${a} mot ${l})`),!0},uZ=t=>{const{actor:e,action:s,localResult:n}=t,{resource:i,amount:r,multiplier:a,isWin:l}=s,c=i,u=e.resources[c]||0;if(u<r)return n.success=!1,n.message=`Du har ikke nok ${i}!`,!1;if(e.resources[c]=Math.max(0,u-r),l){const d=r*a;e.resources[c]+=d;const h=d-r;n.utbytte.push({resource:c,amount:h}),n.message=`Soga-hjulet vider seg til din fordel! Vant ${d} ${i}.`,a>=2.5&&(e.status.morale=Math.min(100,(e.status.morale||50)+5))}else n.message=`Skjebnen var hard. Du mistet ${r} ${i} til soga-hjulet.`,n.utbytte.push({resource:c,amount:-r});return!0},dZ=t=>{var c;const{actor:e,room:s,localResult:n}=t,i=e.regionId||"capital",r=((c=s.markets)==null?void 0:c[i])||s.market;let a=5;r&&r.bread&&(a=r.bread.price);const l=Math.ceil(a*1.2);if((e.resources.gold||0)>=l){e.resources.gold-=l;const u=10;e.status.stamina=Math.min(100,(e.status.stamina||0)+u),n.utbytte.push({resource:"stamina",amount:u}),n.utbytte.push({resource:"gold",amount:-l}),n.message=`Kjpte et mltid i baren for ${l}g. (+10 Stamina)`}else return n.success=!1,n.message=`Har ikke rd til mat (koster ${l}g).`,!1;return!0},hZ=t=>{const{actor:e,room:s,localResult:n}=t;return n.message=`${e.name} har valgt  trekke seg tilbake fra dette livet.`,delete s.players[e.id],!0},fZ=t=>{const{actor:e,action:s,localResult:n,room:i}=t,r=s.itemId,l=!!s.isResource,c=Array.isArray(e.inventory)?e.inventory:Object.values(e.inventory||{});if(l){if(!e.resources[r]||e.resources[r]<1)return n.success=!1,n.message="Du har ikke mer igjen.",!1;e.resources[r]--,n.utbytte.push({resource:r,amount:-1})}else{const d=c.findIndex(h=>h.id===r);if(d===-1)return n.success=!1,n.message="Fant ikke gjenstanden.",!1;e.inventory=c.filter((h,f)=>f!==d)}e.activeBuffs||(e.activeBuffs=[]);const u=Date.now();switch(r){case"bread":e.status.stamina=Math.min(100,(e.status.stamina||0)+20),n.message="Spiste Brd. (+20 Stamina)",n.utbytte.push({resource:"stamina",amount:20});break;case"omelette":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STAMINA_SAVE"),e.activeBuffs.push({id:"buff_omelette_"+u,type:"STAMINA_SAVE",value:.2,label:"Lett til beins",description:"Reduserer stamina-kostnad med 20%.",expiresAt:u+9e5,sourceItem:"omelette"}),n.message="Spiste Omelett. (20% stamina-spare buff)";break;case"minor_stamina_potion":e.status.stamina=Math.min(100,(e.status.stamina||0)+30),n.message="Drakk Liten Stamina-brygg. (+30 Stamina)",n.utbytte.push({resource:"stamina",amount:30});break;case"herbal_balm":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="SPEED_BONUS"),e.activeBuffs.push({id:"buff_balm_"+u,type:"SPEED_BONUS",value:.15,label:"Lett p foten",description:"ker sankehastighet med 15%.",expiresAt:u+6e5,sourceItem:"herbal_balm"}),n.message="Brukte Urtebalsam. (+15% Arbeidshastighet)";break;case"focus_brew":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STAMINA_SAVE"),e.activeBuffs.push({id:"buff_focus_"+u,type:"STAMINA_SAVE",value:.2,label:"Skjerpet Fokus",description:"Reduserer stamina-kostnad med 20% i 15 min.",expiresAt:u+9e5,sourceItem:"focus_brew"}),n.message="Drakk Fokus-brygg. (Bedre fokus!)";break;case"strength_tincture":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="STRENGTH_BONUS"),e.activeBuffs.push({id:"buff_strength_"+u,type:"STRENGTH_BONUS",value:10,label:"Kjempestyrke",description:"ker angrepskraft med 10.",expiresAt:u+6e5,sourceItem:"strength_tincture"}),n.message="Drakk Styrke-tinktur. (+10 Angrep)";break;case"masters_draught":e.activeBuffs=e.activeBuffs.filter(d=>d.type!=="YIELD_BONUS"),e.activeBuffs.push({id:"buff_master_"+u,type:"YIELD_BONUS",value:.5,label:"Mesterhnd",description:"ker utbytte fra alle sankeoppgaver med 50%.",expiresAt:u+12e5,sourceItem:"masters_draught"}),n.message="Drakk Mester-drikk. (Fler deg som en mester!)";break;case"elixir_of_life":e.status.stamina=100,e.status.hp=Math.min(100,(e.status.hp||100)+50),n.message="Drakk Livseliksir. Full Stamina og +50 HP!",n.utbytte.push({resource:"stamina",amount:100});break;default:return n.success=!1,n.message=`Kan ikke bruke ${r}.`,!1}return Hn(i.pin,"consumed",r,1),!0},mZ=t=>{const{actor:e,action:s,localResult:n,trackXp:i}=t,r=s.performance||.5,a=s.method||"ride_easy",l=s.level||1;let c=1,u="lav";a==="ride_medium"?(c=1.6,u="middels"):a==="ride_hard"&&(c=2.5,u="hy");const d=1+(l-1)*.5,h=Math.ceil(10*c*d);if(r===.5&&!s.isComplete){if((e.resources.grain||0)<h)return n.message=`Du har ikke nok korn! Trenger ${h} korn.`,!1;e.resources.grain=(e.resources.grain||0)-h}const f=c*(1+(l-1)*.2);e.status.stamina=Math.min(100,(e.status.stamina||0)+5);const m=Math.ceil(20*(1+r)*f);if(i("STEWARDSHIP",m),r>=.8){e.minigameProgress||(e.minigameProgress={});const b=e.minigameProgress[a]||1;l===b&&b<5?(e.minigameProgress[a]=b+1,n.message=`Glimrende ridning! Du har lst opp niv ${b+1} for ${a==="ride_easy"?"Engelskogen":a==="ride_medium"?"Fjellpasset":"Ulvestien"}! (Brukt ${h} korn)`):n.message=`Du red en tur i ${u} vanskelighetsgrad (Lvl ${l}). Fler deg forfrisket! (Brukt ${h} korn)`}else n.message=`Du red en tur i ${u} vanskelighetsgrad (Lvl ${l}). (Ytelse: ${Math.round(r*100)}%, Brukt ${h} korn)`;return!0},pZ=t=>{const{actor:e,action:s,localResult:n}=t,{cosmeticId:i,cosmeticType:r,price:a}=s;return e.horseCustomization||(e.horseCustomization={skinId:"brown",maneColor:"#1e1b4b",unlockedSkins:["brown"],unlockedManeColors:["#1e1b4b"],unlockedHats:[]}),(e.resources.gold||0)<a?(n.message=`Du har ikke nok gull! Trenger ${a}g.`,!1):(e.resources.gold=(e.resources.gold||0)-a,r==="skin"?(e.horseCustomization.unlockedSkins||(e.horseCustomization.unlockedSkins=["brown"]),e.horseCustomization.unlockedSkins.includes(i)||e.horseCustomization.unlockedSkins.push(i)):r==="mane"?(e.horseCustomization.unlockedManeColors||(e.horseCustomization.unlockedManeColors=["#1e1b4b"]),e.horseCustomization.unlockedManeColors.includes(i)||e.horseCustomization.unlockedManeColors.push(i)):r==="hat"&&(e.horseCustomization.unlockedHats||(e.horseCustomization.unlockedHats=[]),e.horseCustomization.unlockedHats.includes(i)||e.horseCustomization.unlockedHats.push(i)),n.message=`Du kjpte en ny ting til hesten din for ${a}g!`,!0)},gZ=t=>{const{actor:e,action:s}=t,{cosmeticId:n,cosmeticType:i}=s;return e.horseCustomization||(e.horseCustomization={skinId:"brown",maneColor:"#1e1b4b",unlockedSkins:["brown"],unlockedManeColors:["#1e1b4b"],unlockedHats:[]}),i==="skin"?e.horseCustomization.skinId=n:i==="mane"?e.horseCustomization.maneColor=n:i==="hat"&&(e.horseCustomization.hatId=n),!0},hO={WORK:wJ,CHOP:kJ,MINE:oT,QUARRY:oT,FORAGE:NJ,HUNT:SJ,GATHER_WOOL:TJ,GATHER_HONEY:EJ,PLANT:yJ,HARVEST:_J,MAINTAIN_CROP:vJ,CRAFT:CJ,REFINE:Bo,BAKE:Bo,MILL:Bo,SMELT:Bo,WEAVE:Bo,MIX:Bo,REPAIR:RJ,EQUIP_ITEM:IJ,UNEQUIP_ITEM:OJ,DISCARD_ITEM:MJ,TAX:DJ,DRAFT:LJ,DECREE:PJ,CONSTRUCT:wg,CONTRIBUTE_TO_UPGRADE:wg,CONTRIBUTE_TO_PRIVATE_UPGRADE:wg,UPGRADE_BUILDING:VJ,UPGRADE:BJ,JOIN_ROLE:FJ,CONTRIBUTE_TO_BOAT:UJ,UPGRADE_BOAT_COMPONENT:$J,BUY_BOAT_MODEL:HJ,BUY_BOAT_COSMETIC:GJ,START_SIEGE:qJ,JOIN_SIEGE:KJ,SIEGE_ACTION:WJ,REINFORCE_GARRISON:YJ,REPAIR_WALLS:XJ,UPGRADE_FORTIFICATION:QJ,RAID:JJ,PATROL:ZJ,REFILL_AMMO:eZ,SLEEP:oZ,REST:Ia,REST_BASIC:Ia,REST_COMFY:Ia,REST_ROYAL:Ia,EAT:Ia,FEAST:Ia,PRAY:lZ,CHAT_LOCAL:cZ,GAMBLE_RESULT:uT,PLAY_DICE:uT,PLAY_RESOURCE_GAME:uZ,BUY_MEAL:dZ,RETIRE:hZ,CONSUME:fZ,FEED_CHICKENS:AJ,COLLECT_EGGS:jJ,GATHER_WATER:Ia,TRADE_ROUTE:y7,MOUNT_HORSE:mZ,BUY_HORSE_COSMETIC:pZ,SELECT_HORSE_COSMETIC:gZ,BUY:b7,SELL:v7,LOAD_CARAVAN:tZ,UNLOAD_CARAVAN:sZ,UPGRADE_CARAVAN:nZ,REPAIR_CARAVAN:iZ,TRAVEL_COMPLETE:cT,TRAVEL_FAILED:cT,BUY_CARAVAN_COSMETIC:rZ,EQUIP_CARAVAN_COSMETIC:aZ},kg=[{level:0,label:"Gammelt Trestativ",slots:2,cost:{wood:50}},{level:1,label:"Forsterket Jernstativ",slots:4,cost:{wood:100,ore:50}},{level:2,label:"Forgylt Kongestativ",slots:6,cost:{wood:200,ore:100,gold:500}}],xZ=async(t,e,s)=>{const n=z(q,`simulation_rooms/${t}/players/${e}`),{type:i,slotId:r,itemId:a,instanceId:l,trophyId:c,price:u}=s;let d=!1,h="";return await Pe(n,f=>{if(!f)return;f.weaponRack||(f.weaponRack={level:0,slots:[],unlockedTrophies:[]});const m=f.weaponRack;m.slots||(m.slots=[]),m.unlockedTrophies||(m.unlockedTrophies=[]);const x=(kg.find(v=>v.level===m.level)||kg[0]).slots;if(i==="RACK_UPGRADE"){const v=kg.find(y=>y.level===m.level+1);if(!v)return;const g=v.cost;if(!Object.entries(g).every(([y,k])=>(f.resources[y]||0)>=k))return;Object.entries(g).forEach(([y,k])=>{const w=y;f.resources[w]=(f.resources[w]||0)-k}),m.level+=1,h=`Oppgraderte vpenstativet til ${v.label}!`,d=!0}if(i==="RACK_MOUNT_ITEM"){if(m.slots.length>=x)return;const v=(f.inventory||[]).findIndex(p=>p.id===a||p.id===l);if(v===-1)return;const g=f.inventory[v];f.inventory.splice(v,1),m.slots.push({id:`slot_${Date.now()}`,type:"ITEM",itemId:g.id,instanceId:g.id}),h=`Hengte opp ${g.name}`,d=!0}if(i==="RACK_MOUNT_TROPHY"){if(m.slots.length>=x||!m.unlockedTrophies.includes(c)||m.slots.some(v=>v.itemId===c))return;m.slots.push({id:`slot_${Date.now()}`,type:"TROPHY",itemId:c}),h="Plasserte trof p utstilling.",d=!0}if(i==="RACK_UNMOUNT"){const v=m.slots.findIndex(p=>p.id===r);if(v===-1)return;const g=m.slots[v];if(g.type==="ITEM"){const p=qe[g.itemId];if(p){const y=JSON.parse(JSON.stringify(p));f.inventory||(f.inventory=[]),f.inventory.push(y)}}m.slots.splice(v,1),h="Tok ned gjenstand.",d=!0}if(i==="RACK_BUY_TROPHY"){if(f.resources.gold<u||m.unlockedTrophies.includes(c))return;f.resources.gold-=u,m.unlockedTrophies.push(c),h="Kjpte nytt trof!",d=!0}if(i==="RACK_POLISH"){const v=Date.now(),g=m.lastPolishedAt||0;if(v-g<6e4*60){h="Du m vente fr du kan pusse utstyret igjen.";return}m.lastPolishedAt=v,f.status.morale||(f.status.morale=50),f.status.morale=Math.min(100,f.status.morale+10),h="Pusset samlingen. Moralen ker!",d=!0}return f}),d&&h&&wt(t,h),{success:d}},fO=(t,e,s,n)=>{var u,d;t.roleStats||(t.roleStats={});const i=t.role;t.roleStats[i]||(t.roleStats[i]={level:((u=t.stats)==null?void 0:u.level)||1,xp:((d=t.stats)==null?void 0:d.xp)||0,skills:JSON.parse(JSON.stringify(t.skills||An[i]||An.PEASANT))});const r=t.roleStats[i],a=r.skills[e];a&&(a.xp+=s||0,a.xp>=a.maxXp&&(a.level+=1,a.xp-=a.maxXp,a.maxXp=Math.floor(a.maxXp*1.5),n.push(` ${t.name} ble bedre i ${e}! (Niv ${a.level})`))),r.xp=(r.xp||0)+(s||0);const c=(h=>{const f=Dm.findIndex(m=>h<m);return f===-1?Dm.length:f})(r.xp);c>r.level&&(r.level=c,n.push(` ${t.name} har steget i rang som ${i} til Niv ${c}!`)),t.stats.xp=r.xp,t.stats.level=r.level,t.skills=r.skills};async function mO(t,e,s){var i,r,a;if(!t||!s)return;await new Promise(l=>setTimeout(l,Math.random()*200));const n=z(q,`simulation_accounts/${t}`);try{const l=await ve(n);if(!l.exists())return;const c=l.val(),u=c.characterHistory||[],d={name:s.name,role:s.role,level:((i=s.stats)==null?void 0:i.level)||1,xp:((r=s.stats)==null?void 0:r.xp)||0,roomPin:e,timestamp:Date.now()},h=[...u,d],f=((a=s.stats)==null?void 0:a.xp)||0,m=(c.globalXp||0)+f,b=Math.floor(Math.sqrt(m/100))+1,x={};x.characterHistory=h,x.globalXp=m,x.globalLevel=b,x.lastActive=Date.now(),x[`activeSessions/${e}`]=null,await oe(n,x),console.log(`Character life recorded for ${s.name} (${t})`)}catch(l){console.error("Failed to record character life:",l)}}const bZ=Object.freeze(Object.defineProperty({__proto__:null,addXp:fO,recordCharacterLife:mO},Symbol.toStringTag,{value:"Module"}));async function vZ(t,e,s){const n=typeof s=="string"?s:s.type,i=z(q,`simulation_rooms/${t}/players/${e}`),r=z(q,`simulation_rooms/${t}/regions`),a=z(q,`simulation_rooms/${t}/world`);try{const[l,c,u]=await Promise.all([ve(i),ve(r),ve(a)]);if(!l.exists())return{success:!1,error:"Spiller finnes ikke"};const d=l.val();d.resources||(d.resources=ms[d.role]||ms.PEASANT);const h=c.val()||{},f=u.val()||{},m={success:!0,timestamp:Date.now(),message:"",utbytte:[],xp:[],durability:[]},b={world:f,regions:h,players:{[e]:d},markets:{},messages:[]},x={actor:d,room:b,pin:t,action:s,timestamp:new Date().toLocaleTimeString(),localResult:m,trackXp:(w,S)=>{},damageTool:()=>!0},v=hO[n];if(!v)return{success:!1,error:"Ukjent handling"};if(!v(x)||!m.success)return{success:!1,data:m};const p={};p[`players/${e}`]=d;const y=m.siegeWinnerId,k=m.targetRegionId;if(y&&k){const w=h[k],S=w.rulerId,_=k==="capital";if(S&&S!==y){const E=await ve(z(q,`simulation_rooms/${t}/players/${S}`));if(E.exists()){const A=E.val();A.role="PEASANT",A.status&&(A.status.legitimacy=0),p[`players/${S}`]=A,p[`public_profiles/${S}/role`]="PEASANT",Hn(t,"roleChanges","PEASANT (Demoted)",1)}}const T=await ve(z(q,`simulation_rooms/${t}/players/${y}`));if(T.exists()){const E=T.val(),A=E.regionId,j=_?"KING":"BARON";E.role=j,E.regionId=k,E.status&&(E.status.legitimacy=100),p[`players/${y}`]=E,p[`public_profiles/${y}/role`]=j,p[`public_profiles/${y}/regionId`]=k,w.rulerId=y,w.rulerName=E.name,_&&A&&A!=="capital"&&A!=="unassigned"&&u7(t,A)}}return p.regions=h,await oe(z(q,`simulation_rooms/${t}`),p),{success:!0,data:m}}catch(l){return console.error("Siege Transaction Failed",l),{success:!1,error:l.message||"Beleiring feilet"}}}const yZ=["MARKET_BUY","MARKET_SELL","RAID","TAX","TAX_PEASANTS","TAX_ROYAL","TRADE","TRADE_ROUTE","CONTRIBUTE_TO_UPGRADE","BUY","SELL","CONTRIBUTE","CONSTRUCT","UPGRADE_BUILDING","START_SIEGE","JOIN_SIEGE","SIEGE_ACTION","REINFORCE_GARRISON","REPAIR_WALLS","SET_TAX","UPGRADE_FORTIFICATION","TRAVEL_START","TRAVEL_COMPLETE"],pO=async(t,e,s)=>{const n=typeof s=="string"?s:s.type;return yZ.includes(n)?await wZ(t,e,s):n&&n.startsWith("RACK_")?await xZ(t,e,s):_Z(t,e,s)};async function _Z(t,e,s){const n=z(q,`simulation_rooms/${t}/players/${e}`),i=z(q,`simulation_rooms/${t}/world`);let r=null;try{const a=await ve(i),l=a.exists()?a.val():{season:"Spring",weather:"Clear",activeLaws:[]};if(await Pe(n,c=>{var k,w,S;if(!c)return c;c.resources||(c.resources=JSON.parse(JSON.stringify(ms[c.role]||ms.PEASANT))),c.skills||(c.skills=JSON.parse(JSON.stringify(An[c.role]||An.PEASANT))),c.status||(c.status={stamina:100,hp:100,authority:0,gold:c.resources.gold||0,level:1,xp:0}),c.equipment||(c.equipment={HEAD:null,BODY:null,MAIN_HAND:null,OFF_HAND:null,FEET:null,TRINKET:null,AXE:null,PICKAXE:null,SCYTHE:null,HAMMER:null}),c.stats||(c.stats={level:1,xp:0}),c.activeBuffs||(c.activeBuffs=[]);const u={success:!0,timestamp:Date.now(),message:"",utbytte:[],xp:[],durability:[]},d=(_,T)=>{var M,D,I,F,U,R;let E=T;const A=((M=l.settlement)==null?void 0:M.buildings)||{},O={WOODCUTTING:"sawmill",FARMING:"windmill",MINING:"smeltery",CRAFTING:"great_forge",TRADING:"weavery"}[_];O&&(((D=A[O])==null?void 0:D.level)||1)>=2&&(E=Math.ceil(E*1.1));const H=((F=(I=c.skills)==null?void 0:I[_])==null?void 0:F.level)||0,G=[];fO(c,_,E,G),G.length>0&&(u.message+=" "+G.join(" "));const L=((R=(U=c.skills)==null?void 0:U[_])==null?void 0:R.level)||0;u.xp.push({skill:_,amount:E,levelUp:L>H})},h=c.stats.level||1,f=(_,T)=>{var A;const E=(A=c.equipment)==null?void 0:A[_];return E&&(E.durability=Math.max(0,E.durability-T),u.durability.push({slot:_,item:E.name||"Gjenstand",amount:T,broken:E.durability<=0}),E.durability<=0)?(u.message=` ${E.name} ble delagt!`,u.success=!1,!1):!0},m=Date.now(),b=m-(c.lastActive||m),x=Math.min(60,isNaN(b)?0:b/6e4);if(x>.1){let _=0;(k=c.upgrades)!=null&&k.includes("cow")&&(_+=x*re.PASSIVE_INCOME.COW),(w=c.upgrades)!=null&&w.includes("accounting_books")&&(_+=x*re.PASSIVE_INCOME.ACCOUNTING_BOOKS),(S=c.upgrades)!=null&&S.includes("caravan")&&(_+=x*re.PASSIVE_INCOME.CARAVAN),_>0&&(c.resources.gold=(c.resources.gold||0)+Math.floor(_));const T=x*2;c.status.stamina=Math.min(100,(c.status.stamina||0)+T)}const v=c.role,g=typeof s=="string"?s:s.type,p=Ec[g];if(p){const _=On(p.stamina||0,l.season,l.weather,c.activeBuffs,l.gameTick||0);for(const[T,E]of Object.entries(p)){if(T==="stamina")continue;const A=T;if((c.resources[A]||0)<E)return u.success=!1,u.message=` Mangler ${E} ${T}!`,r=u,c}if((c.status.stamina||0)<_)return u.success=!1,u.message=` For sliten! (${_} kreves)`,r=u,c;for(const[T,E]of Object.entries(p)){if(T==="stamina")continue;const A=T;c.resources[A]=(c.resources[A]||0)-E,Hn(t,"consumed",T,E)}c.status.stamina-=_}const y=hO[g];if(y){const _={actor:c,room:{world:l,players:{[e]:c},messages:[]},pin:t,action:s,timestamp:new Date().toLocaleTimeString(),localResult:u,trackXp:d,damageTool:f};if(y(_)===!1)return r=u,c}else u.success=!1,u.message=`Ukjent handling: ${g}`;return u.message||(u.message="Handling utfrt."),u.success&&Math.random()<.005&&(c.resources.gold=(c.resources.gold||0)+150,u.utbytte.push({id:"ancient_relic",name:"Gammel Relikvie",type:"ITEM",icon:"",amount:1,jackpot:!0}),u.message+="  ET JORDFUNN! Du fant en eldgammel relikvie!"),c.lastActive=Date.now(),r=u,g==="RETIRE"&&u.success&&(r.characterSnapshot=JSON.parse(JSON.stringify(c))),c.stats.level>h&&(r.newLevel=c.stats.level),c.role!==v&&Hn(t,"roleChanges",c.role,1),c}),r&&r.success){if(r.message&&await wt(t,`[${new Date().toLocaleTimeString()}] ${r.message}`),r.utbytte&&r.utbytte.length>0&&r.utbytte.forEach(c=>{const u=c.type==="ITEM"?"crafted":"produced";Hn(t,u,c.id||c.resource,c.amount||1)}),r.characterSnapshot){const c=r.characterSnapshot.uid||e;await mO(c,t,r.characterSnapshot)}if(r.newLevel)try{await oe(z(q,`simulation_rooms/${t}/public_profiles/${e}`),{"stats/level":r.newLevel,lastActive:Date.now()})}catch(c){console.error("Failed to sync level",c)}}return{success:!!(r!=null&&r.success),data:r||void 0}}catch(a){return console.error("Action error:",a),{success:!1,error:a.message||"Handling feilet"}}}async function wZ(t,e,s){const n=typeof s=="string"?s:s.type;try{return n==="BUY"||n==="SELL"||n==="TRADE_ROUTE"||n==="MARKET_BUY"||n==="MARKET_SELL"?await a7(t,e,s):n==="CONTRIBUTE"||n==="CONTRIBUTE_TO_UPGRADE"||n==="CONSTRUCT"||n==="UPGRADE_BUILDING"?await o7(t,e,s):n==="TAX"||n==="TAX_PEASANTS"||n==="TAX_ROYAL"?await l7(t,e,s):n==="START_SIEGE"||n==="JOIN_SIEGE"||n==="SIEGE_ACTION"||n==="UPGRADE_FORTIFICATION"||n==="REINFORCE_GARRISON"||n==="REPAIR_WALLS"?await vZ(t,e,s):n==="SET_TAX"?await d7(t,e,s):n==="TRAVEL_START"?await g7(t,e,s):n==="TRAVEL_COMPLETE"?await x7(t,e,s):{success:!1,error:"Global handling not available."}}catch(i){return console.error("Global Action ERROR:",i),{success:!1,error:i.message||"Global handling feilet"}}}class kZ{constructor(e,s){Ie(this,"player");Ie(this,"genome");Ie(this,"brain");Ie(this,"startTime");Ie(this,"history",[]);Ie(this,"status","RUNNING");Ie(this,"lastActionAt",0);Ie(this,"stuckThreshold",6e4);this.player=e,this.genome=s,this.brain=new pJ(s),this.startTime=Date.now()}async tick(e,s){if(this.status!=="RUNNING")return;const n=this.brain.decide(this.player,e);if(this.history.push(n),this.history.length>20&&this.history.shift(),n.action==="IDLE"){Date.now()-this.lastActionAt>this.stuckThreshold&&(this.status="STUCK",this.dumpLog("Bottleneck detected: Stuck for > 60s"));return}this.lastActionAt=Date.now(),(await pO(s,this.player.id,n.action)).success,this.player.role==="KING"&&(this.status="SUCCESS")}getFitness(){return Lb.calculateFitness(this.player,this.startTime)}dumpLog(e){const s={reason:e,genome:this.genome,history:this.history,playerState:this.player,timestamp:Date.now()};console.error("AI Training Lab - Game Balance Issue:",s),window.lastAILog=s}}const NZ=({roomData:t,pin:e})=>{var w;const[s,n]=N.useState([]),[i,r]=N.useState(0),[a,l]=N.useState(!1),[c,u]=N.useState([]),[d,h]=N.useState({}),[f,m]=N.useState({}),[b,x]=N.useState(null),v=N.useRef(t);N.useEffect(()=>{v.current=t},[t]);const g=N.useRef(null),p=async()=>{const S={};for(let _=1;_<=5;_++){const T=`bot_${Date.now()}_${_}`,E={id:T,name:`BOT Alpha ${_}`,role:"PEASANT",regionId:Math.random()>.5?"region_ost":"region_vest",resources:{...ms.PEASANT},status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:1,xp:0,reputation:10,contribution:0},skills:{...An.PEASANT},lastActive:Date.now(),online:!0};S[`simulation_rooms/${e}/players/${T}`]=E,S[`simulation_rooms/${e}/public_profiles/${T}`]={id:T,stats:{level:1},status:E.status,online:!0,lastActive:Date.now()}}try{await oe(z(q),S)}catch(_){console.error("Failed to spawn bots",_)}},y=()=>{t.players&&l(!0)},k=()=>{l(!1),g.current&&cancelIdleCallback(g.current)};return N.useEffect(()=>{if(a){const S=async()=>{const _=v.current,T=Object.values(_.players||{}).filter(E=>E.name.includes("BOT"));await Promise.all(T.map(async E=>{let A=s.find(j=>j.player.id===E.id);if(A)A.player=E;else{const j=Lb.getNextGenerationGenome();A=new kZ(E,j),n(O=>[...O,A]),r(j.generation)}if(await A.tick(_,e),A.history.length>0){const j=A.history[A.history.length-1];let O=j.action.type||"IDLE";O==="SELL"&&j.action.itemId?O=`SELL (${j.action.itemId})`:O==="BUY"&&j.action.itemId&&(O=`BUY (${j.action.itemId})`),h(H=>({...H,[O]:(H[O]||0)+1})),m(H=>({...H,[A.player.id]:{name:A.player.name,action:O,reason:j.reason,score:j.score.toFixed(2),fitness:A.getFitness().toFixed(1),resources:{...A.player.resources},stamina:A.player.status.stamina}}))}if((A.status==="STUCK"||A.status==="DEAD")&&x(window.lastAILog),A.status==="SUCCESS"||A.status==="DEAD"||A.status==="STUCK"){const j=A.getFitness();A.genome.fitness=j,Lb.saveTopGenomes([A.genome]),u(O=>[...O.slice(-19),j])}})),g.current=window.setTimeout(()=>S(),1e3)};S()}return()=>{g.current&&clearTimeout(g.current)}},[a,e]),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex justify-between items-center bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[o.jsx(xX,{className:"text-indigo-400"})," AI Training Lab"]}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Genetisk Algoritme-optimalisering av spillbalanse"})]}),o.jsx("div",{className:"flex gap-3",children:a?o.jsxs("button",{onClick:k,className:"bg-red-600 hover:bg-red-500 px-4 py-2 rounded-lg flex items-center gap-2 font-bold transition-all",children:[o.jsx(Ob,{size:18})," Stopp Trening"]}):o.jsxs("button",{onClick:y,className:"bg-indigo-600 hover:bg-indigo-500 px-4 py-2 rounded-lg flex items-center gap-2 font-bold transition-all",children:[o.jsx(pd,{size:18})," Start Trening"]})})]}),a&&Object.values(t.players||{}).filter(S=>S.name.includes("BOT")||S.id.startsWith("bot_")).length===0&&o.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 p-6 rounded-2xl flex items-center justify-between animate-in slide-in-from-top-2",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"bg-amber-500/20 p-3 rounded-full text-amber-500",children:o.jsx(h1,{size:24})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-amber-500 font-black uppercase text-sm",children:"Ingen bot-subjekter funnet"}),o.jsx("p",{className:"text-amber-200/60 text-xs",children:"AI-en trenger kropper  kontrollere (navn med 'BOT' eller ID 'bot_')."})]})]}),o.jsx("button",{onClick:p,className:"bg-amber-500 hover:bg-amber-400 text-black px-6 py-3 rounded-xl font-black uppercase text-xs tracking-widest transition-all shadow-lg hover:scale-105",children:" Spawn Alpha Squad (5 stk)"})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(sT,{size:14})," Generasjon"]}),o.jsx("div",{className:"text-4xl font-black",children:i})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10 flex flex-col justify-between",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(zm,{size:14})," Fitness Trend"]}),o.jsx("div",{className:"text-4xl font-black mb-4",children:c.length>0?(c.reduce((S,_)=>S+_,0)/c.length).toFixed(1):"0.0"})]}),o.jsxs("div",{className:"h-12 flex items-end gap-1 px-1",children:[c.map((S,_)=>{const T=Math.max(...c,1),E=S/T*100;return o.jsx("div",{className:"flex-1 bg-indigo-500/50 rounded-t-sm transition-all duration-500 hover:bg-indigo-400",style:{height:`${E}%`},title:`Fitness: ${S.toFixed(1)}`},_)}),c.length===0&&o.jsx("div",{className:"w-full h-[1px] bg-white/10"})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10 text-amber-500",children:[o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-xs uppercase font-black mb-2",children:[o.jsx(gd,{size:14})," Bottlenecks"]}),o.jsx("div",{className:"text-4xl font-black text-amber-500",children:s.filter(S=>S.status==="STUCK").length})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsx("h3",{className:"text-sm font-bold uppercase tracking-widest text-slate-400 mb-4",children:"Decision Heatmap"}),o.jsxs("div",{className:"flex flex-wrap gap-4",children:[Object.entries(d).sort((S,_)=>_[1]-S[1]).map(([S,_])=>o.jsxs("div",{className:"bg-white/5 p-3 rounded-lg border border-white/5 flex flex-col items-center min-w-[80px]",children:[o.jsx("span",{className:"text-xs text-slate-500 uppercase",children:S}),o.jsx("span",{className:"text-lg font-bold",children:_})]},S)),Object.keys(d).length===0&&o.jsx("p",{className:"text-slate-600 italic",children:"Ingen data enn..."})]})]}),o.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-2xl border border-white/10",children:[o.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest text-slate-400 mb-4 flex items-center gap-2",children:[o.jsx(sT,{size:16,className:"text-indigo-400"})," Live Neural Feed"]}),o.jsx("div",{className:"overflow-x-auto",children:o.jsxs("table",{className:"w-full text-left border-collapse",children:[o.jsx("thead",{children:o.jsxs("tr",{className:"text-xs uppercase text-slate-500 border-b border-white/10",children:[o.jsx("th",{className:"p-3",children:"Subject"}),o.jsx("th",{className:"p-3",children:"Last Decision"}),o.jsx("th",{className:"p-3",children:"Reasoning"}),o.jsx("th",{className:"p-3",children:"Score"}),o.jsx("th",{className:"p-3",children:"Fitness"}),o.jsx("th",{className:"p-3",children:"Gold"}),o.jsx("th",{className:"p-3",children:"Stamina"})]})}),o.jsxs("tbody",{className:"text-sm",children:[Object.entries(f).map(([S,_])=>o.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors font-mono",children:[o.jsx("td",{className:"p-3 font-bold text-indigo-300",children:_.name}),o.jsx("td",{className:"p-3",children:o.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded text-xs font-bold border border-indigo-500/30",children:_.action})}),o.jsxs("td",{className:"p-3 text-slate-400 italic text-xs",children:['"',_.reason,'"']}),o.jsx("td",{className:"p-3 text-slate-300",children:_.score}),o.jsx("td",{className:"p-3 font-bold text-white",children:_.fitness}),o.jsx("td",{className:"p-3 text-amber-400",children:_.resources.gold}),o.jsx("td",{className:"p-3",children:o.jsx("div",{className:"w-16 h-1 bg-slate-700 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${_.stamina}%`}})})})]},S)),Object.keys(f).length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:7,className:"p-8 text-center text-slate-600 italic",children:"Venter p telemetri..."})})]})]})})]}),b&&o.jsxs("div",{className:"bg-red-950/30 border border-red-500/30 p-6 rounded-2xl",children:[o.jsxs("h3",{className:"text-red-400 font-bold flex items-center gap-2 mb-4",children:[o.jsx(gd,{size:18})," Game Balance Issue Detected"]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[o.jsxs("div",{className:"bg-black/40 p-4 rounded-lg",children:[o.jsx("p",{className:"text-slate-400 text-xs uppercase mb-2",children:"Grunn"}),o.jsx("p",{className:"font-mono",children:b.reason})]}),o.jsxs("div",{className:"bg-black/40 p-4 rounded-lg",children:[o.jsx("p",{className:"text-slate-400 text-xs uppercase mb-2",children:"Siste Handling"}),o.jsx("p",{className:"font-mono",children:((w=b.history[b.history.length-1])==null?void 0:w.action.type)||"None"})]})]}),o.jsx("pre",{className:"mt-4 p-4 bg-black/40 rounded-lg overflow-x-auto text-[10px] text-slate-300 custom-scrollbar",children:JSON.stringify(b,null,2)})]})]})},SZ=Se.memo(({pin:t,roomData:e,view:s,setView:n,isLoading:i,onBack:r,worldActions:a,playerActions:l,SimulationEconomyBlueprint:c})=>{var u,d,h,f;return o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 flex overflow-hidden font-sans selection:bg-indigo-500/30 z-20",children:[o.jsxs("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:[o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full animate-pulse"}),o.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-amber-600/10 blur-[120px] rounded-full"})]}),o.jsx(hJ,{pin:t,roomData:e,isLoading:i,onBack:r,...a,...l}),o.jsxs("main",{className:"flex-1 relative flex flex-col bg-slate-900/10 overflow-hidden no-scrollbar",children:[o.jsxs("header",{className:"h-16 border-b border-white/5 bg-slate-950/30 backdrop-blur-md flex items-center justify-between px-8 shrink-0 z-10",children:[o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsxs("nav",{className:"flex items-center bg-white/5 p-1 rounded-xl border border-white/10",children:[o.jsx("button",{onClick:()=>n("MANAGE"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="MANAGE"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"Overvking"}),o.jsx("button",{onClick:()=>n("ECONOMY"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="ECONOMY"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"Blueprint"}),o.jsx("button",{onClick:()=>n("AI_LAB"),className:`px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${s==="AI_LAB"?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-white"}`,children:"AI Training Lab"})]}),o.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-2"}),o.jsxs("div",{className:"flex items-center gap-8",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"Innbyggere:"}),o.jsx("span",{className:"text-sm font-bold text-white",children:Object.keys(e.players||{}).length})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"r i Riket:"}),o.jsx("span",{className:"text-sm font-bold text-white",children:((u=e.world)==null?void 0:u.year)||1100})]})]})]}),i&&o.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-indigo-400 animate-pulse",children:"Prosesserer Endringer..."})]}),o.jsx("div",{className:"flex-1 p-8 overflow-y-auto custom-scrollbar no-scrollbar",children:s==="ECONOMY"?c?o.jsx(c,{}):o.jsx("div",{className:"p-20 text-center animate-pulse text-slate-500 font-black uppercase tracking-widest",children:"Laster Blueprint..."}):s==="AI_LAB"?o.jsx(NZ,{roomData:e,pin:t}):o.jsxs("div",{className:"space-y-12 pb-20",children:[o.jsx(fJ,{players:e.players,onKick:l.kickPlayer,onLevelChange:l.handlePlayerLevelChange,onRoleChange:l.handleRoleChange,onRegionChange:l.handleRegionChange,onControl:l.controlPlayer,onGiveGold:l.onGiveGold,onGiveResource:l.onGiveResource,onGiveItem:l.onGiveItem}),((d=e.world)==null?void 0:d.settlement)&&o.jsxs("section",{className:"bg-indigo-900/10 border border-indigo-500/10 p-10 rounded-[3rem] relative overflow-hidden group",children:[o.jsxs("div",{className:"relative z-10",children:[o.jsxs("h2",{className:"text-3xl font-black text-white mb-8 tracking-tighter flex items-center justify-between",children:["Landsbyutvikling",o.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-indigo-400 bg-indigo-500/10 px-4 py-2 rounded-full",children:"Status Rapport"})]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:Object.values(((f=(h=e.world)==null?void 0:h.settlement)==null?void 0:f.buildings)||{}).map(m=>{const b=Fs[m.id],x=m.progress/(m.target||200)*100;return o.jsxs("div",{className:"space-y-2",children:[o.jsxs("div",{className:"flex justify-between items-end",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"text-sm font-black text-white uppercase",children:b==null?void 0:b.name}),o.jsxs("p",{className:"text-[10px] text-slate-500 font-bold tracking-tight",children:["Niv ",m.level]})]}),o.jsxs("span",{className:"text-xs font-mono text-indigo-500",children:[Object.values(m.progress||{}).reduce((v,g)=>v+g,0)," / ",m.target||200]})]}),o.jsxs("div",{className:"h-4 bg-black/40 rounded-full overflow-hidden border border-white/5 relative group/progress",children:[o.jsx("div",{className:"h-full bg-gradient-to-r from-indigo-600 via-indigo-400 to-fuchsia-500 transition-all duration-1000 shadow-[0_0_15px_rgba(99,102,241,0.4)] relative",style:{width:`${x}%`},children:o.jsx("div",{className:"absolute inset-0 bg-white/20 animate-pulse"})}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover/progress:opacity-100 transition-opacity flex justify-between items-center px-1 pointer-events-none",children:[o.jsx("button",{onClick:v=>{v.stopPropagation(),a.handleBuildingLevelChange(m.id,-1)},className:"w-5 h-5 bg-white/10 hover:bg-rose-500 text-white rounded-full flex items-center justify-center text-[10px] font-black pointer-events-auto transition-all",children:"-"}),o.jsx("button",{onClick:v=>{v.stopPropagation(),a.handleBuildingLevelChange(m.id,1)},className:"w-5 h-5 bg-white/10 hover:bg-emerald-500 text-white rounded-full flex items-center justify-center text-[10px] font-black pointer-events-auto transition-all",children:"+"})]})]})]},m.id)})})]}),o.jsx("div",{className:"absolute top-[-20%] right-[-10%] text-[15rem] text-indigo-500 opacity-[0.03] pointer-events-none group-hover:rotate-6 transition-transform duration-[3000ms]",children:""})]})]})})]}),o.jsx(mJ,{roomData:e}),o.jsx("style",{dangerouslySetInnerHTML:{__html:`
                .custom-scrollbar::-webkit-scrollbar {
                    width: 4px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: transparent;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.2);
                }
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
            `}})]})}),TZ="Enevelde",EZ=()=>{var U;const[t,e]=N.useState(""),[s,n]=N.useState([]),[i,r]=N.useState(!1),[a,l]=N.useState("LIST"),[c,u]=N.useState(()=>sessionStorage.getItem("admin_session")==="active"),{setFullWidth:d,setHideHeader:h}=FA(),{roomData:f,setRoomData:m,onlineCount:b}=w7(t),x=R=>R?Array.isArray(R)?R:Object.values(R).sort((C,$)=>C.timestamp-$.timestamp):[];N.useEffect(()=>(d(!0),h(!0),()=>{d(!1),h(!1)}),[d,h]),N.useEffect(()=>(t&&(a==="MANAGE"||a==="ECONOMY"||a==="AI_LAB")?document.title=`Host: ${t} | Eiriksbok`:document.title="Simuleringshallen | Eiriksbok",()=>{document.title="Eiriksbok"}),[t,a]),gR(t,(f==null?void 0:f.status)||"LOBBY",f==null?void 0:f.world,b),N.useEffect(()=>{if(!t||!(f!=null&&f.world)||f.status!=="PLAYING")return;const C=setInterval(async()=>{const $=f.world.sea_resources||{};if(Object.keys($).length<15){const W=Math.floor(Math.random()*2)+1,J={};for(let he=0;he<W;he++){const fe=`fish_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,ce=Math.floor(Math.random()*4e3),ne=Math.floor(Math.random()*4e3),Le=["COD","HERRING","SALMON","TUNA"],lt=Le[Math.floor(Math.random()*Le.length)];J[`simulation_rooms/${t}/world/sea_resources/${fe}`]={id:fe,x:ce,y:ne,type:lt,amount:Math.floor(Math.random()*5)+1,expiresAt:Date.now()+1e3*60*10}}const Y=Date.now();Object.values($).forEach(he=>{he.expiresAt<Y&&(J[`simulation_rooms/${t}/world/sea_resources/${he.id}`]=null)}),Object.keys(J).length>0&&await oe(z(q),J)}},1e4);return()=>clearInterval(C)},[t,f==null?void 0:f.status,(U=f==null?void 0:f.world)==null?void 0:U.sea_resources]),N.useEffect(()=>{const R=z(q,"simulation_rooms"),C=tt(R,$=>{const V=$.val();if(V){const P=Object.entries(V).map(([W,J])=>({...J,pin:J.pin||W}));n(P.reverse())}else n([])});return()=>C()},[]);const v=async()=>{const R=prompt("Hva skal riket hete? (La st tomt for automatisk navn)");if(R===null)return;r(!0);const C=Math.floor(1e3+Math.random()*9e3).toString(),$=R.trim()||`Rike #${C}`,V=Jz(C,$);try{await da(z(q,`simulation_rooms/${C}`),V),await Lm(C,V),e(C),l("MANAGE")}catch(P){console.error(P),alert("Kunne ikke opprette rom.")}finally{r(!1)}},[g,p]=N.useState(null),y=async R=>{if(window.confirm(`ER DU SIKKER? Dette vil slette rommet ${R} permanent!
Alle karakterer vil bli arkivert til spillernes Hall of Fame.`)){r(!0),p("Starter arkivering...");try{const C=await ve(z(q,`simulation_rooms/${R}`));if(C.exists()){const V=C.val().players||{},P=Object.values(V).filter(W=>W.uid);if(P.length>0){const{recordCharacterLife:W}=await Tt(async()=>{const{recordCharacterLife:he}=await Promise.resolve().then(()=>bZ);return{recordCharacterLife:he}},void 0);p(`Arkiverer ${P.length} karakterer...`);const Y=(await Promise.allSettled(P.map(he=>W(he.uid,R,he)))).filter(he=>he.status==="fulfilled").length;console.log(`Mass Archival Complete for ${R}: ${Y}/${P.length} archived.`)}}p("Fjerner rom-data..."),await mN(z(q,`simulation_rooms/${R}`)),await mN(z(q,`simulation_server_metadata/${R}`)),alert(`Slettet rom ${R}. Karakterer er arkivert.`)}catch(C){console.error(C),alert("Kunne ikke slette rommet.")}finally{r(!1),p(null)}}},k=async()=>{r(!0);try{const[R,C]=await Promise.all([ve(z(q,"simulation_server_metadata")),ve(z(q,"simulation_rooms"))]),$=R.val()||{},V=C.val()||{};let P=0;const W={};Object.keys($).forEach(J=>{V[J]||(W[`simulation_server_metadata/${J}`]=null,P++)}),P>0?(await oe(z(q),W),alert(`Ryddet opp ${P} dde serverkoblinger!`)):alert("Alt ser ryddig ut!")}catch(R){console.error(R)}finally{r(!1)}},w=async()=>{if(!(!f||!f.players)){r(!0);try{const R=Yz(f.players),C={region_vest:{id:"region_vest",name:"Baroniet Vest",taxRate:10,defenseLevel:50,rulerName:"Ingen"},region_ost:{id:"region_ost",name:"Baroniet st",taxRate:10,defenseLevel:50,rulerName:"Ingen"}},$={...f.markets};$.capital||($.capital=JSON.parse(JSON.stringify(bt))),["region_vest","region_ost"].forEach(W=>{$[W]||($[W]=JSON.parse(JSON.stringify(bt)))}),Object.values(R).forEach(W=>{if(W.role==="BARON"){C[W.regionId]={...C[W.regionId],rulerName:W.name};const J=JSON.parse(JSON.stringify(bt));Object.keys(J).forEach(Y=>{J[Y].price=Math.floor(J[Y].price*(.8+Math.random()*.4)),J[Y].stock=Math.floor(J[Y].stock*(.8+Math.random()*.4))}),$[W.regionId]=J}});const V={};Object.values(R).forEach(W=>{V[W.id]={id:W.id,name:W.name,role:W.role,regionId:W.regionId,stats:{level:W.stats.level||1},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:W.lastActive}});const P={};P[`simulation_rooms/${t}/players`]=R,P[`simulation_rooms/${t}/public_profiles`]=V,P[`simulation_rooms/${t}/regions`]=C,P[`simulation_rooms/${t}/markets`]=$,P[`simulation_rooms/${t}/status`]="PLAYING",await oe(z(q),P),await Lm(t,{...f,status:"PLAYING"})}catch(R){console.error(R),alert("Klarte ikke starte.")}finally{r(!1)}}},S=async()=>{var R,C;if(f!=null&&f.players){r(!0);try{const $=((C=(R=f.world)==null?void 0:R.taxRateDetails)==null?void 0:C.kingTax)||20,{updatedPlayers:V,results:P}=Xz(f.players,$);await oe(z(q,`simulation_rooms/${t}/players`),V),alert(`Suksess! ${P.length} bnder og baroner ble skattlagt.`)}catch($){console.error($)}finally{r(!1)}}},_=async()=>{var P,W;if(!f)return;const R=["Spring","Summer","Autumn","Winter"],$=(R.indexOf(((P=f.world)==null?void 0:P.season)||"Spring")+1)%R.length,V=R[$];r(!0);try{const J=((W=Nn[V])==null?void 0:W.label)||V,Y={id:`msg_${Date.now()}`,content:` rstiden har skiftet til ${J}!`,timestamp:Date.now(),type:"SEASON_CHANGE"},he=[...x(f.messages),Y].slice(-50);await oe(z(q),{[`simulation_rooms/${t}/world/season`]:V,[`simulation_rooms/${t}/messages`]:he})}catch(J){console.error(J)}finally{r(!1)}},T=async()=>{if(!f)return;const R=["Clear","Rain","Storm","Fog"],C=R.indexOf(f.world.weather||"Clear"),$=R[(C+1)%R.length];try{const V={Clear:"Klart",Rain:"Regn",Storm:"Storm",Fog:"Tke"},P={id:`msg_${Date.now()}`,content:` Vret har skiftet til ${V[$]||$}!`,timestamp:Date.now(),type:"WEATHER_CHANGE"},W=[...x(f.messages),P].slice(-50);await oe(z(q),{[`simulation_rooms/${t}/world/weather`]:$,[`simulation_rooms/${t}/messages`]:W})}catch(V){console.error(V)}},E=async()=>{if(!f)return;const{LAW_TEMPLATES:R}=await Tt(async()=>{const{LAW_TEMPLATES:V}=await Promise.resolve().then(()=>FN);return{LAW_TEMPLATES:V}},void 0),C=R[Math.floor(Math.random()*R.length)],$={lawId:C.id,title:C.label,votes:{},expiresAt:Date.now()+6e4};try{const V={id:`msg_${Date.now()}`,content:` TINGET ER SATT! Det skal stemmes over loven: "${C.label}"!`,timestamp:Date.now(),type:"VOTE_START"},P=[...x(f.messages),V].slice(-50);await oe(z(q,`simulation_rooms/${t}`),{activeVote:$,messages:P}),setTimeout(()=>A(C.id),6e4)}catch(V){console.error(V)}},A=async R=>{var fe;const C=await ve(z(q,`simulation_rooms/${t}/activeVote`));if(!C.exists())return;const $=C.val(),V=Object.values($.votes||{}),P=V.filter(ce=>ce==="YES").length,W=V.filter(ce=>ce==="NO").length;let J=((fe=f==null?void 0:f.world)==null?void 0:fe.activeLaws)||[],Y=P>W?` LOVEN ER VEDTATT! "${$.title}" er n gjeldende.`:` LOVEN BLE FORKASTET. "${$.title}" ble nedstemt.`;P>W&&(J=[...J,R]);const he={id:`msg_${Date.now()}`,content:Y,timestamp:Date.now(),type:"VOTE_RESULT"};try{await oe(z(q,`simulation_rooms/${t}/world`),{activeLaws:J}),await oe(z(q,`simulation_rooms/${t}`),{activeVote:null,messages:[...x(f==null?void 0:f.messages),he].slice(-50)})}catch(ce){console.error(ce)}},j=async()=>{if(!f)return;const{WORLD_EVENT_TEMPLATES:R}=await Tt(async()=>{const{WORLD_EVENT_TEMPLATES:V}=await Promise.resolve().then(()=>FN);return{WORLD_EVENT_TEMPLATES:V}},void 0),C=R[Math.floor(Math.random()*R.length)],$=`event_${Date.now()}`;try{const V={id:`msg_${Date.now()}`,content:` HENDELSE: ${C.title}! Sjekk kartet!`,timestamp:Date.now(),type:"EVENT_SPAWN"},P=[...x(f.messages),V].slice(-50);await oe(z(q,`simulation_rooms/${t}/worldEvents`),{[$]:{...C,id:$,expiresAt:Date.now()+3e5}}),await oe(z(q,`simulation_rooms/${t}`),{messages:P})}catch(V){console.error(V)}},O=async R=>{r(!0);try{const C=`char_${Math.random().toString(36).substr(2,9)}`,$={id:C,name:R.name,role:R.role,regionId:R.role==="KING"?"capital":Math.random()>.5?"region_ost":"region_vest",resources:ms[R.role]||ms.PEASANT,status:{hp:100,stamina:100,morale:100,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},stats:{level:R.level,xp:0,reputation:10,contribution:0},skills:An[R.role]||An.PEASANT,lastActive:Date.now(),online:!0},V={};V[`simulation_rooms/${t}/players/${C}`]=$,V[`simulation_rooms/${t}/public_profiles/${C}`]={id:C,name:$.name,role:$.role,regionId:$.regionId,stats:{level:$.stats.level},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:$.lastActive},await oe(z(q),V)}catch(C){console.error(C)}finally{r(!1)}},H=async()=>{if(window.confirm("Er du sikker? Dette vil regenerere 'public_profiles'.")){r(!0);try{const R=await ve(z(q,`simulation_rooms/${t}`));if(!R.exists())return;const C=R.val(),$=C.players||{},V={};Object.entries($).forEach(([P,W])=>{var J,Y,he,fe;V[`simulation_rooms/${t}/public_profiles/${P}`]={id:P,uid:W.uid||null,name:W.name,role:W.role,regionId:W.regionId,stats:{level:((J=W.stats)==null?void 0:J.level)||1},status:{isJailed:((Y=W.status)==null?void 0:Y.isJailed)||!1,isFrozen:((he=W.status)==null?void 0:he.isFrozen)||!1,legitimacy:((fe=W.status)==null?void 0:fe.legitimacy)||100},online:!0,lastActive:W.lastActive||Date.now()}}),C.status||(V[`simulation_rooms/${t}/status`]="LOBBY"),await oe(z(q),V),alert("Data reparert!")}catch(R){console.error(R)}finally{r(!1)}}},G=async()=>{if(window.confirm("Er du sikker? Alt slettes.")){r(!0);try{const R={};R[`simulation_rooms/${t}/status`]="LOBBY",R[`simulation_rooms/${t}/worldEvents`]={},R[`simulation_rooms/${t}/messages`]=[],R[`simulation_rooms/${t}/market`]=bt,R[`simulation_rooms/${t}/markets`]={capital:bt},R[`simulation_rooms/${t}/regions`]={},R[`simulation_rooms/${t}/world/monumentProgress`]=0,R[`simulation_rooms/${t}/world/activeLaws`]=[],R[`simulation_rooms/${t}/world/settlement/buildings`]=Object.entries(Fs).reduce((C,[$])=>({...C,[$]:{id:$,level:0,progress:{},target:200,contributions:{}}}),{}),Object.keys((f==null?void 0:f.players)||{}).forEach(C=>{R[`simulation_rooms/${t}/players/${C}/role`]="PEASANT",R[`simulation_rooms/${t}/players/${C}/regionId`]="capital",R[`simulation_rooms/${t}/players/${C}/resources`]=ms.PEASANT,R[`simulation_rooms/${t}/players/${C}/status`]={stamina:100,legitimacy:100,authority:50},R[`simulation_rooms/${t}/public_profiles/${C}/role`]="PEASANT",R[`simulation_rooms/${t}/public_profiles/${C}/regionId`]="capital",R[`simulation_rooms/${t}/public_profiles/${C}/stats/level`]=1}),await oe(z(q),R),m(C=>C?{...C,status:"LOBBY",messages:[]}:null),alert("Spillet er nullstilt!")}catch(R){console.error(R)}finally{r(!1)}}},[L,M]=N.useState(null);if(N.useEffect(()=>{Tt(()=>import("./SimulationEconomyBlueprint-BWKysUxB.js"),[]).then(R=>M(()=>R.SimulationEconomyBlueprint))},[]),!c)return o.jsx(uJ,{onAuth:()=>u(!0),adminPassword:TZ});if(a==="LIST")return o.jsx(dJ,{allRooms:s,isLoading:i,onCreateRoom:v,onDeleteRoom:y,onManageRoom:R=>{e(R),l("MANAGE")},onCleanupMetadata:k,archivingStatus:g});const D=async()=>{if(!t)return;r(!0);let R=[];try{const C=await ve(z(q,`simulation_archives/${t}/full_log`));C.exists()&&(R=Object.values(C.val()))}catch(C){console.warn("Archive fetch failed (likely permissions), falling back to live data.",C)}if(R.length===0&&(f!=null&&f.messages)&&(R=Array.isArray(f.messages)?f.messages:Object.values(f.messages),R.length>0&&console.log("Exported live data fallback.")),R.length===0){alert("Ingen data  eksportere (verken i arkiv eller live-feed)."),r(!1);return}try{const C=new Blob([JSON.stringify(R,null,2)],{type:"application/json"}),$=URL.createObjectURL(C),V=document.createElement("a");V.href=$,V.download=`simulation_log_${t}_${new Date().toISOString()}.json`,V.click(),URL.revokeObjectURL($)}catch(C){console.error("Blob creation failed:",C),alert("Kunne ikke generere fil.")}r(!1)};if(!f)return null;const I={onStartGame:w,onTogglePublic:()=>oe(z(q,`simulation_rooms/${t}`),{isPublic:!f.isPublic}),onRepairData:H,onResetGame:G,onNextSeason:_,onChangeWeather:T,onSpawnEvent:j,onStartTing:E,onExportLog:D,initializeSettlement:async()=>{r(!0),await oe(z(q,`simulation_rooms/${t}/world/settlement`),{buildings:Object.entries(Fs).reduce((R,[C])=>({...R,[C]:{id:C,level:0,progress:{},target:200,contributions:{}}}),{})}),r(!1)},handleBuildingLevelChange:async(R,C)=>{var V,P,W;const $=(W=(P=(V=f.world)==null?void 0:V.settlement)==null?void 0:P.buildings)==null?void 0:W[R];$&&await oe(z(q,`simulation_rooms/${t}/world/settlement/buildings/${R}`),{level:Math.max(0,$.level+C),progress:{}})},onTaxationBase:S},F={onRegenStamina:async()=>{r(!0);const R={};Object.keys(f.players||{}).forEach(C=>{R[`simulation_rooms/${t}/players/${C}/status/stamina`]=100}),await oe(z(q),R),r(!1)},onResetUnrest:async()=>{r(!0);const R={};Object.keys(f.regions||{}).forEach(C=>{R[`simulation_rooms/${t}/regions/${C}/coup/bribeProgress`]=0,R[`simulation_rooms/${t}/regions/${C}/coup/contributions`]={}}),await oe(z(q),R),r(!1)},onKickAll:async()=>{window.confirm("Kast ut alle?")&&await oe(z(q),{[`simulation_rooms/${t}/players`]:{}})},onSpawnCharacter:O,kickPlayer:async(R,C)=>{window.confirm(`Kast ut ${C}?`)&&await oe(z(q),{[`simulation_rooms/${t}/players/${R}`]:null,[`simulation_rooms/${t}/public_profiles/${R}`]:null})},handlePlayerLevelChange:async(R,C)=>{await oe(z(q),{[`simulation_rooms/${t}/players/${R}/stats/level`]:C,[`simulation_rooms/${t}/public_profiles/${R}/stats/level`]:C})},handleRoleChange:async(R,C)=>{await oe(z(q),{[`simulation_rooms/${t}/players/${R}/role`]:C,[`simulation_rooms/${t}/public_profiles/${R}/role`]:C})},handleRegionChange:async(R,C)=>{await oe(z(q),{[`simulation_rooms/${t}/players/${R}/regionId`]:C,[`simulation_rooms/${t}/public_profiles/${R}/regionId`]:C})},controlPlayer:R=>window.open(`${window.location.origin}/Simulation_StandAlone_Pro/play/${t}?impersonate=${R}`,"_blank"),onGiveGold:(R,C)=>h7(t,R,C),onGiveResource:(R,C,$)=>m7(t,R,C,$),onGiveItem:(R,C,$)=>f7(t,R,C,$)};return o.jsx(SZ,{pin:t,roomData:f,view:a,setView:l,isLoading:i,onBack:()=>l("LIST"),worldActions:I,playerActions:F,SimulationEconomyBlueprint:L})};function AZ(t,e){const{user:s,authLoading:n}=yc(),[i,r]=N.useState(null),[a,l]=N.useState(null),[c,u]=N.useState({}),[d,h]=N.useState("LOBBY"),[f,m]=N.useState({}),[b,x]=N.useState({}),[v,g]=N.useState([]),[p,y]=N.useState(null),[k,w]=N.useState({}),[S,_]=N.useState({}),[T,E]=N.useState(!1),[A,j]=N.useState(!1),[O,H]=N.useState(!1),G=N.useRef(null),L=N.useRef(null);N.useEffect(()=>{if(n)return;const D=localStorage.getItem("sim_player_id");let I=e;if(I||(s!=null&&s.uid?I=s.uid:I=D),!I||!t)return;const F=`simulation_rooms/${t}`,U=z(q,`${F}/players/${I}`),R=tt(U,Z=>{if(E(!0),Z.exists()){G.current&&(clearTimeout(G.current),G.current=null);const B=Z.val();if(t==="TEST"&&B.regionId==="unassigned"&&B.role!=="KING"){const K=Math.random()>.5?"region_east":"region_west";oe(U,{regionId:K})}const ae={...B,id:I};r(ae),L.current=ae,j(!0)}else A?G.current||(G.current=setTimeout(()=>{H(!0),r(null),j(!1),L.current=null},5e3)):r(null)}),C=z(q,`${F}/world`),$=tt(C,Z=>{const B=Z.val();B&&l(B)}),V=z(q,`${F}/status`),P=tt(V,Z=>{const B=Z.val();B&&h(B||"LOBBY")}),W=z(q,`${F}/markets`),J=tt(W,Z=>{const B=Z.val();B&&m(B)}),Y=z(q,`${F}/messages`),he=tt(Y,Z=>{const B=Z.val();B&&g(B)}),fe=z(q,`${F}/activeVote`),ce=tt(fe,Z=>{y(Z.val())}),ne=z(q,`${F}/diplomacy`),Le=tt(ne,Z=>{w(Z.val()||{})}),lt=z(q,`${F}/trades`),se=tt(lt,Z=>{_(Z.val()||{})}),le=z(q,`${F}/players`),ke=tt(le,Z=>{const B=Z.val()||{};u(B)}),we=z(q,`${F}/regions`),Q=tt(we,Z=>{x(Z.val()||{})});return()=>{R(),$(),P(),J(),he(),ce(),Le(),ke(),se(),Q()}},[t,e,s==null?void 0:s.uid,n,A]),N.useEffect(()=>{if(!i||!t)return;const D=z(q,`simulation_rooms/${t}/players/${i.id}`),I=z(q,`simulation_rooms/${t}/public_profiles/${i.id}`);fN(D).update({online:!1}),fN(I).update({online:!1});const F=setInterval(()=>{const U=Date.now();oe(D,{lastActive:U,online:!0}),oe(I,{lastActive:U,online:!0})},3e4);return oe(D,{lastActive:Date.now(),online:!0}),oe(I,{lastActive:Date.now(),online:!0}),()=>clearInterval(F)},[t,i==null?void 0:i.id]),N.useEffect(()=>{if(!t||!t.startsWith("v"))return;const D=localStorage.getItem("nexus_active_vessel");if(D)try{const I=JSON.parse(D);if(I.id===t){console.log("Nexus Vessel Detected. Injecting Mock Data...",I);const F={id:I.id,uid:(s==null?void 0:s.uid)||"nexus_user",name:I.name,role:I.role.toUpperCase(),regionId:"nexus_region",resources:{gold:I.gold,grain:100,flour:0,bread:5,wood:50,plank:0,iron_ore:0,iron_ingot:0,stone:0,swords:0,armor:0,favor:0,wool:0,cloth:0,honey:0,meat:0,glass:0,manpower:10,egg:0,omelette:0},stats:{xp:0,level:1,reputation:50,contribution:0},status:{hp:I.health,morale:100,stamina:100,legitimacy:100,authority:100,loyalty:100,isJailed:!1,isFrozen:!1},equipment:{},skills:{FARMING:{level:1,xp:0,maxXp:100},WOODCUTTING:{level:1,xp:0,maxXp:100},MINING:{level:1,xp:0,maxXp:100},CRAFTING:{level:1,xp:0,maxXp:100},STEWARDSHIP:{level:1,xp:0,maxXp:100},COMBAT:{level:1,xp:0,maxXp:100},TRADING:{level:1,xp:0,maxXp:100},THEOLOGY:{level:1,xp:0,maxXp:100}},upgrades:[],lastActive:Date.now()};r(F),j(!0),E(!0),h("PLAYING"),l({year:1250,season:"Spring",weather:"Clear",gameTick:100,lastTickAt:Date.now(),taxRateDetails:{kingTax:10},settlement:{buildings:{}}})}}catch(I){console.error("Failed to parse Nexus vessel data",I)}},[t,s==null?void 0:s.uid]);const M=Object.values(c||{}).filter(D=>D.online&&Date.now()-(D.lastActive||0)<6e4).length;return gR(t,d,a,M),{player:i,world:a,players:c,roomStatus:d,markets:f,regions:b,messages:v,activeVote:p,diplomacy:k,trades:S,hasAttemptedPlayerLoad:T,hasActiveSession:A,isRetired:O,setIsRetired:H,setPlayer:r,lastValidPlayer:L.current}}function gO(t,e,s,n,i,r,a){const[l,c]=N.useState(null),[u,d]=N.useState(null);N.useEffect(()=>{if(l){const m=setTimeout(()=>{console.warn("[useSimulationActions] Self-Healing: Resetting stuck loading state:",l),c(null)},5e3);return()=>clearTimeout(m)}},[l]);const h=N.useCallback(()=>{d(null)},[]),f=N.useCallback(async m=>{var y;if(!t||!e||l)return;const b=typeof m=="string"?m:m.type,x=typeof m=="object"?m.method:null;if(["WORK","CHOP","CRAFT","DEFEND","EXPLORE","MINE","QUARRY","PATROL","FORAGE","REFINE","SMELT","BAKE","WEAVE","MIX","PLANT","HARVEST","GATHER_WOOL","HUNT","SAWMILL","MOUNT_HORSE","TRAVEL_START"].includes(b)&&!a&&!m.performance){const k=(s==null?void 0:s.season)||"Spring",w=(s==null?void 0:s.weather)||"Clear",S=(s==null?void 0:s.gameTick)||0,_=uO(e,m,k,w,S);if(!_.success){alert(`Du har ikke rd til dette: ${_.reason}`),d({success:!1,timestamp:Date.now(),message:`Kan ikke utfre: ${_.reason}`,utbytte:[],xp:[],durability:[]});return}let T=b;if(b==="REFINE"){const j=m.recipeId;(j==="iron_ingot"||j==="glass"||j==="smelt")&&(T="SMELT"),(j==="bread"||j==="pie"||j==="mead"||j==="bake")&&(T="BAKE"),(j==="cloth"||j==="weave")&&(T="WEAVE"),j==="plank"&&(T="SAWMILL"),["minor_stamina_potion","herbal_balm","focus_brew","strength_tincture","masters_draught","elixir_of_life"].includes(j)&&(T="MIX")}b==="CRAFT"&&m.subType==="omelette"&&(T="BAKE");const A=(e.activeProcesses||[]).find(j=>{var O;return(j.locationId===m.locationId||m.locationId&&((O=j.locationId)==null?void 0:O.startsWith(m.locationId)))&&j.readyAt<=Date.now()});if(!(b==="REFINE"&&m.recipeId==="flour"||b==="HARVEST"&&((A==null?void 0:A.type)==="MILL"||(A==null?void 0:A.type)==="CRAFT"))){n(T),x&&i(x),r(m),d(null);return}}const g=b==="EQUIP_ITEM"||b==="UNEQUIP_ITEM"||b==="CONSUME";m.performance&&!g&&(n(null),r(null),i(null)),g||c(b);const p=new Promise((k,w)=>{setTimeout(()=>w(new Error("Handlingen tok for lang tid (Timeout)")),3e4)});try{const k=await Promise.race([pO(t,e.id,m),p]);(!g||b==="CONSUME")&&(k.data?d(k.data):k.success||d({success:!1,timestamp:Date.now(),message:`Handlingen feilet: ${((y=k.error)==null?void 0:y.message)||k.error||"Ukjent feil"}`,utbytte:[],xp:[],durability:[]}))}catch(k){console.error("Action Timeout/Error:",k),g||d({success:!1,timestamp:Date.now(),message:` ${k.message||"Ukjent feil"}`,utbytte:[],xp:[],durability:[]})}finally{g||c(null),n(null),r(null),i(null)}},[t,e,l,s,a,n,i,r]);return{actionLoading:l,actionResult:u,setActionResult:d,handleAction:f,handleClearActionResult:h,setActionLoading:c}}const zi=({resource:t,amount:e,size:s="md",showLabel:n=!1,className:i=""})=>{const r=Ge[t]||{label:t,icon:""},a={sm:"text-xl",md:"text-3xl",lg:"text-7xl"};return o.jsxs("div",{className:`flex items-center gap-2 ${i}`,title:r.label,children:[o.jsx("span",{className:`${a[s]}`,children:r.icon}),o.jsxs("div",{className:"flex flex-col leading-none",children:[n&&o.jsx("span",{className:"text-[10px] uppercase font-bold tracking-wider opacity-70 mb-0.5",children:r.label}),e!==void 0&&o.jsx("span",{className:`font-mono font-bold ${s==="lg"?"text-xl":"text-sm"}`,children:e.toLocaleString()})]})]})},dT=(t,e=800)=>{const[s,n]=N.useState(t),i=N.useRef(t);return N.useEffect(()=>{if(i.current===t)return;const r=i.current,a=t;let l=null;const c=u=>{l||(l=u);const d=Math.min((u-l)/e,1);n(r+(a-r)*d),d<1?requestAnimationFrame(c):i.current=t};requestAnimationFrame(c)},[t,e]),s},jZ=({room:t,player:e,onAction:s})=>{var E,A,j,O,H,G,L,M,D,I,F;const{activeTab:n,setActiveTab:i,activeMinigame:r}=yo(),{playSfx:a}=S_(),[l,c]=N.useState(!1),[u,d]=N.useState({tick:((E=t.world)==null?void 0:E.gameTick)||0,time:Date.now()});N.useEffect(()=>{var U,R;((U=t.world)==null?void 0:U.gameTick)!==u.tick&&d({tick:((R=t.world)==null?void 0:R.gameTick)||0,time:Date.now()})},[(A=t.world)==null?void 0:A.gameTick,u.tick]);const h=(j=t.regions)==null?void 0:j[e.regionId||"capital"],f=(((O=h==null?void 0:h.coup)==null?void 0:O.bribeProgress)||0)>0||!!(h!=null&&h.activeElection);N.useEffect(()=>{const U=R=>{if(R.target instanceof HTMLInputElement||R.target instanceof HTMLTextAreaElement||r)return;const C=R.key.toLowerCase(),$={m:"MAP",l:"ACTIVITY",p:"PROFILE",i:"INVENTORY",f:"SKILLS",d:"DIPLOMACY",h:"HIERARCHY"};if($[C]){if(C==="d"&&e.role==="PEASANT")return;i($[C]),a("ui_click.ogg")}};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[i,e.role,a,r]);const[,m]=N.useState(0);N.useEffect(()=>{const U=setInterval(()=>m(R=>R+1),1e3);return()=>clearInterval(U)},[]);const b=e.status.stamina||0,x=e.status.hp||0,v=e.stats.xp||0,g=e.stats.level||1,p=Dm[g]||1e3,y=Math.min(100,v/p*100),k=dT(b),w=dT(x),S=[{id:"MAP",label:"Kart",icon:nO,short:"M"},{id:"ACTIVITY",label:"Live",icon:md,short:"L"},{id:"INVENTORY",label:"Eiendeler",icon:rO,short:"I"},{id:"SKILLS",label:"Ferdigheter",icon:SQ,short:"F"},...e.role!=="PEASANT"?[{id:"DIPLOMACY",label:"Diplomati",icon:md,short:"D"}]:[],{id:"HIERARCHY",label:"Samfunn",icon:tO,short:"H"}],_=((H=t.world)==null?void 0:H.year)||1100,T=((L=Nn[(G=t.world)==null?void 0:G.season])==null?void 0:L.label)||((M=t.world)==null?void 0:M.season);return o.jsxs("header",{className:"flex-none h-14 md:h-16 border-b border-white/5 bg-slate-950/80 backdrop-blur-xl flex items-center justify-between px-4 md:px-6 z-50 relative shrink-0 transition-all",children:[o.jsxs("div",{className:"flex items-center gap-4 md:gap-6",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"text-2xl md:text-3xl font-black text-white tracking-tighter leading-none tabular-nums shadow-indigo-500/50 drop-shadow-lg",children:n7(u.tick,u.time)}),o.jsxs("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest hidden sm:inline",children:["R ",_]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-400 mt-0.5",children:[o.jsxs("div",{className:"flex items-center gap-1.5",children:[o.jsx("span",{className:((D=t.world)==null?void 0:D.season)==="Winter"?"text-blue-300 drop-shadow-[0_0_8px_rgba(147,197,253,0.5)]":"text-amber-400 drop-shadow-[0_0_8px_rgba(251,191,36,0.5)]",children:T}),o.jsx("span",{className:"text-slate-600",children:""}),o.jsx("span",{className:"",title:xa(((I=t.world)==null?void 0:I.gameTick)||0)==="DAY"?"Dag":"Natt",children:xa(((F=t.world)==null?void 0:F.gameTick)||0)==="DAY"?" Dag":" Natt"})]}),f&&o.jsx("button",{onClick:()=>{i("POLITICS"),a("ui_click.ogg")},className:"flex items-center gap-2 bg-rose-600/20 border border-rose-500/50 px-2 py-0.5 rounded-full animate-pulse group hover:bg-rose-500 hover:text-white transition-all ml-2",title:"Uro i regionen! Klikk for  se politisk status.",children:o.jsx("span",{className:"text-[9px] font-black italic tracking-tighter",children:" URO"})})]})]}),o.jsx("nav",{className:"hidden md:flex items-center gap-1 bg-white/5 p-1 rounded-xl border border-white/5",children:S.map(U=>{const R=n===U.id,C=U.icon;return o.jsxs("button",{onClick:()=>{i(U.id),a("ui_click.ogg")},className:`
                                    relative px-3 py-1.5 md:py-2 rounded-lg flex items-center gap-2 transition-all group overflow-hidden
                                    ${R?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}
                                `,title:U.label,children:[o.jsx(C,{size:16,className:R?"animate-pulse":""}),o.jsx("span",{className:"hidden xl:block text-xs font-bold uppercase tracking-wider ",children:U.label}),U.short&&o.jsx("span",{className:`text-[9px] absolute top-0.5 right-1 font-mono font-bold transition-opacity hidden xl:block ${R?"text-indigo-300":"text-slate-700 group-hover:text-slate-500"}`,children:U.short})]},U.id)})})]}),o.jsxs("div",{className:"flex items-center gap-3 md:gap-5",children:[e.activeBuffs&&e.activeBuffs.length>0&&o.jsx("div",{className:"flex items-center gap-1 mr-1",children:e.activeBuffs.map(U=>o.jsx(CZ,{buff:U},U.id))}),o.jsxs("div",{className:"hidden md:flex items-center bg-slate-900/50 rounded-full border border-white/5 overflow-hidden transition-all duration-300",children:[o.jsxs("button",{onClick:()=>{i("INVENTORY"),a("ui_click.ogg")},className:"flex items-center gap-2 hover:bg-white/5 px-3 py-1.5 transition-colors cursor-pointer group active:scale-95",title:"pne Eiendeler (I)",children:[o.jsx(zi,{resource:"gold",amount:e.resources.gold,size:"sm"}),o.jsx("span",{className:"hidden xl:inline text-[10px] font-black uppercase tracking-widest text-slate-500 group-hover:text-slate-300 transition-colors ml-1",children:"Gull"})]}),o.jsx("div",{className:"w-px h-3 bg-white/10"}),o.jsxs("button",{onClick:()=>{e.resources.bread?(s==null||s({type:"CONSUME",itemId:"bread",isResource:!0}),a("eat.ogg")):(i("INVENTORY"),a("ui_click.ogg"))},disabled:!e.resources.bread,className:`flex items-center gap-2 px-3 py-1.5 transition-all cursor-pointer group border-l border-white/0 active:scale-95 ${e.resources.bread?"hover:bg-emerald-500/10 hover:border-emerald-500/20":"opacity-40 cursor-not-allowed"}`,title:e.resources.bread?"Spis Brd (+20 Stamina)":"Tomt for brd",children:[o.jsx(zi,{resource:"bread",amount:e.resources.bread||0,size:"sm"}),o.jsx("div",{className:"hidden xl:flex flex-col items-start -space-y-1",children:o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest transition-colors ${e.resources.bread?"text-slate-500 group-hover:text-emerald-400":"text-slate-600"}`,children:e.resources.bread?"Spis":"Tom"})})]})]}),o.jsxs("div",{className:"flex flex-col gap-1 w-20 md:w-24",children:[o.jsxs("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden relative group",children:[o.jsx(ee.div,{className:"absolute inset-y-0 left-0 bg-rose-500 rounded-full",initial:{width:0},animate:{width:`${w}%`}}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 flex items-center justify-center text-[8px] font-black text-white bg-black/50 transition-opacity",children:["HP ",Math.round(w),"%"]})]}),o.jsxs("div",{className:"h-1 bg-slate-800 rounded-full overflow-hidden relative group",children:[o.jsx(ee.div,{className:"absolute inset-y-0 left-0 bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.5)]",initial:{width:0},animate:{width:`${k}%`}}),o.jsxs("div",{className:"absolute inset-0 opacity-0 group-hover:opacity-100 flex items-center justify-center text-[8px] font-black text-black bg-white/50 transition-opacity",children:["STA ",Math.round(k),"%"]})]}),o.jsx("div",{className:"h-0.5 bg-slate-800/50 rounded-full overflow-hidden relative group mt-0.5",children:o.jsx(ee.div,{className:"absolute inset-y-0 left-0 bg-indigo-500",initial:{width:0},animate:{width:`${y}%`}})})]}),o.jsxs("button",{onClick:()=>{i("PROFILE"),a("ui_click.ogg")},className:"group flex items-center gap-3 bg-white/0 hover:bg-white/5 pl-2 pr-1 py-1 rounded-2xl border border-transparent hover:border-white/10 transition-all active:scale-95",title:"Min Karakter (P)",children:[o.jsx("div",{className:"hidden 2xl:flex flex-col items-end",children:o.jsx("span",{className:"text-sm font-black italic tracking-tighter text-white leading-none",children:e.name})}),o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-8 h-8 md:w-9 md:h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 p-0.5 shadow-lg overflow-hidden group-hover:shadow-indigo-500/20",children:e.avatar?o.jsx("img",{src:e.avatar,alt:"Profile",className:"w-full h-full object-cover rounded-[6px]"}):o.jsx("div",{className:"w-full h-full flex items-center justify-center bg-slate-900 rounded-[6px] text-base",children:e.role==="KING"?"":""})}),o.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-slate-900 rounded-full flex items-center justify-center border border-white/10 text-[8px] font-black text-white z-10",children:g})]})]}),o.jsx(hT,{icon:CQ,onClick:()=>i("SETTINGS"),title:"Innstillinger"}),e.role==="MERCHANT"&&o.jsx(hT,{icon:JQ,onClick:()=>s==null?void 0:s({type:"OPEN_CARAVAN"}),title:"Karavane",className:"text-amber-400 border border-amber-400/20 bg-amber-100/5 hover:bg-amber-400/20"}),o.jsx("button",{className:"md:hidden text-white p-2",onClick:()=>c(!l),children:l?o.jsx(Yn,{}):o.jsx(dQ,{})})]}),o.jsx(qt,{children:l&&o.jsxs(ee.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"absolute top-16 left-0 right-0 bg-slate-900 border-b border-white/10 p-4 shadow-2xl md:hidden flex flex-col gap-2 z-40",children:[S.map(U=>o.jsxs("button",{onClick:()=>{i(U.id),c(!1)},className:`w-full p-4 rounded-xl text-left font-black uppercase flex items-center gap-4 ${n===U.id?"bg-indigo-600 text-white":"bg-white/5 text-slate-400"}`,children:[o.jsx(U.icon,{size:20}),U.label]},U.id)),o.jsx("div",{className:"h-px bg-white/5 my-2"}),o.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-500 font-bold uppercase tracking-widest px-2",children:[o.jsxs("span",{children:["r ",_]}),o.jsx("span",{children:T})]})]})})]})},hT=({icon:t,onClick:e,title:s,className:n})=>o.jsx("button",{onClick:e,title:s,className:`hidden md:flex p-2 text-slate-400 hover:text-white hover:bg-white/5 rounded-lg transition-all ${n}`,children:o.jsx(t,{size:20})}),CZ=({buff:t})=>{const[e,s]=N.useState(Math.max(0,Math.ceil((t.expiresAt-Date.now())/6e4)));return N.useEffect(()=>{const n=setInterval(()=>{const i=Math.max(0,Math.ceil((t.expiresAt-Date.now())/6e4));s(i)},1e4);return()=>clearInterval(n)},[t.expiresAt]),Date.now()>t.expiresAt?null:o.jsxs("div",{className:"group relative flex items-center justify-center w-8 h-8 rounded-full bg-emerald-500/10 border border-emerald-500/30 text-emerald-400 cursor-help",children:[o.jsx("span",{className:"text-lg",children:""}),o.jsxs("span",{className:"absolute -bottom-1 -right-1 text-[8px] font-black bg-slate-900 px-1 rounded-full border border-white/10",children:[e,"m"]}),o.jsxs("div",{className:"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-slate-900 p-2 rounded-lg border border-white/10 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none w-32 text-center z-50",children:[o.jsx("p",{className:"text-[10px] font-bold text-white mb-0.5",children:t.label}),o.jsxs("p",{className:"text-[9px] text-emerald-400",children:[t.value*100,"% mindre stamina"]})]})]})},m1=Se.memo(({src:t,placeholderSrc:e,alt:s,className:n,imgClassName:i="object-cover w-full h-full",priority:r=!1,disableMotion:a=!1})=>{const[l,c]=N.useState(!1),[u,d]=N.useState(e||t);return N.useEffect(()=>{c(!1),e&&d(e);const h=new Image;h.src=t,h.onload=()=>{d(t),c(!0)}},[t,e]),o.jsx("div",{className:`relative overflow-hidden ${n}`,children:o.jsx(ee.img,{src:u,alt:s,loading:r?"eager":"lazy",className:`${i} transition-all duration-700 ease-in-out`,initial:{filter:"blur(20px)",scale:a?1:1.1},animate:{filter:l?"blur(0px)":"blur(20px)",scale:a||l?1:1.1},style:{willChange:"filter, transform"}},t)})});m1.displayName="ProgressiveImage";const Br=[{id:"fields",label:"krene",icon:"",top:"22%",left:"42%",vest:{top:"35%",left:"70%"},ost:{top:"35%",left:"45%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"forest",label:"Skogen",icon:"",top:"25%",left:"80%",vest:{top:"15%",left:"60%"},ost:{top:"27%",left:"14%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"castle",label:"Slottet",icon:"",top:"66%",left:"86%",vest:{top:"40%",left:"30%"},ost:{top:"40%",left:"68%"},roles:["PEASANT","BARON","KING","SOLDIER"],actions:[{id:"OPEN_CONSTRUCTION",label:"Bidra til bygging",cost:"Ressurser"},{id:"OPEN_TAXATION",label:"Skattekammeret",cost:"Baron Only",roleReq:"BARON"}],isHub:!0},{id:"peasant_farm",label:"Husmannsplassen",icon:"",top:"30%",left:"60%",vest:{top:"85%",left:"72%"},ost:{top:"75%",left:"30%"},roles:["PEASANT","BARON"],actions:[],isHub:!0},{id:"market",label:"Markedet",icon:"",top:"70%",left:"25%",vest:{top:"70%",left:"37%"},ost:{top:"70%",left:"63%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[{id:"MARKET_VIEW",label:"pne Handel",cost:"Gratis"},{id:"JOIN_ROLE",label:"Bli Kjpmann",cost:"500g + Niv 3",targetRole:"MERCHANT"}]},{id:"village",label:"Landsbyen",icon:"",top:"42%",left:"42%",vest:{top:"50%",left:"52%"},ost:{top:"55%",left:"44%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"mine",label:"Gruve-distriktet",icon:"",top:"12%",left:"25%",vest:{top:"13%",left:"39%"},ost:{top:"20%",left:"60%"},roles:["PEASANT","BARON","KING"],actions:[],isHub:!0},{id:"monastery",label:"Klosteret",icon:"",top:"16%",left:"55%",vest:{top:"50%",left:"78%"},ost:{top:"50%",left:"27%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"border",label:"Grensen",icon:"",top:"85%",left:"80%",vest:{top:"15%",left:"10%"},ost:{top:"15%",left:"10%"},roles:["BARON"],actions:[{id:"RAID",label:"Plyndre Nabo",cost:"-40"}]},{id:"dock",label:"Kaien",icon:"",top:"90%",left:"50%",vest:{top:"90%",left:"40%"},ost:{top:"90%",left:"60%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],actions:[],isHub:!0},{id:"flax_field",label:"Lin-keren",icon:"",roles:["PEASANT"],parentId:"fields",top:"70%",left:"40%",actions:[{id:"PLANT",label:"S Lin",cost:"-10 lin -30",cropId:"flax"}]},{id:"throne_room",label:"Tronsalen",icon:"",top:"40%",left:"50%",roles:["KING"],parentId:"castle",actions:[{id:"DECREE",label:"Utsted Dekret",cost:"King Only"}]},{id:"treasury",label:"Skattekammeret",icon:"",top:"55%",left:"65%",roles:["BARON","KING"],parentId:"castle",actions:[{id:"OPEN_TAXATION",label:"pne Skattekammeret",cost:"Administrasjon"}]},{id:"barracks",label:"Kasernen",icon:"",top:"60%",left:"30%",roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"DRAFT",label:"Verve Soldater",cost:"-5g -10"},{id:"JOIN_ROLE",label:"Bli Soldat",cost:"200g + Niv 3",targetRole:"SOLDIER"}]},{id:"royal_chambers",label:"Kongens Kammer",icon:"",top:"30%",left:"70%",roles:["BARON","KING"],parentId:"castle",actions:[{id:"REST",label:"Hvile i Kammeret",cost:"Full rest + Velvre"}]},{id:"castle_construction",label:"Byggeplass",icon:"",top:"75%",left:"80%",roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"OPEN_CONSTRUCTION",label:"Bidra til bygging",cost:"Ressurser"}]},{id:"war_room",label:"Krigsrommet",icon:"",top:"25%",left:"35%",roles:["BARON","KING","SOLDIER"],parentId:"castle",actions:[{id:"OPEN_WAR_ROOM",label:"pne Krigsrommet",cost:"Gratis"}]},{id:"village_square",label:"Landsbytorg",icon:"",top:"50%",left:"50%",village:{top:"48%",left:"50%"},roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"village",actions:[{id:"REST",label:"Hvile p torget",cost:"+10"}]},{id:"tavern",label:"Vertshuset",icon:"",top:"35%",left:"75%",village:{top:"75%",left:"80%"},roles:["PEASANT","BARON","KING","SOLDIER"],parentId:"village",actions:[{id:"ENTER_TAVERN",label:"G inn",cost:"Gratis"},{id:"REST_BASIC",label:"Hvile i Salen",cost:"Gratis"},{id:"REST_COMFY",label:"Bestille Kammer",cost:"-5g"},{id:"REST_ROYAL",label:"Kongelig Suite",cost:"-20g"}],isHub:!0,isInterior:!0},{id:"bakery",label:"Bakeri",icon:"",top:"80%",left:"30%",village:{top:"38%",left:"35%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"great_forge",label:"Storsmie",icon:"",top:"35%",left:"15%",village:{top:"48%",left:"23%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"windmill",label:"Vindmlle",icon:"",top:"20%",left:"37%",village:{top:"25%",left:"17%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_flour",label:"Male Mel",cost:"-15 -10korn"}],isHub:!0,isInterior:!0},{id:"smeltery",label:"Smeltehytte",icon:"",top:"60%",left:"95%",village:{top:"75%",left:"12%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_IRON_BASIC",label:"Smelte Jern",cost:"-20 -5malm"},{id:"REFINE_IRON_FAST",label:"Industri-smelting",cost:"-30 -10malm"},{id:"REFINE_STEEL",label:"Smelte Stl",cost:"-50 -20malm"}],isHub:!0,isInterior:!0},{id:"sawmill",label:"Sagbruk",icon:"",top:"55%",left:"15%",village:{top:"70%",left:"45%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[{id:"REFINE_PLANK_BASIC",label:"Sag Planker",cost:"-10 -5ved"},{id:"REFINE_PLANK_FAST",label:"Hurtig-saging",cost:"-15 -5ved"}],isHub:!0,isInterior:!0},{id:"weavery",label:"Veveri",icon:"",top:"50%",left:"85%",village:{top:"45%",left:"65%"},roles:["PEASANT","BARON","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"watchtower",label:"Vaktrn",icon:"",top:"15%",left:"68%",village:{top:"25%",left:"82%"},roles:["BARON","SOLDIER","KING"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"stables",label:"Stall",icon:"",top:"80%",left:"80%",village:{top:"45%",left:"90%"},roles:["PEASANT","BARON","SOLDIER","KING","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"well",label:"Bybrnn",icon:"",top:"69%",left:"60%",village:{top:"48%",left:"50%"},roles:["PEASANT","BARON","KING"],parentId:"village",actions:[],isHub:!0},{id:"apothecary",label:"Apoteker",icon:"",top:"20%",left:"82%",village:{top:"60%",left:"92%"},roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"village",actions:[],isHub:!0,isInterior:!0},{id:"forge_anvil",label:"Ambolt",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"great_forge",actions:[{id:"OPEN_CRAFTING",label:"pne Smia",cost:"Gratis"}]},{id:"forge_upgrades",label:"Tegneark",icon:"",top:"40%",left:"75%",roles:["PEASANT","BARON","KING"],parentId:"great_forge",actions:[{id:"BUILDING_UPGRADE_great_forge",label:"Oppgrader Smia",cost:"Varierer"}]},{id:"bakery_oven",label:"Bakerovn",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING"],parentId:"bakery",actions:[{id:"REFINE",label:"pne Bakeriet",cost:"Gratis"}]},{id:"bakery_upgrades",label:"Tegneark",icon:"",top:"30%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"bakery",actions:[{id:"BUILDING_UPGRADE_bakery",label:"Oppgrader Bakeriet",cost:"Varierer"}]},{id:"windmill_stones",label:"Kvernsteiner",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"windmill",actions:[{id:"REFINE",label:"pne Mlla",cost:"Gratis"}]},{id:"windmill_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"windmill",actions:[{id:"BUILDING_UPGRADE_windmill",label:"Oppgrader Mlla",cost:"Varierer"}]},{id:"sawmill_blade",label:"Saga",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"sawmill",actions:[{id:"REFINE",label:"pne Sagbruket",cost:"Gratis"}]},{id:"sawmill_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"sawmill",actions:[{id:"BUILDING_UPGRADE_sawmill",label:"Oppgrader Sagbruket",cost:"Varierer"}]},{id:"smeltery_furnace",label:"Smelteovn",icon:"",top:"50%",left:"30%",roles:["PEASANT","BARON","KING"],parentId:"smeltery",actions:[{id:"REFINE",label:"pne Smeltehytta",cost:"Gratis"}]},{id:"smeltery_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"smeltery",actions:[{id:"BUILDING_UPGRADE_smeltery",label:"Oppgrader Smeltehytta",cost:"Varierer"}]},{id:"weavery_loom",label:"Vevstol",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","MERCHANT"],parentId:"weavery",actions:[{id:"REFINE",label:"pne Veveriet",cost:"Gratis"}]},{id:"weavery_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON"],parentId:"weavery",actions:[{id:"BUILDING_UPGRADE_weavery",label:"Oppgrader Veveriet",cost:"Varierer"}]},{id:"stables_stall",label:"Stallplass",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","SOLDIER","KING","MERCHANT"],parentId:"stables",actions:[{id:"MOUNT_HORSE",label:"Ri ut",cost:"-5"}]},{id:"stables_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"stables",actions:[{id:"BUILDING_UPGRADE_stables",label:"Oppgrader Stallen",cost:"Varierer"}]},{id:"watchtower_top",label:"Vaktpost",icon:"",top:"30%",left:"50%",roles:["PEASANT","BARON","SOLDIER"],parentId:"watchtower",actions:[{id:"OPEN_GARRISON",label:"pne Garnisonen",cost:"Gratis"},{id:"PATROL",label:"Patruljer",cost:"-30"}]},{id:"watchtower_upgrades",label:"Tegneark",icon:"",top:"50%",left:"80%",roles:["BARON"],parentId:"watchtower",actions:[{id:"BUILDING_UPGRADE_watchtower",label:"Oppgrader Trnet",cost:"Varierer"}]},{id:"apothecary_bench",label:"Arbeidsbenk",icon:"",top:"50%",left:"40%",roles:["PEASANT","BARON","KING"],parentId:"apothecary",actions:[{id:"OPEN_CRAFTING",label:"pne Apoteket",cost:"Gratis"}]},{id:"apothecary_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"apothecary",actions:[{id:"BUILDING_UPGRADE_apothecary",label:"Oppgrader Apoteket",cost:"Varierer"}]},{id:"well_water",label:"Brnnkum",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING"],parentId:"well",actions:[{id:"GATHER_WATER",label:"Hent Vann",cost:"-10"}]},{id:"well_upgrades",label:"Tegneark",icon:"",top:"40%",left:"80%",roles:["PEASANT","BARON","KING"],parentId:"well",actions:[{id:"BUILDING_UPGRADE_well",label:"Oppgrader Brnnen",cost:"Varierer"}]},{id:"tavern_bar",label:"Baren",icon:"",top:"30%",left:"30%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_TAVERN_MENU",label:"Se Menykart",cost:"Gratis"}]},{id:"tavern_gambling",label:"Spillebordet",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_DICE_GAME",label:"Spill Terninger",cost:"Min. 0.5g"}]},{id:"tavern_resource_wheel",label:"Soga-hjulet",icon:"",top:"65%",left:"75%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"OPEN_RESOURCE_GAME",label:"Sats Ressurser",cost:"Varer"}]},{id:"tavern_gossip",label:"Lokalbefolkningen",icon:"",top:"40%",left:"70%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"tavern",actions:[{id:"CHAT_LOCAL",label:"Snakk med folk",cost:"Gratis"}]},{id:"tavern_upgrades",label:"Tegneark",icon:"",top:"25%",left:"85%",roles:["PEASANT","BARON","KING"],parentId:"tavern",actions:[{id:"BUILDING_UPGRADE_tavern",label:"Oppgrader Vertshuset",cost:"Varierer"}]},{id:"grain_fields",label:"Kornker",icon:"",top:"50%",left:"20%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"PLANT",label:"S Korn",cost:"-5 korn -25"}]},{id:"sheep_pasture",label:"Sauebeite",icon:"",top:"35%",left:"65%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"GATHER_WOOL",label:"Klipp Sauer",cost:"-15"}]},{id:"beehives",label:"Bikuber",icon:"",top:"75%",left:"70%",roles:["PEASANT","BARON","KING"],parentId:"fields",actions:[{id:"GATHER_HONEY",label:"Samle Honning",cost:"-20"}]},{id:"mine_shaft",label:"Jern-gruva",icon:"",top:"50%",left:"12%",roles:["PEASANT","BARON","KING"],parentId:"mine",actions:[{id:"MINE",label:"Bryte Malm",cost:"-25 -1"}]},{id:"quarry_poi",label:"Steinhuggeriet",icon:"",top:"40%",left:"85%",roles:["PEASANT","BARON","KING"],parentId:"mine",actions:[{id:"QUARRY",label:"Hugge Stein",cost:"-20 -1"}]},{id:"forest_clearing",label:"Hogstfeltet",icon:"",top:"60%",left:"30%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"CHOP",label:"Hugge Ved",cost:"-15 -1"}]},{id:"hunting_grounds",label:"Jaktmarker",icon:"",top:"30%",left:"75%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"HUNT",label:"Dra p Jakt",cost:"-30"}]},{id:"forest_forage",label:"Brplukking",icon:"",top:"60%",left:"90%",roles:["PEASANT","BARON","KING"],parentId:"forest",actions:[{id:"FORAGE",label:"Sanke Mat (Nd)",cost:"-40"}]},{id:"monastery_chapel",label:"Klosterkirken",icon:"",top:"50%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"monastery",actions:[{id:"PRAY",label:"Be en Bnn",cost:"-15"}]},{id:"farm_house",label:"Inne i Stugo",icon:"",top:"52%",left:"58%",roles:["PEASANT"],parentId:"peasant_farm",actions:[],isHub:!0,isInterior:!0},{id:"stugo_bed",label:"Senga",icon:"",top:"65%",left:"42%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"SLEEP",label:"Sove tungt",cost:"Full "}]},{id:"stugo_fireplace",label:"Peisen",icon:"",top:"55%",left:"80%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"EAT",label:"Sitte ved varmen",cost:"-1 +40"}]},{id:"farm_well",label:"Brnnen",icon:"",top:"60%",left:"27%",roles:["PEASANT"],parentId:"peasant_farm",actions:[{id:"REST",label:"Drikke vann",cost:"+5"}]},{id:"farm_upgrade_spot",label:"Tegneark",icon:"",top:"40%",left:"15%",roles:["PEASANT"],parentId:"farm_house",actions:[{id:"BUILDING_UPGRADE_farm_house",label:"Bygg ut grden",cost:"Varierer"}]},{id:"chicken_coop",label:"Hnsehus",icon:"",top:"40%",left:"75%",roles:["PEASANT"],parentId:"peasant_farm",actions:[{id:"OPEN_CHICKEN_COOP",label:"G inn til hnene",cost:"Gratis"}]},{id:"dock_view",label:"Horisonten",icon:"",top:"30%",left:"50%",roles:["PEASANT","BARON","KING","SOLDIER","MERCHANT"],parentId:"dock",actions:[{id:"START_SAILING",label:"Sette seil",cost:"Bt kreves"}]},{id:"shipyard",label:"Skipsverftet",icon:"",top:"60%",left:"25%",roles:["PEASANT","BARON","KING","MERCHANT"],parentId:"dock",actions:[{id:"OPEN_SHIPYARD",label:"pne Verftet",cost:"Bygg bt"}],isHub:!0,isInterior:!0},{id:"dock_administration",label:"Havnefuten",icon:"",top:"40%",left:"75%",roles:["BARON","KING","MERCHANT"],parentId:"dock",actions:[{id:"OPEN_WHARF_UPGRADE",label:"Oppgrader Kaien",cost:"Globalt prosjekt"}]}],fT=[{id:"pilegrim",name:"Sigurd Pilegrim",role:"Vandrer mot Nidaros",description:"Han sitter masserer sine sre ftter. En bredbremmet hatt med et kamskjell ligger p bordet, og vandringsstaven er slitt glatt av tusenvis av grep.",conversation:{start:{text:"Fred vre med deg, reisende. Kjenner du veien nordover? Mine ftter verker som om jeg har gtt p gldende kull, men sjelen... sjelen trekkes mot Hellig Olavs by.",options:[{label:"Hvorfor denne lange reisen?",nextId:"why"},{label:"Er det farlig langs veien?",nextId:"danger"},{label:"Fortell om kamskjellet.",nextId:"shell"},{label:"Lykke til videre. (G)",nextId:"EXIT"}]},why:{text:"For bot og bedring! Vi brer alle synder, min venn. Men i Nidaros, ved kongens skrin, er himmelen nrmere jorden. Det sies at en pilegrimsferd kan korte ned tiden i skjrsilden med mange r.",options:[{label:"Tror du virkelig p det?",nextId:"believe"},{label:"Hva hper du  finne?",nextId:"hope"}]},believe:{text:"Jeg *m* tro. Jeg har sett halte kaste krykkene og blinde f synet tilbake ved katedralen. Olavs kraft er sterk, selv om han har vrt dd i hundrevis av r. Han er Norges evige konge.",options:[{label:"Fortell om Olav.",nextId:"olav"}]},hope:{text:"Tilgivelse. Og kanskje litt sjelefred. Livet er hardt, vinteren er lang.  vite at man har gjort denne ofringen... det gir styrke.",options:[{label:"Forstelig.",nextId:"start"}]},danger:{text:" ja! Dovrefjell er ndelst. Snstormer kan komme midt p sommeren. Og i dalene lurer landeveisrvere som ser p oss pilegrimer som vandrende pengesekker. Men vi reiser ofte i flokk for beskyttelse.",options:[{label:"Har du blitt ranet?",nextId:"robbed"},{label:"Hvor sover dere?",nextId:"sjelehus"}]},robbed:{text:"Nesten. En gang, nr Gudbrandsdalen, s vi skygger i skogen. Vi sang salmer s hyt vi kunne, og drev dem bort med troens styrke! ...og kanskje fordi vi var frti stykker.",options:[{label:"God taktikk.",nextId:"danger"}]},sjelehus:{text:"Det finnes sjelehus  herberger bygget for Guds skyld  langs ruten. Der fr vi tak over hodet og enkel mat. Ofte deler vi rom med dyrene for varmen.",options:[{label:"Hres... koselig ut.",nextId:"danger"}]},shell:{text:"Ah, Ib-skjellet! Symbolet p St. Jakob. Dette viser at jeg har vandret helt til Santiago de Compostela i Spania. Jeg har sett verden, min venn. Fra nordlyset her til de solbrente slettene i sr.",options:[{label:"Du er en bereist mann.",nextId:"start"}]},olav:{text:"Han falt p Stiklestad i 1030. De sier at da de gravde ham opp et r senere, var kroppen like frisk, og hret og neglene hadde vokst! Det var beviset. Han kristnet oss med sverd, men reddet oss med sin hellighet.",options:[{label:"En mektig legende.",nextId:"start"}]}}},{id:"hansa",name:"Gerhard fra Lbeck",role:"Hansa-kjpmann",description:"Kledd i kostbar ull og pels. Han studerer en lang regnskapsrull med rynket panne og nipper til en vin som ser langt bedre ut enn husets vanlige.",conversation:{start:{text:"*Mumler p tysk* ...zwei schock, drei stck... Ah! En lokal? Si meg, har fiskerne i nord ftt opp farten? Mine skip venter i Bergen. Tid er penger, som vi sier i Lbeck.",options:[{label:"Hvem er du?",nextId:"intro"},{label:"Hvorfor er trrfisken s viktig?",nextId:"stockfish"},{label:"Hva er Hansaen egentlig?",nextId:"hansa_deep"},{label:"Jeg lar deg arbeide. (G)",nextId:"EXIT"}]},intro:{text:"Gerhard, handelsmann av Det Tyske Hanseforbund. Vi srger for at dere fr korn og mel, og at dere fr solgt den... vel, illeluktende fisken deres. En god byttehandel, *nicht wahr*?",options:[{label:"Vi klarer oss vel selv?",nextId:"monitor"},{label:"Takk for kornet.",nextId:"grain"}]},grain:{text:"Ja, det burde dere. Uten vrt baltiske korn ville mange nordmenn sultet nr avlingene svikter. Vi binder Nord-Europa sammen med vre kogger.",options:[{label:"Kogger?",nextId:"cog"}]},monitor:{text:"Haha! Tror du det? Uten oss ville fisken deres rtnet p stranden. Vi har nettverket. Vi har markedene i sr  katolikkene trenger fisk til fasten, og vi leverer.",options:[{label:"Dere tar stor fortjeneste.",nextId:"monopoly"}]},monopoly:{text:"Risiko koster! Stormer, pirater, kriger. Vi tar risikoen, vi tar profitten. Og vi har Kongens velsignelse... og privilegier. Vi dmmer vre egne p Bryggen.",options:[{label:"Egne lover?",nextId:"laws"}]},laws:{text:"Ja. En hanseat dmmes etter hansas lov, ikke norsk lov. Det... skaper litt friksjon med byborgerne, innrmmer jeg. Men handelen m flyte!",options:[{label:"Hres urettferdig ut.",nextId:"start"}]},stockfish:{text:'Det er "Det hvite gullet"! Trket i den kalde norske vinden blir den hard som tre og holder i revis. Perfekt mat for soldater og munker i hele Europa. Vi bytter det mot korn, klr, vin og krydder.',options:[{label:"En viktig ressurs.",nextId:"start"}]},hansa_deep:{text:"Et brorskap av handelsbyer. Lbeck, Hamburg, Rostock, Visby... og vrt kontor i Bergen. Vi beskytter hverandre mot konger som vil skattlegge oss for hardt, og mot sjrvere. Sammen er vi sterkere enn noe kongerike.",options:[{label:"Morsomt at du nevner pirater...",nextId:"pirates"},{label:"Imponerende.",nextId:"start"}]},pirates:{text:"Vitaliebrdrene... en plage! De herjer i stersjen. Men Hansaen har sine egne skip. Vi kan bite fra oss. Ikke tro at en kjpmann ikke kan svinge et sverd.",options:[{label:"Notert.",nextId:"EXIT"}]},cog:{text:"Vre skip. Brede, hye, med plass til enorme mengder last. De er ikke raske som vikingenes langskip, men de bygget vr rikdom. Ett skip kan f hele Bergen med korn.",options:[{label:"Teknologi er makt.",nextId:"start"}]}}},{id:"leilending",name:"Tormod",role:"Sliten Leilending",description:"Hendene hans er grove som bark, og ryggen er byd av r med plying. Han drikker tynt l og ser tankefullt ned i kruset.",conversation:{start:{text:"Enda en hst, enda en landskyld  betale. Livet til en leilending er  s for andre og hste smuler selv. Skl for det.",options:[{label:"Hva er landskyld?",nextId:"rent"},{label:"Hvorfor eier du ikke jorda?",nextId:"own"},{label:"Hvordan var det fr?",nextId:"plague"},{label:"Gr det s drlig? (G)",nextId:"EXIT"}]},rent:{text:"Leieavgiften. Jeg driver grden, men Kirken eier grunnen. Hvert r m jeg gi dem en fjerdedel av kornet, tre skippund smr og to kyr. Det som er igjen... det skal f familien min gjennom vinteren.",options:[{label:"Hva hvis avlingen svikter?",nextId:"fail"},{label:"Hvem bestemmer prisen?",nextId:"laws"}]},fail:{text:"Da sulter vi. Eller vi m lne skorn av jordeieren, og da havner vi dypere i gjeld. Det er en sirkel det er vanskelig  bryte.",options:[{label:"Trist skjebne.",nextId:"start"}]},own:{text:"F bnder eier sin egen jord n. Adelen og Kirken har kjpt opp nesten alt. Men jeg har i det minste *bygslebrev*. S lenge jeg betaler og driver jorda, kan de ikke kaste meg ut. Det er norsk lov.",options:[{label:"En viss trygghet.",nextId:"laws"}]},laws:{text:"Ja, Landsloven til Magnus Lagabte. Den gir oss rettigheter. Jordeieren kan ikke bare ta grden fordi han vil. Og jeg kan kreve at snnen min fr overta bygselen. Vi er ikke slaver, vi er frie menn... bare fattige.",options:[{label:"Viktig forskjell.",nextId:"start"}]},plague:{text:"*Han senker stemmen* Bestefar fortalte om Den Store Dden. Da to av tre dde. Etterp... etterp var det gode tider for de som overlevde. Masse ledig jord! Lav landskyld! N? N er vi mange igjen, og jordeierne strammer grepet.",options:[{label:"degrder?",nextId:"deserted"},{label:"Tidene skifter.",nextId:"start"}]},deserted:{text:"Ja, du kan fortsatt se ruinene i skogen. Grder der folk bodde fr, som n er grodd igjen. Noen sier det spker der, at de dde gr igjen og passer p arveslvet sitt.",options:[{label:"Grss.",nextId:"start"}]}}},{id:"steinhugger",name:"Master William",role:"Engelsk Steinhugger",description:"Han tegner geometriske figurer i slt l p bordet. Fingrene er hvite av steinstv.",conversation:{start:{text:"Ser du? Hvis du lfter buen *her*, og krysser hvelvet *slik*... da kan du bygge hyere enn fjellene! Ah, unnskyld. Jeg drmmer om stein.",options:[{label:"Bygger du katedralen?",nextId:"nidaros"},{label:"Du er ikke herfra?",nextId:"english"},{label:"Stein er bare stein. (G)",nextId:"EXIT"}]},nidaros:{text:"Kristkirken i Nidaros, ja! Verdens nordligste gotiske katedral. Vi hugger Kleberstein. Den er myk som smr nr den brytes, men blir hard som jern i luften. Et mirakulst materiale.",options:[{label:"Fortell om stilen.",nextId:"gothic"},{label:"Hvor lenge holder dere p?",nextId:"time"}]},gothic:{text:"Gotikk! Det er lysets arkitektur. I gamle dager bygget de tykke vegger og sm vinduer (romansk stil). N? Vi bruker strebepilarer p utsiden til  bre taket, s vi kan fylle veggene med glassmalerier. Guds lys strmmer inn!",options:[{label:"Hres vakkert ut.",nextId:"symbolism"}]},symbolism:{text:"Det er mer enn vakkert. Kirken er et bilde p himmelen. Hver syle, hver bue peker oppover. Nr bonden kommer inn fra gjrma, skal han fle at han trer inn i Guds rike.",options:[{label:"Mektig.",nextId:"start"}]},english:{text:"Nei, jeg kom fra Lincoln. Erkebiskopen hentet hndverkere fra England. Vi tar med oss kunnskapen om de nye stilene. Det er et internasjonalt laug, steinhuggerne. Vi reiser dit Gud og gullet kaller oss.",options:[{label:"Et reisende liv.",nextId:"start"}]},time:{text:'Haha! "Hvor lenge?" Min oldefar begynte. Jeg fortsetter. Mine barnebarn vil kanskje se spiret reise seg. En katedral bygges ikke for oss, men for evigheten.',options:[{label:"En tlmodighetsprve.",nextId:"EXIT"}]}}},{id:"vaering",name:"Halvdan",role:"Veteran fra Vringgarden",description:"Han brer en kappe av falmet, men kostbar silke. Et stygt arr deler venstre yenbryn i to. Han drikker ikke l, men vin fra en liten flaske.",conversation:{start:{text:"Dette stedet... det er kaldt, mrkt og lukter av vt hund. I Miklagard skinte solen p gulltakene hver dag, og keiserens hager duftet av sjasmin.",options:[{label:"Hvor er Miklagard?",nextId:"miklagard"},{label:"Var du en kriger?",nextId:"guard"},{label:"Hjemme best. (G)",nextId:"EXIT"}]},miklagard:{text:'"Den Store Byen". Konstantinopel! Verdens sentrum. Der mtes st og vest. Gatene er brolagt med marmor, og de har badehus med varmt vann i veggene! Kan du tenke deg? Varmt vann uten  koke det over bl!',options:[{label:"Utrolig.",nextId:"hagia"},{label:"Savner du det?",nextId:"miss"}]},hagia:{text:"Og Hagia Sofia... Guds Helligdoms Kirke. Kuppelen er s stor at den ser ut som om den henger i en gullkjede fra himmelen. Jeg har sett menn grte bare av  g inn der.",options:[{label:"M vre et syn.",nextId:"start"}]},guard:{text:'Vringgarden. Keiserens livvakt. Vi nordboere er hye, sterke og... vel, vi sviker ikke for penger. Grekerne er slueste folk, men de stoler bare p vre kser. "Pelekysphoroi" kaller de oss. ksebrere.',options:[{label:"Mtte dere slss?",nextId:"fight"},{label:"Ble du rik?",nextId:"rich"}]},fight:{text:"Mot sarasenere, mot bulgarere, mot opprrske generaler. Jeg har sett gresk ild  flytende flammer som brenner p vann! Det er djevelens verk, men effektivt.",options:[{label:"Gresk ild?",nextId:"start"}]},rich:{text:'Keiseren er sjeners. Nr han dr, har vi rett til  g gjennom skattkammeret og ta det vi kan bre. "Polutasvarf", kaller vi det. Palass-plyndring. Det er slik jeg fikk denne kappen... og denne ringen.',options:[{label:"En god pensjon.",nextId:"start"}]},miss:{text:"Hver vinter. Men her er min slekt, min jord. Og her snakker folk et sprk man kan forst. Men jeg vil alltid drmme om det Gyldne Horn.",options:[{label:"Skl for minnene.",nextId:"EXIT"}]}}},{id:"munk",name:"Broder Johannes",role:"Lrd Skrivermunk",description:"Fingrene hans er flekkete av blekk. Han myser, som om han er vant til  lese i drlig lys, og snakker lavmelt.",conversation:{start:{text:"Hysj. Hrer du stillheten? Nei, selvsagt ikke. Her er det sty. I skriptoriet hrer man bare fjrpennens skraping mot pergamentet. Guds ord som festes til huden.",options:[{label:"Hva skriver du?",nextId:"write"},{label:"Er du ikke ensom?",nextId:"lonely"},{label:"Jeg lar deg vre i fred. (G)",nextId:"EXIT"}]},write:{text:'Akkurat n? En kopi av "Kongespeilet"  *Konungs skuggsj*. En lrebok for prinser. Den forteller om hflighet, handel, stjernene og Guds orden. En klok konge m vre lrd, ikke bare sterk.',options:[{label:"Er bker dyre?",nextId:"expensive"},{label:"Hvem leser disse?",nextId:"readers"}]},expensive:{text:"Ufattelig. Et stort bibelverk krever skinnet fra 300 kalver! Tenk p flokken... og arbeidet.  forberede skinnet, blande blekket, male initialene med bladgull. En bok kan koste mer enn en grd.",options:[{label:"En skatt alts.",nextId:"start"}]},readers:{text:"De geistlige, kongen, og noen f adelige. Men kunnskapen risler nedover. Det vi bevarer i bibliotekene, er verdens hukommelse. Uten oss ville historien forsvinne i mrket.",options:[{label:"Et viktig ansvar.",nextId:"start"}]},lonely:{text:"Aldri. Jeg er omgitt av apostler, helgener og kirkefedrene. Augustin, Thomas Aquinas... de taler til meg gjennom sidene. Og brdrene i klosteret er min familie. Vi ber sammen, arbeider sammen.",options:[{label:"Ora et labora?",nextId:"rule"},{label:"Hres fredelig ut.",nextId:"start"}]},rule:{text:"Be og arbeid. Ja. Det er St. Benedikts regel. Lediggang er fienden av sjelen. S vi dyrker urter, brygger l (som dette, Guds gave!), og kopierer bker.",options:[{label:"Skl for let.",nextId:"EXIT"}]}}},{id:"pestlege",name:"Doktor Pestus",role:"Pestlege",description:"Han sitter litt for seg selv. En merkelig maske med nebb henger rundt halsen hans, og han lukter sterkt av eddik og trkede blomster.",conversation:{start:{text:"Ikke kom for nr! Balansen i vskene dine ser... urolig ut. Er du sangvinsk? Eller melankolsk? Luften her er tykk av miasma.",options:[{label:"Miasma?",nextId:"miasma"},{label:"Hva er masken til?",nextId:"mask"},{label:"Jeg er frisk! (G)",nextId:"EXIT"}]},miasma:{text:"Drlig luft! Sykdom kommer av rtten luft som stiger opp fra jorden eller fra syke kropper. Den forstyrrer balansen i kroppen  blod, slim, gul og svart galle. Pesten... den er den verste ubalansen.",options:[{label:"Svartedauden?",nextId:"plague"},{label:"Hvordan kurerer man det?",nextId:"cure"}]},plague:{text:"Den store dden. Den kom med et skip til Bergen i 1349. Jeg s hele landsbyer tmmes. Prester dde mens de ga den siste olje. Det var som om Gud hadde forlatt oss. De som overlevde... vi er merket.",options:[{label:"Forferdelig.",nextId:"social"}]},social:{text:"Men se rundt deg! De frre vi er, jo mer verdt er hver mann. Bndene krever bedre lnn n. Tjenestepikene gr med silke. Verden er snudd p hodet etter pesten.",options:[{label:"En ny tid.",nextId:"start"}]},mask:{text:"Nebbet fylles med urter. Nellik, roser, mynte. Sterk lukt motvirker den drlige luften. Det er som et filter mot dden selv. Og kappen er innsatt med voks s pestloppene glir av.",options:[{label:"Smart oppfinnelse.",nextId:"cure"}]},cure:{text:'relating for  fjerne ondt blod. Kopping. Og Theriak  en blanding av over 60 ingredienser, inkludert ormekjtt og opium. Det beste rdet? "Cito, longe, tarde." Dra fort, dra langt, kom sent tilbake.',options:[{label:"Skal huske det.",nextId:"EXIT"}]}}},{id:"birkebeiner",name:"Gunnar",role:"Birkebeiner-opprrer",description:"En hardfr mann med slitte klr, men sverdet ved beltet er velstelt. Han ser mistenksomt mot dren hver gang den pnes.",conversation:{start:{text:"Hvem holder du med? Kongen eller Kirken? Baglerne eller Birkebeinerne? Svar fort, fr let blir varmt.",options:[{label:"Birkebeinerne!",nextId:"birkebeiner"},{label:"Jeg blander meg ikke.",nextId:"neutral"},{label:"Baglerne?",nextId:"bagler"},{label:"Ingen. (G)",nextId:"EXIT"}]},birkebeiner:{text:"Godt svar! Vi er kong Sverres menn. Mange av oss startet med ingenting, med never rundt leggene i snen. Men vi kjemper for norges rettmessige konge mot biskopenes tyranni!",options:[{label:"Hvorfor hater dere biskopene?",nextId:"church"},{label:"Fortell om Kong Sverre.",nextId:"sverre"}]},bagler:{text:"*Han spytter p gulvet* Kirkens lpegutter. De vil at paven i Roma skal styre Norge, ikke kongen. Pass deg, ellers tror jeg du er en spion.",options:[{label:"Jeg mente det ikke snn.",nextId:"start"}]},neutral:{text:"Ingen kan vre nytrale i borgerkrig. Nr bror dreper bror, m man velge side. Men kanskje det er klokest  holde kjeft, ja.",options:[{label:"Nettopp.",nextId:"start"}]},church:{text:'Erkebiskopen vil ha makt. Han nekter  krone Sverre! Han lyste ham i bann! Men Sverre talte Roma midt imot. "En tale mot biskopene", kalte han det. Han sa at kirken er rtten, og at kongen er innsatt av Gud, ikke av Paven.',options:[{label:"Sterke ord.",nextId:"start"}]},sverre:{text:"En prest fra Fryene som ble konge! Han er liten av vekst, men en kjempe i klkt. Han lrte oss  slss p en ny mte. Ikke bare storme frem, men bruke terrenget, sl til og forsvinne. Gerilja, kaller de det visst i sr.",options:[{label:"En taktiker.",nextId:"EXIT"}]}}},{id:"kone",name:"Ragnhild",role:"Klok Kone",description:"En eldre kvinne med grtt hr flettet med fargerike bnd. Hun har en kurv full av trkede planter og rtter p bordet.",conversation:{start:{text:"Har du en plage, ungen min? En verkebyll? Kjrlighetssorg? Eller kanskje kua di har sluttet  melke? Naturen har en bot for alt, hvis man vet hvor man skal lete.",options:[{label:"Er du en heks?",nextId:"witch"},{label:"Har du noe mot sr?",nextId:"herbs"},{label:"Jeg tror p bnner. (G)",nextId:"EXIT"}]},witch:{text:"Hysj! Ikke bruk det ordet. Prestene brenner folk for mindre. Jeg er en hjelper. Jeg bruker bare Guds skaperverk. Er det trolldom  vite at groblad stanser bldning? Nei, det er kunnskap.",options:[{label:"Unnskyld.",nextId:"signs"},{label:"Hva med magi?",nextId:"magic"}]},herbs:{text:"Groblad for sr. Ryllik for feber. Og johannesurt for de tunge tankene som kommer om vinteren. Og honning... honning er bra for alt. Det holder betennelsen borte.",options:[{label:"Nyttig  vite.",nextId:"start"}]},signs:{text:"Man m lese tegnene. Hvis rogna brer mye br, blir vinteren sntung. Hvis krka skriker mot nord, kommer det gjester. Det er ikke magi, det er  lytte til verden.",options:[{label:"Klokt.",nextId:"start"}]},magic:{text:"*Hun lener seg frem* Det finnes krefter... de underjordiske. Nissen p lven, Huldra i skogen. Man m vise dem respekt. Ofre litt grt, litt l. Kirken liker det ikke, men bonden vet at det er best  holde seg inne med dem.",options:[{label:"Best  vre forsiktig.",nextId:"EXIT"}]}}},{id:"skald",name:"Einar Skald",role:"Hoff-poet",description:"Han sitter med lukkede yne og trommer rytmisk p bordet. Plutselig slr han ut med hnden og deklamerer en strofe.",conversation:{start:{text:'"Sverdets sang, blodets brang, ravnens fang..." Nei, nei. Det mangler bokstavrim. En god drpa skal vre som et vevd teppe, hver ord skal lse det neste.',options:[{label:"Hva er en drpa?",nextId:"drapa"},{label:"Fortell en saga!",nextId:"saga"},{label:"Du virker intens. (G)",nextId:"EXIT"}]},drapa:{text:'Det ypperste av kvad! Et hyllingsdikt til en fyrste eller konge. Det m ha "stef"  et omkved som gjentas. Hvis jeg gjr en feil i versefoten foran Jarlen, kan jeg miste hodet. Eller verre, miste min re.',options:[{label:"Hres vanskelig ut.",nextId:"oral"},{label:"Hva er versefot?",nextId:"poetry"}]},saga:{text:'Ah, historiene. Ikke bare dikt, men sannheten om vre forfedre. Som historien om Egil Skallagrimsson... kriger og poet. Han reddet sitt eget liv ved  dikte "Hodelsningen" til Eirik Blodks. Ord er makt, min venn.',options:[{label:"Fortell om Egil.",nextId:"egil"}]},egil:{text:"Han var stygg som juling, men sterk som en bjrn. Og han kunne drepe med et sverd i n hnd og dikte med den andre. En gang spydde han over en hirdmann som prvde  fornrme ham! En ekte helt.",options:[{label:"Fargerik type.",nextId:"start"}]},oral:{text:"Vi brer historien i hodet. Bker kan brenne, men et godt kvede lever p folkemunne i tusen r. Det er min oppgave.  srge for at kongens bedrifter aldri glemmes. Jeg er levende historie.",options:[{label:"Imponerende hukommelse.",nextId:"start"}]},poetry:{text:'Det er regler! Fornyrdislag, Ljogahtt... du m bruke "Kenninger". Du sier ikke "sverd", du sier "sr-isl". Du sier ikke "blod", du sier "sverd-vann". Det gjr sprket rikt og gtefullt.',options:[{label:"Vakkert sprk.",nextId:"EXIT"}]}}}];function RZ(t,e,s){const{setActiveTab:n,setProductionContext:i,viewMode:r,setViewMode:a,viewingRegionId:l,setViewingRegionId:c,setActiveMinigame:u,activeTab:d}=yo(),h=l||t.regionId||"capital",[f,m]=N.useState(null),[b,x]=N.useState(null),[v,g]=N.useState(null),[p,y]=N.useState(null),[k,w]=N.useState("start"),[S,_]=N.useState(!1),[T,E]=N.useState(!1),[A,j]=N.useState(!1),[O,H]=N.useState(!1),[G,L]=N.useState(!1),[M,D]=N.useState(!1),[I,F]=N.useState(!1),[U,R]=N.useState(!1),[C,$]=N.useState(!1),V=N.useCallback(fe=>{if(fe==="kingdom")return 0;if(fe==="global")return 1;const ce=Br.find(ne=>ne.id===fe);return ce!=null&&ce.parentId?3:2},[]),[P,W]=N.useState(r),[J,Y]=N.useState("in");if(r!==P){const fe=V(P),ce=V(r);ce>fe?Y("in"):ce<fe&&Y("out"),W(r)}N.useEffect(()=>{const fe=ce=>{if(ce.key==="Escape"){if(d!=="MAP")return;if(v){g(null);return}if(S){_(!1);return}if(T){E(!1);return}if(O){H(!1);return}if(G){L(!1);return}if(M){D(!1);return}if(I){F(!1);return}if(C){$(!1);return}if(p){y(null);return}if(b){x(null);return}if(f){m(null);return}if(r!=="kingdom"){const ne=Br.find(lt=>lt.id===r),Le=ne!=null&&ne.parentId?Br.find(lt=>lt.id===ne.parentId):null;a(r==="global"?"kingdom":Le?Le.id:"global")}}};return window.addEventListener("keydown",fe),()=>window.removeEventListener("keydown",fe)},[r,v,S,T,O,p,b,f,a,d]);const he=N.useCallback((fe,ce)=>{var ke,we;const ne=typeof ce=="string"?ce:ce.type||ce.id,Le=Q=>Q==="windmill_stones"?{buildingId:"windmill",type:"REFINE"}:Q==="sawmill_blade"?{buildingId:"sawmill",type:"REFINE"}:Q==="smeltery_furnace"?{buildingId:"smeltery",type:"REFINE"}:Q==="bakery_oven"?{buildingId:"bakery",type:"REFINE"}:Q==="weavery_loom"?{buildingId:"weavery",type:"REFINE"}:Q==="forge_anvil"?{buildingId:"great_forge",type:"CRAFT"}:Q==="apothecary_bench"?{buildingId:"apothecary",type:"CRAFT"}:null;if(ne==="OPEN_CHICKEN_COOP"){E(!0),m(null);return}if(ne==="OPEN_GARRISON"){i({buildingId:"watchtower",type:"CRAFT",initialView:"PRODUCE"}),n("PRODUCTION"),m(null);return}if(ne==="OPEN_CONSTRUCTION"){j(!0),m(null);return}if(ne==="OPEN_WAR_ROOM"){n("WAR_ROOM"),m(null);return}if(ne==="OPEN_TAXATION"){H(!0),m(null);return}if(ne==="OPEN_SHIPYARD"){F(!0),m(null);return}if(ne==="START_SAILING"){u("SAILING"),m(null);return}if(ne==="OPEN_WHARF_UPGRADE"){R(!0),m(null);return}const lt=Le(fe);if(lt&&(ne==="OPEN_CRAFTING"||ne==="CRAFT"||ne==="REFINE"||ne.startsWith("REFINE_")||ne.startsWith("CRAFT_")||Sn[ne]||ne==="REPAIR")){i({...lt,initialView:ne==="REPAIR"?"REPAIR":"PRODUCE"}),n("PRODUCTION"),m(null);return}const se=h===t.regionId,le=t.role==="KING";if(!se&&!le&&ne!=="MARKET_VIEW"){alert("Du har ingen myndighet i dette baroniet.");return}if(ne==="MARKET_VIEW")s();else if(ne.startsWith("REFINE_")){const Q=ne.replace("REFINE_","").split("_")[0].toLowerCase();e({type:"REFINE",recipeId:{plank:"plank",flour:"flour",iron:"iron_ingot",steel:"iron_ingot",cloth:"cloth"}[Q]||Q})}else if(ne.startsWith("CRAFT_")){const Q=ne.replace("CRAFT_","").toLowerCase();e(Q==="bread"||Q==="pie"||Q==="mead"?{type:"REFINE",recipeId:Q}:{type:"CRAFT",subType:Q})}else if(ne in Sn)e({type:"CRAFT",subType:ne});else if(ne.startsWith("BUILDING_UPGRADE_")){const Q=ne.replace("BUILDING_UPGRADE_","");g(Q)}else if(ne==="OPEN_RESOURCE_GAME")L(!0);else if(ne==="HARVEST"||ne==="PLANT"){const Q=Br.find(ae=>ae.id===fe),Z=((ke=Q==null?void 0:Q.label)==null?void 0:ke.toLowerCase().includes("lin"))||fe==="flax_field",B=(we=Q==null?void 0:Q.actions)==null?void 0:we.find(ae=>ae.id===ne);Z&&ne==="HARVEST"?$(!0):!Z&&ne==="HARVEST"?D(!0):e({type:ne,...B,locationId:fe})}else if(ne==="CHAT_LOCAL"){const Q=fT[Math.floor(Math.random()*fT.length)];y(Q),w("start")}else e(ne==="BUY_MEAL"?{type:"BUY_MEAL"}:ne);m(null)},[h,t,e,s,n,i,m]);return{viewMode:r,setViewMode:a,viewingRegionId:h,setViewingRegionId:c,selectedPOI:f,setSelectedPOI:m,selectedEvent:b,setSelectedEvent:x,upgradingBuildingId:v,setUpgradingBuildingId:g,dialogNPC:p,setDialogNPC:y,dialogStep:k,setDialogStep:w,isDiceGameOpen:S,setIsDiceGameOpen:_,isChickenCoopOpen:T,setIsChickenCoopOpen:E,isConstructionOpen:A,setIsConstructionOpen:j,isTaxationOpen:O,setIsTaxationOpen:H,isGambleGameOpen:G,setIsGambleGameOpen:L,isGrainGameOpen:M,setIsGrainGameOpen:D,isShipyardOpen:I,setIsShipyardOpen:F,isWharfUpgradeOpen:U,setIsWharfUpgradeOpen:R,isFlaxGameOpen:C,setIsFlaxGameOpen:$,direction:J,handlePOIAction:he}}const IZ=({playerGold:t,onClose:e,onPlay:s})=>{const[n,i]=N.useState(1),[r,a]=N.useState(!1),[l,c]=N.useState([1,1]),[u,d]=N.useState([1,1]),[h,f]=N.useState("Plasser din innsats..."),[m,b]=N.useState(t);Se.useEffect(()=>{b(t)},[t]);const x=()=>Math.floor(Math.random()*6)+1,v=()=>{if(r)return;if(n>t){f("Du har ikke nok gull!");return}if(n<.5){f("Minstesats er 0.5g");return}a(!0),f("Terningene ruller...");let y=0;const k=10,w=setInterval(()=>{c([x(),x()]),d([x(),x()]),y++,y>=k&&(clearInterval(w),g())},100)},g=()=>{const y=x(),k=x(),w=x(),S=x(),_=y+k,T=w+S;c([y,k]),d([w,S]);const E=_>T;E?(f(`DU VANT! ${_} mot ${T}`),b(A=>A+n)):(f(`HUSET VANT. ${T} mot ${_}`),b(A=>Math.max(0,A-n))),s({amount:n,isWin:E,playerRoll:_,houseRoll:T}),a(!1)},p=(y,k)=>o.jsx("div",{className:`w-16 h-16 rounded-xl shadow-[inset_0_0_10px_rgba(0,0,0,0.5)] flex bg-gradient-to-br ${k==="player"?"from-white to-slate-200 text-black":"from-red-600 to-red-800 text-white"} relative transition-transform duration-100 ${r?"animate-bounce":""}`,children:o.jsx("div",{className:"grid grid-cols-3 grid-rows-3 w-full h-full p-2 gap-1",children:[...Array(9)].map((w,S)=>{let _=!1;return y===1&&S===4&&(_=!0),y===2&&(S===0||S===8)&&(_=!0),y===3&&(S===0||S===4||S===8)&&(_=!0),y===4&&(S===0||S===2||S===6||S===8)&&(_=!0),y===5&&(S===0||S===2||S===4||S===6||S===8)&&(_=!0),y===6&&(S===0||S===2||S===3||S===5||S===6||S===8)&&(_=!0),o.jsx("div",{className:"flex items-center justify-center",children:_&&o.jsx("div",{className:`w-3 h-3 rounded-full ${k==="player"?"bg-black":"bg-white"} shadow-sm`})},S)})})});return o.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm animate-in fade-in duration-500",children:[o.jsxs("div",{className:"absolute inset-0 z-0 opacity-50",children:[o.jsx("img",{src:"/Simulation_StandAlone_Pro/poi/tavern_dice_bg.png",alt:"Tavern Table",className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-transparent to-black"})]}),o.jsxs("div",{className:"relative z-10 bg-[#1a472a]/90 border-[4px] border-[#5d4037] rounded-[2rem] shadow-[0_50px_100px_rgba(0,0,0,0.8)] w-full max-w-2xl overflow-hidden backdrop-blur-md",children:[o.jsx("div",{className:"absolute inset-0 border-2 border-[#8d6e63] rounded-[1.2rem] pointer-events-none opacity-50"}),o.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-[#d7ccc8] hover:text-white transition-colors bg-black/20 hover:bg-black/40 rounded-full w-8 h-8 flex items-center justify-center font-bold z-50",children:""}),o.jsxs("div",{className:"p-8 flex flex-col items-center gap-8 relative",children:[o.jsxs("div",{className:"text-center space-y-1",children:[o.jsx("h2",{className:"text-3xl font-black text-[#ffecb3] uppercase tracking-widest drop-shadow-md",style:{fontFamily:"serif"},children:"Spillebordet"}),o.jsx("div",{className:"text-[#a5d6a7] font-bold tracking-wider text-sm",children:"Huset vinner ved uavgjort"}),o.jsx("div",{className:"text-xs text-white/50 uppercase tracking-widest font-black",children:"Lykke til!"})]}),o.jsxs("div",{className:"flex justify-between w-full px-8 gap-8",children:[o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsxs("span",{className:"text-[#90caf9] font-black uppercase tracking-widest text-xs",children:["Deg (",l[0]+l[1],")"]}),o.jsxs("div",{className:"flex gap-3",children:[p(l[0],"player"),p(l[1],"player")]})]}),o.jsx("div",{className:"flex items-center justify-center",children:o.jsx("span",{className:"text-2xl font-black text-white/20",children:"VS"})}),o.jsxs("div",{className:"flex flex-col items-center gap-4",children:[o.jsxs("span",{className:"text-[#ef9a9a] font-black uppercase tracking-widest text-xs",children:["Huset (",u[0]+u[1],")"]}),o.jsxs("div",{className:"flex gap-3",children:[p(u[0],"house"),p(u[1],"house")]})]})]}),o.jsx("div",{className:`h-12 flex items-center justify-center w-full bg-black/30 rounded-xl border border-white/5 transition-all ${h.includes("VANT")?"bg-green-900/40 border-green-500/30":h.includes("tapte")?"bg-red-900/40 border-red-500/30":""}`,children:o.jsx("span",{className:"font-bold text-lg text-[#fff8e1] tracking-wide",children:h})}),o.jsxs("div",{className:"w-full bg-black/20 p-6 rounded-2xl border border-white/5 flex flex-col gap-4",children:[o.jsxs("div",{className:"flex justify-between items-center text-[#d7ccc8] font-bold text-sm uppercase tracking-widest",children:[o.jsx("span",{children:"Innsats"}),o.jsxs("span",{children:["Din Saldo: ",o.jsxs("span",{className:"text-[#ffd54f]",children:[m.toFixed(1),"g"]})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("input",{type:"range",min:.5,max:Math.min(t,100),step:.5,value:n,onChange:y=>i(parseFloat(y.target.value)),className:"w-full h-3 bg-black/50 rounded-lg appearance-none cursor-pointer accent-[#ffb74d]",disabled:r}),o.jsxs("div",{className:"bg-black/40 px-4 py-2 rounded-xl text-[#ffd54f] font-black min-w-[5rem] text-center border border-white/10",children:[n,"g"]})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:[1,5,10,50].map(y=>o.jsxs("button",{onClick:()=>i(y),disabled:y>t||r,className:`py-1 rounded-lg text-xs font-bold uppercase tracking-widest transition-colors ${n===y?"bg-[#ffb74d] text-black":"bg-white/5 text-[#d7ccc8] hover:bg-white/10"}`,children:[y,"g"]},y))}),o.jsx("button",{onClick:v,disabled:r||t<n,className:`w-full py-4 rounded-xl font-black uppercase tracking-widest text-lg shadow-lg transform transition-all active:scale-[0.98] ${r?"bg-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-[#ffca28] to-[#ff6f00] text-black hover:brightness-110 shadow-orange-900/40"}`,children:r?"Ruller...":"KAST TERNINGENE!"})]})]})]})]})},Fh=[{id:"gold",label:"GULL",icon:"",color:"from-yellow-400 to-amber-600",accent:"amber"},{id:"grain",label:"KORN",icon:"",color:"from-amber-400 to-amber-600",accent:"amber"},{id:"wood",label:"TREVIRKE",icon:"",color:"from-orange-500 to-amber-800",accent:"orange"},{id:"stone",label:"STEIN",icon:"",color:"from-slate-500 to-slate-700",accent:"slate"},{id:"iron",label:"JERN",icon:"",color:"from-blue-500 to-indigo-900",accent:"indigo"}],Ti=[{value:0,weight:50,label:"Tap",color:"#0f172a",multiplierText:"0x",angle:180},{value:1.5,weight:30,label:"Gevinst",color:"#10b981",multiplierText:"1.5x",angle:90},{value:2.5,weight:15,label:"Stor Gevinst",color:"#3b82f6",multiplierText:"2.5x",angle:60},{value:5,weight:5,label:"JACKPOT!",color:"#f59e0b",multiplierText:"5x",angle:30}],OZ=({player:t,onClose:e,onPlay:s})=>{const[n,i]=N.useState("gold"),[r,a]=N.useState(100),[l,c]=N.useState(!1),[u,d]=N.useState(0),[h,f]=N.useState(null),[m,b]=N.useState([]),x=N.useRef(!1),v=t.resources||{},g=v[n]||0;N.useEffect(()=>{r>g&&a(Math.max(1,Math.floor(g)))},[n,g]);const p=()=>{if(x.current||l||r<=0||r>g)return;x.current=!0,c(!0),f(null);const w=Ti.reduce((C,$)=>C+$.weight,0),S=Math.random()*w;let _=0,T=0;for(let C=0;C<Ti.length;C++)if(T+=Ti[C].weight,S<T){_=C;break}const E=Ti[_],A=8+Math.floor(Math.random()*4);let j=0;for(let C=0;C<_;C++)j+=Ti[C].angle;const O=Ti[_],H=j+O.angle/2,G=O.angle/2*.6,L=(Math.random()-.5)*G,D=(360-(H+L+360)%360)%360,I=u,F=I%360,U=(D-F+360)%360,R=I+A*360+U;d(R),setTimeout(()=>{const C=E.value>0,$={multiplier:E.value,isWin:C,label:E.label};f($),c(!1),x.current=!1;const V={resource:n,amount:r,multiplier:E.value,isWin:C,timestamp:Date.now()};b(P=>[V,...P].slice(0,4)),s({resource:n,amount:r,multiplier:E.value,isWin:C})},3100)},y=Fh.find(w=>w.id===n)||Fh[0],k=N.useMemo(()=>{let w=0;return Ti.map(S=>{const _=w;return w+=S.angle,`${S.color} ${_}deg ${w}deg`}).join(", ")},[]);return o.jsxs("div",{className:"absolute inset-0 z-[100] flex items-center justify-center p-4",children:[o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l?void 0:e,className:"absolute inset-0 bg-slate-950/85 backdrop-blur-xl cursor-pointer"}),o.jsxs(ee.div,{initial:{scale:.95,opacity:0,y:30},animate:{scale:1,opacity:1,y:0},exit:{scale:.95,opacity:0,y:30},className:"relative w-full max-w-5xl bg-slate-900 border border-white/5 rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col lg:flex-row h-[650px]",children:[o.jsx("button",{onClick:e,disabled:l,className:"absolute top-6 right-6 z-50 p-2 bg-white/5 hover:bg-white/10 rounded-full text-white/30 hover:text-white transition-all",children:o.jsx(Yn,{size:24})}),o.jsxs("div",{className:"flex-1 p-6 flex flex-col gap-4 z-10 overflow-hidden",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsxs("div",{className:"px-3 py-0.5 rounded-full bg-amber-500/10 border border-amber-500/20 text-amber-500 text-[9px] font-black uppercase tracking-[0.2em] flex items-center gap-2",children:[o.jsx(sa,{size:10}),o.jsx("span",{children:"Soga-hjulet"})]})}),o.jsx("h2",{className:"text-3xl font-black text-white italic tracking-tighter leading-none",children:"Sats Dine Ressurser"}),o.jsx("div",{className:"grid grid-cols-5 gap-2",children:Fh.map(w=>{const S=n===w.id,_=v[w.id]||0;return o.jsxs("button",{onClick:()=>!l&&i(w.id),className:`relative p-3 rounded-2xl border-2 transition-all duration-300 flex flex-col items-center gap-1.5
                                        ${S?`bg-white/5 border-${w.accent}-500 shadow-lg scale-105`:"bg-black/20 border-white/5 hover:border-white/10 opacity-70"}`,children:[o.jsx("div",{className:"text-2xl",children:w.icon}),o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("div",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:w.label}),o.jsx("div",{className:`text-lg font-black font-mono ${S?"text-white":"text-slate-300"}`,children:_%1!==0?_.toFixed(1):_.toLocaleString()})]})]},w.id)})}),o.jsxs("div",{className:"bg-black/40 border border-white/5 rounded-[2rem] p-6 space-y-4",children:[o.jsxs("div",{className:"flex justify-between items-end",children:[o.jsxs("div",{className:"space-y-0.5",children:[o.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-slate-500",children:"Innsats Belp"}),o.jsxs("div",{className:"flex items-baseline gap-2",children:[o.jsx("span",{className:"text-5xl font-black text-white font-mono",children:r.toLocaleString()}),o.jsx("span",{className:"text-sm font-black text-indigo-400 uppercase tracking-widest",children:y.label})]})]}),o.jsx("div",{className:"flex gap-2",children:[25,50,100].map(w=>o.jsx("button",{onClick:()=>a(Math.max(1,Math.floor(g*(w/100)))),className:"px-3 py-1.5 rounded-xl bg-white/5 hover:bg-white/10 text-[10px] font-black uppercase tracking-widest text-slate-300 border border-white/5",children:w===100?"MAX":`${w}%`},w))})]}),o.jsxs("div",{className:"relative h-8 flex items-center",children:[o.jsx("input",{type:"range",min:1,max:Math.max(1,Math.floor(g)),step:1,value:r,onChange:w=>a(parseInt(w.target.value)),disabled:l,className:"w-full h-1.5 bg-white/5 rounded-full appearance-none cursor-pointer accent-amber-500 z-10"}),o.jsx("div",{className:"absolute left-0 h-1.5 bg-gradient-to-r from-amber-600 to-amber-400 rounded-full pointer-events-none",style:{width:`${r/Math.max(1,Math.floor(g))*100}%`}})]}),o.jsx("button",{onClick:p,disabled:l||g<r||r<=0,className:`w-full relative h-14 rounded-xl font-black uppercase tracking-[0.3em] text-base shadow-2xl transition-all duration-300 ${l?"bg-slate-800":"bg-amber-500 hover:brightness-110 active:scale-95 text-slate-950"}`,children:l?"Spinner...":"SPINN HJULET!"})]}),o.jsxs("div",{className:"mt-auto border-t border-white/5 pt-3",children:[o.jsxs("div",{className:"flex items-center gap-2 text-[9px] font-black uppercase tracking-[0.3em] text-slate-600 mb-2",children:[o.jsx(Hm,{size:10}),o.jsx("span",{children:"Siste Resultater"})]}),o.jsx("div",{className:"grid grid-cols-4 gap-2",children:m.map((w,S)=>{const _=Fh.find(T=>T.id===w.resource);return o.jsxs("div",{className:"flex flex-col p-2 rounded-xl bg-black/40 border border-white/5 items-center",children:[o.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[o.jsx("span",{className:"text-xs",children:_==null?void 0:_.icon}),o.jsx("span",{className:"text-[10px] font-mono font-bold text-slate-400",children:w.amount.toLocaleString()})]}),o.jsx("div",{className:`text-xs font-black font-mono ${w.isWin?"text-emerald-500":"text-rose-900/40"}`,children:w.isWin?`x${w.multiplier}`:"TAP"})]},S)})})]})]}),o.jsxs("div",{className:"w-full lg:w-[480px] bg-black/50 border-l border-white/5 flex flex-col items-center justify-center p-12 relative",children:[o.jsxs("div",{className:"relative w-80 h-80 mb-10",children:[o.jsx("div",{className:`absolute -inset-12 rounded-full blur-[100px] opacity-20 transition-colors duration-1000 bg-${y.accent}-500`}),o.jsxs(ee.div,{animate:{rotate:u},transition:{duration:3,ease:[.32,.72,0,1]},className:"w-full h-full rounded-full border-[18px] border-slate-900 shadow-2xl relative overflow-hidden bg-slate-950",children:[o.jsx("div",{className:"absolute inset-0 transition-opacity duration-300",style:{background:`conic-gradient(${k})`,opacity:l?.4:.8}}),Ti.map((w,S)=>{let _=0;for(let E=0;E<S;E++)_+=Ti[E].angle;const T=_+w.angle/2;return o.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",style:{transform:`rotate(${T}deg)`},children:o.jsx("div",{className:"absolute top-[16%] text-white font-black text-2xl drop-shadow-[0_2px_4px_rgba(0,0,0,1)] font-mono",children:w.multiplierText})},S)}),o.jsx("div",{className:"absolute inset-[80px] rounded-full border-2 border-white/5 bg-slate-950/80 backdrop-blur-md shadow-inner"})]}),o.jsx("div",{className:"absolute -top-12 left-1/2 -translate-x-1/2 z-50",children:o.jsx(ee.div,{animate:l?{y:[0,-5,0]}:{},transition:{duration:.1,repeat:1/0},className:"w-10 h-16 bg-amber-500 rounded-b-full shadow-[0_15px_30px_rgba(245,158,11,0.6)] border-4 border-slate-950 flex flex-col items-center justify-end pb-2",children:o.jsx("div",{className:"w-1.5 h-6 bg-slate-950/30 rounded-full"})})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-40 pointer-events-none",children:o.jsx(qt,{mode:"wait",children:l?o.jsx(ee.div,{initial:{scale:.8},animate:{scale:1.1},exit:{scale:1.2,opacity:0},className:"text-7xl drop-shadow-2xl",children:y.icon},"spinning_icon"):o.jsxs(ee.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},className:"flex flex-col items-center gap-1 drop-shadow-2xl",children:[o.jsx("span",{className:"text-6xl",children:y.icon}),h&&o.jsxs(ee.span,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},className:`text-3xl font-black font-mono ${h.isWin?"text-emerald-400":"text-slate-500"}`,children:[h.multiplier,"x"]})]},"result_icon")})})]}),o.jsx("div",{className:"h-24 text-center flex flex-col items-center justify-center",children:o.jsx(qt,{mode:"wait",children:h&&!l&&o.jsxs(ee.div,{initial:{opacity:0,y:10,scale:.9},animate:{opacity:1,y:0,scale:1},className:"space-y-1",children:[o.jsxs("div",{className:`text-xs font-black uppercase tracking-[0.3em] flex items-center justify-center gap-2 ${h.isWin?"text-emerald-400":"text-slate-500"}`,children:[h.isWin&&o.jsx(sa,{size:12,className:"animate-pulse"}),h.label,h.isWin&&o.jsx(sa,{size:12,className:"animate-pulse"})]}),o.jsx("h4",{className:`text-3xl font-black italic tracking-tighter drop-shadow-lg transition-all ${h.multiplier>=2.5?"text-yellow-400 scale-110":"text-white"}`,children:h.isWin?`+${(r*h.multiplier).toLocaleString()} ${y.label}`:"Fortellingen er over"}),h.multiplier>=5&&o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},className:"text-[10px] font-black text-amber-500 uppercase tracking-[0.5em] mt-2 animate-bounce",children:"LEGENDARISK GEVINST!"})]})})})]})]})]})};class MZ{constructor(){Ie(this,"listeners",[])}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(s=>s!==e)}}emit(e){this.listeners.forEach(s=>s(e))}spawnFloatingText(e,s,n,i){const r=(Math.random()-.5)*4,a=(Math.random()-.5)*4;this.emit({id:Math.random().toString(36).substr(2,9),type:"FLOATING_TEXT",text:e,x:s+r,y:n+a,color:i,duration:1500})}spawnFlyingResource(e,s,n,i,r){this.emit({id:Math.random().toString(36).substr(2,9),type:"FLYING_RESOURCE",resource:e,startPoint:{x:s,y:n},endPoint:{x:i,y:r},duration:1e3})}spawnParticles(e,s,n){this.emit({id:Math.random().toString(36).substr(2,9),type:"PARTICLE",x:e,y:s,color:n,duration:800})}}const Xe=new MZ,DZ=({onComplete:t})=>{const[e,s]=N.useState([]),[n,i]=N.useState(!1),r=10,a=l=>{if(n)return;const c=l.currentTarget.getBoundingClientRect(),u=(l.clientX-c.left)/c.width*100,d=(l.clientY-c.top)/c.height*100,h={x:u,y:d,id:Date.now()};Xe.spawnParticles(u,d,"bg-emerald-400"),s(f=>{const m=[...f,h];return m.length>=r&&(i(!0),setTimeout(()=>t(1),1500)),m})};return o.jsxs("div",{onClick:a,className:"w-full h-[600px] relative overflow-hidden cursor-crosshair group active:scale-[0.99] transition-transform select-none",style:{backgroundImage:'url("/images/minigames/agriculture_bg.png")',backgroundSize:"cover",backgroundPosition:"center"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/40 z-0 pointer-events-none"}),o.jsx("div",{className:"absolute top-10 left-1/2 -translate-x-1/2 pointer-events-none z-20 text-center",children:n?o.jsx("div",{className:"animate-in zoom-in duration-300",children:o.jsx("h2",{className:"text-5xl font-black text-emerald-400 drop-shadow-[0_4px_0_rgba(0,0,0,0.5)] uppercase tracking-tighter animate-bounce",children:"Mestrerlig Sdd! "})}):o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-3xl font-black text-white drop-shadow-md mb-2",children:"S dine fr"}),o.jsxs("div",{className:"bg-black/40 px-4 py-1 rounded-full text-emerald-400 font-bold uppercase tracking-widest text-sm inline-block",children:[e.length," / ",r]})]})}),e.map(l=>o.jsx("div",{className:"absolute w-4 h-4 bg-emerald-400 rounded-full shadow-[0_0_10px_rgba(52,211,153,0.8)] animate-in zoom-in duration-300",style:{left:`${l.x}%`,top:`${l.y}%`,transform:"translate(-50%, -50%)"},children:o.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 w-0.5 h-3 bg-white/50"})},l.id)),o.jsx("div",{className:"absolute inset-0 pointer-events-none z-10 hidden group-hover:block",children:o.jsx("div",{className:"absolute w-8 h-8 border-2 border-white/50 rounded-full -translate-x-1/2 -translate-y-1/2"})})]})},hl=({onComplete:t,equipment:e=[],isMining:s,isQuarrying:n,isForaging:i,speedMultiplier:r=1,possibleYield:a=10,resourceName:l="Ressurs"})=>{const[c,u]=N.useState(0),[d,h]=N.useState([]),[f,m]=N.useState(!1),[b,x]=N.useState(!1),[v,g]=N.useState(!1),p=N.useRef(1),[y,k]=N.useState(50),w=N.useRef(1);N.useEffect(()=>{const T=E=>{E.code==="Space"&&(E.preventDefault(),S())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[d,f,c,y,e,r,v]),N.useEffect(()=>{if(d.length>=5||f||v)return;const T=setInterval(()=>{u(E=>{let A=2/r,j=E+A*p.current;return j>100?(p.current=-1,100):j<0?(p.current=1,0):j}),k(E=>{let j=E+.3*w.current;return Math.random()<.02&&(w.current*=-1),j>80?(w.current=-1,80):j<20?(w.current=1,20):j})},16);return()=>clearInterval(T)},[d.length,f,r,v]);const S=()=>{var M,D,I;if(d.length>=5||f||v)return;const T=Math.abs(c-y);let E=T<5?1:T<15?.7:T<25?.4:.1;const A=s?"MINE":n?"QUARRY":i?"FORAGE":"WORK",j=mR(A,e||[]);console.log(`[HarvestingGame] Init. Action: ${A}. Equipment Count: ${e==null?void 0:e.length}. Best Tool:`,j);const O=((M=j==null?void 0:j.stats)==null?void 0:M.yieldBonus)||(j&&ta(j)?(I=(D=qe[ta(j)])==null?void 0:D.stats)==null?void 0:I.yieldBonus:0)||0,H=Math.ceil(a/5*(.5+E)),G=Math.ceil(O/5*(.5+E));T<15?(x(!0),g(!0),Xe.spawnParticles(50,40,T<5?"bg-amber-400":"bg-white"),T<5?Xe.spawnFloatingText(`PERFEKT! + ${H} ${G>0?`(+${G})`:""} `,50,40,"text-amber-400 font-black text-2xl"):Xe.spawnFloatingText(`Bra! +${H}`,50,40,"text-white font-bold"),setTimeout(()=>{x(!1),g(!1)},100)):Xe.spawnFloatingText("Svakt...",50,40,"text-slate-500 font-bold");const L=[...d,E];h(L),L.length===5&&(m(!0),setTimeout(()=>t(L.reduce((F,U)=>F+U,0)/5),800))},_=s||n?'url("/images/minigames/mining_bg.png")':i?'url("/images/minigames/foraging_bg.png")':'url("/images/minigames/agriculture_bg.png")';return o.jsxs("div",{className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${b?"animate-shake":""} `,style:{backgroundImage:_,backgroundSize:"cover",backgroundPosition:"center"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/70 z-0 transition-all duration-75 ${v?"bg-indigo-900/50 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 w-full flex flex-col items-center transition-all duration-75 ${v?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-4xl font-black text-white mb-8 drop-shadow-lg tracking-tighter uppercase",children:s?"Gruvedrift":n?"Steinhugger":i?"Sanking":l!=null&&l.toLowerCase().includes("lin")?"Linhsting":"Kornhsting"}),f?o.jsx("div",{className:"py-12 animate-bounce text-5xl font-black text-amber-500 uppercase tracking-tighter drop-shadow-[0_0_20px_rgba(245,158,11,0.5)]",children:"FERDIG! "}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"mb-4 text-xs font-black text-amber-500 uppercase tracking-widest",children:l}),o.jsxs("div",{className:"w-full h-8 bg-white/5 rounded-full mb-12 relative border border-white/10 overflow-hidden shadow-inner",children:[o.jsx("div",{className:"absolute inset-y-0 bg-amber-500/30 border-x border-amber-500/50 transition-all duration-75 linear",style:{left:`${y-8}%`,right:`${100-(y+8)}%`}}),o.jsx("div",{className:"absolute inset-y-0 w-0.5 bg-amber-400/80 z-0",style:{left:`${y}%`}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_20px_white] z-10",style:{left:`${c}% `}})]}),o.jsx("button",{onClick:S,className:`w-full bg-amber-500 hover:bg-amber-400 text-slate-950 py-7 rounded-[2rem] font-black text-2xl shadow-2xl transition-all uppercase tracking-widest border-b-4 border-amber-700 ${v?"scale-95 brightness-125":"active:scale-95"}`,children:"KLIKK N! "})]})]})]})},LZ=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=N.useState(50),[i,r]=N.useState(50),[a,l]=N.useState(0),[c,u]=N.useState(!1),[d,h]=N.useState(!1),[f,m]=N.useState(!1),b=N.useRef(1);N.useEffect(()=>{if(c||f)return;const v=setInterval(()=>{n(g=>{let p=g+.8*b.current*e;return p>90?(b.current=-1,90):p<10?(b.current=1,10):p})},16);return()=>clearInterval(v)},[c,e,f]),N.useEffect(()=>{const v=g=>{g.code==="Space"&&(g.preventDefault(),x({clientX:window.innerWidth/2,clientY:window.innerHeight/2}))};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[c,i,s,f]);const x=v=>{if(c||f)return;const g=Math.abs(i-s),p=v.clientX,y=v.clientY;g<12?(h(!0),m(!0),l(k=>{const w=k+1;return w>=5&&(u(!0),Xe.spawnFloatingText("MESTERVERK! ",p,y-60,"text-amber-400 text-3xl font-black"),setTimeout(()=>t(1),1200)),w}),Xe.spawnParticles(p,y,"bg-amber-400"),Xe.spawnFloatingText("KLANG!",p,y-40,"text-amber-500 font-black"),setTimeout(()=>{h(!1),m(!1)},100)):g<25?(Xe.spawnFloatingText("Treff",p,y-40,"text-white font-bold"),Xe.spawnParticles(p,y,"bg-white")):Xe.spawnFloatingText("BOM!",p,y-40,"text-slate-500 font-bold")};return o.jsxs("div",{onMouseMove:v=>{const g=v.currentTarget.getBoundingClientRect();r((v.clientX-g.left)/g.width*100)},onClick:x,className:`p-12 min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden cursor-crosshair ${d?"animate-shake":""}`,style:{backgroundImage:'url("/images/minigames/smithing_bg.png")',backgroundSize:"cover",backgroundColor:"#0f172a"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/70 z-0 transition-all duration-75 ${f?"bg-amber-900/40 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 text-center mb-12 transition-all duration-75 ${f?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tighter drop-shadow-xl",children:"Smedarbeid"}),o.jsxs("div",{className:"text-amber-500 font-black uppercase tracking-widest text-xs mt-2 bg-black/40 px-4 py-1 rounded-full border border-amber-500/20",children:["Slag: ",a," / 5"]})]}),o.jsxs("div",{className:`relative z-10 w-full max-w-2xl space-y-4 transition-all duration-75 ${f?"scale-105":""}`,children:[o.jsxs("div",{className:"w-full h-24 bg-slate-900/50 rounded-2xl border-2 border-white/10 shadow-2xl flex items-center px-4 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-amber-500/5 transition-all duration-1000",style:{opacity:a/5}}),o.jsxs("div",{className:"relative w-full h-4 bg-white/5 rounded-full overflow-hidden",children:[o.jsx("div",{className:"absolute inset-y-0 w-24 bg-amber-500/40 blur-sm mix-blend-screen transition-all duration-75",style:{left:`${s}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-12 bg-white/40 blur-[2px]",style:{left:`${s}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_15px_white] z-20",style:{left:`${i}%`,transform:"translateX(-50%)"}})]})]}),o.jsxs("div",{className:"flex items-center gap-4 px-2",children:[o.jsx("div",{className:"flex-1 h-2 bg-black/40 rounded-full overflow-hidden border border-white/5",children:o.jsx("div",{className:"h-full bg-gradient-to-r from-amber-600 to-amber-400 transition-all duration-500",style:{width:`${a/5*100}%`}})}),o.jsxs("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest",children:[Math.round(a/5*100),"%"]})]})]}),c&&o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm animate-in fade-in zoom-in duration-300",children:o.jsx("div",{className:"text-6xl font-black text-amber-500 animate-bounce drop-shadow-[0_0_30px_rgba(245,158,11,0.5)]",children:"FERDIG! "})}),o.jsx("div",{className:`mt-12 text-slate-400 text-sm font-bold uppercase tracking-widest animate-pulse relative z-10 transition-opacity ${f?"opacity-0":"opacity-100"}`,children:"Klikk nr markren er over den gldende sonen"})]})},PZ=({onComplete:t,speedMultiplier:e=1,icon:s=""})=>{const[n,i]=N.useState(0),[r,a]=N.useState(!1),[l,c]=N.useState(null),[u,d]=N.useState(0),[h,f]=N.useState(80),m=N.useRef(-1);N.useEffect(()=>{if(r||l)return;const x=setInterval(()=>{i(g=>{const p=g+1*e;return p>=100?(c("BRENT! "),setTimeout(()=>{c(null),i(0)},1e3),0):p})},50),v=setInterval(()=>{f(g=>{let y=g+.8*m.current;return y>90?(m.current=-1,90):y<40?(m.current=1,40):y})},50);return()=>{clearInterval(x),clearInterval(v)}},[r,l,e]),N.useEffect(()=>{const x=v=>{v.code==="Space"&&(v.preventDefault(),b())};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[r,l,n,h]);const b=()=>{if(r||l)return;const x=h-10,v=h+10;n>x&&n<v?(c("PERFEKT GYLLEN! "),d(g=>{const p=g+1;return p>=3&&(a(!0),setTimeout(()=>t(1),1e3)),p})):n<x?c("R... "):c("LITT BRENT... "),setTimeout(()=>{c(null),i(0)},1e3)};return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/bakery_bg.png")',backgroundSize:"cover",backgroundColor:"#451a03"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Bakeri: Steking "}),o.jsxs("div",{className:"relative z-10 w-64 h-64 bg-slate-900 border-8 border-amber-900 rounded-3xl flex items-center justify-center overflow-hidden mb-12 shadow-2xl",children:[o.jsx("div",{className:"absolute inset-0 bg-orange-500/10 animate-pulse"}),o.jsx("div",{className:"text-8xl transition-all duration-300 transform",style:{filter:`grayscale(${100-n}%) sepia(${n}%)`,transform:`scale(${.8+n/500})`},children:s}),l&&o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center text-white font-black text-2xl p-4 animate-in zoom-in",children:l})]}),o.jsxs("div",{className:`relative z-10 w-full max-w-sm h-8 bg-white/10 rounded-full mb-12 border ${n>h-10&&n<h+10?"border-emerald-500 shadow-[0_0_15px_rgba(16,185,129,0.5)]":"border-white/10"} overflow-hidden transition-all shadow-2xl`,children:[o.jsx("div",{className:"absolute inset-y-0 bg-emerald-500/30 border-x border-emerald-500/50 transition-all duration-75 ease-linear",style:{left:`${h-10}%`,right:`${100-(h+10)}%`},children:n>h-10&&n<h+10&&o.jsx("div",{className:"absolute inset-0 bg-emerald-400/20 animate-pulse"})}),o.jsx("div",{className:"h-full bg-orange-500 transition-all duration-75 relative z-10 opacity-80",style:{width:`${n}% `}}),o.jsx("div",{className:"absolute top-0 bottom-0 w-1 bg-white/50 z-20",style:{left:`${h}%`}})]}),o.jsx("div",{className:"relative z-10 flex gap-4 mb-8",children:[...Array(3)].map((x,v)=>o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-2xl border-2 transition-all ${u>v?"bg-amber-500 border-amber-300 scale-110 shadow-lg":"bg-white/5 border-white/10 opacity-30"} `,children:s},v))}),o.jsx("button",{onClick:b,className:"relative z-10 w-full max-w-sm bg-amber-600 hover:bg-amber-500 text-white py-6 rounded-2xl font-black text-2xl shadow-xl active:scale-95 transition-all uppercase tracking-widest border-b-8 border-amber-800",children:"TA UT N! "})]})},VZ=(t,e)=>{if(e)return e.find(s=>{var r;if(!s)return!1;const n=Object.keys(qe).find(a=>s.id===a||s.id.startsWith(a+"_")),i=n?qe[n]:null;return(r=i==null?void 0:i.relevantActions)==null?void 0:r.includes(t)})},BZ=({onComplete:t,equipment:e=[]})=>{const[s,n]=N.useState(0),[i,r]=N.useState(!1),[a,l]=N.useState(!1),[c,u]=N.useState(0),[d,h]=N.useState({x:50,y:50}),[f,m]=N.useState(!1),b=()=>h({x:20+Math.random()*60,y:20+Math.random()*60}),x=g=>{if(a)return;l(!0),r(!0);const p=s+1;n(p);const y=p>5,k=p>2?`${p}x COMBO!`:y?"FLAWLESS!":"TREFF!",w=y?"text-amber-400 font-display":"text-white";Xe.spawnFloatingText(k,g.clientX,g.clientY-40,w),Xe.spawnParticles(g.clientX,g.clientY,y?"bg-amber-400":"bg-white"),setTimeout(()=>{l(!1),r(!1),u(S=>(S+1>=10&&(m(!0),Xe.spawnFloatingText("FULLFRT! ",g.clientX,g.clientY-100,"text-emerald-400 text-2xl"),setTimeout(()=>t(1),1200)),S+1)),b()},80)},v=VZ("CHOP",e);return o.jsxs("div",{className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${i?"animate-shake":""} `,style:{backgroundImage:'url("/images/minigames/forestry_bg.png")',backgroundSize:"cover"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/60 z-0"}),o.jsx("div",{className:"relative z-10 w-full mb-8",children:o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx("h2",{className:"text-4xl font-black text-white drop-shadow-lg tracking-tighter uppercase",children:"Tmmerhogging"}),o.jsxs("div",{className:"flex gap-4",children:[o.jsxs("div",{className:"text-amber-400 font-black uppercase tracking-widest text-xs px-4 py-1 bg-black/40 rounded-full inline-block border border-amber-500/20",children:["Framdrift: ",c,"/10"]}),s>0&&o.jsxs("div",{className:"text-rose-500 font-black uppercase tracking-widest text-xs px-4 py-1 bg-rose-500/10 rounded-full inline-block border border-rose-500/30 animate-bounce",children:["COMBO: x",s]}),v&&o.jsxs("div",{className:"text-indigo-400 font-black uppercase tracking-widest text-xs px-4 py-1 bg-indigo-500/10 rounded-full inline-block border border-indigo-500/30",children:[v.icon," ",v.name]})]})]})}),o.jsxs("div",{className:`relative z-10 w-full h-96 bg-white/5 rounded-[3rem] border border-white/10 shadow-inner overflow-hidden ${a?"opacity-90 grayscale-[0.5]":""}`,children:[o.jsx("div",{className:"absolute bottom-0 left-0 h-2 bg-indigo-500/50 transition-all duration-300 z-0",style:{width:`${c/10*100}%`}}),f?o.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[o.jsx("div",{className:"animate-bounce text-5xl font-black text-amber-500 uppercase tracking-tighter drop-shadow-2xl",children:"VEDHOGST FERDIG! "}),o.jsxs("div",{className:"text-xl font-black text-white uppercase tracking-widest bg-indigo-600 px-8 py-2 rounded-full shadow-lg",children:["Maks Combo: ",s]})]}):o.jsx("button",{onClick:x,onKeyDown:g=>{g.key===" "&&g.preventDefault()},className:`absolute w-20 h-20 bg-rose-500 rounded-full border-4 border-white shadow-[0_0_30px_rose] transition-all active:scale-90 ${a?"scale-110 brightness-150":"animate-pulse cursor-pointer"}`,style:{left:`${d.x}%`,top:`${d.y}%`,transform:"translate(-50%, -50%)"},children:""})]})]})},FZ=(t,e)=>{if(e)return e.find(s=>{var r;if(!s)return!1;const n=Object.keys(qe).find(a=>s.id===a||s.id.startsWith(a+"_")),i=n?qe[n]:null;return(r=i==null?void 0:i.relevantActions)==null?void 0:r.includes(t)})},mT=({onComplete:t,equipment:e=[],speedMultiplier:s=1,possibleYield:n=10,resourceName:i="Korn"})=>{const[r,a]=N.useState(0),[l,c]=N.useState(0),[u,d]=N.useState(!1),[h,f]=N.useState(!1),[m,b]=N.useState(!1),x=()=>{u||m||a(v=>{var p;const g=v+2*s;if(g>=100){const y=FZ("WORK",e),k=((p=y==null?void 0:y.stats)==null?void 0:p.yieldBonus)||0,w=Math.ceil(n/5*1.25),S=Math.ceil(k/5*1.25);return f(!0),b(!0),Xe.spawnFloatingText(`+ ${w} ${i} ${S>0?`(+${S})`:""} `,50,40,"text-amber-400 font-black text-xl"),Xe.spawnParticles(50,50,"bg-emerald-400"),setTimeout(()=>{f(!1),b(!1)},100),c(_=>(_+1>=5&&(d(!0),setTimeout(()=>t(1),800)),_+1)),0}return g})};return o.jsxs("div",{onMouseMove:x,className:`p-8 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden ${h?"animate-shake":""} `,style:{backgroundImage:'url("/images/minigames/agriculture_bg.png")',backgroundSize:"cover"},children:[o.jsx("div",{className:`absolute inset-0 bg-black/50 z-0 transition-all duration-75 ${m?"bg-emerald-900/40 mix-blend-hard-light":""}`}),o.jsxs("div",{className:`relative z-10 w-full flex flex-col items-center transition-all duration-75 ${m?"scale-105 brightness-150 contrast-125":""}`,children:[o.jsx("h2",{className:"text-3xl font-black text-white mb-4",children:"Scythe Sweep"}),o.jsx("div",{className:"w-full h-4 bg-white/10 rounded-full mb-8 border border-white/20 overflow-hidden",children:o.jsx("div",{className:"h-full bg-amber-400 transition-all duration-75",style:{width:`${r}% `}})}),o.jsx("div",{className:"grid grid-cols-5 gap-2",children:[...Array(5)].map((v,g)=>o.jsx("div",{className:`w-8 h-8 rounded-lg border-2 ${l>g?"bg-amber-500 border-amber-300":"border-white/20"} `},g))}),o.jsx("div",{className:"mt-8 text-slate-400 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Beveg musen raskt frem og tilbake!"})]})]})},pT=({onComplete:t,speedMultiplier:e=1,variant:s="water"})=>{const[n,i]=N.useState(0),[r,a]=N.useState(0),[l,c]=N.useState(!1),[u,d]=N.useState(50),[h,f]=N.useState(1),[m,b]=N.useState(!1);N.useEffect(()=>{if(l)return;const v=setInterval(()=>{i(g=>{let p=3/e,y=g+p*h;return y>100?(f(-1),100):y<0?(f(1),0):y})},16);return()=>clearInterval(v)},[h,l,e]);const x=()=>{if(Math.abs(n-u)<10)b(!0),setTimeout(()=>b(!1),200),a(g=>{const p=s==="land"?"FANGST! ":"NAPP! ";return Xe.spawnFloatingText(p,50,40,"text-emerald-400 font-black text-3xl"),Xe.spawnParticles(50,50,"bg-emerald-400"),g+1>=3&&(c(!0),setTimeout(()=>t(1),1e3)),g+1}),d(20+Math.random()*60);else{b(!0),setTimeout(()=>b(!1),200);const g=s==="land"?"BOM... ":"INGENTING... ";Xe.spawnFloatingText(g,50,40,"text-rose-400 font-bold text-xl")}};return o.jsxs("div",{className:`p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden transition-transform ${m?"animate-shake":""}`,style:{backgroundImage:s==="land"?'url("/images/textures/bark.png")':'url("/images/minigames/foraging_bg.png")',backgroundColor:s==="land"?"#2f3e28":"#0c4a6e",backgroundSize:"cover"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-12 tracking-tighter uppercase italic drop-shadow-lg",children:s==="land"?"Fellefangst ":"Snarefiske "}),o.jsxs("div",{className:"relative z-10 w-full max-w-sm h-12 bg-white/5 rounded-full border border-white/10 mb-12 shadow-inner overflow-hidden",children:[o.jsx("div",{className:"absolute inset-y-0 w-20 bg-amber-500/40 border-x-2 border-amber-500/50 rounded-lg blur-[1px]",style:{left:`${u}%`,transform:"translateX(-50%)"}}),o.jsx("div",{className:"absolute inset-y-0 w-1 bg-white shadow-[0_0_15px_white] z-20",style:{left:`${n}%`}})]}),o.jsx("div",{className:"relative z-10 flex gap-4 mb-12",children:[...Array(3)].map((v,g)=>o.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl border-2 transition-all duration-300 ${r>g?"bg-emerald-500 border-emerald-300 scale-110 shadow-[0_0_20px_rgba(16,185,129,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:r>g?s==="land"?"":"":""},g))}),o.jsx("button",{onClick:x,className:"relative z-10 w-full max-w-md bg-sky-600 hover:bg-sky-500 text-white py-8 rounded-[2rem] font-black text-3xl shadow-2xl active:scale-95 transition-all uppercase tracking-widest border-b-8 border-sky-800 active:border-b-0 active:translate-y-2 group",children:o.jsx("span",{className:"drop-shadow-md group-hover:scale-105 inline-block transition-transform",children:s==="land"?"SJEKK FELLA! ":"HAL INN! "})})]})},UZ=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=N.useState("right"),[i,r]=N.useState(0),[a,l]=N.useState(!1),[c,u]=N.useState(null),d=h=>{a||h!==s&&(n(h),r(f=>{const m=f+5*e;return m>=100?(l(!0),setTimeout(()=>t(1),1e3),100):m}),u(h==="left"?"":""),setTimeout(()=>u(null),200))};return N.useEffect(()=>{const h=f=>{(f.key==="ArrowLeft"||f.key==="a"||f.key==="A")&&d("left"),(f.key==="ArrowRight"||f.key==="d"||f.key==="D")&&d("right")};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[s,a]),o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/weavery_bg.png")',backgroundSize:"cover",backgroundColor:"#1e1b4b"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Veveri: Vevstol "}),o.jsxs("div",{className:`relative z-10 w-full max-w-lg aspect-video bg-slate-900/50 border-4 rounded-3xl p-8 mb-12 flex flex-col justify-between overflow-hidden transition-all ${c?"brightness-125":""} ${s==="left"?"border-indigo-500/50 shadow-[inset_20px_0_40px_rgba(99,102,241,0.1)]":"border-emerald-500/50 shadow-[inset_-20px_0_40px_rgba(16,185,129,0.1)]"} `,children:[o.jsxs("div",{className:"flex justify-between items-center mb-8 relative h-32",children:[o.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 text-6xl transition-all duration-300 ease-out z-20",style:{left:s==="left"?"0%":"calc(100% - 4rem)",transform:`translateY(-50%) rotate(${s==="left"?"0deg":"180deg"})`},children:""}),o.jsx("div",{className:`text-6xl transition-all duration-500 ${s==="left"?"scale-110 opacity-100 rotate-12":"scale-75 opacity-20"} `,children:""}),o.jsx("div",{className:"absolute inset-x-0 h-1 bg-white/20 top-1/2 -translate-y-1/2 pointer-events-none"}),o.jsx("div",{className:`text-6xl transition-all duration-500 ${s==="right"?"scale-110 opacity-100 -rotate-12":"scale-75 opacity-20"} `,children:""})]}),o.jsx("div",{className:"text-sm font-black text-indigo-300 uppercase tracking-[0.3em] h-8 animate-pulse",children:c||"Veksle mellom Venstre / Hyre"})]}),o.jsxs("div",{className:"relative z-10 flex gap-12 mb-8",children:[o.jsx("button",{onClick:()=>d("left"),className:`w-28 h-28 rounded-[2rem] flex items-center justify-center text-4xl border-4 transition-all active:scale-90 ${s==="right"?"bg-indigo-600 border-indigo-400 scale-110 shadow-[0_0_30px_rgba(99,102,241,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:""}),o.jsx("button",{onClick:()=>d("right"),className:`w-28 h-28 rounded-[2rem] flex items-center justify-center text-4xl border-4 transition-all active:scale-90 ${s==="left"?"bg-emerald-600 border-emerald-400 scale-110 shadow-[0_0_30px_rgba(16,185,129,0.5)]":"bg-white/5 border-white/10 opacity-30 shadow-inner"} `,children:""})]}),o.jsx("div",{className:"relative z-10 w-full max-w-sm h-4 bg-white/10 rounded-full border border-white/10 overflow-hidden",children:o.jsx("div",{className:"h-full bg-indigo-500 transition-all duration-300",style:{width:`${i}% `}})})]})},$Z=({onComplete:t,speedMultiplier:e=1})=>{var b;const[s,n]=N.useState([]),[i,r]=N.useState([]),[a,l]=N.useState(0),[c,u]=N.useState(!1),[d,h]=N.useState(null),f=[{id:"red",icon:"",label:"Rdurt"},{id:"blue",icon:"",label:"Blbr"},{id:"green",icon:"",label:"Grnnmose"},{id:"yellow",icon:"",label:"Gulrot"}];N.useEffect(()=>{const x=[];for(let v=0;v<5;v++)x.push(f[Math.floor(Math.random()*f.length)].id);n(x)},[]);const m=x=>{if(!(c||d))if(x===s[a]){const v=a+1;r(g=>[...g,x]),l(v),h("RIKTIG! "),setTimeout(()=>h(null),500),v>=s.length&&(u(!0),setTimeout(()=>t(1),1e3))}else h("FEIL... "),l(0),r([]),setTimeout(()=>h(null),1e3)};return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",style:{backgroundImage:'url("/images/minigames/apothecary_bg.png")',backgroundSize:"cover",backgroundColor:"#2e1065"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0"}),o.jsx("h2",{className:"relative z-10 text-4xl font-black text-white mb-8 tracking-tighter uppercase italic",children:"Apoteker: Brygging "}),o.jsx("div",{className:"relative z-10 mb-12 flex gap-4 h-24 items-center",children:s.map((x,v)=>{var g;return o.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center text-3xl transition-all border-2 border-white/10 ${a>v?"opacity-10 scale-90":"bg-black/40 scale-100"} `,children:(g=f.find(p=>p.id===x))==null?void 0:g.icon},v)})}),d&&o.jsx("div",{className:`relative z-10 text-3xl font-black mb-8 animate-in zoom-in ${d.includes("FEIL")?"text-rose-500":"text-emerald-400"} `,children:d}),o.jsxs("div",{className:"relative z-10 w-48 h-64 bg-white/5 border-4 border-white/20 rounded-b-[4rem] rounded-t-3xl overflow-hidden mb-12 shadow-inner",children:[o.jsx("div",{className:"absolute bottom-0 inset-x-0 transition-all duration-1000 ease-out",style:{height:`${a/s.length*100}%`,backgroundColor:a>0?(b=f.find(x=>x.id===s[a-1]))==null?void 0:b.id:"transparent",opacity:.6},children:o.jsx("div",{className:"absolute top-0 inset-x-0 h-4 bg-white/20 animate-pulse pointer-events-none"})}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-6xl opacity-20 transition-transform duration-500 scale-125",children:""})]}),o.jsx("div",{className:"relative z-10 grid grid-cols-2 gap-4",children:f.map(x=>o.jsxs("button",{onClick:()=>m(x.id),className:`w-32 h-32 bg-slate-900/80 border-2 rounded-3xl flex flex-col items-center justify-center transition-all active:scale-90 shadow-xl group ${d==="RIKTIG! "&&s[a-1]===x.id?"border-emerald-500 scale-105 shadow-emerald-500/20":"border-white/20 hover:border-white/40"} `,children:[o.jsx("span",{className:"text-4xl mb-2 group-hover:scale-110 transition-transform",children:x.icon}),o.jsx("span",{className:"font-bold text-white uppercase text-sm",children:x.label})]},x.id))})]})},HZ=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=N.useState(0),[i,r]=N.useState(0),[a,l]=N.useState(!0),[c,u]=N.useState(0),[d,h]=N.useState(!1),[f,m]=N.useState(1);N.useEffect(()=>{if(d)return;const x=setInterval(()=>{u(v=>{let g=v+f*3*e;return g>=100?(m(-1),100):g<=0?(m(1),0):g})},16);return()=>clearInterval(x)},[f,d,e]);const b=N.useCallback(x=>{if(d)return;const v=Math.abs(c-50),g=v<15,p=v>35;let y=0,k="",w="";g?(y=1,k="PERFEKT!",w="text-amber-400"):p?(y=.1,k="BOM!",w="text-rose-400"):(y=.5,k="BRA!",w="text-emerald-400");const S="clientX"in x?x.clientX:x.touches[0].clientX,_="clientY"in x?x.clientY:x.touches[0].clientY;Xe.spawnFloatingText(k,S,_-40,w),y>.1&&Xe.spawnParticles(S,_,y===1?"bg-amber-400":"bg-emerald-400"),r(E=>E+1),l(!a);const T=y*10;n(E=>{const A=E+T;return A>=100?(h(!0),Xe.spawnFloatingText("PLANKER FERDIG! ",S,_-100,"text-emerald-400 text-2xl font-black"),setTimeout(()=>t(1),1e3),100):A})},[c,d,a,t]);return o.jsxs("div",{className:"p-12 text-center min-h-[600px] relative flex flex-col items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"absolute inset-0 bg-slate-950 z-0",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 bg-[url('/images/textures/wood_pattern.png')] bg-repeat"}),o.jsx("div",{className:"absolute inset-x-0 bottom-0 h-32 bg-gradient-to-t from-indigo-500/10 to-transparent"})]}),o.jsxs("div",{className:"relative z-10 w-full mb-12",children:[o.jsx("h2",{className:"text-5xl font-black text-white uppercase tracking-tighter mb-2 italic drop-shadow-[0_0_20px_rgba(255,255,255,0.2)]",children:"Saging"}),o.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-[0.3em] text-xs",children:"Pull og Push i takt for perfekte planker"})]}),o.jsxs("div",{className:"relative z-10 w-full max-w-2xl h-64 bg-slate-900/50 rounded-[3rem] border border-white/5 shadow-2xl overflow-hidden flex items-center justify-center group cursor-pointer",onClick:b,children:[o.jsx("div",{className:"absolute inset-y-0 left-0 bg-indigo-500/20 transition-all duration-500 z-0",style:{width:`${s}%`}}),o.jsxs("div",{className:"relative w-4/5 h-16 bg-[#3d2b1f] rounded-lg border-2 border-[#2a1d15] shadow-2xl flex items-center",children:[o.jsx("div",{className:"absolute inset-0 opacity-30 bg-[url('/images/textures/bark.png')] bg-cover mix-blend-overlay"}),o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2 transition-transform duration-300 ${a?"-rotate-12 translate-x-4":"rotate-12 -translate-x-4"}`,children:o.jsx("div",{className:"text-6xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)]",children:""})}),o.jsxs("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 flex gap-1 opacity-40",children:[o.jsx("div",{className:"w-1 h-1 bg-amber-200 rounded-full animate-ping"}),o.jsx("div",{className:"w-1 h-1 bg-amber-400 rounded-full animate-ping delay-75"}),o.jsx("div",{className:"w-1 h-1 bg-amber-100 rounded-full animate-ping delay-150"})]})]})]}),o.jsxs("div",{className:"relative z-10 mt-12 w-full max-w-md h-12 bg-black/40 rounded-full border border-white/10 p-1 flex items-center shadow-inner",children:[o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-1/4 h-3/4 bg-amber-500/20 blur-sm rounded-full"}),o.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 w-[2px] h-full bg-amber-500/50"}),o.jsx("div",{className:"absolute w-8 h-8 bg-white rounded-full shadow-[0_0_20px_white] flex items-center justify-center transition-all duration-16 ease-linear",style:{left:`${c}%`,transform:"translateX(-50%)"},children:o.jsx("div",{className:"w-4 h-4 bg-indigo-500 rounded-full animate-pulse"})})]}),o.jsxs("div",{className:"relative z-10 mt-8",children:[o.jsxs("div",{className:"text-3xl font-black text-indigo-400 italic",children:[s.toFixed(0),"%"]}),o.jsxs("div",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-2",children:["Stroke: ",i]})]}),o.jsx("div",{className:"absolute inset-0 z-20 cursor-pointer",onClick:b})]})},GZ=({onComplete:t,speedMultiplier:e=1})=>{const s=N.useRef(20),n=N.useRef(0),i=N.useRef(0),r=N.useRef({min:60,max:85}),a=.025*e,l=1.5,c=3,[u,d]=N.useState("playing"),[h,f]=N.useState(0),m=N.useRef(void 0),b=N.useRef(void 0),x=N.useCallback(g=>{if(u==="playing"){if(b.current!==void 0){n.current-=a,s.current+=n.current,s.current<0?(s.current=0,n.current=0):s.current>100&&(s.current=100,n.current=-n.current*.5);const p=s.current>=r.current.min&&s.current<=r.current.max;if(p?(n.current*=.9,i.current+=.15*e):i.current=Math.max(0,i.current-.05),i.current>=100){d("won"),t(1);return}p?Math.random()>.8?f(1):f(0):s.current>90?f(3):f(0)}b.current=g,m.current=requestAnimationFrame(x)}},[u,t,e,a]);N.useEffect(()=>(m.current=requestAnimationFrame(x),()=>{m.current&&cancelAnimationFrame(m.current)}),[x]);const v=N.useCallback(()=>{u==="playing"&&(n.current+=l,n.current=Math.min(n.current,c))},[u,l]);return{heatRef:s,progressRef:i,targetRange:r.current,gameState:u,shakeIntensity:h,pump:v}},zZ=({heatRef:t,targetRange:e})=>{const s=N.useRef(null),n=N.useRef(null);return N.useEffect(()=>{let i;const r=()=>{const a=t.current;s.current&&(s.current.style.height=`${a}%`,a>90?s.current.style.filter=`hue-rotate(${Math.sin(Date.now()/50)*10}deg) brightness(1.2)`:s.current.style.filter="none"),n.current&&(n.current.style.opacity=`${a/100}`),i=requestAnimationFrame(r)};return i=requestAnimationFrame(r),()=>cancelAnimationFrame(i)},[t]),o.jsxs("div",{className:"relative w-24 h-96 bg-slate-900 rounded-full border-4 border-slate-700 shadow-2xl overflow-hidden backdrop-blur-sm",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 flex flex-col justify-between py-4 px-2",children:[...Array(10)].map((i,r)=>o.jsx("div",{className:"w-full h-px bg-white"},r))}),o.jsx("div",{className:"absolute w-full bg-green-500/20 border-y-2 border-green-500/50 z-10",style:{bottom:`${e.min}%`,height:`${e.max-e.min}%`},children:o.jsx("div",{className:"w-full h-full animate-pulse bg-green-400/10"})}),o.jsx("div",{className:"absolute bottom-0 w-full px-2 pb-2 transition-transform duration-75 ease-out z-20 h-full flex items-end pointer-events-none",children:o.jsx("div",{ref:s,className:"w-full rounded-b-full rounded-t-sm bg-gradient-to-t from-red-900 via-orange-600 to-yellow-300 shadow-[0_0_20px_rgba(255,165,0,0.6)]",style:{height:"0%",transition:"height 0.1s cubic-bezier(0.2, 0.8, 0.2, 1)"}})}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 to-transparent pointer-events-none z-30 rounded-full"}),o.jsx("div",{ref:n,className:"absolute inset-0 z-0 bg-orange-500/30 blur-xl pointer-events-none transition-opacity duration-300"})]})},qZ=({onPump:t})=>{const[e,s]=N.useState(!1),n=()=>{s(!0),t()},i=()=>{s(!1)};return o.jsxs("button",{onPointerDown:n,onPointerUp:i,onPointerLeave:i,"aria-label":"Pump Bellows",className:`
                relative group
                w-48 h-32 
                flex items-center justify-center
                transition-all duration-75 ease-out
                ${e?"scale-95":"scale-100 hover:scale-[1.02]"}
            `,children:[o.jsxs("div",{className:"absolute inset-0 bg-[#5d4037] rounded-xl shadow-[0_10px_0_#3e2723] active:shadow-none active:translate-y-[10px] transition-all duration-75 overflow-hidden border-2 border-[#8d6e63]",children:[o.jsx("div",{className:"absolute inset-0 opacity-20 bg-[radial-gradient(circle,_transparent_20%,_#000_120%)]"}),o.jsxs("div",{className:"w-full h-full flex flex-col justify-between py-2 px-4 opacity-50",children:[o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"}),o.jsx("div",{className:"h-0.5 bg-black/40 shadow-sm"})]})]}),o.jsx("div",{className:"relative z-10 text-orange-100 font-black uppercase text-2xl tracking-widest drop-shadow-md select-none pointer-events-none",children:"PUMP"})]})},KZ=({onComplete:t,speedMultiplier:e=1})=>{const{heatRef:s,progressRef:n,targetRange:i,shakeIntensity:r,gameState:a,pump:l}=GZ({onComplete:t,speedMultiplier:e}),c=N.useRef(null),u=N.useRef(null);N.useEffect(()=>{let h;const f=()=>{if(c.current)if(r>0){const m=(Math.random()-.5)*r*4,b=(Math.random()-.5)*r*4;c.current.style.transform=`translate(${m}px, ${b}px)`}else c.current.style.transform="none";if(u.current){const m=n.current;u.current.style.background=`conic-gradient(#f97316 ${m}%, transparent 0)`;const b=u.current.querySelector('[data-role="progress-text"]');b&&(b.innerText=`${Math.floor(m)}%`)}h=requestAnimationFrame(f)};return h=requestAnimationFrame(f),()=>cancelAnimationFrame(h)},[r,n]);const d=()=>{if(l(),c.current){const h=c.current.getBoundingClientRect();Xe.spawnParticles(h.left+h.width/2,h.bottom-100,"bg-orange-200")}};return o.jsxs("div",{ref:c,className:"p-8 min-h-[600px] w-full relative flex flex-col items-center justify-center overflow-hidden select-none",style:{backgroundImage:'url("/images/minigames/smeltery_bg.png")',backgroundSize:"cover",backgroundColor:"#1a0f0a"},children:[o.jsx("div",{className:"absolute inset-0 bg-black/70 z-0 backdrop-blur-[2px]"}),o.jsxs("div",{className:"relative z-10 text-center mb-8",children:[o.jsx("h2",{className:"text-5xl font-black text-transparent bg-clip-text bg-gradient-to-br from-orange-400 to-red-600 uppercase tracking-tighter drop-shadow-2xl filter contrast-125",children:"Smelting"}),o.jsx("div",{className:"text-orange-200/80 font-bold uppercase tracking-[0.2em] text-xs mt-2",children:"Hold varmen i sonen"})]}),o.jsxs("div",{className:"relative z-10 flex gap-12 items-end",children:[o.jsxs("div",{className:"flex flex-col items-center gap-2",children:[o.jsx(zZ,{heatRef:s,targetRange:i}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Heat"})]}),o.jsxs("div",{className:"flex flex-col items-center gap-4 mb-4",children:[o.jsxs("div",{role:"progressbar","aria-valuenow":Math.round(n.current),"aria-valuemin":0,"aria-valuemax":100,className:"relative w-32 h-32 rounded-full bg-slate-900 border-4 border-slate-700 shadow-xl flex items-center justify-center",children:[o.jsx("div",{ref:u,className:"absolute inset-0 rounded-full opacity-80",style:{background:"conic-gradient(#f97316 0%, transparent 0)"}}),o.jsx("div",{className:"absolute inset-2 bg-slate-900 rounded-full flex items-center justify-center",children:o.jsx("span",{"data-role":"progress-text",className:"text-3xl font-black text-white",children:"0%"})})]}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest",children:"Fremgang"})]})]}),o.jsx("div",{className:"relative z-10 mt-12",children:o.jsx(qZ,{onPump:d})}),a==="won"&&o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-md animate-in fade-in duration-300",children:o.jsxs("div",{className:"flex flex-col items-center gap-4 animate-in zoom-in-50 duration-500",children:[o.jsx("div",{className:"text-7xl",children:""}),o.jsx("div",{className:"text-6xl font-black text-white tracking-tighter drop-shadow-[0_0_30px_rgba(249,115,22,0.8)]",children:"PERFEKT!"})]})})]})},gT={ride_easy:{speed:.012,spawnRate:80,targetDistance:8,label:"Engelskogen",colors:{sky:"#1e293b",path:"#451a03"},xpMult:1},ride_medium:{speed:.018,spawnRate:60,targetDistance:12,label:"Fjellpasset",colors:{sky:"#0f172a",path:"#262626"},xpMult:1.5},ride_hard:{speed:.025,spawnRate:45,targetDistance:15,label:"Ulvestien",colors:{sky:"#020617",path:"#171717"},xpMult:2.2}},WZ={tree:"",house:"",cow:"",rock:"",bush:""},YZ=({onComplete:t,speedMultiplier:e=1,levelId:s="ride_easy",level:n=1,horse:i})=>{const r=gT[s]||gT.ride_easy,a=1+(n-1)*.15,l=1-(n-1)*.1,c=1+(n-1)*.2,u=N.useRef(null),[d,h]=N.useState(!1),[f,m]=N.useState(0),[b,x]=N.useState(0),v=N.useRef({lane:1,targetLane:1,cameraTilt:0,isJumping:!1,jumpTime:0,obstacles:[],sideObjects:[],lastSpawn:0,lastSideSpawn:0,distance:0,speed:r.speed*e*a,gameOver:!1,bobAmt:0,ticks:0});return N.useEffect(()=>{const g=p=>{v.current.gameOver||(p.key==="a"||p.key==="ArrowLeft"?v.current.targetLane=Math.max(0,v.current.targetLane-1):p.key==="d"||p.key==="ArrowRight"?v.current.targetLane=Math.min(2,v.current.targetLane+1):p.code==="Space"&&!v.current.isJumping&&(v.current.isJumping=!0,v.current.jumpTime=0,jt.playSfx("jump")))};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[]),N.useEffect(()=>{const g=u.current;if(!g)return;const p=g.getContext("2d");if(!p)return;let y;const k=()=>{if(v.current.gameOver)return;if(v.current.ticks++,v.current.distance+=v.current.speed,v.current.lane!==v.current.targetLane){const E=v.current.targetLane-v.current.lane;v.current.lane+=E*.2,Math.abs(v.current.targetLane-v.current.lane)<.01&&(v.current.lane=v.current.targetLane),v.current.cameraTilt=E*.15}else v.current.cameraTilt*=.9;if(v.current.isJumping&&(v.current.jumpTime+=.05,v.current.jumpTime>=Math.PI&&(v.current.isJumping=!1,v.current.jumpTime=0)),v.current.bobAmt=Math.sin(v.current.ticks*.2)*5,v.current.ticks-v.current.lastSpawn>r.spawnRate*l/e&&(Math.random()>.4&&v.current.obstacles.push({id:Date.now(),lane:Math.floor(Math.random()*3),z:0,type:Math.random()>.5?"log":"rock"}),v.current.lastSpawn=v.current.ticks),v.current.ticks-v.current.lastSideSpawn>15/e){const E=["tree","tree","bush","rock","house","cow"];v.current.sideObjects.push({id:Date.now(),side:Math.random()>.5?"left":"right",z:0,type:E[Math.floor(Math.random()*E.length)],offset:.2+Math.random()*.5}),v.current.lastSideSpawn=v.current.ticks}v.current.obstacles.forEach(E=>{if(E.z+=v.current.speed,E.z>.88&&E.z<.96){const A=Math.round(v.current.lane);if(E.lane===A){const j=E.type==="log",O=v.current.isJumping&&Math.sin(v.current.jumpTime)>.6;j&&O||w()}}}),v.current.sideObjects.forEach(E=>{E.z+=v.current.speed}),v.current.obstacles=v.current.obstacles.filter(E=>E.z<1.05),v.current.sideObjects=v.current.sideObjects.filter(E=>E.z<1.05);const T=v.current.distance;m(Math.floor(T*100)),T>=r.targetDistance*c&&S(1)},w=()=>{x(15),v.current.speed*=.6,Xe.spawnFloatingText("OUCH!",50,40,"text-rose-500 font-black text-3xl"),v.current.obstacles=v.current.obstacles.filter(T=>T.z<.85),setTimeout(()=>x(0),300)},S=T=>{v.current.gameOver||(v.current.gameOver=!0,h(!0),setTimeout(()=>t(T),2e3))},_=()=>{var U,R;if(!p)return;p.clearRect(0,0,g.width,g.height);const T=v.current.cameraTilt;p.save(),p.translate(g.width/2,g.height/2),p.rotate(T),p.translate(-g.width/2,-g.height/2);const E=p.createLinearGradient(0,0,0,g.height);E.addColorStop(0,r.colors.sky),E.addColorStop(.5,"#334155"),E.addColorStop(.5,"#064e3b"),E.addColorStop(1,"#065f46"),p.fillStyle=E,p.fillRect(-g.width*.5,0,g.width*2,g.height),p.beginPath(),p.moveTo(g.width*.45,g.height*.5),p.lineTo(g.width*.55,g.height*.5),p.lineTo(g.width*1.3,g.height),p.lineTo(g.width*-.3,g.height),p.closePath(),p.fillStyle=r.colors.path,p.fill(),p.strokeStyle="rgba(255,255,255,0.15)",p.setLineDash([20,10]),p.lineWidth=4,[.33,.66].forEach(C=>{p.beginPath(),p.moveTo(g.width*(.45+C*.1),g.height*.5),p.lineTo(g.width*(-.3+C*1.6),g.height),p.stroke()}),p.setLineDash([]),v.current.sideObjects.forEach(C=>{const $=C.z*C.z,V=g.height*.5,P=V+(g.height-V)*$,W=g.width*.1+g.width*1.6*$,J=W*C.offset+W*.1,Y=g.width*.5+(C.side==="left"?-J:J),he=20+200*$;p.save(),p.translate(Y,P),p.font=`${he}px serif`,p.textAlign="center",p.textBaseline="bottom",p.globalAlpha=C.z>.95?Math.max(0,1-(C.z-.95)*10):1,p.fillText(WZ[C.type]||"",0,0),p.restore()}),v.current.obstacles.forEach(C=>{const $=C.z*C.z,V=g.height*.5,P=V+(g.height-V)*$,W=g.width*.1+g.width*1.6*$,J=g.width*.5+(C.lane-1)*(W/3),Y=30+150*$,he=C.z>.95?Math.max(0,1-(C.z-.95)*10):1;p.save(),p.globalAlpha=he,p.translate(J,P),C.type==="log"?(p.fillStyle="#78350f",p.fillRect(-Y/2,-Y/6,Y,Y/3),p.strokeStyle="#451a03",p.lineWidth=2,p.strokeRect(-Y/2,-Y/6,Y,Y/3)):(p.fillStyle="#475569",p.beginPath(),p.arc(0,0,Y/2,0,Math.PI*2),p.fill(),p.strokeStyle="#1e293b",p.stroke()),p.restore()}),p.restore();const A=v.current.lane,j=g.width*.5+(A-1)*(g.width*.45);p.save(),p.fillStyle="rgba(0,0,0,0.3)",p.beginPath(),p.ellipse(j,g.height-40,60,20,0,0,Math.PI*2),p.fill(),p.restore(),p.save(),p.strokeStyle="rgba(255,255,255,0.1)",p.lineWidth=2;for(let C=0;C<10;C++){const $=(v.current.ticks*20+C*200)%g.width,V=C*77%g.height;p.beginPath(),p.moveTo($,V),p.lineTo($+50,V),p.stroke()}p.restore();const O=v.current.bobAmt,H=v.current.isJumping?-Math.sin(v.current.jumpTime)*120:0,G=i!=null&&i.skinId&&{brown:"#8B4513",white:"#E2E8F0",black:"#1A202C",golden:"#F6E05E",chestnut:"#7C2D12",grey:"#94A3B8"}[i.skinId]||"#8B4513";p.save(),p.translate(j+(b>0?(Math.random()-.5)*b:0),g.height-110+O+H),p.rotate(T*.5),p.fillStyle=G,p.beginPath(),p.ellipse(0,150,80,200,0,0,Math.PI*2),p.fill(),p.beginPath(),p.ellipse(0,0,40,70,0,0,Math.PI*2),p.fill(),p.fillStyle=(i==null?void 0:i.skinId)==="black"||(i==null?void 0:i.skinId)==="chestnut"?"#020617":"#451a03",p.beginPath(),p.ellipse(0,40,30,40,0,0,Math.PI*2),p.fill(),p.fillStyle=G,p.beginPath(),p.moveTo(-30,-50),p.lineTo(-40,-90),p.lineTo(-10,-60),p.fill(),p.beginPath(),p.moveTo(30,-50),p.lineTo(40,-90),p.lineTo(10,-60),p.fill();const L=(i==null?void 0:i.maneColor)||"#1e1b4b";if(L==="rainbow"){const C=p.createLinearGradient(-10,-60,20,100);C.addColorStop(0,"#f43f5e"),C.addColorStop(.3,"#fbbf24"),C.addColorStop(.6,"#10b981"),C.addColorStop(1,"#6366f1"),p.fillStyle=C}else p.fillStyle=L;if(p.fillRect(-10,-60,20,100),i!=null&&i.hatId&&(i==null?void 0:i.hatId)!=="none"){const C={straw_hat:"",cowboy_hat:"",crown:"",viking:"",tophat:""}[i.hatId];C&&(p.font="60px serif",p.textAlign="center",p.fillText(C,0,-60))}p.restore();const M=v.current.distance/(r.targetDistance*c),D=g.width*.6,I=(g.width-D)/2,F=20;p.fillStyle="rgba(0,0,0,0.5)",(U=p.roundRect)==null||U.call(p,I,F,D,10,5),p.fill(),p.fillStyle="#fbbf24",(R=p.roundRect)==null||R.call(p,I,F,D*Math.min(1,M),10,5),p.fill(),p.fillStyle="white",p.font="bold 12px Inter",p.textAlign="center",p.fillText(r.label.toUpperCase()+` - NIV ${n}`,g.width/2,F+25),k(),y=requestAnimationFrame(_)};return _(),()=>cancelAnimationFrame(y)},[e]),o.jsxs("div",{className:"relative w-full h-[600px] bg-slate-950 overflow-hidden flex flex-col items-center justify-center",children:[o.jsx("canvas",{ref:u,width:800,height:600,className:"w-full h-full object-cover"}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none flex flex-col items-center justify-between p-12",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h2",{className:"text-4xl font-black text-white italic tracking-tighter uppercase drop-shadow-[0_0_10px_rgba(0,0,0,0.5)]",children:"Galopp!"}),o.jsx("p",{className:"text-amber-400 font-bold uppercase tracking-widest text-sm",children:"Bruk A/D for  bytte bane, SPACE for  hoppe"})]}),d&&o.jsxs("div",{className:"bg-slate-950/80 backdrop-blur-xl p-12 rounded-[3rem] border-2 border-amber-500 animate-in zoom-in duration-300",children:[o.jsx("div",{className:"text-6xl mb-4",children:""}),o.jsx("h3",{className:"text-5xl font-black text-white italic mb-2",children:"RITT FULLFRT!"}),o.jsxs("p",{className:"text-xl text-slate-400 font-bold uppercase",children:["Du red ",f," meter"]})]})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",children:o.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_center,transparent_0%,rgba(255,255,255,0.1)_100%)]"})})]})},xT=({onComplete:t,speedMultiplier:e=1})=>{const[s,n]=N.useState(0),[i,r]=N.useState(5),[a,l]=N.useState(!1),[c,u]=N.useState(50),[d,h]=N.useState(50),f=N.useRef(0),m=N.useRef(0),[b,x]=N.useState({x:50,y:50});N.useEffect(()=>{if(a)return;const g=()=>{f.current+=.02*e;const p=Math.sin(f.current)*4+Math.cos(f.current*2.3)*2,y=Math.cos(f.current*.8)*3+Math.sin(f.current*1.5)*1.5;u(50+p),h(50+y),m.current=requestAnimationFrame(g)};return m.current=requestAnimationFrame(g),()=>cancelAnimationFrame(m.current)},[a,e]);const v=()=>{if(a||i<=0)return;const g=c-b.x,p=d-b.y,y=Math.sqrt(g*g+p*p);let k=0,w="BOM!",S="text-rose-500";y<3?(k=50,w="BULLSEYE! ",S="text-amber-400",Xe.spawnParticles(50,50,"bg-amber-400")):y<8?(k=20,w="TREFF!",S="text-emerald-400",Xe.spawnParticles(50,50,"bg-white")):y<15&&(k=5,w="KANTEN...",S="text-slate-400"),Xe.spawnFloatingText(w,50,40,S),n(_=>_+k),r(_=>{const T=_-1;if(T<=0){l(!0);let E=.5;s+k>=100?E=1.2:s+k>=50?E=1:E=.8,setTimeout(()=>t(E),2e3)}else x({x:45+Math.random()*10,y:45+Math.random()*10});return T})};return o.jsxs("div",{onClick:v,className:"relative w-full h-[600px] overflow-hidden bg-slate-900 cursor-crosshair select-none group",style:{backgroundImage:'url("/images/minigames/forestry_bg.png")',backgroundSize:"cover",backgroundPosition:"center 30%"},children:[o.jsx("div",{className:"absolute inset-0 bg-radial-gradient from-transparent to-black/60 pointer-events-none"}),o.jsx("div",{className:"absolute w-32 h-32 rounded-full bg-white border-4 border-slate-800 shadow-2xl flex items-center justify-center transition-all duration-500",style:{left:`${b.x}%`,top:`${b.y}%`,transform:"translate(-50%, -50%) scale(0.8)"},children:o.jsx("div",{className:"w-24 h-24 rounded-full bg-rose-600 border-4 border-white flex items-center justify-center",children:o.jsx("div",{className:"w-16 h-16 rounded-full bg-white border-4 border-rose-600 flex items-center justify-center",children:o.jsx("div",{className:"w-8 h-8 rounded-full bg-rose-600 shadow-inner"})})})}),o.jsx("div",{className:"absolute pointer-events-none transition-transform duration-75 ease-out z-20",style:{left:`${c}%`,top:`${d}%`,transform:"translate(-50%, -50%)"},children:o.jsxs("div",{className:"relative w-16 h-16 opacity-80",children:[o.jsx("div",{className:"absolute top-1/2 left-0 w-full h-0.5 bg-white shadow-sm"}),o.jsx("div",{className:"absolute left-1/2 top-0 h-full w-0.5 bg-white shadow-sm"}),o.jsx("div",{className:"absolute inset-0 border-2 border-white/50 rounded-full"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1 h-1 bg-red-500 rounded-full shadow-[0_0_10px_red]"})]})}),o.jsx("div",{className:"absolute bottom-0 right-10 w-96 h-96 pointer-events-none z-10 translate-y-10 rotate-[-10deg]",children:o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx("div",{className:"absolute bottom-0 right-20 w-8 h-80 bg-stone-800 rounded-full origin-bottom rotate-12"}),o.jsx("div",{className:"absolute bottom-20 right-24 w-0.5 h-[400px] bg-white/20 rotate-12 origin-bottom border-l border-dashed border-white/30"})]})}),o.jsxs("div",{className:"absolute top-8 left-8 text-white font-black text-2xl drop-shadow-md",children:["SCORE: ",o.jsx("span",{className:"text-amber-400",children:s})]}),o.jsx("div",{className:"absolute top-8 right-8 flex gap-2",children:[...Array(5)].map((g,p)=>o.jsx("div",{className:`text-3xl transition-opacity ${p<i?"opacity-100":"opacity-20 grayscale"}`,children:""},p))}),!a&&o.jsx("div",{className:"absolute bottom-10 left-1/2 -translate-x-1/2 text-white/70 text-sm font-bold uppercase tracking-widest animate-pulse",children:"Klikk for  skyte"}),a&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-50 animate-in fade-in run-in",children:o.jsx("h1",{className:"text-6xl font-black text-white italic uppercase tracking-tighter drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]",children:s>=100?"Mesterbueskytter!":"Ferdig!"})}),o.jsx("div",{className:"absolute inset-0 bg-stone-800 -z-10"})]})},xO=({level:t,upgrades:e=[],className:s,isMoving:n,customization:i,horseCustomization:r})=>{const a="#1e293b",l="#fbbf24",c="#94a3b8",u="#0f172a",d="#fcd34d",h=N.useMemo(()=>({chassis:(i==null?void 0:i.chassis)||"chassis_oak",wheels:(i==null?void 0:i.wheels)||(t===1?"wheels_wood":"wheels_iron"),cover:(i==null?void 0:i.cover)||"cover_canvas",lanterns:(i==null?void 0:i.lanterns)||"lantern_oil",flag:(i==null?void 0:i.flag)||"flag_none",skin:(i==null?void 0:i.skin)||"skin_ox",decor:(i==null?void 0:i.decor)||"decor_none",companion:(i==null?void 0:i.companion)||"companion_none"}),[i,t]);return o.jsxs("svg",{viewBox:"0 0 260 140",className:`${s} ${n?"animate-bounce":""}`,style:{animationDuration:"0.8s"},children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"rainbowGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#ff0000"}),o.jsx("stop",{offset:"20%",stopColor:"#ffff00"}),o.jsx("stop",{offset:"40%",stopColor:"#00ff00"}),o.jsx("stop",{offset:"60%",stopColor:"#00ffff"}),o.jsx("stop",{offset:"80%",stopColor:"#0000ff"}),o.jsx("stop",{offset:"100%",stopColor:"#ff00ff"})]}),o.jsxs("filter",{id:"glow",children:[o.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("ellipse",{cx:"130",cy:"110",rx:"100",ry:"10",fill:"rgba(0,0,0,0.15)"}),(()=>{const f=t>1,m=h.wheels==="wheels_iron"?"#475569":h.wheels==="wheels_spiked"?"#334155":"#78350f",b=h.wheels==="wheels_spiked"?"#94a3b8":"#000";return f?o.jsxs("g",{children:[o.jsxs("g",{transform:"translate(60, 95)",children:[o.jsx("circle",{r:"15",fill:m,stroke:b,strokeWidth:"2"}),o.jsx("circle",{r:"4",fill:u}),h.wheels==="wheels_spiked"&&o.jsxs(o.Fragment,{children:[o.jsx("path",{d:"M 0 -17 L 3 -14 L -3 -14 Z",fill:"#94a3b8"}),o.jsx("path",{d:"M 0 17 L 3 14 L -3 14 Z",fill:"#94a3b8",transform:"rotate(180)"}),o.jsx("path",{d:"M 17 0 L 14 3 L 14 -3 Z",fill:"#94a3b8",transform:"rotate(90)"}),o.jsx("path",{d:"M -17 0 L -14 3 L -14 -3 Z",fill:"#94a3b8",transform:"rotate(-90)"})]})]}),o.jsxs("g",{transform:"translate(140, 95)",children:[o.jsx("circle",{r:"15",fill:m,stroke:b,strokeWidth:"2"}),o.jsx("circle",{r:"4",fill:u}),h.wheels==="wheels_spiked"&&o.jsxs(o.Fragment,{children:[o.jsx("path",{d:"M 0 -17 L 3 -14 L -3 -14 Z",fill:"#94a3b8"}),o.jsx("path",{d:"M 0 17 L 3 14 L -3 14 Z",fill:"#94a3b8",transform:"rotate(180)"}),o.jsx("path",{d:"M 17 0 L 14 3 L 14 -3 Z",fill:"#94a3b8",transform:"rotate(90)"}),o.jsx("path",{d:"M -17 0 L -14 3 L -14 -3 Z",fill:"#94a3b8",transform:"rotate(-90)"})]})]})]}):o.jsxs("g",{transform:"translate(100, 100)",children:[o.jsx("circle",{r:"10",fill:m,stroke:b,strokeWidth:"1.5"}),h.wheels==="wheels_spiked"&&o.jsx("path",{d:"M 0 -12 L 2 -10 L -2 -10 Z",fill:"#94a3b8"})]})})(),(()=>{const f=h.chassis==="chassis_gold"?d:h.chassis==="chassis_iron"?"#334155":a,m=h.chassis==="chassis_gold"?"#b45309":void 0;return t===1?o.jsxs("g",{children:[o.jsx("path",{d:"M 50 85 L 150 85 L 155 70 L 45 70 Z",fill:f,stroke:m}),o.jsx("rect",{x:"55",y:"60",width:"30",height:"15",fill:c,opacity:"0.5"}),o.jsx("line",{x1:"150",y1:"80",x2:"175",y2:"80",stroke:f,strokeWidth:"4"})]}):o.jsxs("g",{children:[o.jsx("rect",{x:"40",y:"55",width:"120",height:"35",rx:"2",fill:f,stroke:m,strokeWidth:m?2:0}),(t>=4||h.chassis!=="chassis_oak")&&o.jsxs("g",{children:[o.jsx("rect",{x:"40",y:"55",width:"120",height:"4",fill:h.chassis==="chassis_gold"?"#fff":"#64748b",opacity:"0.5"}),o.jsx("rect",{x:"40",y:"86",width:"120",height:"4",fill:h.chassis==="chassis_gold"?"#fff":"#64748b",opacity:"0.5"})]}),o.jsx("line",{x1:"160",y1:"90",x2:"180",y2:"85",stroke:"#334155",strokeWidth:"3"})]})})(),h.decor==="decor_shields"&&t>1&&o.jsxs("g",{transform:"translate(45, 65)",children:[o.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"#ef4444",stroke:"#fff"}),o.jsx("circle",{cx:"30",cy:"10",r:"8",fill:"#3b82f6",stroke:"#fff"}),o.jsx("circle",{cx:"50",cy:"10",r:"8",fill:"#22c55e",stroke:"#fff"})]}),h.decor==="decor_flowers"&&t>1&&o.jsxs("g",{transform:"translate(45, 82)",children:[o.jsx("rect",{width:"110",height:"6",fill:"#78350f",rx:"2"}),o.jsx("circle",{cx:"20",cy:"-2",r:"3",fill:"#ec4899"}),o.jsx("circle",{cx:"40",cy:"-2",r:"3",fill:"#eab308"}),o.jsx("circle",{cx:"60",cy:"-2",r:"3",fill:"#a855f7"}),o.jsx("circle",{cx:"80",cy:"-2",r:"3",fill:"#ef4444"})]}),t>=3&&o.jsx("path",{d:"M 40 55 C 40 55 100 10 160 55 Z",fill:h.cover==="cover_stars"?"#1e1b4b":h.cover==="cover_silk"?"#f8fafc":h.cover==="cover_leather"?"#78350f":t>=5?"#1e1b4b":"#334155",stroke:u,strokeWidth:"1"}),h.cover==="cover_stars"&&t>=3&&o.jsxs("g",{clipPath:"url(#coverClip)",children:[o.jsx("circle",{cx:"80",cy:"40",r:"1",fill:"#fff"}),o.jsx("circle",{cx:"100",cy:"30",r:"1.5",fill:"#fff"}),o.jsx("circle",{cx:"120",cy:"45",r:"1",fill:"#fff"})]}),o.jsxs("g",{filter:"url(#glow)",children:[o.jsx("circle",{cx:t===1?140:160,cy:"45",r:h.lanterns==="lantern_fireflies"?4:3,fill:h.lanterns==="lantern_crystal"?"#3b82f6":h.lanterns==="lantern_fireflies"?"#84cc16":l}),h.lanterns==="lantern_fireflies"&&o.jsx(ee.circle,{cx:t===1?142:162,cy:"43",r:"1",fill:"#fff",animate:{opacity:[0,1,0]}}),o.jsx("rect",{x:t===1?138:158,y:"38",width:"4",height:"8",rx:"1",fill:a})]}),h.flag!=="flag_none"&&t>=2&&o.jsxs("g",{transform:"translate(160, 55)",children:[o.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-20",stroke:"#000",strokeWidth:"1"}),h.flag==="flag_pirate"?o.jsx("path",{d:"M 0 -20 L 15 -15 L 0 -10 Z",fill:"#000"}):o.jsx("path",{d:"M 0 -20 L 15 -15 L 0 -10 Z",fill:"#ef4444"})]}),h.companion==="companion_dog"&&o.jsxs("g",{transform:"translate(60, 55)",children:[o.jsx("path",{d:"M 0 0 Q 5 -10 10 0 Z",fill:"#d97706"}),o.jsx("circle",{cx:"5",cy:"-5",r:"3",fill:"#d97706"})]}),h.companion==="companion_cat"&&o.jsxs("g",{transform:`translate(100, ${t>=3?"15":"55"})`,children:[o.jsx("path",{d:"M 0 0 Q 3 -8 6 0 Z",fill:"#000"}),o.jsx("circle",{cx:"3",cy:"-4",r:"2.5",fill:"#000"}),o.jsx("path",{d:"M 3 -4 L 1 -7 M 3 -4 L 5 -7",stroke:"#000",strokeWidth:"0.5"})]}),t>=1&&o.jsx("g",{transform:"translate(160, 35) scale(0.4)",children:(()=>{let f="#8B4513",m="#1e1b4b",b="none";if(h.skin==="skin_horse_linked"&&r){const v=ob.skins.find(g=>g.id===r.skinId);v&&(f=v.color),m=r.maneColor||m,b=r.hatId||b}else if(h.skin.startsWith("skin_horse_")){const v=h.skin.replace("skin_horse_",""),g=ob.skins.find(p=>p.id===v);g?f=g.color:h.skin==="skin_horse_mech"&&(f="#94a3b8")}else return o.jsxs("g",{transform:"translate(0, 60) scale(1.5)",children:[o.jsx("path",{d:"M 0 0 Q 20 -20 40 0 L 40 40 L 0 40 Z",fill:"#78350f"}),o.jsx("path",{d:"M 40 0 Q 60 -10 65 15",stroke:"#78350f",strokeWidth:"8",fill:"none",strokeLinecap:"round"}),o.jsx("circle",{cx:"55",cy:"5",r:"10",fill:"#78350f"}),o.jsx("path",{d:"M 50 0 L 45 -10 M 60 0 L 65 -10",stroke:"#fff",strokeWidth:"2"})]});const x=m==="rainbow";return o.jsxs("g",{children:[o.jsx("path",{d:"M70,160 L70,190 L85,190 L85,150 Z",fill:f,filter:"brightness(0.7)"}),o.jsx("path",{d:"M140,160 L140,190 L155,190 L155,150 Z",fill:f,filter:"brightness(0.7)"}),o.jsx("path",{d:"M50,100 Q40,60 90,60 L140,60 Q180,60 170,110 Q160,160 120,150 L80,150 Q50,150 50,100 Z",fill:f}),o.jsx("path",{d:"M60,150 L60,195 L75,195 L75,150 Z",fill:f}),o.jsx("path",{d:"M130,150 L130,195 L145,195 L145,150 Z",fill:f}),o.jsx("path",{d:"M130,65 Q130,30 160,20 L165,25 Q185,25 185,50 L175,70 Q160,85 145,65 Z",fill:f}),o.jsx("path",{d:"M185,50 L195,55 L190,65 L175,70 Z",fill:f,filter:"brightness(0.9)"}),o.jsx("path",{d:"M160,20 Q120,20 120,80 L130,90 Q140,30 165,25 Z",fill:x?"url(#rainbowGradient)":m,className:x?"animate-pulse":""}),o.jsx("path",{d:"M50,80 Q20,80 20,140",fill:"none",stroke:x?"url(#rainbowGradient)":m,strokeWidth:"8",strokeLinecap:"round"}),o.jsx("circle",{cx:"170",cy:"40",r:"2",fill:"white"}),o.jsx("circle",{cx:"170.5",cy:"39.5",r:"0.5",fill:"black"}),b==="straw_hat"&&o.jsx("text",{x:"160",y:"25",fontSize:"40",transform:"rotate(10, 160, 25)",children:""}),b==="cowboy_hat"&&o.jsx("text",{x:"155",y:"25",fontSize:"40",transform:"rotate(-5, 155, 25)",children:""}),b==="crown"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(-10, 155, 20)",children:""}),b==="viking"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(0, 155, 20)",children:""}),b==="tophat"&&o.jsx("text",{x:"152",y:"15",fontSize:"45",transform:"rotate(-10, 155, 20)",children:""})]})})()}),e.includes("heavy_axles")&&o.jsx("g",{stroke:l,strokeWidth:"1",opacity:"0.6",children:o.jsx("line",{x1:"60",y1:"95",x2:"140",y2:"95"})})]})},XZ=({onComplete:t,targetRegionId:e,caravanLevel:s,upgrades:n=[],initialDurability:i=100,maxDurability:r=100,customization:a,horseCustomization:l})=>{var k,w;const c=N.useRef(null),[u,d]=N.useState(0),[h,f]=N.useState(!1),[m,b]=N.useState(i),[x,v]=N.useState(!1),g=N.useRef({distance:0,speed:0,isJumping:!1,jumpHeight:0,obstacles:[],lastObstacleTime:0,shake:0,penaltyTimer:0,durability:i,isBroken:!1,hasFinished:!1}),p=N.useRef([{speed:.15,height:280,color:"#0f172a",amplitude:60,freq:.002},{speed:.4,height:200,color:"#1e293b",amplitude:40,freq:.005},{speed:.9,height:120,color:"#334155",amplitude:30,freq:.012}]);N.useEffect(()=>{const S=_=>{_.code==="Space"&&!g.current.isJumping&&!h&&!g.current.isBroken&&(g.current.isJumping=!0,g.current.jumpHeight=12)};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[h]),N.useEffect(()=>{const S=c.current;if(!S)return;const _=S.getContext("2d");if(!_)return;let T,E=0;const A=1e4,j=n.includes("heavy_axles"),O=n.includes("guard_post"),H=n.includes("silk_chests"),G=1+s*.1+(j?.15:0),L=M=>{E||(E=M);const D=M-E;E=M;const I=g.current;if(!h&&!I.isBroken){let C=G;I.penaltyTimer>0&&(C*=H?.6:.3,I.penaltyTimer-=D),I.speed=C,I.distance+=D*I.speed;const $=Math.min(1,I.distance/A);if(d($),$>=1&&!I.hasFinished&&(I.hasFinished=!0,f(!0),setTimeout(()=>t(!0,{durability:I.durability}),3e3)),I.isJumping&&(I.jumpHeight-=.45,I.jumpHeight<0&&I.jumpHeight>-10||I.jumpHeight<=-10&&(I.isJumping=!1,I.jumpHeight=0)),I.shake>0&&(I.shake*=.9),M-I.lastObstacleTime>2e3+Math.random()*3e3){const V=Math.random();let P="ROCK";V>.8&&!O?P="BANDIT":V>.5&&(P="MUD"),(P!=="BANDIT"||!O)&&(I.obstacles.push({x:S.width+100,typ:P}),I.lastObstacleTime=M)}for(let V=I.obstacles.length-1;V>=0;V--){const P=I.obstacles[V];P.x-=D*I.speed*.8;const W=S.width*.15;if(P.x<W+200-50&&P.x>W+50){let Y=!1;P.typ==="BANDIT"?(Y=!0,I.penaltyTimer=1e3,I.shake=20,I.durability=Math.max(0,I.durability-25)):(P.typ==="ROCK"||P.typ==="MUD")&&!I.isJumping&&(Y=!0,I.penaltyTimer=800,I.shake=10,I.durability=Math.max(0,I.durability-10)),Y&&(I.obstacles.splice(V,1),b(I.durability),v(!0),setTimeout(()=>v(!1),200),I.durability<=0&&(I.isBroken=!0,setTimeout(()=>t(!1,{durability:0}),3e3)))}P.x<-200&&I.obstacles.splice(V,1)}}const F=(Math.random()-.5)*I.shake,U=(Math.random()-.5)*I.shake;_.clearRect(0,0,S.width,S.height),_.save(),_.translate(F,U);const R=_.createLinearGradient(0,0,0,S.height);R.addColorStop(0,"#020617"),R.addColorStop(1,"#1e293b"),_.fillStyle=R,_.fillRect(0,0,S.width,S.height),_.fillStyle="rgba(255,255,255,0.2)";for(let C=0;C<50;C++){const $=C*137%S.width,V=C*79%(S.height*.6);_.fillRect($,V,1,1)}if(p.current.forEach(C=>{_.fillStyle=C.color,_.beginPath(),_.moveTo(0,S.height);for(let $=0;$<=S.width+10;$+=10){const V=$+I.distance*C.speed,P=S.height-C.height+Math.sin(V*C.freq)*C.amplitude+Math.cos(V*C.freq*.5)*(C.amplitude*.5);_.lineTo($,P)}_.lineTo(S.width,S.height),_.fill()}),_.fillStyle="#020617",_.fillRect(0,S.height-60,S.width,60),I.obstacles.forEach(C=>{const $=S.height-60;C.typ==="ROCK"?(_.fillStyle="#64748b",_.beginPath(),_.arc(C.x,$-15,20,0,Math.PI*2),_.fill()):C.typ==="BANDIT"?(_.fillStyle="#e11d48",_.fillRect(C.x,$-60,30,60),_.fillStyle="#fff",_.fillRect(C.x+5,$-50,5,5),_.fillRect(C.x+15,$-50,5,5)):C.typ==="MUD"&&(_.fillStyle="#78350f",_.beginPath(),_.ellipse(C.x,$-5,40,10,0,0,Math.PI*2),_.fill())}),!h&&!I.isBroken){_.strokeStyle=`rgba(255,255,255,${I.speed>G*.5?.05:.01})`,_.lineWidth=1;for(let C=0;C<10;C++){const $=(I.distance*2+C*150)%S.width,V=S.height-30+C*5%20;_.beginPath(),_.moveTo($,V),_.lineTo($+40,V),_.stroke()}}_.restore(),T=requestAnimationFrame(L)};return T=requestAnimationFrame(L),()=>cancelAnimationFrame(T)},[h,t,s,n]);const y=e==="capital"?"Hovedstaden":e==="region_vest"?"Vestfjella":"stlandet";return o.jsxs("div",{className:"fixed inset-0 z-[200] bg-slate-950 flex flex-col items-center justify-center overflow-hidden",children:[o.jsxs("div",{className:"relative w-full max-w-5xl h-[500px] border border-slate-800 rounded-[3rem] overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.8)]",children:[o.jsx("canvas",{ref:c,width:1200,height:500,className:"w-full h-full object-cover"}),x&&o.jsx("div",{className:"absolute inset-0 bg-rose-500/30 animate-pulse pointer-events-none"}),o.jsxs("div",{className:"absolute left-[15%] bottom-[70px] w-48 transition-transform duration-100 ease-out",style:{transform:`translateY(${-Math.max(0,(((k=g.current)==null?void 0:k.jumpHeight)||0)*12)}px) rotate(${(w=g.current)!=null&&w.isJumping?-5:0}deg)`},children:[o.jsx(xO,{level:s,upgrades:n,customization:a,horseCustomization:l,isMoving:!h&&!g.current.isBroken,className:"w-full drop-shadow-[0_15px_25px_rgba(0,0,0,0.8)]"}),!h&&!g.current.isBroken&&o.jsx("div",{className:"absolute top-1/2 right-0 w-8 h-8 bg-amber-400/20 blur-xl animate-pulse rounded-full"}),g.current.isBroken&&o.jsx("div",{className:"absolute top-0 right-1/2 w-12 h-24 bg-gray-500/50 blur-xl animate-pulse -translate-y-full"})]}),o.jsx("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 text-slate-500 font-bold uppercase text-xs tracking-widest animate-pulse opacity-50",children:"Trykk [MELLOMROM] for  hoppe"}),o.jsxs("div",{className:"absolute top-12 left-1/2 -translate-x-1/2 w-full max-w-md px-12 z-10",children:[o.jsxs("div",{className:"flex justify-between items-end mb-2",children:[o.jsxs("div",{className:"text-left",children:[o.jsx("h2",{className:"text-white font-black uppercase italic tracking-tighter text-3xl",children:"Mitt-Europa"}),o.jsxs("p",{className:"text-slate-500 font-bold uppercase text-[9px] tracking-widest leading-none",children:["Vegen mot ",y]})]}),o.jsx("div",{className:"text-right flex flex-col items-end",children:o.jsxs("span",{className:"text-amber-400 font-black italic text-xl",children:[Math.floor(u*100),"%"]})})]}),o.jsx("div",{className:"h-1 w-full bg-slate-800/50 rounded-full overflow-hidden backdrop-blur-md mb-4",children:o.jsx(ee.div,{initial:{width:0},animate:{width:`${u*100}%`},className:"h-full bg-gradient-to-r from-amber-600 to-amber-400"})}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-[10px] font-bold uppercase text-slate-400 w-12 text-right",children:"Helse"}),o.jsx("div",{className:"flex-1 h-3 bg-slate-900 border border-slate-700 rounded-sm overflow-hidden relative",children:o.jsx(ee.div,{className:`h-full ${m<r*.3?"bg-rose-500":"bg-emerald-500"}`,animate:{width:`${m/r*100}%`}})}),o.jsxs("span",{className:`text-[10px] font-bold ${m<r*.3?"text-rose-500":"text-emerald-500"}`,children:[Math.round(m)," / ",r]})]})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none shadow-[inset_0_0_100px_rgba(0,0,0,0.8)]"})]}),h&&o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center bg-slate-950/90 backdrop-blur-2xl",children:o.jsxs("div",{className:"text-center space-y-6",children:[o.jsx(ee.div,{initial:{scale:.5,rotate:-20},animate:{scale:1,rotate:0},className:"text-8xl",children:""}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-6xl font-black text-white italic uppercase tracking-tighter",children:"Ankomst"}),o.jsx("p",{className:"text-amber-400 font-black uppercase tracking-[0.5em] text-sm",children:y})]}),o.jsx("div",{className:"h-px w-24 bg-slate-800 mx-auto"}),o.jsx("p",{className:"text-slate-500 font-bold uppercase text-xs tracking-widest",children:"Handelsruten er etablert"})]})}),g.current.isBroken&&o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 flex items-center justify-center bg-rose-950/90 backdrop-blur-2xl",children:o.jsxs("div",{className:"text-center space-y-6",children:[o.jsx(ee.div,{initial:{scale:.5,rotate:20},animate:{scale:1,rotate:0},className:"text-8xl",children:""}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-6xl font-black text-rose-500 italic uppercase tracking-tighter",children:"HAVARI"}),o.jsx("p",{className:"text-rose-200 font-black uppercase tracking-[0.5em] text-sm",children:"Vognen er delagt"})]}),o.jsx("div",{className:"h-px w-24 bg-rose-800 mx-auto"}),o.jsx("p",{className:"text-rose-300 font-bold uppercase text-xs tracking-widest",children:"Reisen avbrutt  Reparer vognen"})]})})]})},jl={WORK:[{id:"sickle",label:"Sigd",icon:"",desc:"Presisjons-hsting for hy kvalitet."},{id:"sweep",label:"Lj",icon:"",desc:"Rask innhsting av store omrder."}],CHOP:[{id:"axe",label:"ks",icon:"",desc:"Fell trr med r makt."}],FORAGE:[{id:"gather",label:"Sanking",icon:"",desc:"Let etter mat og urter i skogen."},{id:"traps",label:"Snarefangst",icon:"",desc:"Sett feller for smvilt."}],MINE:[{id:"pickaxe",label:"Hakke",icon:"",desc:"Hugg ut malm fra fjellet."}],QUARRY:[{id:"chisel",label:"Meisel",icon:"",desc:"Hugg ut steinblokker."}],CRAFT:[{id:"hammer",label:"Smiing",icon:"",desc:"Form metallet p ambolten."}],BAKE:[{id:"oven",label:"Steking",icon:"",desc:"Stek brd i ovnen."}],WEAVE:[{id:"loom",label:"Veving",icon:"",desc:"Vev trd til stoffer."}],MIX:[{id:"brew",label:"Brygging",icon:"",desc:"Bland urter til medisiner."}],SMELT:[{id:"furnace",label:"Smelting",icon:"",desc:"Smelt malm til barrer."}],PLANT:[{id:"manual",label:"Hndsing",icon:"",desc:"S fr for hnd."}],HUNT:[{id:"bow",label:"Bueskyting",icon:"",desc:"Presisjonsjakt fra avstand."},{id:"trap",label:"Fellefangst",icon:"",desc:"Sett ut snarer for smvilt."}],SAWMILL:[{id:"saw",label:"Saging",icon:"",desc:"Sag opp tmmer til planker."}],GATHER_WOOL:[{id:"shears",label:"Saks",icon:"",desc:"Klipp ullen av sauene."}]},QZ=({item:t})=>{const e=t.durability/t.maxDurability*100;return o.jsx("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-[110] animate-in slide-in-from-bottom-4 fade-in duration-500",children:o.jsxs("div",{className:"bg-slate-900/90 border border-white/10 rounded-full px-6 py-3 flex items-center gap-4 backdrop-blur-md shadow-2xl",children:[o.jsx("div",{className:"text-3xl drop-shadow-[0_0_10px_rgba(255,255,255,0.2)]",children:t.icon}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:t.name}),o.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-slate-300",children:[o.jsx("div",{className:`w-2 h-2 rounded-full ${e>20?"bg-emerald-500":"bg-rose-500"} animate-pulse`}),o.jsx("span",{children:"Slitasje"}),o.jsxs("span",{children:[Math.round(e),"%"]})]})]})]})})},JZ=({type:t,onComplete:e,onCancel:s,equipment:n,skills:i,playerUpgrades:r,currentSeason:a="Spring",currentWeather:l="Clear",totalTicks:c=0,selectedMethod:u,action:d,player:h})=>{var w,S,_;const[f,m]=Se.useState(u||null);Se.useEffect(()=>{const T=jl[t];T&&T.length===1&&!f&&m(T[0].id)},[t,f]);const b=Se.useMemo(()=>mR(t,n||[]),[t,n]),x=Se.useMemo(()=>{var A,j;const T=Nn[a],E=Vi[l];return{speedMultiplier:((E==null?void 0:E.speedMod)||1)*(((A=b==null?void 0:b.stats)==null?void 0:A.speedBonus)||1),staminaCostMod:((T==null?void 0:T.staminaMod)||1)*((E==null?void 0:E.staminaMod)||1),yieldMod:(((j=b==null?void 0:b.stats)==null?void 0:j.yieldBonus)||0)+((T==null?void 0:T.yieldMod)||1)}},[a,l,b]),v=Se.useMemo(()=>{var H,G;const T={skills:i||{},equipment:{}};n&&n.forEach(L=>{const M=L.slot||L.type;L&&M&&(T.equipment[M]=L)});let E=10,A="FARMING",j=t;switch(t){case"MINE":E=re.YIELD.MINE_ORE,A="MINING";break;case"QUARRY":E=re.YIELD.QUARRY_STONE,A="MINING";break;case"CHOP":E=re.YIELD.CHOP_WOOD,a==="Summer"&&(E+=re.YIELD.SUMMER_WOOD_BONUS),A="WOODCUTTING";break;case"WORK":case"HARVEST":E=re.YIELD.WORK_GRAIN,r!=null&&r.includes("iron_plow")&&(E+=re.YIELD.PLOW_BONUS),A="FARMING";break;case"FORAGE":E=re.YIELD.FORAGE_BREAD,A="FARMING";break}const O={season:((H=Nn[a])==null?void 0:H.yieldMod)||1,weather:((G=Vi[l])==null?void 0:G.yieldMod)||1,actionType:j,upgrades:1};try{const L=vi(T,E,A,O);return console.log(`[MinigameOverlay] Yield Calc. Type: ${t}, Base: ${E}. Result: ${L}. Equipment:`,T.equipment),isNaN(L)?1.5:L}catch(L){return console.error("Yield Calc Error:",L),1.5}},[t,i,n,r,a,l]),g=Se.useMemo(()=>{let T=10;switch(t){case"MINE":T=re.YIELD.MINE_ORE;break;case"QUARRY":T=re.YIELD.QUARRY_STONE;break;case"CHOP":T=re.YIELD.CHOP_WOOD;break;case"WORK":case"HARVEST":T=re.YIELD.WORK_GRAIN;break;case"FORAGE":T=re.YIELD.FORAGE_BREAD;break}return v<=2||v<T*.4},[v,t]),p=T=>{m(T)},[y,k]=Se.useState(!1);return g&&!y&&(t==="MINE"||t==="QUARRY"||t==="CHOP"||t==="WORK"||t==="HARVEST"||t==="FORAGE")&&f?o.jsx("div",{className:"fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in zoom-in duration-300",children:o.jsxs("div",{className:"bg-slate-900 border-2 border-rose-500 rounded-3xl p-8 max-w-md w-full text-center shadow-[0_0_50px_rgba(244,63,94,0.3)]",children:[o.jsx("div",{className:"text-6xl mb-6",children:""}),o.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter mb-4",children:"Manglende Verkty!"}),o.jsxs("p",{className:"text-slate-300 font-medium mb-8 leading-relaxed",children:["Du forsker  utfre ",o.jsx("span",{className:"text-rose-400 font-bold",children:t})," uten riktig verkty. Effektiviteten din er redusert med 80%."]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("button",{onClick:()=>k(!0),className:"w-full py-4 bg-rose-600 hover:bg-rose-500 text-white rounded-xl font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all",children:"Fortsett likevel"}),o.jsx("button",{onClick:s,className:"w-full py-4 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white rounded-xl font-bold uppercase tracking-widest transition-all",children:"Avbryt"})]})]})}):!f&&jl[t]?o.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/80 backdrop-blur-md animate-in fade-in duration-300",children:o.jsxs("div",{className:"max-w-4xl w-full p-8",children:[o.jsx("h2",{className:"text-4xl font-black text-white text-center mb-12 uppercase tracking-tighter drop-shadow-lg",children:"Velg Metode"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:jl[t].map(T=>o.jsxs("button",{onClick:()=>p(T.id),className:"group relative bg-slate-900 border-2 border-slate-700 hover:border-indigo-500 rounded-3xl p-8 transition-all hover:-translate-y-2 hover:shadow-[0_0_50px_rgba(79,70,229,0.3)] text-left overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-500/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center gap-6",children:[o.jsx("div",{className:"text-6xl group-hover:scale-110 transition-transform duration-300",children:T.icon}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-black text-white mb-2 uppercase tracking-wide group-hover:text-indigo-400 transition-colors",children:T.label}),o.jsx("p",{className:"text-slate-400 font-medium leading-relaxed",children:T.desc})]}),o.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 w-full",children:(()=>{const E=dO(t,a,l,c);return E?o.jsx("div",{className:"flex items-center justify-center gap-2 text-sm font-bold text-slate-500",children:o.jsx("span",{children:E})}):null})()})]})]},T.id))}),o.jsx("button",{onClick:s,className:"mt-12 mx-auto block text-slate-500 font-bold hover:text-white transition-colors uppercase tracking-widest text-sm",children:"Avbryt"})]})}):o.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/90 backdrop-blur-xl animate-in fade-in duration-300",children:[o.jsx("div",{className:"absolute top-8 right-8 z-[110]",children:o.jsx("button",{onClick:s,className:"bg-black/40 hover:bg-rose-500/20 text-white/50 hover:text-rose-400 w-12 h-12 rounded-full flex items-center justify-center transition-all",children:""})}),o.jsx("div",{className:"absolute top-8 left-8 z-[110] flex gap-4",children:o.jsxs("div",{className:"bg-black/40 backdrop-blur-md px-4 py-2 rounded-2xl border border-white/5 flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",title:((w=Nn[a])==null?void 0:w.label)||a,children:a==="Winter"?"":a==="Summer"?"":a==="Autumn"?"":""}),o.jsx("span",{className:"text-2xl",title:((S=Vi[l])==null?void 0:S.label)||l,children:(_=Vi[l])==null?void 0:_.icon}),o.jsx("div",{className:"h-4 w-[1px] bg-white/10 mx-2"}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-500 tracking-wider",children:"Forhold"}),o.jsxs("span",{className:`text-xs font-bold ${x.speedMultiplier<1?"text-rose-400":"text-emerald-400"}`,children:[Math.round(x.speedMultiplier*100),"% Hastighet"]})]})]})}),o.jsxs("div",{className:"w-full max-w-5xl bg-slate-900 rounded-[3rem] shadow-2xl relative overflow-hidden border border-white/5",children:[(()=>{var T,E,A,j,O,H;switch(t){case"PLANT":return o.jsx(DZ,{onComplete:e});case"HARVEST":case"WORK":return f==="sweep"||f==="scythe"?o.jsx(mT,{onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier}):o.jsx(hl,{onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier,possibleYield:v});case"CHOP":return o.jsx(BZ,{onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier,possibleYield:v});case"SAWMILL":return o.jsx(HZ,{onComplete:e,speedMultiplier:x.speedMultiplier});case"FORAGE":return f==="traps"?o.jsx(pT,{onComplete:e,speedMultiplier:x.speedMultiplier,variant:"land"}):o.jsx(hl,{isForaging:!0,onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier,resourceName:"Mat/Urter",possibleYield:v});case"MINE":return o.jsx(hl,{isMining:!0,onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier,resourceName:"Malm",possibleYield:v});case"QUARRY":return o.jsx(hl,{isQuarrying:!0,onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier,resourceName:"Stein",possibleYield:v});case"CRAFT":case"REPAIR":return o.jsx(LZ,{onComplete:e,speedMultiplier:x.speedMultiplier});case"SMELT":return o.jsx(KZ,{onComplete:e,speedMultiplier:x.speedMultiplier});case"BAKE":const G=d!=null&&d.subType?((T=qe[d.subType])==null?void 0:T.icon)||"":((E=Ge[d==null?void 0:d.recipeId])==null?void 0:E.icon)||"";return o.jsx(PZ,{onComplete:e,speedMultiplier:x.speedMultiplier,icon:G});case"WEAVE":return o.jsx(UZ,{onComplete:e,speedMultiplier:x.speedMultiplier});case"MIX":return o.jsx($Z,{onComplete:e,speedMultiplier:x.speedMultiplier});case"GATHER_WOOL":return o.jsx(mT,{onComplete:e,equipment:n,speedMultiplier:x.speedMultiplier});case"MOUNT_HORSE":return o.jsx(YZ,{onComplete:e,speedMultiplier:x.speedMultiplier,levelId:f||"ride_easy",level:(d==null?void 0:d.level)||1,horse:h==null?void 0:h.horseCustomization});case"HUNT":return f==="bow"?o.jsx(xT,{onComplete:e,speedMultiplier:x.speedMultiplier}):f==="trap"?o.jsx(pT,{onComplete:e,speedMultiplier:x.speedMultiplier,variant:"land"}):o.jsx(xT,{onComplete:e,speedMultiplier:x.speedMultiplier});case"TRAVEL_START":const L=((A=h==null?void 0:h.caravan)==null?void 0:A.level)||1,D=(re.CARAVAN.LEVELS.find(I=>I.level===L)||re.CARAVAN.LEVELS[0]).durability;return o.jsx(XZ,{onComplete:(I,F)=>e(I?1:0,F),targetRegionId:(d==null?void 0:d.targetRegionId)||"capital",caravanLevel:L,upgrades:((j=h==null?void 0:h.caravan)==null?void 0:j.upgrades)||[],initialDurability:((O=h==null?void 0:h.caravan)==null?void 0:O.durability)||D,maxDurability:D,customization:(H=h==null?void 0:h.caravan)==null?void 0:H.customization,horseCustomization:h==null?void 0:h.horseCustomization});default:return o.jsxs("div",{className:"p-12 text-center",children:[o.jsxs("h2",{className:"text-2xl font-bold text-white mb-4",children:["Ukjent Minispill: ",t]}),o.jsx("button",{onClick:()=>e(.5),className:"px-6 py-3 bg-indigo-600 rounded-xl font-bold text-white",children:"Fullfr (Skip)"})]})}})(),b&&o.jsx(QZ,{item:b})]})]})},ZZ=({isOpen:t,onClose:e,onConfirm:s,roleId:n,cost:i})=>{const[r,a]=N.useState(!1);if(N.useEffect(()=>{a(!!t)},[t]),!t)return null;const l=n==="MERCHANT",c=l?{modalBg:"bg-[#050810]",borderColor:"border-amber-500/20",glowColor:"bg-amber-500",shadowColor:"shadow-[0_0_200px_rgba(245,158,11,0.15)]",iconBg:"bg-gradient-to-br from-amber-400/20 to-amber-900/40",iconBorder:"border-amber-500/30",iconColor:"text-amber-400",titleColor:"text-amber-100",accentText:"text-amber-400",mutedText:"text-amber-100/50",cardBg:"bg-white/5 hover:bg-white/10",cardBorder:"border-white/5 hover:border-amber-500/30",buttonPrimary:"bg-amber-400 hover:bg-amber-300 text-black border-amber-300 shadow-[0_0_30px_rgba(245,158,11,0.4)] hover:shadow-[0_0_50px_rgba(245,158,11,0.6)]",buttonSecondary:"bg-transparent text-amber-100/40 hover:text-amber-100 hover:bg-white/5 border-transparent hover:border-white/10",icon:aO}:{modalBg:"bg-[#0F0505]",borderColor:"border-red-500/20",glowColor:"bg-red-600",shadowColor:"shadow-[0_0_150px_rgba(220,38,38,0.2)]",iconBg:"bg-red-900/20",iconBorder:"border-red-500/30",iconColor:"text-red-500",titleColor:"text-red-100",accentText:"text-red-500",mutedText:"text-red-200/50",cardBg:"bg-red-950/20",cardBorder:"border-red-500/10",buttonPrimary:"bg-red-600/10 hover:bg-red-600 text-red-500 hover:text-white border-red-600/30",buttonSecondary:"bg-transparent text-slate-500 hover:text-slate-300 border-transparent",icon:gd},u=c.icon;return o.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 perspective-[1000px]",children:[o.jsx("div",{className:`absolute inset-0 bg-black/80 backdrop-blur-2xl transition-opacity duration-700 ${t?"opacity-100":"opacity-0"}`,onClick:e,children:o.jsx("div",{className:`absolute inset-0 opacity-20 bg-radial-gradient from-${l?"amber":"red"}-900/20 to-transparent`})}),o.jsxs("div",{className:`relative z-10 w-full ${l?"max-w-3xl":"max-w-lg"} 
                ${c.modalBg} border ${c.borderColor} rounded-[3rem] ${c.shadowColor} 
                overflow-hidden flex flex-col transition-all duration-700 ease-out transform
                ${r?"scale-100 translate-y-0 opacity-100 rotate-x-0":"scale-90 translate-y-10 opacity-0 rotate-x-12"}
                `,children:[o.jsx("div",{className:"absolute -top-1/2 -left-1/2 w-[200%] h-[200%] bg-gradient-to-b from-white/5 to-transparent rotate-45 pointer-events-none opacity-20"}),o.jsx("div",{className:`absolute -top-64 left-1/2 -translate-x-1/2 w-[800px] h-[600px] ${c.glowColor} opacity-10 blur-[150px] rounded-full pointer-events-none`}),o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-30 pointer-events-none",children:[o.jsx("div",{className:"absolute top-20 left-20 w-1 h-1 bg-white rounded-full animate-pulse"}),o.jsx("div",{className:"absolute top-40 right-40 w-1.5 h-1.5 bg-white rounded-full animate-pulse delay-700"}),o.jsx("div",{className:"absolute bottom-20 left-1/3 w-1 h-1 bg-white rounded-full animate-pulse delay-300"})]}),o.jsxs("div",{className:`p-12 relative flex flex-col items-center text-center ${l?"gap-10":"gap-6"}`,children:[o.jsx("button",{onClick:e,className:"absolute top-8 right-8 group p-2 rounded-full transition-all hover:bg-white/5",children:o.jsx(Yn,{size:24,className:`${c.mutedText} group-hover:text-white transition-colors`})}),o.jsxs("div",{className:"relative group",children:[l&&o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 border border-amber-500/20 rounded-full animate-[spin_10s_linear_infinite]"}),o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 ${c.glowColor} blur-[60px] opacity-40 group-hover:opacity-60 transition-opacity duration-1000`}),o.jsxs("div",{className:`relative w-28 h-28 mx-auto rounded-[2.5rem] ${c.iconBg} ${c.iconBorder} border flex items-center justify-center shadow-2xl backdrop-blur-sm z-10 transition-transform duration-500 group-hover:scale-105 group-hover:-translate-y-1`,children:[o.jsx(u,{size:64,className:`${c.iconColor} drop-shadow-[0_0_20px_rgba(251,191,36,0.5)]`}),o.jsx("div",{className:"absolute inset-0 rounded-[2.5rem] bg-gradient-to-tr from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"})]})]}),o.jsxs("div",{className:"space-y-4 max-w-lg mx-auto z-10",children:[o.jsxs("div",{className:"flex items-center justify-center gap-3 opacity-80",children:[o.jsx("div",{className:`h-px w-12 ${c.glowColor} opacity-50`}),o.jsx("h4",{className:`text-xs font-bold uppercase tracking-[0.4em] ${c.accentText}`,children:"Ny Karrierevei"}),o.jsx("div",{className:`h-px w-12 ${c.glowColor} opacity-50`})]}),o.jsx("h2",{className:`text-6xl font-black uppercase tracking-tighter italic drop-shadow-2xl ${c.titleColor}`,children:l?"Kjpmann":"Soldat"})]}),l?o.jsxs("div",{className:"w-full max-w-2xl space-y-8 animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-150",children:[o.jsx("p",{className:"text-xl text-slate-300 font-light leading-relaxed max-w-lg mx-auto italic",children:'"Som kjpmann beveger du ikke bare varer, du beveger verden. Gull er blodet som strmmer gjennom rikets rer."'}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(i0,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Fltestyring"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Bygg og oppgrader din egen karavaneflte. Velg mellom raske kjerrer eller tunge vogner med enorm lastekapasitet."})]})]})}),o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(nO,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Global Handel"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Kryss landegrenser og utnytt dype prisforskjeller mellom regionene. Kjp billig i st, selg dyrt i vest."})]})]})}),o.jsx("div",{className:`relative overflow-hidden p-5 rounded-3xl border ${c.cardBorder} ${c.cardBg} transition-all duration-300 group/card text-left flex flex-col h-full`,children:o.jsxs("div",{className:"relative z-10 space-y-4",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 group-hover/card:scale-110 transition-transform",children:o.jsx(zm,{size:20})}),o.jsxs("div",{children:[o.jsx("h5",{className:"font-black text-white text-sm uppercase tracking-wider",children:"Markedsmakt"}),o.jsx("div",{className:"h-0.5 w-6 bg-amber-500/50 my-2"}),o.jsx("p",{className:"text-xs text-slate-400 leading-relaxed",children:"Invester i landsbyens konomi, ls opp passiv inntekt gjennom luksusvarer og dominer de lokale markedene."})]})]})})]}),o.jsx("div",{className:"bg-amber-500/5 border border-amber-500/10 p-4 rounded-2xl",children:o.jsxs("p",{className:"text-xs text-amber-200/70 font-medium",children:[o.jsx(sa,{size:12,className:"inline mr-2 mb-0.5"}),"Som Kjpmann lser du opp en helt ny dimensjon av spillet fokusert p logistikk, risiko og massiv profitt."]})})]}):o.jsxs("div",{className:"bg-red-950/20 border border-red-500/20 p-8 rounded-[2rem] max-w-md mx-auto",children:[o.jsx(u1,{size:48,className:"text-red-500 mx-auto mb-4"}),o.jsx("p",{className:"text-red-200 font-medium",children:"Denne rollen er under utvikling. Forvent ubalanse og manglende funksjoner."})]}),o.jsxs("div",{className:"flex flex-col items-center gap-6 w-full pt-4 animate-in fade-in slide-in-from-bottom-4 duration-1000 delay-300",children:[o.jsxs("div",{className:`flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em] opacity-60 ${c.accentText}`,children:[o.jsx(gd,{size:12}),o.jsx("span",{children:"Dette valget er permanent"})]}),o.jsxs("div",{className:"flex items-center gap-4 w-full justify-center",children:[o.jsx("button",{onClick:e,className:`px-8 py-4 rounded-2xl font-bold tracking-widest uppercase text-xs transition-all ${c.buttonSecondary}`,children:"Avbryt"}),o.jsxs("button",{onClick:s,className:`group relative px-10 py-5 rounded-2xl font-black tracking-widest uppercase text-sm border-2 transition-all hover:scale-[1.02] active:scale-[0.98] flex items-center gap-4 ${c.buttonPrimary}`,children:[o.jsx("div",{className:"absolute inset-0 bg-white/20 blur-xl opacity-0 group-hover:opacity-50 transition-opacity"}),o.jsx("span",{className:"relative z-10",children:l?"Signer Kontrakt":"Jeg forstr"}),i&&l&&o.jsx("div",{className:"relative z-10 flex items-center gap-2 bg-black/20 backdrop-blur-md px-3 py-1.5 rounded-lg border border-black/10",children:o.jsx("span",{className:"text-xs font-mono font-bold text-amber-900",children:i})}),l&&o.jsx(sa,{size:16,className:"relative z-10 animate-pulse text-amber-900"})]})]})]})]})]})]})},eee=({poi:t,player:e,room:s,viewingRegionId:n,onAction:i,onClose:r})=>{var E,A,j,O,H,G;const a=N.useRef(null),l=n==="region_ost"&&t.ost?t.ost.top:t.top,c=n==="region_ost"&&t.ost?t.ost.left:t.left,[u,d]=N.useState({x:"3rem",y:"-50%"}),[h,f]=N.useState(!1),[m,b]=N.useState({isOpen:!1,action:null}),x=((E=s.world)==null?void 0:E.season)||"Spring",v=((A=s.world)==null?void 0:A.weather)||"Clear",g=N.useMemo(()=>{var C,$,V;const L=t.id in Fs?t.id:t.parentId,M=Fs[L],I=((V=($=(((C=s.world)==null?void 0:C.settlement)||{}).buildings)==null?void 0:$[L])==null?void 0:V.level)||1;let F=[];if(M)for(let P=1;P<=I;P++)M.levels[P]&&(F=[...F,...M.levels[P].unlocks]);const U=t.actions.filter(P=>{if(P.id==="TAX_PEASANTS"&&e.role!=="BARON"||P.id==="TAX_ROYAL"&&e.role!=="KING"||P.id==="DECREE"&&e.role!=="KING"||P.id==="RAID"&&e.role!=="BARON"||P.id==="FEAST"&&e.role!=="KING"&&e.role!=="BARON"||P.id==="JOIN_ROLE"&&e.role===P.targetRole)return!1;const W=["OPEN_CRAFTING","CRAFT","REFINE","MARKET_VIEW","OPEN_GARRISON","OPEN_TAVERN_MENU","OPEN_WEAPON_RACK","OPEN_DICE_GAME","OPEN_RESOURCE_GAME"];return!(M&&!P.id.startsWith("BUILDING_UPGRADE_")&&!W.includes(P.id)&&!F.includes(P.id))});return["windmill_stones","sawmill_blade","smeltery_furnace","bakery_oven","weavery_loom","forge_anvil"].includes(t.id)?U.filter(P=>P.id==="OPEN_CRAFTING"||P.id==="REFINE"||P.id==="CRAFT"||P.id.startsWith("REFINE_")||P.id.startsWith("CRAFT_")||P.id in Sn).slice(0,1):U},[t,e.role,(j=s.world)==null?void 0:j.settlement]);N.useLayoutEffect(()=>{if(!a.current)return;const L=a.current.getBoundingClientRect(),M=a.current.offsetParent;if(!M){f(!0);return}const D=M.getBoundingClientRect(),I=parseFloat(c),F=parseFloat(l),U=I<50?"3rem":"calc(-100% - 3rem)",R=F/100*D.height-L.height/2,C=R+L.height;let $="-50%";R<20?$=`calc(-50% + ${20-R}px)`:C>D.height-20&&($=`calc(-50% - ${C-(D.height-20)}px)`),d({x:U,y:$}),f(!0)},[l,c,g.length]);const p=L=>{var R,C,$;const M=[],D=Pb(e,L);if(D.forEach(V=>{var P,W,J;(P=V.stats)!=null&&P.speedBonus&&V.stats.speedBonus!==1&&M.push({source:V.name,type:"Fart",value:`+${Math.round((V.stats.speedBonus-1)*100)}%`,icon:V.icon,isBonus:!0}),(W=V.stats)!=null&&W.yieldBonus&&M.push({source:V.name,type:"Utbytte",value:`+${V.stats.yieldBonus}`,icon:V.icon,isBonus:!0}),(J=V.stats)!=null&&J.luckBonus&&M.push({source:V.name,type:"Flaks",value:`+${Math.round(V.stats.luckBonus*100)}%`,icon:V.icon,isBonus:!0})}),e.upgrades){const V=T_[e.role]||[];e.upgrades.forEach(P=>{const W=V.find(J=>J.id===P);W&&(W.benefit==="YIELD_GRAIN"&&(L==="WORK"||L==="MILL")&&M.push({source:W.name,type:"Utbytte",value:"+5",icon:"",isBonus:!0}),W.benefit==="RAID_SPEED"&&L==="RAID"&&M.push({source:W.name,type:"Fart",value:"Raskere",icon:"",isBonus:!0}))})}const I=t.id==="tavern"||t.id==="bakery"||t.id==="great_forge"||t.id==="weavery"||t.id==="sawmill"||t.id==="windmill"||t.id==="smeltery"?t.id:t.parentId,U=(($=(C=(((R=s.world)==null?void 0:R.settlement)||{}).buildings)==null?void 0:C[I])==null?void 0:$.level)||1;if(U>=2&&M.push({source:"Bygningsbonus (Lvl 2)",type:"Utbytte",value:"+10% XP",icon:"",isBonus:!0}),U>=3&&M.push({source:"Bygningsbonus (Lvl 3)",type:"Utbytte",value:"Master Tier",icon:"",isBonus:!0}),jl[L]){const V=jl[L][0];V.id==="manual"||V.id==="gather"||D.some(J=>{var Y;return((Y=J.type)==null?void 0:Y.toLowerCase().includes(V.id.toLowerCase()))||J.id.toLowerCase().includes(V.id.toLowerCase())})||M.push({source:"System",type:"ADVARSEL",value:`Du mangler ${V.label}, utbytte redusert med 80%`,icon:"",isBonus:!1})}return M},y=N.useMemo(()=>{var L;return(L=e.activeProcesses)==null?void 0:L.find(M=>!(M.locationId!==t.id||M.type==="COOP"||M.type==="WELL"&&M.readyAt<=Date.now()))},[e.activeProcesses,t.id]),k=()=>{if(!y)return 0;const L=Date.now();return Math.max(0,y.readyAt-L)},[w,S]=N.useState(k());N.useEffect(()=>{if(!y)return;const L=setInterval(()=>{const M=k();S(M),M<=0&&clearInterval(L)},1e3);return()=>clearInterval(L)},[y]);const _=L=>{const M=Math.floor(L/6e4),D=Math.floor(L%6e4/1e3);return`${M}m ${D}s`},T=o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"absolute inset-0 z-[90]",onClick:r}),o.jsx("div",{ref:a,style:{top:l,left:c,transform:`translate(${u.x}, ${u.y})`,visibility:h?"visible":"hidden",opacity:h?1:0},className:`absolute z-[100] ${h?"animate-in fade-in zoom-in":""} duration-200 pointer-events-auto`,children:o.jsxs("div",{className:"bg-slate-900/90 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] p-6 shadow-[0_40px_100px_rgba(0,0,0,0.8)] min-w-[320px] w-max max-w-[400px] relative transition-all duration-500 overflow-hidden group/tooltip",children:[o.jsx("div",{className:"absolute -top-24 -left-24 w-48 h-48 bg-indigo-500/10 blur-[80px] pointer-events-none group-hover/tooltip:bg-indigo-500/20 transition-all duration-1000"}),o.jsxs("div",{className:"flex items-center justify-between mb-6 relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"w-14 h-14 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-3xl shadow-inner relative overflow-hidden group/icon",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 group-hover/icon:opacity-100 transition-opacity"}),t.icon]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h3",{className:"font-display font-black text-white text-xl uppercase tracking-tighter leading-none",children:t.label}),o.jsx("span",{className:"text-xs font-black text-indigo-400 uppercase tracking-[.2em] mt-1 opacity-90",children:"Landemerke"})]})]}),o.jsx("div",{className:"flex items-center gap-3",children:o.jsx("button",{onClick:r,className:"text-white/60 hover:text-white transition-all bg-white/10 hover:bg-white/20 rounded-full w-10 h-10 flex items-center justify-center border border-white/10 hover:border-white/30 active:scale-90",children:""})})]}),o.jsxs("div",{className:"space-y-3",children:[y?o.jsx("div",{className:"w-full relative py-4",children:w<=0?o.jsxs("div",{className:"relative group/harvest",children:[o.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl blur opacity-25 group-hover/harvest:opacity-50 transition duration-1000 group-hover:duration-200"}),o.jsxs("button",{onClick:()=>i({type:"HARVEST",locationId:t.id}),disabled:e.status.stamina<On(15,x,v),className:`w-full relative px-6 py-8 border rounded-3xl flex items-center justify-between overflow-hidden active:scale-[0.98] transition-all
                                                ${e.status.stamina<On(15,x,v)?"bg-red-900/20 border-red-500/30 cursor-not-allowed grayscale opacity-80":"bg-slate-900 border-emerald-500/50 hover:bg-emerald-950/30"}`,children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/10 blur-3xl -mr-16 -mt-16"}),o.jsxs("div",{className:"flex flex-col items-start z-10",children:[o.jsx("span",{className:`text-2xl font-black uppercase tracking-tighter italic ${e.status.stamina<On(15,x,v)?"text-slate-500":"text-white"}`,children:(O=t.label)!=null&&O.toLowerCase().includes("lin")?"Linhsting":t.id==="grain_fields"?"Kornhsting":"Innhsting"}),o.jsx("span",{className:`text-xs font-black uppercase tracking-[0.2em] mt-1 ${e.status.stamina<On(15,x,v)?"text-red-400":"text-emerald-400"}`,children:e.status.stamina<On(15,x,v)?`Mangler energi (${Math.ceil(e.status.stamina)}/${On(15,x,v).toFixed(0)})`:"Klar til  hentes!"})]}),o.jsx("div",{className:`w-14 h-14 rounded-2xl flex items-center justify-center text-3xl shadow-[0_0_20px_rgba(16,185,129,0.3)] ${e.status.stamina<On(15,x,v)?"bg-slate-800 text-slate-600":"bg-emerald-500/20 animate-bounce"}`,children:e.status.stamina<On(15,x,v)?o.jsx(Db,{size:24,className:"text-red-500"}):""})]})]}):o.jsxs("div",{className:"p-8 bg-white/5 border border-white/10 rounded-[2rem] flex flex-col items-center gap-6 relative overflow-hidden group/timer",children:[o.jsx("div",{className:"absolute -bottom-12 -right-12 w-24 h-24 bg-indigo-500/5 blur-2xl rounded-full"}),o.jsxs("div",{className:"relative w-24 h-24",children:[o.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 36 36",children:[o.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-white/5",strokeWidth:"2"}),o.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-emerald-500 transition-all duration-1000 ease-linear",strokeWidth:"2",strokeDasharray:"100",strokeDashoffset:100-(1-w/y.duration)*100,strokeLinecap:"round"})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("span",{className:"text-3xl animate-pulse",children:y.type==="MILL"?"":y.type==="WELL"?"":""})})]}),o.jsxs("div",{className:"flex flex-col items-center gap-1",children:[o.jsx("span",{className:"text-sm font-black text-slate-400 uppercase tracking-widest leading-none",children:y.type==="WELL"?"Brnnen fyller seg med vann":"Venter p produksjon"}),o.jsx("span",{className:"text-2xl font-mono font-black text-white",children:_(w)})]}),o.jsx("div",{className:"w-full h-1 bg-white/5 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-emerald-500 transition-all duration-1000 ease-linear",style:{width:`${(1-w/y.duration)*100}%`}})})]})}):o.jsx("div",{className:"space-y-6",children:g.map(L=>{var V,P,W,J;const M=((V=s.world)==null?void 0:V.season)||"Spring",D=((P=s.world)==null?void 0:P.weather)||"Clear",I=p(L.id);let F=!0,U="";const R=["CRAFT","REFINE","OPEN_CRAFTING","BAKE","SMELT","MILL","WEAVE","MIX","OPEN_CHICKEN_COOP","OPEN_DICE_GAME","MARKET_VIEW","OPEN_GARRISON","OPEN_WEAPON_RACK"];if(n!==e.regionId&&e.role!=="KING"&&L.id!=="MARKET_VIEW")F=!1,U="Dette er ikke ditt baroni";else if(!R.includes(L.id)){const Y=uO(e,L.id,M,D,((W=s.world)==null?void 0:W.gameTick)||0);Y.success||(F=!1,U=Y.reason||"Krav ikke mtt")}const C=dO(L.id,M,D,((J=s.world)==null?void 0:J.gameTick)||0),$=jl[L.id];return o.jsxs("div",{className:"w-full animate-in fade-in slide-in-from-bottom-2 duration-500",children:[o.jsxs("div",{className:"flex items-center justify-between px-1 mb-3",children:[o.jsx("h4",{className:"text-xs font-black text-slate-300 uppercase tracking-[0.3em]",children:L.label}),C&&o.jsx("span",{className:"text-xs font-black text-indigo-400 uppercase tracking-widest",children:C})]}),$?o.jsx("div",{className:"grid grid-cols-1 gap-4",children:$.map(Y=>{const he=Pb(e,L.id),fe=he.find(ne=>{var Le;return((Le=ne.type)==null?void 0:Le.toLowerCase().includes(Y.id.toLowerCase()))||ne.id.toLowerCase().includes(Y.id.toLowerCase())})||he[0],ce=fe?fe.durability/fe.maxDurability*100:null;return o.jsxs("button",{onClick:()=>i({type:L.id,method:Y.id,locationId:t.id}),disabled:!F,className:`group relative flex items-center gap-6 w-full p-5 rounded-[2rem] border transition-all duration-300 ${F?"bg-white/5 border-white/10 hover:border-indigo-500/50 hover:bg-indigo-500/5 active:scale-[0.98]":"bg-black/20 border-white/5 cursor-not-allowed"}`,children:[o.jsx("div",{className:`w-16 h-16 rounded-2xl bg-white/5 flex-shrink-0 flex items-center justify-center text-4xl group-hover:scale-110 transition-transform duration-500 ${!F&&"opacity-40"}`,children:Y.icon}),o.jsxs("div",{className:"flex-1 flex flex-col justify-center min-w-0 items-start",children:[o.jsx("span",{className:"font-display font-black text-white text-xl uppercase tracking-tighter group-hover:text-indigo-400 transition-colors truncate",children:Y.label}),F?o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.jsx("span",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest truncate opacity-60",children:Y.desc}),I.length>0&&o.jsx("div",{className:"flex gap-1.5",children:I.filter(ne=>!ne.isBonus||ne.value.includes("+")).slice(0,1).map((ne,Le)=>o.jsx("span",{className:"text-[10px] text-emerald-400 font-black px-2 py-0.5 bg-emerald-400/10 rounded-full",children:ne.value},Le))})]}):o.jsx("span",{className:"text-xs font-black text-rose-500 uppercase tracking-widest mt-0.5",children:U})]}),o.jsxs("div",{className:"flex flex-col items-end gap-3 ml-2",children:[ce!==null&&F&&o.jsx("div",{className:"w-10 h-1.5 bg-white/10 rounded-full overflow-hidden shadow-inner",children:o.jsx("div",{className:`h-full transition-all duration-1000 ${ce>50?"bg-indigo-500 shadow-[0_0_8px_rgba(99,102,241,0.5)]":ce>20?"bg-amber-500":"bg-rose-500"}`,style:{width:`${ce}%`}})}),o.jsx(io,{size:22,className:`transition-all ${F?"text-white/20 group-hover:text-indigo-400 group-hover:translate-x-1":"text-white/5"}`})]})]},Y.id)})}):o.jsx("button",{onClick:()=>{L.id==="JOIN_ROLE"?b({isOpen:!0,action:{...L,type:L.id,locationId:t.id}}):i({...L,type:L.id,locationId:t.id})},disabled:!F,className:`w-full group relative overflow-hidden p-5 rounded-3xl border transition-all duration-300 ${F?"bg-white/5 border-white/10 hover:border-indigo-500/50 hover:bg-indigo-500/5 active:scale-[0.98]":"bg-black/20 border-white/5 opacity-50 cursor-not-allowed"}`,children:o.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[o.jsxs("div",{className:"flex flex-col items-start",children:[o.jsx("span",{className:"text-xl font-black text-white group-hover:text-indigo-400 transition-colors uppercase tracking-tight",children:L.label}),!F&&o.jsx("span",{className:"text-sm font-black text-rose-500 uppercase tracking-widest mt-1",children:U})]}),o.jsx(io,{size:20,className:"text-white/20 group-hover:text-indigo-400 group-hover:translate-x-1 transition-all"})]})})]},L.id)})}),(()=>{var U,R,C,$,V;const L=g.map(P=>P.id),M=Object.values(e.equipment||{}),F=Object.values(qe).filter(P=>{var W;return(W=P.relevantActions)==null?void 0:W.some(J=>L.includes(J))}).map(P=>{if(M.find(J=>J.id===P.id||J.id.startsWith(P.id+"_"))){const J=P.nextTierId;return J?qe[J]:null}else return P.level===1?P:null}).filter(Boolean).filter((P,W,J)=>J.findIndex(Y=>(Y==null?void 0:Y.id)===(P==null?void 0:P.id))===W).sort((P,W)=>{if(!P||!W)return 0;const J=P.type==="MAIN_HAND"||P.type==="AXE"||P.type==="PICKAXE"||P.type==="SCYTHE"||P.type==="BOW"||P.type==="CHISEL"?1:0;return(W.type==="MAIN_HAND"||W.type==="AXE"||W.type==="PICKAXE"||W.type==="SCYTHE"||W.type==="BOW"||W.type==="CHISEL"?1:0)-J});if(F.length>0){const P=F[0];if(!P)return null;const W=Object.values(Sn).find(lt=>lt.outputItemId===P.id),J=((U=s.world)==null?void 0:U.settlement)||{buildings:{}},Y=(W==null?void 0:W.buildingId)||"great_forge",he=((C=(R=J.buildings)==null?void 0:R[Y])==null?void 0:C.level)||1,fe=(W==null?void 0:W.level)||1,ce=he<fe,ne=(($=Fs[Y])==null?void 0:$.name)||"Smien",Le=M.find(lt=>{var ke;if(!lt)return!1;const se=Object.keys(qe).find(we=>lt.id===we||lt.id.startsWith(we+"_")),le=se?qe[se]:null;return(ke=le==null?void 0:le.relevantActions)==null?void 0:ke.some(we=>L.includes(we))});return o.jsx("div",{className:"mt-8 pt-8 border-t border-white/5 relative z-10",children:o.jsxs("div",{className:"flex flex-col gap-4",children:[o.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[o.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent flex-1"}),o.jsx("span",{className:`text-xs font-black uppercase tracking-[0.2em] ${ce?"text-slate-400":"text-amber-500 animate-pulse"}`,children:ce?`Krever niv ${fe}`:"Utvikling venter"}),o.jsx("div",{className:"h-px bg-gradient-to-r from-transparent via-amber-500 to-transparent flex-1"})]}),o.jsxs("div",{className:"flex items-center justify-between gap-6 px-4",children:[o.jsxs("div",{className:"flex flex-col items-center gap-2 group/evolve",children:[o.jsx("div",{className:"w-16 h-16 rounded-[1.5rem] bg-white/5 border border-white/10 flex items-center justify-center text-3xl opacity-40 transition-all group-hover/evolve:opacity-60",children:(Le==null?void 0:Le.icon)||""}),o.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"N"})]}),o.jsxs("div",{className:"flex flex-col items-center flex-1 gap-2 pt-2",children:[o.jsxs("div",{className:"relative w-full flex justify-center",children:[o.jsx("div",{className:"absolute top-1/2 left-0 w-full h-px bg-gradient-to-r from-indigo-500/0 via-indigo-500/30 to-indigo-500/0"}),o.jsx(io,{className:"text-indigo-500/50 w-6 h-6 animate-pulse relative z-10"})]}),((V=P.stats)==null?void 0:V.yieldBonus)&&o.jsxs("span",{className:"text-[10px] font-black text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded-full border border-emerald-400/20",children:["+",P.stats.yieldBonus," Utbytte"]})]}),o.jsxs("div",{className:"flex flex-col items-center gap-2 group/next",children:[o.jsx("div",{className:`w-20 h-20 rounded-[2rem] flex items-center justify-center text-4xl border-2 shadow-2xl transition-all duration-500 ${ce?"bg-slate-900/50 border-white/5 grayscale":"bg-indigo-600/20 border-indigo-500/50 shadow-indigo-500/20 hover:scale-110 active:scale-95"}`,children:P.icon}),o.jsx("span",{className:`text-xs font-black uppercase tracking-tight ${ce?"text-slate-500":"text-amber-500"}`,children:P.name})]})]}),o.jsx("p",{className:"text-xs text-slate-400 text-center font-medium italic px-6 mt-2",children:ce?`Forbedre ${ne} til niv ${fe} for  lse opp.`:`Besk ${ne} i landsbyen for  smi din ${P.name}.`})]})})}return null})()]})]})})]});return o.jsxs(o.Fragment,{children:[T,o.jsx(ZZ,{isOpen:m.isOpen,onClose:()=>b({isOpen:!1,action:null}),onConfirm:()=>{m.action&&i(m.action),b({isOpen:!1,action:null})},roleId:((H=m.action)==null?void 0:H.targetRole)||"",cost:(G=m.action)==null?void 0:G.cost})]})},tee=({weather:t,season:e,hideClouds:s,isInterior:n})=>{const i=N.useMemo(()=>Array.from({length:12}).map((d,h)=>({id:h,top:`${Math.random()*100}%`,delay:Math.random()*60,duration:40+Math.random()*60,scale:.5+Math.random()*1.5,opacity:.1+Math.random()*.3})),[]),r=N.useMemo(()=>Array.from({length:10}).map((d,h)=>({id:h,left:`${Math.random()*100}%`,delay:Math.random()*20,duration:10+Math.random()*20,size:5+Math.random()*10,rotation:Math.random()*360,drift:50+Math.random()*150})),[]),a=N.useMemo(()=>Array.from({length:5}).map((d,h)=>({id:h,left:`${10+Math.random()*80}%`,top:`${-10+Math.random()*40}%`,rotation:h*45+Math.random()*20,delay:h*2})),[]),l=()=>e==="Autumn"?"":e==="Spring"?"":e==="Winter"?"":"",u=100*(t==="Storm"?2.5:t==="Rain"?1.5:1);return o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-[5]",children:[t==="Clear"&&!n&&o.jsx("div",{className:"absolute inset-0 opacity-40",children:a.map(d=>o.jsx("div",{className:"absolute w-[400px] h-[800px] animate-sunbeam",style:{left:d.left,top:d.top,background:"radial-gradient(ellipse at top, rgba(253, 224, 71, 0.15) 0%, transparent 70%)",transform:`rotate(${d.rotation}deg)`,animationDelay:`${d.delay}s`}},d.id))}),!s&&!n&&o.jsx("div",{className:"absolute inset-0",children:i.map(d=>o.jsx("div",{className:"absolute text-white animate-cloud-drift select-none",style:{top:d.top,fontSize:`${d.scale*4}rem`,opacity:t==="Storm"?d.opacity*2:d.opacity,filter:"blur(8px)",animationDuration:`${t==="Storm"?d.duration/2:d.duration}s`,animationDelay:`-${d.delay}s`,color:t==="Storm"?"#475569":"white"},children:""},d.id))}),t==="Fog"&&!n&&o.jsx("div",{className:"absolute inset-0 bg-slate-400/10 backdrop-blur-[2px] animate-mist"}),!n&&o.jsx("div",{className:"absolute inset-0",children:r.map(d=>o.jsx("div",{className:"absolute animate-particle opacity-0",style:{left:d.left,fontSize:`${d.size}px`,animationDuration:`${d.duration}s`,animationDelay:`${d.delay}s`,filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.1))","--wind-drift":`${u+d.drift}px`,"--wind-rotation":`${720+d.rotation}deg`},children:l()},d.id))}),(t==="Clear"||n)&&o.jsx("div",{className:"absolute inset-0",children:Array.from({length:15}).map((d,h)=>o.jsx("div",{className:"absolute w-1 h-1 bg-white/40 rounded-full animate-dust-float",style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`,animationDuration:`${6+Math.random()*8}s`,animationDelay:`${Math.random()*10}s`,filter:"blur(1px)"}},`dust-${h}`))}),(t==="Rain"||t==="Storm")&&!n&&o.jsx("div",{className:"absolute inset-0 bg-indigo-900/10 mix-blend-overlay"})]})},see=({player:t,room:e})=>{const[s,n]=N.useState(Date.now()),{handleAction:i}=gO(e==null?void 0:e.pin,t,(e==null?void 0:e.world)||null,()=>{},()=>{},()=>{},null),[r,a]=N.useState({});N.useEffect(()=>{const m=setInterval(()=>{var x;const b=Date.now();if(n(b),Math.random()<.05){const v=((x=t.activeProcesses)==null?void 0:x.filter(g=>g.type==="CROP"&&g.readyAt>b))||[];if(v.length>0){const g=v[Math.floor(Math.random()*v.length)];if(!r[g.id]){const p=Math.random()>.5?"CROW":"WEED";a(y=>({...y,[g.id]:{type:p,expiresAt:b+1e4}}))}}}a(v=>{const g={...v};let p=!1;return Object.entries(g).forEach(([y,k])=>{k.expiresAt<b&&(delete g[y],p=!0)}),p?g:v})},1e3);return()=>clearInterval(m)},[t.activeProcesses,r]);const l=N.useCallback((m,b)=>{a(x=>{const v={...x};return delete v[m],v}),i({type:"MAINTAIN_CROP",processId:m,subType:b})},[i]),c=t.activeProcesses||[],u=s,d=c.filter(m=>!(!(m.type==="CROP"||m.type==="COOP"||m.type==="MILL"||m.type==="WELL"||m.type==="CRAFT")||m.type==="WELL"&&m.readyAt>0&&u>m.readyAt+1e4)),h=(t.activeBuffs||[]).filter(m=>m.expiresAt>u);if(d.length===0&&h.length===0)return null;d.sort((m,b)=>m.readyAt-b.readyAt);const f=m=>{const b=Math.floor(m/6e4),x=Math.floor(m%6e4/1e3);return`${b}m ${x}s`};return o.jsxs("div",{className:"absolute top-6 right-6 z-[60] flex flex-col gap-2 pointer-events-none items-end",children:[h.map(m=>{const b=Math.max(0,m.expiresAt-u);return o.jsxs("div",{className:"group bg-indigo-900/90 backdrop-blur-md border border-indigo-500/30 rounded-xl p-3 shadow-xl pointer-events-auto flex items-center gap-4 transition-all hover:bg-indigo-900/100 hover:scale-105 animate-in slide-in-from-right-4 duration-300 relative",children:[o.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center border bg-indigo-500/20 border-indigo-500 text-indigo-300",children:o.jsx("span",{className:"text-xl",children:""})}),o.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[o.jsx("span",{className:"text-xs font-bold text-indigo-300 uppercase tracking-wider",children:m.label}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:"text-sm font-black text-white",children:f(b)})})]}),m.description&&o.jsx("div",{className:"absolute right-full top-1/2 -translate-y-1/2 mr-3 w-48 bg-slate-900/95 border border-indigo-500/30 p-3 rounded-xl shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none translate-x-2 group-hover:translate-x-0",children:o.jsx("p",{className:"text-[10px] text-indigo-100 leading-tight",children:m.description})})]},m.id)}),d.map(m=>{const b=Math.max(0,m.readyAt-u),x=b<=0;let v="Avling Gror",g=o.jsx(Ib,{size:20}),p="Innhsting Klar!";const y=Ge[m.itemId];if(m.type==="COOP")v="Hner Spiser",g=o.jsx("span",{className:"text-xl",children:""}),p="Egg klare!";else if(m.type==="MILL")v="Kverner korn",g=o.jsx("span",{className:"text-xl",children:""}),p="Mel klart!";else if(m.type==="WELL")v="Brnnen fyller seg",g=o.jsx("span",{className:"text-xl",children:""}),p="Brnnen er klar!";else if(m.type==="CRAFT"){const S=ga[m.itemId],_=qe[m.itemId];S?(g=o.jsx("span",{className:"text-xl",children:S.icon||""}),v=S.label?`Lager ${S.label}...`:"Hndverk pgr...",p=S.label?`${S.label} klar!`:"Hndverk ferdig!"):_?(g=o.jsx("span",{className:"text-xl",children:_.icon||""}),v=`Lager ${_.name}...`,p=`${_.name} ferdig!`):(g=o.jsx("span",{className:"text-xl",children:""}),v="Hndverk pgr...",p="Hndverk ferdig!")}else y?(g=o.jsx("span",{className:"text-xl",children:y.icon}),v=`${y.label} gror`,p=`${y.label} klar!`):g=x?o.jsx(Rc,{size:20}):o.jsx(Ib,{size:20});const k=r[m.id],w=!!k&&!x;return o.jsxs("div",{className:`relative bg-slate-900/90 backdrop-blur-md border rounded-xl p-3 shadow-xl pointer-events-auto flex items-center gap-4 transition-all hover:bg-slate-900/95 animate-in slide-in-from-right-4 duration-300 ${m.type==="WELL"&&x?"animate-pulse":""} ${w?"border-rose-500/50 hover:border-rose-400 cursor-pointer group":"border-white/10"}`,onClick:w?()=>l(m.id,k.type):void 0,children:[w&&o.jsx("div",{className:"absolute -top-3 -right-3 z-50 animate-bounce",children:o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shadow-lg border-2 border-white ${k.type==="CROW"?"bg-slate-800":"bg-emerald-700"}`,children:o.jsx("span",{className:"text-lg",children:k.type==="CROW"?"":""})})}),m.yieldBonus&&m.yieldBonus>0&&o.jsxs("div",{className:"absolute -bottom-2 -right-2 px-2 py-0.5 bg-emerald-600 text-white text-[10px] font-black rounded-full shadow-lg border border-emerald-400 z-10",children:["+",Math.round(m.yieldBonus*100),"%"]}),o.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center border ${x?"bg-emerald-500/20 border-emerald-500 text-emerald-400 animate-pulse":"bg-slate-800 border-white/10 text-slate-400"}`,children:g}),o.jsxs("div",{className:"flex flex-col min-w-[120px]",children:[o.jsx("span",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:x?p:w?k.type==="CROW"?"Fjern Krke!":"Luk ugress!":v}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:`text-sm font-black ${x?"text-emerald-400":w?"text-rose-400":"text-white"}`,children:x?"Hent n":f(b)})})]})]},m.id)})]})},zn=({title:t,subtitle:e,icon:s,headerRight:n,children:i,onClose:r,className:a,maxWidth:l,hideHeader:c=!1,noPadding:u=!1})=>(N.useEffect(()=>{const d=h=>{h.key==="Escape"&&r()};return window.addEventListener("keydown",d),()=>window.removeEventListener("keydown",d)},[r]),o.jsxs("div",{className:"absolute inset-0 z-40 flex items-center justify-center p-4 md:p-8",children:[o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:r,className:"absolute inset-0 bg-black/20 backdrop-blur-[1px] cursor-pointer"}),o.jsxs(ee.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:260,damping:25,mass:1},className:`relative w-full ${l||"max-w-5xl"} max-h-full bg-slate-950/90 backdrop-blur-md border border-white/10 rounded-3xl shadow-2xl overflow-hidden flex flex-col pointer-events-auto will-change-transform`,children:[!c&&o.jsxs("div",{className:"flex-none flex justify-between items-center px-6 py-4 border-b border-white/10 bg-gradient-to-r from-white/5 to-transparent min-h-[72px]",children:[o.jsxs("div",{className:"flex items-center gap-5 overflow-hidden",children:[s&&o.jsx("div",{className:"w-12 h-12 bg-white/5 rounded-2xl flex items-center justify-center text-3xl shadow-inner border border-white/5 shrink-0",children:s}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[t&&o.jsx("h2",{className:"text-xl font-display font-black text-white tracking-tighter uppercase truncate",children:t}),e&&o.jsx("div",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest truncate opacity-80",children:e})]}),n&&o.jsx("div",{className:"hidden sm:flex items-center pl-4 border-l border-white/10 ml-2",children:n})]}),o.jsx("button",{onClick:r,className:"w-8 h-8 bg-white/5 hover:bg-rose-500/20 text-slate-400 hover:text-rose-500 rounded-full flex items-center justify-center transition-all group",title:"Lukk vindu",children:o.jsx("span",{className:"text-lg group-hover:rotate-90 transition-transform",children:""})})]}),o.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar ${u?"":"p-6"} ${a||""}`,children:i})]})]})),nee=({children:t,variant:e="primary",size:s="md",icon:n,className:i="",...r})=>{const a="relative inline-flex items-center justify-center font-bold tracking-wide transition-all duration-200 uppercase rounded shadow-lg active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",l={primary:"bg-blue-600 hover:bg-blue-500 text-white border-b-4 border-blue-800 hover:border-blue-700",secondary:"bg-game-stone hover:bg-gray-500 text-white border-b-4 border-gray-700",danger:"bg-game-danger hover:bg-red-500 text-white border-b-4 border-red-700",wood:"bg-game-wood hover:bg-amber-800 text-game-paper border-2 border-game-wood_light shadow-inner",ghost:"bg-transparent hover:bg-white/10 text-white shadow-none"},c={sm:"px-3 py-1 text-xs",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"},u=h=>{e==="primary"||e==="danger"?Tt(async()=>{const{audioManager:f}=await Promise.resolve().then(()=>El);return{audioManager:f}},void 0).then(({audioManager:f})=>f.playSfx("confirm")):Tt(async()=>{const{audioManager:f}=await Promise.resolve().then(()=>El);return{audioManager:f}},void 0).then(({audioManager:f})=>f.playSfx("ui_click")),r.onClick&&r.onClick(h)},d=h=>{Tt(async()=>{const{audioManager:f}=await Promise.resolve().then(()=>El);return{audioManager:f}},void 0).then(({audioManager:f})=>f.playSfx("ui_hover")),r.onMouseEnter&&r.onMouseEnter(h)};return o.jsxs("button",{className:`${a} ${l[e]} ${c[s]} ${i}`,onClick:u,onMouseEnter:d,...r,children:[n&&o.jsx("span",{className:"mr-2",children:n}),t]})},iee=({player:t,room:e,onAction:s,onClose:n})=>{var S,_,T,E;const i=t.role==="KING",r=(t.regionId||"").trim().toLowerCase(),a=t.regionId||"Riket";if(!e||!e.world)return null;const{world:l,regions:c}=e,u=i?null:c==null?void 0:c[t.regionId||""],d=i?l.lastRoyalTaxCollection:u==null?void 0:u.lastTaxCollection,h=d&&d.year===l.year&&d.season===l.season,f=i?l.royalTaxHistory||[]:(u==null?void 0:u.taxHistory)||[],[m,b]=N.useState(i?((_=(S=e.world)==null?void 0:S.taxRateDetails)==null?void 0:_.kingTax)||20:((E=(T=e.regions)==null?void 0:T[t.regionId||""])==null?void 0:E.taxRate)||10),[x,v]=N.useState("ADJUST"),[g,p]=N.useState(!1),{estimates:y,citizenList:k}=Se.useMemo(()=>{let A=0,j=0,O=[];const H=m/100;return Object.values(e.players||{}).forEach(L=>{var I,F,U,R,C;if(!L||L.id===t.id)return;const M=(L.regionId||"").trim().toLowerCase();if(i?L.role==="BARON":L.role==="PEASANT"&&(M===r||M.includes(r))){const $=Number(((I=L.resources)==null?void 0:I.gold)??L.gold??L.wealth??((F=L.stats)==null?void 0:F.gold)??((R=(U=L.inventory)==null?void 0:U.find(P=>P.id==="gold"))==null?void 0:R.amount)??0),V=Number(((C=L.resources)==null?void 0:C.grain)??0);A+=$*H,j+=V*H,O.push({id:L.id,name:L.name,gold:$,grain:V,role:L.role,hasResources:!!L.resources,raw:L})}}),{estimates:{gold:Math.floor(A),grain:Math.floor(j),count:O.length,penalty:Math.max(0,Math.floor((m-10)/1.5))},citizenList:O.sort((L,M)=>M.gold-L.gold)}},[m,e.players,i,r,t.id]),w=()=>{s({type:i?"TAX_ROYAL":"TAX",taxRate:m}),n()};return o.jsx(zn,{title:i?"STATSKASSEN":`SKATT: ${a.toUpperCase()}`,icon:o.jsx(aO,{size:18,className:"text-game-gold"}),onClose:n,children:o.jsxs("div",{className:`p-4 sm:p-6 lg:p-10 flex flex-col gap-8 w-full ${i?"max-w-6xl":"max-w-3xl"} mx-auto transition-all ${h?"grayscale-[0.5] opacity-90":""}`,children:[o.jsxs("nav",{className:"flex bg-slate-900/80 backdrop-blur-md border border-white/5 rounded-2xl p-1.5 max-w-sm mx-auto w-full shadow-2xl relative z-20",children:[o.jsxs("button",{onClick:()=>v("ADJUST"),className:`flex-1 flex items-center justify-center gap-2 py-3 text-[10px] font-black uppercase tracking-widest transition-all rounded-xl ${x==="ADJUST"?"bg-white text-black shadow-xl scale-[1.02]":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:[o.jsx(zm,{size:14})," Justering"]}),o.jsxs("button",{onClick:()=>v("HISTORY"),className:`flex-1 flex items-center justify-center gap-2 py-3 text-[10px] font-black uppercase tracking-widest transition-all rounded-xl ${x==="HISTORY"?"bg-white text-black shadow-xl scale-[1.02]":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:[o.jsx(Hm,{size:14})," Historikk"]})]}),x==="ADJUST"?o.jsxs("div",{className:`grid grid-cols-1 ${i?"lg:grid-cols-12":"gap-6"} items-start animate-in fade-in zoom-in-95 duration-700`,children:[o.jsxs("div",{className:i?"lg:col-span-4 space-y-6":"space-y-6",children:[o.jsxs("div",{className:"bg-gradient-to-br from-slate-900 via-slate-950 to-black border border-white/10 rounded-[3rem] p-8 lg:p-10 shadow-[0_30px_60px_-15px_rgba(0,0,0,0.7)] relative overflow-hidden group",children:[o.jsx("div",{className:"absolute -top-12 -right-12 w-48 h-48 bg-game-gold/5 blur-[80px] rounded-full group-hover:bg-game-gold/10 transition-colors"}),o.jsxs("div",{className:"flex justify-between items-start mb-10 relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-12 h-12 rounded-2xl bg-game-gold/10 flex items-center justify-center text-game-gold border border-game-gold/20",children:o.jsx(Mb,{size:24})}),o.jsxs("div",{children:[o.jsx("span",{className:"text-[10px] font-black text-game-gold/60 uppercase tracking-[0.3em] block mb-1",children:"Innkrevingsniv"}),o.jsxs("div",{className:"flex items-baseline gap-3",children:[o.jsxs("h2",{className:"text-7xl font-black text-white italic tracking-tighter leading-none",children:[m,"%"]}),o.jsx("div",{className:`px-2.5 py-1 rounded-full border text-[9px] font-black uppercase tracking-widest shadow-lg ${y.penalty>15?"bg-red-500/10 border-red-500/20 text-red-500":"bg-emerald-500/10 border-emerald-500/20 text-emerald-500"}`,children:y.penalty===0?"Optimalt":`-${y.penalty} Lojalitet`})]})]})]}),i&&o.jsx("button",{onClick:()=>p(!g),className:"p-2.5 hover:bg-white/5 rounded-full transition-all group/info",children:o.jsx(eO,{size:18,className:g?"text-game-gold":"text-slate-700 group-hover/info:text-slate-400"})})]}),o.jsxs("div",{className:"relative h-20 flex items-center mb-6 relative z-10 px-2",children:[o.jsx("div",{className:"absolute h-2 w-full bg-slate-800/50 rounded-full"}),o.jsx("div",{className:"absolute h-2 bg-gradient-to-r from-game-gold via-orange-500 to-red-600 rounded-full shadow-[0_0_30px_rgba(251,191,36,0.5)]",style:{width:`${m/50*100}%`}}),o.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:m,onChange:A=>b(parseInt(A.target.value)),disabled:h,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-30"}),o.jsx("div",{className:"absolute w-12 h-12 bg-white border-[6px] border-game-gold rounded-full shadow-[0_10px_30px_rgba(0,0,0,0.6)] transition-all pointer-events-none flex items-center justify-center scale-110",style:{left:`calc(${m/50*100}% - 24px)`},children:o.jsx("div",{className:"w-2.5 h-2.5 bg-game-gold rounded-full"})})]}),o.jsxs("div",{className:"flex justify-between text-[11px] font-black uppercase tracking-[0.25em] px-2",children:[o.jsx("span",{className:"text-slate-600",children:"Sknsel"}),o.jsx("span",{className:"text-slate-400",children:"Rettferd"}),o.jsx("span",{className:"text-red-900/80 shadow-red-500/10",children:"Tyranni"})]})]}),o.jsxs("div",{className:`grid ${i?"grid-cols-1":"grid-cols-1 sm:grid-cols-3"} gap-4`,children:[o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-900 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-game-gold/10 text-game-gold rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(l1,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:"Gull"}),o.jsxs("p",{className:"text-2xl font-black text-white italic tracking-tighter truncate leading-none mt-1",children:[y.gold,"g"]})]})]}),o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-900 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-orange-500/10 text-orange-400 rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(zm,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:"Korn"}),o.jsx("p",{className:"text-2xl font-black text-white italic tracking-tighter truncate leading-none mt-1",children:y.grain})]})]}),o.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-sm border border-white/5 p-5 rounded-3xl flex items-center gap-4 transition-all hover:bg-slate-800 hover:border-white/10 group min-h-[90px]",children:[o.jsx("div",{className:"p-3 bg-indigo-500/10 text-indigo-400 rounded-2xl group-hover:scale-110 transition-transform shadow-inner",children:o.jsx(Gn,{size:22})}),o.jsxs("div",{className:"min-w-0",children:[o.jsx("p",{className:"text-[9px] text-slate-500 font-black uppercase tracking-widest truncate",children:i?"Baroner":"Borgere"}),o.jsx("p",{className:"text-2xl font-black text-white italic tracking-tighter leading-none mt-1",children:y.count})]})]})]}),o.jsx(nee,{variant:h?"ghost":"primary",onClick:w,disabled:h||m===0||y.count===0,className:"w-full py-8 text-2xl font-black italic uppercase rounded-[2.5rem] shadow-[0_20px_40px_-10px_rgba(37,99,235,0.4)] hover:shadow-[0_25px_50px_-10px_rgba(37,99,235,0.6)] active:scale-95 transition-all h-24",children:h?"Du har skattlagt, vent til neste rstid":"EKSEKVER SKATT"})]}),i&&o.jsx("div",{className:"lg:col-span-8 h-full",children:o.jsxs("div",{className:"bg-slate-900/40 backdrop-blur-xl border border-white/5 rounded-[3.5rem] overflow-hidden flex flex-col shadow-inner h-full min-h-[600px]",children:[o.jsxs("div",{className:"px-10 py-6 border-b border-white/5 flex justify-between items-center bg-black/40",children:[o.jsx("h4",{className:"text-[12px] font-black text-slate-400 uppercase tracking-[0.3em]",children:"Vasaller & Rikdom"}),o.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-game-gold/10 rounded-full border border-game-gold/20",children:[o.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-game-gold animate-pulse"}),o.jsx("span",{className:"text-[10px] font-black uppercase text-game-gold tracking-widest",children:k.length})]})]}),o.jsx("div",{className:"p-8 overflow-y-auto custom-scrollbar flex-1",children:k.length===0?o.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-10 italic text-center py-20",children:[o.jsx(Gn,{size:64,className:"mb-6"}),o.jsx("p",{className:"text-xl font-black uppercase tracking-[0.4em]",children:"Ingen vasaller funnet"})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(A=>o.jsxs("div",{className:"group flex items-center justify-between p-6 bg-slate-900 border border-white/[0.03] rounded-[2rem] hover:bg-white/[0.07] hover:border-white/10 transition-all cursor-default",children:[o.jsxs("div",{className:"flex items-center gap-5 min-w-0",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-slate-800 flex items-center justify-center text-slate-500 border border-white/5 group-hover:bg-game-gold/10 group-hover:text-game-gold transition-all duration-300",children:o.jsx(Gn,{size:22})}),o.jsxs("div",{className:"flex flex-col min-w-0",children:[o.jsx("span",{className:"text-base font-black text-white truncate leading-tight group-hover:tracking-wide transition-all",children:A.name}),o.jsx("span",{className:"text-[10px] font-black uppercase text-slate-600 tracking-widest mt-1.5",children:A.role})]})]}),o.jsxs("div",{className:"text-right ml-4 flex-shrink-0",children:[o.jsxs("p",{className:"text-2xl font-black italic tracking-tighter text-white group-hover:text-game-gold transition-colors",children:[Math.floor(A.gold),"g"]}),o.jsx("div",{className:"w-24 h-1.5 bg-white/[0.03] rounded-full mt-2.5 overflow-hidden border border-white/[0.02]",children:o.jsx("div",{className:"h-full bg-game-gold/30 shadow-[0_0_15px_rgba(251,191,36,0.3)] transition-all duration-700",style:{width:`${Math.min(100,A.gold/500*100)}%`}})})]})]},A.id))})})]})})]}):o.jsx("div",{className:"bg-slate-900/50 backdrop-blur-xl border border-white/5 rounded-[3rem] overflow-hidden animate-in fade-in slide-in-from-right-8 duration-700 max-w-4xl mx-auto w-full shadow-[0_40px_80px_-20px_rgba(0,0,0,0.8)]",children:o.jsxs("table",{className:"w-full text-base text-left",children:[o.jsx("thead",{className:"bg-black/40 text-[11px] text-game-gold font-black uppercase tracking-[0.25em] border-b border-white/5",children:o.jsxs("tr",{children:[o.jsx("th",{className:"px-10 py-8",children:"Tidsepoke"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Sats"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Gull"}),o.jsx("th",{className:"px-10 py-8 text-right",children:"Korn"})]})}),o.jsx("tbody",{className:"divide-y divide-white/5 font-bold",children:f.length===0?o.jsx("tr",{children:o.jsx("td",{colSpan:4,className:"py-40 text-center opacity-10 font-black uppercase tracking-widest text-3xl",children:"Portalens historie er tom"})}):[...f].reverse().map((A,j)=>o.jsxs("tr",{className:"hover:bg-white/5 transition-all group",children:[o.jsxs("td",{className:"px-10 py-7 text-slate-400 group-hover:text-white transition-colors",children:["r ",A.year,", ",o.jsx("span",{className:"font-black italic text-indigo-400 uppercase tracking-widest ml-3",children:A.season.toUpperCase()})]}),o.jsxs("td",{className:"px-10 py-7 text-right font-black italic text-slate-500 group-hover:text-game-gold transition-colors",children:[A.rate,"%"]}),o.jsxs("td",{className:"px-10 py-7 text-right font-black italic text-game-gold text-2xl whitespace-nowrap",children:[A.amountGold,"g"]}),o.jsx("td",{className:"px-10 py-7 text-right font-black italic text-orange-400 text-2xl whitespace-nowrap",children:A.amountGrain||0})]},j))})]})}),g&&i&&o.jsxs("div",{className:"p-8 bg-black/60 backdrop-blur-2xl border border-red-500/20 rounded-[2.5rem] mt-6 animate-in slide-in-from-top-6 max-w-lg mx-auto w-full shadow-2xl",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-5 border-b border-red-500/10 pb-4",children:[o.jsx("div",{className:"p-2 bg-red-500/10 rounded-lg text-red-500",children:o.jsx(gd,{size:20})}),o.jsx("p",{className:"text-[12px] font-black text-red-400 uppercase tracking-[0.3em]",children:"Systemisk Diagnose"})]}),o.jsxs("div",{className:"text-[11px] font-mono text-slate-500 space-y-2",children:[o.jsxs("div",{className:"flex justify-between border-b border-white/[0.02] pb-1",children:[o.jsx("span",{children:"Region ID:"})," ",o.jsx("span",{className:"text-white font-bold",children:r})]}),o.jsxs("div",{className:"flex justify-between border-b border-white/[0.02] pb-1",children:[o.jsx("span",{children:"Active Entities:"})," ",o.jsx("span",{className:"text-white font-bold",children:Object.keys(e.players).length})]}),o.jsxs("div",{className:"flex justify-between",children:[o.jsx("span",{children:"Match Success:"})," ",o.jsx("span",{className:"text-emerald-500 font-bold",children:k.length>0?"YES":"NO"})]})]})]})]})})},ree=({player:t,activeProcesses:e,onAction:s,onClose:n})=>{var g,p;const i=e.filter(y=>y.type==="COOP"&&y.locationId==="chicken_coop"),r=i.length>0,a=i[0],[l,c]=N.useState(0);N.useEffect(()=>{if(!a){c(0);return}const y=()=>{const w=Math.max(0,a.readyAt-Date.now());c(w)};y();const k=setInterval(y,1e3);return()=>clearInterval(k)},[a]);const u=r&&l<=0,d=t.resources.grain||0,h=()=>{s({type:"FEED_CHICKENS",locationId:"chicken_coop"})},f=()=>{s({type:"COLLECT_EGGS",locationId:"chicken_coop"})},m=a?a.readyAt-a.startedAt:1,b=a?1-l/m:0,x=((p=(g=t.buildings)==null?void 0:g.farm_house)==null?void 0:p.level)||1,v=x>1?`map_peasant_farm_lvl${x}`:"map_peasant_farm";return o.jsx(zn,{title:"Hnsehuset",icon:o.jsx("span",{className:"text-2xl",children:""}),onClose:n,children:o.jsxs("div",{className:"p-6 flex flex-col items-center gap-8 min-h-[400px]",children:[o.jsxs("div",{className:"relative w-full h-48 bg-slate-900/50 rounded-2xl overflow-hidden border border-white/10 flex items-center justify-center",children:[o.jsx("img",{src:`/Simulation_StandAlone_Pro/${v}.png`,className:"absolute inset-0 w-full h-full object-cover opacity-30 grayscale",alt:"Coop Background"}),o.jsxs("div",{className:"relative z-10 flex gap-4",children:[o.jsx(ee.div,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},className:"text-6xl",children:""}),r&&!u&&o.jsx(ee.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-6xl",children:""}),u&&o.jsx(ee.div,{initial:{scale:0},animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:1},className:"text-6xl drop-shadow-[0_0_15px_rgba(251,191,36,0.8)]",children:""})]})]}),o.jsxs("div",{className:"text-center space-y-4 max-w-sm",children:[!r&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Sultne Hner"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Hnene kakler utlmodig. Gi dem korn for  starte eggproduksjonen."}),o.jsxs("div",{className:"flex items-center justify-center gap-4 bg-slate-800/50 p-4 rounded-xl border border-white/5",children:[o.jsx(zi,{resource:"grain",amount:d,size:"lg"}),o.jsx("button",{onClick:h,disabled:d<5,className:`
                                        px-6 py-3 rounded-xl font-bold uppercase tracking-wider text-sm transition-all
                                        ${d>=5?"bg-amber-500 hover:bg-amber-400 text-amber-950 shadow-amber-500/20 shadow-lg":"bg-slate-700 text-slate-500 cursor-not-allowed"}
                                    `,children:"Fr Hner (5 Korn)"})]})]}),r&&!u&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Hnene Spiser"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Det tar tid  lage gode egg..."}),o.jsx("div",{className:"w-full h-4 bg-slate-800 rounded-full overflow-hidden border border-white/10",children:o.jsx(ee.div,{className:"h-full bg-amber-500",initial:{width:`${b*100}%`},animate:{width:`${b*100}%`},transition:{duration:1,ease:"linear"}})}),o.jsxs("p",{className:"font-mono text-amber-400 font-bold",children:[Math.ceil(l/6e4)," minutter igjen"]})]}),u&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{className:"text-xl font-bold text-white",children:"Eggene er klare!"}),o.jsx("p",{className:"text-slate-400 text-sm",children:"Redet er fullt av ferske egg."}),o.jsx("button",{onClick:f,className:"px-8 py-4 bg-emerald-500 hover:bg-emerald-400 text-white rounded-xl font-black uppercase tracking-widest text-lg shadow-emerald-500/30 shadow-2xl animate-pulse",children:"Samle Egg"})]})]})]})})},aee=({buildingId:t,player:e,room:s,onAction:n})=>{var v,g,p,y;const i=Fs[t];if(!i)return null;const r=t==="farm_house",l=["manor_ost","manor_vest","throne_room"].includes(t)?0:1,c=r?((v=e.buildings)==null?void 0:v[t])||{level:1,progress:{}}:((y=(p=(g=s.world)==null?void 0:g.settlement)==null?void 0:p.buildings)==null?void 0:y[t])||{level:l,progress:{}},u=c.level??0,d=Object.keys(i.levels).map(Number).sort((k,w)=>k-w),h=d[d.length-1],f=u>=h,m=u+1,b=i.levels[m],x=i.levels[u];return f?o.jsxs("div",{className:"relative w-full overflow-hidden rounded-[2.5rem] bg-gradient-to-br from-amber-600/20 to-slate-900 border border-amber-500/30 shadow-2xl p-8 text-center group",children:[o.jsx("div",{className:"absolute inset-0 bg-[url('/patterns/topographic.svg')] opacity-10"}),o.jsx("div",{className:"absolute top-0 right-0 p-12 opacity-10 group-hover:opacity-20 transition-opacity",children:o.jsx(xd,{size:120,className:"text-amber-400"})}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-6",children:[o.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-amber-400 to-orange-600 flex items-center justify-center shadow-[0_0_40px_rgba(251,191,36,0.4)] animate-pulse",children:o.jsx(xd,{size:40,className:"text-white drop-shadow-md"})}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-3xl font-black text-amber-100 uppercase tracking-tighter mb-2",children:"Mesterverk Fullfrt"}),o.jsxs("p",{className:"text-amber-200/60 font-medium max-w-md mx-auto",children:[i.name," har ndd sitt ypperste potensial (Niv ",h,")."]})]}),o.jsx("div",{className:"grid grid-cols-1 gap-3 w-full max-w-md mt-4",children:o.jsxs("div",{className:"bg-amber-950/40 border border-amber-500/20 rounded-xl p-4 flex items-center gap-4",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsxs("div",{className:"text-left",children:[o.jsx("div",{className:"text-[10px] font-black uppercase text-amber-500 tracking-widest",children:"Aktiv Bonus"}),o.jsx("div",{className:"font-bold text-amber-100",children:(x==null?void 0:x.bonus)||"Maksimal effekt"})]})]})})]})]}):o.jsxs("div",{className:"space-y-8 w-full",children:[o.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] gap-4 items-center",children:[o.jsxs("div",{className:"bg-slate-900/50 rounded-2xl p-4 border border-white/5 flex flex-col items-center gap-2 opacity-60",children:[o.jsx("div",{className:"text-[10px] font-black uppercase text-slate-500 tracking-widest",children:"Nvrende"}),o.jsxs("div",{className:"text-3xl font-black text-slate-300",children:["Niv ",u]}),o.jsx("div",{className:"text-xs text-center text-slate-500 font-medium px-2",children:(x==null?void 0:x.bonus)||"Ingen effekt"})]}),o.jsx("div",{className:"flex flex-col items-center justify-center text-indigo-500",children:o.jsx(cX,{size:32,className:"animate-pulse"})}),o.jsxs("div",{className:"bg-indigo-600/10 rounded-2xl p-5 border border-indigo-500/30 flex flex-col items-center gap-2 relative overflow-hidden shadow-[0_0_30px_rgba(99,102,241,0.1)]",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-indigo-500"}),o.jsx("div",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-widest",children:"Neste Oppgradering"}),o.jsxs("div",{className:"text-4xl font-black text-white",children:["Niv ",m]}),o.jsx("div",{className:"text-xs text-center text-indigo-200 font-bold px-2 bg-indigo-500/20 py-1 rounded-full mt-1",children:(b==null?void 0:b.bonus)||"???"})]})]}),o.jsx("div",{className:"bg-slate-950/30 rounded-xl p-4 text-center border border-white/5",children:o.jsxs("p",{className:"text-slate-400 text-sm italic",children:['"',i.description,'"']})}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between px-2",children:[o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-[0.2em]",children:"Ressurskrav"}),o.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:r?"Privat Bygg":"Felles Dugnad"})]}),o.jsx("div",{className:"grid grid-cols-1 gap-3",children:Object.entries(b.requirements||{}).map(([k,w])=>{var H,G;const S=Math.floor(((H=c.progress)==null?void 0:H[k])||0),_=Math.min(100,S/w*100),T=Math.floor(((G=e.resources)==null?void 0:G[k])||0),E=w-S,A=T>0&&E>0,j=Math.min(T,E),O=S>=w;return o.jsxs("div",{className:"relative group overflow-hidden bg-slate-900 border border-white/10 rounded-2xl transition-all hover:border-white/20",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-950",children:o.jsx("div",{className:`h-full transition-all duration-1000 ease-out opacity-20 ${O?"bg-emerald-500":"bg-indigo-500"}`,style:{width:`${_}%`}})}),o.jsxs("div",{className:"relative z-10 p-4 flex items-center justify-between gap-4",children:[o.jsxs("div",{className:"flex items-center gap-4 min-w-[120px]",children:[o.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center text-xl shadow-inner ${O?"bg-emerald-500/20 text-emerald-400":"bg-slate-800 text-slate-400"}`,children:O?o.jsx(Rc,{size:20}):k==="gold"?"":k==="wood"?"":k==="stone"?"":k==="plank"?"":""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:k}),o.jsxs("div",{className:`font-bold ${O?"text-emerald-400":"text-white"}`,children:[S," / ",o.jsx("span",{className:"text-slate-500",children:w})]})]})]}),!O&&o.jsx("div",{className:"flex items-center gap-3",children:A?o.jsxs("div",{className:"flex flex-col items-end gap-1",children:[o.jsxs("span",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-wide",children:["Du har: ",T]}),o.jsxs("button",{onClick:()=>n({type:r?"CONTRIBUTE_TO_PRIVATE_UPGRADE":"CONTRIBUTE_TO_UPGRADE",buildingId:t,resource:k,amount:j}),className:"px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-black uppercase tracking-widest rounded-lg transition-all active:scale-95 shadow-lg shadow-indigo-900/20 flex items-center gap-2",children:[o.jsx(tc,{size:12}),"Gi ",j]})]}):o.jsxs("div",{className:"px-4 py-2 bg-rose-500/10 border border-rose-500/20 rounded-lg text-rose-500 text-[10px] font-black uppercase tracking-widest flex items-center gap-2",children:[o.jsx(Oo,{size:12}),"Mangler ",k," (",E,")"]})}),O&&o.jsx("div",{className:"px-4 py-2 bg-emerald-500/10 border border-emerald-500/20 rounded-lg text-emerald-400 text-[10px] font-black uppercase tracking-widest",children:"Fullfrt"})]})]},k)})})]}),Object.entries(b.requirements).every(([w,S])=>{var _;return(((_=c.progress)==null?void 0:_[w])||0)>=S})?o.jsxs("button",{onClick:()=>{n({type:r?"CONTRIBUTE_TO_PRIVATE_UPGRADE":"CONTRIBUTE_TO_UPGRADE",buildingId:t,resource:"dummy",amount:0})},className:"w-full py-5 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-500 hover:to-teal-500 text-white font-black uppercase tracking-widest rounded-2xl shadow-[0_0_30px_rgba(16,185,129,0.4)] transition-all active:scale-95 flex items-center justify-center gap-3 animate-bounce",children:[o.jsx(tc,{size:24}),"Fullfr Oppgradering til Niv ",m,"!"]}):null]})},oee=({npc:t,step:e,setStep:s,onClose:n})=>{var i,r;return o.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 animate-in fade-in duration-300",children:o.jsxs("div",{className:"bg-slate-900 border-2 border-amber-600/30 rounded-2xl max-w-lg w-full overflow-hidden shadow-2xl",children:[o.jsxs("div",{className:"bg-slate-950 p-6 border-b border-white/5 flex gap-4 items-center",children:[o.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-800 border-2 border-amber-500/50 flex items-center justify-center text-3xl shadow-inner",children:""}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-black text-amber-500",children:t.name}),o.jsx("p",{className:"text-sm text-slate-400 italic font-medium",children:t.role})]}),o.jsx("button",{onClick:n,className:"ml-auto w-8 h-8 bg-white/5 hover:bg-white/10 rounded-full flex items-center justify-center text-white transition-colors",children:""})]}),o.jsxs("div",{className:"p-8 space-y-6",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest mb-2 opacity-50",children:t.description}),o.jsxs("p",{className:"text-slate-300 text-lg leading-relaxed italic border-l-4 border-amber-500/20 pl-4 py-2",children:['"',((i=t.conversation[e])==null?void 0:i.text)||"...",'"']}),o.jsx("div",{className:"grid gap-3 pt-4",children:(r=t.conversation[e])==null?void 0:r.options.map((a,l)=>o.jsxs("button",{onClick:()=>{a.nextId==="EXIT"?n():s(a.nextId)},className:"w-full text-left bg-white/5 hover:bg-amber-500/10 hover:border-amber-500/50 border border-white/10 p-4 rounded-xl transition-all font-medium text-slate-200 active:scale-[0.98]",children:[o.jsx("span",{className:"text-amber-500 mr-2",children:""})," ",a.label]},l))})]})]})})},lee=({viewMode:t,viewingRegionId:e,player:s,onSelect:n,onEnterHub:i,onPOIAction:r,room:a})=>{const[l,c]=Se.useState(Date.now());if(Se.useEffect(()=>{const d=setInterval(()=>c(Date.now()),1e3);return()=>clearInterval(d)},[]),t==="kingdom")return null;const u=s.activeProcesses||[];return o.jsx(o.Fragment,{children:Br.map(d=>{var H,G,L,M;const h=u.find(D=>D.locationId===d.id&&D.readyAt>l),f=h?Math.ceil((h.readyAt-l)/1e3):0,m=f>0;if(!(t==="global"?!d.parentId:d.parentId===t))return null;const x=s.role==="KING"&&d.id!=="peasant_farm"||d.roles.includes(s.role)||d.id==="market"||d.isHub,v=["grain_fields","flax_field","forest_clearing","mine_shaft","quarry_poi","forest_forage"].includes(d.id),g=t==="global",p=g&&e==="region_ost",y=g&&(e==="region_vest"||e==="capital"),k=t==="village",w=Object.values(a.players||{});let S=d.top,_=d.left;k&&d.village?(S=d.village.top,_=d.village.left):p&&d.ost?(S=d.ost.top,_=d.ost.left):y&&d.vest&&(S=d.vest.top,_=d.vest.left);const T=d.id==="castle",E=T&&w.some(D=>D.role==="BARON"&&D.regionId===e||e==="capital"&&D.role==="KING"),A=T?e==="capital"?"throne_room":e==="region_ost"?"manor_ost":"manor_vest":"",O=(T&&((M=(L=(G=(H=a.world)==null?void 0:H.settlement)==null?void 0:G.buildings)==null?void 0:L[A])==null?void 0:M.level)||0)>=1||E;return o.jsx(ee.div,{style:{top:S,left:_},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"absolute -translate-x-1/2 -translate-y-1/2 group z-20 pointer-events-auto",children:o.jsxs("button",{onMouseEnter:()=>Tt(async()=>{const{audioManager:D}=await Promise.resolve().then(()=>El);return{audioManager:D}},void 0).then(({audioManager:D})=>D.playSfx("ui_hover")),onClick:()=>{if(Tt(async()=>{const{audioManager:D}=await Promise.resolve().then(()=>El);return{audioManager:D}},void 0).then(({audioManager:D})=>D.playSfx("ui_click")),T&&!O){r(d.id,"OPEN_CONSTRUCTION");return}d.isHub?i(d.id):n(d)},className:`flex flex-col items-center transition-all ${x?"scale-100":"scale-75 opacity-40 grayscale pointer-events-none"}`,children:[o.jsxs("div",{className:"w-16 h-16 rounded-3xl flex items-center justify-center text-4xl shadow-2xl border-2 transition-all duration-300 group-hover:scale-110 bg-slate-900/90 backdrop-blur-xl border-white/10 hover:bg-slate-800 overflow-hidden relative",children:[d.icon,m&&o.jsxs("div",{className:"absolute inset-0 bg-slate-900/60 backdrop-blur-[2px] rounded-3xl flex flex-col items-center justify-center z-10 transition-all group-hover:scale-110",children:[o.jsx(Ib,{className:"w-5 h-5 text-indigo-400 mb-0.5 animate-pulse"}),o.jsxs("span",{className:"text-white font-black text-xs",children:[f,"s"]})]})]}),o.jsx("span",{className:"bg-indigo-600 text-white text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full mt-2 shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap shadow-indigo-600/30",children:m?`KLAR OM ${f}S`:v?"KLIKK FOR  STARTE":T?O?"G INN":"BIDRA TIL BYGGING":d.label})]})},d.id)})})},cee=({viewMode:t,viewingRegionId:e,worldEvents:s,onSelect:n})=>t==="kingdom"||!s?null:o.jsx(o.Fragment,{children:Object.values(s).map(i=>{const r=Br.find(m=>m.id===i.locationId);if(!r||!(t==="global"?!r.parentId:r.parentId===t))return null;const l=t==="global",c=l&&e==="region_ost",u=l&&(e==="region_vest"||e==="capital"),d=t==="village";let h=r.top,f=r.left;return d&&r.village?(h=r.village.top,f=r.village.left):c&&r.ost?(h=r.ost.top,f=r.ost.left):u&&r.vest&&(h=r.vest.top,f=r.vest.left),o.jsx(ee.div,{style:{top:h,left:f},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},className:"absolute -translate-x-1/2 -translate-y-[150%] z-30 pointer-events-auto",children:o.jsx("button",{onClick:()=>n(i),className:`w-14 h-14 rounded-full flex items-center justify-center text-3xl shadow-[0_0_30px_rgba(255,255,255,0.4)] border-4 animate-bounce hover:scale-110 transition-transform ${i.type==="RAID"?"bg-rose-600 border-rose-900 text-white":"bg-amber-400 border-amber-700 text-slate-800"}`,children:i.type==="RAID"?"":""})},i.id)})}),uee=({players:t,setViewingRegionId:e,setViewMode:s,currentUserId:n})=>{const i=t[n],r=i==null?void 0:i.role,a=d=>{if(i){if(i.regionId===d){e(d),s("global");return}if(r==="MERCHANT"||r==="KING"){e(d),s("global");return}alert("Du kan ikke se inn i andre regioner. Du m reise dit med Karavanen!")}},l=Object.values(t||{}),c=l.find(d=>{var h;return d.role==="BARON"&&(d.regionId==="region_vest"||((h=d.regionId)==null?void 0:h.includes("vest")))}),u=l.find(d=>{var h;return d.role==="BARON"&&(d.regionId==="region_ost"||((h=d.regionId)==null?void 0:h.includes("ost")))});return o.jsxs(o.Fragment,{children:[o.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"absolute top-[35%] left-[50%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("capital"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-6xl drop-shadow-[0_0_15px_rgba(255,215,0,0.8)] animate-pulse",children:""}),o.jsx("div",{className:"bg-black/80 text-amber-400 px-4 py-2 rounded-xl mt-2 font-black uppercase tracking-widest text-xs border border-amber-500/50 shadow-xl backdrop-blur-md",children:"Kongeriket"})]})}),o.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"absolute top-[65%] left-[15%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("region_vest"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-5xl drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]",children:""}),o.jsx("div",{className:"bg-black/80 text-indigo-300 px-3 py-1 rounded-xl mt-2 font-bold text-[10px] uppercase tracking-wider border border-white/10 shadow-xl backdrop-blur-md whitespace-nowrap",children:(c==null?void 0:c.name)||"Baroni Vest"})]})}),o.jsx(ee.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"absolute top-[65%] left-[85%] -translate-x-1/2 -translate-y-1/2 z-30 group pointer-events-auto",children:o.jsxs("button",{onClick:()=>a("region_ost"),className:"flex flex-col items-center hover:scale-110 transition-transform",children:[o.jsx("div",{className:"text-5xl drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]",children:""}),o.jsx("div",{className:"bg-black/80 text-emerald-300 px-3 py-1 rounded-xl mt-2 font-bold text-[10px] uppercase tracking-wider border border-white/10 shadow-xl backdrop-blur-md whitespace-nowrap",children:(u==null?void 0:u.name)||"Baroni st"})]})})]})},bT=({player:t,room:e,onAction:s,onClose:n,viewingRegionId:i,initialProjectId:r})=>{var _,T,E,A;const a=i==="dock_hub"?["wharf"]:i==="region_ost"?["manor_ost"]:i==="region_vest"?["manor_vest"]:i==="capital"||t.role==="BARON"||t.role==="KING"?["throne_room","manor_ost","manor_vest","wharf"]:["throne_room"],l=r&&(a.includes(r)||["throne_room","wharf"].includes(r))?r:a[0],[c,u]=N.useState(l),d=((T=(_=e.world)==null?void 0:_.settlement)==null?void 0:T.buildings)||{},h=a.filter(j=>d[j]),f=h.includes(c)?c:h[0]||c,m=d[f],b=Fs[f];if(!m||!b)return o.jsx(zn,{title:"Gjenoppbygging",onClose:n,children:o.jsxs("div",{className:"flex flex-col items-center justify-center h-96 text-center p-12",children:[o.jsx("div",{className:"w-16 h-16 bg-slate-900 rounded-full flex items-center justify-center mb-6 text-2xl opacity-50",children:""}),o.jsx("h3",{className:"text-xl font-black text-white italic mb-2",children:"Ingen aktive byggeprosjekter"}),o.jsx("p",{className:"text-slate-500 text-sm max-w-xs",children:"Det er ingen storsltte prosjekter i dette omrdet som krever din hjelp akkurat n. Prv  dra til hovedstaden eller et av baroniene."}),o.jsx("button",{onClick:n,className:"mt-8 px-8 py-3 bg-white/5 hover:bg-white/10 rounded-xl text-[11px] font-black uppercase tracking-widest text-slate-400",children:"Lukk vindu"})]})});const x=(m.level||0)+1,v=((A=(E=b.levels)==null?void 0:E[x])==null?void 0:A.requirements)||{},g=m.contributions||{};let p=0,y=0;Object.entries(v).forEach(([j,O])=>{var H;p+=O,y+=((H=m.progress)==null?void 0:H[j])||0});const k=p>0?y/p*100:0,w=(j,O)=>{s({type:"CONTRIBUTE",buildingId:f,resource:j,amount:O})},S=Object.entries(g).map(([j,O])=>{const H=re.CONTRIBUTION_VALUES;let G=0;return Object.entries(O.resources||{}).forEach(([L,M])=>{G+=M*(H[L]||H.default)}),{id:j,name:O.name,total:G}}).sort((j,O)=>O.total-j.total);return o.jsx(zn,{title:"Gjenoppbygging & Lederskap",onClose:n,children:o.jsxs("div",{className:"max-h-[70vh] overflow-y-auto custom-scrollbar p-1",children:[h.length>1&&o.jsx("div",{className:"flex gap-2 mb-6 bg-slate-900/50 p-1.5 rounded-2xl border border-white/5 w-fit",children:h.map(j=>{var O;return o.jsx("button",{onClick:()=>u(j),className:`px-4 py-2 rounded-xl text-[11px] font-black uppercase tracking-widest transition-all ${f===j?"bg-indigo-600 text-white shadow-lg":"text-slate-500 hover:text-slate-300"}`,children:((O=Fs[j])==null?void 0:O.name)||j},j)})}),o.jsxs("div",{className:"relative h-48 rounded-3xl overflow-hidden mb-8 group border border-white/5",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-900/40 to-transparent z-10"}),o.jsx("img",{src:`/Simulation_StandAlone_Pro/antigravity/brain/07597a3b-439f-498d-aa43-1b02768f5015/${f==="throne_room"?"maritime_shipyard_blueprint_bg_1768089214778.png":"maritime_wharf_upgrade_epic_1768089228676.png"}`,alt:b.name,className:"w-full h-48 object-cover rounded-2xl mb-6 shadow-2xl border border-white/10"}),o.jsxs("div",{className:"absolute bottom-6 left-8 z-20",children:[o.jsx("h3",{className:"text-3xl font-black text-white italic tracking-tighter uppercase",children:b.name}),o.jsx("p",{className:"text-slate-300 font-medium text-xs max-w-md",children:b.description})]}),o.jsxs("div",{className:"absolute top-6 right-8 z-20 flex flex-col items-end gap-2",children:[o.jsx("div",{className:"bg-emerald-500/20 backdrop-blur-md px-4 py-2 rounded-full border border-emerald-500/30",children:o.jsxs("span",{className:"text-emerald-400 font-black text-xs tabular-nums",children:[k.toFixed(0),"% FULLFRT"]})}),o.jsx("div",{className:"bg-white/5 backdrop-blur-md px-3 py-1 rounded-full border border-white/10 opacity-40",children:o.jsxs("span",{className:"text-white/60 font-bold text-[11px] uppercase tracking-tighter",children:["DB Niv: ",m.level||0," / Max: ",Object.keys(b.levels||{}).length]})})]})]}),o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[o.jsx("div",{className:"space-y-6",children:o.jsxs("section",{children:[o.jsx("h4",{className:"text-[11px] font-black text-slate-500 uppercase tracking-widest mb-4",children:"Mangler for ferdigstillelse"}),o.jsx("div",{className:"space-y-4",children:Object.entries(v).map(([j,O])=>{var I,F,U,R,C;const H=((I=m.progress)==null?void 0:I[j])||0,G=O,L=Math.min(100,H/G*100),M=H>=G,D=((F=t.resources)==null?void 0:F[j])||0;return o.jsxs("div",{className:`p-4 rounded-2xl border transition-all ${M?"bg-emerald-500/5 border-emerald-500/20":"bg-slate-900/50 border-white/5"}`,children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-xl",children:((U=Ge[j])==null?void 0:U.icon)||""}),o.jsxs("div",{children:[o.jsx("span",{className:"text-sm font-bold text-white tracking-tight italic",children:((R=Ge[j])==null?void 0:R.label)||j}),o.jsxs("p",{className:"text-[11px] text-slate-500 font-medium",children:["Beholdning: ",o.jsx("span",{className:"text-slate-300",children:typeof D=="number"?D.toLocaleString():D})]})]})]}),o.jsx("div",{className:"text-right",children:o.jsxs("span",{className:`text-xs font-black ${M?"text-emerald-400":"text-slate-300"}`,children:[H," / ",G]})})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-950 rounded-full overflow-hidden mb-4",children:o.jsx("div",{style:{width:`${L}%`},className:`h-full transition-all duration-500 ${M?"bg-emerald-500":"bg-indigo-500"}`})}),(D>0||M)&&o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>w(j,Math.min(10,D||1)),className:`flex-1 py-2 rounded-xl text-[11px] font-black text-white transition-all uppercase border
                                                            ${M?"bg-white/5 border-white/10 opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}
                                                        `,children:M?"Lager Fullt":"Gi 10"}),o.jsx("button",{onClick:()=>w(j,Math.min(50,D||1)),className:`flex-1 py-2 rounded-xl text-[11px] font-black text-white transition-all uppercase
                                                            ${M?"bg-indigo-600/20 text-indigo-300/50 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-500"}
                                                        `,children:M?"Fullfrt":"Gi 50"})]}),D<=0&&!M&&o.jsx("div",{className:"py-2 text-center bg-black/20 rounded-xl border border-white/5",children:o.jsxs("span",{className:"text-[11px] font-black text-slate-600 uppercase tracking-widest",children:["Du mangler ",((C=Ge[j])==null?void 0:C.label)||j]})})]},j)})})]})}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("section",{className:"bg-slate-900/50 border border-white/5 rounded-[2rem] p-6",children:[o.jsx("h4",{className:"text-[11px] font-black text-slate-500 uppercase tracking-widest mb-6 px-2",children:"Toppbidragsytere"}),o.jsx("div",{className:"space-y-2",children:S.length===0?o.jsx("div",{className:"text-center py-8 text-slate-500 text-xs italic",children:"Ingen bidrag enda. Bli den frste!"}):S.slice(0,5).map((j,O)=>o.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl ${O===0?"bg-amber-500/10 border border-amber-500/20":"hover:bg-white/5 transition-colors"}`,children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-6 h-6 rounded-lg flex items-center justify-center text-[11px] font-black ${O===0?"bg-amber-500 text-slate-950":"bg-slate-800 text-slate-400"}`,children:O+1}),o.jsx("span",{className:`text-sm font-bold ${O===0?"text-white":"text-slate-300"}`,children:j.name})]}),o.jsxs("span",{className:"text-xs font-mono text-slate-500",children:[j.total.toLocaleString()," poeng"]})]},j.id))})]}),o.jsxs("section",{className:"bg-indigo-600/10 border border-indigo-500/20 rounded-[2rem] p-6 relative overflow-hidden",children:[o.jsx("div",{className:"absolute -top-4 -right-4 w-24 h-24 bg-indigo-500/10 blur-2xl rounded-full"}),o.jsx("h4",{className:"text-[11px] font-black text-indigo-400 uppercase tracking-widest mb-4",children:"Gevinst"}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("span",{className:"text-4xl",children:c==="throne_room"?"":""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-white font-black italic tracking-tight underline decoration-indigo-500/50",children:c==="throne_room"?"TITTEL: KONGE":"TITTEL: BARON"}),o.jsx("p",{className:"text-slate-400 text-xs mt-1",children:"Spilleren med hyest poengsum ved ferdigstillelse overtar styringen."})]})]})]})]})]})]})})},Ng=[{level:0,label:"Gammelt Trestativ",slots:2,cost:{wood:50},visual:"wood"},{level:1,label:"Forsterket Jernstativ",slots:4,cost:{wood:100,ore:50},visual:"iron"},{level:2,label:"Forgylt Kongestativ",slots:6,cost:{wood:200,ore:100,gold:500},visual:"gold"}],dee=[{id:"trophy_rusty_sword",label:"Rustent Sverd",desc:"Funnet i myra.",price:50,icon:o.jsx(Gm,{size:24,className:"text-amber-800"})},{id:"trophy_broken_shield",label:"Knust Skjold",desc:"Fra et glemt slag.",price:100,icon:o.jsx(d1,{size:24,className:"text-slate-600"})},{id:"trophy_golden_chalice",label:"Gullbeger",desc:"Kanskje litt uekte gull?",price:500,icon:o.jsx(xd,{size:24,className:"text-yellow-400"})},{id:"trophy_dragon_skull",label:"Dragehodeskalle",desc:"En fryktinngytende replika.",price:2500,icon:o.jsx("div",{className:"text-2xl",children:""})}],bO=({level:t,slots:e})=>{const s="#5D4037",n="#3E2723",i="#B7950B",r=()=>t===1?"#263238":t===2?i:n,a={filter:t===2?"drop-shadow(0 0 15px rgba(255, 215, 0, 0.3))":"drop-shadow(0 10px 15px rgba(0,0,0,0.5))"};return o.jsxs("svg",{viewBox:"0 0 400 300",className:"w-full h-full transition-all duration-500",style:a,children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"woodGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[o.jsx("stop",{offset:"0%",stopColor:n}),o.jsx("stop",{offset:"50%",stopColor:s}),o.jsx("stop",{offset:"100%",stopColor:n})]}),o.jsxs("linearGradient",{id:"goldGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"0%",stopColor:"#FFF9C4"}),o.jsx("stop",{offset:"50%",stopColor:"#FFD700"}),o.jsx("stop",{offset:"100%",stopColor:"#B7950B"})]})]}),o.jsx("ellipse",{cx:"200",cy:"270",rx:"140",ry:"20",fill:"black",opacity:"0.4"}),o.jsx("rect",{x:"60",y:"40",width:"20",height:"240",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"320",y:"40",width:"20",height:"240",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"80",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"150",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),o.jsx("rect",{x:"50",y:"220",width:"300",height:"15",rx:"4",fill:t===2?"url(#goldGradient)":"url(#woodGradient)",stroke:r(),strokeWidth:"2"}),t>=1&&o.jsxs(o.Fragment,{children:[o.jsx("circle",{cx:"70",cy:"87.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"330",cy:"87.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"70",cy:"157.5",r:"4",fill:t===2?"black":"#CFD8DC"}),o.jsx("circle",{cx:"330",cy:"157.5",r:"4",fill:t===2?"black":"#CFD8DC"})]}),e.map((l,c)=>{if(!l||!l.itemId)return null;const u=2,d=Math.floor(c/u),f=c%u===0?140:260,m=90+d*70;return o.jsxs("g",{transform:`translate(${f}, ${m})`,children:[o.jsx("ellipse",{cx:"0",cy:"40",rx:"15",ry:"5",fill:"black",opacity:"0.3"}),l.type==="ITEM"?o.jsxs("g",{transform:"scale(1.2) rotate(15)",children:[o.jsx("path",{d:"M0,-30 L0,30",stroke:"#90A4AE",strokeWidth:"4"}),o.jsx("rect",{x:"-6",y:"-10",width:"12",height:"4",fill:"#546E7A"}),o.jsx("circle",{cx:"0",cy:"32",r:"3",fill:"#FFD700"})]}):o.jsxs("g",{transform:"scale(1.5)",children:[l.itemId==="trophy_rusty_sword"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_broken_shield"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_golden_chalice"&&o.jsx("text",{x:"-10",y:"10",fontSize:"24",children:""}),l.itemId==="trophy_dragon_skull"&&o.jsx("text",{x:"-12",y:"12",fontSize:"28",children:""})]})]},c)})]})},hee=({player:t,onAction:e,onClose:s})=>{const[n,i]=N.useState("status"),r=t.weaponRack||{},a={level:r.level||0,slots:r.slots||[],unlockedTrophies:r.unlockedTrophies||[],lastPolishedAt:r.lastPolishedAt||0},l=Ng.find(p=>p.level===a.level)||Ng[0],c=Ng.find(p=>p.level===a.level+1),u=l.slots,d=(t.inventory||[]).filter(p=>["MAIN_HAND","OFF_HAND","BODY","HEAD","FEET","AXE","BOW","HAMMER"].includes(p.type));d.sort((p,y)=>(y.value||0)-(p.value||0));const h=p=>{e({type:"RACK_MOUNT_ITEM",itemId:p.id,instanceId:p.id})},f=p=>{e({type:"RACK_MOUNT_TROPHY",trophyId:p})},m=p=>{e({type:"RACK_UNMOUNT",slotId:p})},b=()=>{e({type:"RACK_UPGRADE"})},x=(p,y)=>{e({type:"RACK_BUY_TROPHY",trophyId:p,price:y})},v=()=>{e({type:"RACK_POLISH"})},g=a.slots.length>=u;return o.jsx(zn,{title:"VPENKAMMERET",subtitle:"The Royal Armory",icon:o.jsx(tc,{className:"text-amber-500",size:24}),onClose:s,maxWidth:"max-w-7xl",children:o.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-[700px] text-slate-200 select-none overflow-hidden",children:[o.jsxs("div",{className:"lg:col-span-3 flex flex-col bg-slate-900/50 rounded-3xl border border-white/5 overflow-hidden",children:[o.jsxs("div",{className:"p-4 border-b border-white/5 bg-white/5 flex items-center justify-between",children:[o.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Ditt Utstyr"}),o.jsxs("span",{className:"text-[10px] bg-slate-800 px-2 py-1 rounded text-slate-400",children:[d.length," gjenstander"]})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2",children:[d.length===0&&o.jsx("div",{className:"text-center py-10 text-slate-600 text-xs italic",children:"Tomt i sekken..."}),d.map((p,y)=>o.jsxs("button",{disabled:g,onClick:()=>h(p),className:"w-full flex items-center gap-3 p-3 bg-slate-900 rounded-xl border border-white/5 hover:border-indigo-500/50 hover:bg-indigo-500/10 transition-all text-left disabled:opacity-50 group",children:[o.jsx("div",{className:"w-10 h-10 flex items-center justify-center bg-slate-950 rounded-lg border border-white/5 text-lg shadow-inner group-hover:scale-105 transition-transform",children:""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-bold text-base text-indigo-100 truncate group-hover:text-indigo-400 transition-colors",children:p.name}),o.jsx("div",{className:"flex items-center gap-2 text-[10px] text-slate-500",children:o.jsxs("span",{children:["Slitasje: ",p.durability||100,"%"]})})]}),o.jsx("div",{className:"opacity-0 group-hover:opacity-100 text-indigo-400 transition-opacity",children:o.jsx(JI,{size:14})})]},`inv-${y}`))]})]}),o.jsx("div",{className:"lg:col-span-6 flex flex-col relative group",children:o.jsxs("div",{className:"flex-1 bg-gradient-to-b from-slate-900 to-slate-950 rounded-3xl border border-white/10 shadow-2xl relative overflow-hidden flex items-center justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-amber-900/10 via-slate-950/50 to-slate-950 pointer-events-none"}),o.jsx("div",{className:"relative z-10 w-full h-full p-8",children:o.jsx(bO,{level:a.level,slots:a.slots})}),o.jsx("div",{className:"absolute bottom-8 right-8 z-20",children:(()=>{const p=Date.now(),y=a.lastPolishedAt||0,k=6e4*60,w=p-y,S=w>=k,_=k-w,T=Math.ceil(_/6e4);return o.jsxs("button",{onClick:v,disabled:!S,className:`flex items-center gap-2 px-4 py-3 rounded-full border transition-all backdrop-blur-sm shadow-xl 
                                            ${S?"bg-amber-500/10 hover:bg-amber-500/20 text-amber-500 hover:text-amber-400 border-amber-500/30 hover:border-amber-500/50 hover:shadow-amber-500/10 cursor-pointer":"bg-slate-900/50 text-slate-500 border-slate-700 cursor-not-allowed grayscale"}`,children:[o.jsx(aJ,{size:18,className:S?"animate-pulse":""}),o.jsxs("div",{className:"flex flex-col items-start leading-none",children:[o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:S?"Puss Utstyr":"Ny-pusset"}),!S&&o.jsxs("span",{className:"text-[10px] lowercase text-slate-400",children:[T,"m ventetid"]})]})]})})()})]})}),o.jsxs("div",{className:"lg:col-span-3 flex flex-col gap-4",children:[o.jsxs("div",{className:"bg-slate-900/80 rounded-2xl p-2 flex border border-white/10",children:[o.jsx("button",{onClick:()=>i("status"),className:`flex-1 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${n==="status"?"bg-slate-800 text-white shadow":"text-slate-500 hover:text-slate-300"}`,children:"Oversikt"}),o.jsx("button",{onClick:()=>i("shop"),className:`flex-1 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${n==="shop"?"bg-amber-900/30 text-amber-500 shadow":"text-slate-500 hover:text-slate-300"}`,children:"Trofer"})]}),o.jsxs("div",{className:"flex-1 bg-slate-900/50 rounded-3xl border border-white/5 p-4 overflow-y-auto custom-scrollbar",children:[n==="status"&&o.jsxs("div",{className:"space-y-6 animate-in fade-in slide-in-from-right-4 duration-300",children:[o.jsxs("div",{children:[o.jsxs("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-500 mb-3 flex justify-between",children:[o.jsx("span",{children:"P Veggen"}),o.jsxs("span",{children:[a.slots.length," / ",u]})]}),o.jsxs("div",{className:"space-y-2",children:[a.slots.length===0&&o.jsx("div",{className:"text-xs text-slate-600 italic",children:"Tomt stativ..."}),a.slots.map(p=>o.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-800/50 rounded-lg border border-white/5",children:[o.jsx("div",{className:"text-lg",children:p.type==="TROPHY"?"":""}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsx("div",{className:"text-sm font-bold text-slate-300 truncate",children:p.itemId})}),o.jsx("button",{onClick:()=>m(p.id),className:"text-rose-500 hover:text-rose-400 p-1 hover:bg-rose-500/10 rounded",children:o.jsx("span",{className:"text-xs",children:""})})]},p.id))]})]}),o.jsxs("div",{className:"mt-auto pt-6 border-t border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(TX,{className:"text-amber-500",size:16}),o.jsx("h4",{className:"text-xs font-black uppercase tracking-widest text-amber-500",children:"Neste Niv"})]}),c?o.jsxs("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 p-4 rounded-xl border border-white/5",children:[o.jsx("div",{className:"text-sm font-bold text-white mb-2",children:c.label}),o.jsxs("div",{className:"text-[10px] text-slate-400 mb-4",children:["ker kapasiteten til ",o.jsxs("span",{className:"text-amber-400 font-bold",children:[c.slots," plasser"]}),"."]}),o.jsx("div",{className:"grid grid-cols-2 gap-2 mb-4",children:Object.entries(c.cost).map(([p,y])=>o.jsxs("div",{className:`text-xs px-2 py-1 rounded bg-slate-950 flex justify-between ${t.resources[p]>=y?"text-slate-300":"text-rose-400"}`,children:[o.jsx("span",{className:"capitalize",children:p}),o.jsx("span",{className:"font-mono",children:y})]},p))}),o.jsx("button",{onClick:b,disabled:!1,className:"w-full py-2 bg-amber-600 hover:bg-amber-500 text-white rounded-lg font-bold text-xs shadow-lg shadow-amber-900/20 transition-all uppercase tracking-wider",children:"Oppgrader"})]}):o.jsx("div",{className:"text-center py-4 text-emerald-500 text-xs font-bold bg-emerald-500/10 rounded-xl border border-emerald-500/20",children:"Maksimalt niv ndd!"})]})]}),n==="shop"&&o.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-right-4 duration-300",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 p-3 bg-amber-900/10 border border-amber-500/20 rounded-xl text-amber-200 text-xs",children:[o.jsx(sa,{size:14,className:"text-amber-400"}),o.jsx("span",{children:"Kjp unike trofer for re og bermmelse!"})]}),dee.map(p=>{const y=a.unlockedTrophies.includes(p.id),k=(t.resources.gold||0)>=p.price;return o.jsx("div",{className:"relative p-3 bg-slate-800/40 rounded-xl border border-white/5 hover:bg-slate-800/80 transition-all group",children:o.jsxs("div",{className:"flex gap-3",children:[o.jsx("div",{className:"w-12 h-12 rounded-lg bg-black/40 flex items-center justify-center text-2xl shadow-inner group-hover:scale-110 transition-transform duration-300",children:p.icon}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-sm text-slate-200",children:p.label}),o.jsx("p",{className:"text-xs text-slate-500 mt-1",children:p.desc}),o.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[o.jsxs("span",{className:"font-mono text-amber-500 font-bold text-xs",children:[p.price,"g"]}),y?a.slots.some(w=>w.itemId===p.id)?o.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider bg-slate-800 px-2 py-0.5 rounded",children:"P veggen"}):o.jsx("button",{onClick:()=>f(p.id),disabled:g,className:"px-3 py-1 rounded text-[10px] font-bold uppercase tracking-wider transition-colors bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed",children:"Heng Opp"}):o.jsx("button",{onClick:()=>x(p.id,p.price),disabled:!k,className:`px-3 py-1 rounded text-[10px] font-bold uppercase tracking-wider transition-colors ${k?"bg-amber-600/20 text-amber-400 hover:bg-amber-600 hover:text-white":"bg-slate-800 text-slate-600 cursor-not-allowed"}`,children:"Kjp"})]})]})]})},p.id)})]})]})]})]})})},Sg={standard:"M-150,-40 Q-120,-40 0,-50 Q120,-40 150,0 Q120,40 0,50 Q-120,40 -150,40 L-150,-40 Z",sloop:"M-140,-35 Q-100,-35 0,-45 Q100,-35 160,0 Q100,35 0,45 Q-100,35 -140,35 L-140,-35 Z",cog:"M-160,-50 Q-120,-50 0,-60 Q120,-50 140,0 Q120,50 0,60 Q-120,50 -160,50 L-160,-50 Z",galleon:"M-180,-55 Q-130,-55 0,-65 Q130,-55 170,0 Q130,55 0,65 Q-130,55 -180,55 L-180,-55 Z"},vT={standard:"M-40,-70 Q10,-70 20,0 Q10,70 -40,70",sloop:"M-60,-80 Q20,-60 60,0 Q20,60 -60,80 L-50,0 Z",cog:"M-50,-90 Q0,-90 50,0 Q0,90 -50,90",galleon:"M-60,-100 Q10,-100 60,-30 Q10,-30 -60,-30 M-50,30 Q10,30 50,90 Q10,90 -50,90"},qm=Se.memo(({stage:t,model:e="standard",componentLevels:s={sails:0,hull:0,cannons:0,nets:0},view:n="top",variant:i="standard",customization:r={},scale:a=1,rotation:l=0,className:c=""})=>{const u=i==="drafting",d={standard:{hullFill:r.color||"#453020",hullStroke:"#2a1b12",deckFill:"#1a0f0a",deckOpacity:.4,sailFill:r.sailPattern==="striped"?"url(#stripedPattern)":"#f0e6d2",sailStroke:(s.sails||0)>=3?"#b45309":"#a8a29e",metal:"#3f3f46",wood:"#453020",gold:"#d97706"},drafting:{hullFill:"#f5f5f4",hullStroke:"#1c1917",deckFill:"#e7e5e4",deckOpacity:1,sailFill:"#fafaf9",sailStroke:"#1c1917",metal:"#44403c",wood:"#57534e",gold:"#1c1917"}},h=u?d.drafting:d.standard,f=u?"2.5":"4",m=u?"url(#inkRoughness)":"none",b=u?"300 5":"none",x=t<4,v=Sg[e]||Sg.standard,g=vT[e]||vT.standard,p=s.cannons||0;return n==="side"?o.jsxs(ee.svg,{viewBox:"0 0 400 300",className:`w-full h-full ${c}`,initial:!1,animate:{scale:a},style:{filter:u?"none":"drop-shadow(0 4px 6px rgba(0,0,0,0.3))"},transition:{type:"spring",stiffness:300,damping:30},children:[u&&o.jsx("defs",{children:o.jsxs("filter",{id:"inkRoughness",children:[o.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.04",numOctaves:"3",result:"noise"}),o.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"2"})]})}),o.jsxs("g",{transform:"translate(200, 180)",filter:m,children:[t>=1&&o.jsx("g",{id:"hull-side",children:o.jsx("path",{d:e==="galleon"?"M-190,-40 Q-100,50 0,60 Q100,50 180,-40 L160,-50 L-160,-50 Z":"M-160,-20 Q-150,40 0,50 Q150,40 160,-30 L140,-40 L-140,-40 Z",fill:h.hullFill,stroke:h.hullStroke,strokeWidth:f,strokeLinecap:"round",strokeDasharray:b})}),t>=2&&o.jsxs("g",{id:"mast-side",children:[o.jsx("rect",{x:"-4",y:"-180",width:"8",height:"150",rx:"2",fill:u?"none":h.wood,stroke:h.wood,strokeWidth:u?2:0}),o.jsx(ee.path,{d:"M0,-145 Q60,-90 0,-20",fill:h.sailFill,stroke:h.sailStroke,strokeWidth:"2",strokeDasharray:u?"4 2":"none",animate:{d:["M0,-145 Q60,-90 0,-20","M0,-145 Q80,-90 0,-20","M0,-145 Q60,-90 0,-20"]},transition:{repeat:1/0,duration:6,ease:"easeInOut"}})]})]})]}):o.jsxs(ee.svg,{viewBox:"0 0 400 300",className:`w-full h-full ${c}`,style:{rotate:l},initial:!1,animate:{scale:a},transition:{type:"spring",stiffness:300,damping:30},children:[u&&o.jsx("defs",{children:o.jsxs("filter",{id:"inkRoughness",children:[o.jsx("feTurbulence",{type:"fractalNoise",baseFrequency:"0.04",numOctaves:"3",result:"noise"}),o.jsx("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"2"})]})}),o.jsxs("g",{transform:"translate(200, 150) scale(1)",filter:m,children:[t>=1&&o.jsxs("g",{id:"hull",children:[o.jsx("path",{d:x?Sg.standard:v,fill:h.hullFill,stroke:h.hullStroke,strokeWidth:f,strokeLinecap:"round"}),o.jsx("path",{d:"M-130,-30 L110,-30 L130,0 L110,30 L-130,30 Z",fill:h.deckFill,fillOpacity:h.deckOpacity})]}),!x&&p>0&&o.jsxs("g",{id:"cannons",children:[o.jsx("rect",{x:"-80",y:"-45",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-40",y:"-48",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"0",y:"-50",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-80",y:"37",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-40",y:"40",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"0",y:"42",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),e==="galleon"&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"-120",y:"-42",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"}),o.jsx("rect",{x:"-120",y:"34",width:"20",height:"8",fill:h.metal,stroke:u?h.hullStroke:"none",strokeWidth:"1"})]})]}),t>=2&&o.jsxs("g",{id:"mast-rigging",children:[o.jsx("circle",{cx:"0",cy:"0",r:"6",fill:h.wood}),o.jsx("rect",{x:"-4",y:"-80",width:"8",height:"160",rx:"2",fill:h.wood,transform:"rotate(90)"}),o.jsx("path",{d:g,fill:h.sailFill,stroke:h.sailStroke,strokeWidth:"2",opacity:u?1:.9,strokeDasharray:u?"4 2":"none"}),o.jsx(ee.path,{d:"M-4,-80 L-40,-70 L-40,-90 Z",fill:u?h.gold:r.color||"#ef4444",animate:{scaleX:[1,1.2,1],rotate:[0,5,0]},transition:{repeat:1/0,duration:1.5}})]})]})]})},(t,e)=>{var s,n,i,r,a,l;return t.stage===e.stage&&t.model===e.model&&t.view===e.view&&t.variant===e.variant&&t.scale===e.scale&&t.rotation===e.rotation&&((s=t.customization)==null?void 0:s.color)===((n=e.customization)==null?void 0:n.color)&&((i=t.componentLevels)==null?void 0:i.sails)===((r=e.componentLevels)==null?void 0:r.sails)&&((a=t.componentLevels)==null?void 0:a.cannons)===((l=e.componentLevels)==null?void 0:l.cannons)}),fee=({children:t,color:e="amber"})=>o.jsx("div",{className:`px-4 py-1.5 rounded-full bg-${e}-500/20 border border-${e}-400/30 text-${e}-400 text-[11px] font-black uppercase tracking-widest shadow-[0_0_20px_rgba(0,0,0,0.3)]`,children:t}),Tg=({children:t,onClick:e,disabled:s,variant:n="primary"})=>o.jsx("button",{onClick:e,disabled:s,className:`px-8 py-4 rounded-2xl font-black uppercase italic tracking-tighter transition-all active:scale-95 flex items-center gap-3
            ${s?"opacity-30 cursor-not-allowed grayscale":"hover:scale-105"}
            ${n==="primary"?"bg-amber-500 text-slate-950 shadow-[0_10px_30px_rgba(245,158,11,0.2)]":""}
            ${n==="ghost"?"bg-white/5 text-white border border-white/10 hover:bg-white/10":""}
            ${n==="danger"?"bg-red-500/20 text-red-400 border border-red-500/30 hover:bg-red-500/30":""}
        `,children:t}),mee=({player:t,world:e,onAction:s})=>{var f,m;const{season:n,time:i}=e,r=((f=t.boat)==null?void 0:f.isDamaged)||!1,a=((m=t.boat)==null?void 0:m.cannonballs)||0,l=t.resources.cannonball||0,c=t.boat&&t.boat.stage>=2&&!r,u=n.toLowerCase(),d=i.toLowerCase(),h=`/Simulation_StandAlone_Pro/assets/maritime/dock_${u}_${d}.png`;return o.jsxs("div",{className:"relative w-full h-full overflow-hidden bg-slate-950 flex flex-col items-center justify-center font-sans tracking-tight",children:[o.jsxs("div",{className:"absolute inset-0 z-0",children:[o.jsx(m1,{src:h,alt:`${n} ${i} Dock View`,className:"w-full h-full object-cover brightness-[0.7] contrast-[1.1]",disableMotion:!0}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950/90 via-transparent to-slate-950/40 pointer-events-none"})]}),o.jsx(qt,{children:t.boat&&t.boat.stage>0&&o.jsx(ee.div,{initial:{x:-100,opacity:0},animate:{x:0,opacity:1,y:[0,-10,0]},transition:{y:{repeat:1/0,duration:6,ease:"easeInOut"},default:{type:"spring",damping:20}},className:"absolute bottom-[5%] left-[5%] w-[800px] h-[500px] z-10 pointer-events-none drop-shadow-[0_40px_80px_rgba(0,0,0,0.8)]",children:o.jsx(qm,{stage:t.boat.stage,view:"side",customization:t.boat.customization,scale:.85,className:"drop-shadow-[0_10px_20px_rgba(0,0,0,0.7)]"})})}),o.jsxs("div",{className:"relative z-20 w-full h-full flex flex-col justify-between p-12",children:[o.jsxs("div",{className:"flex justify-between items-start pt-16",children:[o.jsx(ee.div,{initial:{x:-50,opacity:0},animate:{x:0,opacity:1},className:"bg-slate-950/40 backdrop-blur-2xl border border-white/5 p-6 rounded-[2rem] shadow-2xl",children:o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx(fee,{color:"amber",children:"Maritim Hub"}),o.jsx("div",{className:"h-px w-12 bg-white/10"}),o.jsxs("span",{className:"text-white/40 text-[10px] uppercase font-black tracking-widest",children:["Region ",t.regionId==="region_vest"?"Vest":"st"]})]}),o.jsx("h1",{className:"text-8xl font-black text-white italic tracking-tighter leading-none mb-2 drop-shadow-2xl",children:"KAIA"}),o.jsx("p",{className:"text-slate-400 text-base max-w-[280px] leading-relaxed font-medium",children:t.boat?"Bten din ligger klar ved bryggen. Vinden er gunstig.":"Verftet venter. Legg ned den frste kjlen for  erobre havet."})]})}),t.boat&&o.jsxs(ee.div,{initial:{x:50,opacity:0},animate:{x:0,opacity:1},className:"w-72 bg-slate-950/40 backdrop-blur-3xl border border-white/10 p-6 rounded-[2rem] shadow-2xl flex flex-col gap-6",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("h3",{className:"text-white font-black italic uppercase tracking-tighter",children:"Arsenalet"}),o.jsx(rO,{className:"text-amber-500",size:20})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[o.jsx("span",{className:"text-white/40 text-[9px] uppercase font-bold block mb-1",children:"I Lasterom"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx(QI,{size:14,className:"text-amber-400"}),o.jsx("span",{className:"text-xl font-black text-white italic",children:a})]})]}),o.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[o.jsx("span",{className:"text-white/40 text-[9px] uppercase font-bold block mb-1",children:"Ryggsekk"}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx("span",{className:"text-xl font-black text-white italic",children:l})})]})]}),o.jsx("button",{onClick:()=>s("REFILL_AMMO"),disabled:l<=0,className:`w-full py-4 rounded-2xl font-black uppercase italic text-xs tracking-widest transition-all
                                    ${l>0?"bg-white text-slate-950 hover:scale-[1.02] active:scale-95 shadow-xl":"bg-white/5 text-white/20 cursor-not-allowed"}
                                `,children:"Last ombord"})]})]}),o.jsx(ee.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"flex justify-center gap-6",children:o.jsxs("div",{className:"flex items-center gap-6 bg-slate-950/20 backdrop-blur-md p-4 rounded-[2.5rem] border border-white/5 shadow-2xl",children:[o.jsxs(Tg,{variant:"ghost",onClick:()=>s("OPEN_SHIPYARD"),children:[o.jsx(tc,{size:18})," Verftet"]}),o.jsxs(Tg,{disabled:!c,onClick:()=>s("START_SAILING"),variant:c?"primary":"ghost",children:[o.jsx(iO,{size:20}),r?"SKADET SKROG!":"Sette Seil"]}),r&&o.jsxs(Tg,{variant:"danger",onClick:()=>s("REPAIR_BOAT"),children:[o.jsx(u1,{size:18})," Reparer"]})]})})]}),o.jsx("div",{className:"absolute top-[45%] w-full h-px bg-white/5 shadow-[0_0_50px_rgba(255,255,255,0.1)] pointer-events-none"})]})},vO=N.memo(({stage:t,model:e,componentLevels:s,customization:n})=>o.jsxs("div",{className:"absolute inset-0 flex items-center justify-center p-12 overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 opacity-10 pointer-events-none mix-blend-multiply",style:{backgroundColor:"#1c1917",backgroundImage:"radial-gradient(circle at center, #292524 0%, #1c1917 100%)"}}),o.jsx(ee.div,{initial:{opacity:0,scale:.95,filter:"blur(2px)"},animate:{opacity:1,scale:1,filter:"blur(0px)"},transition:{duration:.8,ease:"easeInOut"},className:"w-full h-full relative z-10",children:o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(qm,{stage:t,model:e,componentLevels:s,customization:n,view:"side",variant:"standard",className:"opacity-100 drop-shadow-2xl"})})},e),o.jsx("div",{className:"absolute top-8 left-8 flex flex-col gap-1 pointer-events-none opacity-60",children:o.jsx("span",{className:"font-serif italic text-[#1e293b] text-sm",children:"Fig. 1: Lateral View"})}),o.jsxs("div",{className:"absolute bottom-8 right-8 text-right pointer-events-none opacity-60",children:[o.jsxs("div",{className:"font-serif font-bold text-[#1e293b] text-xs uppercase tracking-widest",children:["Model: ",(e==null?void 0:e.toUpperCase())||"UNKNOWN"]}),o.jsxs("div",{className:"font-mono text-[#57534e] text-[10px] mt-1",children:["REF: ",e?e.toUpperCase().split("").reduce((i,r)=>i+r.charCodeAt(0),0).toString(16).padEnd(4,"0").toUpperCase():"0000"]})]})]}),(t,e)=>t.stage===e.stage&&t.model===e.model&&t.componentLevels===e.componentLevels&&JSON.stringify(t.customization)===JSON.stringify(e.customization));vO.displayName="ShipyardVisualizer";const Uh={parchment:"#d6cbb8",inkPrimary:"#0c0a09"},bd=({onClick:t,children:e,disabled:s,variant:n="primary",className:i=""})=>{const r=n==="primary";return o.jsxs(ee.button,{whileHover:s?{}:{scale:1.02,y:-1},whileTap:s?{}:{scale:.98,y:1},onClick:t,disabled:s,className:`
                relative px-6 py-2 font-bold uppercase tracking-widest text-xs transition-all
                ${s?"opacity-40 cursor-not-allowed grayscale":"cursor-pointer"}
                ${i}
            `,style:{backgroundColor:r?Uh.inkPrimary:"transparent",color:r?Uh.parchment:Uh.inkPrimary,border:r?"none":`2px solid ${Uh.inkPrimary}`,borderRadius:"2px"},children:[!r&&o.jsx("svg",{className:"absolute inset-0 w-full h-full pointer-events-none overflow-visible",style:{opacity:.6},children:o.jsx("path",{d:"M0,0 L100%,0 L100%,100% L0,100% Z",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeDasharray:"4 2"})}),e]})},yO=({onClick:t,label:e,color:s="#b91c1c"})=>o.jsxs(ee.button,{whileHover:{scale:1.1},whileTap:{scale:.95},onClick:t,className:"flex flex-col items-center gap-2 group",children:[o.jsxs("div",{className:"w-16 h-16 rounded-full flex items-center justify-center shadow-lg relative",style:{background:`radial-gradient(circle at 30% 30%, ${s}, #7f1d1d)`,boxShadow:"0 4px 6px rgba(0,0,0,0.3), inset 0 2px 4px rgba(255,255,255,0.2)"},children:[o.jsx("div",{className:"absolute inset-0 border-4 border-dashed border-black/10 rounded-full opacity-50",style:{transform:"rotate(15deg)"}}),o.jsx("span",{className:"font-serif font-black text-white/90 text-xl drop-shadow-md",children:""})]}),e&&o.jsx("span",{className:"font-serif font-bold text-[10px] uppercase tracking-widest text-slate-600 transition-colors group-hover:text-amber-800",children:e})]}),pee=({title:t,level:e,maxLevel:s,description:n,effect:i,cost:r,playerResources:a,onAction:l,actionLabel:c="MONTERE"})=>{const u=e>=s;let d=!0;return u||Object.entries(r).forEach(([h,f])=>{(a[h]||0)<f&&(d=!1)}),o.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-[#a8a29e]/20 hover:bg-[#a8a29e]/5 transition-colors group relative",children:[o.jsxs("div",{className:"flex-1 pr-8",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[o.jsx("h4",{className:"font-serif font-bold text-lg text-[#292524]",children:t}),o.jsxs("span",{className:`text-xs font-black px-2 py-0.5 rounded border uppercase tracking-widest ${e>0?"bg-amber-900/10 text-amber-800 border-amber-900/10":"bg-stone-300/50 text-stone-600 border-stone-300"}`,children:["NIV ",e," ",o.jsxs("span",{className:"text-stone-500/80",children:["/ ",s]})]})]}),o.jsx("p",{className:"text-[#44403c] italic font-serif leading-snug mb-2 text-sm max-w-md",children:n}),i&&o.jsxs("div",{className:"text-emerald-700 font-bold text-[10px] uppercase tracking-wider flex items-center gap-2",children:[o.jsx(Db,{size:12}),i]})]}),o.jsx("div",{className:"flex flex-col items-end gap-3 min-w-[240px]",children:u?o.jsx("div",{className:"flex flex-col items-center justify-center py-2 px-6 border border-[#b45309]/30 rounded bg-[#b45309]/10 w-full",children:o.jsxs("span",{className:"text-[#aa5212] font-black uppercase tracking-[0.2em] text-[10px] flex items-center gap-2",children:[o.jsx(Db,{size:10,strokeWidth:3})," Mesterverk"]})}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex items-center justify-end gap-3 w-full",children:Object.entries(r).map(([h,f])=>{const m=(a[h]||0)>=f;return o.jsx("div",{className:"flex items-center gap-1.5 opacity-100",children:o.jsx(zi,{resource:h,amount:f,size:"sm",showLabel:!0,className:m?"text-[#292524]":"text-rose-700 font-bold"})},h)})}),o.jsx(bd,{onClick:l,disabled:!d,className:`w-full py-1.5 text-xs ${d?"":"opacity-50 cursor-not-allowed"}`,children:c})]})})]})},gee=({isOpen:t,onConfirm:e,onCancel:s,title:n,cost:i})=>t?o.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-8",children:o.jsxs(ee.div,{initial:{opacity:0,scale:.9,rotate:-2},animate:{opacity:1,scale:1,rotate:0},exit:{opacity:0,scale:.9},className:"bg-[#f2e8d5] p-8 w-full max-w-md shadow-2xl relative rotate-1 border border-[#b45309]/30",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.1'/%3E%3C/svg%3E")`},children:[o.jsx("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 w-32 h-8 bg-white/40 rotate-1 shadow-sm backdrop-blur-sm"}),o.jsxs("div",{className:"border-b-2 border-dashed border-[#292524]/20 pb-6 mb-6 text-center",children:[o.jsx("h3",{className:"font-serif font-black text-2xl uppercase tracking-widest text-[#2a1b12] mb-1",children:"Faktura"}),o.jsx("p",{className:"font-serif italic text-stone-600 text-sm",children:"Kongelig Skipsverft"})]}),o.jsxs("div",{className:"space-y-6 mb-8",children:[o.jsxs("div",{className:"flex justify-between items-baseline border-b border-stone-300 pb-2",children:[o.jsx("span",{className:"font-bold text-stone-500 text-sm uppercase tracking-wide",children:"Vare"}),o.jsx("span",{className:"font-serif font-bold text-lg text-[#292524]",children:n})]}),o.jsxs("div",{className:"bg-[#e7ded0] p-4 rounded-sm border border-[#d6cbb8]",children:[o.jsx("div",{className:"text-xs font-black uppercase tracking-widest text-[#b45309] mb-3 text-center",children:"Kostnader"}),o.jsx("div",{className:"flex flex-wrap justify-center gap-4 text-[#292524]",children:Object.entries(i).map(([r,a])=>o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(zi,{resource:r,amount:a,size:"sm",showLabel:!0,className:"text-[#292524]"})},r))})]})]}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("button",{onClick:s,className:"flex-1 py-3 border-2 border-[#292524]/20 font-bold uppercase tracking-widest text-xs text-[#57534e] hover:bg-[#292524]/5 transition-colors",children:"Avsl"}),o.jsx(bd,{onClick:e,className:"flex-1 py-3",variant:"primary",children:"Signer"})]})]})}):null,xee=[{id:"construct",label:"Construction",icon:tc},{id:"upgrade",label:"The Ledger",icon:hX},{id:"models",label:"Models",icon:i0},{id:"cosmetics",label:"Aesthetics",icon:bQ}],bee=({player:t,onClose:e,onAction:s})=>{var d,h,f,m,b,x,v,g,p,y,k,w,S,_,T,E,A,j,O,H,G,L,M;const[n,i]=N.useState("construct"),r={stage:((d=t.boat)==null?void 0:d.stage)??0,hullType:((h=t.boat)==null?void 0:h.hullType)??"oak_standard",model:((f=t.boat)==null?void 0:f.model)??"standard",hp:(m=t.boat)==null?void 0:m.hp,maxHp:((b=t.boat)==null?void 0:b.maxHp)||((v=Zp[(x=t.boat)==null?void 0:x.model])==null?void 0:v.baseHp)||100,componentLevels:{sails:((p=(g=t.boat)==null?void 0:g.componentLevels)==null?void 0:p.sails)??0,hull:((k=(y=t.boat)==null?void 0:y.componentLevels)==null?void 0:k.hull)??0,cannons:((S=(w=t.boat)==null?void 0:w.componentLevels)==null?void 0:S.cannons)??0,nets:((T=(_=t.boat)==null?void 0:_.componentLevels)==null?void 0:T.nets)??0},customization:{color:((A=(E=t.boat)==null?void 0:E.customization)==null?void 0:A.color)??"#4b2c20",flagId:((O=(j=t.boat)==null?void 0:j.customization)==null?void 0:O.flagId)??"none",figurehead:((G=(H=t.boat)==null?void 0:H.customization)==null?void 0:G.figurehead)??"none",unlocked:Array.isArray((M=(L=t.boat)==null?void 0:L.customization)==null?void 0:M.unlocked)?t.boat.customization.unlocked:[]}},[a,l]=N.useState(null),c=(D,I,F)=>{["BUY_BOAT_MODEL","BUY_BOAT_COSMETIC"].includes(D.type)&&F&&Object.keys(F).length>0?l({action:D,label:I||"Ukjent Vare",cost:F}):s(D)},u=()=>{a&&(s(a.action),l(null))};return o.jsx(zn,{title:"",onClose:e,maxWidth:"max-w-7xl",hideHeader:!0,noPadding:!0,children:o.jsxs("div",{className:"flex flex-col h-[700px] w-full overflow-hidden rounded-b-xl shadow-2xl bg-[#0f0a05] relative",children:[o.jsx(qt,{children:a&&o.jsx(gee,{isOpen:!0,title:a.label,cost:a.cost,onConfirm:u,onCancel:()=>l(null)})}),o.jsxs("div",{className:"h-24 bg-[#2a1b12] flex items-center justify-between px-10 border-b border-[#453020] relative z-20 shadow-xl",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsx(i0,{className:"text-amber-500 drop-shadow-md",size:40}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-serif font-black text-[#e7ded0] uppercase tracking-[0.2em] leading-none",children:["Kongelig ",o.jsx("span",{className:"text-amber-500",children:"Skipsverft"})]}),o.jsx("div",{className:"h-1 w-16 bg-amber-600 mt-2 rounded-full opacity-60"})]})]}),o.jsx("div",{className:"flex gap-2 h-full pt-6 pr-12 relative z-30",children:xee.map(D=>{const F=!(D.id==="construct")&&r.stage<4,U=n===D.id;return o.jsxs("button",{type:"button",onClick:()=>i(D.id),disabled:F,className:`
                                        flex items-center gap-3 px-8 h-full rounded-t-lg transition-all group relative overflow-hidden
                                        ${U?"bg-[#d6cbb8] text-[#2a1b12] shadow-[0_-5px_20px_rgba(0,0,0,0.3)] scale-y-110 translate-y-1":"bg-transparent text-[#a8a29e] hover:bg-[#453020] hover:text-[#e7ded0]"}
                                        ${F?"opacity-30 cursor-not-allowed grayscale":""}
                                    `,children:[o.jsx(D.icon,{size:18,className:U?"text-[#b45309]":"text-[#57534e] group-hover:text-[#e7ded0]"}),o.jsx("span",{className:"font-serif font-bold uppercase tracking-widest text-sm",children:{Construction:"Konstruksjon","The Ledger":"Loggbok",Models:"Modeller",Aesthetics:"Estetikk"}[D.label]})]},D.id)})}),o.jsx("button",{onClick:e,className:"absolute top-6 right-6 w-10 h-10 bg-black/20 hover:bg-rose-900/40 text-[#a8a29e] hover:text-rose-400 rounded-full flex items-center justify-center transition-all group border border-white/5 z-50 backdrop-blur-sm",title:"Lukk Vinduet",children:o.jsx("span",{className:"text-xl group-hover:rotate-90 transition-transform",children:""})})]}),o.jsxs("div",{className:"flex-1 grid grid-cols-[40%_60%] min-h-0 overflow-hidden bg-[#0c0a09]",children:[o.jsxs("div",{className:"relative border-r border-[#292524] bg-[#1c1917]",children:[o.jsx("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='100' height='20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 10 Q25 20 50 10 T100 10' fill='none' stroke='%2338bdf8' opacity='0.05'/%3E%3C/svg%3E")`}}),o.jsx("div",{className:"h-full flex items-center justify-center p-8 relative z-10",children:o.jsx(vO,{stage:r.stage,model:r.model,componentLevels:r.componentLevels,customization:r.customization})}),o.jsx("div",{className:"absolute bottom-6 left-0 right-0 text-center z-20",children:o.jsxs("span",{className:"font-serif italic text-[#57534e] text-sm opacity-50",children:["Fig. ",r.model.toUpperCase()]})})]}),o.jsxs("div",{className:"relative bg-[#d6cbb8] flex flex-col h-full overflow-hidden shadow-[inset_10px_0_30px_rgba(0,0,0,0.3)]",children:[o.jsx("div",{className:"absolute inset-0 opacity-[0.08] pointer-events-none mix-blend-multiply",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E")`}}),o.jsx("div",{className:"flex-1 overflow-hidden p-8 relative z-10",children:o.jsxs("div",{className:"h-full relative overflow-hidden",children:[n==="construct"&&o.jsx(vee,{boat:r,player:t,onAction:c}),n==="upgrade"&&o.jsx(yee,{boat:r,player:t,onAction:c}),n==="models"&&o.jsx(_ee,{boat:r,player:t,onAction:c}),n==="cosmetics"&&o.jsx(kee,{boat:r,onAction:c})]})})]})]})]})})},vee=({boat:t,player:e,onAction:s})=>{if(console.log("[Shipyard] Rendering ConstructionView",{boat:t,stage:t==null?void 0:t.stage,player:e}),!e||!t)return console.error("[Shipyard] ConstructionView missing props",{player:e,boat:t}),o.jsx("div",{className:"p-8 text-red-500 font-bold",children:"Error: Missing Data"});const n=t.stage??0,i=["Kjlstrekking","Mast & Rigg","Dekk & Detaljer","Sjsetting"][n]||"Ukjent Fase",r=n<4?{stage:n+1,name:i,reqs:[{plank:20},{plank:40,linen_canvas:10},{plank:30,iron_ingot:10},{plank:50,tar:20}][n]||{}}:null,a=n>=4,l=t.hp??t.maxHp??100,c=t.maxHp??100,u=l/c*100,d=l<c,h=c-l,f=Math.ceil(h/10),m=d?{plank:f,tar:f}:{};return o.jsxs("div",{className:"p-8 flex flex-col gap-6 h-full overflow-y-auto scrollbar-thin scrollbar-thumb-stone-400 scrollbar-track-transparent",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-4xl font-serif font-black uppercase text-amber-900 tracking-[0.2em] mb-2 drop-shadow-sm",children:a?"VEDLIKEHOLD":`FASE ${n+1}`}),o.jsx("p",{className:"text-stone-700 font-serif italic text-lg tracking-wide",children:a?"Verft & Reparasjon":r==null?void 0:r.name})]}),a&&o.jsxs("div",{className:"bg-[#292524] rounded-sm p-6 border border-white/5 relative overflow-hidden group shadow-lg",children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsxs("span",{className:"text-sm font-bold text-stone-400 uppercase tracking-widest font-serif flex items-center gap-2",children:[o.jsx(XX,{size:14,className:d?"text-rose-500":"text-emerald-500"}),"Skrog Integritet"]}),o.jsxs("span",{className:`font-mono text-lg font-bold ${d?"text-rose-500":"text-emerald-500"}`,children:[l," / ",c," HP"]})]}),o.jsxs("div",{className:"h-4 bg-black/40 rounded-full overflow-hidden mb-8 border border-white/5 relative",children:[o.jsx("div",{className:"absolute inset-0 flex justify-between px-1 opacity-20",children:[...Array(9)].map((b,x)=>o.jsx("div",{className:"w-[1px] h-full bg-white"},x))}),o.jsx("div",{className:`h-full transition-all duration-1000 ease-out relative ${d?"bg-rose-600":"bg-emerald-600"}`,style:{width:`${u}%`},children:o.jsx("div",{className:"absolute inset-0 bg-white/10"})})]}),d?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6 p-4 bg-black/20 rounded border border-white/5",children:[o.jsx("span",{className:"text-stone-400 text-sm font-serif italic",children:"Reparasjonskostnad:"}),o.jsxs("div",{className:"flex gap-4",children:[o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(zi,{resource:"plank",size:"sm",amount:m.plank,className:e.resources.plank>=f?"text-[#e7ded0]":"text-rose-500 font-bold"})}),o.jsx("div",{className:"flex items-center gap-2",children:o.jsx(zi,{resource:"tar",size:"sm",amount:m.tar,className:e.resources.tar>=f?"text-[#e7ded0]":"text-rose-500 font-bold"})})]})]}),o.jsx(bd,{onClick:()=>s({type:"REPAIR_BOAT"},"Reparer Skrog",m),disabled:(e.resources.plank||0)<f||(e.resources.tar||0)<f,className:"w-full py-4 text-sm",children:"Utfr Reparasjon"})]}):o.jsxs("div",{className:"flex flex-col items-center justify-center py-6 gap-4 opacity-80",children:[o.jsx(yO,{label:"GODKJENT",color:"#10b981"}),o.jsx("span",{className:"text-emerald-500/50 text-xs font-black tracking-[0.3em] uppercase",children:"Ingen feil funnet"})]})]}),!a&&r&&o.jsxs("div",{className:"bg-[#292524] rounded-sm p-6 border border-white/5 relative overflow-hidden group shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{className:"flex justify-between items-center mb-8 border-b border-white/5 pb-4",children:[o.jsx("span",{className:"text-sm font-bold text-stone-400 uppercase tracking-widest font-serif",children:"Ndvendige Materialer"}),o.jsxs("span",{className:"font-serif font-bold text-[#b45309] text-lg",children:["Steg ",r.stage,"/4"]})]}),o.jsx("div",{className:"grid grid-cols-2 gap-6 mb-8",children:Object.entries(r.reqs).map(([b,x])=>{const v=e.resources[b]||0,g=v>=x;return o.jsxs("div",{className:`flex justify-between items-center pb-2 border-b ${g?"border-green-800/20":"border-red-800/20"}`,children:[o.jsx(zi,{resource:b,size:"sm",showLabel:!0}),o.jsxs("span",{className:`font-mono text-lg font-bold ${g?"text-green-500":"text-red-500"}`,children:[v," / ",x]})]},b)})}),o.jsx(bd,{onClick:()=>s({type:"CONTRIBUTE_TO_BOAT",stage:r.stage,resources:r.reqs}),className:"w-full py-5 text-base",children:"Start Bygging"})]})]})},yee=({boat:t,player:e,onAction:s})=>o.jsx("div",{className:"flex flex-col pb-10 overflow-y-auto max-h-[600px] scrollbar-thin scrollbar-thumb-[#b45309]/20 px-4",children:Object.entries(A_).map(([n,i])=>{const r=t.componentLevels[n]||0,a=i.levels.length,l=i.levels[r];return o.jsx(pee,{title:i.name,level:r,maxLevel:a,description:i.description,effect:l==null?void 0:l.effect,cost:(l==null?void 0:l.cost)||{},playerResources:e.resources,onAction:()=>s({type:"UPGRADE_BOAT_COMPONENT",componentId:n})},n)})}),_ee=({boat:t,player:e,onAction:s})=>o.jsx("div",{className:"flex flex-col gap-6 p-6 overflow-y-auto h-full scrollbar-thin scrollbar-thumb-stone-400 scrollbar-track-transparent",children:Object.values(Zp).map(n=>{const i=t.model===n.id;return o.jsxs("div",{className:`relative p-8 rounded border transition-all ${i?"bg-[#e7ded0] border-[#b45309]":"bg-[#e0d5c1] border-[#c0b39c]"}`,children:[i&&o.jsx("div",{className:"absolute top-4 right-4 text-[#b45309] opacity-20",children:o.jsx(i0,{size:80})}),o.jsxs("div",{className:"flex justify-between items-start relative z-10",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:`text-2xl font-black uppercase tracking-[0.1em] mb-2 font-serif ${i?"text-amber-700":"text-stone-800"}`,children:n.name}),o.jsxs("div",{className:"flex gap-6 text-xs font-mono text-stone-600 mb-6 uppercase tracking-widest",children:[o.jsxs("span",{className:"flex items-center gap-1 font-bold",children:[o.jsx(QI,{size:14})," ",n.baseHp," HP"]}),o.jsxs("span",{className:"flex items-center gap-1 font-bold",children:[o.jsx(lO,{size:14})," ",n.baseSpeed," KNOP"]})]}),o.jsxs("p",{className:"text-base text-stone-700 max-w-lg italic border-l-4 border-[#292524]/10 pl-4 py-1 mb-4",children:['"',n.description,'"']})]}),i?o.jsx("div",{className:"flex flex-col items-center justify-center h-full pl-8",children:o.jsx(yO,{label:"Aktiv",color:"#b45309"})}):o.jsxs("div",{className:"text-right flex flex-col items-end gap-3 pl-8 min-w-[200px]",children:[o.jsx(bd,{onClick:()=>s({type:"BUY_BOAT_MODEL",modelId:n.id},`Kjp Skjte: ${n.name}`,n.cost),className:"mb-2 w-full py-3 text-sm",children:"Kjp Skjte"}),o.jsx("div",{className:"flex flex-wrap justify-end gap-2 mt-2",children:Object.entries(n.cost).map(([r,a])=>{const c=(e.resources[r]||0)>=a;return o.jsx("div",{className:`bg-stone-800/10 rounded px-2 py-1 ${c?"":"bg-rose-900/10 border border-rose-900/30"}`,children:o.jsx(zi,{resource:r,amount:a,size:"sm",className:c?"text-[#292524]":"text-rose-700 font-bold"})},r)})})]})]})]},n.id)})}),wee=t=>o.jsx(bee,{...t}),kee=({boat:t,onAction:e})=>o.jsx("div",{className:"p-6 space-y-8 overflow-y-auto max-h-[600px]",children:o.jsxs("div",{children:[o.jsx("h4",{className:"text-xs font-black text-stone-700 uppercase tracking-[0.2em] mb-6 border-b border-stone-400/30 pb-2 font-serif",children:"Skrogmaling"}),o.jsx("div",{className:"flex gap-4 flex-wrap",children:Nu.colors.map(s=>{var r,a;const n=t.customization.unlocked.includes(s.id)||((r=s.cost)==null?void 0:r.gold)===void 0,i=t.customization.color===s.hex;return o.jsxs("button",{onClick:()=>e({type:"BUY_BOAT_COSMETIC",cosmeticType:"color",id:s.id},`Maling: ${s.name}`,n?{}:s.cost),className:`relative w-16 h-16 rounded shadow-sm transition-all ${i?"ring-4 ring-amber-600 ring-offset-2 ring-offset-[#d6cbb8] scale-105":"hover:scale-105 ring-1 ring-stone-900/10"}`,style:{backgroundColor:s.hex},title:s.name,children:[!n&&o.jsx("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center rounded",children:o.jsxs("span",{className:"text-[10px] text-white font-bold bg-black/50 px-1.5 py-0.5 rounded backdrop-blur-sm",children:[(a=s.cost)==null?void 0:a.gold,"g"]})}),i&&o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(Rc,{size:28,className:"text-white drop-shadow-md",strokeWidth:3})})]},s.id)})})]})}),_O=({player:t,room:e,world:s,worldEvents:n,players:i,onAction:r,onOpenMarket:a})=>{var se,le,ke,we;const l=(s==null?void 0:s.season)||"Spring",{viewMode:c,setViewMode:u,viewingRegionId:d,setViewingRegionId:h,selectedPOI:f,setSelectedPOI:m,selectedEvent:b,setSelectedEvent:x,upgradingBuildingId:v,setUpgradingBuildingId:g,dialogNPC:p,setDialogNPC:y,dialogStep:k,setDialogStep:w,isDiceGameOpen:S,setIsDiceGameOpen:_,isChickenCoopOpen:T,setIsChickenCoopOpen:E,isConstructionOpen:A,setIsConstructionOpen:j,isTaxationOpen:O,setIsTaxationOpen:H,isGambleGameOpen:G,setIsGambleGameOpen:L,isGrainGameOpen:M,setIsGrainGameOpen:D,isShipyardOpen:I,setIsShipyardOpen:F,isWharfUpgradeOpen:U,setIsWharfUpgradeOpen:R,isFlaxGameOpen:C,setIsFlaxGameOpen:$,direction:V,handlePOIAction:P}=RZ(t,r,a),W=(s==null?void 0:s.weather)||"Clear",Y=(()=>{var K,Ae,Et,Mt,Wt;const Q=xa(((K=e.world)==null?void 0:K.gameTick)||0)==="NIGHT",Z=l==="Winter";let B="";switch(c){case"kingdom":B=Z?Q?"map_kingdom_169_winter_night":"map_kingdom_169_winter":Q?"map_kingdom_169_night":"map_kingdom_169";break;case"village":B=Z?Q?"map_village_hub_1610_winter_night":"map_village_hub_1610_winter":Q?"map_village_hub_1610_night":"map_village_hub_1610";break;case"castle":B="map_castle_interior";break;case"fields":B=Z?Q?"map_farm_fields_winter_night":"map_farm_fields_winter":Q?"map_farm_fields_night":"map_farm_fields";break;case"peasant_farm":{const it=((Et=(Ae=t.buildings)==null?void 0:Ae.farm_house)==null?void 0:Et.level)||1;B=it>1?`map_peasant_farm_lvl${it}`:"map_peasant_farm";break}case"farm_house":{const it=((Wt=(Mt=t.buildings)==null?void 0:Mt.farm_house)==null?void 0:Wt.level)||1;B=it>1?`map_stugo_interior_lvl${it}`:"map_stugo_interior";break}case"mine":B=Z?Q?"map_mountain_pass_winter_night":"map_mountain_pass_winter":Q?"map_mountain_pass_night":"map_mountain_pass";break;case"forest":B=Z?Q?"map_forest_winter_night":"map_forest_winter":Q?"map_forest_night":"map_forest";break;case"monastery":B=Z?Q?"map_monastery_winter_night":"map_monastery_winter":Q?"map_monastery_night":"map_monastery";break;case"tavern":B="map_tavern_interior";break;case"great_forge":B="map_forge_interior";break;case"bakery":B="map_bakery_interior";break;case"windmill":B="map_windmill_interior";break;case"sawmill":B="map_sawmill_interior";break;case"smeltery":B="map_smeltery_interior";break;case"weavery":B="map_weavery_interior";break;case"stables":B="map_stables_interior";break;case"watchtower":B="map_watchtower_interior";break;case"well":B=Z?Q?"map_well_interior_winter_night":"map_well_interior_winter":Q?"map_well_interior_night":"map_well_interior";break;case"apothecary":B="map_apothecary_interior";break;case"global":d==="region_ost"?B=Z?Q?"map_barony_ost_169_winter_night":"map_barony_ost_169_winter":Q?"map_barony_ost_169_night":"map_barony_ost_169":d==="capital"?B=Z?Q?"map_hovedstad_169_winter_night":"map_hovedstad_169_winter":Q?"map_hovedstad_169_night":"map_hovedstad_169":B=Z?Q?"map_barony_vest_v2_1610_winter_night":"map_barony_vest_v2_1610_winter":Q?"map_barony_vest_v2_1610_night":"map_barony_vest_v2_1610";break;case"dock":B=`map_dock_${l.toLowerCase()}_${Q?"night":"day"}`;break;default:B="map_barony_vest_v2_1610"}const ae="/Simulation_StandAlone_Pro/";return{src:`${ae}${B}.webp`,placeholder:`${ae}${B}_tiny.webp`,original:`${ae}${B}.png`}})(),fe=c==="kingdom"||c==="global"&&(d==="region_ost"||d==="capital")?"aspect-video":"aspect-[16/10]",ce={initial:Q=>({opacity:0,scale:Q==="in"?.9:1.1,filter:"blur(10px)"}),animate:{opacity:1,scale:1,filter:"blur(0px)",transition:{duration:.6,ease:[.16,1,.3,1],staggerChildren:.05}},exit:Q=>({opacity:0,scale:Q==="in"?1.1:.9,filter:"blur(10px)",transition:{duration:.4,ease:[.7,0,.84,0]}})},ne=`${c}-${d}`,Le=N.useMemo(()=>Br.find(Q=>Q.id===c),[c]),lt=!!(Le!=null&&Le.isInterior);return o.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center p-0",children:[o.jsxs("div",{className:`relative w-full max-w-full max-h-full mx-auto ${fe} rounded-[2rem] overflow-hidden shadow-[0_0_80px_rgba(0,0,0,0.5)] border-4 border-white/5 bg-slate-950 transition-all duration-1000`,children:[o.jsx(qt,{mode:"popLayout",custom:V,children:o.jsxs(ee.div,{custom:V,variants:ce,initial:"initial",animate:"animate",exit:"exit",className:"absolute inset-0 w-full h-full",children:[o.jsxs("div",{className:"w-full h-full relative",children:[o.jsx(m1,{src:Y.src,placeholderSrc:Y.placeholder,alt:"Map View",className:`w-full h-full ${d!==t.regionId?"grayscale-[0.8] sepia-[0.2] brightness-125 contrast-125":""}`,disableMotion:!0}),o.jsx("div",{className:`absolute inset-0 pointer-events-none transition-opacity duration-1000 ${W==="Fog"?"opacity-100 backdrop-blur-sm bg-white/10":"opacity-0"}`}),d!==t.regionId&&o.jsx("div",{className:"absolute inset-0 pointer-events-none border-[20px] border-indigo-500/10 shadow-[inset_0_0_100px_rgba(79,70,229,0.3)] z-50 flex items-start justify-center pt-8",children:o.jsxs("div",{className:"bg-indigo-600/20 backdrop-blur-md border border-indigo-400/30 px-6 py-2 rounded-full flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 bg-indigo-400 rounded-full animate-pulse"}),o.jsx("span",{className:"text-[10px] font-black text-indigo-200 uppercase tracking-[0.2em]",children:"Remote View"})]})})]}),c==="dock"&&o.jsx("div",{className:"absolute inset-0 z-30",children:o.jsx(mee,{player:t,world:{season:l,weather:W,time:xa(((se=e.world)==null?void 0:se.gameTick)||0)==="NIGHT"?"Night":"Day"},onAction:Q=>P("dock",Q)})}),c==="farm_house"&&o.jsxs("div",{className:"absolute bottom-[70%] left-[10%] w-[18%] h-auto z-20 cursor-pointer hover:scale-105 hover:brightness-110 transition-all drop-shadow-2xl opacity-90 hover:opacity-100",onClick:()=>r("OPEN_WEAPON_RACK"),title:"pne Vpenstativet",children:[o.jsx("div",{className:"absolute -inset-4 bg-black/40 blur-xl rounded-full"}),o.jsx("div",{className:"relative",children:o.jsx(bO,{level:((le=t.weaponRack)==null?void 0:le.level)||0,slots:((ke=t.weaponRack)==null?void 0:ke.slots)||[]})})]}),o.jsx(tee,{weather:W,season:l,isInterior:lt}),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[c==="kingdom"&&o.jsx(uee,{players:i||{},setViewingRegionId:h,setViewMode:u,currentUserId:t.id}),o.jsx(lee,{viewMode:c,viewingRegionId:d,player:t,room:e,onSelect:m,onEnterHub:u,onPOIAction:Q=>P(c,Q)}),o.jsx(cee,{viewMode:c,viewingRegionId:d,worldEvents:n,onSelect:x})]})]},ne)}),o.jsx(see,{player:t,room:e}),c!=="kingdom"&&o.jsxs("button",{onClick:()=>{if(c==="global")u("kingdom");else{const Q=Br.find(Z=>Z.id===c);Q!=null&&Q.parentId?u(Q.parentId):u("global")}},className:"absolute top-6 left-6 z-50 px-6 py-3 bg-slate-950/80 backdrop-blur-md border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest text-slate-400 hover:text-white hover:border-white/20 transition-all active:scale-95 flex items-center gap-2 group",children:[o.jsx("span",{className:"text-lg group-hover:-translate-x-1 transition-transform",children:""}),"Tilbake"]}),b&&o.jsx("div",{className:"absolute inset-x-6 bottom-6 z-40 animate-in slide-in-from-bottom-8 duration-500",children:o.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-2xl rounded-[2.5rem] shadow-[0_30px_100px_rgba(0,0,0,0.8)] border border-white/10 p-8",children:[o.jsxs("div",{className:"flex justify-between items-start mb-6",children:[o.jsxs("div",{children:[o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest px-3 py-1 rounded-full ${b.type==="RAID"?"bg-rose-500/20 text-rose-400":"bg-amber-500/20 text-amber-500"}`,children:b.type==="RAID"?" Akutt Trussel":" Spesielt Oppdrag"}),o.jsx("h3",{className:"text-3xl font-black text-white mt-4 tracking-tighter",children:b.title})]}),o.jsx("button",{onClick:()=>x(null),className:"w-10 h-10 bg-white/5 hover:bg-white/10 text-white rounded-full flex items-center justify-center transition-colors",children:""})]}),o.jsxs("p",{className:"text-sm font-medium text-slate-400 mb-8 leading-relaxed italic opacity-80",children:['"',b.description,'"']}),o.jsx("button",{onClick:()=>{r({type:b.type==="RAID"?"DEFEND":"EXPLORE",eventId:b.id}),x(null)},className:`w-full py-5 rounded-2xl font-black uppercase tracking-widest text-sm shadow-2xl transition-all active:scale-95 ${b.type==="RAID"?"bg-rose-600 text-white shadow-rose-600/20":"bg-amber-500 text-slate-950 shadow-amber-500/20"}`,children:b.type==="RAID"?"TIL VPEN! ":"UTFORSK OMRDET! "})]})}),o.jsx(qt,{children:f&&o.jsx(eee,{poi:f,player:t,room:e,onAction:Q=>P(f.id,Q),onClose:()=>m(null),viewingRegionId:d})})]}),o.jsxs(qt,{children:[v&&o.jsx(zn,{title:"Bygg & Oppgrader",onClose:()=>g(null),children:o.jsx(aee,{buildingId:v,player:t,room:e,onAction:r})}),S&&o.jsx(IZ,{playerGold:((we=t.resources)==null?void 0:we.gold)||0,onClose:()=>_(!1),onPlay:Q=>r({type:"PLAY_DICE",...Q})}),G&&o.jsx(OZ,{player:t,onClose:()=>L(!1),onPlay:Q=>r({type:"PLAY_RESOURCE_GAME",...Q})}),M&&o.jsx(zn,{title:"Kornhsting",onClose:()=>D(!1),maxWidth:"max-w-xl",children:o.jsx(hl,{resourceName:"Korn",possibleYield:12,equipment:Object.values(t.equipment||{}),onComplete:Q=>{r({type:"HARVEST",locationId:"grain_fields",cropId:"grain",performance:Q}),D(!1)}})}),T&&o.jsx(ree,{player:t,activeProcesses:t.activeProcesses||[],onAction:r,onClose:()=>E(!1)}),p&&o.jsx(oee,{npc:p,step:k,setStep:w,onClose:()=>y(null)}),A&&o.jsx(bT,{player:t,room:e,onAction:r,onClose:()=>j(!1),viewingRegionId:d}),O&&o.jsx(iee,{player:t,room:e,onAction:r,onClose:()=>H(!1)}),I&&o.jsx(wee,{player:t,room:e,onClose:()=>F(!1),onAction:r}),U&&o.jsx(bT,{player:t,room:e,onAction:r,onClose:()=>R(!1),viewingRegionId:"dock_hub",initialProjectId:"wharf"}),C&&o.jsx(zn,{title:"Linhsting",onClose:()=>$(!1),maxWidth:"max-w-xl",children:o.jsx(hl,{resourceName:"Lin",possibleYield:12,equipment:Object.values(t.equipment||{}),onComplete:Q=>{r({type:"HARVEST",locationId:"flax_field",cropId:"flax",performance:Q}),$(!1)}})})]})]})};_O.displayName="GameMap";function jn(t){return Se.lazy(async()=>{try{return await t()}catch(e){if(/failed to fetch dynamically imported module/i.test(e.message)||/loading chunk/i.test(e.message)||/dynamic import/i.test(e.message)||e.name==="TypeError"&&/fetch/i.test(e.message)){const n="last_chunk_reload",i=Date.now(),r=parseInt(localStorage.getItem(n)||"0",10);if(i-r>1e4)return localStorage.setItem(n,i.toString()),console.warn("Chunk load error detected. Reloading application to fetch latest version..."),window.location.reload(),new Promise(()=>{})}throw e}})}const Nee=({onClose:t})=>{const{currentTrackId:e,playlist:s,playNext:n,playPrevious:i,toggleIgnoreTrack:r,isIgnored:a,playMusic:l,stopMusic:c}=S_(),[u,d]=N.useState(!!e),h=s.find(m=>m.id===e)||s[0],f=()=>{u&&e?(c(),d(!1)):(e?l(e):n(),d(!0))};return o.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center p-4",children:[o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/60 backdrop-blur-sm cursor-pointer"}),o.jsxs(ee.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",bounce:.3},className:"relative w-full max-w-4xl h-[600px] bg-slate-950/80 backdrop-blur-2xl border border-white/10 rounded-[3rem] shadow-2xl overflow-hidden flex flex-col md:flex-row",children:[o.jsx("button",{onClick:t,className:"absolute top-6 right-6 z-20 p-2 rounded-full bg-white/5 hover:bg-white/10 text-white transition-colors",children:o.jsx(Yn,{size:24})}),o.jsxs("div",{className:"flex-1 relative flex flex-col items-center justify-center p-12 bg-gradient-to-br from-indigo-900/40 to-slate-900/40 border-r border-white/5",children:[o.jsx("div",{className:`absolute inset-0 opacity-30 bg-gradient-to-tr ${(h==null?void 0:h.mood)==="Dark"?"from-rose-900/40":"from-indigo-600/20"} to-transparent transition-colors duration-1000`}),o.jsxs("div",{className:"relative z-10 mb-12 group",children:[o.jsxs("div",{className:`w-64 h-64 rounded-full bg-slate-900 border-4 border-white/10 shadow-[0_0_60px_rgba(0,0,0,0.6)] flex items-center justify-center relative overflow-hidden ${u&&e?"animate-[spin_8s_linear_infinite]":""}`,children:[o.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle,rgba(99,102,241,0.2)0%,transparent_70%)]"}),o.jsx("div",{className:"absolute inset-2 rounded-full border border-white/5 opacity-50"}),o.jsx("div",{className:"absolute inset-8 rounded-full border border-white/5 opacity-30"}),o.jsx(PX,{size:64,className:"text-white/20"})]}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:o.jsx("button",{onClick:f,className:"w-20 h-20 bg-white/90 rounded-full flex items-center justify-center shadow-2xl hover:scale-105 active:scale-95 transition-all text-slate-900",children:u&&e?o.jsx(Ob,{size:32,fill:"currentColor"}):o.jsx(pd,{size:32,fill:"currentColor",className:"ml-1"})})})]}),o.jsxs("div",{className:"text-center space-y-2 z-10",children:[o.jsx("p",{className:"text-xs font-black uppercase tracking-[0.3em] text-indigo-400",children:"N Spiller"}),o.jsx("h2",{className:"text-3xl font-black text-white tracking-tighter max-w-sm leading-tight",children:h?h.title:"Ingen Musikk"}),(h==null?void 0:h.mood)&&o.jsxs("span",{className:"inline-block px-3 py-1 bg-white/5 rounded-full text-[10px] font-bold text-slate-400 uppercase tracking-widest border border-white/5",children:[h.mood," Mood"]})]})]}),o.jsxs("div",{className:"w-full md:w-[400px] bg-black/20 flex flex-col",children:[o.jsxs("div",{className:"p-8 pb-4 border-b border-white/5 flex items-center justify-between",children:[o.jsxs("h3",{className:"text-sm font-black text-white uppercase tracking-widest flex items-center gap-2",children:[o.jsx(mQ,{size:16,className:"text-indigo-400"})," Spilleliste"]}),o.jsxs("span",{className:"text-[10px] font-bold text-slate-500",children:[s.length," Spor"]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-6 space-y-2",children:s.map((m,b)=>{const x=e===m.id,v=a(m.id);return o.jsxs("div",{className:`group flex items-center justify-between p-4 rounded-xl border transition-all duration-300 ${x?"bg-indigo-600/10 border-indigo-500/50 shadow-lg shadow-indigo-900/20":v?"bg-transparent border-transparent opacity-40 grayscale hover:opacity-100 hover:bg-slate-800/50":"bg-transparent border-transparent hover:bg-white/5 hover:border-white/5"}`,children:[o.jsxs("button",{onClick:()=>{l(m.id),d(!0)},className:"flex items-center gap-4 flex-1 text-left min-w-0",children:[o.jsx("span",{className:`text-xs font-bold w-6 text-center ${x?"text-indigo-400":"text-slate-600"}`,children:x?o.jsx(iJ,{size:14,className:"mx-auto animate-pulse"}):b+1}),o.jsx("div",{className:"min-w-0",children:o.jsx("p",{className:`text-sm font-bold truncate ${x?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:m.title})})]}),o.jsx("button",{onClick:g=>{g.stopPropagation(),r(m.id)},className:`p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-all ${v?"opacity-100 text-rose-400 hover:bg-rose-500/10":"text-slate-500 hover:text-white hover:bg-white/10"}`,title:v?"Gjenoppta":"Ignorer",children:v?o.jsx(BX,{size:16}):o.jsx(UX,{size:16})})]},m.id)})}),o.jsxs("div",{className:"p-6 border-t border-white/5 bg-black/40 flex items-center justify-between",children:[o.jsx("button",{onClick:i,className:"p-4 rounded-full hover:bg-white/5 text-slate-400 hover:text-white transition-colors",children:o.jsx(DQ,{size:20})}),o.jsx("div",{className:"h-10 w-[1px] bg-white/5"}),o.jsx("button",{onClick:f,className:"p-4 rounded-full hover:bg-white/5 text-white transition-colors scale-110 active:scale-95",children:u&&e?o.jsx(Ob,{size:24,fill:"currentColor"}):o.jsx(pd,{size:24,fill:"currentColor",className:"ml-1"})}),o.jsx("div",{className:"h-10 w-[1px] bg-white/5"}),o.jsx("button",{onClick:n,className:"p-4 rounded-full hover:bg-white/5 text-slate-400 hover:text-white transition-colors",children:o.jsx(PQ,{size:20})})]})]})]})]})},See=({result:t,onClear:e})=>(N.useEffect(()=>{if(t){t.success&&t.utbytte&&t.utbytte.length>0&&t.utbytte.forEach((n,i)=>{n.amount>0&&setTimeout(()=>{Xe.spawnFlyingResource(n.resource,window.innerWidth/2,window.innerHeight/2,window.innerWidth-150,60)},i*200)});const s=setTimeout(()=>{e()},6e3);return()=>clearTimeout(s)}},[t,e]),o.jsx(qt,{children:t&&o.jsxs(ee.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},className:"fixed top-[5%] left-1/2 transform -translate-x-1/2 bg-slate-900/95 border-2 border-amber-500/30 p-5 rounded-[2rem] shadow-[0_0_50px_rgba(0,0,0,0.5)] backdrop-blur-md min-w-[300px] text-center z-[300] overflow-hidden",children:[o.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-amber-500/20 w-full overflow-hidden",children:o.jsx(ee.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:7,ease:"linear"},className:"h-full bg-amber-500"})}),o.jsx("button",{onClick:s=>{s.stopPropagation(),e()},className:"absolute top-4 right-4 text-slate-500 hover:text-white transition-colors p-1",children:o.jsx(Yn,{className:"w-5 h-5"})}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:`text-lg font-black mb-3 tracking-tight ${t.success?"text-white":"text-rose-400"}`,children:t.message}),t.utbytte&&t.utbytte.length>0&&o.jsx("div",{className:"flex flex-wrap justify-center gap-2 mb-3",children:t.utbytte.map((s,n)=>{const i=Ge[s.resource]||{label:s.resource,icon:""},r=s.name||i.label,a=s.icon||i.icon,l=s.amount>=0,c=s.jackpot;return o.jsxs(ee.div,{initial:{scale:0,y:10},animate:{scale:1,y:0},transition:{delay:.2+n*.1,type:"spring"},className:`flex items-center gap-2 px-4 py-2 rounded-2xl text-sm font-black border shadow-lg ${c?"bg-gradient-to-r from-amber-200 to-yellow-400 border-yellow-300 text-yellow-900 shadow-amber-500/50 animate-pulse":l?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":"bg-rose-500/10 border-rose-500/30 text-rose-400"}`,children:[o.jsx("span",{className:"text-lg",children:a}),o.jsxs("span",{children:[l?"+":"",s.resource==="gold"?s.amount.toFixed(2):s.amount," ",c&&r]})]},`${s.resource}-${n}`)})}),t.xp&&t.xp.length>0&&o.jsx("div",{className:"flex flex-col gap-2 mb-2",children:t.xp.map((s,n)=>o.jsxs(ee.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4+n*.1},className:"text-xs font-black uppercase tracking-widest text-indigo-400 bg-indigo-500/5 py-1 rounded-lg",children:["+",s.amount," XP ",s.skill,s.levelUp&&o.jsxs(ee.div,{initial:{scale:.5,opacity:0,rotate:-5},animate:{scale:[1,1.2,1],opacity:1,rotate:[0,5,-5,0],filter:["brightness(1)","brightness(2)","brightness(1)"]},transition:{duration:.6,times:[0,.5,1],repeat:1/0,repeatType:"reverse"},className:"mt-2 inline-flex items-center gap-2 bg-gradient-to-r from-amber-400 to-amber-600 text-black px-4 py-1.5 rounded-full text-[10px] font-black shadow-[0_0_20px_rgba(245,158,11,0.5)] border border-amber-300/50",children:[o.jsx("span",{children:""}),o.jsx("span",{className:"tracking-[0.2em]",children:"NIV OPPGGRADERT!"}),o.jsx("span",{children:""})]})]},`xp-${n}`))}),t.durability&&t.durability.length>0&&o.jsx("div",{className:"mt-4 pt-4 border-t border-white/5 flex flex-wrap justify-center gap-3",children:t.durability.map((s,n)=>o.jsxs("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider flex items-center gap-1",children:[" ",s.item,": ",o.jsxs("span",{className:s.amount>0?"text-rose-400":"text-emerald-400",children:[s.amount>0?"-":"+",Math.abs(s.amount),"%"]}),s.broken&&o.jsx("span",{className:"text-rose-500 font-black ml-1 animate-pulse",children:"(DELAGT!)"})]},`dura-${n}`))})]})]})})),Tee=async(t,e,s,n)=>{if(e===s)return{success:!1,error:"Kan ikke gi gave til deg selv"};const i=z(q,`simulation_rooms/${t}/players/${e}`),r=z(q,`simulation_rooms/${t}/players/${s}`),a=await ve(i),l=await ve(r);if(!a.exists())return{success:!1,error:"Sender finnes ikke"};if(!l.exists())return{success:!1,error:"Mottaker finnes ikke"};const c=a.val(),u=l.val(),d=u.name;if(c.regionId!==u.regionId)return{success:!1,error:"Du kan kun sende gaver til spillere i din region."};let h=!1,f="";if(await Pe(i,x=>{if(x===null)return x;x.resources||(x.resources={});for(const[v,g]of Object.entries(n))if((x.resources[v]||0)<g)return;for(const[v,g]of Object.entries(n))x.resources[v]-=g,f+=`${g} ${v}, `;return h=!0,x}),!h)return{success:!1,error:"Ikke nok ressurser til  sende gaven."};let m=!1;if(await Pe(r,x=>{if(x===null)return x;x.resources||(x.resources={});for(const[v,g]of Object.entries(n))x.resources[v]=(x.resources[v]||0)+g;return m=!0,x}),!m)return console.error("CRITICAL: Gift transaction partial failure. Sender deducted but target failed.",e,s),{success:!1,error:"Transaksjonsfeil: Gaven gikk tapt i posten (Mottaker utilgjengelig i skrivende stund)."};const b=`Sendte gave (${f.slice(0,-2)}) til ${d}.`;return wt(t,`[GAVE] ${c.name} -> ${d}: ${f}`),{success:!0,data:{success:!0,timestamp:Date.now(),message:b}}},Eee=async(t,e,s,n,i)=>{const r=z(q,`simulation_rooms/${t}/players/${e}`),a=z(q,`simulation_rooms/${t}/trades`),l=await ve(r),c=await ve(z(q,`simulation_rooms/${t}/players/${s}`));if(!l.exists()||!c.exists())return{success:!1,error:"Spiller finnes ikke"};const u=l.val(),d=c.val(),h=u.name,f=d.name;if(u.regionId!==d.regionId)return{success:!1,error:"Handel er kun tillatt med spillere i din region."};let m=!1;if(await Pe(r,v=>{var g;if(v===null)return v;for(const[p,y]of Object.entries(n))if((((g=v.resources)==null?void 0:g[p])||0)<y)return;for(const[p,y]of Object.entries(n))v.resources[p]-=y;return m=!0,v}),!m)return{success:!1,error:"Ikke nok ressurser til  opprette handelen."};const b=Dy(a),x={id:b.key,senderId:e,senderName:h,receiverId:s,receiverName:f,offer:n,demand:i,status:"PENDING",createdAt:Date.now(),expiresAt:Date.now()+1e3*60*60*24};return await da(b,x),wt(t,`[HANDEL] ${h} tilbd handel til ${f}.`),{success:!0,message:"Handelstilbud sendt."}},Aee=async(t,e,s,n)=>{const i=z(q,`simulation_rooms/${t}/trades/${s}`),r=await ve(i);if(!r.exists())return{success:!1,error:"Handelen finnes ikke lenger."};const a=r.val();if(a.status!=="PENDING")return{success:!1,error:"Handelen er ikke lenger aktiv."};if(a.receiverId!==e&&a.senderId!==e&&!(a.senderId===e&&n==="REJECT"))return{success:!1,error:"Du har ikke tilgang til denne handelen."};if(n==="REJECT"){const l=z(q,`simulation_rooms/${t}/players/${a.senderId}`);return await Pe(l,c=>{if(c===null)return c;c.resources||(c.resources={});for(const[u,d]of Object.entries(a.offer))c.resources[u]=(c.resources[u]||0)+d;return c}),await oe(i,{status:a.senderId===e?"CANCELLED":"REJECTED"}),{success:!0,message:"Handel avbrutt/avsltt."}}if(n==="ACCEPT"){const l=z(q,`simulation_rooms/${t}/players/${e}`);let c=!1;if(await Pe(l,d=>{var h;if(d===null)return d;for(const[f,m]of Object.entries(a.demand))if((((h=d.resources)==null?void 0:h[f])||0)<m)return;for(const[f,m]of Object.entries(a.demand))d.resources[f]-=m;for(const[f,m]of Object.entries(a.offer))d.resources[f]=(d.resources[f]||0)+m;return c=!0,d}),!c)return{success:!1,error:"Du har ikke rd til denne handelen."};const u=z(q,`simulation_rooms/${t}/players/${a.senderId}`);return await Pe(u,d=>{if(d===null)return d;d.resources||(d.resources={});for(const[h,f]of Object.entries(a.demand))d.resources[h]=(d.resources[h]||0)+f;return d}),await oe(i,{status:"ACCEPTED"}),wt(t,`[HANDEL] ${a.receiverName} godtok handelen fra ${a.senderName}.`),{success:!0,message:"Handel gjennomfrt!"}}},jee=({player:t,room:e,onAction:s,pin:n})=>{const[i,r]=N.useState([]),a=N.useRef({}),l=N.useRef(0),c=N.useMemo(()=>e.messages?Array.isArray(e.messages)?e.messages:Object.values(e.messages).sort((m,b)=>m.timestamp-b.timestamp):[],[e.messages]),u=m=>{r(x=>[...x,m]);const b=m.actions?1e4:5e3;setTimeout(()=>d(m.id),b)},d=m=>{r(b=>b.filter(x=>x.id!==m))},h=async(m,b)=>{const x=await Aee(n,t.id,m,b);x&&x.success?(d(`trade-${m}`),u({id:`trade-res-${Date.now()}`,title:b==="ACCEPT"?"Handel Gjennomfrt":"Handel Avsltt",message:x.message||"Transaksjon fullfrt.",type:"TRADE"})):u({id:`trade-err-${Date.now()}`,title:"Feil ved handel",message:(x==null?void 0:x.error)||"Noe gikk galt.",type:"TRADE"})},f=(m,b,x)=>!x[m];return N.useEffect(()=>{const m=e.trades||{},b=a.current;Object.entries(m).forEach(([x,v])=>{if(f(x,v,b)&&v.receiverId===t.id&&v.status==="PENDING"){const g=Object.entries(v.offer).map(([y,k])=>`${k} ${y}`).join(", "),p=Object.entries(v.demand).map(([y,k])=>`${k} ${y}`).join(", ");u({id:`trade-${x}`,title:"Nytt Handelstilbud",message:`${v.senderName} tilbyr ${g} for ${p}.`,type:"TRADE",actions:[{label:"Aksepter",variant:"primary",icon:o.jsx(Rc,{size:14}),onClick:()=>h(x,"ACCEPT")},{label:"Forhandle",variant:"neutral",icon:o.jsx(md,{size:14}),onClick:()=>{d(`trade-${x}`),alert("Forhandling er ikke implementert enn. Avsl handelen for  sende nytt tilbud.")}},{label:"Avsl",variant:"danger",icon:o.jsx(Yn,{size:14}),onClick:()=>h(x,"REJECT")}]})}}),a.current=m},[e.trades,t.id,n]),N.useEffect(()=>{var x;const m=c;if(m.length===0)return;const b=m[m.length-1];if(l.current===0&&m.length>0){l.current=m[m.length-1].timestamp;return}if(b.timestamp>l.current){const v=b.content;if(v.startsWith("[GAVE]")&&v.includes(`-> ${t.name}`)){const p=v.split("->")[0].replace("[GAVE]","").trim(),y=((x=v.split(":")[1])==null?void 0:x.trim())||"";u({id:`gift-${b.timestamp}`,title:`Gave fra ${p}`,message:`Du mottok: ${y}`,type:"GIFT"})}l.current=b.timestamp}},[c,t.name]),i.length===0?null:o.jsx("div",{className:"absolute top-24 right-8 z-[100] flex flex-col gap-4 pointer-events-none",children:i.map(m=>o.jsxs("div",{className:"pointer-events-auto bg-slate-900/95 backdrop-blur-xl border border-white/10 p-4 rounded-xl shadow-2xl flex flex-col gap-3 animate-in slide-in-from-right duration-300 w-96",children:[o.jsxs("div",{className:"flex items-start gap-4",children:[o.jsx("div",{className:`p-3 rounded-lg ${m.type==="GIFT"?"bg-indigo-500/20 text-indigo-400":"bg-emerald-500/20 text-emerald-400"}`,children:m.type==="GIFT"?o.jsx(ZI,{size:24}):o.jsx(c1,{size:24})}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-bold text-white text-sm",children:m.title}),o.jsx("p",{className:"text-slate-400 text-xs mt-1 leading-relaxed",children:m.message})]}),o.jsx("button",{onClick:()=>d(m.id),className:"text-slate-600 hover:text-white transition-colors",children:o.jsx(Yn,{size:16})})]}),m.actions&&o.jsx("div",{className:"flex gap-2 pt-2 border-t border-white/5",children:m.actions.map((b,x)=>o.jsxs("button",{onClick:b.onClick,className:`
                                        flex-1 py-2 px-3 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all active:scale-95
                                        ${b.variant==="primary"?"bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":""}
                                        ${b.variant==="danger"?"bg-rose-600/20 hover:bg-rose-600/30 text-rose-400 border border-rose-500/30":""}
                                        ${b.variant==="neutral"?"bg-slate-700 hover:bg-slate-600 text-slate-200":""}
                                    `,children:[b.icon,b.label]},x))})]},m.id))})},Cee=jn(()=>Tt(()=>import("./SimulationMarket-CjfDNZC7.js"),__vite__mapDeps([0,1])).then(t=>({default:t.SimulationMarket}))),Ree=jn(()=>Tt(()=>import("./SimulationVault-mKaxFVlF.js"),__vite__mapDeps([2,3])).then(t=>({default:t.SimulationVault}))),Iee=jn(()=>Tt(()=>import("./SimulationSkills-DDe2P2zd.js"),__vite__mapDeps([4,5])).then(t=>({default:t.SimulationSkills}))),Oee=jn(()=>Tt(()=>import("./SimulationProduction-CFP6wN5Z.js"),__vite__mapDeps([6,7])).then(t=>({default:t.SimulationProduction}))),Mee=jn(()=>Tt(()=>import("./SimulationActivity-YNN7QnmR.js"),[]).then(t=>({default:t.SimulationActivity}))),Dee=jn(()=>Tt(()=>import("./SimulationDiplomacy-DjQMQj1g.js"),[]).then(t=>({default:t.SimulationDiplomacy}))),Lee=jn(()=>Tt(()=>import("./SimulationHierarchy-TezynnSK.js"),__vite__mapDeps([8,9,5,1,3])).then(t=>({default:t.SimulationHierarchy}))),Pee=jn(()=>Tt(()=>import("./SimulationSettings-B--27BPR.js"),[]).then(t=>({default:t.SimulationSettings}))),Vee=jn(()=>Tt(()=>import("./PoliticalHub-CHcH0fma.js"),__vite__mapDeps([9,5,1,3])).then(t=>({default:t.PoliticalHub}))),Bee=jn(()=>Tt(()=>import("./SimulationWarRoom-DRSitK0V.js"),[]).then(t=>({default:t.SimulationWarRoom}))),Fee=jn(()=>Tt(()=>import("./SiegeEngine-D-ysRU3N.js"),[]).then(t=>({default:t.SiegeEngine}))),Uee=jn(()=>Tt(()=>import("./ApothecaryWindow-DflYiXs7.js"),__vite__mapDeps([10,7,3])).then(t=>({default:t.ApothecaryWindow}))),$ee=({player:t,room:e,pin:s,onAction:n,actionResult:i,onClearActionResult:r})=>{var x,v,g;const{activeTab:a,setActiveTab:l,isMusicWindowOpen:c,setMusicWindowOpen:u,viewingRegionId:d}=yo(),[h,f]=Se.useState(!1),m=async p=>{if(!h){f(!0);try{await oe(z(q,`simulation_rooms/${s}/activeVote/votes`),{[t.id]:p})}catch(y){console.error("Voting failed",y)}finally{setTimeout(()=>f(!1),1500)}}},b=["MAP","PRODUCTION","MARKET","INVENTORY","SKILLS","DIPLOMACY","HIERARCHY","PROFILE","POLITICS"].includes(a);return o.jsxs("div",{className:"flex-1 relative flex flex-col overflow-hidden w-full h-full",children:[o.jsxs("div",{className:`flex-1 relative w-full h-full ${b?"p-2 md:p-3 overflow-hidden flex items-center justify-center":"p-4 md:p-8 overflow-y-auto overflow-x-hidden custom-scrollbar"}`,children:[b&&o.jsx("div",{className:"absolute inset-0 z-0",children:o.jsx(_O,{player:t,room:e,world:e.world,worldEvents:e.worldEvents,players:e.players,onAction:n,onOpenMarket:()=>l("MARKET")})}),o.jsxs(Se.Suspense,{fallback:o.jsx("div",{className:"w-full h-full flex items-center justify-center pointer-events-none",children:o.jsx("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin"})}),children:[(()=>{var k;const p=d||t.regionId||"",y=(k=e.regions[p])==null?void 0:k.activeSiege;return!y||!(a==="SIEGE"||b)?null:o.jsx("div",{className:`absolute inset-0 z-10 ${a!=="SIEGE"?"opacity-20 pointer-events-none blur-sm grayscale":""}`,children:o.jsx(Fee,{player:t,siege:y,regionId:p,onAction:n,messages:Array.isArray(e.messages)?e.messages:Object.values(e.messages||{}),regions:e.regions})})})(),o.jsxs("div",{className:"absolute inset-0 z-20 pointer-events-none flex flex-col items-center justify-center",children:[a==="PRODUCTION"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-6xl md:h-auto md:max-h-[90vh] overflow-hidden",children:((x=yo().productionContext)==null?void 0:x.buildingId)==="apothecary"?o.jsx(Uee,{player:t,room:e,onAction:n,pin:s||""}):o.jsx(Oee,{player:t,room:e,onAction:n,pin:s||""})}),a==="MARKET"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-5xl md:h-[90vh] overflow-hidden",children:o.jsx(Cee,{player:t,market:((v=e.markets)==null?void 0:v[d||t.regionId||"capital"])||e.market,regions:e.regions,allMarkets:e.markets,onAction:n,pin:s||""})}),a==="INVENTORY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[80vh] overflow-hidden",children:o.jsx(Ree,{player:t,onAction:n})}),a==="SKILLS"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[80vh] overflow-hidden",children:o.jsx(Iee,{player:t})}),a==="DIPLOMACY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[85vh] overflow-hidden",children:o.jsx(Dee,{player:t,diplomacy:e.diplomacy,pin:s||""})}),a==="HIERARCHY"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-5xl md:h-[85vh] overflow-hidden",children:o.jsx(Lee,{players:e.players,currentPlayer:t,regions:e.regions,onAction:n,pin:s||""})}),a==="POLITICS"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-6xl md:h-[90vh] overflow-hidden",children:o.jsx(Vee,{player:t,room:e,onClose:()=>l("MAP")})}),a==="WAR_ROOM"&&o.jsx("div",{className:"pointer-events-auto w-full h-full md:max-w-4xl md:h-[85vh] overflow-hidden",children:o.jsx(Bee,{player:t,regions:e.regions,onAction:n,onClose:()=>l("HIERARCHY")})})]}),a!=="MAP"&&!b&&o.jsx("div",{className:"max-w-4xl mx-auto w-full space-y-8 animate-in slide-in-from-bottom-4 duration-500 relative z-20",children:a==="SETTINGS"?o.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-950/40 backdrop-blur-md p-8 animate-in fade-in duration-300",children:o.jsx(Pee,{onClose:()=>l("MAP")})}):a==="ACTIVITY"?o.jsx(Mee,{messages:e.messages}):null})]})]}),e.activeVote&&!((g=e.activeVote.votes)!=null&&g[t.id])&&o.jsx("div",{className:"absolute bottom-6 right-6 z-[50] w-96 animate-in slide-in-from-right duration-500",children:o.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-xl rounded-2xl border border-indigo-500/50 p-6 shadow-2xl shadow-indigo-500/10",children:[o.jsxs("div",{className:"flex items-start justify-between mb-4",children:[o.jsxs("div",{children:[o.jsx("h3",{className:"text-white font-bold text-lg leading-tight mb-1",children:"Tinget er satt"}),o.jsx("p",{className:"text-indigo-300 text-xs font-medium uppercase tracking-wider",children:"Avgi din stemme"})]}),o.jsx("div",{className:"bg-indigo-500/20 p-2 rounded-lg",children:o.jsx("span",{className:"text-2xl",children:""})})]}),o.jsxs("div",{className:"mb-6",children:[o.jsx("h4",{className:"text-white font-medium mb-2",children:e.activeVote.title}),o.jsx("p",{className:"text-slate-400 text-sm line-clamp-3 leading-relaxed",children:e.activeVote.description})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:()=>m("YES"),disabled:h,className:`bg-emerald-600/80 hover:bg-emerald-500 text-white py-3 rounded-xl font-bold text-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${h?"opacity-50 cursor-not-allowed":""}`,children:[o.jsx("span",{children:""})," VEDTA"]}),o.jsxs("button",{onClick:()=>m("NO"),disabled:h,className:`bg-rose-600/80 hover:bg-rose-500 text-white py-3 rounded-xl font-bold text-sm transition-all active:scale-95 flex items-center justify-center gap-2 ${h?"opacity-50 cursor-not-allowed":""}`,children:[o.jsx("span",{children:""})," AVSL"]})]})]})}),o.jsx(qt,{}),o.jsx(qt,{children:c&&o.jsx(Nee,{onClose:()=>u(!1)})}),o.jsx(jee,{player:t,room:e,onAction:n,pin:s||""}),o.jsx(See,{result:i,onClear:r})]})},Hee=()=>{const[t,e]=N.useState([]);return N.useEffect(()=>Xe.subscribe(n=>{e(i=>[...i,n]),setTimeout(()=>{e(i=>i.filter(r=>r.id!==n.id))},n.duration+500)}),[]),o.jsx("div",{className:"fixed inset-0 pointer-events-none z-[200] overflow-hidden",children:o.jsx(qt,{children:t.map(s=>{if(s.type==="FLOATING_TEXT")return o.jsx(ee.div,{initial:{opacity:0,scale:.5,y:0,rotate:(Math.random()-.5)*20},animate:{opacity:1,scale:1.2,y:-120,x:(Math.random()-.5)*40,rotate:(Math.random()-.5)*40},exit:{opacity:0,scale:.8},transition:{duration:.8,ease:"easeOut"},className:`absolute font-black text-4xl drop-shadow-2xl ${s.color||"text-amber-500"}`,style:{left:`${s.x}%`,top:`${s.y}%`,transform:"translate(-50%, -50%)",zIndex:210},children:s.text},s.id);if(s.type==="FLYING_RESOURCE"){const n=Ge[s.resource]||{icon:""};return o.jsx(ee.div,{initial:{left:`${s.startPoint.x}px`,top:`${s.startPoint.y}px`,scale:.5,opacity:0},animate:{left:`${s.endPoint.x}px`,top:`${s.endPoint.y}px`,scale:[.5,1.5,1],opacity:1},exit:{opacity:0,scale:.5},transition:{duration:1,ease:"easeInOut"},className:"absolute text-4xl z-[220] drop-shadow-xl",children:n.icon},s.id)}return s.type==="PARTICLE"?o.jsx(Se.Fragment,{children:[...Array(6)].map((n,i)=>o.jsx(ee.div,{initial:{left:`${s.x}%`,top:`${s.y}%`,scale:1,opacity:1},animate:{left:`${s.x+(Math.random()-.5)*15}%`,top:`${s.y+(Math.random()-.5)*15}%`,scale:0,opacity:0},transition:{duration:.6,ease:"easeOut"},className:`absolute w-3 h-3 rounded-sm ${s.color||"bg-amber-400"} z-[205]`},`${s.id}-p-${i}`))},s.id):null})})})},Gee=({level:t,title:e,onClose:s})=>o.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-500",children:[o.jsx("div",{className:"bg-gradient-to-br from-amber-400 via-amber-500 to-amber-600 p-1 rounded-[2.5rem] shadow-[0_0_50px_rgba(245,158,11,0.5)] animate-in zoom-in duration-500",children:o.jsxs("div",{className:"bg-white rounded-[2.2rem] p-10 text-center relative overflow-hidden max-w-sm",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-200"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"text-7xl mb-6 animate-bounce",children:""}),o.jsx("h2",{className:"text-sm font-black text-amber-600 uppercase tracking-[0.3em] mb-2",children:"Niv Oppndd!"}),o.jsxs("h3",{className:"text-6xl font-black text-slate-800 mb-4",children:["Niv ",t]}),o.jsx("div",{className:"h-0.5 w-16 bg-slate-200 mx-auto mb-6"}),o.jsx("p",{className:"text-slate-500 font-medium mb-1",children:"Ny Tittel:"}),o.jsx("p",{className:"text-3xl font-black text-indigo-600 mb-8",children:e}),o.jsx("button",{onClick:s,className:"w-full bg-slate-900 hover:bg-slate-800 text-white py-5 rounded-2xl font-black text-xl shadow-xl transition-all active:scale-95",children:"FORTSETT REISEN"})]}),o.jsx("div",{className:"absolute inset-0 pointer-events-none opacity-20",children:[...Array(20)].map((n,i)=>o.jsx("div",{className:"absolute w-2 h-2 bg-amber-500 rounded-full animate-ping",style:{top:`${Math.random()*100}%`,left:`${Math.random()*100}%`,animationDelay:`${Math.random()*2}s`,animationDuration:`${2+Math.random()*2}s`}},i))})]})}),o.jsx("style",{dangerouslySetInnerHTML:{__html:`
                    @keyframes ping-slow {
                        0% { transform: scale(1); opacity: 0.8; }
                        100% { transform: scale(3); opacity: 0; }
                    }
                `}})]}),zee=({pin:t,account:e,onCreatePlayer:s,isCreating:n})=>{const i=dc(),[r,a]=N.useState("WELCOME"),[l,c]=N.useState((e==null?void 0:e.displayName)||""),[u,d]=N.useState("PEASANT");return r==="WELCOME"?o.jsxs("div",{className:"bg-slate-900/40 backdrop-blur-3xl border border-white/5 p-12 md:p-16 rounded-[3.5rem] text-center space-y-10 shadow-2xl animate-in fade-in zoom-in duration-500",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h1",{className:"text-6xl md:text-8xl font-black italic text-white tracking-tighter leading-none",children:"FEUDAL SIM"}),o.jsx("p",{className:"text-indigo-400 font-black uppercase tracking-[0.4em] text-xs",children:"En Levende Simulator"})]}),o.jsx("div",{className:"space-y-6",children:o.jsx("p",{className:"text-slate-400 text-lg md:text-xl font-medium max-w-md mx-auto leading-relaxed",children:"Dette er et spill om makt, ressurser og overlevelse i et feydalt samfunn."})}),o.jsxs("div",{className:"pt-4 space-y-4",children:[o.jsxs("button",{onClick:()=>a("CREATE"),className:"px-12 py-5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-[2rem] font-black uppercase tracking-widest text-sm shadow-2xl shadow-indigo-600/40 transition-all hover:scale-105 active:scale-95 flex items-center justify-center gap-3 mx-auto w-64",children:["Skap din Karakter ",o.jsx(io,{size:20})]}),o.jsx("button",{onClick:()=>i("/sim"),className:"text-slate-500 hover:text-white font-black uppercase tracking-widest text-xs transition-colors",children:"G til Lobby"})]})]}):r==="CREATE"?o.jsxs("div",{className:"bg-slate-900 border border-white/10 p-12 rounded-[3.5rem] shadow-2xl space-y-10 animate-in slide-in-from-bottom-8 duration-500",children:[o.jsxs("div",{className:"text-center space-y-2",children:[o.jsx("h2",{className:"text-4xl font-black italic text-white tracking-tighter uppercase",children:"Hvem er du?"}),o.jsxs("p",{className:"text-slate-500 font-bold uppercase tracking-widest text-xs",children:["Opprett din karakter i ",t]})]}),o.jsxs("div",{className:"space-y-8",children:[o.jsxs("div",{className:"space-y-3",children:[o.jsx("label",{className:"text-xs font-black text-indigo-400 uppercase tracking-[0.2em] ml-2",children:"Ditt Navn i Riket"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-6 flex items-center text-slate-500 group-focus-within:text-indigo-400",children:o.jsx(Gn,{size:20})}),o.jsx("input",{type:"text",value:l,onChange:h=>c(h.target.value),placeholder:"f.eks. Eirik den Rde",className:"w-full bg-slate-950 border-2 border-white/5 rounded-3xl py-5 pl-16 pr-6 text-xl font-black text-white outline-none focus:border-indigo-500/50 transition-all"})]})]}),t==="TEST"&&o.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:["PEASANT","SOLDIER","MERCHANT","BARON"].map(h=>o.jsx("button",{onClick:()=>d(h),className:`py-4 rounded-2xl font-black uppercase tracking-widest text-xs border-2 transition-all ${u===h?"bg-indigo-600/20 border-indigo-500 text-white":"bg-white/5 border-transparent text-slate-500"}`,children:h},h))}),o.jsxs("div",{className:"pt-4 flex gap-4",children:[o.jsx("button",{onClick:()=>a("WELCOME"),className:"flex-1 py-5 bg-white/5 text-slate-400 rounded-3xl font-black uppercase tracking-widest text-xs",children:"Tilbake"}),o.jsx("button",{onClick:()=>{s(l,u),a("SUCCESS")},disabled:!l.trim()||n,className:"flex-[2] py-5 bg-indigo-600 text-white rounded-3xl font-black uppercase tracking-widest text-sm",children:n?"Oppretter...":"Start Reisen"})]})]})]}):o.jsxs("div",{className:"bg-emerald-500/10 backdrop-blur-3xl border border-emerald-500/30 p-16 rounded-[4rem] text-center space-y-8 shadow-2xl animate-in zoom-in duration-500",children:[o.jsx(Rc,{size:48,className:"text-white mx-auto bg-emerald-500 rounded-[2rem] p-4 shadow-2xl"}),o.jsx("h2",{className:"text-4xl font-black italic text-white uppercase",children:"Velkommen inn!"})]})},qee=[{id:"ride_easy",label:"Engelskogen",icon:"",desc:"En rolig tur i vakkert terreng.",difficultly:"Lett",color:"from-emerald-600 to-emerald-800"},{id:"ride_medium",label:"Fjellpasset",icon:"",desc:"Hyere fart og flere klipper.",difficultly:"Medium",color:"from-amber-600 to-amber-800"},{id:"ride_hard",label:"Ulvestien",icon:"",desc:"Livsfarlig galopp gjennom tett mrke.",difficultly:"Hard",color:"from-rose-600 to-rose-800"}],Oa={skins:[{id:"brown",label:"Rust",color:"#8B4513",price:0},{id:"white",label:"Pearl",color:"#E2E8F0",price:1e3},{id:"black",label:"Void",color:"#1A202C",price:2500},{id:"golden",label:"Gold",color:"#F6E05E",price:5e3},{id:"chestnut",label:"Red",color:"#7C2D12",price:750},{id:"grey",label:"Mist",color:"#94A3B8",price:1200}],manes:[{id:"#1e1b4b",label:"Shadow",price:0},{id:"#f1f5f9",label:"Snow",price:400},{id:"#ea580c",label:"Flame",price:800},{id:"rainbow",label:"Mythic",price:1500},{id:"#FCD34D",label:"Blonde",price:600}],hats:[{id:"none",label:"Ingen",icon:"",price:0},{id:"straw_hat",label:"Strhatt",icon:"",price:500},{id:"cowboy_hat",label:"Sheriff",icon:"",price:1e3},{id:"crown",label:"Konge",icon:"",price:1500},{id:"viking",label:"Viking",icon:"",price:2e3},{id:"tophat",label:"Grev",icon:"",price:3e3}]},Kee=(t,e)=>{let s=1;t==="ride_medium"&&(s=1.6),t==="ride_hard"&&(s=2.5);const n=1+(e-1)*.5;return Math.ceil(10*s*n)},Wee=({skinColor:t,maneColor:e,hatId:s})=>{const n=e==="rainbow";return o.jsxs("svg",{viewBox:"0 0 200 200",className:"w-full h-full drop-shadow-2xl",children:[o.jsxs("defs",{children:[o.jsxs("linearGradient",{id:"rainbowGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[o.jsx("stop",{offset:"0%",stopColor:"#ff0000"}),o.jsx("stop",{offset:"20%",stopColor:"#ffff00"}),o.jsx("stop",{offset:"40%",stopColor:"#00ff00"}),o.jsx("stop",{offset:"60%",stopColor:"#00ffff"}),o.jsx("stop",{offset:"80%",stopColor:"#0000ff"}),o.jsx("stop",{offset:"100%",stopColor:"#ff00ff"})]}),o.jsxs("filter",{id:"glow",children:[o.jsx("feGaussianBlur",{stdDeviation:"2.5",result:"coloredBlur"}),o.jsxs("feMerge",{children:[o.jsx("feMergeNode",{in:"coloredBlur"}),o.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),o.jsx("path",{d:"M70,160 L70,190 L85,190 L85,150 Z",fill:t,filter:"brightness(0.7)"}),o.jsx("path",{d:"M140,160 L140,190 L155,190 L155,150 Z",fill:t,filter:"brightness(0.7)"}),o.jsx("path",{d:"M50,100 Q40,60 90,60 L140,60 Q180,60 170,110 Q160,160 120,150 L80,150 Q50,150 50,100 Z",fill:t}),o.jsx("path",{d:"M60,150 L60,195 L75,195 L75,150 Z",fill:t}),o.jsx("path",{d:"M130,150 L130,195 L145,195 L145,150 Z",fill:t}),o.jsx("path",{d:"M130,65 Q130,30 160,20 L165,25 Q185,25 185,50 L175,70 Q160,85 145,65 Z",fill:t}),o.jsx("path",{d:"M185,50 L195,55 L190,65 L175,70 Z",fill:t,filter:"brightness(0.9)"}),o.jsx("path",{d:"M160,20 Q120,20 120,80 L130,90 Q140,30 165,25 Z",fill:n?"url(#rainbowGradient)":e,className:n?"animate-pulse":""}),o.jsx("path",{d:"M50,80 Q20,80 20,140",fill:"none",stroke:n?"url(#rainbowGradient)":e,strokeWidth:"8",strokeLinecap:"round"}),o.jsx("circle",{cx:"170",cy:"40",r:"2",fill:"white"}),o.jsx("circle",{cx:"170.5",cy:"39.5",r:"0.5",fill:"black"}),s==="straw_hat"&&o.jsx("text",{x:"160",y:"25",fontSize:"40",transform:"rotate(10, 160, 25)",children:""}),s==="cowboy_hat"&&o.jsx("text",{x:"155",y:"25",fontSize:"40",transform:"rotate(-5, 155, 25)",children:""}),s==="crown"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(-10, 155, 20)",children:""}),s==="viking"&&o.jsx("text",{x:"155",y:"20",fontSize:"40",transform:"rotate(0, 155, 20)",children:""}),s==="tophat"&&o.jsx("text",{x:"152",y:"15",fontSize:"45",transform:"rotate(-10, 155, 20)",children:""})]})},Yee=({player:t,onAction:e,onClose:s})=>{var p;const[n,i]=Se.useState("ride"),[r,a]=Se.useState("skin"),[l,c]=Se.useState(null),u=t.minigameProgress||{},d=t.horseCustomization||{},h={skinId:d.skinId||"brown",maneColor:d.maneColor||"#1e1b4b",hatId:d.hatId||"none",unlockedSkins:d.unlockedSkins||["brown"],unlockedManeColors:d.unlockedManeColors||["#1e1b4b"],unlockedHats:d.unlockedHats||[]},f=Oa.skins.find(y=>y.id===h.skinId)||Oa.skins[0],m=Oa.manes.find(y=>y.id===h.maneColor)||Oa.manes[0],b=(y,k)=>{e({type:"MOUNT_HORSE",method:y,level:k}),s()},x=(y,k,w)=>{c({id:y,type:k,price:w})},v=()=>{l&&(e({type:"BUY_HORSE_COSMETIC",cosmeticId:l.id,cosmeticType:l.type,price:l.price}),c(null))},g=(y,k)=>{e({type:"SELECT_HORSE_COSMETIC",cosmeticId:y,cosmeticType:k})};return o.jsxs(zn,{title:"KONGELIG STALL",subtitle:"Equestrian Center",icon:o.jsx(xd,{className:"text-amber-500",size:24}),onClose:s,children:[l&&o.jsx("div",{className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-sm flex items-center justify-center p-8 animate-in fade-in duration-200",children:o.jsxs("div",{className:"bg-slate-900 border border-amber-500/30 rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl space-y-6",children:[o.jsx("div",{className:"w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto text-amber-500 border border-amber-500/20",children:o.jsx(sa,{size:32})}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-xl font-black text-white uppercase mb-2",children:"Bekreft Kjp"}),o.jsxs("p",{className:"text-slate-400 text-sm",children:["Er du sikker p at du vil kjpe dette for ",o.jsxs("span",{className:"text-amber-400 font-bold",children:[l.price,"g"]}),"?"]})]}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("button",{onClick:()=>c(null),className:"flex-1 py-3 rounded-xl bg-slate-800 text-slate-400 font-bold text-xs uppercase hover:bg-slate-700 transition-colors",children:"Avbryt"}),o.jsx("button",{onClick:v,className:"flex-1 py-3 rounded-xl bg-amber-600 text-white font-bold text-xs uppercase hover:bg-amber-500 shadow-lg shadow-amber-900/20 transition-all",children:"Kjp"})]})]})}),o.jsxs("div",{className:"flex flex-col h-[650px] select-none text-slate-200",children:[o.jsxs("div",{className:"flex items-center gap-4 p-6 pb-2",children:[o.jsxs("div",{className:"flex bg-slate-900/50 p-1 rounded-2xl border border-white/5",children:[o.jsxs("button",{onClick:()=>i("ride"),className:`px-8 py-2.5 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center gap-2 ${n==="ride"?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx(iO,{size:14})," Turer"]}),o.jsxs("button",{onClick:()=>i("horse"),className:`px-8 py-2.5 rounded-xl font-bold text-xs uppercase tracking-widest transition-all flex items-center gap-2 ${n==="horse"?"bg-amber-600 text-white shadow-lg shadow-amber-500/20":"text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx(sa,{size:14})," Min Hest"]})]}),o.jsx("div",{className:"flex-1"}),o.jsxs("div",{className:"flex items-center gap-3 px-5 py-2 bg-slate-950/50 rounded-2xl border border-amber-500/20 shadow-inner",children:[o.jsx("span",{className:"text-[10px] font-black text-amber-500 uppercase tracking-widest",children:"Saldo"}),o.jsxs("span",{className:"text-base font-black text-amber-400 font-mono tracking-tight",children:[(((p=t.resources)==null?void 0:p.gold)||0).toLocaleString(),o.jsx("span",{className:"text-xs ml-1 text-amber-600",children:"G"})]})]})]}),o.jsx("div",{className:"flex-1 p-6 overflow-hidden",children:n==="ride"?o.jsx("div",{className:"h-full flex flex-col animate-in fade-in slide-in-from-bottom-4 duration-500",children:o.jsx("div",{className:"grid grid-cols-1 gap-4 overflow-y-auto pr-2 custom-scrollbar pb-4",children:qee.map(y=>{const k=u[y.id]||1;return o.jsxs("div",{className:"group relative bg-gradient-to-r from-slate-900 via-slate-900 to-slate-800/50 border border-white/5 rounded-[2rem] p-1 overflow-hidden hover:border-white/10 transition-all",children:[o.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b ${y.color}`}),o.jsxs("div",{className:"flex flex-col md:flex-row items-stretch gap-6 pl-6 p-5",children:[o.jsxs("div",{className:"flex items-center gap-5 min-w-[200px]",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl bg-slate-950 flex items-center justify-center text-4xl shadow-inner border border-white/5 group-hover:scale-105 transition-transform duration-500",children:y.icon}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-lg font-black uppercase tracking-tight text-white group-hover:text-indigo-400 transition-colors",children:y.label}),o.jsx("div",{className:"flex items-center gap-2 mt-1",children:o.jsx("span",{className:"px-2 py-0.5 bg-white/5 rounded text-[10px] font-bold text-slate-400 uppercase tracking-wider",children:y.difficultly})})]})]}),o.jsx("div",{className:"flex-1 flex flex-wrap items-center gap-3",children:[1,2,3,4,5].map(w=>{var A;const S=w<=k,_=w<k,T=Kee(y.id,w),E=(((A=t.resources)==null?void 0:A.grain)||0)>=T;return o.jsx("button",{disabled:!S||!_&&!E,onClick:()=>b(y.id,w),className:`
                                                                    relative h-12 flex-1 min-w-[60px] max-w-[80px] rounded-xl flex flex-col items-center justify-center gap-0.5 border transition-all duration-300
                                                                    ${_?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":S?E?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-500/20 hover:-translate-y-1":"bg-slate-800 border-slate-700 text-slate-500 saturate-0":"bg-transparent border-slate-800/50 text-slate-800"}
                                                                `,children:_?o.jsx(AX,{size:20}):S?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"text-sm font-black leading-none",children:w}),o.jsxs("span",{className:"text-[9px] font-medium opacity-80 leading-none",children:[T," "]})]}):o.jsx(Oo,{size:16})},w)})}),o.jsx("button",{onClick:()=>b(y.id,k),className:"w-14 rounded-xl bg-white/5 hover:bg-white/10 border border-white/5 flex items-center justify-center text-slate-400 hover:text-white transition-all",children:o.jsx(JI,{size:24})})]})]},y.id)})})}):o.jsxs("div",{className:"h-full grid grid-cols-12 gap-8 animate-in fade-in zoom-in-95 duration-500",children:[o.jsx("div",{className:"col-span-5 flex flex-col",children:o.jsxs("div",{className:"flex-1 relative bg-gradient-to-b from-slate-800/50 to-slate-900/90 rounded-[3rem] border border-white/10 shadow-2xl flex items-center justify-center overflow-hidden",children:[o.jsx("div",{className:"absolute inset-x-0 bottom-0 h-1/2 bg-gradient-to-t from-black/60 to-transparent"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] bg-indigo-500/10 blur-[100px] rounded-full"}),o.jsx("div",{className:"relative z-10 w-full h-full p-8 transition-all hover:scale-105 duration-700 ease-out",children:o.jsx(Wee,{skinColor:f.color,maneColor:m.id,hatId:h.hatId})}),o.jsx("div",{className:"absolute bottom-6 inset-x-8 text-center",children:o.jsx("div",{className:"inline-block px-6 py-2 bg-black/40 backdrop-blur-md rounded-full border border-white/5",children:o.jsxs("span",{className:"text-xs font-black uppercase tracking-[0.3em] text-white/80",children:[f.label," Stalon"]})})})]})}),o.jsxs("div",{className:"col-span-7 flex flex-col gap-6",children:[o.jsx("div",{className:"flex p-1 bg-slate-950/50 rounded-xl border border-white/5 w-fit",children:["skin","mane","hat"].map(y=>o.jsx("button",{onClick:()=>a(y),className:`px-5 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${r===y?"bg-amber-600 text-white shadow-lg shadow-amber-900/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5"}`,children:y==="skin"?"Pels":y==="mane"?"Manke":"Hodeplagg"},y))}),o.jsx("div",{className:"flex-1 overflow-y-auto pr-2 custom-scrollbar",children:o.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[r==="skin"&&Oa.skins.map(y=>{const k=h.unlockedSkins.includes(y.id),w=h.skinId===y.id;return o.jsxs("button",{onClick:()=>k?g(y.id,"skin"):x(y.id,"skin",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all group
                                                        ${w?"bg-indigo-600 border-indigo-400 ring-2 ring-indigo-500/30":k?"bg-slate-800 border-white/5 hover:bg-slate-700 hover:border-white/20":"bg-slate-900/50 border-white/5 opacity-70 hover:opacity-100 hover:border-amber-500/50"}
                                                    `,children:[o.jsx("div",{className:"w-8 h-8 rounded-full border border-white/10 shadow-lg",style:{backgroundColor:y.color}}),o.jsxs("div",{className:"flex flex-col items-center",children:[o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${w?"text-white":"text-slate-400"}`,children:y.label}),!k&&o.jsxs("span",{className:"text-[10px] font-bold text-amber-500",children:[y.price,"g"]})]})]},y.id)}),r==="mane"&&Oa.manes.map(y=>{const k=h.unlockedManeColors.includes(y.id),w=h.maneColor===y.id;return o.jsxs("button",{onClick:()=>k?g(y.id,"mane"):x(y.id,"mane",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-3 transition-all
                                                        ${w?"bg-indigo-600 border-indigo-400":"bg-slate-800 border-white/5 hover:bg-slate-700"}
                                                    `,children:[o.jsx("div",{className:"w-12 h-4 rounded-full border border-white/10 shadow-sm",style:{background:y.id==="rainbow"?"linear-gradient(90deg, #f43f5e, #fbbf24, #10b981, #6366f1)":y.id}}),k?o.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${w?"text-white":"text-slate-400"}`,children:y.label}):o.jsxs("span",{className:"text-xs font-bold text-amber-500",children:[y.price,"g"]})]},y.id)}),r==="hat"&&Oa.hats.map(y=>{const k=h.unlockedHats.includes(y.id)||y.id==="none",w=h.hatId===y.id||!1;return o.jsxs("button",{onClick:()=>k?g(y.id,"hat"):x(y.id,"hat",y.price),className:`
                                                        aspect-square rounded-2xl border flex flex-col items-center justify-center gap-2 transition-all
                                                        ${w?"bg-indigo-600 border-indigo-400":"bg-slate-800 border-white/5 hover:bg-slate-700"}
                                                    `,children:[o.jsx("span",{className:"text-4xl drop-shadow-lg",children:y.icon}),!k&&o.jsxs("span",{className:"text-xs font-bold text-amber-500",children:[y.price,"g"]})]},y.id)})]})})]})]})})]})]})},Xee=({player:t,room:e,onAction:s,onClose:n})=>{var b,x;const i=e.metadata||{},r=Date.now(),a=i.lastTavernRest||r,l=(r-a)/3e5;let c=i.tavernDemand||1;l>0&&(c=Math.max(1,c-l*.05));const u=v=>Math.ceil(v*c),d=t.regionId||"capital",h=((b=e.markets)==null?void 0:b[d])||e.market,f=((x=h==null?void 0:h.bread)==null?void 0:x.price)||5,m=Math.ceil(f*1.2);return o.jsx(zn,{title:"Vertshuset: Den Glade Gris",subtitle:"Mat & Losji",icon:o.jsx(sJ,{className:"text-amber-400"}),onClose:n,maxWidth:"max-w-4xl",children:o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"p-2 bg-amber-500/20 rounded-lg text-amber-400",children:o.jsx(OX,{size:20})}),o.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-wider",children:"Mat & Drikke"})]}),o.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-5 hover:bg-white/10 transition-colors group",children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{children:[o.jsx("h4",{className:"font-bold text-lg text-amber-100",children:"Dagens Husmannskost"}),o.jsx("p",{className:"text-xs text-amber-400/60 uppercase tracking-widest font-bold mt-1",children:"Markedspris + Servering"})]}),o.jsxs("div",{className:"text-right",children:[o.jsxs("div",{className:"text-xl font-black text-amber-400",children:[m,"g"]}),o.jsxs("div",{className:"text-[10px] text-slate-400",children:["oppr. ",f.toFixed(1),"g"]})]})]}),o.jsx("p",{className:"text-slate-300 text-sm mb-4 leading-relaxed",children:"En varm tallerken med brd, litt kjttrester og dagens suppe. Ikke noe fancy, men det metter."}),o.jsx("div",{className:"flex items-center gap-4 text-xs font-medium text-slate-400 mb-5",children:o.jsxs("div",{className:"flex items-center gap-1.5 bg-slate-950/50 px-2.5 py-1 rounded-md border border-white/5",children:[o.jsx("span",{className:"text-emerald-400",children:""}),o.jsx("span",{children:"+10 Stamina"})]})}),o.jsx("button",{onClick:()=>{s({type:"BUY_MEAL",locationId:"tavern_bar"})},className:"w-full py-3 bg-amber-600 hover:bg-amber-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-amber-900/20",children:o.jsx("span",{children:"Kjp Mltid"})})]}),o.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-xl p-4 flex gap-3 text-sm text-blue-200",children:[o.jsx(eO,{className:"shrink-0 mt-0.5",size:16}),o.jsx("p",{children:"Prisene justeres automatisk basert p rvarepriser i markedet."})]})]}),o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[o.jsx("div",{className:"p-2 bg-indigo-500/20 rounded-lg text-indigo-400",children:o.jsx(iT,{size:20})}),o.jsx("h3",{className:"text-lg font-bold text-white uppercase tracking-wider",children:"Overnatting"}),c>1.1&&o.jsxs("span",{className:"ml-auto text-[10px] font-black bg-rose-500 text-white px-2 py-0.5 rounded-full animate-pulse",children:["HY ETTERSPRSEL (x",c.toFixed(2),")"]})]}),o.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-2xl p-4 hover:border-indigo-500/30 transition-colors",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-slate-200",children:"Sovesal (Hengekye)"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(150),"g"]})]}),o.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"+30 Stamina"}),o.jsx("span",{children:""}),o.jsx("span",{children:"Ingen buffs"})]}),o.jsx("button",{onClick:()=>s({type:"REST_BASIC",locationId:"tavern_bar"}),className:"w-full py-2 bg-slate-700 hover:bg-slate-600 text-white text-sm font-bold rounded-lg transition-colors",children:"Lei Kye"})]}),o.jsxs("div",{className:"bg-gradient-to-br from-indigo-900/20 to-slate-900/40 border border-indigo-500/30 rounded-2xl p-4 hover:border-indigo-400/50 transition-colors relative overflow-hidden group",children:[o.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-5 scale-150 group-hover:scale-110 transition-transform",children:o.jsx(iT,{size:64})}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-indigo-200",children:"Komfortabelt Rom"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(500),"g"]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"+80 Stamina"}),o.jsx("span",{className:"text-rose-400 font-bold",children:"+10 HP"}),o.jsx("span",{className:"bg-indigo-500/20 text-indigo-300 px-1.5 py-0.5 rounded border border-indigo-500/30",children:"Buff: Utvilt"})]}),o.jsx("button",{onClick:()=>s({type:"REST_COMFY",locationId:"tavern_bar"}),className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-indigo-900/20",children:"Lei Rom"})]})]}),o.jsxs("div",{className:"bg-gradient-to-br from-amber-900/20 to-slate-900/40 border border-amber-500/30 rounded-2xl p-4 hover:border-amber-400/50 transition-colors relative overflow-hidden group",children:[o.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-5 scale-150 group-hover:scale-110 transition-transform",children:o.jsx(Ic,{size:64})}),o.jsxs("div",{className:"relative",children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsx("h4",{className:"font-bold text-amber-200",children:"Kongesuite"}),o.jsxs("span",{className:"font-bold text-amber-400",children:[u(1500),"g"]})]}),o.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-400 mb-3",children:[o.jsx("span",{className:"text-emerald-400 font-bold",children:"FULL Stamina"}),o.jsx("span",{className:"text-rose-400 font-bold",children:"+50 HP"}),o.jsx("span",{className:"bg-amber-500/20 text-amber-300 px-1.5 py-0.5 rounded border border-amber-500/30",children:"Buff: Luksusliv"})]}),o.jsx("button",{onClick:()=>s({type:"REST_ROYAL",locationId:"tavern_bar"}),className:"w-full py-2 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 text-white text-sm font-bold rounded-lg transition-colors shadow-lg shadow-amber-900/20",children:"Lei Suite"})]})]})]})]})})},Qee={KING:Ic,BARON:d1,PEASANT:tc,SOLDIER:Gm,MERCHANT:l1},Jee={KING:["Sikre rikets stabilitet","Samle inn skatter fra baronene","Beskytte 'The Orb of Power'"],BARON:["Administrer din region","Krev inn skatter fra bndene","Bygg opp forsvaret mot invasjoner"],PEASANT:["Dyrk jorden og hst korn","Betal skatt for  unng fengsel","Overlev vinteren"],SOLDIER:["Beskytt riket mot farer","Tren deg opp i kamp","Adlyde ordrer fra Kongen"],MERCHANT:["Kjp og selg varer p markedet","Tjen deg rik p handel","Unng  bli plyndret"]},Zee={KING:"Du er den verste lederen. Din makt er absolutt, men ditt ansvar er tungt. Riket hviler p dine skuldre.",BARON:"Du styrer et av rikets store landomrder. Du er bindeleddet mellom Kongen og folket.",PEASANT:"Du er ryggraden i samfunnet. Uten ditt harde arbeid ville riket sultet. Livet er hardt, men rlig.",SOLDIER:"Du er sverdets mester. Din plikt er  beskytte de svake og opprettholde lov og orden.",MERCHANT:"Du forstr verdien av gull. Mens andre slss eller dyrker, bygger du formuer gjennom smart handel."},ete=({player:t,pin:e,onComplete:s})=>{var d,h;const[n,i]=N.useState(0),[r,a]=N.useState(!1),l=Qee[t.role]||Gn,c=Jee[t.role]||["Overlev","Utforsk","Lr"];N.useEffect(()=>{if(n===0){const f=setTimeout(()=>i(1),3e3);return()=>clearTimeout(f)}},[n]);const u=async()=>{a(!0);try{const f={};f[`simulation_rooms/${e}/players/${t.id}/hasSeenIntro`]=!0,await oe(z(q),f),setTimeout(s,500)}catch(f){console.error("Failed to save intro state",f),s()}};return n===0?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950 text-white animate-in fade-in duration-1000",children:o.jsxs("div",{className:"text-center space-y-8 animate-in zoom-in duration-1000 slide-in-from-bottom-10 fill-mode-forwards",children:[o.jsxs("div",{className:"relative inline-block",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-[100px] rounded-full animate-pulse"}),o.jsx(l,{size:120,className:"relative z-10 text-white drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("p",{className:"text-slate-400 font-bold uppercase tracking-[0.5em] text-sm animate-in fade-in delay-500 duration-1000",children:"Skjebnen har valgt..."}),o.jsx("h1",{className:"text-6xl md:text-8xl font-black italic tracking-tighter uppercase animate-in slide-in-from-bottom-5 delay-700 duration-500",children:((d=ld[t.role])==null?void 0:d.label)||t.role})]})]})}):o.jsx("div",{className:`fixed inset-0 z-50 flex items-center justify-center bg-slate-950/90 backdrop-blur-3xl transition-opacity duration-500 ${r?"opacity-0":"opacity-100"}`,children:o.jsxs("div",{className:"max-w-4xl w-full mx-4 grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center",children:[o.jsxs("div",{className:"text-center space-y-8 order-2 md:order-1 animate-in slide-in-from-left-10 duration-700",children:[o.jsxs("div",{className:"relative inline-block p-10 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-[3rem] border border-white/10 shadow-2xl",children:[o.jsx(l,{size:180,className:"text-white drop-shadow-2xl"}),o.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 bg-slate-900 border border-white/20 px-6 py-2 rounded-full whitespace-nowrap",children:o.jsx("span",{className:"text-xs font-black uppercase tracking-widest text-indigo-300",children:"Din tildelte rolle"})})]}),o.jsxs("div",{children:[o.jsx("h2",{className:"text-4xl font-black italic tracking-tighter uppercase mb-4",children:(h=ld[t.role])==null?void 0:h.label}),o.jsx("p",{className:"text-slate-400 font-medium leading-relaxed max-w-sm mx-auto",children:Zee[t.role]})]})]}),o.jsxs("div",{className:"space-y-8 order-1 md:order-2 animate-in slide-in-from-right-10 duration-700 delay-200",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.3em] text-indigo-400",children:"Dine Ml"}),o.jsx("h1",{className:"text-5xl font-black italic tracking-tighter text-white",children:"Oppdrag"})]}),o.jsx("div",{className:"space-y-4",children:c.map((f,m)=>o.jsxs("div",{className:"flex items-center gap-4 bg-white/5 border border-white/5 p-4 rounded-2xl hover:bg-white/10 transition-colors group",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 border border-emerald-500/20 group-hover:scale-110 transition-transform",children:o.jsx("span",{className:"font-black text-sm",children:m+1})}),o.jsx("span",{className:"font-bold text-slate-200",children:f})]},m))}),o.jsx("div",{className:"pt-8",children:o.jsxs("button",{onClick:u,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white py-6 rounded-[2rem] font-black uppercase text-lg tracking-widest shadow-2xl shadow-indigo-600/30 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-4 group",children:["Start Din Reise ",o.jsx(io,{className:"group-hover:translate-x-2 transition-transform"})]})})]})]})})},tte=(t,e)=>{const[s,n]=N.useState("global"),[i,r]=N.useState({}),[a,l]=N.useState({}),[c,u]=N.useState(!1),[d,h]=N.useState(0),[f,m]=N.useState(()=>{if(!(e!=null&&e.id))return{};const x=localStorage.getItem(`chat_last_read_${t}_${e.id}`);return x?JSON.parse(x):{}}),b=x=>{const v=Date.now();m(g=>{const p={...g,[x]:v};return e!=null&&e.id&&localStorage.setItem(`chat_last_read_${t}_${e.id}`,JSON.stringify(p)),p})};return N.useEffect(()=>{if(!e)return;const x={};if(x.global={id:"global",name:"Riket",type:"GLOBAL",unreadCount:0,description:"Offentlig torg"},e.role==="KING")x.region_vest={id:"region_vest",name:"Vest",type:"REGION",unreadCount:0,description:"Regional kanal for Vest"},x.region_ost={id:"region_ost",name:"st",type:"REGION",unreadCount:0,description:"Regional kanal for st"},x.capital={id:"capital",name:"Hovedstaden",type:"REGION",unreadCount:0,description:"Hovedstaden"};else if(e.regionId){const v=e.regionId==="capital"?"Hovedstaden":e.regionId==="region_vest"?"Vest":e.regionId==="region_ost"?"st":e.regionId;x[e.regionId]={id:e.regionId,name:v,type:"REGION",unreadCount:0,description:"Ditt hjemsted"}}(e.role==="BARON"||e.role==="KING")&&(x.diplomacy={id:"diplomacy",name:"Rdet",type:"DIPLOMACY",unreadCount:0,description:"Hemmelig kanal for ledere"}),r(v=>{const g={...x};return Object.keys(v).forEach(p=>{g[p]&&(g[p].unreadCount=v[p].unreadCount)}),g})},[e==null?void 0:e.regionId,e==null?void 0:e.role]),N.useEffect(()=>{if(!t||!e||Object.keys(i).length===0)return;const x=[];return Object.keys(i).forEach(v=>{const g=z(q,`simulation_rooms/${t}/channels/${v}/messages`),p=MF(g,OF(20)),y=tt(p,k=>{const w=k.val(),S=w?Object.values(w):[];S.sort((E,A)=>E.timestamp-A.timestamp),l(E=>({...E,[v]:S}));const _=f[v]||0,T=S.filter(E=>E.timestamp>_&&E.senderId!==e.id).length;r(E=>E[v]&&E[v].unreadCount===T?E:{...E,[v]:{...E[v],unreadCount:T}})});x.push(y)}),()=>x.forEach(v=>v())},[t,e==null?void 0:e.id,Object.keys(i).join(","),f]),N.useEffect(()=>{const x=Object.values(i).reduce((v,g)=>v+(g.unreadCount||0),0);h(x)},[i]),{activeChannelId:s,setActiveChannelId:n,channels:i,messages:a[s]||[],isLoading:c&&!a[s],totalUnreadCount:d,markChannelAsRead:b}},$h=(...t)=>t.filter(Boolean).join(" "),ste=({pin:t,player:e,onOpenProfile:s})=>{var y;const[n,i]=N.useState(!1),{activeChannelId:r,setActiveChannelId:a,channels:l,messages:c,totalUnreadCount:u,markChannelAsRead:d,isLoading:h}=tte(t,e),[f,m]=N.useState(""),[b,x]=N.useState(!1),v=N.useRef(null);N.useEffect(()=>{v.current&&v.current.scrollIntoView({behavior:"smooth"})},[c,n]),N.useEffect(()=>{n&&d(r)},[n,r,d]),N.useEffect(()=>{const k=w=>{var S;["INPUT","TEXTAREA"].includes(((S=document.activeElement)==null?void 0:S.tagName)||"")||w.key.toLowerCase()==="c"&&i(_=>!_)};return window.addEventListener("keydown",k),()=>window.removeEventListener("keydown",k)},[]);const g=async()=>{if(!f.trim()||b)return;x(!0);const k=await p7(t,e.id,f,r);k.success?m(""):alert(k.error||"Feil ved sending."),x(!1)},p=k=>{switch(k){case"GLOBAL":return o.jsx(h1,{size:14});case"REGION":return o.jsx(sO,{size:14});case"DIPLOMACY":return o.jsx(Ic,{size:14,className:"text-amber-400"});case"DM":return o.jsx(Oo,{size:14});default:return o.jsx(md,{size:14})}};return n?o.jsxs("div",{className:"fixed bottom-6 left-6 z-50 w-[380px] h-[500px] flex flex-col bg-slate-950/95 border border-slate-800/80 rounded-2xl shadow-2xl backdrop-blur-xl animate-in slide-in-from-bottom-10 fade-in duration-300",children:[o.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-slate-800/50 bg-slate-900/50 rounded-t-2xl drag-handle cursor-grab active:cursor-grabbing",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-slate-400",children:"Comms Array"})]}),o.jsx("button",{onClick:()=>i(!1),className:"text-slate-500 hover:text-white transition-colors",children:o.jsx(wX,{size:18})})]}),o.jsx("div",{className:"flex gap-1 p-2 bg-slate-900/30 overflow-x-auto scrollbar-hide",children:Object.values(l).map(k=>o.jsxs("button",{onClick:()=>a(k.id),className:$h("flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-semibold whitespace-nowrap transition-all relative",r===k.id?"bg-indigo-600 text-white shadow-lg shadow-indigo-500/20":"bg-slate-800/50 text-slate-400 hover:bg-slate-800 hover:text-slate-200"),children:[p(k.type),k.name,k.unreadCount>0&&r!==k.id&&o.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full border border-slate-900"})]},k.id))}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar bg-gradient-to-b from-slate-950/50 to-transparent",children:[h?o.jsx("div",{className:"flex justify-center p-4",children:o.jsx("div",{className:"w-6 h-6 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"})}):c.length===0?o.jsx("div",{className:"text-center text-slate-600 text-xs italic mt-10",children:"Ingen meldinger i denne kanalen enn."}):c.map(k=>{const w=k.senderId===e.id;return o.jsxs("div",{className:$h("flex flex-col gap-1 max-w-[85%]",w?"ml-auto items-end":"mr-auto items-start"),children:[o.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 px-1",children:[o.jsx("span",{onClick:()=>s&&s(k.senderId||""),className:$h("font-bold hover:underline cursor-pointer",w?"text-indigo-400":"text-amber-500"),children:k.senderName}),o.jsxs("span",{className:"opacity-50",children:[" ",new Date(k.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),o.jsxs("div",{className:$h("px-3 py-2 rounded-2xl text-sm leading-relaxed shadow-sm break-words relative group",w?"bg-indigo-600 text-white rounded-tr-sm":"bg-slate-800 text-slate-200 rounded-tl-sm border border-slate-700/50"),children:[k.content,!w&&k.senderRole!=="PEASANT"&&o.jsx("div",{className:"absolute -top-2 -right-2 bg-slate-950 border border-slate-700 text-[8px] font-black uppercase px-1.5 py-0.5 rounded shadow-xl scale-0 group-hover:scale-100 transition-transform",children:k.senderRole})]})]},k.id)}),o.jsx("div",{ref:v})]}),o.jsx("div",{className:"p-3 bg-slate-900/80 border-t border-slate-800 backdrop-blur-md",children:o.jsxs("div",{className:"relative flex items-center gap-2",children:[o.jsx("input",{value:f,onChange:k=>m(k.target.value),onKeyDown:k=>k.key==="Enter"&&!k.shiftKey&&g(),placeholder:`Melding til #${((y=l[r])==null?void 0:y.name)||"kanal"}...`,className:"flex-1 bg-slate-950 border border-slate-700 rounded-xl px-4 py-2.5 text-sm text-white placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all shadow-inner",disabled:b}),o.jsx("button",{onClick:g,disabled:!f.trim()||b,className:"bg-indigo-600 hover:bg-indigo-500 text-white p-2.5 rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-indigo-500/20 active:scale-95",children:b?o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):o.jsx(oO,{size:16})}),e.role!=="KING"&&r==="global"&&o.jsx("div",{className:"absolute -top-6 right-2 text-[10px] text-amber-500 font-mono bg-amber-950/30 px-2 py-0.5 rounded border border-amber-900/50",children:"Kostnad: 2 Gull"})]})})]}):o.jsx("button",{onClick:()=>i(!0),className:"fixed bottom-6 left-6 z-50 bg-slate-900/90 border border-slate-700/50 text-white p-3 rounded-full shadow-2xl hover:bg-indigo-600 hover:scale-105 transition-all group backdrop-blur-md",children:o.jsxs("div",{className:"relative",children:[o.jsx(md,{size:24,className:"group-hover:text-white text-slate-200"}),u>0&&o.jsx("div",{className:"absolute -top-2 -right-2 min-w-[20px] h-5 bg-red-500 rounded-full flex items-center justify-center text-[10px] font-black border-2 border-slate-900 px-1 animate-in zoom-in duration-300",children:u>9?"9+":u})]})})},yT=["gold","grain","wood","iron_ore","stone","plank","iron_ingot","bread","swords","armor","cloth","wool"],nte=({isOpen:t,onClose:e,myPlayer:s,targetPlayer:n,pin:i})=>{const[r,a]=N.useState({gold:0}),[l,c]=N.useState({gold:0}),[u,d]=N.useState(!1),[h,f]=N.useState(null);if(!t)return null;Se.useEffect(()=>{const g=p=>{p.key==="Escape"&&e()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e]);const m=async()=>{d(!0),f(null);try{const g=await Eee(i,s.id,n.id,r,l);g.success?(f("Handelstilbud sendt!"),setTimeout(e,1500)):(f("Feil: "+g.error),d(!1))}catch(g){console.error(g),f("En ukjent feil oppstod."),d(!1)}},b=(g,p)=>{a(y=>({...y,[g]:Math.max(0,p)}))},x=(g,p)=>{c(y=>({...y,[g]:Math.max(0,p)}))},v=({label:g,values:p,onChange:y,max:k})=>o.jsxs("div",{className:"space-y-2",children:[o.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 tracking-wider mb-2",children:g}),o.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar",children:[yT.map(w=>{var T;const S=p[w]||0,_=k?k(w):9999;return k&&_<=0&&S<=0?null:o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50",children:[o.jsx("span",{className:"text-lg w-8 text-center",children:Jl[w.toUpperCase()]||""}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"text-xs text-slate-300 font-medium capitalize truncate",children:((T=Ge[w])==null?void 0:T.label)||w.replace("_"," ")}),k&&o.jsxs("div",{className:"text-[10px] text-slate-500",children:["Du har: ",_]})]}),o.jsx("input",{type:"number",value:S||"",placeholder:"0",onChange:E=>y(w,parseInt(E.target.value)||0),className:"w-20 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-right text-sm font-mono focus:outline-none focus:border-indigo-500"})]},w)}),!k&&o.jsx("div",{className:"text-xs text-slate-500 text-center italic mt-2",children:"Velg hva du krever"})]})]});return o.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm",children:o.jsxs("div",{className:"w-full max-w-4xl bg-slate-900 border border-indigo-500/30 rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",children:[o.jsxs("div",{className:"p-6 bg-slate-900 border-b border-indigo-500/20 flex justify-between items-center relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-600/5 opacity-0 group-hover:opacity-100 transition-opacity"}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-2xl font-black italic text-white flex items-center gap-3",children:[o.jsx(c1,{className:"text-indigo-400"}),"HANDELSKONTRAKT"]}),o.jsxs("p",{className:"text-slate-400 text-sm",children:["Opprett et tilbud til ",o.jsx("span",{className:"text-white font-bold",children:n.name})]})]}),o.jsx("button",{onClick:e,className:"relative z-10 p-2 hover:bg-slate-800 rounded-full transition-colors cursor-pointer",children:o.jsx(Yn,{className:"text-slate-400"})})]}),o.jsxs("div",{className:"flex-1 overflow-hidden grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-800 bg-slate-950/50",children:[o.jsx("div",{className:"p-6 overflow-hidden flex flex-col",children:o.jsx(v,{label:"Ditt Tilbud (Assets)",values:r,onChange:b,max:g=>s.resources[g]||0})}),o.jsx("div",{className:"p-6 overflow-hidden flex flex-col",children:o.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar",children:[o.jsx("h4",{className:"text-xs font-bold uppercase text-slate-400 tracking-wider mb-2",children:"Ditt Krav (Liabilities)"}),yT.map(g=>{var p;return o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-2 rounded-lg border border-slate-700/50 hover:border-indigo-500/30 transition-colors",children:[o.jsx("span",{className:"text-lg w-8 text-center opacity-70",children:Jl[g.toUpperCase()]||""}),o.jsx("span",{className:"flex-1 text-xs text-slate-300 font-medium capitalize truncate",children:((p=Ge[g])==null?void 0:p.label)||g.replace("_"," ")}),o.jsx("input",{type:"number",value:l[g]||"",placeholder:"0",onChange:y=>x(g,parseInt(y.target.value)||0),className:"w-20 bg-slate-800 border border-slate-700 rounded px-2 py-1 text-right text-sm font-mono focus:outline-none focus:border-indigo-500"})]},g)})]})})]}),o.jsxs("div",{className:"p-6 bg-slate-900 border-t border-indigo-500/20 flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-yellow-500/80 text-xs",children:[o.jsx(Rb,{size:14}),o.jsx("span",{children:"Ressursene trekkes umiddelbart (Escrow)."})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[h&&o.jsx("span",{className:`text-sm font-bold ${h.startsWith("Feil")?"text-red-400":"text-green-400"}`,children:h}),o.jsx("button",{onClick:m,disabled:u||h!==null,className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-indigo-500/20",children:u?"Signerer...":o.jsxs(o.Fragment,{children:[o.jsx(oO,{size:18}),"Send Kontrakt"]})})]})]})]})})},ite=["gold","grain","wood","iron_ore","bread"],rte=({isOpen:t,onClose:e,myPlayer:s,targetPlayer:n,pin:i})=>{const[r,a]=N.useState("INFO"),[l,c]=N.useState(!1);Se.useEffect(()=>{const g=p=>{p.key==="Escape"&&e()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e]);const[u,d]=N.useState("gold"),[h,f]=N.useState(0),[m,b]=N.useState(null),x=g=>{switch(g){case"KING":return o.jsx(Ic,{size:32,className:"text-yellow-400"});case"BARON":return o.jsx(d1,{size:32,className:"text-purple-400"});case"SOLDIER":return o.jsx(Gm,{size:32,className:"text-red-400"});case"MERCHANT":return o.jsx(l1,{size:32,className:"text-emerald-400"});default:return o.jsx(Gn,{size:32,className:"text-slate-400"})}},v=async()=>{if(h<=0)return;b("Sender...");const g={};g[u]=h;const p=await Tee(i,s.id,n.id,g);p.success?(b(`Sendte ${h} ${u}!`),setTimeout(()=>{b(null),a("INFO")},1500)):b("Feil: "+p.error)};return t?l?o.jsx(nte,{isOpen:!0,onClose:()=>c(!1),myPlayer:s,targetPlayer:n,pin:i}):o.jsx("div",{className:"fixed inset-0 z-[50] flex items-center justify-center p-4 bg-slate-950/60 backdrop-blur-sm animate-in fade-in duration-200",children:o.jsxs("div",{className:"w-full max-w-md bg-slate-900 border border-slate-700 rounded-3xl shadow-2xl overflow-hidden flex flex-col relative",children:[o.jsx("div",{className:`h-32 w-full relative bg-gradient-to-br ${n.role==="KING"?"from-yellow-900/40 to-slate-900":"from-indigo-900/40 to-slate-900"}`,children:o.jsx("div",{className:"absolute top-4 right-4",children:o.jsx("button",{onClick:e,className:"p-2 bg-black/20 hover:bg-black/40 rounded-full transition-colors backdrop-blur-sm text-white",children:o.jsx(Yn,{size:20})})})}),o.jsxs("div",{className:"px-8 relative -mt-16 mb-4 flex flex-col items-center",children:[o.jsxs("div",{className:"w-32 h-32 rounded-full border-4 border-slate-900 bg-slate-800 flex items-center justify-center shadow-xl relative group overflow-hidden",children:[n.avatar?o.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full object-cover"}):x(n.role),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"})]}),o.jsx("h2",{className:"text-2xl font-black text-white mt-4",children:n.name}),o.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm font-medium uppercase tracking-wider",children:[o.jsx("span",{className:"text-indigo-400",children:n.role}),o.jsx("span",{children:""}),o.jsxs("span",{className:"flex items-center gap-1",children:[o.jsx(sO,{size:12})," ",n.regionId||"Ukjent"]})]})]}),o.jsxs("div",{className:"flex-1 px-8 pb-8 space-y-6",children:[r==="INFO"&&o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mb-1",children:"Level"}),o.jsx("div",{className:"text-3xl font-black text-white",children:n.stats.level})]}),o.jsxs("div",{className:"bg-slate-950/50 p-4 rounded-2xl border border-slate-800 text-center",children:[o.jsx("div",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mb-1",children:"Reputasjon"}),o.jsx("div",{className:"text-3xl font-black text-indigo-400",children:n.stats.reputation})]})]}),r==="GIFT"&&o.jsxs("div",{className:"bg-slate-950/50 p-6 rounded-2xl border border-slate-800 space-y-4 animate-in slide-in-from-bottom-4 duration-300",children:[o.jsx("h3",{className:"text-center text-slate-300 font-bold",children:"Send en gave"}),o.jsx("div",{className:"flex gap-2 justify-center",children:ite.map(g=>o.jsx("button",{onClick:()=>d(g),className:`p-2 rounded-lg border transition-all ${u===g?"bg-indigo-600 border-indigo-500":"bg-slate-900 border-slate-700 hover:border-slate-500"}`,children:o.jsx("span",{className:"text-xl",children:Jl[g.toUpperCase()]||""})},g))}),o.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 border border-slate-700 rounded-xl px-4 py-2",children:[o.jsx("input",{type:"number",className:"bg-transparent w-full text-center text-xl font-bold focus:outline-none",value:h,onChange:g=>f(parseInt(g.target.value)||0),placeholder:"0"}),o.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase",children:u})]}),o.jsx("button",{onClick:v,disabled:!!m,className:"w-full py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-bold shadow-lg shadow-emerald-500/20 disabled:opacity-50",children:m||"Send Gave"})]}),o.jsx("div",{className:"flex gap-2",children:r==="INFO"?o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:()=>a("GIFT"),className:"flex-1 py-3 bg-slate-800 hover:bg-slate-700 text-slate-200 rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95",children:[o.jsx(ZI,{size:18}),o.jsx("span",{children:"Gave"})]}),o.jsxs("button",{onClick:()=>c(!0),className:"flex-1 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-transform active:scale-95 shadow-lg shadow-indigo-500/20",children:[o.jsx(c1,{size:18}),o.jsx("span",{children:"Handel"})]})]}):o.jsx("button",{onClick:()=>a("INFO"),className:"w-full py-3 text-slate-400 hover:text-white font-bold",children:"Avbryt"})}),n.role==="SOLDIER"&&s.role==="SOLDIER"&&o.jsxs("button",{className:"w-full py-2 border border-red-500/30 text-red-400 hover:bg-red-500/10 rounded-xl font-bold uppercase tracking-widest text-xs flex items-center justify-center gap-2",children:[o.jsx(Gm,{size:14}),"Utfordre til Duell (Kommer snart)"]})]})]})}):null},xf=[{id:"first_steps",name:"Frste Skritt",description:"Overlev din frste dag i vildmarken.",icon:"",rarity:"COMMON",xp:100,category:"LIFE"},{id:"full_belly",name:"Mett Mage",description:"Spis 5 mltider p rad uten  bli sulten.",icon:"",rarity:"COMMON",xp:50,category:"LIFE"},{id:"resource_gatherer",name:"Flittig Arbeider",description:"Samle 250 ressurser med egne hender.",icon:"",rarity:"COMMON",xp:150,category:"LIFE"},{id:"master_craftsman",name:"Faglrt",description:"N niv 10 i en ferdighet.",icon:"",rarity:"RARE",xp:400,category:"LIFE"},{id:"soul_awakening",name:"Sjelens Oppvkning",description:"N Sjelsniv 5.",icon:"",rarity:"RARE",xp:1e3,category:"SOUL"},{id:"eternal_dynasty",name:"Evig Dynasti",description:"Ha 10 forfedre i Hall of Fame.",icon:"",rarity:"LEGENDARY",xp:5e3,category:"SOUL"},{id:"world_traveler",name:"Verdensvandrer",description:"Besk 5 forskjellige riger.",icon:"",rarity:"EPIC",xp:2500,category:"SOUL"},{id:"baron_rising",name:"Lokal Stolthet",description:"Bli utnevnt til Baron.",icon:"",rarity:"RARE",xp:800,category:"ROLE"},{id:"tax_collector",name:"Skatteinnkreveren",description:"Krev inn skatt fra 10 forskjellige bnder.",icon:"",rarity:"RARE",xp:600,category:"ROLE"},{id:"king_slayer",name:"Hyest i Riket",description:"Bli kronet til Konge over landet.",icon:"",rarity:"EPIC",xp:3e3,category:"ROLE"},{id:"benevolent_ruler",name:"Den Gode Hersker",description:"Ha 100% lojalitet i din region som Baron eller Konge.",icon:"",rarity:"EPIC",xp:2e3,category:"ROLE"},{id:"legendary_blacksmith",name:"Gudesmed",description:"Smi en gjenstand av ypperste kvalitet.",icon:"",rarity:"LEGENDARY",xp:4e3,category:"ROLE"}],ise=t=>xf.find(e=>e.id===t),ate=({achievement:t,unlocked:e,onClick:s})=>{const i={COMMON:{border:"border-slate-500/20",bg:"bg-slate-500/5",glow:"shadow-slate-500/5",text:"text-slate-400",iconBg:"bg-slate-500/10"},RARE:{border:"border-indigo-500/20",bg:"bg-indigo-500/5",glow:"shadow-indigo-500/10",text:"text-indigo-400",iconBg:"bg-indigo-500/10"},EPIC:{border:"border-amber-500/20",bg:"bg-amber-500/5",glow:"shadow-amber-500/20",text:"text-amber-400",iconBg:"bg-amber-500/10"},LEGENDARY:{border:"border-rose-500/20",bg:"bg-rose-500/5",glow:"shadow-rose-500/30",text:"text-rose-400",iconBg:"bg-rose-500/10"}}[t.rarity];return o.jsxs("div",{onClick:s,role:"button",tabIndex:0,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(s==null||s())},className:`
                group relative flex flex-col items-center justify-center p-5 rounded-[1.5rem] 
                transition-all duration-500 cursor-help overflow-hidden
                focus:outline-none focus:ring-2 focus:ring-indigo-500/50
                ${e?`border ${i.border} ${i.bg} hover:border-opacity-50 hover:scale-105 hover:shadow-2xl ${i.glow}`:"border border-white/5 bg-slate-900/40 opacity-40 grayscale hover:opacity-60 hover:grayscale-0"}
            `,children:[e&&(t.rarity==="EPIC"||t.rarity==="LEGENDARY")&&o.jsx("div",{className:`absolute inset-0 opacity-20 bg-gradient-to-br ${i.text.replace("text-","from-")}/0 to-transparent pointer-events-none`}),e&&t.rarity==="LEGENDARY"&&o.jsx("div",{className:"absolute inset-0 animate-pulse opacity-10 bg-rose-500 blur-xl pointer-events-none"}),o.jsxs("div",{className:`
                relative mb-3 w-14 h-14 flex items-center justify-center rounded-2xl text-3xl
                transition-transform duration-500 group-hover:scale-110 group-hover:rotate-3
                ${e?i.iconBg:"bg-white/5"}
            `,children:[e?o.jsx("span",{className:"drop-shadow-lg filter",children:t.icon}):o.jsx(Oo,{size:20,className:"opacity-50"}),e&&o.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-full rotate-45 group-hover:translate-y-[-150%] transition-transform duration-700 w-full h-full pointer-events-none"})]}),o.jsxs("div",{className:"text-center space-y-1 relative z-10",children:[o.jsx("h5",{className:`
                    font-black italic tracking-tight text-sm
                    ${e?"text-white":"text-slate-500"}
                `,children:e?t.name:"Ukjent Bragd"}),o.jsx("div",{className:"flex items-center justify-center gap-2 opacity-60",children:o.jsx("span",{className:"text-[9px] font-black uppercase tracking-wider text-slate-500",children:e?t.category:"???"})})]}),o.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-4 w-52 p-4 bg-slate-950/90 backdrop-blur-xl border border-white/10 rounded-2xl opacity-0 group-hover:opacity-100 transition-all duration-300 pointer-events-none z-50 shadow-2xl translate-y-4 group-hover:translate-y-0",children:[o.jsx("p",{className:`text-[9px] font-black uppercase tracking-widest mb-1 ${i.text}`,children:t.rarity}),o.jsx("h5",{className:"text-white font-black italic mb-2 tracking-tight text-sm",children:t.name}),o.jsx("p",{className:"text-[11px] text-slate-400 leading-tight",children:t.description}),o.jsxs("div",{className:"mt-3 flex items-center justify-between pt-3 border-t border-white/5",children:[o.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase",children:t.category}),o.jsx("div",{className:"flex items-center gap-1 text-amber-400",children:o.jsxs("span",{className:"text-[10px] font-black italic",children:["+",t.xp," XP"]})})]})]})]})},ote=({inGameMode:t=!1})=>{const{account:e}=yc(),[s,n]=N.useState("ALL"),i=N.useMemo(()=>{const h=(e==null?void 0:e.unlockedAchievements)||{};return Array.isArray(h)?new Set(h):new Set(Object.keys(h))},[e]),r=h=>i.has(h),a=N.useMemo(()=>s==="ALL"?xf:xf.filter(h=>h.category===s),[s]),l=xf.length,c=i.size,u=Math.round(c/l*100),d=[{id:"ALL",label:"Alle Bragder",icon:""},{id:"LIFE",label:"Nuet",icon:""},{id:"SOUL",label:"Sjelen",icon:""},{id:"ROLE",label:"Rollene",icon:""}];return o.jsxs("div",{className:`w-full ${t?"max-w-6xl mx-auto":""} space-y-8 animate-in fade-in duration-700`,children:[o.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6",children:[o.jsxs("div",{className:"space-y-2",children:[o.jsx("h3",{className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 italic uppercase tracking-tighter",children:"Mine Bragder"}),o.jsx("p",{className:"text-sm text-slate-400 font-medium max-w-lg",children:"En samling av dine strste triumfer gjennom alle dine liv. Hver bragd styrker sjelen din for evigheten."})]}),o.jsxs("div",{className:"flex items-center gap-4 bg-slate-900/50 backdrop-blur-md p-2 rounded-2xl border border-white/5",children:[o.jsxs("div",{className:"px-4 py-2 bg-indigo-500/10 rounded-xl border border-indigo-500/20 shadow-lg shadow-indigo-500/5 flex flex-col items-center min-w-[100px]",children:[o.jsx("span",{className:"text-[10px] font-black uppercase text-indigo-400 tracking-wider",children:"Antall"}),o.jsxs("span",{className:"text-xl font-black text-white",children:[c," ",o.jsxs("span",{className:"text-slate-500 text-sm",children:["/ ",l]})]})]}),o.jsxs("div",{className:"px-4 py-2 bg-amber-500/10 rounded-xl border border-amber-500/20 shadow-lg shadow-amber-500/5 flex flex-col items-center min-w-[100px]",children:[o.jsx("span",{className:"text-[10px] font-black uppercase text-amber-400 tracking-wider",children:"Fullfrt"}),o.jsxs("span",{className:"text-xl font-black text-white",children:[u,"%"]})]})]})]}),o.jsx("div",{className:"flex overflow-x-auto pb-2 gap-2 custom-scrollbar",children:d.map(h=>o.jsxs("button",{onClick:()=>n(h.id),className:`
                            px-6 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] whitespace-nowrap transition-all
                            flex items-center gap-2 border
                            ${s===h.id?"bg-white text-slate-900 border-white shadow-lg shadow-white/10 scale-105":"bg-white/5 text-slate-400 border-white/5 hover:bg-white/10 hover:text-white"}
                        `,children:[o.jsx("span",{className:"text-base",children:h.icon}),h.label]},h.id))}),o.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(h=>o.jsx(ate,{achievement:h,unlocked:r(h.id)},h.id))}),a.length===0&&o.jsx("div",{className:"py-20 text-center opacity-30",children:o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"Ingen bragder funnet i denne kategorien"})})]})},lte=({onClose:t,currentRoomPin:e})=>{const{account:s,logout:n,isAnonymous:i}=yc(),[r,a]=N.useState("overview"),l=N.useMemo(()=>s!=null&&s.activeSessions?(Array.isArray(s.activeSessions)?s.activeSessions:Object.values(s.activeSessions)).sort((y,k)=>k.lastPlayed-y.lastPlayed):[],[s]),c=N.useMemo(()=>l.reduce((p,y)=>p+(y.xp||0),0),[l]),u=(s==null?void 0:s.globalXp)||0,d=u+c,h=(s==null?void 0:s.globalLevel)||1,f=Math.pow(h,2)*100,m=Math.pow(h-1,2)*100,b=Math.min(100,Math.max(0,(d-m)/(f-m)*100)),x=()=>{var p;return o.jsxs("div",{className:"space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("div",{className:"flex flex-col md:flex-row items-center md:items-start text-center md:text-left gap-10",children:[o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500 blur-3xl opacity-20 group-hover:opacity-40 transition-opacity rounded-full"}),o.jsx("div",{className:"w-40 h-40 bg-slate-900 border border-white/10 rounded-full flex items-center justify-center relative overflow-hidden shadow-2xl",children:o.jsx(Gn,{size:80,className:"text-slate-200"})}),o.jsx("div",{className:"absolute bottom-0 right-0 bg-indigo-500 text-white text-xs font-black px-3 py-1 rounded-full border-4 border-[#0A0A15] uppercase tracking-wider",children:"Operator"})]}),o.jsxs("div",{className:"flex-1 space-y-8 pt-4 max-w-5xl",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-sm font-bold text-indigo-400 uppercase tracking-[0.4em] mb-2",children:"Global Profil"}),o.jsx("h2",{className:"text-5xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400 uppercase tracking-tighter",children:(s==null?void 0:s.displayName)||"Ukjent Identitet"})]}),o.jsxs("div",{className:"flex flex-wrap gap-6 justify-center md:justify-start",children:[o.jsxs("div",{className:"px-8 py-5 bg-white/5 border border-white/10 rounded-3xl flex items-center gap-6 relative overflow-hidden group/lvl min-w-[200px]",children:[o.jsx("div",{className:"p-3 bg-indigo-500/20 rounded-2xl text-indigo-400",children:o.jsx(nT,{size:24})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-[0.2em] font-black mb-1",children:"Sjelsniv"}),o.jsx("p",{className:"text-4xl font-black text-white italic",children:h})]}),o.jsx("div",{className:"absolute bottom-0 left-0 h-1.5 bg-indigo-600/30 w-full",children:o.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.5)]",style:{width:`${b}%`}})})]}),o.jsxs("div",{className:"px-8 py-5 bg-white/5 border border-white/10 rounded-3xl flex items-center gap-6 min-w-[200px]",children:[o.jsx("div",{className:"p-3 bg-amber-500/20 rounded-2xl text-amber-400",children:o.jsx(GQ,{size:24})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-[0.2em] font-black mb-1",children:"Total Erfaring"}),o.jsxs("p",{className:"text-3xl font-black text-white italic flex items-baseline gap-2",children:[u,c>0&&o.jsxs("span",{className:"text-indigo-400 text-sm opacity-60 font-bold",title:"Hstbar XP",children:["(+",c,")"]})]})]})]})]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-8 border-t border-white/5",children:[o.jsxs("div",{className:"p-6 bg-slate-900/50 rounded-2xl border border-white/5 text-center",children:[o.jsx("p",{className:"text-3xl font-black text-white",children:l.length}),o.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mt-1",children:"Aktive Spill"})]}),o.jsxs("div",{className:"p-6 bg-slate-900/50 rounded-2xl border border-white/5 text-center",children:[o.jsx("p",{className:"text-3xl font-black text-white",children:((p=s==null?void 0:s.characterHistory)==null?void 0:p.length)||0}),o.jsx("p",{className:"text-xs text-slate-500 uppercase tracking-widest font-bold mt-1",children:"Falne Helter"})]})]})]})},v=()=>o.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("h3",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400",children:o.jsx(Gn,{size:20})}),"Dine Vessels"]}),l.length===0?o.jsxs("div",{className:"p-16 border border-white/5 border-dashed rounded-[2rem] text-center text-slate-500",children:[o.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"Ingen aktive spill funnet"}),o.jsx("p",{className:"text-base mt-2 opacity-60",children:"G til lobbyen for  starte din reise."})]}):o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-6",children:l.map((p,y)=>o.jsxs("div",{className:"group bg-slate-800/40 hover:bg-slate-800/80 border border-white/5 hover:border-indigo-500/30 p-8 rounded-[2rem] transition-all relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-0 right-0 p-6 opacity-5 group-hover:opacity-10 transition-opacity transform group-hover:scale-110 duration-500",children:p.role==="KING"?o.jsx(Ic,{size:120}):o.jsx(Gn,{size:120})}),o.jsxs("div",{className:"relative z-10 space-y-6",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center justify-between mb-2",children:[o.jsx("span",{className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest px-2 py-1 bg-indigo-500/10 rounded-md",children:p.role}),o.jsx("span",{className:"text-[10px] font-mono text-slate-500",children:p.roomPin})]}),o.jsx("h4",{className:"text-3xl font-black text-white tracking-tight",children:p.name}),o.jsxs("p",{className:"text-xs text-slate-400 flex items-center gap-1.5 mt-2",children:[o.jsx(Hm,{size:12})," Sist spilt: ",new Date(p.lastPlayed).toLocaleDateString()]})]}),o.jsx("button",{onClick:()=>{if(e&&p.roomPin===e){t==null||t();return}confirm(`Vil du fortlate nvrende spill for  bytte til ${p.name}?`)&&(window.location.href=`/play/${p.roomPin}`)},className:`w-full py-4 rounded-xl font-black uppercase tracking-widest text-xs flex items-center justify-center gap-3 shadow-lg transition-all
                                        ${e&&p.roomPin===e?"bg-emerald-600 hover:bg-emerald-500 text-white shadow-emerald-600/20":"bg-indigo-600 hover:bg-indigo-500 text-white shadow-indigo-600/20 hover:scale-[1.02] active:scale-95"}`,children:e&&p.roomPin===e?o.jsxs(o.Fragment,{children:[o.jsx(Rc,{size:14,fill:"currentColor"})," Du spiller denne"]}):o.jsxs(o.Fragment,{children:[o.jsx(pd,{size:14,fill:"currentColor"})," Fortsett"]})})]})]},y))})]}),g=()=>o.jsxs("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[o.jsxs("h3",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-slate-400",children:o.jsx(Hm,{size:20})}),"Hall of Fame"]}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:!(s!=null&&s.characterHistory)||s.characterHistory.length===0?o.jsx("div",{className:"col-span-full py-20 text-center opacity-30 border-2 border-dashed border-white/10 rounded-[2rem]",children:o.jsx("p",{className:"text-sm font-bold uppercase tracking-widest",children:"Ingen falne helter i historiebkene"})}):s.characterHistory.slice().reverse().map((p,y)=>o.jsxs("div",{className:"flex items-center justify-between p-6 bg-slate-900/60 rounded-2xl border border-white/5 hover:border-white/10 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-5",children:[o.jsx("div",{className:"w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center text-2xl grayscale group-hover:grayscale-0 transition-all shadow-inner",children:p.role==="KING"?"":p.role==="BARON"?"":""}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-black text-white uppercase tracking-wide group-hover:text-indigo-400 transition-colors",children:p.name}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-slate-500 uppercase font-bold mt-0.5",children:[o.jsx("span",{className:"bg-white/5 px-1.5 py-0.5 rounded text-slate-400",children:p.role}),o.jsx("span",{children:""}),o.jsxs("span",{className:"text-indigo-400",children:["Lvl ",p.level]})]})]})]}),o.jsxs("div",{className:"text-right",children:[o.jsx("p",{className:"text-[10px] font-mono text-slate-600 block",children:new Date(p.timestamp).toLocaleDateString()}),o.jsx("p",{className:"text-[10px] font-black text-indigo-900 group-hover:text-indigo-500 transition-colors uppercase pt-1",children:p.roomPin})]})]},y))})]});return o.jsxs("div",{className:"relative z-10 flex flex-col h-full bg-[#0A0A15]",children:[o.jsx("div",{className:"sticky top-0 z-50 bg-[#0A0A15]/95 backdrop-blur-xl border-b border-white/5 shadow-2xl transition-all px-8 md:px-12 pt-8 pb-4",children:o.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-2 md:gap-4",children:[o.jsxs("button",{onClick:()=>a("overview"),className:`px-5 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border ${r==="overview"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(tO,{size:14}),o.jsx("span",{children:"Oversikt"})]}),o.jsxs("button",{onClick:()=>a("vessels"),className:`px-5 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border ${r==="vessels"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(pd,{size:14}),o.jsx("span",{children:"Vessels"})]}),o.jsxs("button",{onClick:()=>a("achievements"),className:`px-5 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border ${r==="achievements"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(nT,{size:14}),o.jsx("span",{children:"Bragder"})]}),o.jsxs("button",{onClick:()=>a("history"),className:`px-5 py-2 rounded-full text-[10px] font-black uppercase tracking-widest transition-all flex items-center gap-2 border ${r==="history"?"bg-indigo-600 border-indigo-500 text-white shadow-lg shadow-indigo-600/25":"bg-slate-900 border-white/10 text-slate-400 hover:text-white hover:border-white/20"}`,children:[o.jsx(kQ,{size:14}),o.jsx("span",{children:"Historikk"})]})]})}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-16 pt-8",children:o.jsxs("div",{className:"mx-auto w-full max-w-[95%] xl:max-w-[90%] 2xl:max-w-[2000px]",children:[r==="overview"&&x(),r==="vessels"&&v(),r==="achievements"&&o.jsx("div",{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:o.jsx(ote,{inGameMode:!0})}),r==="history"&&g()]})}),o.jsx("div",{className:"mt-auto px-8 md:px-12 py-8 flex justify-end border-t border-white/5 bg-[#0A0A15]/50 backdrop-blur-md",children:i?o.jsxs("button",{className:"px-6 py-3 bg-indigo-600 text-white rounded-xl font-bold uppercase text-xs tracking-widest shadow-lg flex items-center gap-2",children:[o.jsx(u1,{size:14})," Sikre Profil"]}):o.jsxs("button",{onClick:async()=>{await n(),t==null||t(),window.location.href="/"},className:"px-6 py-3 bg-white/5 text-rose-400 hover:bg-rose-500/10 rounded-xl font-bold uppercase text-xs tracking-widest border border-white/5 flex items-center gap-2",children:[o.jsx(rQ,{size:14})," Logg Ut"]})})]})},cte=({isOpen:t,onClose:e,currentRoomPin:s})=>(N.useEffect(()=>{if(t){const n=window.getComputedStyle(document.body).overflow;document.body.style.overflow="hidden";const i=r=>{r.key==="Escape"&&e()};return window.addEventListener("keydown",i),()=>{document.body.style.overflow=n,window.removeEventListener("keydown",i)}}},[t,e]),t?VT.createPortal(o.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-[#0A0A15]/60 backdrop-blur-xl animate-in fade-in duration-300",children:o.jsxs("div",{className:"w-full h-[100dvh] md:w-[95vw] md:max-w-[1920px] md:h-[90vh] bg-[#0A0A15] md:border border-white/10 md:rounded-[3rem] shadow-2xl overflow-hidden relative flex flex-col animate-in slide-in-from-bottom-4 md:zoom-in-95 duration-500 ease-out",children:[o.jsx("div",{className:"absolute top-6 right-6 md:top-8 md:right-8 z-50",children:o.jsx("button",{onClick:e,"aria-label":"Lukk profil",className:"p-3 bg-white/5 hover:bg-white/10 text-slate-400 hover:text-white rounded-full transition-all backdrop-blur-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50 active:scale-95",children:o.jsx(Yn,{size:24})})}),o.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar flex flex-col",children:o.jsx(lte,{onClose:e,currentRoomPin:s})})]})}),document.body):null),_T=[{id:"CHASSIS",label:"Vogn",icon:""},{id:"WHEELS",label:"Hjul",icon:""},{id:"COVER",label:"Kalesje",icon:""},{id:"LANTERNS",label:"Lykter",icon:""},{id:"SKIN",label:"Trekkdyr",icon:""},{id:"FLAG",label:"Flagg",icon:""},{id:"COMPANION",label:"Passasjer",icon:""},{id:"TRAIL",label:"Spor",icon:""},{id:"DECOR",label:"Dekor",icon:""}],ute=({player:t,onBuy:e,onEquip:s})=>{var u,d,h;const[n,i]=N.useState(()=>sessionStorage.getItem("caravan_shop_cat")||"CHASSIS");Se.useEffect(()=>{sessionStorage.setItem("caravan_shop_cat",n)},[n]);const r=((d=(u=t.caravan)==null?void 0:u.customization)==null?void 0:d.unlocked)||[],a=((h=t.caravan)==null?void 0:h.customization)||{},l=N.useMemo(()=>Object.values(f1).filter(f=>f.category===n),[n]),c=f=>{var m;(t.resources.gold||0)<f.cost||f.reqLevel&&(((m=t.caravan)==null?void 0:m.level)||1)<f.reqLevel||e(f.id)};return o.jsxs("div",{className:"flex h-full p-6 pt-0 gap-8 relative",children:[o.jsx("div",{className:"w-56 flex flex-col relative z-10 h-full border-r border-white/5 pr-6",children:o.jsx("div",{className:"flex-1 flex flex-col gap-2 overflow-y-auto no-scrollbar mask-scroll pb-2",children:_T.map(f=>o.jsxs("button",{onClick:()=>i(f.id),className:`relative group shrink-0 h-14 flex items-center px-4 gap-4 rounded-xl transition-all duration-200 ${n===f.id?"bg-gradient-to-r from-amber-400 to-amber-500 text-black shadow-lg shadow-amber-500/20 z-10 scale-[1.02]":"bg-transparent text-slate-400 hover:text-white hover:bg-white/5"}`,children:[o.jsx("span",{className:`text-2xl filter transition-all ${n===f.id?"scale-110 drop-shadow-sm":"grayscale opacity-70 group-hover:grayscale-0 group-hover:opacity-100"}`,children:f.icon}),o.jsx("span",{className:`text-xs uppercase font-black tracking-widest leading-none ${n===f.id?"opacity-100":"opacity-70"}`,children:f.label}),n===f.id&&o.jsx("div",{className:"absolute inset-0 rounded-xl border border-white/20 pointer-events-none"})]},f.id))})}),o.jsx("div",{className:"flex-1 pt-0 pb-6 overflow-y-auto no-scrollbar mask-scroll-content",children:o.jsx(qt,{mode:"popLayout",children:o.jsx(ee.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,x:-10},transition:{duration:.15},className:"flex flex-col gap-2.5",children:l.map(f=>{var k,w,S;const m=r.includes(f.id),b=Object.values(a).includes(f.id),x=(t.resources.gold||0)>=f.cost,v=(((k=t.caravan)==null?void 0:k.level)||1)>=(f.reqLevel||0),g=f.id==="skin_horse_linked",p=(w=t.horseCustomization)==null?void 0:w.skinId;let y="";return m||(v?x||(y="Mangler Gull"):y=`Lvl ${f.reqLevel}`),g&&!p&&(y="Ingen Hest"),o.jsx(ee.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`relative p-[1px] rounded-xl transition-all group overflow-hidden ${b?"bg-gradient-to-r from-amber-400 to-amber-600 shadow-md shadow-amber-500/10":"bg-slate-800"}`,children:o.jsxs("div",{className:"bg-[#0B0F19] rounded-[11px] h-16 pr-4 flex items-center gap-5 relative z-10 pl-3",children:[o.jsx("div",{className:`w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center text-xl bg-slate-900 border border-white/5 ${b?"shadow-[0_0_10px_rgba(251,191,36,0.1)]":""}`,children:(S=_T.find(_=>_.id===n))==null?void 0:S.icon}),o.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[o.jsx("h4",{className:`font-black uppercase text-sm truncate leading-none mb-1.5 ${b?"text-white":"text-slate-300"}`,children:f.name.replace("Vogn: ","")}),o.jsxs("div",{className:"flex items-center gap-2",children:[f.reqLevel&&!m&&o.jsxs("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest ",children:["Lvl ",f.reqLevel]}),!m&&o.jsxs("span",{className:"text-xs text-amber-500 font-bold bg-amber-500/10 px-2 py-0.5 rounded border border-amber-500/20",children:[f.cost,"g"]}),m&&!b&&o.jsx("span",{className:"text-xs text-emerald-500 font-bold uppercase tracking-widest",children:"Eies"})]})]}),o.jsx("div",{className:"flex-shrink-0 w-28",children:m?o.jsx("button",{onClick:()=>s(f.id),disabled:b||g&&!p,className:`w-full py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${b?"bg-amber-500/10 text-amber-500 border border-amber-500/20 cursor-default shadow-[0_0_10px_rgba(245,158,11,0.1)]":g&&!p?"bg-slate-800 text-red-500 cursor-not-allowed":"bg-white text-black hover:bg-amber-400 hover:scale-[1.02]"}`,children:b?"VALGT":g&&!p?"MANGLER HEST":"VELG"}):o.jsx("button",{onClick:()=>c(f),disabled:!!y,className:`w-full py-2 rounded-lg text-xs font-black uppercase tracking-widest transition-all ${y?"bg-slate-800 text-slate-500 cursor-not-allowed":"bg-amber-400 text-black hover:bg-amber-300 hover:scale-[1.02] shadow-lg shadow-amber-900/10"}`,children:y||"KJP"})})]})},f.id)})},n)})}),o.jsx("style",{children:`
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
                .no-scrollbar {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
                .mask-scroll {
                     mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
                    -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
                }
                .mask-scroll-content {
                    mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
                    -webkit-mask-image: linear-gradient(to bottom, black 95%, transparent 100%);
                }
            `})]})},dte=({player:t,onAction:e,onClose:s,preselectedTarget:n})=>{var x;const[i,r]=N.useState(()=>sessionStorage.getItem("caravan_tab")||(n?"TRAVEL":"CARGO"));Se.useEffect(()=>{sessionStorage.setItem("caravan_tab",i)},[i]);const a=Se.useMemo(()=>{const v=t.caravan||{};return{level:v.level||1,inventory:v.inventory||{},durability:v.durability??100,upgrades:v.upgrades||[],customization:v.customization}},[t.caravan]),l=re.CARAVAN.LEVELS.find(v=>v.level===a.level)||re.CARAVAN.LEVELS[0],c=Object.values(a.inventory).reduce((v,g)=>v+(g||0),0),u=l.capacity,d=v=>{e({type:"LOAD_CARAVAN",resource:v,amount:1})},h=v=>{e({type:"UNLOAD_CARAVAN",resource:v,amount:1})},f=(v,g)=>{e({type:"UPGRADE_CARAVAN",upgradeType:v,upgradeId:g})},m=v=>{e({type:"TRAVEL_START",targetRegionId:v}),s()},b=()=>{e({type:"REPAIR_CARAVAN"})};return o.jsx(ee.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md",children:o.jsxs("div",{className:"relative w-full max-w-7xl h-[750px] bg-[#0B0F19] rounded-[2rem] overflow-hidden flex shadow-2xl border border-white/5",children:[o.jsxs("div",{className:"w-[38%] relative flex flex-col pointer-events-none",children:[o.jsxs("div",{className:"absolute inset-0 bg-gradient-to-b from-slate-900 to-[#05080f]",children:[o.jsx("div",{className:"absolute top-[-20%] left-[-20%] w-[140%] h-[80%] bg-blue-500/10 blur-[100px] rounded-full"}),o.jsx("div",{className:"absolute bottom-[0%] right-[0%] w-[80%] h-[60%] bg-amber-500/5 blur-[80px] rounded-full"})]}),o.jsxs("div",{className:"relative z-10 px-8 pt-8 space-y-6",children:[o.jsx("div",{className:"flex justify-between items-start",children:o.jsxs("div",{children:[o.jsx("h1",{className:"text-4xl font-black text-white italic tracking-tighter uppercase drop-shadow-lg",children:"Karavane"}),o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.jsxs("span",{className:"px-2 py-0.5 bg-amber-400/10 border border-amber-400/20 text-amber-400 text-xs font-black uppercase rounded",children:["Niv ",a.level]}),o.jsx("span",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest",children:l.name})]})]})}),o.jsxs("div",{className:"space-y-3 bg-black/20 p-4 rounded-xl border border-white/5 backdrop-blur-sm pointer-events-auto",children:[o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Lastkapasitet"}),o.jsxs("span",{className:c>=u?"text-rose-400":"text-white",children:[c," / ",u]})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden",children:o.jsx(ee.div,{initial:{width:0},animate:{width:`${c/u*100}%`},className:"h-full bg-amber-400 shadow-[0_0_10px_rgba(251,191,36,0.5)]"})})]}),o.jsxs("div",{className:"space-y-1",children:[o.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase tracking-wider text-slate-400",children:[o.jsx("span",{children:"Tilstand"}),o.jsxs("span",{className:a.durability<l.durability*.3?"text-rose-500":"text-emerald-400",children:[Math.round(a.durability)," / ",l.durability]})]}),o.jsx("div",{className:"h-1.5 w-full bg-slate-800 rounded-full overflow-hidden",children:o.jsx(ee.div,{initial:{width:0},animate:{width:`${a.durability/l.durability*100}%`},className:`h-full shadow-[0_0_10px_rgba(16,185,129,0.5)] ${a.durability<l.durability*.3?"bg-rose-500":"bg-emerald-500"}`})})]}),a.durability<l.durability&&o.jsxs("button",{onClick:b,className:"w-full mt-2 py-2 bg-emerald-500/10 hover:bg-emerald-500/20 border border-emerald-500/30 text-emerald-400 rounded-lg text-xs font-black uppercase transition-all flex items-center justify-center gap-2 group",children:[o.jsx("span",{children:" Reparer"}),o.jsxs("span",{className:"opacity-50 group-hover:opacity-100",children:["(",Math.round((l.durability-(a.durability||0))*2),"g)"]})]})]})]}),o.jsxs("div",{className:"flex-1 flex items-center justify-center relative translate-y-[-20px] pointer-events-auto",children:[o.jsx(xO,{level:a.level,upgrades:a.upgrades,customization:(x=t.caravan)==null?void 0:x.customization,horseCustomization:t.horseCustomization,className:"w-full max-w-[340px] drop-shadow-[0_50px_60px_rgba(0,0,0,0.6)] z-10"}),o.jsx("div",{className:"absolute bottom-[20%] w-[60%] h-[20px] bg-black/40 blur-xl rounded-[100%]"})]})]}),o.jsxs("div",{className:"flex-1 flex flex-col bg-[#111624] border-l border-white/5 relative z-20",children:[o.jsxs("div",{className:"h-20 flex items-center justify-between px-8 border-b border-white/5",children:[o.jsx("div",{className:"flex gap-1 bg-slate-900/50 p-1 rounded-xl border border-white/5",children:["CARGO","UPGRADES","STYLE","TRAVEL"].map(v=>o.jsx("button",{onClick:()=>r(v),className:`px-5 py-2 text-xs font-black uppercase tracking-widest rounded-lg transition-all ${i===v?"bg-amber-400 text-black shadow-lg shadow-amber-400/20":"text-slate-500 hover:text-white hover:bg-white/5"}`,children:v==="CARGO"?"Last":v==="UPGRADES"?"Oppgraderinger":v==="STYLE"?"Style":"Reise"},v))}),o.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/5 hover:bg-rose-500/20 hover:text-rose-400 flex items-center justify-center text-slate-400 transition-colors",children:""})]}),o.jsx("div",{className:"flex-1 overflow-hidden relative",children:o.jsx("div",{className:"absolute inset-0 overflow-y-auto custom-scrollbar p-8",children:o.jsxs(qt,{mode:"wait",children:[i==="CARGO"&&o.jsx(ee.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"space-y-6",children:o.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx("span",{children:"Ditt Lager"}),o.jsx("div",{className:"h-px bg-slate-800 flex-1"})]}),o.jsx("div",{className:"space-y-2",children:Object.entries(t.resources).map(([v,g])=>{if(v==="gold"||g<=0)return null;const p=Ge[v];return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-900/40 rounded-xl border border-white/5 hover:border-amber-400/30 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-slate-800 flex items-center justify-center text-lg shadow-inner",children:Jl[v.toUpperCase()]||""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-white uppercase group-hover:text-amber-400 transition-colors",children:(p==null?void 0:p.label)||v}),o.jsxs("div",{className:"text-xs text-slate-500 font-bold",children:["Antall: ",g]})]})]}),o.jsx("button",{onClick:()=>d(v),className:"px-3 py-1.5 bg-slate-800 text-white hover:bg-amber-400 hover:text-black text-xs font-black uppercase rounded-lg transition-all",children:""})]},v)})})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest flex items-center gap-2",children:[o.jsx("span",{children:"Karavane-Lass"}),o.jsx("div",{className:"h-px bg-slate-800 flex-1"})]}),o.jsxs("div",{className:"space-y-2",children:[Object.entries(a.inventory).map(([v,g])=>{if(g<=0)return null;const p=Ge[v];return o.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-400/5 rounded-xl border border-amber-400/20 hover:bg-amber-400/10 transition-colors group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-400/10 flex items-center justify-center text-lg border border-amber-400/20",children:Jl[v.toUpperCase()]||""}),o.jsxs("div",{children:[o.jsx("div",{className:"text-xs font-bold text-amber-200 uppercase",children:(p==null?void 0:p.label)||v}),o.jsxs("div",{className:"text-xs text-amber-400/60 font-bold",children:["Lastet: ",g]})]})]}),o.jsx("button",{onClick:()=>h(v),className:"px-3 py-1.5 bg-slate-900 text-slate-300 hover:text-white border border-slate-700 hover:border-slate-500 text-xs font-black uppercase rounded-lg transition-all",children:"Loss"})]},v)}),Object.values(a.inventory).every(v=>!v||v<=0)&&o.jsx("div",{className:"h-24 flex items-center justify-center border-2 border-dashed border-slate-800 rounded-xl",children:o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"text-2xl opacity-20 mb-1",children:""}),o.jsx("div",{className:"text-slate-600 text-xs font-bold uppercase",children:"Tomt Lasterom"})]})})]})]})]})},"cargo"),i==="UPGRADES"&&o.jsxs(ee.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-8",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:"Neste Niv"}),(()=>{const v=re.CARAVAN.LEVELS.find(g=>g.level===a.level+1);return v?o.jsxs("div",{className:"p-6 bg-gradient-to-br from-indigo-900/20 to-slate-900/50 rounded-2xl border border-indigo-500/30 flex justify-between items-center group hover:border-indigo-400/50 transition-colors",children:[o.jsxs("div",{className:"flex gap-4 items-center",children:[o.jsx("div",{className:"w-12 h-12 bg-indigo-500/20 rounded-xl flex items-center justify-center text-2xl border border-indigo-500/30",children:""}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-white font-black uppercase italic text-lg group-hover:text-indigo-300 transition-colors",children:v.name}),o.jsxs("p",{className:"text-slate-400 text-xs font-bold uppercase tracking-widest",children:["Kapasitet: ",o.jsx("span",{className:"text-indigo-400",children:v.capacity}),"  Fart: ",o.jsxs("span",{className:"text-indigo-400",children:[v.speed,"x"]})]})]})]}),o.jsxs("button",{onClick:()=>f("LEVEL"),className:"px-6 py-3 bg-white text-slate-950 font-black uppercase italic rounded-xl hover:bg-indigo-400 hover:scale-105 transition-all shadow-lg shadow-indigo-900/20",children:["Kjp ",v.cost,"g"]})]}):o.jsx("p",{className:"text-xs text-emerald-400 font-bold uppercase italic bg-emerald-500/10 p-4 rounded-xl border border-emerald-500/20",children:"Maks niv ndd!"})})()]}),o.jsxs("div",{className:"space-y-4",children:[o.jsx("h3",{className:"text-xs font-black text-slate-500 uppercase tracking-widest",children:"Spesialmoduler"}),o.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(re.CARAVAN.UPGRADES).map(([v,g])=>{const p=(a.upgrades||[]).includes(g.id);return o.jsxs("div",{className:`p-5 rounded-2xl border transition-all ${p?"bg-emerald-900/10 border-emerald-500/20":"bg-slate-900/40 border-white/5 hover:border-white/10"}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-3",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center text-sm ${p?"bg-emerald-500/20 text-emerald-400":"bg-slate-800 text-slate-400"}`,children:""}),o.jsx("h4",{className:`font-black text-xs uppercase ${p?"text-emerald-400":"text-white"}`,children:g.name})]}),p&&o.jsx("span",{className:"text-xs font-black text-emerald-950 bg-emerald-400 px-2 py-0.5 rounded uppercase",children:"Eies"})]}),o.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase leading-relaxed mb-4 h-8",children:g.benefit}),!p&&o.jsxs("button",{onClick:()=>f("MODULE",v.toLowerCase()),className:"w-full py-2 bg-slate-800 text-white text-xs font-black uppercase rounded-lg hover:bg-slate-700 border border-slate-700 transition-colors",children:["Kjp for ",g.cost,"g"]})]},v)})})]})]},"upgrades"),i==="STYLE"&&o.jsx(ee.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"h-full -m-8",children:o.jsx(ute,{player:t,onBuy:v=>e({type:"BUY_CARAVAN_COSMETIC",cosmeticId:v}),onEquip:v=>e({type:"EQUIP_CARAVAN_COSMETIC",cosmeticId:v})})},"style"),i==="TRAVEL"&&o.jsxs(ee.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[o.jsx("div",{className:"bg-amber-400/10 p-4 border border-amber-400/20 rounded-xl",children:o.jsxs("p",{className:"text-xs text-amber-200 font-bold uppercase flex items-center gap-2",children:[o.jsx("span",{children:""})," Reisen krever 20 Stamina og 1 Brd-niste."]})}),o.jsx("div",{className:"grid grid-cols-1 gap-4",children:["region_ost","region_vest","capital"].map(v=>{if(v===t.regionId)return null;const g=v==="capital"?"Hovedstaden":v==="region_vest"?"Vestfjella":"stlandet",p=v===n;return o.jsxs("button",{onClick:()=>m(v),className:`group p-6 rounded-2xl border transition-all text-left flex justify-between items-center ${p?"bg-indigo-600/20 border-indigo-400 shadow-[0_0_30px_rgba(99,102,241,0.2)]":"bg-slate-900/40 border-white/5 hover:border-amber-400/50 hover:bg-amber-400/5"}`,children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("h4",{className:`font-black uppercase italic text-xl transition-colors ${p?"text-indigo-300":"text-white group-hover:text-amber-400"}`,children:g}),p&&o.jsx("span",{className:"bg-indigo-500 text-white text-xs font-black px-2 py-0.5 rounded uppercase animate-pulse",children:"Destinasjon"})]}),o.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest mt-1 group-hover:text-slate-400",children:"Klikk for  starte reisen"})]}),o.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center text-2xl group-hover:scale-110 transition-transform ${p?"bg-indigo-500 text-white":"bg-slate-800 text-slate-500 group-hover:bg-amber-400 group-hover:text-black"}`,children:""})]},v)})})]},"travel")]})})})]})]})})},wO=Se.memo(({pos:t})=>{const[i,r]=N.useState(0);N.useEffect(()=>{let l;const c=()=>{r(u=>u+.15),l=requestAnimationFrame(c)};return l=requestAnimationFrame(c),()=>cancelAnimationFrame(l)},[]);const a=N.useMemo(()=>Array.from({length:15},(l,c)=>({id:c,seedX:c*777%4e3,seedY:c*999%4e3,scale:.6+c%5*.4,parallaxFactor:1,driftSpeedX:.15+c%3*.1,driftSpeedY:.05+c%2*.05,opacity:.25+c%3*.15,blur:10+c%3*10,hue:200+c%5*2})),[]);return o.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden z-[200]",style:{contain:"strict"},children:[o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[6000px] h-[6000px] opacity-[0.03] mix-blend-overlay z-[-1]",style:{backgroundColor:"hsl(210, 65%, 12%)",backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1000' height='1000'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.04' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='1000' height='1000' filter='url(%23noise)'/%3E%3C/svg%3E")`,transform:`translate3d(${-t.x*.4}px, ${-t.y*.4}px, 0)`,willChange:"transform"}}),o.jsx("div",{className:"absolute inset-0",style:{perspective:"1000px"},children:a.map(l=>{let c=(l.seedX+i*l.driftSpeedX-t.x*l.parallaxFactor)%4e3,u=(l.seedY+i*l.driftSpeedY-t.y*l.parallaxFactor)%4e3;return c<-2e3&&(c+=4e3),c>2e3&&(c-=4e3),u<-2e3&&(u+=4e3),u>2e3&&(u-=4e3),o.jsx("div",{className:"absolute left-1/2 top-1/2 rounded-full mix-blend-screen",style:{width:250*l.scale,height:150*l.scale,background:`radial-gradient(circle at 30% 40%, hsla(${l.hue}, 20%, 100%, ${l.opacity}) 0%, hsla(${l.hue}, 10%, 90%, ${l.opacity*.6}) 40%, transparent 80%)`,boxShadow:`
                                    ${20*l.scale}px ${10*l.scale}px ${30*l.scale}px hsla(${l.hue}, 10%, 95%, ${l.opacity*.8}),
                                    ${-30*l.scale}px ${20*l.scale}px ${40*l.scale}px hsla(${l.hue}, 10%, 90%, ${l.opacity*.5})
                                `,filter:`blur(${l.blur}px)`,transform:`translate3d(${c}px, ${u}px, 0)`,willChange:"transform"}},l.id)})}),o.jsx("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[1200px] h-[1200px] rounded-full pointer-events-none opacity-20 mix-blend-soft-light",style:{background:"radial-gradient(circle, hsla(200, 100%, 50%, 0.2) 0%, transparent 70%)"}})]})});wO.displayName="SeaBackground";const br=5e3,Hh=[{id:1,x:1200,y:800,r:180,color:"#064e3b",name:"Furuy"},{id:2,x:3500,y:1200,r:250,color:"#14532d",name:"Jungel-atollen"},{id:3,x:800,y:3800,r:120,color:"#451a03",name:"Smuglerbukta"},{id:4,x:4200,y:4e3,r:200,color:"#0f172a",name:"Jernfestningen"},{id:5,x:2500,y:2500,r:150,color:"#1e3a8a",name:"Hovedposten"}],hte=({player:t,roomPin:e,onExit:s,onActionResult:n})=>{var Le,lt,se,le,ke,we,Q,Z;const{setActiveMinigame:i}=yo(),[r,a]=N.useState({x:1e3,y:1e3}),[l,c]=N.useState(0),[u,d]=N.useState(!1),[h,f]=N.useState({}),[m,b]=N.useState([]),[x,v]=N.useState(((Le=t.boat)==null?void 0:Le.hp)||100),[g]=N.useState(((lt=t.boat)==null?void 0:lt.maxHp)||100),[p,y]=N.useState(((se=t.boat)==null?void 0:se.cannonballs)||0),[k,w]=N.useState(!1),[S,_]=N.useState(0),[T,E]=N.useState([]),[A,j]=N.useState([]),[O,H]=N.useState(0),[G,L]=N.useState(null),[M,D]=N.useState([]),I=N.useRef(0),F=N.useRef(0),U=N.useRef({x:0,y:0}),R=N.useRef({x:1e3,y:1e3,rotation:0,angularVelocity:0,speed:0,targetSpeed:0,targetRotation:0,velocityVector:{x:0,y:0},projectiles:[],explosions:[],net:null}),C=N.useRef(0),$=N.useRef(Date.now()),V=N.useRef(Date.now()),P=N.useRef({left:!1,right:!1,up:!1,down:!1,action:!1});N.useEffect(()=>{const B=z(q,`simulation_rooms/${e}/sea_state`),ae=tt(B,it=>{const Fe=it.val();if(Fe){const{[t.id]:mr,...Mc}=Fe;f(Mc)}else f({})}),K=z(q,`simulation_rooms/${e}/world/sea_resources`),Ae=tt(K,it=>{const Fe=it.val();b(Fe?Object.values(Fe):[])}),Et=z(q,`simulation_rooms/${e}/sea_state/${t.id}/hp`),Mt=tt(Et,it=>{const Fe=it.val();Fe!=null&&(v(Fe),Fe<=0&&w(!0))}),Wt=z(q,`simulation_rooms/${e}/sea_state/${t.id}`);return tt(Wt,it=>{const Fe=it.val();Fe&&Fe.x&&Fe.y&&R.current.x===1e3&&R.current.y===1e3&&(R.current.x=Fe.x,R.current.y=Fe.y,R.current.rotation=Fe.rotation||0,a({x:Fe.x,y:Fe.y}),c(Fe.rotation||0))},{onlyOnce:!0}),()=>{ae(),Ae(),Mt()}},[e,t.id]),N.useEffect(()=>{var B;y(((B=t.boat)==null?void 0:B.cannonballs)||0)},[(le=t.boat)==null?void 0:le.cannonballs]),N.useEffect(()=>(i("SAILING"),()=>i(null)),[]),N.useEffect(()=>{const B=()=>{const ae=z(q,`simulation_rooms/${e}/sea_state/${t.id}`);oe(ae,{isOffline:!0,timestamp:Date.now()})};return window.addEventListener("beforeunload",B),()=>window.removeEventListener("beforeunload",B)},[e,t.id]),N.useEffect(()=>{oe(z(q,`simulation_rooms/${e}/sea_state/${t.id}`),{hp:x,maxHp:g,isOffline:!1})},[]);const W=B=>{const ae={CANNON:"sounds/sfx/cannon_fire.mp3",EXPLOSION:"sounds/sfx/explosion.mp3",SPLASH:"sounds/sfx/splash.mp3"},K=new Audio(`/Simulation_StandAlone_Pro/${ae[B]}`);K.volume=.5,K.play().catch(()=>{})},J=async()=>{try{await oe(z(q,`simulation_rooms/${e}/players/${t.id}/boat`),{hp:x,isDamaged:x<=0}),s()}catch(B){console.error("Failed to save boat state:",B),s()}},Y=()=>{const B=Date.now();if(B-S<1500||u||k||p<=0)return;const ae=p-1;y(ae),oe(z(q,`simulation_rooms/${e}/players/${t.id}/boat`),{cannonballs:ae}),_(B),H(5),setTimeout(()=>H(0),200),W("CANNON");const K=R.current,Ae=K.rotation*Math.PI/180,Et=40,Mt=K.x+Math.cos(Ae)*Et,Wt=K.y+Math.sin(Ae)*Et,it=600,Fe=Math.cos(Ae)*it,mr=Math.sin(Ae)*it,Mc={id:F.current++,x:Mt,y:Wt,vx:Fe,vy:mr,ownerId:t.id,createdAt:B};R.current.projectiles.push(Mc)},he=async B=>{if(B==="FIRE"){Y();return}if(B==="FISH"){if(u||R.current.speed>1)return;const ae=R.current,K=ae.rotation*Math.PI/180,Ae=60;ae.net={active:!0,x:ae.x+Math.cos(K)*Ae,y:ae.y+Math.sin(K)*Ae,radius:0,t:0,caught:!1},d(!0),L({...ae.net}),H(2),setTimeout(()=>H(0),100)}},fe=B=>1+2.70158*Math.pow(B-1,3)+1.70158*Math.pow(B-1,2),ce=B=>2.70158*B*B*B-1.70158*B*B,ne=()=>{const B=Date.now(),ae=(B-$.current)/1e3;$.current=B;const K=R.current;if(x<=0&&!k){w(!0),K.speed=0,K.targetSpeed=0;return}if(k)return;const Ae=.92,Et=.2,Mt=.15,Wt=.985,it=.05;P.current.left&&(K.angularVelocity-=Et),P.current.right&&(K.angularVelocity+=Et),K.angularVelocity*=Ae,K.rotation+=K.angularVelocity,P.current.up&&(K.targetSpeed=Math.min(K.targetSpeed+it,5)),P.current.down&&(K.targetSpeed=Math.max(K.targetSpeed-it,0)),K.speed=K.speed*Wt+K.targetSpeed*(1-Wt);const Fe=K.rotation*Math.PI/180,mr=Math.cos(Fe)*K.speed,Mc=Math.sin(Fe)*K.speed;K.velocityVector.x=K.velocityVector.x*(1-Mt)+mr*Mt,K.velocityVector.y=K.velocityVector.y*(1-Mt)+Mc*Mt;let uh=K.x+K.velocityVector.x,dh=K.y+K.velocityVector.y,yi=null;for(const Ve of Hh)if(Math.hypot(uh-Ve.x,dh-Ve.y)<Ve.r+30){yi=Ve;break}if(!yi&&uh>0&&uh<br&&dh>0&&dh<br)K.x=uh,K.y=dh;else if(yi){const Ve=(K.x-yi.x)/Math.hypot(K.x-yi.x,K.y-yi.y),Cs=(K.y-yi.y)/Math.hypot(K.x-yi.x,K.y-yi.y),cs=K.velocityVector.x*Ve+K.velocityVector.y*Cs;K.velocityVector.x=(K.velocityVector.x-2*cs*Ve)*.5,K.velocityVector.y=(K.velocityVector.y-2*cs*Cs)*.5,K.speed*=.5,K.targetSpeed*=.3,H(8),setTimeout(()=>H(0),300)}else K.velocityVector.x*=-.5,K.velocityVector.y*=-.5;a({x:K.x,y:K.y}),c(K.rotation);const kO=K.projectiles,p1=[];for(const Ve of kO){if(Ve.x+=Ve.vx*ae,Ve.y+=Ve.vy*ae,B-Ve.createdAt>2e3)continue;let Cs=!1;for(const cs of Hh)if(Math.hypot(Ve.x-cs.x,Ve.y-cs.y)<cs.r){Cs=!0,R.current.explosions.push({id:Math.random(),x:Ve.x,y:Ve.y,createdAt:B}),W("EXPLOSION");break}if(!Cs){for(const cs in h){const Aa=h[cs];if(Math.hypot(Ve.x-Aa.x,Ve.y-Aa.y)<40){Cs=!0,R.current.explosions.push({id:Math.random(),x:Ve.x,y:Ve.y,createdAt:B}),W("EXPLOSION");const hh=z(q,`simulation_rooms/${e}/sea_state/${cs}/hp`);Pe(hh,x1=>x1===null?100:Math.max(0,x1-25));break}}Cs||p1.push(Ve)}}K.projectiles=p1,K.explosions=K.explosions.filter(Ve=>B-Ve.createdAt<500),E([...K.projectiles]),j([...K.explosions]);const g1=40,r0=K.x-Math.cos(Fe)*g1,a0=K.y-Math.sin(Fe)*g1;if(Math.hypot(r0-U.current.x,a0-U.current.y)>25&&(D(Ve=>{const Cs=[...Ve,{x:r0,y:a0,id:I.current++}];return Cs.length>40&&Cs.shift(),Cs}),U.current={x:r0,y:a0}),K.net&&K.net.active){if(K.net.t+=ae*.8,K.net.t<.5){const Ve=K.net.t*2;K.net.radius=fe(Ve)*120}else if(K.net.t<.6){if(!K.net.caught){const Ve=K.net.x,Cs=K.net.y,cs=m.find(Aa=>{const ja=Aa.x-Ve,hh=Aa.y-Cs;return Math.sqrt(ja*ja+hh*hh)<120});if(cs){K.net.caught=!0;const Aa=z(q,`simulation_rooms/${e}/world/sea_resources/${cs.id}`);Pe(Aa,ja=>{if(ja!==null)return null}).then(()=>{const ja=(t.resources.fish_raw||0)+cs.amount;oe(z(q,`simulation_rooms/${e}/players/${t.id}/resources`),{fish_raw:ja}),W("SPLASH")}).catch(()=>{K.net.caught=!1}),n&&n({success:!0,timestamp:Date.now(),message:`Du fanget ${cs.amount} stk ${cs.type}!`,utbytte:[{resource:"fish_raw",amount:cs.amount,name:cs.type,icon:""}],xp:[{skill:"SAILING",amount:15}],durability:[]})}}K.net.radius=120}else{const Ve=(K.net.t-.6)/.4;K.net.radius=(1-ce(Ve))*120}K.net.t>=1&&(K.net.active=!1,d(!1),K.net=null),L(K.net?{...K.net}:null)}C.current=requestAnimationFrame(ne)};return N.useEffect(()=>{let B;const ae=()=>{var Ae,Et,Mt,Wt;const K=Date.now();K-V.current>100&&(oe(z(q,`simulation_rooms/${e}/sea_state/${t.id}`),{id:t.id,name:t.name,x:R.current.x,y:R.current.y,rotation:R.current.rotation,speed:R.current.speed,stage:((Ae=t.boat)==null?void 0:Ae.stage)||1,model:((Et=t.boat)==null?void 0:Et.model)||"standard",componentLevels:((Mt=t.boat)==null?void 0:Mt.componentLevels)||{sails:0,hull:0,cannons:0,nets:0},customization:((Wt=t.boat)==null?void 0:Wt.customization)||{color:"#4b2c20",flagId:"none",figurehead:"none",unlocked:[]},isFishing:u,timestamp:K}),V.current=K),B=requestAnimationFrame(ae)};return ae(),C.current=requestAnimationFrame(ne),()=>{cancelAnimationFrame(B),cancelAnimationFrame(C.current)}},[e,t.id,u]),N.useEffect(()=>{const B=K=>{(K.key==="a"||K.key==="ArrowLeft")&&(P.current.left=!0),(K.key==="d"||K.key==="ArrowRight")&&(P.current.right=!0),(K.key==="w"||K.key==="ArrowUp")&&(P.current.up=!0),(K.key==="s"||K.key==="ArrowDown")&&(P.current.down=!0),K.key===" "&&he("FISH"),K.key==="f"&&he("FIRE")},ae=K=>{(K.key==="a"||K.key==="ArrowLeft")&&(P.current.left=!1),(K.key==="d"||K.key==="ArrowRight")&&(P.current.right=!1),(K.key==="w"||K.key==="ArrowUp")&&(P.current.up=!1),(K.key==="s"||K.key==="ArrowDown")&&(P.current.down=!1)};return window.addEventListener("keydown",B),window.addEventListener("keyup",ae),()=>{window.removeEventListener("keydown",B),window.removeEventListener("keyup",ae)}},[]),k?o.jsxs("div",{className:"fixed inset-0 z-[300] bg-black flex flex-col items-center justify-center text-red-600 font-black animate-in fade-in duration-1000",children:[o.jsx(BQ,{size:128,className:"mb-4 animate-pulse"}),o.jsx("h1",{className:"text-6xl uppercase tracking-tighter",children:"Skipbrudden"}),o.jsx("p",{className:"text-white/50 mt-4 text-xl",children:"Ditt skip er sunket til havets bunn."}),o.jsx("button",{onClick:async()=>{try{await oe(z(q,`simulation_rooms/${e}/players/${t.id}/boat`),{hp:10,isDamaged:!0}),s()}catch(B){console.error("Failed to wash ashore:",B),s()}},className:"mt-12 px-8 py-3 bg-red-900/20 border border-red-900 hover:bg-red-900/40 text-red-500 rounded transition-all uppercase tracking-widest",children:"Skyll i land"})]}):o.jsxs("div",{className:"absolute inset-0 z-0 bg-[#051a2e] overflow-hidden cursor-crosshair font-sans",onMouseDown:()=>he("FIRE"),style:{background:"radial-gradient(circle at 50% 50%, #0a2e4d 0%, #051a2e 100%)",transform:O>0?`translate(${(Math.random()-.5)*O}px, ${(Math.random()-.5)*O}px)`:"none",transition:"transform 0.05s linear",contain:"strict"},children:[o.jsx(wO,{pos:r}),o.jsx("svg",{className:"absolute inset-0 w-full h-full overflow-visible blur-md pointer-events-none",children:M.map((B,ae)=>{if(ae===0)return null;const K=M[ae-1],Ae=ae/M.length;return o.jsx("line",{x1:K.x-r.x+window.innerWidth/2,y1:K.y-r.y+window.innerHeight/2,x2:B.x-r.x+window.innerWidth/2,y2:B.y-r.y+window.innerHeight/2,stroke:"#fff",strokeWidth:25*Ae,strokeOpacity:.08*Ae,strokeLinecap:"round"},B.id)})}),Hh.map(B=>o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${B.x-r.x+window.innerWidth/2}px, ${B.y-r.y+window.innerHeight/2}px, 0)`},children:[o.jsx("div",{className:"absolute inset-0 bg-white/5 blur-3xl opacity-30 rounded-full",style:{width:B.r*3,height:B.r*3,transform:"translate(-50%, -50%)"}}),o.jsx("div",{className:"absolute rounded-full shadow-[0_0_50px_rgba(0,0,0,0.5)]",style:{width:B.r*2,height:B.r*2,backgroundColor:B.color,transform:"translate(-50%, -50%)",border:"8px solid rgba(255,255,255,0.05)"}}),o.jsx("div",{className:"absolute top-[110%] left-1/2 -translate-x-1/2 text-white/20 text-[10px] uppercase tracking-[0.3em] font-black whitespace-nowrap",children:B.name})]},B.id)),m.map(B=>o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${B.x-r.x+window.innerWidth/2}px, ${B.y-r.y+window.innerHeight/2}px, 0)`},children:[o.jsx("div",{className:"absolute inset-0 bg-white/30 blur-md rounded-full animate-ping",style:{width:40,height:40,transform:"translate(-50%, -50%)",animationDuration:"3s"}}),o.jsxs("div",{className:"absolute flex flex-col items-center",style:{transform:"translate(-50%, -50%)"},children:[o.jsx(ee.div,{animate:{y:[0,-5,0]},transition:{repeat:1/0,duration:2,ease:"easeInOut"},children:o.jsx(HX,{size:20,className:"text-cyan-400 drop-shadow-[0_0_8px_rgba(34,211,238,0.8)]"})}),o.jsxs("div",{className:"text-[9px] font-black text-cyan-200/60 uppercase tracking-widest mt-1 bg-black/40 px-1.5 py-0.5 rounded backdrop-blur-sm border border-white/5",children:[B.amount," ",B.type]})]})]},B.id)),o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[T.map(B=>o.jsx("div",{className:"absolute w-2 h-2 bg-black rounded-full shadow-lg",style:{transform:`translate3d(${B.x-r.x+window.innerWidth/2}px, ${B.y-r.y+window.innerHeight/2}px, 0)`}},B.id)),A.map(B=>o.jsx("div",{className:"absolute w-16 h-16 bg-orange-500 rounded-full animate-ping opacity-60",style:{transform:`translate3d(${B.x-r.x+window.innerWidth/2}px, ${B.y-r.y+window.innerHeight/2}px, 0) translate(-50%, -50%)`}},B.id))]}),G&&G.active&&o.jsxs("div",{className:"absolute pointer-events-none",style:{transform:`translate3d(${G.x-r.x+window.innerWidth/2}px, ${G.y-r.y+window.innerHeight/2}px, 0)`},children:[G.t>=.5&&G.t<.7&&o.jsx(ee.div,{initial:{scale:.8,opacity:.8},animate:{scale:1.2,opacity:0},className:"absolute inset-0 rounded-full border-4 border-white/40 blur-sm",style:{width:240,height:240,transform:"translate(-50%, -50%)"}}),o.jsxs("svg",{width:G.radius*2.5,height:G.radius*2.5,viewBox:"0 0 100 100",className:"absolute",style:{transform:"translate(-50%, -50%)"},children:[o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"hsl(28, 55%, 35%)",strokeWidth:"3",strokeDasharray:"4 2",className:"opacity-80"}),o.jsx("circle",{cx:"50",cy:"50",r:"38",fill:"hsl(28, 55%, 20%)",fillOpacity:"0.1",stroke:"hsl(28, 55%, 45%)",strokeWidth:"1"}),o.jsx("path",{d:"M 50 10 L 50 90 M 10 50 L 90 50 M 22 22 L 78 78 M 22 78 L 78 22",stroke:"hsl(28, 55%, 35%)",strokeWidth:"1",strokeOpacity:"0.3"})]}),G.caught&&o.jsx(ee.div,{initial:{scale:0},animate:{scale:[0,1.5,1]},className:"absolute -top-12 left-1/2 -translate-x-1/2 text-cyan-400 font-black text-xs uppercase tracking-widest bg-black/60 px-2 py-1 rounded backdrop-blur-md border border-cyan-500/30",children:"Fangst!"})]}),Object.values(h).map(B=>B.isOffline?null:o.jsxs("div",{className:"absolute w-32 h-32",style:{transform:`translate3d(${B.x-r.x+window.innerWidth/2}px, ${B.y-r.y+window.innerHeight/2}px, 0) translate(-50%, -50%)`},children:[o.jsx(ee.div,{style:{rotate:B.rotation},className:"w-full h-full",children:o.jsx(qm,{stage:B.stage,model:B.model,componentLevels:B.componentLevels,customization:B.customization||{color:"#64748b"},rotation:0})}),o.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 text-center w-48",children:o.jsx("div",{className:"text-[10px] font-black text-white/40 uppercase tracking-widest shadow-black drop-shadow-md",children:B.name})})]},B.id)),o.jsx(ee.div,{animate:{scale:S>Date.now()-200?[1,.92,1]:G!=null&&G.active?[1,1.05,1]:1,opacity:u?.9:1},transition:{duration:.2},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-40 h-40 z-10 pointer-events-none",children:o.jsx(qm,{stage:((ke=t.boat)==null?void 0:ke.stage)||1,model:(we=t.boat)==null?void 0:we.model,componentLevels:(Q=t.boat)==null?void 0:Q.componentLevels,customization:(Z=t.boat)==null?void 0:Z.customization,rotation:l})}),o.jsx(qt,{children:o.jsxs(ee.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},className:"absolute bottom-12 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 pointer-events-none",children:[o.jsx("div",{className:"px-3 py-1 bg-black/40 backdrop-blur-xl border border-white/10 rounded-full text-[10px] font-black uppercase text-red-500 tracking-[0.2em]",children:"Skrog"}),o.jsx("div",{className:"w-80 h-3 bg-black/60 border border-white/5 rounded-full overflow-hidden shadow-2xl backdrop-blur-md",role:"progressbar","aria-valuenow":x,"aria-valuemin":0,"aria-valuemax":g,"aria-label":"Skipets holdbarhet",children:o.jsx(ee.div,{className:"h-full bg-gradient-to-r from-red-600 via-orange-500 to-red-600 shadow-[0_0_20px_rgba(220,38,38,0.5)]",animate:{width:`${x/g*100}%`},transition:{type:"spring",stiffness:50,damping:15}})}),o.jsxs("div",{className:"text-[10px] text-white/30 font-bold uppercase tracking-widest",children:[Math.round(x)," / ",g," HP"]})]})}),o.jsx(qt,{children:o.jsxs(ee.div,{initial:{x:50,opacity:0},animate:{x:0,opacity:1},className:"absolute bottom-12 right-12 flex flex-col items-end gap-2 pointer-events-none",children:[o.jsx("div",{className:"px-3 py-1 bg-black/40 backdrop-blur-xl border border-white/10 rounded-full text-[10px] font-black uppercase text-amber-500 tracking-[0.2em]",children:"AMMUNISJON"}),o.jsxs("div",{className:`p-6 rounded-[2rem] border backdrop-blur-2xl flex flex-col items-center justify-center min-w-[120px] transition-colors duration-500
                        ${p>10?"bg-slate-950/40 border-white/10":p>0?"bg-amber-950/40 border-amber-500/30":"bg-red-950/60 border-red-500/50 animate-pulse"}
                    `,children:[o.jsxs("div",{className:"flex items-end gap-1 mb-1",children:[o.jsx("span",{className:`text-5xl font-black italic tracking-tighter leading-none
                                ${p>10?"text-white":p>0?"text-amber-400":"text-red-500"}
                            `,children:p}),o.jsx("span",{className:"text-white/20 text-sm font-bold uppercase mb-1",children:"stk"})]}),o.jsxs("div",{className:"flex items-center gap-2 opacity-50",children:[o.jsx(CX,{size:12,className:p>0?"fill-current text-white":"text-red-500"}),o.jsx("div",{className:"w-12 h-1 bg-white/10 rounded-full overflow-hidden",children:o.jsx(ee.div,{className:`h-full ${p>0?"bg-white":"bg-red-500"}`,animate:{width:`${Math.min(100,p/50*100)}%`}})})]})]})]})}),o.jsx(ee.button,{whileHover:{scale:1.05,backgroundColor:"rgba(127, 29, 29, 0.6)"},whileTap:{scale:.95},onClick:J,"aria-label":"Tilbake til kai",className:"absolute top-8 left-8 z-[110] px-6 py-2 bg-red-950/40 backdrop-blur-md border border-[#c29d0b]/40 rounded-sm text-[10px] text-[#e5e7eb] font-black uppercase tracking-[0.25em] transition-all hover:border-[#c29d0b] shadow-2xl",children:"Tilbake til kai"}),o.jsxs("div",{className:"absolute bottom-6 right-8 flex gap-8 text-white/20 text-[9px] font-black uppercase tracking-[0.2em]",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"WASD"})," Manvrering"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"SPACE"})," Fisking"]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("span",{className:"text-white/40",children:"F"})," Avfyr Kanon"]})]}),o.jsx("div",{className:"absolute top-6 right-6 w-44 h-44 bg-black/30 rounded-full border border-white/5 backdrop-blur-md overflow-hidden z-50 pointer-events-none opacity-60",children:o.jsxs("div",{className:"relative w-full h-full p-6",children:[Hh.map(B=>o.jsx("div",{className:"absolute rounded-full bg-emerald-500/20",style:{width:B.r/br*100+"%",height:B.r/br*100+"%",left:B.x/br*100+"%",top:B.y/br*100+"%",transform:"translate(-50%, -50%)"}},B.id)),o.jsx("div",{className:"absolute w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_cyan]",style:{left:r.x/br*100+"%",top:r.y/br*100+"%",transform:"translate(-50%, -50%)"}})]})}),window.matchMedia("(pointer: coarse)").matches&&o.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[o.jsxs("div",{className:"absolute bottom-12 right-12 flex flex-col items-center gap-2 pointer-events-auto scale-75 md:scale-100 origin-bottom-right",children:[o.jsx(ee.button,{whileTap:{scale:.9},onTouchStart:()=>{P.current.up=!0},onTouchEnd:()=>{P.current.up=!1},"aria-label":"Manvrer opp",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"W"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx(ee.button,{whileTap:{scale:.9},onTouchStart:()=>{P.current.left=!0},onTouchEnd:()=>{P.current.left=!1},"aria-label":"Snu til venstre",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"A"}),o.jsx(ee.button,{whileTap:{scale:.9},onTouchStart:()=>{P.current.down=!0},onTouchEnd:()=>{P.current.down=!1},"aria-label":"Manvrer ned",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"S"}),o.jsx(ee.button,{whileTap:{scale:.9},onTouchStart:()=>{P.current.right=!0},onTouchEnd:()=>{P.current.right=!1},"aria-label":"Snu til hyre",className:"w-16 h-16 bg-white/5 backdrop-blur-md rounded-full border border-white/10 flex items-center justify-center text-white/40 font-black",children:"D"})]})]}),o.jsxs("div",{className:"absolute bottom-12 left-12 flex gap-4 pointer-events-auto scale-75 md:scale-100 origin-bottom-left",children:[o.jsxs(ee.button,{whileTap:{scale:.9},onClick:()=>he("FIRE"),"aria-label":"Avfyr kanon",className:"w-20 h-20 bg-red-900/20 backdrop-blur-md rounded-full border border-red-500/20 flex flex-col items-center justify-center text-red-500/60 font-black text-[10px] tracking-widest",children:[o.jsx("span",{children:"F"}),o.jsx("span",{children:"ILD"})]}),o.jsxs(ee.button,{whileTap:{scale:.9},onClick:()=>he("FISH"),"aria-label":"Fiske",className:"w-20 h-20 bg-blue-900/20 backdrop-blur-md rounded-full border border-blue-500/20 flex flex-col items-center justify-center text-blue-500/60 font-black text-[10px] tracking-widest",children:[o.jsx("span",{children:"SPACE"}),o.jsx("span",{children:"FISK"})]})]})]})]})},fte=()=>{var Q;const{pin:t}=DA(),[e]=_3(),s=e.get("impersonate"),n=dc(),{user:i,account:r,loading:a}=yc(),{activeMinigame:l,setActiveMinigame:c,activeMinigameAction:u,setActiveMinigameAction:d,activeMinigameMethod:h,setActiveMinigameMethod:f,activeTab:m,setActiveTab:b}=yo(),{setHideHeader:x,setFullWidth:v}=FA(),[g,p]=N.useState(!1);Se.useEffect(()=>{m==="PROFILE"&&(p(!0),b("MAP"))},[m,b]),Se.useEffect(()=>{x(!0),v(!0);const Z=()=>{Tt(async()=>{const{audioManager:B}=await Promise.resolve().then(()=>El);return{audioManager:B}},void 0).then(({audioManager:B})=>{B.resume()}),window.removeEventListener("click",Z),window.removeEventListener("keydown",Z)};return window.addEventListener("click",Z),window.addEventListener("keydown",Z),()=>{x(!1),v(!1),window.removeEventListener("click",Z),window.removeEventListener("keydown",Z)}},[x,v]);const{player:y,world:k,players:w,roomStatus:S,markets:_,messages:T,diplomacy:E,activeVote:A,worldEvents:j,trades:O,regions:H,isRetired:G}=AZ(t,s);Se.useEffect(()=>{if(!y||!t||!y.resources)return;const Z=y.resources,B=Z.oak_log||0,ae=Z.oak_lumber||0;if(B>0||ae>0){console.log("MIGRATION: Converting Legacy Oak...",{oakLog:B,oakLumber:ae});const K={};K[`players/${y.id}/resources/oak_log`]=null,K[`players/${y.id}/resources/oak_lumber`]=null,K[`players/${y.id}/resources/wood`]=(Z.wood||0)+B,K[`players/${y.id}/resources/plank`]=(Z.plank||0)+ae;const Ae=z(q,`simulation_rooms/${t}`);oe(Ae,K).then(()=>console.log("MIGRATION: Success")).catch(Et=>console.error("MIGRATION: Failed",Et))}},[y==null?void 0:y.id,y==null?void 0:y.resources,t]),Se.useEffect(()=>{if(!y||!t||!i||!r)return;(async()=>{var Wt;const B=r.activeSessions;let ae={},K=!1;Array.isArray(B)?(console.log("ULTRATHINK: Detected Legacy Session Array. Migrating to Map..."),K=!0,B.forEach(it=>{it&&it.roomPin&&(ae[it.roomPin]=it)})):B&&(ae=B);const Ae=ae[t],Et=Ae?Date.now()-Ae.lastPlayed>5*60*1e3:!0,Mt=!Ae;if(K||Mt||Et){console.log("ULTRATHINK: Syncing Session to Global Profile...",{isMissing:Mt,isStale:Et,needsMigration:K});const it={roomPin:t,name:y.name,role:y.role,regionId:y.regionId,xp:((Wt=y.stats)==null?void 0:Wt.xp)||0,lastPlayed:Date.now()},Fe={};if(K){const mr={...ae,[t]:it};Fe[`simulation_accounts/${i.uid}/activeSessions`]=mr}else Fe[`simulation_accounts/${i.uid}/activeSessions/${t}`]=it;try{await oe(z(q),Fe),console.log("ULTRATHINK: Session Sync Complete.")}catch(mr){console.error("ULTRATHINK: Session Sync Failed",mr)}}})()},[y,t,i,r]);const{handleAction:L,actionResult:M,setActionResult:D,handleClearActionResult:I}=gO(t,y,k,c,f,d,l),[F,U]=N.useState(!1),[R,C]=N.useState(null),[$,V]=N.useState(null),[P,W]=N.useState(!1),[J,Y]=N.useState(!1),[he,fe]=N.useState(!1),[ce,ne]=N.useState(!1),[Le,lt]=N.useState(void 0),se=Z=>{const B=typeof Z=="string"?Z:Z.type;if(B==="MOUNT_HORSE"&&!Z.method){W(!0);return}if(B==="OPEN_TAVERN_MENU"){Y(!0);return}if(B==="OPEN_WEAPON_RACK"){fe(!0);return}if(B==="OPEN_CARAVAN"){Z.targetRegionId&&lt(Z.targetRegionId),ne(!0);return}L(Z)},le=async(Z,B)=>{if(!(!t||!i)){U(!0);try{const ae=z(q,`simulation_rooms/${t}`),K=s||i.uid;let Ae=Math.random()>.5?"region_ost":"region_vest";B==="BARON"?Ae=`region_${K}`:B==="KING"&&(Ae="capital");const Et={id:K,uid:i.uid,name:Z,role:B,regionId:Ae,resources:ms[B]||ms.PEASANT,skills:An[B]||An.PEASANT,stats:{xp:0,level:1,reputation:50,contribution:0},status:{hp:100,morale:100,stamina:50,legitimacy:100,authority:50,loyalty:100,isJailed:!1,isFrozen:!1},equipment:ab[B]||ab.PEASANT,upgrades:[],lastActive:Date.now()},Mt={id:K,uid:i.uid,name:Z,role:B,regionId:Ae,stats:{level:1},status:{isJailed:!1,isFrozen:!1,legitimacy:100},online:!0,lastActive:Date.now()},Wt={};Wt[`players/${K}`]=Et,Wt[`public_profiles/${K}`]=Mt,await oe(ae,Wt)}catch(ae){console.error("Failed to create player:",ae),alert("Kunne ikke opprette karakter.")}finally{U(!1)}}},ke=N.useMemo(()=>({status:S,world:k,players:w||{},messages:T||[],markets:_||{},market:(_&&(y!=null&&y.regionId)?_[y.regionId]:Object.values(_||{})[0])||{},diplomacy:E||{},trades:O||{},activeVote:A,worldEvents:j||{},regions:H||{},settings:"feudal_europe",pin:t||""}),[S,k,w,T,_,E,A,j,O,H,t]),{showAchievement:we}=yo();return Se.useEffect(()=>{!y||!i||!r||Tt(async()=>{const{checkAndUnlockAchievements:Z}=await import("./achievementLogic-zla8e5lV.js");return{checkAndUnlockAchievements:Z}},[]).then(({checkAndUnlockAchievements:Z})=>{Z(i.uid,y,r,we)})},[(Q=y==null?void 0:y.stats)==null?void 0:Q.level,y==null?void 0:y.role,r==null?void 0:r.globalXp,i==null?void 0:i.uid]),a&&!y?o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 text-center",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin mb-6"}),o.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-widest animate-pulse",children:"Vkner til liv..."})]}):G?o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center p-6 text-center",children:[o.jsx("div",{className:"w-20 h-20 bg-indigo-500/20 rounded-3xl flex items-center justify-center text-indigo-400 mb-8 border border-white/10 shadow-2xl",children:o.jsx(xd,{size:40})}),o.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tighter mb-4",children:"Karakteren er pensjonert"}),o.jsx("p",{className:"text-slate-400 max-w-sm mb-12",children:"Ditt ettermle er sikret i Hall of Fame. G tilbake til lobbyen for  starte et nytt liv."}),o.jsx("button",{onClick:()=>n("/sim"),className:"px-12 py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl shadow-indigo-600/20 active:scale-95",children:"Til Lobbyen"})]}):y?k?o.jsxs("div",{className:"relative min-h-screen bg-slate-900 text-white overflow-hidden flex flex-col",children:[o.jsx("div",{className:"flex-1 flex flex-col relative",children:o.jsxs("div",{className:"fixed inset-0 top-0 bg-slate-950 text-slate-200 flex overflow-hidden",children:[o.jsx("div",{className:"fixed inset-0 pointer-events-none opacity-20",children:o.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full animate-pulse"})}),!y.hasSeenIntro&&o.jsx(ete,{player:y,pin:t||"",onComplete:()=>{y.hasSeenIntro=!0}}),l&&l!=="SAILING"&&o.jsx(JZ,{type:l,player:y,playerUpgrades:y.upgrades,equipment:Object.values(y.equipment||{}),skills:y.skills,selectedMethod:h||void 0,action:u,onComplete:(Z,B)=>{if(l==="TRAVEL_START")Z>0?(console.log("[SimulationPlayer] Minigame Complete. Data:",B),L({type:"TRAVEL_COMPLETE",targetRegionId:u==null?void 0:u.targetRegionId,finalDurability:B==null?void 0:B.durability})):L({type:"TRAVEL_FAILED",targetRegionId:u==null?void 0:u.targetRegionId,finalDurability:0});else{const ae=l,K=u||{};!K.type&&ae&&console.warn(`[SimulationPlayer] Warning: Minigame '${ae}' completed without explicit action object. Using fallback.`);const Ae={type:ae,...K,performance:Z,method:h};L(Ae)}},onCancel:()=>{c(null),d(null),f(null)},currentSeason:(k==null?void 0:k.season)||"Spring",currentWeather:(k==null?void 0:k.weather)||"Clear",totalTicks:(k==null?void 0:k.totalTicks)||0}),P&&o.jsx(Yee,{player:y,onAction:L,onClose:()=>W(!1)}),J&&o.jsx(Xee,{player:y,room:ke,onAction:L,onClose:()=>Y(!1)}),he&&o.jsx(hee,{player:y,onAction:L,onClose:()=>fe(!1)}),ce&&o.jsx(dte,{player:y,onAction:L,onClose:()=>{ne(!1),lt(void 0)},preselectedTarget:Le}),o.jsx(Hee,{}),o.jsxs("div",{className:"flex flex-col h-full w-full overflow-hidden",children:[o.jsx(jZ,{room:ke,player:y,pin:t,onAction:se}),o.jsxs("main",{className:"flex-1 relative overflow-hidden bg-slate-950/50",children:[o.jsx($ee,{player:y,room:ke,pin:t,onAction:se,actionResult:M,onClearActionResult:I}),o.jsx(qt,{children:l==="SAILING"&&o.jsx(ee.div,{initial:{opacity:0,scale:1.05},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.4,ease:[.22,1,.36,1]},className:"absolute inset-0 z-50 bg-slate-950",children:o.jsx(hte,{player:y,roomPin:ke.pin,onExit:()=>c(null),onActionResult:D})})})]})]})]})}),R&&o.jsx(Gee,{level:R.level,title:R.title,onClose:()=>C(null)}),o.jsx(ste,{pin:t||"",player:y,onOpenProfile:Z=>{const B=ke.players[Z];B?V(B):console.warn("Spiller ikke funnet i rommet:",Z)}}),$&&o.jsx(rte,{isOpen:!0,onClose:()=>V(null),myPlayer:y,targetPlayer:$,pin:t||""}),o.jsx(cte,{isOpen:g,onClose:()=>{p(!1),m==="PROFILE"&&b("MAP")},currentRoomPin:t})]}):o.jsxs("div",{className:"min-h-screen bg-slate-950 flex flex-col items-center justify-center gap-4 text-white",children:[o.jsx("div",{className:"w-12 h-12 border-4 border-indigo-500 border-t-white rounded-full animate-spin"}),o.jsx("p",{className:"text-sm font-bold uppercase tracking-widest text-indigo-400",children:"Laster verden..."})]}):o.jsx("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-6",children:o.jsx(zee,{pin:t||"",account:r,onCreatePlayer:le,isCreating:F})})},mte=()=>o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[1,2,3,4].map(t=>o.jsx("div",{className:"h-36 bg-white/5 rounded-2xl animate-pulse border border-white/5 relative overflow-hidden",children:o.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_2s_infinite]"})},t))}),pte=({server:t,onClick:e})=>{const s={Spring:{color:"text-emerald-400",icon:tQ,label:"Vr",bg:"group-hover:bg-emerald-500/10"},Summer:{color:"text-amber-400",icon:qQ,label:"Sommer",bg:"group-hover:bg-amber-500/10"},Autumn:{color:"text-orange-400",icon:lO,label:"Hst",bg:"group-hover:bg-orange-500/10"},Winter:{color:"text-blue-400",icon:UQ,label:"Vinter",bg:"group-hover:bg-blue-500/10"}},n=s[t.season]||s.Spring;return o.jsxs(ee.button,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},whileHover:{y:-4},onClick:e,className:`group relative overflow-hidden flex flex-col p-6 bg-white/5 border border-white/5 hover:border-white/20 rounded-2xl transition-all text-left shadow-xl ${n.bg}`,children:[o.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("h3",{className:"text-lg font-black text-white group-hover:text-white transition-colors leading-tight truncate max-w-[200px]",children:t.name||`Rike #${t.pin}`}),o.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-black text-white/30 uppercase tracking-[0.2em] mt-1",children:[o.jsxs("span",{className:"px-1.5 py-0.5 bg-white/5 rounded",children:["PIN: ",t.pin]}),o.jsxs("span",{className:"opacity-50",children:["BY: ",t.hostName]})]})]}),o.jsx("div",{className:`p-2.5 rounded-xl bg-white/5 backdrop-blur-md border border-white/10 ${n.color} group-hover:scale-110 transition-transform`,children:o.jsx(n.icon,{size:20})})]}),o.jsxs("div",{className:"mt-auto flex items-center justify-between relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-[0.15em] text-white/20 font-black mb-1",children:"Live N"}),o.jsxs("div",{className:"flex items-center gap-1.5 text-white/80 font-black",children:[o.jsx(h1,{size:14,className:"text-indigo-400"}),o.jsx("span",{className:"text-sm tabular-nums",children:t.playerCount||0})]})]}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-[9px] uppercase tracking-[0.15em] text-white/20 font-black mb-1",children:"Tidsalder"}),o.jsxs("div",{className:"flex items-center gap-1.5 text-white/80 font-black",children:[o.jsx(vX,{size:14,className:"text-amber-500"}),o.jsxs("span",{className:"text-sm italic",children:[n.label," ",t.worldYear]})]})]})]}),o.jsxs("div",{className:"flex items-center gap-1 text-[10px] font-black uppercase tracking-wider text-white/10 group-hover:text-white transition-colors",children:["Join ",o.jsx(io,{size:14})]})]}),o.jsx("div",{className:"absolute -bottom-6 -right-6 opacity-[0.02] group-hover:opacity-[0.05] transition-opacity",children:o.jsx(n.icon,{size:120})}),o.jsx("div",{className:"absolute inset-0 border-2 border-indigo-500/0 group-hover:border-indigo-500/20 rounded-2xl transition-all"})]})},gte=()=>{const[t,e]=N.useState([]),[s,n]=N.useState(!0),[i,r]=N.useState(""),a=dc();N.useEffect(()=>{const c=z(q,"simulation_server_metadata"),u=tt(c,d=>{const h=d.val();if(h){const f=Object.values(h);e(f.filter(m=>m.isPublic&&(m.status==="LOBBY"||m.status==="PLAYING")).sort((m,b)=>b.lastUpdated-m.lastUpdated))}else e([]);n(!1)});return()=>u()},[]);const l=t.filter(c=>{var u;return c.pin.includes(i)||((u=c.name)==null?void 0:u.toLowerCase().includes(i.toLowerCase()))||c.hostName.toLowerCase().includes(i.toLowerCase())});return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-0 bg-indigo-500/20 blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity rounded-2xl"}),o.jsx(EQ,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/40 group-focus-within:text-indigo-400 transition-colors",size:18}),o.jsx("input",{type:"text",placeholder:"Sk etter en verden  erobre...",value:i,onChange:c=>r(c.target.value),className:"relative w-full bg-white/5 border border-white/10 focus:border-indigo-500/50 rounded-2xl py-4 pl-12 pr-4 text-sm text-white placeholder:text-white/20 outline-none transition-all shadow-inner"})]}),o.jsx(qt,{mode:"popLayout",children:s?o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:o.jsx(mte,{})},"loading"):l.length===0?o.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},className:"py-16 text-center border-2 border-white/5 border-dashed rounded-[2rem] bg-white/[0.02]",children:o.jsx("p",{className:"text-lg text-white/20 font-black italic uppercase tracking-widest",children:"Ingen riker funnet for sket."})},"empty"):o.jsx(ee.div,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",initial:"hidden",animate:"show",variants:{show:{transition:{staggerChildren:.05}}},children:l.map(c=>o.jsx(pte,{server:c,onClick:()=>a(`/play/${c.pin}`)},c.pin))},"list")})]})},xte=({isOpen:t,onClose:e,initialMode:s="REGISTER"})=>{const{login:n,register:i,resetPassword:r,checkNameAvailability:a,error:l}=yc(),[c,u]=N.useState(s),[d,h]=N.useState(""),[f,m]=N.useState(""),[b,x]=N.useState(""),[v,g]=N.useState(!1),[p,y]=N.useState(null),[k,w]=N.useState(null),[S,_]=N.useState(null),[T,E]=N.useState(!1);if(N.useEffect(()=>{if(c!=="REGISTER"||b.length<3){_(null);return}const j=setTimeout(async()=>{E(!0);try{const O=await a(b);_(O)}catch(O){console.error(O)}finally{E(!1)}},500);return()=>clearTimeout(j)},[b,c,a]),!t)return null;const A=async j=>{j.preventDefault(),y(null),w(null),g(!0);try{if(c==="LOGIN")await n(d,f),e();else if(c==="REGISTER"){if(S===!1)throw new Error("Navnet er allerede tatt.");await i(d,f,b),e()}else c==="FORGOT"&&(await r(d),w("E-post for tilbakestilling er sendt!"))}catch(O){y(O.message||"Noe gikk galt. Vennligst prv igjen.")}finally{g(!1)}};return o.jsxs("div",{className:"fixed inset-0 z-[1000] flex items-center justify-center p-4",children:[o.jsx("div",{className:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm",onClick:e}),o.jsxs("div",{className:"relative w-full max-w-md bg-slate-900 border border-white/10 rounded-[2.5rem] shadow-2xl overflow-hidden animate-in fade-in zoom-in duration-300",children:[o.jsx("div",{className:"bg-indigo-600 h-2 w-full"}),o.jsxs("div",{className:"p-8 space-y-8",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-3xl font-black italic text-white tracking-tighter uppercase",children:c==="LOGIN"?"Velkommen tilbake":c==="REGISTER"?"Opprett Profil":"Glemt Passord"}),o.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-1",children:c==="LOGIN"?"Fortsett din reise i simulation":"Bli en del av historien"})]}),o.jsx("button",{onClick:e,className:"p-2 hover:bg-white/5 rounded-xl transition-colors",children:o.jsx(Yn,{className:"text-slate-500",size:20})})]}),o.jsxs("form",{onSubmit:A,className:"space-y-4",children:[c==="REGISTER"&&o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Vises som (Unikt navn)"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(Gn,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"text",required:!0,placeholder:"Ditt kallenavn...",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:b,onChange:j=>x(j.target.value)}),o.jsx("div",{className:"absolute inset-y-0 right-0 pr-4 flex items-center",children:T?o.jsx(rT,{size:16,className:"text-slate-500 animate-spin"}):S===!0?o.jsx(Mb,{size:16,className:"text-emerald-500"}):S===!1?o.jsx(Rb,{size:16,className:"text-rose-500"}):null})]}),S===!1&&o.jsx("p",{className:"text-[10px] text-rose-400 font-bold px-1 italic",children:"Dette navnet er dessverre opptatt."})]}),o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"E-post"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(oQ,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"email",required:!0,placeholder:"navn@epost.no",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:d,onChange:j=>h(j.target.value)})]})]}),c!=="FORGOT"&&o.jsxs("div",{className:"space-y-1.5",children:[o.jsx("label",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Passord"}),o.jsxs("div",{className:"relative group",children:[o.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:o.jsx(Oo,{size:18,className:"text-slate-600 group-focus-within:text-indigo-400 transition-colors"})}),o.jsx("input",{type:"password",required:!0,placeholder:"Min. 8 tegn...",className:"w-full bg-slate-950/50 border border-white/5 focus:border-indigo-500/50 rounded-2xl py-3.5 pl-11 pr-4 text-white outline-none transition-all",value:f,onChange:j=>m(j.target.value)})]})]}),(p||l)&&o.jsxs("div",{className:"bg-rose-500/10 border border-rose-500/20 p-4 rounded-2xl flex items-center gap-3 text-rose-400",children:[o.jsx(Rb,{size:18}),o.jsx("p",{className:"text-xs font-bold",children:p||l})]}),k&&o.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/20 p-4 rounded-2xl flex items-center gap-3 text-emerald-400",children:[o.jsx(Mb,{size:18}),o.jsx("p",{className:"text-xs font-bold",children:k})]}),o.jsxs("div",{className:"pt-4 space-y-4",children:[o.jsx("button",{type:"submit",disabled:v||c==="REGISTER"&&S===!1,className:"w-full bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-800 disabled:text-slate-500 text-white rounded-2xl py-4 font-black uppercase tracking-widest text-sm flex items-center justify-center gap-2 transition-all active:scale-95 shadow-lg shadow-indigo-600/20",children:v?o.jsx(rT,{className:"animate-spin",size:20}):o.jsxs(o.Fragment,{children:[c==="LOGIN"?"Logg Inn":c==="REGISTER"?"Opprett Profil":"Send E-post",o.jsx(io,{size:18})]})}),o.jsx("div",{className:"flex items-center justify-between px-2",children:c==="LOGIN"?o.jsxs(o.Fragment,{children:[o.jsx("button",{type:"button",onClick:()=>u("REGISTER"),className:"text-[10px] font-black text-indigo-400 uppercase tracking-widest hover:text-white transition-colors",children:"Ny her? Opprett profil"}),o.jsx("button",{type:"button",onClick:()=>u("FORGOT"),className:"text-[10px] font-medium text-slate-500 hover:text-white transition-colors",children:"Glemt passord?"})]}):o.jsx("button",{type:"button",onClick:()=>u("LOGIN"),className:"w-full text-center text-[10px] font-black text-indigo-400 uppercase tracking-widest hover:text-white transition-colors",children:"Har du allerede profil? Logg inn"})})]})]})]})]})]})},bte=()=>{const{user:t,isAnonymous:e,logout:s}=yc(),[n,i]=N.useState(!1),[r,a]=N.useState("LOGIN"),l=dc(),{startPlaylist:c,resume:u}=S_(),[d,h]=N.useState(!1),[f,m]=N.useState(0);N.useEffect(()=>{const v=z(q,"simulation_server_metadata"),g=tt(v,p=>{if(p.exists()){const y=p.val(),k=Object.values(y).reduce((w,S)=>w+(S.playerCount||0),0);m(k)}});return()=>g()},[]),N.useEffect(()=>{c()},[c]);const b=()=>{d||(u(),c(),h(!0))},x=v=>{b(),a(v),i(!0)};return o.jsxs("div",{onClick:b,className:"min-h-screen relative font-sans text-slate-200 overflow-x-hidden",children:[o.jsxs("div",{className:"absolute inset-0 z-0",children:[o.jsx("img",{src:"/Simulation_StandAlone_Pro/makthjulet_landingpage_bakgrunn.png",alt:"Background",className:"w-full h-full object-cover"}),o.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-slate-950 via-slate-950/60 to-transparent"}),o.jsx("div",{className:"absolute inset-0 bg-black/40"})]}),o.jsxs("div",{className:"relative z-10 flex flex-col min-h-screen",children:[o.jsxs("header",{className:"w-full px-8 py-8 flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ic,{className:"text-white/90",size:24,strokeWidth:1.5}),o.jsx("span",{className:"text-sm font-black tracking-[0.2em] text-white/90 uppercase",children:"Simuleringshallen"})]}),o.jsx("div",{className:"flex items-center gap-6 text-xs font-bold tracking-widest uppercase",children:t&&!e?o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsxs("button",{onClick:()=>l("/profile"),className:"group flex items-center gap-2 text-white/70 hover:text-white transition-colors",children:[o.jsx(Gn,{size:14,className:"group-hover:text-indigo-400 transition-colors"}),o.jsxs("span",{children:["Velkommen, ",o.jsx("span",{className:"text-white group-hover:underline decoration-indigo-500/50 underline-offset-4 transition-all",children:t.displayName||"Eventyrer"})]})]}),o.jsx("div",{className:"h-4 w-px bg-white/10"}),o.jsx("button",{onClick:()=>s(),className:"hover:text-rose-400 text-white/40 transition-colors",children:"Logg ut"})]}):o.jsxs("div",{className:"flex items-center gap-6",children:[o.jsx("button",{onClick:()=>x("LOGIN"),className:"hover:text-white transition-colors text-white/70",children:"Logg Inn"}),o.jsx("button",{onClick:()=>x("REGISTER"),className:"px-5 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 rounded-full transition-all text-white",children:"Bli Med"})]})})]}),o.jsxs("main",{className:"flex-1 flex flex-col items-center justify-center w-full max-w-7xl mx-auto px-6 py-12",children:[o.jsxs("div",{className:"text-center mb-16 space-y-6 max-w-3xl",children:[o.jsx("h1",{className:"text-7xl md:text-9xl font-black text-white tracking-tighter leading-none drop-shadow-2xl",children:"MAKTHJULET"}),o.jsx("p",{className:"text-lg md:text-xl text-white/80 font-light tracking-wide max-w-xl mx-auto leading-relaxed",children:"Skjebnen er ikke skrevet. Den smis i ilden av ambisjoner."})]}),o.jsxs("div",{className:"w-full max-w-5xl bg-black/40 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] p-4 md:p-10 shadow-2xl relative overflow-hidden",children:[o.jsx("div",{className:"absolute inset-0 opacity-[0.03] pointer-events-none bg-[url('https://grainy-gradients.vercel.app/noise.svg')] bg-repeat"}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"mb-8 flex items-center justify-between border-b border-white/5 pb-6",children:[o.jsxs("h3",{className:"text-[10px] font-black tracking-[0.3em] text-white/40 uppercase flex items-center gap-3",children:[o.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.5)]"}),"Aktive Verdener"]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"flex -space-x-1.5 items-center mr-1",children:[[...Array(Math.min(3,f))].map((v,g)=>o.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-slate-900 bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.3)]"},g)),f>3&&o.jsxs("div",{className:"w-5 h-5 rounded-full border-2 border-slate-900 bg-slate-800 flex items-center justify-center text-[8px] font-black text-white/60",children:["+",f-3]}),f===0&&o.jsx("div",{className:"w-5 h-5 rounded-full border-2 border-slate-800 bg-slate-900/50"})]}),o.jsxs("span",{className:"text-[10px] text-white/40 uppercase font-black tracking-widest",children:[f," Live N"]})]})]}),o.jsx("div",{className:"max-h-[500px] overflow-y-auto custom-scrollbar pr-2",children:o.jsx(gte,{})})]})]})]}),o.jsxs("footer",{className:"w-full p-8 relative flex justify-center text-[10px] uppercase tracking-[0.2em] text-white/30",children:[o.jsx("span",{children:" 2026 Eiriksbok  Maktens Pris"}),o.jsx("button",{onClick:()=>l("/host"),className:"absolute right-8 bottom-8 text-white/10 hover:text-white/50 transition-colors duration-500 font-bold",children:"Admin"})]})]}),o.jsx(xte,{isOpen:n,onClose:()=>i(!1),initialMode:r})]})},vte=()=>o.jsx(y3,{basename:"/Simulation_StandAlone_Pro/",children:o.jsx(w3,{children:o.jsx(QF,{children:o.jsx($z,{children:o.jsx("div",{className:"min-h-screen bg-slate-950 text-white",children:o.jsxs(g3,{children:[o.jsx(Jc,{path:"/",element:o.jsx(bte,{})}),o.jsx(Jc,{path:"/host",element:o.jsx(EZ,{})}),o.jsx(Jc,{path:"/play/:pin/*",element:o.jsx(Hz,{children:o.jsx(fte,{})})}),o.jsx(Jc,{path:"*",element:o.jsx(m3,{to:"/",replace:!0})})]})})})})})});class yte extends Se.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Uncaught error:",e,s)}render(){var e,s,n,i,r,a,l;if(this.state.hasError){const c=((e=this.state.error)==null?void 0:e.name)==="TypeError"&&(((n=(s=this.state.error)==null?void 0:s.message)==null?void 0:n.toLowerCase().includes("failed to fetch dynamically imported module"))||((r=(i=this.state.error)==null?void 0:i.message)==null?void 0:r.toLowerCase().includes("loading chunk"))||((l=(a=this.state.error)==null?void 0:a.message)==null?void 0:l.toLowerCase().includes("dynamic import")));return o.jsx("div",{style:{padding:"2rem",backgroundColor:"#0f172a",color:"#f8fafc",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",fontFamily:"Inter, system-ui, sans-serif",textAlign:"center"},children:o.jsxs("div",{style:{maxWidth:"600px",padding:"3rem",backgroundColor:"#1e293b",borderRadius:"2rem",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 25px 50px -12px rgba(0,0,0,0.5)"},children:[o.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),o.jsx("h1",{style:{fontSize:"2rem",fontWeight:"900",marginBottom:"1rem",color:"#ef4444"},children:c?"Applikasjonen m oppdateres":"Noe gikk galt"}),o.jsx("p",{style:{color:"#94a3b8",marginBottom:"2rem",fontSize:"1.1rem"},children:c?"En ny versjon av simulatoren er tilgjengelig. Trykk p knappen under for  laste inn p nytt.":"Det oppstod en uventet feil i simuleringshallen."}),o.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"1rem 2rem",backgroundColor:"#4f46e5",color:"white",border:"none",borderRadius:"1rem",fontWeight:"bold",fontSize:"1rem",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 10px 15px -3px rgba(79, 70, 229, 0.4)"},onMouseOver:u=>u.currentTarget.style.backgroundColor="#4338ca",onMouseOut:u=>u.currentTarget.style.backgroundColor="#4f46e5",children:"Oppdater applikasjonen"}),o.jsxs("details",{style:{marginTop:"2rem",textAlign:"left"},children:[o.jsx("summary",{style:{cursor:"pointer",color:"#64748b",fontSize:"0.8rem"},children:"Teknisk feilinfo"}),o.jsx("pre",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#0f172a",borderRadius:"0.5rem",fontSize:"0.75rem",overflowX:"auto",color:"#ef4444",whiteSpace:"pre-wrap"},children:this.state.error&&this.state.error.toString()+`

`+this.state.error.stack})]})]})})}return this.props.children}}N4.createRoot(document.getElementById("root")).render(o.jsx(Se.StrictMode,{children:o.jsx(yte,{children:o.jsx(vte,{})})}));export{sse as $,Ec as A,cte as B,Sn as C,gd as D,tc as E,zi as F,re as G,XX as H,UN as I,ba as J,Jl as K,Oo as L,md as M,bt as N,ZZ as O,Qte as P,u1 as Q,ga as R,zn as S,zm as T,Gn as U,Fs as V,Zte as W,Jte as X,ese as Y,Db as Z,Tt as _,Ge as a,tse as a0,uO as a1,sa as a2,h1 as a3,EQ as a4,Ic as a5,CX as a6,l1 as a7,rte as a8,qe as a9,rO as aa,VT as ab,QI as ac,Yn as ad,On as ae,io as af,rb as ag,eO as ah,El as ai,xf as b,Se as c,yo as d,N as e,BQ as f,ise as g,Gm as h,d1 as i,o as j,qt as k,nee as l,ee as m,SQ as n,CQ as o,JI as p,ie as q,z as r,q as s,qz as t,oe as u,DA as v,S_ as w,iJ as x,mQ as y,rQ as z};
